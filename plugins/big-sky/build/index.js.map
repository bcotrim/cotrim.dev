{"version":3,"file":"index.js","mappings":"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yrG,OCblB,GAdoB,CACnBh5F,KAAM,OACNghC,MAAOA,IACQ,CCPR,CACNhhC,KAAM,aACN80C,YACC,wJACDL,WAAY,CACXlnD,KAAM,SACNmnD,WAAY,CACXtN,SAAU,CACT75C,KAAM,UAEP85C,MAAO,CACN95C,KAAM,UAEP05C,gBAAiB,CAChB15C,KAAM,UAEP45C,UAAW,CACV55C,KAAM,UAEP6uG,iBAAkB,CACjB7uG,KAAM,CAAE,SAAU,SAEnB+1G,WAAY,CACX/1G,KAAM,SACNunD,YACC,yIACDoH,KAAM,CACL,WACA,cACA,QACA,YACA,YACA,aACA,cACA,UACA,cACA,YACA,WACA,UACA,WACA,UACA,eACA,YACA,YAGF5U,aAAc,CACb/5C,KAAM,CAAE,SAAU,QAClBunD,YACC,sQAGHH,SAAU,CACT,WACA,QACA,kBACA,YACA,mBACA,aACA,iBAGFE,QAAQ,GCzDF,CACN70C,KAAM,qBACN80C,YACC,8MACDL,WAAY,CACXlnD,KAAM,SACNmnD,WAAY,CACXtN,SAAU,CACT75C,KAAM,SACNunD,YACC,wyBACDoH,KAAMq4D,IAEPltE,MAAO,CACN95C,KAAM,SACNunD,YACC,ueAEF7N,gBAAiB,CAChB15C,KAAM,SACNunD,YACC,kXAEF3N,UAAW,CACV55C,KAAM,SACNunD,YACC,2gBAEFsnD,iBAAkB,CACjB7uG,KAAM,CAAE,SAAU,QAClBunD,YACC,uoBAEF0/D,iBAAkB,CACjBjnH,KAAM,SACNunD,YACC,iHAEFtQ,QAAS,CACRj3C,KAAM,QACNunD,YACC,iJACD+xB,MAAO,CACNt5E,KAAM,SACNqnD,sBAAsB,EACtBD,SAAU,CAAE,aAAc,eAC1BD,WAAY,CACX+/D,WAAY,CACXlnH,KAAM,UAEPunD,YAAa,CACZvnD,KAAM,cAMXonD,SAAU,CACT,WACA,QACA,kBACA,YACA,mBACA,mBACA,YAGFE,QAAQ,GCxEF,CACN70C,KAAM,mBACN80C,YAAa,8CACbL,WAAY,CACXlnD,KAAM,SACNmnD,WAAY,CACXhzC,QAAS,CACRnU,KAAM,SACNunD,YACC,iKAEF0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","sources":["webpack://big-sky/webpack/runtime/chunk loaded","webpack://big-sky/./node_modules/@rive-app/canvas/rive.js","webpack://big-sky/./node_modules/@rive-app/react-canvas/dist/index.js","webpack://big-sky/./node_modules/@xata.io/screenshot/dist/index.js","webpack://big-sky/./node_modules/debug/src/browser.js","webpack://big-sky/./node_modules/debug/src/common.js","webpack://big-sky/./node_modules/deepmerge/dist/cjs.js","webpack://big-sky/./node_modules/extend/index.js","webpack://big-sky/./node_modules/inline-style-parser/index.js","webpack://big-sky/./node_modules/ms/index.js","webpack://big-sky/./node_modules/react/cjs/react-jsx-runtime.production.min.js","webpack://big-sky/./node_modules/react/jsx-runtime.js","webpack://big-sky/./node_modules/style-to-object/cjs/index.js","webpack://big-sky/external window \"React\"","webpack://big-sky/./node_modules/classnames/index.js","webpack://big-sky/external window [\"wp\",\"plugins\"]","webpack://big-sky/external window [\"wp\",\"primitives\"]","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/more.js","webpack://big-sky/external window [\"wp\",\"privateApis\"]","webpack://big-sky/./src/utils/lock-unlock.js","webpack://big-sky/external window [\"wp\",\"editor\"]","webpack://big-sky/external window [\"wp\",\"data\"]","webpack://big-sky/external window [\"wp\",\"element\"]","webpack://big-sky/external window [\"wp\",\"blockEditor\"]","webpack://big-sky/./src/big-sky-agents/utils/log-debug.js","webpack://big-sky/./node_modules/eventsource-parser/dist/index.js","webpack://big-sky/./node_modules/eventsource-parser/dist/stream.js","webpack://big-sky/./src/big-sky-agents/ai/chat-model.js","webpack://big-sky/./src/big-sky-agents/store/agents.js","webpack://big-sky/./src/utils/uuid.js","webpack://big-sky/external window [\"wp\",\"i18n\"]","webpack://big-sky/./src/utils/constants.js","webpack://big-sky/./src/big-sky-agents/store/chat.js","webpack://big-sky/./src/big-sky-agents/store/toolkits.js","webpack://big-sky/./src/big-sky-agents/store/utils.js","webpack://big-sky/./src/big-sky-agents/store/index.js","webpack://big-sky/./src/big-sky-agents/ai/agents/default-agents.js","webpack://big-sky/./src/big-sky-agents/components/agents-provider/context.jsx","webpack://big-sky/./src/big-sky-agents/components/agents-provider/use-agents.js","webpack://big-sky/./src/big-sky-agents/components/chat-provider/context.jsx","webpack://big-sky/./src/big-sky-agents/components/chat-provider/use-chat.js","webpack://big-sky/./src/big-sky-agents/ai/toolkits/default-toolkits.js","webpack://big-sky/./src/big-sky-agents/components/toolkits-provider/context.jsx","webpack://big-sky/./src/big-sky-agents/components/toolkits-provider/use-toolkits.js","webpack://big-sky/./src/big-sky-agents/components/toolkits-provider/use-toolkit.js","webpack://big-sky/./src/big-sky-agents/hooks/use-next-tool-call.js","webpack://big-sky/./src/big-sky-agents/components/with-tool-call.jsx","webpack://big-sky/./src/big-sky-agents/ai/utils/openai.js","webpack://big-sky/./src/big-sky-agents/hooks/use-agent-executor.js","webpack://big-sky/./src/utils/deep-equal.js","webpack://big-sky/./src/big-sky-agents/hooks/use-chat-settings.js","webpack://big-sky/./src/big-sky-agents/ai/utils/dot.js","webpack://big-sky/./src/big-sky-agents/ai/prompt-template.js","webpack://big-sky/./src/big-sky-agents/ai/agents/agent.js","webpack://big-sky/./src/ai/assistants/constants.js","webpack://big-sky/./src/ai/assistants/shared/prompts.js","webpack://big-sky/./src/ai/assistants/shared/change-assistant/change-assistant-tool.js","webpack://big-sky/./src/ai/assistants/router/toolkit.js","webpack://big-sky/./node_modules/estree-util-is-identifier-name/lib/index.js","webpack://big-sky/./node_modules/hast-util-whitespace/lib/index.js","webpack://big-sky/./node_modules/property-information/lib/util/schema.js","webpack://big-sky/./node_modules/property-information/lib/util/merge.js","webpack://big-sky/./node_modules/property-information/lib/normalize.js","webpack://big-sky/./node_modules/property-information/lib/util/info.js","webpack://big-sky/./node_modules/property-information/lib/util/types.js","webpack://big-sky/./node_modules/property-information/lib/util/defined-info.js","webpack://big-sky/./node_modules/property-information/lib/util/create.js","webpack://big-sky/./node_modules/property-information/lib/xlink.js","webpack://big-sky/./node_modules/property-information/lib/xml.js","webpack://big-sky/./node_modules/property-information/lib/util/case-sensitive-transform.js","webpack://big-sky/./node_modules/property-information/lib/util/case-insensitive-transform.js","webpack://big-sky/./node_modules/property-information/lib/xmlns.js","webpack://big-sky/./node_modules/property-information/lib/aria.js","webpack://big-sky/./node_modules/property-information/lib/html.js","webpack://big-sky/./node_modules/property-information/lib/svg.js","webpack://big-sky/./node_modules/property-information/index.js","webpack://big-sky/./node_modules/property-information/lib/find.js","webpack://big-sky/./node_modules/property-information/lib/hast-to-react.js","webpack://big-sky/./node_modules/style-to-object/esm/index.mjs","webpack://big-sky/./node_modules/unist-util-position/lib/index.js","webpack://big-sky/./node_modules/unist-util-stringify-position/lib/index.js","webpack://big-sky/./node_modules/vfile-message/lib/index.js","webpack://big-sky/./node_modules/hast-util-to-jsx-runtime/lib/index.js","webpack://big-sky/./node_modules/comma-separated-tokens/index.js","webpack://big-sky/./node_modules/space-separated-tokens/index.js","webpack://big-sky/./node_modules/html-url-attributes/lib/index.js","webpack://big-sky/./node_modules/mdast-util-to-string/lib/index.js","webpack://big-sky/./node_modules/micromark-util-chunked/index.js","webpack://big-sky/./node_modules/micromark-util-subtokenize/lib/splice-buffer.js","webpack://big-sky/./node_modules/micromark-util-subtokenize/index.js","webpack://big-sky/./node_modules/micromark-util-combine-extensions/index.js","webpack://big-sky/./node_modules/micromark-util-character/index.js","webpack://big-sky/./node_modules/micromark-factory-space/index.js","webpack://big-sky/./node_modules/micromark/lib/initialize/content.js","webpack://big-sky/./node_modules/micromark/lib/initialize/document.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/blank-line.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/content.js","webpack://big-sky/./node_modules/micromark/lib/initialize/flow.js","webpack://big-sky/./node_modules/micromark/lib/initialize/text.js","webpack://big-sky/./node_modules/micromark-util-resolve-all/index.js","webpack://big-sky/./node_modules/micromark/lib/create-tokenizer.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/thematic-break.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/list.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/block-quote.js","webpack://big-sky/./node_modules/micromark-factory-destination/index.js","webpack://big-sky/./node_modules/micromark-factory-label/index.js","webpack://big-sky/./node_modules/micromark-factory-title/index.js","webpack://big-sky/./node_modules/micromark-factory-whitespace/index.js","webpack://big-sky/./node_modules/micromark-util-normalize-identifier/index.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/definition.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/code-indented.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/heading-atx.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/setext-underline.js","webpack://big-sky/./node_modules/micromark-util-html-tag-name/index.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/html-flow.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/code-fenced.js","webpack://big-sky/./node_modules/decode-named-character-reference/index.dom.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/character-reference.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/character-escape.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/line-ending.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/label-end.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/label-start-image.js","webpack://big-sky/./node_modules/micromark-util-classify-character/index.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/attention.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/autolink.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/html-text.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/label-start-link.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/hard-break-escape.js","webpack://big-sky/./node_modules/micromark-core-commonmark/lib/code-text.js","webpack://big-sky/./node_modules/micromark/lib/constructs.js","webpack://big-sky/./node_modules/micromark/lib/preprocess.js","webpack://big-sky/./node_modules/micromark-util-decode-numeric-character-reference/index.js","webpack://big-sky/./node_modules/micromark-util-decode-string/index.js","webpack://big-sky/./node_modules/mdast-util-from-markdown/lib/index.js","webpack://big-sky/./node_modules/micromark/lib/postprocess.js","webpack://big-sky/./node_modules/micromark/lib/parse.js","webpack://big-sky/./node_modules/remark-parse/lib/index.js","webpack://big-sky/./node_modules/@ungap/structured-clone/esm/types.js","webpack://big-sky/./node_modules/@ungap/structured-clone/esm/deserialize.js","webpack://big-sky/./node_modules/@ungap/structured-clone/esm/serialize.js","webpack://big-sky/./node_modules/@ungap/structured-clone/esm/index.js","webpack://big-sky/./node_modules/micromark-util-sanitize-uri/index.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/footer.js","webpack://big-sky/./node_modules/unist-util-is/lib/index.js","webpack://big-sky/./node_modules/unist-util-visit-parents/lib/index.js","webpack://big-sky/./node_modules/unist-util-visit/lib/index.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/revert.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/list-item.js","webpack://big-sky/./node_modules/trim-lines/index.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/index.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/blockquote.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/break.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/code.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/delete.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/emphasis.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/footnote-reference.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/heading.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/html.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/image-reference.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/image.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/inline-code.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/link-reference.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/link.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/list.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/paragraph.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/root.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/strong.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/table.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/table-cell.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/table-row.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/text.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/handlers/thematic-break.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/state.js","webpack://big-sky/./node_modules/mdast-util-to-hast/lib/index.js","webpack://big-sky/./node_modules/remark-rehype/lib/index.js","webpack://big-sky/./node_modules/bail/index.js","webpack://big-sky/./node_modules/unified/node_modules/is-plain-obj/index.js","webpack://big-sky/./node_modules/vfile/lib/minpath.browser.js","webpack://big-sky/./node_modules/vfile/lib/minproc.browser.js","webpack://big-sky/./node_modules/vfile/lib/minurl.shared.js","webpack://big-sky/./node_modules/vfile/lib/index.js","webpack://big-sky/./node_modules/vfile/lib/minurl.browser.js","webpack://big-sky/./node_modules/unified/lib/callable-instance.js","webpack://big-sky/./node_modules/unified/lib/index.js","webpack://big-sky/./node_modules/trough/lib/index.js","webpack://big-sky/./node_modules/react-markdown/lib/index.js","webpack://big-sky/./node_modules/rememo/rememo.js","webpack://big-sky/./src/utils/site-type.js","webpack://big-sky/external window [\"wp\",\"apiFetch\"]","webpack://big-sky/./node_modules/@automattic/jetpack-analytics/index.jsx","webpack://big-sky/external window [\"wp\",\"coreData\"]","webpack://big-sky/./src/utils/tracks.js","webpack://big-sky/./src/utils/log-action.js","webpack://big-sky/./src/utils/log-debug.js","webpack://big-sky/./src/utils/request-jetpack-token.ts","webpack://big-sky/./src/store/actions/openai.js","webpack://big-sky/./src/data/pattern-categories.js","webpack://big-sky/./node_modules/nanoid/index.browser.js","webpack://big-sky/./node_modules/nanoid/url-alphabet/index.js","webpack://big-sky/./src/ai/tasks/replace-content/utils.js","webpack://big-sky/./src/ai/system-prompt-template.js","webpack://big-sky/./src/ai/tasks/replace-content/section-types/system-prompt.js","webpack://big-sky/./src/ai/tasks/replace-content/section-types/events.js","webpack://big-sky/./src/ai/tasks/replace-content/section-types/footer.js","webpack://big-sky/./src/ai/tasks/replace-content/section-types/menus.js","webpack://big-sky/./src/ai/tasks/replace-content/section-types/pricing.js","webpack://big-sky/./src/ai/tasks/replace-content/section-types/services.js","webpack://big-sky/./src/ai/tasks/replace-content/section-types/testimonials.js","webpack://big-sky/external window [\"wp\",\"blocks\"]","webpack://big-sky/./src/ai/tasks/replace-content/section-types/contact.js","webpack://big-sky/./src/ai/tasks/replace-content/section-types/index.js","webpack://big-sky/./src/ai/tasks/replace-content/section-types/team.js","webpack://big-sky/./src/store/reducer.js","webpack://big-sky/./src/utils/set-delay.js","webpack://big-sky/./src/store/index.js","webpack://big-sky/./src/components/dock/notice/index.js","webpack://big-sky/./src/hooks/use-handle-reset.js","webpack://big-sky/./src/ai/assistants/shared/use-create-tool-callback.js","webpack://big-sky/./src/ai/assistants/assistant-registry.js","webpack://big-sky/./src/ai/assistants/shared/change-assistant/use-change-assistant-tool.js","webpack://big-sky/./src/ai/assistants/router/use-router-toolkit.js","webpack://big-sky/./src/ai/assistants/router/index.js","webpack://big-sky/./src/ai/assistants/router/prompt.js","webpack://big-sky/./src/ai/assistants/spec/prompt.js","webpack://big-sky/./src/data/site-categories.js","webpack://big-sky/./src/ai/assistants/spec/toolkit.js","webpack://big-sky/./src/ai/assistants/spec/tools/build-site/build-site-tool.js","webpack://big-sky/./src/ai/assistants/spec/tools/confirm-site-specs/confirm-site-specs-tool.js","webpack://big-sky/./src/ai/assistants/shared/make-suggestions/tool.js","webpack://big-sky/./src/ai/assistants/shared/start-over/start-over.js","webpack://big-sky/./src/ai/assistants/spec/context.js","webpack://big-sky/./src/utils/log-session.js","webpack://big-sky/./src/hooks/use-site-metadata.js","webpack://big-sky/./src/utils/log-metadata.js","webpack://big-sky/./src/utils/canvas-iframe-elements.js","webpack://big-sky/./src/hooks/use-blocks.js","webpack://big-sky/./node_modules/colord/index.mjs","webpack://big-sky/./node_modules/colord/plugins/a11y.mjs","webpack://big-sky/./src/hooks/use-variations.js","webpack://big-sky/./src/utils/custom-color-variations/constants.js","webpack://big-sky/./src/utils/colors.js","webpack://big-sky/./src/utils/custom-color-variations/light-theme.js","webpack://big-sky/./src/utils/custom-color-variations/dark-theme.js","webpack://big-sky/./src/utils/custom-color-variations/hsl-theme.js","webpack://big-sky/./src/utils/custom-color-variations/index.js","webpack://big-sky/./src/hooks/use-styles.js","webpack://big-sky/./src/utils/dummy-posts.js","webpack://big-sky/external window [\"wp\",\"router\"]","webpack://big-sky/./src/hooks/use-canvas.js","webpack://big-sky/./src/hooks/use-after-save.js","webpack://big-sky/external window [\"wp\",\"mediaUtils\"]","webpack://big-sky/external window [\"wp\",\"hooks\"]","webpack://big-sky/./node_modules/fast-average-color/dist/index.esm.js","webpack://big-sky/./src/utils/images.js","webpack://big-sky/./src/hooks/use-images.js","webpack://big-sky/./src/hooks/use-pattern-content.js","webpack://big-sky/./src/ai/tasks/replace-content/system-prompt.js","webpack://big-sky/./src/ai/tasks/replace-content/use-replace-content.js","webpack://big-sky/./src/hooks/use-patterns.js","webpack://big-sky/./src/hooks/use-is-home-page.js","webpack://big-sky/./src/hooks/use-pages.js","webpack://big-sky/./src/hooks/use-reset-site.js","webpack://big-sky/./src/hooks/use-geocoder.js","webpack://big-sky/./src/ai/tasks/get-build-designs/system-prompt.js","webpack://big-sky/./src/ai/tasks/get-build-designs/tool.js","webpack://big-sky/./src/ai/assistants/color/tools/color-palette-generator.js","webpack://big-sky/./src/data/page-definitions.js","webpack://big-sky/./src/data/site-structure-templates.js","webpack://big-sky/./src/ai/tasks/get-site-structure/system-prompt.js","webpack://big-sky/./src/ai/tasks/get-site-structure/tool.js","webpack://big-sky/./src/ai/tasks/get-site-structure/use-get-site-structure.js","webpack://big-sky/./src/hooks/use-routing.js","webpack://big-sky/./src/ai/assistants/spec/tools/build-site/use-build-site-tool.js","webpack://big-sky/./src/hooks/use-build-site.js","webpack://big-sky/./src/ai/tasks/get-build-designs/use-get-build-designs.js","webpack://big-sky/./src/ai/assistants/spec/index.js","webpack://big-sky/./src/ai/assistants/spec/use-spec-toolkit.js","webpack://big-sky/./src/ai/assistants/font/tools/show-font-picker.js","webpack://big-sky/./src/ai/assistants/content/tools/button/upsert-social-link.js","webpack://big-sky/./src/ai/assistants/content/tools/contact-form/constants.js","webpack://big-sky/./src/ai/assistants/content/tools/content/events/add-item-to-events-container-tool.js","webpack://big-sky/./src/ai/assistants/content/tools/content/menu/add-item-to-menu-container-tool.js","webpack://big-sky/./src/ai/assistants/content/toolkit.js","webpack://big-sky/./src/ai/assistants/content/tools/address/update-address.js","webpack://big-sky/./src/ai/assistants/content/tools/make-text-bold-italic/make-text-bold-italic-tool.js","webpack://big-sky/./src/ai/assistants/content/tools/content/events/add-container-to-events-section-tool.js","webpack://big-sky/./src/ai/assistants/content/tools/content/menu/add-container-to-menu-section-tool.js","webpack://big-sky/./src/ai/assistants/content/tools/content/services/add-container-to-services-section-tool.js","webpack://big-sky/./src/ai/assistants/content/tools/content/testimonials/add-item-to-testimonials-section-tool.js","webpack://big-sky/./src/ai/assistants/content/tools/content/pricing/add-container-to-pricing-section-tool.js","webpack://big-sky/./src/ai/assistants/content/tools/content/team/add-container-to-team-section-tool.js","webpack://big-sky/./src/ai/assistants/content/tools/content/team/add-member-to-team-container-tool.js","webpack://big-sky/./src/ai/assistants/content/tools/contact-form/modify-contact-form-fields-tool.js","webpack://big-sky/./src/ai/assistants/content/tools/button/update-button-link.js","webpack://big-sky/./src/ai/assistants/content/tools/content/rewrite-content.js","webpack://big-sky/./src/hooks/use-validation.js","webpack://big-sky/./src/ai/assistants/content/tools/button/use-tool-functions.js","webpack://big-sky/./src/ai/assistants/content/tools/contact-form/use-tool-functions.js","webpack://big-sky/./src/ai/assistants/content/tools/address/use-tool-functions.js","webpack://big-sky/external window [\"wp\",\"richText\"]","webpack://big-sky/external window [\"wp\",\"components\"]","webpack://big-sky/./src/components/chat/actions/action-carousel.js","webpack://big-sky/./src/utils/log-screenshot.js","webpack://big-sky/./src/hooks/use-log.js","webpack://big-sky/./src/utils/log-message.js","webpack://big-sky/./src/components/chat/actions/index.js","webpack://big-sky/./src/hooks/use-is-thinking.js","webpack://big-sky/./src/ai/assistants/shared/make-suggestions/index.js","webpack://big-sky/./src/ai/assistants/content/index.js","webpack://big-sky/./src/ai/assistants/content/prompt.js","webpack://big-sky/./src/ai/assistants/content/use-content-toolkit.js","webpack://big-sky/./src/ai/assistants/content/tools/content/use-tool-functions.js","webpack://big-sky/./src/ai/assistants/content/tools/make-text-bold-italic/use-tool-functions.js","webpack://big-sky/./src/ai/assistants/shared/start-over/use-tool-functions.js","webpack://big-sky/./src/ai/assistants/color/toolkit.js","webpack://big-sky/./src/ai/assistants/color/tools/update-component-color.js","webpack://big-sky/./node_modules/colord/plugins/lab.mjs","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/arrow-left.js","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/arrow-right.js","webpack://big-sky/./node_modules/is-plain-object/dist/is-plain-object.mjs","webpack://big-sky/external window [\"wp\",\"keycodes\"]","webpack://big-sky/external window [\"wp\",\"compose\"]","webpack://big-sky/./src/components/styles-preview.js","webpack://big-sky/./src/components/style-variations-container.js","webpack://big-sky/./src/components/variation-picker/index.js","webpack://big-sky/./src/components/color-variation-picker.js","webpack://big-sky/./src/ai/assistants/color/tools/use-tool-functions.js","webpack://big-sky/./node_modules/colord/plugins/names.mjs","webpack://big-sky/./src/ai/assistants/color/use-color-toolkit.js","webpack://big-sky/./src/ai/assistants/color/index.js","webpack://big-sky/./src/ai/assistants/color/prompt.js","webpack://big-sky/./src/ai/assistants/pattern/tools/add-pattern/add-pattern-tool.js","webpack://big-sky/./src/ai/assistants/pattern/tools/generate-pattern/generate-pattern-tool.js","webpack://big-sky/./src/ai/assistants/pattern/tools/replace-pattern/replace-pattern-tool.js","webpack://big-sky/./src/ai/assistants/pattern/toolkit.js","webpack://big-sky/./src/ai/assistants/pattern/tools/remove-block/remove-block-tool.js","webpack://big-sky/./src/ai/assistants/pattern/use-pattern-tool-validation.js","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/chevron-left.js","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/chevron-right.js","webpack://big-sky/./src/hooks/use-scroll-buttons.js","webpack://big-sky/external window [\"wp\",\"viewport\"]","webpack://big-sky/./src/components/thinking-message/index.js","webpack://big-sky/./src/components/item-preview/index.js","webpack://big-sky/./src/components/icons.js","webpack://big-sky/./src/components/item-picker/index.js","webpack://big-sky/./src/components/dock/menus/pattern-picker/index.js","webpack://big-sky/./src/ai/assistants/pattern/tools/add-pattern/use-add-pattern-tool.js","webpack://big-sky/./src/ai/assistants/pattern/tools/replace-pattern/use-replace-pattern-tool.js","webpack://big-sky/./src/ai/assistants/pattern/tools/generate-pattern/use-generate-pattern-tool.js","webpack://big-sky/./src/ai/assistants/pattern/tools/generate-pattern/prompts/use-user-prompt.js","webpack://big-sky/./src/ai/assistants/pattern/tools/generate-pattern/hooks/use-stream-parser.js","webpack://big-sky/./src/ai/assistants/pattern/tools/generate-pattern/hooks/use-pattern-renderer.js","webpack://big-sky/./src/ai/assistants/pattern/use-pattern-toolkit.js","webpack://big-sky/./src/ai/assistants/pattern/index.js","webpack://big-sky/./src/ai/assistants/pattern/prompt.js","webpack://big-sky/./src/ai/assistants/pattern/tools/remove-block/use-remove-block-tool.js","webpack://big-sky/./src/ai/assistants/font/toolkit.js","webpack://big-sky/./src/components/font-variation-picker.js","webpack://big-sky/./src/ai/assistants/font/tools/use-tool-functions.js","webpack://big-sky/./src/utils/fonts.js","webpack://big-sky/./src/ai/assistants/font/use-font-toolkit.js","webpack://big-sky/./src/ai/assistants/font/index.js","webpack://big-sky/./src/ai/assistants/font/prompt.js","webpack://big-sky/./src/ai/assistants/layout/toolkit.js","webpack://big-sky/./src/ai/assistants/layout/tools/show-layout-picker/show-layout-picker-tool.js","webpack://big-sky/./src/components/dock/menus/layout-picker/index.js","webpack://big-sky/./src/ai/assistants/layout/tools/show-layout-picker/use-show-layout-picker-tool.js","webpack://big-sky/./src/ai/assistants/layout/use-layout-toolkit.js","webpack://big-sky/./src/ai/assistants/layout/index.js","webpack://big-sky/./src/ai/assistants/layout/prompt.js","webpack://big-sky/./src/ai/assistants/image/tools/generate-image/generate-image-tool.js","webpack://big-sky/./src/ai/assistants/image/toolkit.js","webpack://big-sky/./src/ai/assistants/image/tools/get-stock-image/get-stock-image-tool.js","webpack://big-sky/./src/ai/assistants/image/tools/generate-site-logo/generate-site-logo-tool.js","webpack://big-sky/./src/ai/assistants/image/tools/upload-site-logo/upload-site-logo-tool.js","webpack://big-sky/./src/ai/assistants/image/tools/upload-site-logo/use-upload-site-logo-tool.js","webpack://big-sky/./src/ai/assistants/image/index.js","webpack://big-sky/./src/ai/assistants/image/prompt.js","webpack://big-sky/./src/ai/assistants/image/use-image-toolkit.js","webpack://big-sky/./src/ai/assistants/image/use-image-tool-validation.js","webpack://big-sky/./src/ai/assistants/image/tools/generate-image/use-generate-image-tool.js","webpack://big-sky/./src/ai/assistants/image/tools/get-stock-image/use-get-stock-image-tool.js","webpack://big-sky/./src/ai/assistants/image/tools/generate-site-logo/use-generate-site-logo-tool.js","webpack://big-sky/./src/ai/assistants/page/tools/add-page/add-page-tool.js","webpack://big-sky/./src/ai/assistants/page/tools/navigate-to-page/navigate-to-page-tool.js","webpack://big-sky/./src/ai/assistants/page/toolkit.js","webpack://big-sky/./src/ai/assistants/page/index.js","webpack://big-sky/./src/ai/assistants/page/prompt.js","webpack://big-sky/./src/ai/assistants/page/use-page-toolkit.js","webpack://big-sky/./src/ai/assistants/page/tools/add-page/use-add-page-tool.js","webpack://big-sky/./src/ai/assistants/page/tools/navigate-to-page/use-navigate-to-page-tool.js","webpack://big-sky/./src/ai/assistants/help/tools/ask-wordpress-expert/answers.js","webpack://big-sky/./src/ai/assistants/help/toolkit.js","webpack://big-sky/./src/ai/assistants/help/tools/ask-wordpress-expert/ask-wordpress-expert-tool.js","webpack://big-sky/./src/ai/assistants/help/tools/ask-odie/use-ask-odie-tool.js","webpack://big-sky/./src/ai/assistants/help/index.js","webpack://big-sky/./src/ai/assistants/help/prompt.js","webpack://big-sky/./src/ai/assistants/help/use-help-toolkit.js","webpack://big-sky/./src/ai/assistants/help/tools/ask-wordpress-expert/use-ask-wordpress-expert-tool.js","webpack://big-sky/./src/ai/assistants/help/use-help-tool-validation.js","webpack://big-sky/./src/ai/assistants/index.js","webpack://big-sky/./src/components/ai-build-mode/index.js","webpack://big-sky/./src/components/assembler-debug/index.js","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/close.js","webpack://big-sky/./src/hooks/use-jetpack-token.js","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/warning.js","webpack://big-sky/./src/components/chat/message/index.js","webpack://big-sky/./src/components/chat/input/index.js","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/resize-corner-n-e.js","webpack://big-sky/./src/components/chat/navigation/resize-button.js","webpack://big-sky/./src/components/chat/navigation/index.js","webpack://big-sky/./node_modules/@wordpress/icons/build-module/icon/index.js","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/title.js","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/edit.js","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/pencil.js","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/term-description.js","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/map-marker.js","webpack://big-sky/./src/ai/assistants/spec/tools/confirm-site-specs/site-specs-list/index.js","webpack://big-sky/./src/components/chat/thread/index.js","webpack://big-sky/./src/components/chat/components/index.js","webpack://big-sky/./src/components/big-sky-icon/index.js","webpack://big-sky/./src/hooks/use-big-sky-icon.js","webpack://big-sky/./src/components/chat/index.js","webpack://big-sky/./src/components/dock/utils.js","webpack://big-sky/./src/components/dock/tool-container/index.js","webpack://big-sky/./src/components/onboarding/confirmation-dialog.js","webpack://big-sky/./src/components/dock/button-bar/completed-action.js","webpack://big-sky/./src/hooks/use-undo-redo.js","webpack://big-sky/./src/components/dock/button-bar/handoff/step.js","webpack://big-sky/./src/components/chat/thread/use-thread.js","webpack://big-sky/./src/components/dock/button-bar/handoff/index.js","webpack://big-sky/./src/components/dock/button-bar/pending-action.js","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/image.js","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/chevron-down.js","webpack://big-sky/./src/components/dock/menus/cover-image.js","webpack://big-sky/./src/components/dock/menus/button.js","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/plus.js","webpack://big-sky/./src/components/dock/menus/group.js","webpack://big-sky/./src/components/dock/menus/images.js","webpack://big-sky/./src/components/dock/menus/navigation.js","webpack://big-sky/./src/components/dock/menus/navigation-item.js","webpack://big-sky/./src/components/dock/menus/text.js","webpack://big-sky/./src/components/dock/menus/section-color-variation-picker/index.js","webpack://big-sky/./src/components/dock/menus/color-picker/index.js","webpack://big-sky/./src/components/dock/menus/index.js","webpack://big-sky/./src/components/dock/button-bar/index.js","webpack://big-sky/./src/components/dock/index.js","webpack://big-sky/external window [\"wp\",\"preferences\"]","webpack://big-sky/./src/hooks/use-save-external-images.js","webpack://big-sky/./src/components/editor-setup.js","webpack://big-sky/./src/hooks/use-colorized-logo.js","webpack://big-sky/./src/utils/media.js","webpack://big-sky/./src/ai/assistants/toolkits-provider.js","webpack://big-sky/./node_modules/@wordpress/icons/build-module/library/reusable-block.js","webpack://big-sky/./src/components/onboarding/site-suggestions.js","webpack://big-sky/./src/components/onboarding/landing-view.js","webpack://big-sky/./src/components/onboarding/chat-view.js","webpack://big-sky/./src/components/onboarding/index.js","webpack://big-sky/./src/components/index.js","webpack://big-sky/./src/components/error-boundary.js","webpack://big-sky/external window [\"wp\",\"commands\"]","webpack://big-sky/./src/ai/commands/retrieve-commands.js","webpack://big-sky/./src/components/editor-subscriptions/index.js","webpack://big-sky/./src/index.js","webpack://big-sky/webpack/bootstrap","webpack://big-sky/webpack/runtime/compat get default export","webpack://big-sky/webpack/runtime/define property getters","webpack://big-sky/webpack/runtime/hasOwnProperty shorthand","webpack://big-sky/webpack/runtime/make namespace object","webpack://big-sky/webpack/runtime/jsonp chunk loading","webpack://big-sky/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"rive\"] = factory();\n\telse\n\t\troot[\"rive\"] = factory();\n})(this, () => {\nreturn /******/ (() => { // webpackBootstrap\n/******/ \t\"use strict\";\n/******/ \tvar __webpack_modules__ = ([\n/* 0 */,\n/* 1 */\n/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {\n\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n\nvar Rive = (() => {\n  var _scriptDir = typeof document !== 'undefined' && document.currentScript ? document.currentScript.src : undefined;\n  \n  return (\nfunction(moduleArg = {}) {\n\nvar m = moduleArg, aa, ea;\nm.ready = new Promise((a, b) => {\n  aa = a;\n  ea = b;\n});\nfunction fa() {\n  function a(g) {\n    const n = d;\n    c = b = 0;\n    d = new Map();\n    n.forEach(p => {\n      try {\n        p(g);\n      } catch (l) {\n        console.error(l);\n      }\n    });\n    this.ob();\n    e && e.Tb();\n  }\n  let b = 0, c = 0, d = new Map(), e = null, f = null;\n  this.requestAnimationFrame = function(g) {\n    b || (b = requestAnimationFrame(a.bind(this)));\n    const n = ++c;\n    d.set(n, g);\n    return n;\n  };\n  this.cancelAnimationFrame = function(g) {\n    d.delete(g);\n    b && 0 == d.size && (cancelAnimationFrame(b), b = 0);\n  };\n  this.Rb = function(g) {\n    f && (document.body.remove(f), f = null);\n    g || (f = document.createElement(\"div\"), f.style.backgroundColor = \"black\", f.style.position = \"fixed\", f.style.right = 0, f.style.top = 0, f.style.color = \"white\", f.style.padding = \"4px\", f.innerHTML = \"RIVE FPS\", g = function(n) {\n      f.innerHTML = \"RIVE FPS \" + n.toFixed(1);\n    }, document.body.appendChild(f));\n    e = new function() {\n      let n = 0, p = 0;\n      this.Tb = function() {\n        var l = performance.now();\n        p ? (++n, l -= p, 1000 < l && (g(1000 * n / l), n = p = 0)) : (p = l, n = 0);\n      };\n    }();\n  };\n  this.Ob = function() {\n    f && (document.body.remove(f), f = null);\n    e = null;\n  };\n  this.ob = function() {\n  };\n}\nfunction ha(a) {\n  console.assert(!0);\n  const b = new Map();\n  let c = -Infinity;\n  this.push = function(d) {\n    d = d + ((1 << a) - 1) >> a;\n    b.has(d) && clearTimeout(b.get(d));\n    b.set(d, setTimeout(function() {\n      b.delete(d);\n      0 == b.length ? c = -Infinity : d == c && (c = Math.max(...b.keys()), console.assert(c < d));\n    }, 1000));\n    c = Math.max(d, c);\n    return c << a;\n  };\n}\nconst ia = m.onRuntimeInitialized;\nm.onRuntimeInitialized = function() {\n  ia && ia();\n  let a = m.decodeAudio;\n  m.decodeAudio = function(d, e) {\n    d = a(d);\n    e(d);\n  };\n  let b = m.decodeFont;\n  m.decodeFont = function(d, e) {\n    d = b(d);\n    e(d);\n  };\n  const c = m.FileAssetLoader;\n  m.ptrToAsset = d => {\n    let e = m.ptrToFileAsset(d);\n    return e.isImage ? m.ptrToImageAsset(d) : e.isFont ? m.ptrToFontAsset(d) : e.isAudio ? m.ptrToAudioAsset(d) : e;\n  };\n  m.CustomFileAssetLoader = c.extend(\"CustomFileAssetLoader\", {__construct:function({loadContents:d}) {\n    this.__parent.__construct.call(this);\n    this.Gb = d;\n  }, loadContents:function(d, e) {\n    d = m.ptrToAsset(d);\n    return this.Gb(d, e);\n  },});\n  m.CDNFileAssetLoader = c.extend(\"CDNFileAssetLoader\", {__construct:function() {\n    this.__parent.__construct.call(this);\n  }, loadContents:function(d) {\n    let e = m.ptrToAsset(d);\n    d = e.cdnUuid;\n    if (\"\" === d) {\n      return !1;\n    }\n    (function(f, g) {\n      var n = new XMLHttpRequest();\n      n.responseType = \"arraybuffer\";\n      n.onreadystatechange = function() {\n        4 == n.readyState && 200 == n.status && g(n);\n      };\n      n.open(\"GET\", f, !0);\n      n.send(null);\n    })(e.cdnBaseUrl + \"/\" + d, f => {\n      e.decode(new Uint8Array(f.response));\n    });\n    return !0;\n  },});\n  m.FallbackFileAssetLoader = c.extend(\"FallbackFileAssetLoader\", {__construct:function() {\n    this.__parent.__construct.call(this);\n    this.kb = [];\n  }, addLoader:function(d) {\n    this.kb.push(d);\n  }, loadContents:function(d, e) {\n    for (let f of this.kb) {\n      if (f.loadContents(d, e)) {\n        return !0;\n      }\n    }\n    return !1;\n  },});\n};\nconst ja = \"createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText\".split(\" \"), ka = new function() {\n  function a() {\n    if (!b) {\n      var k = document.createElement(\"canvas\"), t = {alpha:1, depth:0, stencil:0, antialias:0, premultipliedAlpha:1, preserveDrawingBuffer:0, preferLowPowerToHighPerformance:0, failIfMajorPerformanceCaveat:0, enableExtensionsByDefault:1, explicitSwapControl:1, renderViaOffscreenBackBuffer:1,};\n      let r;\n      if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {\n        if (r = k.getContext(\"webgl\", t), c = 1, !r) {\n          return console.log(\"No WebGL support. Image mesh will not be drawn.\"), !1;\n        }\n      } else {\n        if (r = k.getContext(\"webgl2\", t)) {\n          c = 2;\n        } else {\n          if (r = k.getContext(\"webgl\", t)) {\n            c = 1;\n          } else {\n            return console.log(\"No WebGL support. Image mesh will not be drawn.\"), !1;\n          }\n        }\n      }\n      r = new Proxy(r, {get(D, w) {\n        if (D.isContextLost()) {\n          if (p || (console.error(\"Cannot render the mesh because the GL Context was lost. Tried to invoke \", w), p = !0), \"function\" === typeof D[w]) {\n            return function() {\n            };\n          }\n        } else {\n          return \"function\" === typeof D[w] ? function(...M) {\n            return D[w].apply(D, M);\n          } : D[w];\n        }\n      }, set(D, w, M) {\n        if (D.isContextLost()) {\n          p || (console.error(\"Cannot render the mesh because the GL Context was lost. Tried to set property \" + w), p = !0);\n        } else {\n          return D[w] = M, !0;\n        }\n      },});\n      d = Math.min(r.getParameter(r.MAX_RENDERBUFFER_SIZE), r.getParameter(r.MAX_TEXTURE_SIZE));\n      function A(D, w, M) {\n        w = r.createShader(w);\n        r.shaderSource(w, M);\n        r.compileShader(w);\n        M = r.getShaderInfoLog(w);\n        if (0 < (M || \"\").length) {\n          throw M;\n        }\n        r.attachShader(D, w);\n      }\n      k = r.createProgram();\n      A(k, r.VERTEX_SHADER, \"attribute vec2 vertex;\\n                attribute vec2 uv;\\n                uniform vec4 mat;\\n                uniform vec2 translate;\\n                varying vec2 st;\\n                void main() {\\n                    st = uv;\\n                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);\\n                }\");\n      A(k, r.FRAGMENT_SHADER, \"precision highp float;\\n                uniform sampler2D image;\\n                varying vec2 st;\\n                void main() {\\n                    gl_FragColor = texture2D(image, st);\\n                }\");\n      r.bindAttribLocation(k, 0, \"vertex\");\n      r.bindAttribLocation(k, 1, \"uv\");\n      r.linkProgram(k);\n      t = r.getProgramInfoLog(k);\n      if (0 < (t || \"\").trim().length) {\n        throw t;\n      }\n      e = r.getUniformLocation(k, \"mat\");\n      f = r.getUniformLocation(k, \"translate\");\n      r.useProgram(k);\n      r.bindBuffer(r.ARRAY_BUFFER, r.createBuffer());\n      r.enableVertexAttribArray(0);\n      r.enableVertexAttribArray(1);\n      r.bindBuffer(r.ELEMENT_ARRAY_BUFFER, r.createBuffer());\n      r.uniform1i(r.getUniformLocation(k, \"image\"), 0);\n      r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL, !0);\n      b = r;\n    }\n    return !0;\n  }\n  let b = null, c = 0, d = 0, e = null, f = null, g = 0, n = 0, p = !1;\n  a();\n  this.hc = function() {\n    a();\n    return d;\n  };\n  this.Mb = function(k) {\n    b.deleteTexture && b.deleteTexture(k);\n  };\n  this.Lb = function(k) {\n    if (!a()) {\n      return null;\n    }\n    const t = b.createTexture();\n    if (!t) {\n      return null;\n    }\n    b.bindTexture(b.TEXTURE_2D, t);\n    b.texImage2D(b.TEXTURE_2D, 0, b.RGBA, b.RGBA, b.UNSIGNED_BYTE, k);\n    b.texParameteri(b.TEXTURE_2D, b.TEXTURE_WRAP_S, b.CLAMP_TO_EDGE);\n    b.texParameteri(b.TEXTURE_2D, b.TEXTURE_WRAP_T, b.CLAMP_TO_EDGE);\n    b.texParameteri(b.TEXTURE_2D, b.TEXTURE_MAG_FILTER, b.LINEAR);\n    2 == c ? (b.texParameteri(b.TEXTURE_2D, b.TEXTURE_MIN_FILTER, b.LINEAR_MIPMAP_LINEAR), b.generateMipmap(b.TEXTURE_2D)) : b.texParameteri(b.TEXTURE_2D, b.TEXTURE_MIN_FILTER, b.LINEAR);\n    return t;\n  };\n  const l = new ha(8), u = new ha(8), v = new ha(10), x = new ha(10);\n  this.Qb = function(k, t, r, A, D) {\n    if (a()) {\n      var w = l.push(k), M = u.push(t);\n      if (b.canvas) {\n        if (b.canvas.width != w || b.canvas.height != M) {\n          b.canvas.width = w, b.canvas.height = M;\n        }\n        b.viewport(0, M - t, k, t);\n        b.disable(b.SCISSOR_TEST);\n        b.clearColor(0, 0, 0, 0);\n        b.clear(b.COLOR_BUFFER_BIT);\n        b.enable(b.SCISSOR_TEST);\n        r.sort((F, ba) => ba.wb - F.wb);\n        w = v.push(A);\n        g != w && (b.bufferData(b.ARRAY_BUFFER, 8 * w, b.DYNAMIC_DRAW), g = w);\n        w = 0;\n        for (var T of r) {\n          b.bufferSubData(b.ARRAY_BUFFER, w, T.Ta), w += 4 * T.Ta.length;\n        }\n        console.assert(w == 4 * A);\n        for (var ca of r) {\n          b.bufferSubData(b.ARRAY_BUFFER, w, ca.Db), w += 4 * ca.Db.length;\n        }\n        console.assert(w == 8 * A);\n        w = x.push(D);\n        n != w && (b.bufferData(b.ELEMENT_ARRAY_BUFFER, 2 * w, b.DYNAMIC_DRAW), n = w);\n        T = 0;\n        for (var ra of r) {\n          b.bufferSubData(b.ELEMENT_ARRAY_BUFFER, T, ra.indices), T += 2 * ra.indices.length;\n        }\n        console.assert(T == 2 * D);\n        ra = 0;\n        ca = !0;\n        w = T = 0;\n        for (const F of r) {\n          F.image.Ka != ra && (b.bindTexture(b.TEXTURE_2D, F.image.Ja || null), ra = F.image.Ka);\n          F.mc ? (b.scissor(F.Ya, M - F.Za - F.jb, F.Ac, F.jb), ca = !0) : ca && (b.scissor(0, M - t, k, t), ca = !1);\n          r = 2 / k;\n          const ba = -2 / t;\n          b.uniform4f(e, F.ha[0] * r * F.Ba, F.ha[1] * ba * F.Ca, F.ha[2] * r * F.Ba, F.ha[3] * ba * F.Ca);\n          b.uniform2f(f, F.ha[4] * r * F.Ba + r * (F.Ya - F.ic * F.Ba) - 1, F.ha[5] * ba * F.Ca + ba * (F.Za - F.jc * F.Ca) + 1);\n          b.vertexAttribPointer(0, 2, b.FLOAT, !1, 0, w);\n          b.vertexAttribPointer(1, 2, b.FLOAT, !1, 0, w + 4 * A);\n          b.drawElements(b.TRIANGLES, F.indices.length, b.UNSIGNED_SHORT, T);\n          w += 4 * F.Ta.length;\n          T += 2 * F.indices.length;\n        }\n        console.assert(w == 4 * A);\n        console.assert(T == 2 * D);\n      }\n    }\n  };\n  this.canvas = function() {\n    return a() && b.canvas;\n  };\n}(), la = m.onRuntimeInitialized;\nm.onRuntimeInitialized = function() {\n  function a(q) {\n    switch(q) {\n      case l.srcOver:\n        return \"source-over\";\n      case l.screen:\n        return \"screen\";\n      case l.overlay:\n        return \"overlay\";\n      case l.darken:\n        return \"darken\";\n      case l.lighten:\n        return \"lighten\";\n      case l.colorDodge:\n        return \"color-dodge\";\n      case l.colorBurn:\n        return \"color-burn\";\n      case l.hardLight:\n        return \"hard-light\";\n      case l.softLight:\n        return \"soft-light\";\n      case l.difference:\n        return \"difference\";\n      case l.exclusion:\n        return \"exclusion\";\n      case l.multiply:\n        return \"multiply\";\n      case l.hue:\n        return \"hue\";\n      case l.saturation:\n        return \"saturation\";\n      case l.color:\n        return \"color\";\n      case l.luminosity:\n        return \"luminosity\";\n    }\n  }\n  function b(q) {\n    return \"rgba(\" + ((16711680 & q) >>> 16) + \",\" + ((65280 & q) >>> 8) + \",\" + ((255 & q) >>> 0) + \",\" + ((4278190080 & q) >>> 24) / 255 + \")\";\n  }\n  function c() {\n    0 < M.length && (ka.Qb(w.drawWidth(), w.drawHeight(), M, T, ca), M = [], ca = T = 0, w.reset(512, 512));\n    for (const q of D) {\n      for (const z of q.H) {\n        z();\n      }\n      q.H = [];\n    }\n    D.clear();\n  }\n  la && la();\n  var d = m.RenderPaintStyle;\n  const e = m.RenderPath, f = m.RenderPaint, g = m.Renderer, n = m.StrokeCap, p = m.StrokeJoin, l = m.BlendMode, u = d.fill, v = d.stroke, x = m.FillRule.evenOdd;\n  let k = 1;\n  var t = m.RenderImage.extend(\"CanvasRenderImage\", {__construct:function({la:q, xa:z} = {}) {\n    this.__parent.__construct.call(this);\n    this.Ka = k;\n    k = k + 1 & 2147483647 || 1;\n    this.la = q;\n    this.xa = z;\n  }, __destruct:function() {\n    this.Ja && (ka.Mb(this.Ja), URL.revokeObjectURL(this.Wa));\n    this.__parent.__destruct.call(this);\n  }, decode:function(q) {\n    var z = this;\n    z.xa && z.xa(z);\n    var G = new Image();\n    z.Wa = URL.createObjectURL(new Blob([q], {type:\"image/png\",}));\n    G.onload = function() {\n      z.Fb = G;\n      z.Ja = ka.Lb(G);\n      z.size(G.width, G.height);\n      z.la && z.la(z);\n    };\n    G.src = z.Wa;\n  },}), r = e.extend(\"CanvasRenderPath\", {__construct:function() {\n    this.__parent.__construct.call(this);\n    this.T = new Path2D();\n  }, rewind:function() {\n    this.T = new Path2D();\n  }, addPath:function(q, z, G, H, C, I, J) {\n    var K = this.T, X = K.addPath;\n    q = q.T;\n    const Q = new DOMMatrix();\n    Q.a = z;\n    Q.b = G;\n    Q.c = H;\n    Q.d = C;\n    Q.e = I;\n    Q.f = J;\n    X.call(K, q, Q);\n  }, fillRule:function(q) {\n    this.Va = q;\n  }, moveTo:function(q, z) {\n    this.T.moveTo(q, z);\n  }, lineTo:function(q, z) {\n    this.T.lineTo(q, z);\n  }, cubicTo:function(q, z, G, H, C, I) {\n    this.T.bezierCurveTo(q, z, G, H, C, I);\n  }, close:function() {\n    this.T.closePath();\n  },}), A = f.extend(\"CanvasRenderPaint\", {color:function(q) {\n    this.Xa = b(q);\n  }, thickness:function(q) {\n    this.Ib = q;\n  }, join:function(q) {\n    switch(q) {\n      case p.miter:\n        this.Ia = \"miter\";\n        break;\n      case p.round:\n        this.Ia = \"round\";\n        break;\n      case p.bevel:\n        this.Ia = \"bevel\";\n    }\n  }, cap:function(q) {\n    switch(q) {\n      case n.butt:\n        this.Ha = \"butt\";\n        break;\n      case n.round:\n        this.Ha = \"round\";\n        break;\n      case n.square:\n        this.Ha = \"square\";\n    }\n  }, style:function(q) {\n    this.Hb = q;\n  }, blendMode:function(q) {\n    this.Eb = a(q);\n  }, clearGradient:function() {\n    this.ja = null;\n  }, linearGradient:function(q, z, G, H) {\n    this.ja = {yb:q, zb:z, bb:G, cb:H, Ra:[],};\n  }, radialGradient:function(q, z, G, H) {\n    this.ja = {yb:q, zb:z, bb:G, cb:H, Ra:[], ec:!0,};\n  }, addStop:function(q, z) {\n    this.ja.Ra.push({color:q, stop:z,});\n  }, completeGradient:function() {\n  }, draw:function(q, z, G) {\n    let H = this.Hb;\n    var C = this.Xa, I = this.ja;\n    q.globalCompositeOperation = this.Eb;\n    if (null != I) {\n      C = I.yb;\n      var J = I.zb;\n      const X = I.bb;\n      var K = I.cb;\n      const Q = I.Ra;\n      I.ec ? (I = X - C, K -= J, C = q.createRadialGradient(C, J, 0, C, J, Math.sqrt(I * I + K * K))) : C = q.createLinearGradient(C, J, X, K);\n      for (let da = 0, R = Q.length; da < R; da++) {\n        J = Q[da], C.addColorStop(J.stop, b(J.color));\n      }\n      this.Xa = C;\n      this.ja = null;\n    }\n    switch(H) {\n      case v:\n        q.strokeStyle = C;\n        q.lineWidth = this.Ib;\n        q.lineCap = this.Ha;\n        q.lineJoin = this.Ia;\n        q.stroke(z);\n        break;\n      case u:\n        q.fillStyle = C, q.fill(z, G);\n    }\n  },});\n  const D = new Set();\n  let w = null, M = [], T = 0, ca = 0;\n  var ra = m.CanvasRenderer = g.extend(\"Renderer\", {__construct:function(q) {\n    this.__parent.__construct.call(this);\n    this.S = [1, 0, 0, 1, 0, 0];\n    this.C = q.getContext(\"2d\");\n    this.Ua = q;\n    this.H = [];\n  }, save:function() {\n    this.S.push(...this.S.slice(this.S.length - 6));\n    this.H.push(this.C.save.bind(this.C));\n  }, restore:function() {\n    const q = this.S.length - 6;\n    if (6 > q) {\n      throw \"restore() called without matching save().\";\n    }\n    this.S.splice(q);\n    this.H.push(this.C.restore.bind(this.C));\n  }, transform:function(q, z, G, H, C, I) {\n    const J = this.S, K = J.length - 6;\n    J.splice(K, 6, J[K] * q + J[K + 2] * z, J[K + 1] * q + J[K + 3] * z, J[K] * G + J[K + 2] * H, J[K + 1] * G + J[K + 3] * H, J[K] * C + J[K + 2] * I + J[K + 4], J[K + 1] * C + J[K + 3] * I + J[K + 5]);\n    this.H.push(this.C.transform.bind(this.C, q, z, G, H, C, I));\n  }, rotate:function(q) {\n    const z = Math.sin(q);\n    q = Math.cos(q);\n    this.transform(q, z, -z, q, 0, 0);\n  }, _drawPath:function(q, z) {\n    this.H.push(z.draw.bind(z, this.C, q.T, q.Va === x ? \"evenodd\" : \"nonzero\"));\n  }, _drawRiveImage:function(q, z, G) {\n    var H = q.Fb;\n    if (H) {\n      var C = this.C, I = a(z);\n      this.H.push(function() {\n        C.globalCompositeOperation = I;\n        C.globalAlpha = G;\n        C.drawImage(H, 0, 0);\n        C.globalAlpha = 1;\n      });\n    }\n  }, _getMatrix:function(q) {\n    const z = this.S, G = z.length - 6;\n    for (let H = 0; 6 > H; ++H) {\n      q[H] = z[G + H];\n    }\n  }, _drawImageMesh:function(q, z, G, H, C, I, J, K, X, Q) {\n    var da = this.C.canvas.width, R = this.C.canvas.height;\n    const Yb = X - J, Zb = Q - K;\n    J = Math.max(J, 0);\n    K = Math.max(K, 0);\n    X = Math.min(X, da);\n    Q = Math.min(Q, R);\n    const Ga = X - J, Ha = Q - K;\n    console.assert(Ga <= Math.min(Yb, da));\n    console.assert(Ha <= Math.min(Zb, R));\n    if (!(0 >= Ga || 0 >= Ha)) {\n      X = Ga < Yb || Ha < Zb;\n      da = Q = 1;\n      var sa = Math.ceil(Ga * Q), ta = Math.ceil(Ha * da);\n      R = ka.hc();\n      sa > R && (Q *= R / sa, sa = R);\n      ta > R && (da *= R / ta, ta = R);\n      w || (w = new m.DynamicRectanizer(R), w.reset(512, 512));\n      R = w.addRect(sa, ta);\n      0 > R && (c(), D.add(this), R = w.addRect(sa, ta), console.assert(0 <= R));\n      var $b = R & 65535, ac = R >> 16;\n      M.push({ha:this.S.slice(this.S.length - 6), image:q, Ya:$b, Za:ac, ic:J, jc:K, Ac:sa, jb:ta, Ba:Q, Ca:da, Ta:new Float32Array(H), Db:new Float32Array(C), indices:new Uint16Array(I), mc:X, wb:q.Ka << 1 | (X ? 1 : 0),});\n      T += H.length;\n      ca += I.length;\n      var za = this.C, qd = a(z);\n      this.H.push(function() {\n        za.save();\n        za.resetTransform();\n        za.globalCompositeOperation = qd;\n        za.globalAlpha = G;\n        const bc = ka.canvas();\n        bc && za.drawImage(bc, $b, ac, sa, ta, J, K, Ga, Ha);\n        za.restore();\n      });\n    }\n  }, _clipPath:function(q) {\n    this.H.push(this.C.clip.bind(this.C, q.T, q.Va === x ? \"evenodd\" : \"nonzero\"));\n  }, clear:function() {\n    D.add(this);\n    this.H.push(this.C.clearRect.bind(this.C, 0, 0, this.Ua.width, this.Ua.height));\n  }, flush:function() {\n  }, translate:function(q, z) {\n    this.transform(1, 0, 0, 1, q, z);\n  },});\n  m.makeRenderer = function(q) {\n    const z = new ra(q), G = z.C;\n    return new Proxy(z, {get(H, C) {\n      if (\"function\" === typeof H[C]) {\n        return function(...I) {\n          return H[C].apply(H, I);\n        };\n      }\n      if (\"function\" === typeof G[C]) {\n        if (-1 < ja.indexOf(C)) {\n          throw Error(\"RiveException: Method call to '\" + C + \"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.\");\n        }\n        return function(...I) {\n          z.H.push(G[C].bind(G, ...I));\n        };\n      }\n      return H[C];\n    }, set(H, C, I) {\n      if (C in G) {\n        return z.H.push(() => {\n          G[C] = I;\n        }), !0;\n      }\n    },});\n  };\n  m.decodeImage = function(q, z) {\n    (new t({la:z})).decode(q);\n  };\n  m.renderFactory = {makeRenderPaint:function() {\n    return new A();\n  }, makeRenderPath:function() {\n    return new r();\n  }, makeRenderImage:function() {\n    let q = ba;\n    return new t({xa:() => {\n      q.total++;\n    }, la:() => {\n      q.loaded++;\n      if (q.loaded === q.total) {\n        const z = q.ready;\n        z && (z(), q.ready = null);\n      }\n    },});\n  },};\n  let F = m.load, ba = null;\n  m.load = function(q, z, G = !0) {\n    const H = new m.FallbackFileAssetLoader();\n    void 0 !== z && H.addLoader(z);\n    G && (z = new m.CDNFileAssetLoader(), H.addLoader(z));\n    return new Promise(function(C) {\n      let I = null;\n      ba = {total:0, loaded:0, ready:function() {\n        C(I);\n      },};\n      I = F(q, H);\n      0 == ba.total && C(I);\n    });\n  };\n  d = new fa();\n  m.requestAnimationFrame = d.requestAnimationFrame.bind(d);\n  m.cancelAnimationFrame = d.cancelAnimationFrame.bind(d);\n  m.enableFPSCounter = d.Rb.bind(d);\n  m.disableFPSCounter = d.Ob;\n  d.ob = c;\n  m.resolveAnimationFrame = c;\n  m.cleanup = function() {\n    w && w.delete();\n  };\n};\nvar ma = Object.assign({}, m), na = \"./this.program\", oa = \"object\" == typeof window, pa = \"function\" == typeof importScripts, qa = \"\", ua, va;\nif (oa || pa) {\n  pa ? qa = self.location.href : \"undefined\" != typeof document && document.currentScript && (qa = document.currentScript.src), _scriptDir && (qa = _scriptDir), 0 !== qa.indexOf(\"blob:\") ? qa = qa.substr(0, qa.replace(/[?#].*/, \"\").lastIndexOf(\"/\") + 1) : qa = \"\", pa && (va = a => {\n    var b = new XMLHttpRequest();\n    b.open(\"GET\", a, !1);\n    b.responseType = \"arraybuffer\";\n    b.send(null);\n    return new Uint8Array(b.response);\n  }), ua = (a, b, c) => {\n    var d = new XMLHttpRequest();\n    d.open(\"GET\", a, !0);\n    d.responseType = \"arraybuffer\";\n    d.onload = () => {\n      200 == d.status || 0 == d.status && d.response ? b(d.response) : c();\n    };\n    d.onerror = c;\n    d.send(null);\n  };\n}\nvar wa = m.print || console.log.bind(console), xa = m.printErr || console.error.bind(console);\nObject.assign(m, ma);\nma = null;\nm.thisProgram && (na = m.thisProgram);\nvar ya;\nm.wasmBinary && (ya = m.wasmBinary);\nvar noExitRuntime = m.noExitRuntime || !0;\n\"object\" != typeof WebAssembly && Aa(\"no native wasm support detected\");\nvar Ba, y, Ca = !1, B, E, Da, Ea, L, N, Fa, Ia;\nfunction Ja() {\n  var a = Ba.buffer;\n  m.HEAP8 = B = new Int8Array(a);\n  m.HEAP16 = Da = new Int16Array(a);\n  m.HEAP32 = L = new Int32Array(a);\n  m.HEAPU8 = E = new Uint8Array(a);\n  m.HEAPU16 = Ea = new Uint16Array(a);\n  m.HEAPU32 = N = new Uint32Array(a);\n  m.HEAPF32 = Fa = new Float32Array(a);\n  m.HEAPF64 = Ia = new Float64Array(a);\n}\nvar Ka, La = [], Ma = [], Na = [];\nfunction Oa() {\n  var a = m.preRun.shift();\n  La.unshift(a);\n}\nvar Pa = 0, Qa = null, Ra = null;\nfunction Aa(a) {\n  if (m.onAbort) {\n    m.onAbort(a);\n  }\n  a = \"Aborted(\" + a + \")\";\n  xa(a);\n  Ca = !0;\n  a = new WebAssembly.RuntimeError(a + \". Build with -sASSERTIONS for more info.\");\n  ea(a);\n  throw a;\n}\nfunction Sa(a) {\n  return a.startsWith(\"data:application/octet-stream;base64,\");\n}\nvar Ta;\nTa = \"canvas_advanced.wasm\";\nif (!Sa(Ta)) {\n  var Ua = Ta;\n  Ta = m.locateFile ? m.locateFile(Ua, qa) : qa + Ua;\n}\nfunction Va(a) {\n  if (a == Ta && ya) {\n    return new Uint8Array(ya);\n  }\n  if (va) {\n    return va(a);\n  }\n  throw \"both async and sync fetching of the wasm failed\";\n}\nfunction Wa(a) {\n  if (!ya && (oa || pa)) {\n    if (\"function\" == typeof fetch && !a.startsWith(\"file://\")) {\n      return fetch(a, {credentials:\"same-origin\"}).then(b => {\n        if (!b.ok) {\n          throw \"failed to load wasm binary file at '\" + a + \"'\";\n        }\n        return b.arrayBuffer();\n      }).catch(() => Va(a));\n    }\n    if (ua) {\n      return new Promise((b, c) => {\n        ua(a, d => b(new Uint8Array(d)), c);\n      });\n    }\n  }\n  return Promise.resolve().then(() => Va(a));\n}\nfunction Xa(a, b, c) {\n  return Wa(a).then(d => WebAssembly.instantiate(d, b)).then(d => d).then(c, d => {\n    xa(\"failed to asynchronously prepare wasm: \" + d);\n    Aa(d);\n  });\n}\nfunction Ya(a, b) {\n  var c = Ta;\n  return ya || \"function\" != typeof WebAssembly.instantiateStreaming || Sa(c) || c.startsWith(\"file://\") || \"function\" != typeof fetch ? Xa(c, a, b) : fetch(c, {credentials:\"same-origin\"}).then(d => WebAssembly.instantiateStreaming(d, a).then(b, function(e) {\n    xa(\"wasm streaming compile failed: \" + e);\n    xa(\"falling back to ArrayBuffer instantiation\");\n    return Xa(c, a, b);\n  }));\n}\nvar Za, $a, db = {437932:(a, b, c, d, e) => {\n  if (\"undefined\" === typeof window || void 0 === (window.AudioContext || window.webkitAudioContext)) {\n    return 0;\n  }\n  if (\"undefined\" === typeof window.h) {\n    window.h = {Aa:0};\n    window.h.I = {};\n    window.h.I.ya = a;\n    window.h.I.capture = b;\n    window.h.I.La = c;\n    window.h.ga = {};\n    window.h.ga.stopped = d;\n    window.h.ga.xb = e;\n    let f = window.h;\n    f.D = [];\n    f.yc = function(g) {\n      for (var n = 0; n < f.D.length; ++n) {\n        if (null == f.D[n]) {\n          return f.D[n] = g, n;\n        }\n      }\n      f.D.push(g);\n      return f.D.length - 1;\n    };\n    f.Cb = function(g) {\n      for (f.D[g] = null; 0 < f.D.length;) {\n        if (null == f.D[f.D.length - 1]) {\n          f.D.pop();\n        } else {\n          break;\n        }\n      }\n    };\n    f.Sc = function(g) {\n      for (var n = 0; n < f.D.length; ++n) {\n        if (f.D[n] == g) {\n          return f.Cb(n);\n        }\n      }\n    };\n    f.ra = function(g) {\n      return f.D[g];\n    };\n    f.Bb = [\"touchend\", \"click\"];\n    f.unlock = function() {\n      for (var g = 0; g < f.D.length; ++g) {\n        var n = f.D[g];\n        null != n && null != n.J && n.state === f.ga.xb && n.J.resume().then(() => {\n          ab(n.pb);\n        }, p => {\n          console.error(\"Failed to resume audiocontext\", p);\n        });\n      }\n      f.Bb.map(function(p) {\n        document.removeEventListener(p, f.unlock, !0);\n      });\n    };\n    f.Bb.map(function(g) {\n      document.addEventListener(g, f.unlock, !0);\n    });\n  }\n  window.h.Aa += 1;\n  return 1;\n}, 440110:() => {\n  \"undefined\" !== typeof window.h && (--window.h.Aa, 0 === window.h.Aa && delete window.h);\n}, 440274:() => void 0 !== navigator.mediaDevices && void 0 !== navigator.mediaDevices.getUserMedia, 440378:() => {\n  try {\n    var a = new (window.AudioContext || window.webkitAudioContext)(), b = a.sampleRate;\n    a.close();\n    return b;\n  } catch (c) {\n    return 0;\n  }\n}, 440549:(a, b, c, d, e, f) => {\n  if (\"undefined\" === typeof window.h) {\n    return -1;\n  }\n  var g = {}, n = {};\n  a == window.h.I.ya && 0 != c && (n.sampleRate = c);\n  g.J = new (window.AudioContext || window.webkitAudioContext)(n);\n  g.J.suspend();\n  g.state = window.h.ga.stopped;\n  c = 0;\n  a != window.h.I.ya && (c = b);\n  g.Z = g.J.createScriptProcessor(d, c, b);\n  g.Z.onaudioprocess = function(p) {\n    if (null == g.sa || 0 == g.sa.length) {\n      g.sa = new Float32Array(Fa.buffer, e, d * b);\n    }\n    if (a == window.h.I.capture || a == window.h.I.La) {\n      for (var l = 0; l < b; l += 1) {\n        for (var u = p.inputBuffer.getChannelData(l), v = g.sa, x = 0; x < d; x += 1) {\n          v[x * b + l] = u[x];\n        }\n      }\n      bb(f, d, e);\n    }\n    if (a == window.h.I.ya || a == window.h.I.La) {\n      for (cb(f, d, e), l = 0; l < p.outputBuffer.numberOfChannels; ++l) {\n        for (u = p.outputBuffer.getChannelData(l), v = g.sa, x = 0; x < d; x += 1) {\n          u[x] = v[x * b + l];\n        }\n      }\n    } else {\n      for (l = 0; l < p.outputBuffer.numberOfChannels; ++l) {\n        p.outputBuffer.getChannelData(l).fill(0.0);\n      }\n    }\n  };\n  a != window.h.I.capture && a != window.h.I.La || navigator.mediaDevices.getUserMedia({audio:!0, video:!1}).then(function(p) {\n    g.Da = g.J.createMediaStreamSource(p);\n    g.Da.connect(g.Z);\n    g.Z.connect(g.J.destination);\n  }).catch(function(p) {\n    console.log(\"Failed to get user media: \" + p);\n  });\n  a == window.h.I.ya && g.Z.connect(g.J.destination);\n  g.pb = f;\n  return window.h.yc(g);\n}, 443426:a => window.h.ra(a).J.sampleRate, 443499:a => {\n  a = window.h.ra(a);\n  void 0 !== a.Z && (a.Z.onaudioprocess = function() {\n  }, a.Z.disconnect(), a.Z = void 0);\n  void 0 !== a.Da && (a.Da.disconnect(), a.Da = void 0);\n  a.J.close();\n  a.J = void 0;\n  a.pb = void 0;\n}, 443899:a => {\n  window.h.Cb(a);\n}, 443949:a => {\n  a = window.h.ra(a);\n  a.J.resume();\n  a.state = window.h.ga.xb;\n}, 444088:a => {\n  a = window.h.ra(a);\n  a.J.suspend();\n  a.state = window.h.ga.stopped;\n}}, eb = a => {\n  for (; 0 < a.length;) {\n    a.shift()(m);\n  }\n}, fb = (a, b) => {\n  for (var c = 0, d = a.length - 1; 0 <= d; d--) {\n    var e = a[d];\n    \".\" === e ? a.splice(d, 1) : \"..\" === e ? (a.splice(d, 1), c++) : c && (a.splice(d, 1), c--);\n  }\n  if (b) {\n    for (; c; c--) {\n      a.unshift(\"..\");\n    }\n  }\n  return a;\n}, gb = a => {\n  var b = \"/\" === a.charAt(0), c = \"/\" === a.substr(-1);\n  (a = fb(a.split(\"/\").filter(d => !!d), !b).join(\"/\")) || b || (a = \".\");\n  a && c && (a += \"/\");\n  return (b ? \"/\" : \"\") + a;\n}, hb = a => {\n  var b = /^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/.exec(a).slice(1);\n  a = b[0];\n  b = b[1];\n  if (!a && !b) {\n    return \".\";\n  }\n  b && (b = b.substr(0, b.length - 1));\n  return a + b;\n}, ib = a => {\n  if (\"/\" === a) {\n    return \"/\";\n  }\n  a = gb(a);\n  a = a.replace(/\\/$/, \"\");\n  var b = a.lastIndexOf(\"/\");\n  return -1 === b ? a : a.substr(b + 1);\n}, jb = () => {\n  if (\"object\" == typeof crypto && \"function\" == typeof crypto.getRandomValues) {\n    return a => crypto.getRandomValues(a);\n  }\n  Aa(\"initRandomDevice\");\n}, kb = a => (kb = jb())(a);\nfunction lb() {\n  for (var a = \"\", b = !1, c = arguments.length - 1; -1 <= c && !b; c--) {\n    b = 0 <= c ? arguments[c] : \"/\";\n    if (\"string\" != typeof b) {\n      throw new TypeError(\"Arguments to path.resolve must be strings\");\n    }\n    if (!b) {\n      return \"\";\n    }\n    a = b + \"/\" + a;\n    b = \"/\" === b.charAt(0);\n  }\n  a = fb(a.split(\"/\").filter(d => !!d), !b).join(\"/\");\n  return (b ? \"/\" : \"\") + a || \".\";\n}\nvar mb = \"undefined\" != typeof TextDecoder ? new TextDecoder(\"utf8\") : void 0, nb = (a, b, c) => {\n  var d = b + c;\n  for (c = b; a[c] && !(c >= d);) {\n    ++c;\n  }\n  if (16 < c - b && a.buffer && mb) {\n    return mb.decode(a.subarray(b, c));\n  }\n  for (d = \"\"; b < c;) {\n    var e = a[b++];\n    if (e & 128) {\n      var f = a[b++] & 63;\n      if (192 == (e & 224)) {\n        d += String.fromCharCode((e & 31) << 6 | f);\n      } else {\n        var g = a[b++] & 63;\n        e = 224 == (e & 240) ? (e & 15) << 12 | f << 6 | g : (e & 7) << 18 | f << 12 | g << 6 | a[b++] & 63;\n        65536 > e ? d += String.fromCharCode(e) : (e -= 65536, d += String.fromCharCode(55296 | e >> 10, 56320 | e & 1023));\n      }\n    } else {\n      d += String.fromCharCode(e);\n    }\n  }\n  return d;\n}, ob = [], pb = a => {\n  for (var b = 0, c = 0; c < a.length; ++c) {\n    var d = a.charCodeAt(c);\n    127 >= d ? b++ : 2047 >= d ? b += 2 : 55296 <= d && 57343 >= d ? (b += 4, ++c) : b += 3;\n  }\n  return b;\n}, qb = (a, b, c, d) => {\n  if (!(0 < d)) {\n    return 0;\n  }\n  var e = c;\n  d = c + d - 1;\n  for (var f = 0; f < a.length; ++f) {\n    var g = a.charCodeAt(f);\n    if (55296 <= g && 57343 >= g) {\n      var n = a.charCodeAt(++f);\n      g = 65536 + ((g & 1023) << 10) | n & 1023;\n    }\n    if (127 >= g) {\n      if (c >= d) {\n        break;\n      }\n      b[c++] = g;\n    } else {\n      if (2047 >= g) {\n        if (c + 1 >= d) {\n          break;\n        }\n        b[c++] = 192 | g >> 6;\n      } else {\n        if (65535 >= g) {\n          if (c + 2 >= d) {\n            break;\n          }\n          b[c++] = 224 | g >> 12;\n        } else {\n          if (c + 3 >= d) {\n            break;\n          }\n          b[c++] = 240 | g >> 18;\n          b[c++] = 128 | g >> 12 & 63;\n        }\n        b[c++] = 128 | g >> 6 & 63;\n      }\n      b[c++] = 128 | g & 63;\n    }\n  }\n  b[c] = 0;\n  return c - e;\n};\nfunction rb(a, b) {\n  var c = Array(pb(a) + 1);\n  a = qb(a, c, 0, c.length);\n  b && (c.length = a);\n  return c;\n}\nvar sb = [];\nfunction tb(a, b) {\n  sb[a] = {input:[], F:[], V:b};\n  ub(a, vb);\n}\nvar vb = {open:function(a) {\n  var b = sb[a.node.za];\n  if (!b) {\n    throw new O(43);\n  }\n  a.s = b;\n  a.seekable = !1;\n}, close:function(a) {\n  a.s.V.qa(a.s);\n}, qa:function(a) {\n  a.s.V.qa(a.s);\n}, read:function(a, b, c, d) {\n  if (!a.s || !a.s.V.ib) {\n    throw new O(60);\n  }\n  for (var e = 0, f = 0; f < d; f++) {\n    try {\n      var g = a.s.V.ib(a.s);\n    } catch (n) {\n      throw new O(29);\n    }\n    if (void 0 === g && 0 === e) {\n      throw new O(6);\n    }\n    if (null === g || void 0 === g) {\n      break;\n    }\n    e++;\n    b[c + f] = g;\n  }\n  e && (a.node.timestamp = Date.now());\n  return e;\n}, write:function(a, b, c, d) {\n  if (!a.s || !a.s.V.Oa) {\n    throw new O(60);\n  }\n  try {\n    for (var e = 0; e < d; e++) {\n      a.s.V.Oa(a.s, b[c + e]);\n    }\n  } catch (f) {\n    throw new O(29);\n  }\n  d && (a.node.timestamp = Date.now());\n  return e;\n},}, wb = {ib:function() {\n  a: {\n    if (!ob.length) {\n      var a = null;\n      \"undefined\" != typeof window && \"function\" == typeof window.prompt ? (a = window.prompt(\"Input: \"), null !== a && (a += \"\\n\")) : \"function\" == typeof readline && (a = readline(), null !== a && (a += \"\\n\"));\n      if (!a) {\n        a = null;\n        break a;\n      }\n      ob = rb(a, !0);\n    }\n    a = ob.shift();\n  }\n  return a;\n}, Oa:function(a, b) {\n  null === b || 10 === b ? (wa(nb(a.F, 0)), a.F = []) : 0 != b && a.F.push(b);\n}, qa:function(a) {\n  a.F && 0 < a.F.length && (wa(nb(a.F, 0)), a.F = []);\n}, bc:function() {\n  return {Fc:25856, Hc:5, Ec:191, Gc:35387, Dc:[3, 28, 127, 21, 4, 0, 1, 0, 17, 19, 26, 0, 18, 15, 23, 22, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,]};\n}, cc:function() {\n  return 0;\n}, dc:function() {\n  return [24, 80];\n},}, xb = {Oa:function(a, b) {\n  null === b || 10 === b ? (xa(nb(a.F, 0)), a.F = []) : 0 != b && a.F.push(b);\n}, qa:function(a) {\n  a.F && 0 < a.F.length && (xa(nb(a.F, 0)), a.F = []);\n},};\nfunction yb(a, b) {\n  var c = a.j ? a.j.length : 0;\n  c >= b || (b = Math.max(b, c * (1048576 > c ? 2.0 : 1.125) >>> 0), 0 != c && (b = Math.max(b, 256)), c = a.j, a.j = new Uint8Array(b), 0 < a.v && a.j.set(c.subarray(0, a.v), 0));\n}\nvar P = {O:null, U() {\n  return P.createNode(null, \"/\", 16895, 0);\n}, createNode(a, b, c, d) {\n  if (24576 === (c & 61440) || 4096 === (c & 61440)) {\n    throw new O(63);\n  }\n  P.O || (P.O = {dir:{node:{Y:P.l.Y, P:P.l.P, ka:P.l.ka, va:P.l.va, ub:P.l.ub, Ab:P.l.Ab, vb:P.l.vb, sb:P.l.sb, Ea:P.l.Ea}, stream:{ba:P.m.ba}}, file:{node:{Y:P.l.Y, P:P.l.P}, stream:{ba:P.m.ba, read:P.m.read, write:P.m.write, pa:P.m.pa, lb:P.m.lb, nb:P.m.nb}}, link:{node:{Y:P.l.Y, P:P.l.P, ma:P.l.ma}, stream:{}}, $a:{node:{Y:P.l.Y, P:P.l.P}, stream:zb}});\n  c = Ab(a, b, c, d);\n  16384 === (c.mode & 61440) ? (c.l = P.O.dir.node, c.m = P.O.dir.stream, c.j = {}) : 32768 === (c.mode & 61440) ? (c.l = P.O.file.node, c.m = P.O.file.stream, c.v = 0, c.j = null) : 40960 === (c.mode & 61440) ? (c.l = P.O.link.node, c.m = P.O.link.stream) : 8192 === (c.mode & 61440) && (c.l = P.O.$a.node, c.m = P.O.$a.stream);\n  c.timestamp = Date.now();\n  a && (a.j[b] = c, a.timestamp = c.timestamp);\n  return c;\n}, Kc(a) {\n  return a.j ? a.j.subarray ? a.j.subarray(0, a.v) : new Uint8Array(a.j) : new Uint8Array(0);\n}, l:{Y(a) {\n  var b = {};\n  b.Jc = 8192 === (a.mode & 61440) ? a.id : 1;\n  b.Mc = a.id;\n  b.mode = a.mode;\n  b.Oc = 1;\n  b.uid = 0;\n  b.Lc = 0;\n  b.za = a.za;\n  16384 === (a.mode & 61440) ? b.size = 4096 : 32768 === (a.mode & 61440) ? b.size = a.v : 40960 === (a.mode & 61440) ? b.size = a.link.length : b.size = 0;\n  b.Bc = new Date(a.timestamp);\n  b.Nc = new Date(a.timestamp);\n  b.Ic = new Date(a.timestamp);\n  b.Jb = 4096;\n  b.Cc = Math.ceil(b.size / b.Jb);\n  return b;\n}, P(a, b) {\n  void 0 !== b.mode && (a.mode = b.mode);\n  void 0 !== b.timestamp && (a.timestamp = b.timestamp);\n  if (void 0 !== b.size && (b = b.size, a.v != b)) {\n    if (0 == b) {\n      a.j = null, a.v = 0;\n    } else {\n      var c = a.j;\n      a.j = new Uint8Array(b);\n      c && a.j.set(c.subarray(0, Math.min(b, a.v)));\n      a.v = b;\n    }\n  }\n}, ka() {\n  throw Bb[44];\n}, va(a, b, c, d) {\n  return P.createNode(a, b, c, d);\n}, ub(a, b, c) {\n  if (16384 === (a.mode & 61440)) {\n    try {\n      var d = Cb(b, c);\n    } catch (f) {\n    }\n    if (d) {\n      for (var e in d.j) {\n        throw new O(55);\n      }\n    }\n  }\n  delete a.parent.j[a.name];\n  a.parent.timestamp = Date.now();\n  a.name = c;\n  b.j[c] = a;\n  b.timestamp = a.parent.timestamp;\n  a.parent = b;\n}, Ab(a, b) {\n  delete a.j[b];\n  a.timestamp = Date.now();\n}, vb(a, b) {\n  var c = Cb(a, b), d;\n  for (d in c.j) {\n    throw new O(55);\n  }\n  delete a.j[b];\n  a.timestamp = Date.now();\n}, sb(a) {\n  var b = [\".\", \"..\"], c;\n  for (c in a.j) {\n    a.j.hasOwnProperty(c) && b.push(c);\n  }\n  return b;\n}, Ea(a, b, c) {\n  a = P.createNode(a, b, 41471, 0);\n  a.link = c;\n  return a;\n}, ma(a) {\n  if (40960 !== (a.mode & 61440)) {\n    throw new O(28);\n  }\n  return a.link;\n},}, m:{read(a, b, c, d, e) {\n  var f = a.node.j;\n  if (e >= a.node.v) {\n    return 0;\n  }\n  a = Math.min(a.node.v - e, d);\n  if (8 < a && f.subarray) {\n    b.set(f.subarray(e, e + a), c);\n  } else {\n    for (d = 0; d < a; d++) {\n      b[c + d] = f[e + d];\n    }\n  }\n  return a;\n}, write(a, b, c, d, e, f) {\n  b.buffer === B.buffer && (f = !1);\n  if (!d) {\n    return 0;\n  }\n  a = a.node;\n  a.timestamp = Date.now();\n  if (b.subarray && (!a.j || a.j.subarray)) {\n    if (f) {\n      return a.j = b.subarray(c, c + d), a.v = d;\n    }\n    if (0 === a.v && 0 === e) {\n      return a.j = b.slice(c, c + d), a.v = d;\n    }\n    if (e + d <= a.v) {\n      return a.j.set(b.subarray(c, c + d), e), d;\n    }\n  }\n  yb(a, e + d);\n  if (a.j.subarray && b.subarray) {\n    a.j.set(b.subarray(c, c + d), e);\n  } else {\n    for (f = 0; f < d; f++) {\n      a.j[e + f] = b[c + f];\n    }\n  }\n  a.v = Math.max(a.v, e + d);\n  return d;\n}, ba(a, b, c) {\n  1 === c ? b += a.position : 2 === c && 32768 === (a.node.mode & 61440) && (b += a.node.v);\n  if (0 > b) {\n    throw new O(28);\n  }\n  return b;\n}, pa(a, b, c) {\n  yb(a.node, b + c);\n  a.node.v = Math.max(a.node.v, b + c);\n}, lb(a, b, c, d, e) {\n  if (32768 !== (a.node.mode & 61440)) {\n    throw new O(43);\n  }\n  a = a.node.j;\n  if (e & 2 || a.buffer !== B.buffer) {\n    if (0 < c || c + b < a.length) {\n      a.subarray ? a = a.subarray(c, c + b) : a = Array.prototype.slice.call(a, c, c + b);\n    }\n    c = !0;\n    Aa();\n    b = void 0;\n    if (!b) {\n      throw new O(48);\n    }\n    B.set(a, b);\n  } else {\n    c = !1, b = a.byteOffset;\n  }\n  return {o:b, M:c};\n}, nb(a, b, c, d) {\n  P.m.write(a, b, 0, d, c, !1);\n  return 0;\n},},};\nfunction Db(a, b) {\n  var c = 0;\n  a && (c |= 365);\n  b && (c |= 146);\n  return c;\n}\nvar Eb = null, Fb = {}, Gb = [], Hb = 1, Ib = null, Jb = !0, O = null, Bb = {}, Lb = (a, b = {}) => {\n  a = lb(a);\n  if (!a) {\n    return {path:\"\", node:null};\n  }\n  b = Object.assign({gb:!0, Qa:0}, b);\n  if (8 < b.Qa) {\n    throw new O(32);\n  }\n  a = a.split(\"/\").filter(g => !!g);\n  for (var c = Eb, d = \"/\", e = 0; e < a.length; e++) {\n    var f = e === a.length - 1;\n    if (f && b.parent) {\n      break;\n    }\n    c = Cb(c, a[e]);\n    d = gb(d + \"/\" + a[e]);\n    c.wa && (!f || f && b.gb) && (c = c.wa.root);\n    if (!f || b.fb) {\n      for (f = 0; 40960 === (c.mode & 61440);) {\n        if (c = Kb(d), d = lb(hb(d), c), c = Lb(d, {Qa:b.Qa + 1}).node, 40 < f++) {\n          throw new O(32);\n        }\n      }\n    }\n  }\n  return {path:d, node:c};\n}, Mb = a => {\n  for (var b;;) {\n    if (a === a.parent) {\n      return a = a.U.mb, b ? \"/\" !== a[a.length - 1] ? `${a}/${b}` : a + b : a;\n    }\n    b = b ? `${a.name}/${b}` : a.name;\n    a = a.parent;\n  }\n}, Nb = (a, b) => {\n  for (var c = 0, d = 0; d < b.length; d++) {\n    c = (c << 5) - c + b.charCodeAt(d) | 0;\n  }\n  return (a + c >>> 0) % Ib.length;\n}, Cb = (a, b) => {\n  var c;\n  if (c = (c = Ob(a, \"x\")) ? c : a.l.ka ? 0 : 2) {\n    throw new O(c, a);\n  }\n  for (c = Ib[Nb(a.id, b)]; c; c = c.lc) {\n    var d = c.name;\n    if (c.parent.id === a.id && d === b) {\n      return c;\n    }\n  }\n  return a.l.ka(a, b);\n}, Ab = (a, b, c, d) => {\n  a = new Pb(a, b, c, d);\n  b = Nb(a.parent.id, a.name);\n  a.lc = Ib[b];\n  return Ib[b] = a;\n}, Qb = a => {\n  var b = [\"r\", \"w\", \"rw\"][a & 3];\n  a & 512 && (b += \"w\");\n  return b;\n}, Ob = (a, b) => {\n  if (Jb) {\n    return 0;\n  }\n  if (!b.includes(\"r\") || a.mode & 292) {\n    if (b.includes(\"w\") && !(a.mode & 146) || b.includes(\"x\") && !(a.mode & 73)) {\n      return 2;\n    }\n  } else {\n    return 2;\n  }\n  return 0;\n}, Rb = (a, b) => {\n  try {\n    return Cb(a, b), 20;\n  } catch (c) {\n  }\n  return Ob(a, \"wx\");\n}, Sb = () => {\n  for (var a = 0; 4096 >= a; a++) {\n    if (!Gb[a]) {\n      return a;\n    }\n  }\n  throw new O(33);\n}, Tb = a => {\n  a = Gb[a];\n  if (!a) {\n    throw new O(8);\n  }\n  return a;\n}, Vb = (a, b = -1) => {\n  Ub || (Ub = function() {\n    this.h = {};\n  }, Ub.prototype = {}, Object.defineProperties(Ub.prototype, {object:{get() {\n    return this.node;\n  }, set(c) {\n    this.node = c;\n  }}, flags:{get() {\n    return this.h.flags;\n  }, set(c) {\n    this.h.flags = c;\n  },}, position:{get() {\n    return this.h.position;\n  }, set(c) {\n    this.h.position = c;\n  },},}));\n  a = Object.assign(new Ub(), a);\n  -1 == b && (b = Sb());\n  a.X = b;\n  return Gb[b] = a;\n}, zb = {open:a => {\n  a.m = Fb[a.node.za].m;\n  a.m.open && a.m.open(a);\n}, ba:() => {\n  throw new O(70);\n},}, ub = (a, b) => {\n  Fb[a] = {m:b};\n}, Wb = (a, b) => {\n  var c = \"/\" === b, d = !b;\n  if (c && Eb) {\n    throw new O(10);\n  }\n  if (!c && !d) {\n    var e = Lb(b, {gb:!1});\n    b = e.path;\n    e = e.node;\n    if (e.wa) {\n      throw new O(10);\n    }\n    if (16384 !== (e.mode & 61440)) {\n      throw new O(54);\n    }\n  }\n  b = {type:a, Qc:{}, mb:b, kc:[]};\n  a = a.U(b);\n  a.U = b;\n  b.root = a;\n  c ? Eb = a : e && (e.wa = b, e.U && e.U.kc.push(b));\n}, S = (a, b, c) => {\n  var d = Lb(a, {parent:!0}).node;\n  a = ib(a);\n  if (!a || \".\" === a || \"..\" === a) {\n    throw new O(28);\n  }\n  var e = Rb(d, a);\n  if (e) {\n    throw new O(e);\n  }\n  if (!d.l.va) {\n    throw new O(63);\n  }\n  return d.l.va(d, a, b, c);\n}, Xb = (a, b, c) => {\n  \"undefined\" == typeof c && (c = b, b = 438);\n  S(a, b | 8192, c);\n}, cc = (a, b) => {\n  if (!lb(a)) {\n    throw new O(44);\n  }\n  var c = Lb(b, {parent:!0}).node;\n  if (!c) {\n    throw new O(44);\n  }\n  b = ib(b);\n  var d = Rb(c, b);\n  if (d) {\n    throw new O(d);\n  }\n  if (!c.l.Ea) {\n    throw new O(63);\n  }\n  c.l.Ea(c, b, a);\n}, Kb = a => {\n  a = Lb(a).node;\n  if (!a) {\n    throw new O(44);\n  }\n  if (!a.l.ma) {\n    throw new O(28);\n  }\n  return lb(Mb(a.parent), a.l.ma(a));\n}, ec = (a, b, c) => {\n  if (\"\" === a) {\n    throw new O(44);\n  }\n  if (\"string\" == typeof b) {\n    var d = {r:0, \"r+\":2, w:577, \"w+\":578, a:1089, \"a+\":1090,}[b];\n    if (\"undefined\" == typeof d) {\n      throw Error(`Unknown file open mode: ${b}`);\n    }\n    b = d;\n  }\n  c = b & 64 ? (\"undefined\" == typeof c ? 438 : c) & 4095 | 32768 : 0;\n  if (\"object\" == typeof a) {\n    var e = a;\n  } else {\n    a = gb(a);\n    try {\n      e = Lb(a, {fb:!(b & 131072)}).node;\n    } catch (f) {\n    }\n  }\n  d = !1;\n  if (b & 64) {\n    if (e) {\n      if (b & 128) {\n        throw new O(20);\n      }\n    } else {\n      e = S(a, c, 0), d = !0;\n    }\n  }\n  if (!e) {\n    throw new O(44);\n  }\n  8192 === (e.mode & 61440) && (b &= -513);\n  if (b & 65536 && 16384 !== (e.mode & 61440)) {\n    throw new O(54);\n  }\n  if (!d && (c = e ? 40960 === (e.mode & 61440) ? 32 : 16384 === (e.mode & 61440) && (\"r\" !== Qb(b) || b & 512) ? 31 : Ob(e, Qb(b)) : 44)) {\n    throw new O(c);\n  }\n  if (b & 512 && !d) {\n    c = e;\n    c = \"string\" == typeof c ? Lb(c, {fb:!0}).node : c;\n    if (!c.l.P) {\n      throw new O(63);\n    }\n    if (16384 === (c.mode & 61440)) {\n      throw new O(31);\n    }\n    if (32768 !== (c.mode & 61440)) {\n      throw new O(28);\n    }\n    if (d = Ob(c, \"w\")) {\n      throw new O(d);\n    }\n    c.l.P(c, {size:0, timestamp:Date.now()});\n  }\n  b &= -131713;\n  e = Vb({node:e, path:Mb(e), flags:b, seekable:!0, position:0, m:e.m, zc:[], error:!1});\n  e.m.open && e.m.open(e);\n  !m.logReadFiles || b & 1 || (dc || (dc = {}), a in dc || (dc[a] = 1));\n  return e;\n}, fc = (a, b, c) => {\n  if (null === a.X) {\n    throw new O(8);\n  }\n  if (!a.seekable || !a.m.ba) {\n    throw new O(70);\n  }\n  if (0 != c && 1 != c && 2 != c) {\n    throw new O(28);\n  }\n  a.position = a.m.ba(a, b, c);\n  a.zc = [];\n}, gc = () => {\n  O || (O = function(a, b) {\n    this.name = \"ErrnoError\";\n    this.node = b;\n    this.pc = function(c) {\n      this.aa = c;\n    };\n    this.pc(a);\n    this.message = \"FS error\";\n  }, O.prototype = Error(), O.prototype.constructor = O, [44].forEach(a => {\n    Bb[a] = new O(a);\n    Bb[a].stack = \"<generic error, no stack>\";\n  }));\n}, hc, jc = (a, b, c) => {\n  a = gb(\"/dev/\" + a);\n  var d = Db(!!b, !!c);\n  ic || (ic = 64);\n  var e = ic++ << 8 | 0;\n  ub(e, {open:f => {\n    f.seekable = !1;\n  }, close:() => {\n    c && c.buffer && c.buffer.length && c(10);\n  }, read:(f, g, n, p) => {\n    for (var l = 0, u = 0; u < p; u++) {\n      try {\n        var v = b();\n      } catch (x) {\n        throw new O(29);\n      }\n      if (void 0 === v && 0 === l) {\n        throw new O(6);\n      }\n      if (null === v || void 0 === v) {\n        break;\n      }\n      l++;\n      g[n + u] = v;\n    }\n    l && (f.node.timestamp = Date.now());\n    return l;\n  }, write:(f, g, n, p) => {\n    for (var l = 0; l < p; l++) {\n      try {\n        c(g[n + l]);\n      } catch (u) {\n        throw new O(29);\n      }\n    }\n    p && (f.node.timestamp = Date.now());\n    return l;\n  }});\n  Xb(a, d, e);\n}, ic, kc = {}, Ub, dc, lc = void 0;\nfunction mc() {\n  lc += 4;\n  return L[lc - 4 >> 2];\n}\nfunction nc(a) {\n  if (void 0 === a) {\n    return \"_unknown\";\n  }\n  a = a.replace(/[^a-zA-Z0-9_]/g, \"$\");\n  var b = a.charCodeAt(0);\n  return 48 <= b && 57 >= b ? `_${a}` : a;\n}\nfunction oc(a, b) {\n  a = nc(a);\n  return {[a]:function() {\n    return b.apply(this, arguments);\n  }}[a];\n}\nfunction pc() {\n  this.M = [void 0];\n  this.hb = [];\n}\nvar U = new pc(), qc = void 0;\nfunction V(a) {\n  throw new qc(a);\n}\nvar rc = a => {\n  a || V(\"Cannot use deleted val. handle = \" + a);\n  return U.get(a).value;\n}, sc = a => {\n  switch(a) {\n    case void 0:\n      return 1;\n    case null:\n      return 2;\n    case !0:\n      return 3;\n    case !1:\n      return 4;\n    default:\n      return U.pa({tb:1, value:a});\n  }\n};\nfunction tc(a) {\n  var b = Error, c = oc(a, function(d) {\n    this.name = a;\n    this.message = d;\n    d = Error(d).stack;\n    void 0 !== d && (this.stack = this.toString() + \"\\n\" + d.replace(/^Error(:[^\\n]*)?\\n/, \"\"));\n  });\n  c.prototype = Object.create(b.prototype);\n  c.prototype.constructor = c;\n  c.prototype.toString = function() {\n    return void 0 === this.message ? this.name : `${this.name}: ${this.message}`;\n  };\n  return c;\n}\nvar uc = void 0, vc = void 0;\nfunction W(a) {\n  for (var b = \"\"; E[a];) {\n    b += vc[E[a++]];\n  }\n  return b;\n}\nvar wc = [];\nfunction xc() {\n  for (; wc.length;) {\n    var a = wc.pop();\n    a.g.fa = !1;\n    a[\"delete\"]();\n  }\n}\nvar yc = void 0, zc = {};\nfunction Ac(a, b) {\n  for (void 0 === b && V(\"ptr should not be undefined\"); a.A;) {\n    b = a.na(b), a = a.A;\n  }\n  return b;\n}\nvar Bc = {};\nfunction Cc(a) {\n  a = Dc(a);\n  var b = W(a);\n  Ec(a);\n  return b;\n}\nfunction Fc(a, b) {\n  var c = Bc[a];\n  void 0 === c && V(b + \" has unknown type \" + Cc(a));\n  return c;\n}\nfunction Gc() {\n}\nvar Hc = !1;\nfunction Ic(a) {\n  --a.count.value;\n  0 === a.count.value && (a.G ? a.L.W(a.G) : a.u.i.W(a.o));\n}\nfunction Jc(a, b, c) {\n  if (b === c) {\n    return a;\n  }\n  if (void 0 === c.A) {\n    return null;\n  }\n  a = Jc(a, b, c.A);\n  return null === a ? null : c.Pb(a);\n}\nvar Kc = {};\nfunction Lc(a, b) {\n  b = Ac(a, b);\n  return zc[b];\n}\nvar Mc = void 0;\nfunction Nc(a) {\n  throw new Mc(a);\n}\nfunction Oc(a, b) {\n  b.u && b.o || Nc(\"makeClassHandle requires ptr and ptrType\");\n  !!b.L !== !!b.G && Nc(\"Both smartPtrType and smartPtr must be specified\");\n  b.count = {value:1};\n  return Pc(Object.create(a, {g:{value:b,},}));\n}\nfunction Pc(a) {\n  if (\"undefined\" === typeof FinalizationRegistry) {\n    return Pc = b => b, a;\n  }\n  Hc = new FinalizationRegistry(b => {\n    Ic(b.g);\n  });\n  Pc = b => {\n    var c = b.g;\n    c.G && Hc.register(b, {g:c}, b);\n    return b;\n  };\n  Gc = b => {\n    Hc.unregister(b);\n  };\n  return Pc(a);\n}\nvar Qc = {};\nfunction Rc(a) {\n  for (; a.length;) {\n    var b = a.pop();\n    a.pop()(b);\n  }\n}\nfunction Sc(a) {\n  return this.fromWireType(L[a >> 2]);\n}\nvar Tc = {}, Uc = {};\nfunction Y(a, b, c) {\n  function d(n) {\n    n = c(n);\n    n.length !== a.length && Nc(\"Mismatched type converter count\");\n    for (var p = 0; p < a.length; ++p) {\n      Vc(a[p], n[p]);\n    }\n  }\n  a.forEach(function(n) {\n    Uc[n] = b;\n  });\n  var e = Array(b.length), f = [], g = 0;\n  b.forEach((n, p) => {\n    Bc.hasOwnProperty(n) ? e[p] = Bc[n] : (f.push(n), Tc.hasOwnProperty(n) || (Tc[n] = []), Tc[n].push(() => {\n      e[p] = Bc[n];\n      ++g;\n      g === f.length && d(e);\n    }));\n  });\n  0 === f.length && d(e);\n}\nfunction Wc(a) {\n  switch(a) {\n    case 1:\n      return 0;\n    case 2:\n      return 1;\n    case 4:\n      return 2;\n    case 8:\n      return 3;\n    default:\n      throw new TypeError(`Unknown type size: ${a}`);\n  }\n}\nfunction Xc(a, b, c = {}) {\n  var d = b.name;\n  a || V(`type \"${d}\" must have a positive integer typeid pointer`);\n  if (Bc.hasOwnProperty(a)) {\n    if (c.$b) {\n      return;\n    }\n    V(`Cannot register type '${d}' twice`);\n  }\n  Bc[a] = b;\n  delete Uc[a];\n  Tc.hasOwnProperty(a) && (b = Tc[a], delete Tc[a], b.forEach(e => e()));\n}\nfunction Vc(a, b, c = {}) {\n  if (!(\"argPackAdvance\" in b)) {\n    throw new TypeError(\"registerType registeredInstance requires argPackAdvance\");\n  }\n  Xc(a, b, c);\n}\nfunction Yc(a) {\n  V(a.g.u.i.name + \" instance already deleted\");\n}\nfunction Zc() {\n}\nfunction $c(a, b, c) {\n  if (void 0 === a[b].B) {\n    var d = a[b];\n    a[b] = function() {\n      a[b].B.hasOwnProperty(arguments.length) || V(`Function '${c}' called with an invalid number of arguments (${arguments.length}) - expects one of (${a[b].B})!`);\n      return a[b].B[arguments.length].apply(this, arguments);\n    };\n    a[b].B = [];\n    a[b].B[d.ea] = d;\n  }\n}\nfunction ad(a, b, c) {\n  m.hasOwnProperty(a) ? ((void 0 === c || void 0 !== m[a].B && void 0 !== m[a].B[c]) && V(`Cannot register public name '${a}' twice`), $c(m, a, a), m.hasOwnProperty(c) && V(`Cannot register multiple overloads of a function with the same number of arguments (${c})!`), m[a].B[c] = b) : (m[a] = b, void 0 !== c && (m[a].Pc = c));\n}\nfunction bd(a, b, c, d, e, f, g, n) {\n  this.name = a;\n  this.constructor = b;\n  this.N = c;\n  this.W = d;\n  this.A = e;\n  this.Ub = f;\n  this.na = g;\n  this.Pb = n;\n  this.qb = [];\n}\nfunction cd(a, b, c) {\n  for (; b !== c;) {\n    b.na || V(`Expected null or instance of ${c.name}, got an instance of ${b.name}`), a = b.na(a), b = b.A;\n  }\n  return a;\n}\nfunction dd(a, b) {\n  if (null === b) {\n    return this.Na && V(`null is not a valid ${this.name}`), 0;\n  }\n  b.g || V(`Cannot pass \"${ed(b)}\" as a ${this.name}`);\n  b.g.o || V(`Cannot pass deleted object as a pointer of type ${this.name}`);\n  return cd(b.g.o, b.g.u.i, this.i);\n}\nfunction fd(a, b) {\n  if (null === b) {\n    this.Na && V(`null is not a valid ${this.name}`);\n    if (this.ua) {\n      var c = this.Pa();\n      null !== a && a.push(this.W, c);\n      return c;\n    }\n    return 0;\n  }\n  b.g || V(`Cannot pass \"${ed(b)}\" as a ${this.name}`);\n  b.g.o || V(`Cannot pass deleted object as a pointer of type ${this.name}`);\n  !this.ta && b.g.u.ta && V(`Cannot convert argument of type ${b.g.L ? b.g.L.name : b.g.u.name} to parameter type ${this.name}`);\n  c = cd(b.g.o, b.g.u.i, this.i);\n  if (this.ua) {\n    switch(void 0 === b.g.G && V(\"Passing raw pointer to smart pointer is illegal\"), this.tc) {\n      case 0:\n        b.g.L === this ? c = b.g.G : V(`Cannot convert argument of type ${b.g.L ? b.g.L.name : b.g.u.name} to parameter type ${this.name}`);\n        break;\n      case 1:\n        c = b.g.G;\n        break;\n      case 2:\n        if (b.g.L === this) {\n          c = b.g.G;\n        } else {\n          var d = b.clone();\n          c = this.oc(c, sc(function() {\n            d[\"delete\"]();\n          }));\n          null !== a && a.push(this.W, c);\n        }\n        break;\n      default:\n        V(\"Unsupporting sharing policy\");\n    }\n  }\n  return c;\n}\nfunction gd(a, b) {\n  if (null === b) {\n    return this.Na && V(`null is not a valid ${this.name}`), 0;\n  }\n  b.g || V(`Cannot pass \"${ed(b)}\" as a ${this.name}`);\n  b.g.o || V(`Cannot pass deleted object as a pointer of type ${this.name}`);\n  b.g.u.ta && V(`Cannot convert argument of type ${b.g.u.name} to parameter type ${this.name}`);\n  return cd(b.g.o, b.g.u.i, this.i);\n}\nfunction hd(a, b, c, d) {\n  this.name = a;\n  this.i = b;\n  this.Na = c;\n  this.ta = d;\n  this.ua = !1;\n  this.W = this.oc = this.Pa = this.rb = this.tc = this.nc = void 0;\n  void 0 !== b.A ? this.toWireType = fd : (this.toWireType = d ? dd : gd, this.K = null);\n}\nfunction jd(a, b, c) {\n  m.hasOwnProperty(a) || Nc(\"Replacing nonexistant public symbol\");\n  void 0 !== m[a].B && void 0 !== c ? m[a].B[c] = b : (m[a] = b, m[a].ea = c);\n}\nvar kd = [], ld = a => {\n  var b = kd[a];\n  b || (a >= kd.length && (kd.length = a + 1), kd[a] = b = Ka.get(a));\n  return b;\n}, md = (a, b) => {\n  var c = [];\n  return function() {\n    c.length = 0;\n    Object.assign(c, arguments);\n    if (a.includes(\"j\")) {\n      var d = m[\"dynCall_\" + a];\n      d = c && c.length ? d.apply(null, [b].concat(c)) : d.call(null, b);\n    } else {\n      d = ld(b).apply(null, c);\n    }\n    return d;\n  };\n};\nfunction Z(a, b) {\n  a = W(a);\n  var c = a.includes(\"j\") ? md(a, b) : ld(b);\n  \"function\" != typeof c && V(`unknown function pointer with signature ${a}: ${b}`);\n  return c;\n}\nvar nd = void 0;\nfunction od(a, b) {\n  function c(f) {\n    e[f] || Bc[f] || (Uc[f] ? Uc[f].forEach(c) : (d.push(f), e[f] = !0));\n  }\n  var d = [], e = {};\n  b.forEach(c);\n  throw new nd(`${a}: ` + d.map(Cc).join([\", \"]));\n}\nfunction pd(a, b, c, d, e) {\n  var f = b.length;\n  2 > f && V(\"argTypes array size mismatch! Must at least get return value and 'this' types!\");\n  var g = null !== b[1] && null !== c, n = !1;\n  for (c = 1; c < b.length; ++c) {\n    if (null !== b[c] && void 0 === b[c].K) {\n      n = !0;\n      break;\n    }\n  }\n  var p = \"void\" !== b[0].name, l = f - 2, u = Array(l), v = [], x = [];\n  return function() {\n    arguments.length !== l && V(`function ${a} called with ${arguments.length} arguments, expected ${l} args!`);\n    x.length = 0;\n    v.length = g ? 2 : 1;\n    v[0] = e;\n    if (g) {\n      var k = b[1].toWireType(x, this);\n      v[1] = k;\n    }\n    for (var t = 0; t < l; ++t) {\n      u[t] = b[t + 2].toWireType(x, arguments[t]), v.push(u[t]);\n    }\n    t = d.apply(null, v);\n    if (n) {\n      Rc(x);\n    } else {\n      for (var r = g ? 1 : 2; r < b.length; r++) {\n        var A = 1 === r ? k : u[r - 2];\n        null !== b[r].K && b[r].K(A);\n      }\n    }\n    k = p ? b[0].fromWireType(t) : void 0;\n    return k;\n  };\n}\nfunction rd(a, b) {\n  for (var c = [], d = 0; d < a; d++) {\n    c.push(N[b + 4 * d >> 2]);\n  }\n  return c;\n}\nfunction sd(a, b, c) {\n  a instanceof Object || V(`${c} with invalid \"this\": ${a}`);\n  a instanceof b.i.constructor || V(`${c} incompatible with \"this\" of type ${a.constructor.name}`);\n  a.g.o || V(`cannot call emscripten binding method ${c} on deleted object`);\n  return cd(a.g.o, a.g.u.i, b.i);\n}\nfunction td(a) {\n  a >= U.h && 0 === --U.get(a).tb && U.Zb(a);\n}\nfunction ud(a, b, c) {\n  switch(b) {\n    case 0:\n      return function(d) {\n        return this.fromWireType((c ? B : E)[d]);\n      };\n    case 1:\n      return function(d) {\n        return this.fromWireType((c ? Da : Ea)[d >> 1]);\n      };\n    case 2:\n      return function(d) {\n        return this.fromWireType((c ? L : N)[d >> 2]);\n      };\n    default:\n      throw new TypeError(\"Unknown integer type: \" + a);\n  }\n}\nfunction ed(a) {\n  if (null === a) {\n    return \"null\";\n  }\n  var b = typeof a;\n  return \"object\" === b || \"array\" === b || \"function\" === b ? a.toString() : \"\" + a;\n}\nfunction vd(a, b) {\n  switch(b) {\n    case 2:\n      return function(c) {\n        return this.fromWireType(Fa[c >> 2]);\n      };\n    case 3:\n      return function(c) {\n        return this.fromWireType(Ia[c >> 3]);\n      };\n    default:\n      throw new TypeError(\"Unknown float type: \" + a);\n  }\n}\nfunction wd(a, b, c) {\n  switch(b) {\n    case 0:\n      return c ? function(d) {\n        return B[d];\n      } : function(d) {\n        return E[d];\n      };\n    case 1:\n      return c ? function(d) {\n        return Da[d >> 1];\n      } : function(d) {\n        return Ea[d >> 1];\n      };\n    case 2:\n      return c ? function(d) {\n        return L[d >> 2];\n      } : function(d) {\n        return N[d >> 2];\n      };\n    default:\n      throw new TypeError(\"Unknown integer type: \" + a);\n  }\n}\nvar xd = \"undefined\" != typeof TextDecoder ? new TextDecoder(\"utf-16le\") : void 0, yd = (a, b) => {\n  var c = a >> 1;\n  for (var d = c + b / 2; !(c >= d) && Ea[c];) {\n    ++c;\n  }\n  c <<= 1;\n  if (32 < c - a && xd) {\n    return xd.decode(E.subarray(a, c));\n  }\n  c = \"\";\n  for (d = 0; !(d >= b / 2); ++d) {\n    var e = Da[a + 2 * d >> 1];\n    if (0 == e) {\n      break;\n    }\n    c += String.fromCharCode(e);\n  }\n  return c;\n}, zd = (a, b, c) => {\n  void 0 === c && (c = 2147483647);\n  if (2 > c) {\n    return 0;\n  }\n  c -= 2;\n  var d = b;\n  c = c < 2 * a.length ? c / 2 : a.length;\n  for (var e = 0; e < c; ++e) {\n    Da[b >> 1] = a.charCodeAt(e), b += 2;\n  }\n  Da[b >> 1] = 0;\n  return b - d;\n}, Ad = a => 2 * a.length, Bd = (a, b) => {\n  for (var c = 0, d = \"\"; !(c >= b / 4);) {\n    var e = L[a + 4 * c >> 2];\n    if (0 == e) {\n      break;\n    }\n    ++c;\n    65536 <= e ? (e -= 65536, d += String.fromCharCode(55296 | e >> 10, 56320 | e & 1023)) : d += String.fromCharCode(e);\n  }\n  return d;\n}, Cd = (a, b, c) => {\n  void 0 === c && (c = 2147483647);\n  if (4 > c) {\n    return 0;\n  }\n  var d = b;\n  c = d + c - 4;\n  for (var e = 0; e < a.length; ++e) {\n    var f = a.charCodeAt(e);\n    if (55296 <= f && 57343 >= f) {\n      var g = a.charCodeAt(++e);\n      f = 65536 + ((f & 1023) << 10) | g & 1023;\n    }\n    L[b >> 2] = f;\n    b += 4;\n    if (b + 4 > c) {\n      break;\n    }\n  }\n  L[b >> 2] = 0;\n  return b - d;\n}, Dd = a => {\n  for (var b = 0, c = 0; c < a.length; ++c) {\n    var d = a.charCodeAt(c);\n    55296 <= d && 57343 >= d && ++c;\n    b += 4;\n  }\n  return b;\n}, Ed = {};\nfunction Fd(a) {\n  var b = Ed[a];\n  return void 0 === b ? W(a) : b;\n}\nvar Gd = [];\nfunction Hd(a) {\n  var b = Gd.length;\n  Gd.push(a);\n  return b;\n}\nfunction Id(a, b) {\n  for (var c = Array(a), d = 0; d < a; ++d) {\n    c[d] = Fc(N[b + 4 * d >> 2], \"parameter \" + d);\n  }\n  return c;\n}\nvar Jd = [], Kd = [], Ld = {}, Nd = () => {\n  if (!Md) {\n    var a = {USER:\"web_user\", LOGNAME:\"web_user\", PATH:\"/\", PWD:\"/\", HOME:\"/home/web_user\", LANG:(\"object\" == typeof navigator && navigator.languages && navigator.languages[0] || \"C\").replace(\"-\", \"_\") + \".UTF-8\", _:na || \"./this.program\"}, b;\n    for (b in Ld) {\n      void 0 === Ld[b] ? delete a[b] : a[b] = Ld[b];\n    }\n    var c = [];\n    for (b in a) {\n      c.push(`${b}=${a[b]}`);\n    }\n    Md = c;\n  }\n  return Md;\n}, Md, Od = a => 0 === a % 4 && (0 !== a % 100 || 0 === a % 400), Pd = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31], Qd = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31], Rd = (a, b, c, d) => {\n  function e(k, t, r) {\n    for (k = \"number\" == typeof k ? k.toString() : k || \"\"; k.length < t;) {\n      k = r[0] + k;\n    }\n    return k;\n  }\n  function f(k, t) {\n    return e(k, t, \"0\");\n  }\n  function g(k, t) {\n    function r(D) {\n      return 0 > D ? -1 : 0 < D ? 1 : 0;\n    }\n    var A;\n    0 === (A = r(k.getFullYear() - t.getFullYear())) && 0 === (A = r(k.getMonth() - t.getMonth())) && (A = r(k.getDate() - t.getDate()));\n    return A;\n  }\n  function n(k) {\n    switch(k.getDay()) {\n      case 0:\n        return new Date(k.getFullYear() - 1, 11, 29);\n      case 1:\n        return k;\n      case 2:\n        return new Date(k.getFullYear(), 0, 3);\n      case 3:\n        return new Date(k.getFullYear(), 0, 2);\n      case 4:\n        return new Date(k.getFullYear(), 0, 1);\n      case 5:\n        return new Date(k.getFullYear() - 1, 11, 31);\n      case 6:\n        return new Date(k.getFullYear() - 1, 11, 30);\n    }\n  }\n  function p(k) {\n    var t = k.ca;\n    for (k = new Date((new Date(k.da + 1900, 0, 1)).getTime()); 0 < t;) {\n      var r = k.getMonth(), A = (Od(k.getFullYear()) ? Pd : Qd)[r];\n      if (t > A - k.getDate()) {\n        t -= A - k.getDate() + 1, k.setDate(1), 11 > r ? k.setMonth(r + 1) : (k.setMonth(0), k.setFullYear(k.getFullYear() + 1));\n      } else {\n        k.setDate(k.getDate() + t);\n        break;\n      }\n    }\n    r = new Date(k.getFullYear() + 1, 0, 4);\n    t = n(new Date(k.getFullYear(), 0, 4));\n    r = n(r);\n    return 0 >= g(t, k) ? 0 >= g(r, k) ? k.getFullYear() + 1 : k.getFullYear() : k.getFullYear() - 1;\n  }\n  var l = L[d + 40 >> 2];\n  d = {wc:L[d >> 2], vc:L[d + 4 >> 2], Fa:L[d + 8 >> 2], Sa:L[d + 12 >> 2], Ga:L[d + 16 >> 2], da:L[d + 20 >> 2], R:L[d + 24 >> 2], ca:L[d + 28 >> 2], Rc:L[d + 32 >> 2], uc:L[d + 36 >> 2], xc:l ? l ? nb(E, l) : \"\" : \"\"};\n  c = c ? nb(E, c) : \"\";\n  l = {\"%c\":\"%a %b %d %H:%M:%S %Y\", \"%D\":\"%m/%d/%y\", \"%F\":\"%Y-%m-%d\", \"%h\":\"%b\", \"%r\":\"%I:%M:%S %p\", \"%R\":\"%H:%M\", \"%T\":\"%H:%M:%S\", \"%x\":\"%m/%d/%y\", \"%X\":\"%H:%M:%S\", \"%Ec\":\"%c\", \"%EC\":\"%C\", \"%Ex\":\"%m/%d/%y\", \"%EX\":\"%H:%M:%S\", \"%Ey\":\"%y\", \"%EY\":\"%Y\", \"%Od\":\"%d\", \"%Oe\":\"%e\", \"%OH\":\"%H\", \"%OI\":\"%I\", \"%Om\":\"%m\", \"%OM\":\"%M\", \"%OS\":\"%S\", \"%Ou\":\"%u\", \"%OU\":\"%U\", \"%OV\":\"%V\", \"%Ow\":\"%w\", \"%OW\":\"%W\", \"%Oy\":\"%y\",};\n  for (var u in l) {\n    c = c.replace(new RegExp(u, \"g\"), l[u]);\n  }\n  var v = \"Sunday Monday Tuesday Wednesday Thursday Friday Saturday\".split(\" \"), x = \"January February March April May June July August September October November December\".split(\" \");\n  l = {\"%a\":k => v[k.R].substring(0, 3), \"%A\":k => v[k.R], \"%b\":k => x[k.Ga].substring(0, 3), \"%B\":k => x[k.Ga], \"%C\":k => f((k.da + 1900) / 100 | 0, 2), \"%d\":k => f(k.Sa, 2), \"%e\":k => e(k.Sa, 2, \" \"), \"%g\":k => p(k).toString().substring(2), \"%G\":k => p(k), \"%H\":k => f(k.Fa, 2), \"%I\":k => {\n    k = k.Fa;\n    0 == k ? k = 12 : 12 < k && (k -= 12);\n    return f(k, 2);\n  }, \"%j\":k => {\n    for (var t = 0, r = 0; r <= k.Ga - 1; t += (Od(k.da + 1900) ? Pd : Qd)[r++]) {\n    }\n    return f(k.Sa + t, 3);\n  }, \"%m\":k => f(k.Ga + 1, 2), \"%M\":k => f(k.vc, 2), \"%n\":() => \"\\n\", \"%p\":k => 0 <= k.Fa && 12 > k.Fa ? \"AM\" : \"PM\", \"%S\":k => f(k.wc, 2), \"%t\":() => \"\\t\", \"%u\":k => k.R || 7, \"%U\":k => f(Math.floor((k.ca + 7 - k.R) / 7), 2), \"%V\":k => {\n    var t = Math.floor((k.ca + 7 - (k.R + 6) % 7) / 7);\n    2 >= (k.R + 371 - k.ca - 2) % 7 && t++;\n    if (t) {\n      53 == t && (r = (k.R + 371 - k.ca) % 7, 4 == r || 3 == r && Od(k.da) || (t = 1));\n    } else {\n      t = 52;\n      var r = (k.R + 7 - k.ca - 1) % 7;\n      (4 == r || 5 == r && Od(k.da % 400 - 1)) && t++;\n    }\n    return f(t, 2);\n  }, \"%w\":k => k.R, \"%W\":k => f(Math.floor((k.ca + 7 - (k.R + 6) % 7) / 7), 2), \"%y\":k => (k.da + 1900).toString().substring(2), \"%Y\":k => k.da + 1900, \"%z\":k => {\n    k = k.uc;\n    var t = 0 <= k;\n    k = Math.abs(k) / 60;\n    return (t ? \"+\" : \"-\") + String(\"0000\" + (k / 60 * 100 + k % 60)).slice(-4);\n  }, \"%Z\":k => k.xc, \"%%\":() => \"%\"};\n  c = c.replace(/%%/g, \"\\x00\\x00\");\n  for (u in l) {\n    c.includes(u) && (c = c.replace(new RegExp(u, \"g\"), l[u](d)));\n  }\n  c = c.replace(/\\0\\0/g, \"%\");\n  u = rb(c, !1);\n  if (u.length > b) {\n    return 0;\n  }\n  B.set(u, a);\n  return u.length - 1;\n};\nfunction Pb(a, b, c, d) {\n  a || (a = this);\n  this.parent = a;\n  this.U = a.U;\n  this.wa = null;\n  this.id = Hb++;\n  this.name = b;\n  this.mode = c;\n  this.l = {};\n  this.m = {};\n  this.za = d;\n}\nObject.defineProperties(Pb.prototype, {read:{get:function() {\n  return 365 === (this.mode & 365);\n}, set:function(a) {\n  a ? this.mode |= 365 : this.mode &= -366;\n}}, write:{get:function() {\n  return 146 === (this.mode & 146);\n}, set:function(a) {\n  a ? this.mode |= 146 : this.mode &= -147;\n}}});\ngc();\nIb = Array(4096);\nWb(P, \"/\");\nS(\"/tmp\", 16895, 0);\nS(\"/home\", 16895, 0);\nS(\"/home/web_user\", 16895, 0);\n(() => {\n  S(\"/dev\", 16895, 0);\n  ub(259, {read:() => 0, write:(d, e, f, g) => g,});\n  Xb(\"/dev/null\", 259);\n  tb(1280, wb);\n  tb(1536, xb);\n  Xb(\"/dev/tty\", 1280);\n  Xb(\"/dev/tty1\", 1536);\n  var a = new Uint8Array(1024), b = 0, c = () => {\n    0 === b && (b = kb(a).byteLength);\n    return a[--b];\n  };\n  jc(\"random\", c);\n  jc(\"urandom\", c);\n  S(\"/dev/shm\", 16895, 0);\n  S(\"/dev/shm/tmp\", 16895, 0);\n})();\n(() => {\n  S(\"/proc\", 16895, 0);\n  var a = S(\"/proc/self\", 16895, 0);\n  S(\"/proc/self/fd\", 16895, 0);\n  Wb({U:() => {\n    var b = Ab(a, \"fd\", 16895, 73);\n    b.l = {ka:(c, d) => {\n      var e = Tb(+d);\n      c = {parent:null, U:{mb:\"fake\"}, l:{ma:() => e.path},};\n      return c.parent = c;\n    }};\n    return b;\n  }}, \"/proc/self/fd\");\n})();\nObject.assign(pc.prototype, {get(a) {\n  return this.M[a];\n}, has(a) {\n  return void 0 !== this.M[a];\n}, pa(a) {\n  var b = this.hb.pop() || this.M.length;\n  this.M[b] = a;\n  return b;\n}, Zb(a) {\n  this.M[a] = void 0;\n  this.hb.push(a);\n}});\nqc = m.BindingError = class extends Error {\n  constructor(a) {\n    super(a);\n    this.name = \"BindingError\";\n  }\n};\nU.M.push({value:void 0}, {value:null}, {value:!0}, {value:!1},);\nU.h = U.M.length;\nm.count_emval_handles = function() {\n  for (var a = 0, b = U.h; b < U.M.length; ++b) {\n    void 0 !== U.M[b] && ++a;\n  }\n  return a;\n};\nuc = m.PureVirtualError = tc(\"PureVirtualError\");\nfor (var Sd = Array(256), Td = 0; 256 > Td; ++Td) {\n  Sd[Td] = String.fromCharCode(Td);\n}\nvc = Sd;\nm.getInheritedInstanceCount = function() {\n  return Object.keys(zc).length;\n};\nm.getLiveInheritedInstances = function() {\n  var a = [], b;\n  for (b in zc) {\n    zc.hasOwnProperty(b) && a.push(zc[b]);\n  }\n  return a;\n};\nm.flushPendingDeletes = xc;\nm.setDelayFunction = function(a) {\n  yc = a;\n  wc.length && yc && yc(xc);\n};\nMc = m.InternalError = class extends Error {\n  constructor(a) {\n    super(a);\n    this.name = \"InternalError\";\n  }\n};\nZc.prototype.isAliasOf = function(a) {\n  if (!(this instanceof Zc && a instanceof Zc)) {\n    return !1;\n  }\n  var b = this.g.u.i, c = this.g.o, d = a.g.u.i;\n  for (a = a.g.o; b.A;) {\n    c = b.na(c), b = b.A;\n  }\n  for (; d.A;) {\n    a = d.na(a), d = d.A;\n  }\n  return b === d && c === a;\n};\nZc.prototype.clone = function() {\n  this.g.o || Yc(this);\n  if (this.g.ia) {\n    return this.g.count.value += 1, this;\n  }\n  var a = Pc, b = Object, c = b.create, d = Object.getPrototypeOf(this), e = this.g;\n  a = a(c.call(b, d, {g:{value:{count:e.count, fa:e.fa, ia:e.ia, o:e.o, u:e.u, G:e.G, L:e.L,},}}));\n  a.g.count.value += 1;\n  a.g.fa = !1;\n  return a;\n};\nZc.prototype[\"delete\"] = function() {\n  this.g.o || Yc(this);\n  this.g.fa && !this.g.ia && V(\"Object already scheduled for deletion\");\n  Gc(this);\n  Ic(this.g);\n  this.g.ia || (this.g.G = void 0, this.g.o = void 0);\n};\nZc.prototype.isDeleted = function() {\n  return !this.g.o;\n};\nZc.prototype.deleteLater = function() {\n  this.g.o || Yc(this);\n  this.g.fa && !this.g.ia && V(\"Object already scheduled for deletion\");\n  wc.push(this);\n  1 === wc.length && yc && yc(xc);\n  this.g.fa = !0;\n  return this;\n};\nhd.prototype.Vb = function(a) {\n  this.rb && (a = this.rb(a));\n  return a;\n};\nhd.prototype.ab = function(a) {\n  this.W && this.W(a);\n};\nhd.prototype.argPackAdvance = 8;\nhd.prototype.readValueFromPointer = Sc;\nhd.prototype.deleteObject = function(a) {\n  if (null !== a) {\n    a[\"delete\"]();\n  }\n};\nhd.prototype.fromWireType = function(a) {\n  function b() {\n    return this.ua ? Oc(this.i.N, {u:this.nc, o:c, L:this, G:a,}) : Oc(this.i.N, {u:this, o:a,});\n  }\n  var c = this.Vb(a);\n  if (!c) {\n    return this.ab(a), null;\n  }\n  var d = Lc(this.i, c);\n  if (void 0 !== d) {\n    if (0 === d.g.count.value) {\n      return d.g.o = c, d.g.G = a, d.clone();\n    }\n    d = d.clone();\n    this.ab(a);\n    return d;\n  }\n  d = this.i.Ub(c);\n  d = Kc[d];\n  if (!d) {\n    return b.call(this);\n  }\n  d = this.ta ? d.Kb : d.pointerType;\n  var e = Jc(c, this.i, d.i);\n  return null === e ? b.call(this) : this.ua ? Oc(d.i.N, {u:d, o:e, L:this, G:a,}) : Oc(d.i.N, {u:d, o:e,});\n};\nnd = m.UnboundTypeError = tc(\"UnboundTypeError\");\nvar Wd = {__syscall_fcntl64:function(a, b, c) {\n  lc = c;\n  try {\n    var d = Tb(a);\n    switch(b) {\n      case 0:\n        var e = mc();\n        return 0 > e ? -28 : Vb(d, e).X;\n      case 1:\n      case 2:\n        return 0;\n      case 3:\n        return d.flags;\n      case 4:\n        return e = mc(), d.flags |= e, 0;\n      case 5:\n        return e = mc(), Da[e + 0 >> 1] = 2, 0;\n      case 6:\n      case 7:\n        return 0;\n      case 16:\n      case 8:\n        return -28;\n      case 9:\n        return L[Ud() >> 2] = 28, -1;\n      default:\n        return -28;\n    }\n  } catch (f) {\n    if (\"undefined\" == typeof kc || \"ErrnoError\" !== f.name) {\n      throw f;\n    }\n    return -f.aa;\n  }\n}, __syscall_ioctl:function(a, b, c) {\n  lc = c;\n  try {\n    var d = Tb(a);\n    switch(b) {\n      case 21509:\n        return d.s ? 0 : -59;\n      case 21505:\n        if (!d.s) {\n          return -59;\n        }\n        if (d.s.V.bc) {\n          b = [3, 28, 127, 21, 4, 0, 1, 0, 17, 19, 26, 0, 18, 15, 23, 22, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,];\n          var e = mc();\n          L[e >> 2] = 25856;\n          L[e + 4 >> 2] = 5;\n          L[e + 8 >> 2] = 191;\n          L[e + 12 >> 2] = 35387;\n          for (var f = 0; 32 > f; f++) {\n            B[e + f + 17 >> 0] = b[f] || 0;\n          }\n        }\n        return 0;\n      case 21510:\n      case 21511:\n      case 21512:\n        return d.s ? 0 : -59;\n      case 21506:\n      case 21507:\n      case 21508:\n        if (!d.s) {\n          return -59;\n        }\n        if (d.s.V.cc) {\n          for (e = mc(), b = [], f = 0; 32 > f; f++) {\n            b.push(B[e + f + 17 >> 0]);\n          }\n        }\n        return 0;\n      case 21519:\n        if (!d.s) {\n          return -59;\n        }\n        e = mc();\n        return L[e >> 2] = 0;\n      case 21520:\n        return d.s ? -28 : -59;\n      case 21531:\n        e = mc();\n        if (!d.m.ac) {\n          throw new O(59);\n        }\n        return d.m.ac(d, b, e);\n      case 21523:\n        if (!d.s) {\n          return -59;\n        }\n        d.s.V.dc && (f = [24, 80], e = mc(), Da[e >> 1] = f[0], Da[e + 2 >> 1] = f[1]);\n        return 0;\n      case 21524:\n        return d.s ? 0 : -59;\n      case 21515:\n        return d.s ? 0 : -59;\n      default:\n        return -28;\n    }\n  } catch (g) {\n    if (\"undefined\" == typeof kc || \"ErrnoError\" !== g.name) {\n      throw g;\n    }\n    return -g.aa;\n  }\n}, __syscall_openat:function(a, b, c, d) {\n  lc = d;\n  try {\n    b = b ? nb(E, b) : \"\";\n    var e = b;\n    if (\"/\" === e.charAt(0)) {\n      b = e;\n    } else {\n      var f = -100 === a ? \"/\" : Tb(a).path;\n      if (0 == e.length) {\n        throw new O(44);\n      }\n      b = gb(f + \"/\" + e);\n    }\n    var g = d ? mc() : 0;\n    return ec(b, c, g).X;\n  } catch (n) {\n    if (\"undefined\" == typeof kc || \"ErrnoError\" !== n.name) {\n      throw n;\n    }\n    return -n.aa;\n  }\n}, _embind_create_inheriting_constructor:function(a, b, c) {\n  a = W(a);\n  b = Fc(b, \"wrapper\");\n  c = rc(c);\n  var d = [].slice, e = b.i, f = e.N, g = e.A.N, n = e.A.constructor;\n  a = oc(a, function() {\n    e.A.qb.forEach(function(l) {\n      if (this[l] === g[l]) {\n        throw new uc(`Pure virtual function ${l} must be implemented in JavaScript`);\n      }\n    }.bind(this));\n    Object.defineProperty(this, \"__parent\", {value:f});\n    this.__construct.apply(this, d.call(arguments));\n  });\n  f.__construct = function() {\n    this === f && V(\"Pass correct 'this' to __construct\");\n    var l = n.implement.apply(void 0, [this].concat(d.call(arguments)));\n    Gc(l);\n    var u = l.g;\n    l.notifyOnDestruction();\n    u.ia = !0;\n    Object.defineProperties(this, {g:{value:u}});\n    Pc(this);\n    l = u.o;\n    l = Ac(e, l);\n    zc.hasOwnProperty(l) ? V(`Tried to register registered instance: ${l}`) : zc[l] = this;\n  };\n  f.__destruct = function() {\n    this === f && V(\"Pass correct 'this' to __destruct\");\n    Gc(this);\n    var l = this.g.o;\n    l = Ac(e, l);\n    zc.hasOwnProperty(l) ? delete zc[l] : V(`Tried to unregister unregistered instance: ${l}`);\n  };\n  a.prototype = Object.create(f);\n  for (var p in c) {\n    a.prototype[p] = c[p];\n  }\n  return sc(a);\n}, _embind_finalize_value_object:function(a) {\n  var b = Qc[a];\n  delete Qc[a];\n  var c = b.Pa, d = b.W, e = b.eb, f = e.map(g => g.Yb).concat(e.map(g => g.rc));\n  Y([a], f, g => {\n    var n = {};\n    e.forEach((p, l) => {\n      var u = g[l], v = p.Wb, x = p.Xb, k = g[l + e.length], t = p.qc, r = p.sc;\n      n[p.Sb] = {read:A => u.fromWireType(v(x, A)), write:(A, D) => {\n        var w = [];\n        t(r, A, k.toWireType(w, D));\n        Rc(w);\n      }};\n    });\n    return [{name:b.name, fromWireType:function(p) {\n      var l = {}, u;\n      for (u in n) {\n        l[u] = n[u].read(p);\n      }\n      d(p);\n      return l;\n    }, toWireType:function(p, l) {\n      for (var u in n) {\n        if (!(u in l)) {\n          throw new TypeError(`Missing field: \"${u}\"`);\n        }\n      }\n      var v = c();\n      for (u in n) {\n        n[u].write(v, l[u]);\n      }\n      null !== p && p.push(d, v);\n      return v;\n    }, argPackAdvance:8, readValueFromPointer:Sc, K:d,}];\n  });\n}, _embind_register_bigint:function() {\n}, _embind_register_bool:function(a, b, c, d, e) {\n  var f = Wc(c);\n  b = W(b);\n  Vc(a, {name:b, fromWireType:function(g) {\n    return !!g;\n  }, toWireType:function(g, n) {\n    return n ? d : e;\n  }, argPackAdvance:8, readValueFromPointer:function(g) {\n    if (1 === c) {\n      var n = B;\n    } else if (2 === c) {\n      n = Da;\n    } else if (4 === c) {\n      n = L;\n    } else {\n      throw new TypeError(\"Unknown boolean type size: \" + b);\n    }\n    return this.fromWireType(n[g >> f]);\n  }, K:null,});\n}, _embind_register_class:function(a, b, c, d, e, f, g, n, p, l, u, v, x) {\n  u = W(u);\n  f = Z(e, f);\n  n && (n = Z(g, n));\n  l && (l = Z(p, l));\n  x = Z(v, x);\n  var k = nc(u);\n  ad(k, function() {\n    od(`Cannot construct ${u} due to unbound types`, [d]);\n  });\n  Y([a, b, c], d ? [d] : [], function(t) {\n    t = t[0];\n    if (d) {\n      var r = t.i;\n      var A = r.N;\n    } else {\n      A = Zc.prototype;\n    }\n    t = oc(k, function() {\n      if (Object.getPrototypeOf(this) !== D) {\n        throw new qc(\"Use 'new' to construct \" + u);\n      }\n      if (void 0 === w.$) {\n        throw new qc(u + \" has no accessible constructor\");\n      }\n      var T = w.$[arguments.length];\n      if (void 0 === T) {\n        throw new qc(`Tried to invoke ctor of ${u} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(w.$).toString()}) parameters instead!`);\n      }\n      return T.apply(this, arguments);\n    });\n    var D = Object.create(A, {constructor:{value:t},});\n    t.prototype = D;\n    var w = new bd(u, t, D, x, r, f, n, l);\n    w.A && (void 0 === w.A.oa && (w.A.oa = []), w.A.oa.push(w));\n    r = new hd(u, w, !0, !1);\n    A = new hd(u + \"*\", w, !1, !1);\n    var M = new hd(u + \" const*\", w, !1, !0);\n    Kc[a] = {pointerType:A, Kb:M};\n    jd(k, t);\n    return [r, A, M];\n  });\n}, _embind_register_class_class_function:function(a, b, c, d, e, f, g) {\n  var n = rd(c, d);\n  b = W(b);\n  f = Z(e, f);\n  Y([], [a], function(p) {\n    function l() {\n      od(`Cannot call ${u} due to unbound types`, n);\n    }\n    p = p[0];\n    var u = `${p.name}.${b}`;\n    b.startsWith(\"@@\") && (b = Symbol[b.substring(2)]);\n    var v = p.i.constructor;\n    void 0 === v[b] ? (l.ea = c - 1, v[b] = l) : ($c(v, b, u), v[b].B[c - 1] = l);\n    Y([], n, function(x) {\n      x = pd(u, [x[0], null].concat(x.slice(1)), null, f, g);\n      void 0 === v[b].B ? (x.ea = c - 1, v[b] = x) : v[b].B[c - 1] = x;\n      if (p.i.oa) {\n        for (const k of p.i.oa) {\n          k.constructor.hasOwnProperty(b) || (k.constructor[b] = x);\n        }\n      }\n      return [];\n    });\n    return [];\n  });\n}, _embind_register_class_class_property:function(a, b, c, d, e, f, g, n) {\n  b = W(b);\n  f = Z(e, f);\n  Y([], [a], function(p) {\n    p = p[0];\n    var l = `${p.name}.${b}`, u = {get() {\n      od(`Cannot access ${l} due to unbound types`, [c]);\n    }, enumerable:!0, configurable:!0};\n    u.set = n ? () => {\n      od(`Cannot access ${l} due to unbound types`, [c]);\n    } : () => {\n      V(`${l} is a read-only property`);\n    };\n    Object.defineProperty(p.i.constructor, b, u);\n    Y([], [c], function(v) {\n      v = v[0];\n      var x = {get() {\n        return v.fromWireType(f(d));\n      }, enumerable:!0};\n      n && (n = Z(g, n), x.set = k => {\n        var t = [];\n        n(d, v.toWireType(t, k));\n        Rc(t);\n      });\n      Object.defineProperty(p.i.constructor, b, x);\n      return [];\n    });\n    return [];\n  });\n}, _embind_register_class_constructor:function(a, b, c, d, e, f) {\n  var g = rd(b, c);\n  e = Z(d, e);\n  Y([], [a], function(n) {\n    n = n[0];\n    var p = `constructor ${n.name}`;\n    void 0 === n.i.$ && (n.i.$ = []);\n    if (void 0 !== n.i.$[b - 1]) {\n      throw new qc(`Cannot register multiple constructors with identical number of parameters (${b - 1}) for class '${n.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);\n    }\n    n.i.$[b - 1] = () => {\n      od(`Cannot construct ${n.name} due to unbound types`, g);\n    };\n    Y([], g, function(l) {\n      l.splice(1, 0, null);\n      n.i.$[b - 1] = pd(p, l, null, e, f);\n      return [];\n    });\n    return [];\n  });\n}, _embind_register_class_function:function(a, b, c, d, e, f, g, n) {\n  var p = rd(c, d);\n  b = W(b);\n  f = Z(e, f);\n  Y([], [a], function(l) {\n    function u() {\n      od(`Cannot call ${v} due to unbound types`, p);\n    }\n    l = l[0];\n    var v = `${l.name}.${b}`;\n    b.startsWith(\"@@\") && (b = Symbol[b.substring(2)]);\n    n && l.i.qb.push(b);\n    var x = l.i.N, k = x[b];\n    void 0 === k || void 0 === k.B && k.className !== l.name && k.ea === c - 2 ? (u.ea = c - 2, u.className = l.name, x[b] = u) : ($c(x, b, v), x[b].B[c - 2] = u);\n    Y([], p, function(t) {\n      t = pd(v, t, l, f, g);\n      void 0 === x[b].B ? (t.ea = c - 2, x[b] = t) : x[b].B[c - 2] = t;\n      return [];\n    });\n    return [];\n  });\n}, _embind_register_class_property:function(a, b, c, d, e, f, g, n, p, l) {\n  b = W(b);\n  e = Z(d, e);\n  Y([], [a], function(u) {\n    u = u[0];\n    var v = `${u.name}.${b}`, x = {get() {\n      od(`Cannot access ${v} due to unbound types`, [c, g]);\n    }, enumerable:!0, configurable:!0};\n    x.set = p ? () => {\n      od(`Cannot access ${v} due to unbound types`, [c, g]);\n    } : () => {\n      V(v + \" is a read-only property\");\n    };\n    Object.defineProperty(u.i.N, b, x);\n    Y([], p ? [c, g] : [c], function(k) {\n      var t = k[0], r = {get() {\n        var D = sd(this, u, v + \" getter\");\n        return t.fromWireType(e(f, D));\n      }, enumerable:!0};\n      if (p) {\n        p = Z(n, p);\n        var A = k[1];\n        r.set = function(D) {\n          var w = sd(this, u, v + \" setter\"), M = [];\n          p(l, w, A.toWireType(M, D));\n          Rc(M);\n        };\n      }\n      Object.defineProperty(u.i.N, b, r);\n      return [];\n    });\n    return [];\n  });\n}, _embind_register_emval:function(a, b) {\n  b = W(b);\n  Vc(a, {name:b, fromWireType:function(c) {\n    var d = rc(c);\n    td(c);\n    return d;\n  }, toWireType:function(c, d) {\n    return sc(d);\n  }, argPackAdvance:8, readValueFromPointer:Sc, K:null,});\n}, _embind_register_enum:function(a, b, c, d) {\n  function e() {\n  }\n  c = Wc(c);\n  b = W(b);\n  e.values = {};\n  Vc(a, {name:b, constructor:e, fromWireType:function(f) {\n    return this.constructor.values[f];\n  }, toWireType:function(f, g) {\n    return g.value;\n  }, argPackAdvance:8, readValueFromPointer:ud(b, c, d), K:null,});\n  ad(b, e);\n}, _embind_register_enum_value:function(a, b, c) {\n  var d = Fc(a, \"enum\");\n  b = W(b);\n  a = d.constructor;\n  d = Object.create(d.constructor.prototype, {value:{value:c}, constructor:{value:oc(`${d.name}_${b}`, function() {\n  })},});\n  a.values[c] = d;\n  a[b] = d;\n}, _embind_register_float:function(a, b, c) {\n  c = Wc(c);\n  b = W(b);\n  Vc(a, {name:b, fromWireType:function(d) {\n    return d;\n  }, toWireType:function(d, e) {\n    return e;\n  }, argPackAdvance:8, readValueFromPointer:vd(b, c), K:null,});\n}, _embind_register_function:function(a, b, c, d, e, f) {\n  var g = rd(b, c);\n  a = W(a);\n  e = Z(d, e);\n  ad(a, function() {\n    od(`Cannot call ${a} due to unbound types`, g);\n  }, b - 1);\n  Y([], g, function(n) {\n    jd(a, pd(a, [n[0], null].concat(n.slice(1)), null, e, f), b - 1);\n    return [];\n  });\n}, _embind_register_integer:function(a, b, c, d, e) {\n  b = W(b);\n  -1 === e && (e = 4294967295);\n  e = Wc(c);\n  var f = n => n;\n  if (0 === d) {\n    var g = 32 - 8 * c;\n    f = n => n << g >>> g;\n  }\n  c = b.includes(\"unsigned\") ? function(n, p) {\n    return p >>> 0;\n  } : function(n, p) {\n    return p;\n  };\n  Vc(a, {name:b, fromWireType:f, toWireType:c, argPackAdvance:8, readValueFromPointer:wd(b, e, 0 !== d), K:null,});\n}, _embind_register_memory_view:function(a, b, c) {\n  function d(f) {\n    f >>= 2;\n    var g = N;\n    return new e(g.buffer, g[f + 1], g[f]);\n  }\n  var e = [Int8Array, Uint8Array, Int16Array, Uint16Array, Int32Array, Uint32Array, Float32Array, Float64Array,][b];\n  c = W(c);\n  Vc(a, {name:c, fromWireType:d, argPackAdvance:8, readValueFromPointer:d,}, {$b:!0,});\n}, _embind_register_std_string:function(a, b) {\n  b = W(b);\n  var c = \"std::string\" === b;\n  Vc(a, {name:b, fromWireType:function(d) {\n    var e = N[d >> 2], f = d + 4;\n    if (c) {\n      for (var g = f, n = 0; n <= e; ++n) {\n        var p = f + n;\n        if (n == e || 0 == E[p]) {\n          g = g ? nb(E, g, p - g) : \"\";\n          if (void 0 === l) {\n            var l = g;\n          } else {\n            l += String.fromCharCode(0), l += g;\n          }\n          g = p + 1;\n        }\n      }\n    } else {\n      l = Array(e);\n      for (n = 0; n < e; ++n) {\n        l[n] = String.fromCharCode(E[f + n]);\n      }\n      l = l.join(\"\");\n    }\n    Ec(d);\n    return l;\n  }, toWireType:function(d, e) {\n    e instanceof ArrayBuffer && (e = new Uint8Array(e));\n    var f = \"string\" == typeof e;\n    f || e instanceof Uint8Array || e instanceof Uint8ClampedArray || e instanceof Int8Array || V(\"Cannot pass non-string to std::string\");\n    var g = c && f ? pb(e) : e.length;\n    var n = Vd(4 + g + 1), p = n + 4;\n    N[n >> 2] = g;\n    if (c && f) {\n      qb(e, E, p, g + 1);\n    } else {\n      if (f) {\n        for (f = 0; f < g; ++f) {\n          var l = e.charCodeAt(f);\n          255 < l && (Ec(p), V(\"String has UTF-16 code units that do not fit in 8 bits\"));\n          E[p + f] = l;\n        }\n      } else {\n        for (f = 0; f < g; ++f) {\n          E[p + f] = e[f];\n        }\n      }\n    }\n    null !== d && d.push(Ec, n);\n    return n;\n  }, argPackAdvance:8, readValueFromPointer:Sc, K:function(d) {\n    Ec(d);\n  },});\n}, _embind_register_std_wstring:function(a, b, c) {\n  c = W(c);\n  if (2 === b) {\n    var d = yd;\n    var e = zd;\n    var f = Ad;\n    var g = () => Ea;\n    var n = 1;\n  } else {\n    4 === b && (d = Bd, e = Cd, f = Dd, g = () => N, n = 2);\n  }\n  Vc(a, {name:c, fromWireType:function(p) {\n    for (var l = N[p >> 2], u = g(), v, x = p + 4, k = 0; k <= l; ++k) {\n      var t = p + 4 + k * b;\n      if (k == l || 0 == u[t >> n]) {\n        x = d(x, t - x), void 0 === v ? v = x : (v += String.fromCharCode(0), v += x), x = t + b;\n      }\n    }\n    Ec(p);\n    return v;\n  }, toWireType:function(p, l) {\n    \"string\" != typeof l && V(`Cannot pass non-string to C++ string type ${c}`);\n    var u = f(l), v = Vd(4 + u + b);\n    N[v >> 2] = u >> n;\n    e(l, v + 4, u + b);\n    null !== p && p.push(Ec, v);\n    return v;\n  }, argPackAdvance:8, readValueFromPointer:Sc, K:function(p) {\n    Ec(p);\n  },});\n}, _embind_register_value_object:function(a, b, c, d, e, f) {\n  Qc[a] = {name:W(b), Pa:Z(c, d), W:Z(e, f), eb:[],};\n}, _embind_register_value_object_field:function(a, b, c, d, e, f, g, n, p, l) {\n  Qc[a].eb.push({Sb:W(b), Yb:c, Wb:Z(d, e), Xb:f, rc:g, qc:Z(n, p), sc:l,});\n}, _embind_register_void:function(a, b) {\n  b = W(b);\n  Vc(a, {fc:!0, name:b, argPackAdvance:0, fromWireType:function() {\n  }, toWireType:function() {\n  },});\n}, _emscripten_get_now_is_monotonic:() => !0, _emval_as:function(a, b, c) {\n  a = rc(a);\n  b = Fc(b, \"emval::as\");\n  var d = [], e = sc(d);\n  N[c >> 2] = e;\n  return b.toWireType(d, a);\n}, _emval_call_method:function(a, b, c, d, e) {\n  a = Gd[a];\n  b = rc(b);\n  c = Fd(c);\n  var f = [];\n  N[d >> 2] = sc(f);\n  return a(b, c, f, e);\n}, _emval_call_void_method:function(a, b, c, d) {\n  a = Gd[a];\n  b = rc(b);\n  c = Fd(c);\n  a(b, c, null, d);\n}, _emval_decref:td, _emval_get_method_caller:function(a, b) {\n  var c = Id(a, b), d = c[0];\n  b = d.name + \"_$\" + c.slice(1).map(function(g) {\n    return g.name;\n  }).join(\"_\") + \"$\";\n  var e = Jd[b];\n  if (void 0 !== e) {\n    return e;\n  }\n  var f = Array(a - 1);\n  e = Hd((g, n, p, l) => {\n    for (var u = 0, v = 0; v < a - 1; ++v) {\n      f[v] = c[v + 1].readValueFromPointer(l + u), u += c[v + 1].argPackAdvance;\n    }\n    g = g[n].apply(g, f);\n    for (v = 0; v < a - 1; ++v) {\n      c[v + 1].Nb && c[v + 1].Nb(f[v]);\n    }\n    if (!d.fc) {\n      return d.toWireType(p, g);\n    }\n  });\n  return Jd[b] = e;\n}, _emval_get_module_property:function(a) {\n  a = Fd(a);\n  return sc(m[a]);\n}, _emval_get_property:function(a, b) {\n  a = rc(a);\n  b = rc(b);\n  return sc(a[b]);\n}, _emval_incref:function(a) {\n  4 < a && (U.get(a).tb += 1);\n}, _emval_new_cstring:function(a) {\n  return sc(Fd(a));\n}, _emval_new_object:function() {\n  return sc({});\n}, _emval_run_destructors:function(a) {\n  var b = rc(a);\n  Rc(b);\n  td(a);\n}, _emval_set_property:function(a, b, c) {\n  a = rc(a);\n  b = rc(b);\n  c = rc(c);\n  a[b] = c;\n}, _emval_take_value:function(a, b) {\n  a = Fc(a, \"_emval_take_value\");\n  a = a.readValueFromPointer(b);\n  return sc(a);\n}, abort:() => {\n  Aa(\"\");\n}, emscripten_asm_const_int:(a, b, c) => {\n  Kd.length = 0;\n  var d;\n  for (c >>= 2; d = E[b++];) {\n    c += 105 != d & c, Kd.push(105 == d ? L[c] : Ia[c++ >> 1]), ++c;\n  }\n  return db[a].apply(null, Kd);\n}, emscripten_date_now:function() {\n  return Date.now();\n}, emscripten_get_now:() => performance.now(), emscripten_memcpy_big:(a, b, c) => E.copyWithin(a, b, b + c), emscripten_resize_heap:a => {\n  var b = E.length;\n  a >>>= 0;\n  if (2147483648 < a) {\n    return !1;\n  }\n  for (var c = 1; 4 >= c; c *= 2) {\n    var d = b * (1 + 0.2 / c);\n    d = Math.min(d, a + 100663296);\n    var e = Math;\n    d = Math.max(a, d);\n    a: {\n      e = e.min.call(e, 2147483648, d + (65536 - d % 65536) % 65536) - Ba.buffer.byteLength + 65535 >>> 16;\n      try {\n        Ba.grow(e);\n        Ja();\n        var f = 1;\n        break a;\n      } catch (g) {\n      }\n      f = void 0;\n    }\n    if (f) {\n      return !0;\n    }\n  }\n  return !1;\n}, environ_get:(a, b) => {\n  var c = 0;\n  Nd().forEach(function(d, e) {\n    var f = b + c;\n    e = N[a + 4 * e >> 2] = f;\n    for (f = 0; f < d.length; ++f) {\n      B[e++ >> 0] = d.charCodeAt(f);\n    }\n    B[e >> 0] = 0;\n    c += d.length + 1;\n  });\n  return 0;\n}, environ_sizes_get:(a, b) => {\n  var c = Nd();\n  N[a >> 2] = c.length;\n  var d = 0;\n  c.forEach(function(e) {\n    d += e.length + 1;\n  });\n  N[b >> 2] = d;\n  return 0;\n}, fd_close:function(a) {\n  try {\n    var b = Tb(a);\n    if (null === b.X) {\n      throw new O(8);\n    }\n    b.Ma && (b.Ma = null);\n    try {\n      b.m.close && b.m.close(b);\n    } catch (c) {\n      throw c;\n    } finally {\n      Gb[b.X] = null;\n    }\n    b.X = null;\n    return 0;\n  } catch (c) {\n    if (\"undefined\" == typeof kc || \"ErrnoError\" !== c.name) {\n      throw c;\n    }\n    return c.aa;\n  }\n}, fd_read:function(a, b, c, d) {\n  try {\n    a: {\n      var e = Tb(a);\n      a = b;\n      for (var f, g = b = 0; g < c; g++) {\n        var n = N[a >> 2], p = N[a + 4 >> 2];\n        a += 8;\n        var l = e, u = n, v = p, x = f, k = B;\n        if (0 > v || 0 > x) {\n          throw new O(28);\n        }\n        if (null === l.X) {\n          throw new O(8);\n        }\n        if (1 === (l.flags & 2097155)) {\n          throw new O(8);\n        }\n        if (16384 === (l.node.mode & 61440)) {\n          throw new O(31);\n        }\n        if (!l.m.read) {\n          throw new O(28);\n        }\n        var t = \"undefined\" != typeof x;\n        if (!t) {\n          x = l.position;\n        } else if (!l.seekable) {\n          throw new O(70);\n        }\n        var r = l.m.read(l, k, u, v, x);\n        t || (l.position += r);\n        var A = r;\n        if (0 > A) {\n          var D = -1;\n          break a;\n        }\n        b += A;\n        if (A < p) {\n          break;\n        }\n        \"undefined\" !== typeof f && (f += A);\n      }\n      D = b;\n    }\n    N[d >> 2] = D;\n    return 0;\n  } catch (w) {\n    if (\"undefined\" == typeof kc || \"ErrnoError\" !== w.name) {\n      throw w;\n    }\n    return w.aa;\n  }\n}, fd_seek:function(a, b, c, d, e) {\n  b = c + 2097152 >>> 0 < 4194305 - !!b ? (b >>> 0) + 4294967296 * c : NaN;\n  try {\n    if (isNaN(b)) {\n      return 61;\n    }\n    var f = Tb(a);\n    fc(f, b, d);\n    $a = [f.position >>> 0, (Za = f.position, 1.0 <= +Math.abs(Za) ? 0.0 < Za ? +Math.floor(Za / 4294967296.0) >>> 0 : ~~+Math.ceil((Za - +(~~Za >>> 0)) / 4294967296.0) >>> 0 : 0)];\n    L[e >> 2] = $a[0];\n    L[e + 4 >> 2] = $a[1];\n    f.Ma && 0 === b && 0 === d && (f.Ma = null);\n    return 0;\n  } catch (g) {\n    if (\"undefined\" == typeof kc || \"ErrnoError\" !== g.name) {\n      throw g;\n    }\n    return g.aa;\n  }\n}, fd_write:function(a, b, c, d) {\n  try {\n    a: {\n      var e = Tb(a);\n      a = b;\n      for (var f, g = b = 0; g < c; g++) {\n        var n = N[a >> 2], p = N[a + 4 >> 2];\n        a += 8;\n        var l = e, u = n, v = p, x = f, k = B;\n        if (0 > v || 0 > x) {\n          throw new O(28);\n        }\n        if (null === l.X) {\n          throw new O(8);\n        }\n        if (0 === (l.flags & 2097155)) {\n          throw new O(8);\n        }\n        if (16384 === (l.node.mode & 61440)) {\n          throw new O(31);\n        }\n        if (!l.m.write) {\n          throw new O(28);\n        }\n        l.seekable && l.flags & 1024 && fc(l, 0, 2);\n        var t = \"undefined\" != typeof x;\n        if (!t) {\n          x = l.position;\n        } else if (!l.seekable) {\n          throw new O(70);\n        }\n        var r = l.m.write(l, k, u, v, x, void 0);\n        t || (l.position += r);\n        var A = r;\n        if (0 > A) {\n          var D = -1;\n          break a;\n        }\n        b += A;\n        \"undefined\" !== typeof f && (f += A);\n      }\n      D = b;\n    }\n    N[d >> 2] = D;\n    return 0;\n  } catch (w) {\n    if (\"undefined\" == typeof kc || \"ErrnoError\" !== w.name) {\n      throw w;\n    }\n    return w.aa;\n  }\n}, strftime_l:(a, b, c, d) => Rd(a, b, c, d)};\n(function() {\n  function a(c) {\n    y = c = c.exports;\n    Ba = y.memory;\n    Ja();\n    Ka = y.__indirect_function_table;\n    Ma.unshift(y.__wasm_call_ctors);\n    Pa--;\n    m.monitorRunDependencies && m.monitorRunDependencies(Pa);\n    if (0 == Pa && (null !== Qa && (clearInterval(Qa), Qa = null), Ra)) {\n      var d = Ra;\n      Ra = null;\n      d();\n    }\n    return c;\n  }\n  var b = {env:Wd, wasi_snapshot_preview1:Wd,};\n  Pa++;\n  m.monitorRunDependencies && m.monitorRunDependencies(Pa);\n  if (m.instantiateWasm) {\n    try {\n      return m.instantiateWasm(b, a);\n    } catch (c) {\n      xa(\"Module.instantiateWasm callback failed with error: \" + c), ea(c);\n    }\n  }\n  Ya(b, function(c) {\n    a(c.instance);\n  }).catch(ea);\n  return {};\n})();\nvar Ec = a => (Ec = y.free)(a), Vd = a => (Vd = y.malloc)(a), ab = m._ma_device__on_notification_unlocked = a => (ab = m._ma_device__on_notification_unlocked = y.ma_device__on_notification_unlocked)(a);\nm._ma_malloc_emscripten = (a, b) => (m._ma_malloc_emscripten = y.ma_malloc_emscripten)(a, b);\nm._ma_free_emscripten = (a, b) => (m._ma_free_emscripten = y.ma_free_emscripten)(a, b);\nvar bb = m._ma_device_process_pcm_frames_capture__webaudio = (a, b, c) => (bb = m._ma_device_process_pcm_frames_capture__webaudio = y.ma_device_process_pcm_frames_capture__webaudio)(a, b, c), cb = m._ma_device_process_pcm_frames_playback__webaudio = (a, b, c) => (cb = m._ma_device_process_pcm_frames_playback__webaudio = y.ma_device_process_pcm_frames_playback__webaudio)(a, b, c), Ud = () => (Ud = y.__errno_location)(), Dc = a => (Dc = y.__getTypeName)(a);\nm.__embind_initialize_bindings = () => (m.__embind_initialize_bindings = y._embind_initialize_bindings)();\nm.dynCall_iiji = (a, b, c, d, e) => (m.dynCall_iiji = y.dynCall_iiji)(a, b, c, d, e);\nm.dynCall_jiji = (a, b, c, d, e) => (m.dynCall_jiji = y.dynCall_jiji)(a, b, c, d, e);\nm.dynCall_iiiji = (a, b, c, d, e, f) => (m.dynCall_iiiji = y.dynCall_iiiji)(a, b, c, d, e, f);\nm.dynCall_iij = (a, b, c, d) => (m.dynCall_iij = y.dynCall_iij)(a, b, c, d);\nm.dynCall_jii = (a, b, c) => (m.dynCall_jii = y.dynCall_jii)(a, b, c);\nm.dynCall_viijii = (a, b, c, d, e, f, g) => (m.dynCall_viijii = y.dynCall_viijii)(a, b, c, d, e, f, g);\nm.dynCall_iiiiij = (a, b, c, d, e, f, g) => (m.dynCall_iiiiij = y.dynCall_iiiiij)(a, b, c, d, e, f, g);\nm.dynCall_iiiiijj = (a, b, c, d, e, f, g, n, p) => (m.dynCall_iiiiijj = y.dynCall_iiiiijj)(a, b, c, d, e, f, g, n, p);\nm.dynCall_iiiiiijj = (a, b, c, d, e, f, g, n, p, l) => (m.dynCall_iiiiiijj = y.dynCall_iiiiiijj)(a, b, c, d, e, f, g, n, p, l);\nvar Xd;\nRa = function Yd() {\n  Xd || Zd();\n  Xd || (Ra = Yd);\n};\nfunction Zd() {\n  function a() {\n    if (!Xd && (Xd = !0, m.calledRun = !0, !Ca)) {\n      m.noFSInit || hc || (hc = !0, gc(), m.stdin = m.stdin, m.stdout = m.stdout, m.stderr = m.stderr, m.stdin ? jc(\"stdin\", m.stdin) : cc(\"/dev/tty\", \"/dev/stdin\"), m.stdout ? jc(\"stdout\", null, m.stdout) : cc(\"/dev/tty\", \"/dev/stdout\"), m.stderr ? jc(\"stderr\", null, m.stderr) : cc(\"/dev/tty1\", \"/dev/stderr\"), ec(\"/dev/stdin\", 0), ec(\"/dev/stdout\", 1), ec(\"/dev/stderr\", 1));\n      Jb = !1;\n      eb(Ma);\n      aa(m);\n      if (m.onRuntimeInitialized) {\n        m.onRuntimeInitialized();\n      }\n      if (m.postRun) {\n        for (\"function\" == typeof m.postRun && (m.postRun = [m.postRun]); m.postRun.length;) {\n          var b = m.postRun.shift();\n          Na.unshift(b);\n        }\n      }\n      eb(Na);\n    }\n  }\n  if (!(0 < Pa)) {\n    if (m.preRun) {\n      for (\"function\" == typeof m.preRun && (m.preRun = [m.preRun]); m.preRun.length;) {\n        Oa();\n      }\n    }\n    eb(La);\n    0 < Pa || (m.setStatus ? (m.setStatus(\"Running...\"), setTimeout(function() {\n      setTimeout(function() {\n        m.setStatus(\"\");\n      }, 1);\n      a();\n    }, 1)) : a());\n  }\n}\nif (m.preInit) {\n  for (\"function\" == typeof m.preInit && (m.preInit = [m.preInit]); 0 < m.preInit.length;) {\n    m.preInit.pop()();\n  }\n}\nZd();\n\n\n\n  return moduleArg.ready\n}\n\n);\n})();\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Rive);\n\n/***/ }),\n/* 2 */\n/***/ ((module) => {\n\nmodule.exports = JSON.parse('{\"name\":\"@rive-app/canvas\",\"version\":\"2.21.6\",\"description\":\"Rive\\'s canvas based web api.\",\"main\":\"rive.js\",\"homepage\":\"https://rive.app\",\"repository\":{\"type\":\"git\",\"url\":\"https://github.com/rive-app/rive-wasm/tree/master/js\"},\"keywords\":[\"rive\",\"animation\"],\"author\":\"Rive\",\"contributors\":[\"Luigi Rosso <luigi@rive.app> (https://rive.app)\",\"Maxwell Talbot <max@rive.app> (https://rive.app)\",\"Arthur Vivian <arthur@rive.app> (https://rive.app)\",\"Umberto Sonnino <umberto@rive.app> (https://rive.app)\",\"Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)\"],\"license\":\"MIT\",\"files\":[\"rive.js\",\"rive.js.map\",\"rive.wasm\",\"rive_fallback.wasm\",\"rive.d.ts\",\"rive_advanced.mjs.d.ts\"],\"typings\":\"rive.d.ts\",\"dependencies\":{},\"browser\":{\"fs\":false,\"path\":false}}');\n\n/***/ }),\n/* 3 */\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Animation: () => (/* reexport safe */ _Animation__WEBPACK_IMPORTED_MODULE_0__.Animation)\n/* harmony export */ });\n/* harmony import */ var _Animation__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(4);\n\n\n\n/***/ }),\n/* 4 */\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Animation: () => (/* binding */ Animation)\n/* harmony export */ });\n/**\n * Represents an animation that can be played on an Artboard.\n * Wraps animations and instances from the runtime and keeps track of playback state.\n *\n * The `Animation` class manages the state and behavior of a single animation instance,\n * including its current time, loop count, and ability to scrub to a specific time.\n *\n * The class provides methods to advance the animation, apply its interpolated keyframe\n * values to the Artboard, and clean up the underlying animation instance when the\n * animation is no longer needed.\n */\nvar Animation = /** @class */ (function () {\n    /**\n     * Constructs a new animation\n     * @constructor\n     * @param {any} animation: runtime animation object\n     * @param {any} instance: runtime animation instance object\n     */\n    function Animation(animation, artboard, runtime, playing) {\n        this.animation = animation;\n        this.artboard = artboard;\n        this.playing = playing;\n        this.loopCount = 0;\n        /**\n         * The time to which the animation should move to on the next render.\n         * If not null, the animation will scrub to this time instead of advancing by the given time.\n         */\n        this.scrubTo = null;\n        this.instance = new runtime.LinearAnimationInstance(animation, artboard);\n    }\n    Object.defineProperty(Animation.prototype, \"name\", {\n        /**\n         * Returns the animation's name\n         */\n        get: function () {\n            return this.animation.name;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Animation.prototype, \"time\", {\n        /**\n         * Returns the animation's name\n         */\n        get: function () {\n            return this.instance.time;\n        },\n        /**\n         * Sets the animation's current time\n         */\n        set: function (value) {\n            this.instance.time = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Animation.prototype, \"loopValue\", {\n        /**\n         * Returns the animation's loop type\n         */\n        get: function () {\n            return this.animation.loopValue;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Animation.prototype, \"needsScrub\", {\n        /**\n         * Indicates whether the animation needs to be scrubbed.\n         * @returns `true` if the animation needs to be scrubbed, `false` otherwise.\n         */\n        get: function () {\n            return this.scrubTo !== null;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Advances the animation by the give time. If the animation needs scrubbing,\n     * time is ignored and the stored scrub value is used.\n     * @param time the time to advance the animation by if no scrubbing required\n     */\n    Animation.prototype.advance = function (time) {\n        if (this.scrubTo === null) {\n            this.instance.advance(time);\n        }\n        else {\n            this.instance.time = 0;\n            this.instance.advance(this.scrubTo);\n            this.scrubTo = null;\n        }\n    };\n    /**\n     * Apply interpolated keyframe values to the artboard. This should be called after calling\n     * .advance() on an animation instance so that new values are applied to properties.\n     *\n     * Note: This does not advance the artboard, which updates all objects on the artboard\n     * @param mix - Mix value for the animation from 0 to 1\n     */\n    Animation.prototype.apply = function (mix) {\n        this.instance.apply(mix);\n    };\n    /**\n     * Deletes the backing Wasm animation instance; once this is called, this\n     * animation is no more.\n     */\n    Animation.prototype.cleanup = function () {\n        this.instance.delete();\n    };\n    return Animation;\n}());\n\n\n\n/***/ }),\n/* 5 */\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BLANK_URL: () => (/* reexport safe */ _sanitizeUrl__WEBPACK_IMPORTED_MODULE_1__.BLANK_URL),\n/* harmony export */   registerTouchInteractions: () => (/* reexport safe */ _registerTouchInteractions__WEBPACK_IMPORTED_MODULE_0__.registerTouchInteractions),\n/* harmony export */   sanitizeUrl: () => (/* reexport safe */ _sanitizeUrl__WEBPACK_IMPORTED_MODULE_1__.sanitizeUrl)\n/* harmony export */ });\n/* harmony import */ var _registerTouchInteractions__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(6);\n/* harmony import */ var _sanitizeUrl__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(7);\n\n\n\n\n/***/ }),\n/* 6 */\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   registerTouchInteractions: () => (/* binding */ registerTouchInteractions)\n/* harmony export */ });\nvar _this = undefined;\n/**\n * Returns the clientX and clientY properties from touch or mouse events. Also\n * calls preventDefault() on the event if it is a touchstart or touchmove to prevent\n * scrolling the page on mobile devices\n * @param event - Either a TouchEvent or a MouseEvent\n * @returns - Coordinates of the clientX and clientY properties from the touch/mouse event\n */\nvar getClientCoordinates = function (event, isTouchScrollEnabled) {\n    var _a, _b;\n    if ([\"touchstart\", \"touchmove\"].indexOf(event.type) > -1 &&\n        ((_a = event.touches) === null || _a === void 0 ? void 0 : _a.length)) {\n        // This flag, if false, prevents touch events on the canvas default behavior\n        // which may prevent scrolling if a drag motion on the canvas is performed\n        if (!isTouchScrollEnabled) {\n            event.preventDefault();\n        }\n        return {\n            clientX: event.touches[0].clientX,\n            clientY: event.touches[0].clientY,\n        };\n    }\n    else if (event.type === \"touchend\" &&\n        ((_b = event.changedTouches) === null || _b === void 0 ? void 0 : _b.length)) {\n        return {\n            clientX: event.changedTouches[0].clientX,\n            clientY: event.changedTouches[0].clientY,\n        };\n    }\n    else {\n        return {\n            clientX: event.clientX,\n            clientY: event.clientY,\n        };\n    }\n};\n/**\n * Registers mouse move/up/down callback handlers on the canvas to send meaningful coordinates to\n * the state machine pointer move/up/down functions based on cursor interaction\n */\nvar registerTouchInteractions = function (_a) {\n    var canvas = _a.canvas, artboard = _a.artboard, _b = _a.stateMachines, stateMachines = _b === void 0 ? [] : _b, renderer = _a.renderer, rive = _a.rive, fit = _a.fit, alignment = _a.alignment, _c = _a.isTouchScrollEnabled, isTouchScrollEnabled = _c === void 0 ? false : _c;\n    if (!canvas ||\n        !stateMachines.length ||\n        !renderer ||\n        !rive ||\n        !artboard ||\n        typeof window === \"undefined\") {\n        return null;\n    }\n    /**\n     * After a touchend event, some browsers may fire synthetic mouse events\n     * (mouseover, mousedown, mousemove, mouseup) if the touch interaction did not cause\n     * any default action (such as scrolling).\n     *\n     * This is done to simulate the behavior of a mouse for applications that do not support\n     * touch events.\n     *\n     * We're keeping track of the previous event to not send the synthetic mouse events if the\n     * touch event was a click (touchstart -> touchend).\n     *\n     * This is only needed when `isTouchScrollEnabled` is false\n     * When true, `preventDefault()` is called which prevents this behaviour.\n     **/\n    var _prevEventType = null;\n    var _syntheticEventsActive = false;\n    var processEventCallback = function (event) {\n        // Exit early out of all synthetic mouse events\n        // https://stackoverflow.com/questions/9656990/how-to-prevent-simulated-mouse-events-in-mobile-browsers\n        // https://stackoverflow.com/questions/25572070/javascript-touchend-versus-click-dilemma\n        if (_syntheticEventsActive && event instanceof MouseEvent) {\n            // Synthetic event finished\n            if (event.type == \"mouseup\") {\n                _syntheticEventsActive = false;\n            }\n            return;\n        }\n        // Test if it's a \"touch click\". This could cause the browser to send\n        // synthetic mouse events.\n        _syntheticEventsActive =\n            isTouchScrollEnabled &&\n                event.type === \"touchend\" &&\n                _prevEventType === \"touchstart\";\n        _prevEventType = event.type;\n        var boundingRect = event.currentTarget.getBoundingClientRect();\n        var _a = getClientCoordinates(event, isTouchScrollEnabled), clientX = _a.clientX, clientY = _a.clientY;\n        if (!clientX && !clientY) {\n            return;\n        }\n        var canvasX = clientX - boundingRect.left;\n        var canvasY = clientY - boundingRect.top;\n        var forwardMatrix = rive.computeAlignment(fit, alignment, {\n            minX: 0,\n            minY: 0,\n            maxX: boundingRect.width,\n            maxY: boundingRect.height,\n        }, artboard.bounds);\n        var invertedMatrix = new rive.Mat2D();\n        forwardMatrix.invert(invertedMatrix);\n        var canvasCoordinatesVector = new rive.Vec2D(canvasX, canvasY);\n        var transformedVector = rive.mapXY(invertedMatrix, canvasCoordinatesVector);\n        var transformedX = transformedVector.x();\n        var transformedY = transformedVector.y();\n        transformedVector.delete();\n        invertedMatrix.delete();\n        canvasCoordinatesVector.delete();\n        forwardMatrix.delete();\n        switch (event.type) {\n            /**\n             * There's a 2px buffer for a hitRadius when translating the pointer coordinates\n             * down to the state machine. In cases where the hitbox is about that much away\n             * from the Artboard border, we don't have exact precision on determining pointer\n             * exit. We're therefore adding to the translated coordinates on mouseout of a canvas\n             * to ensure that we report the mouse has truly exited the hitarea.\n             * https://github.com/rive-app/rive-cpp/blob/master/src/animation/state_machine_instance.cpp#L336\n             *\n             * We add/subtract 10000 to account for when the graphic goes beyond the canvas bound\n             * due to for example, a fit: 'cover'. Not perfect, but helps reliably (for now) ensure\n             * we report going out of bounds when the mouse is out of the canvas\n             */\n            case \"mouseout\":\n                for (var _i = 0, stateMachines_1 = stateMachines; _i < stateMachines_1.length; _i++) {\n                    var stateMachine = stateMachines_1[_i];\n                    stateMachine.pointerMove(transformedX < 0 ? transformedX - 10000 : transformedX + 10000, transformedY < 0 ? transformedY - 10000 : transformedY + 10000);\n                }\n                break;\n            // Pointer moving/hovering on the canvas\n            case \"touchmove\":\n            case \"mouseover\":\n            case \"mousemove\": {\n                for (var _b = 0, stateMachines_2 = stateMachines; _b < stateMachines_2.length; _b++) {\n                    var stateMachine = stateMachines_2[_b];\n                    stateMachine.pointerMove(transformedX, transformedY);\n                }\n                break;\n            }\n            // Pointer click initiated but not released yet on the canvas\n            case \"touchstart\":\n            case \"mousedown\": {\n                for (var _c = 0, stateMachines_3 = stateMachines; _c < stateMachines_3.length; _c++) {\n                    var stateMachine = stateMachines_3[_c];\n                    stateMachine.pointerDown(transformedX, transformedY);\n                }\n                break;\n            }\n            // Pointer click released on the canvas\n            case \"touchend\":\n            case \"mouseup\": {\n                for (var _d = 0, stateMachines_4 = stateMachines; _d < stateMachines_4.length; _d++) {\n                    var stateMachine = stateMachines_4[_d];\n                    stateMachine.pointerUp(transformedX, transformedY);\n                }\n                break;\n            }\n            default:\n        }\n    };\n    var callback = processEventCallback.bind(_this);\n    canvas.addEventListener(\"mouseover\", callback);\n    canvas.addEventListener(\"mouseout\", callback);\n    canvas.addEventListener(\"mousemove\", callback);\n    canvas.addEventListener(\"mousedown\", callback);\n    canvas.addEventListener(\"mouseup\", callback);\n    canvas.addEventListener(\"touchmove\", callback, {\n        passive: isTouchScrollEnabled,\n    });\n    canvas.addEventListener(\"touchstart\", callback, {\n        passive: isTouchScrollEnabled,\n    });\n    canvas.addEventListener(\"touchend\", callback);\n    return function () {\n        canvas.removeEventListener(\"mouseover\", callback);\n        canvas.removeEventListener(\"mouseout\", callback);\n        canvas.removeEventListener(\"mousemove\", callback);\n        canvas.removeEventListener(\"mousedown\", callback);\n        canvas.removeEventListener(\"mouseup\", callback);\n        canvas.removeEventListener(\"touchmove\", callback);\n        canvas.removeEventListener(\"touchstart\", callback);\n        canvas.removeEventListener(\"touchend\", callback);\n    };\n};\n\n\n/***/ }),\n/* 7 */\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BLANK_URL: () => (/* binding */ BLANK_URL),\n/* harmony export */   sanitizeUrl: () => (/* binding */ sanitizeUrl)\n/* harmony export */ });\n// Reference: https://github.com/braintree/sanitize-url/tree/main\nvar invalidProtocolRegex = /^([^\\w]*)(javascript|data|vbscript)/im;\nvar htmlEntitiesRegex = /&#(\\w+)(^\\w|;)?/g;\nvar htmlCtrlEntityRegex = /&(newline|tab);/gi;\nvar ctrlCharactersRegex = /[\\u0000-\\u001F\\u007F-\\u009F\\u2000-\\u200D\\uFEFF]/gim;\nvar urlSchemeRegex = /^.+(:|&colon;)/gim;\nvar relativeFirstCharacters = [\".\", \"/\"];\nvar BLANK_URL = \"about:blank\";\nfunction isRelativeUrlWithoutProtocol(url) {\n    return relativeFirstCharacters.indexOf(url[0]) > -1;\n}\n// adapted from https://stackoverflow.com/a/29824550/2601552\nfunction decodeHtmlCharacters(str) {\n    var removedNullByte = str.replace(ctrlCharactersRegex, \"\");\n    return removedNullByte.replace(htmlEntitiesRegex, function (match, dec) {\n        return String.fromCharCode(dec);\n    });\n}\nfunction sanitizeUrl(url) {\n    if (!url) {\n        return BLANK_URL;\n    }\n    var sanitizedUrl = decodeHtmlCharacters(url)\n        .replace(htmlCtrlEntityRegex, \"\")\n        .replace(ctrlCharactersRegex, \"\")\n        .trim();\n    if (!sanitizedUrl) {\n        return BLANK_URL;\n    }\n    if (isRelativeUrlWithoutProtocol(sanitizedUrl)) {\n        return sanitizedUrl;\n    }\n    var urlSchemeParseResults = sanitizedUrl.match(urlSchemeRegex);\n    if (!urlSchemeParseResults) {\n        return sanitizedUrl;\n    }\n    var urlScheme = urlSchemeParseResults[0];\n    if (invalidProtocolRegex.test(urlScheme)) {\n        return BLANK_URL;\n    }\n    return sanitizedUrl;\n}\n\n\n/***/ })\n/******/ \t]);\n/************************************************************************/\n/******/ \t// The module cache\n/******/ \tvar __webpack_module_cache__ = {};\n/******/ \t\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/ \t\t// Check if module is in cache\n/******/ \t\tvar cachedModule = __webpack_module_cache__[moduleId];\n/******/ \t\tif (cachedModule !== undefined) {\n/******/ \t\t\treturn cachedModule.exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = __webpack_module_cache__[moduleId] = {\n/******/ \t\t\t// no module.id needed\n/******/ \t\t\t// no module.loaded needed\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/ \t\n/******/ \t\t// Execute the module function\n/******/ \t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n/******/ \t\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/ \t\n/************************************************************************/\n/******/ \t/* webpack/runtime/define property getters */\n/******/ \t(() => {\n/******/ \t\t// define getter functions for harmony exports\n/******/ \t\t__webpack_require__.d = (exports, definition) => {\n/******/ \t\t\tfor(var key in definition) {\n/******/ \t\t\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n/******/ \t\t\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n/******/ \t\t\t\t}\n/******/ \t\t\t}\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/hasOwnProperty shorthand */\n/******/ \t(() => {\n/******/ \t\t__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/make namespace object */\n/******/ \t(() => {\n/******/ \t\t// define __esModule on exports\n/******/ \t\t__webpack_require__.r = (exports) => {\n/******/ \t\t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t\t}\n/******/ \t\t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/************************************************************************/\nvar __webpack_exports__ = {};\n// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.\n(() => {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Alignment: () => (/* binding */ Alignment),\n/* harmony export */   EventType: () => (/* binding */ EventType),\n/* harmony export */   Fit: () => (/* binding */ Fit),\n/* harmony export */   Layout: () => (/* binding */ Layout),\n/* harmony export */   LoopType: () => (/* binding */ LoopType),\n/* harmony export */   Rive: () => (/* binding */ Rive),\n/* harmony export */   RiveEventType: () => (/* binding */ RiveEventType),\n/* harmony export */   RiveFile: () => (/* binding */ RiveFile),\n/* harmony export */   RuntimeLoader: () => (/* binding */ RuntimeLoader),\n/* harmony export */   StateMachineInput: () => (/* binding */ StateMachineInput),\n/* harmony export */   StateMachineInputType: () => (/* binding */ StateMachineInputType),\n/* harmony export */   Testing: () => (/* binding */ Testing),\n/* harmony export */   decodeAudio: () => (/* binding */ decodeAudio),\n/* harmony export */   decodeFont: () => (/* binding */ decodeFont),\n/* harmony export */   decodeImage: () => (/* binding */ decodeImage)\n/* harmony export */ });\n/* harmony import */ var _rive_advanced_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(1);\n/* harmony import */ var package_json__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(2);\n/* harmony import */ var _animation__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(3);\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(5);\nvar __extends = (undefined && undefined.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (undefined && undefined.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\n\n\n\n\n// #region layout\n// Fit options for the canvas\nvar Fit;\n(function (Fit) {\n    Fit[\"Cover\"] = \"cover\";\n    Fit[\"Contain\"] = \"contain\";\n    Fit[\"Fill\"] = \"fill\";\n    Fit[\"FitWidth\"] = \"fitWidth\";\n    Fit[\"FitHeight\"] = \"fitHeight\";\n    Fit[\"None\"] = \"none\";\n    Fit[\"ScaleDown\"] = \"scaleDown\";\n})(Fit || (Fit = {}));\n// Alignment options for the canvas\nvar Alignment;\n(function (Alignment) {\n    Alignment[\"Center\"] = \"center\";\n    Alignment[\"TopLeft\"] = \"topLeft\";\n    Alignment[\"TopCenter\"] = \"topCenter\";\n    Alignment[\"TopRight\"] = \"topRight\";\n    Alignment[\"CenterLeft\"] = \"centerLeft\";\n    Alignment[\"CenterRight\"] = \"centerRight\";\n    Alignment[\"BottomLeft\"] = \"bottomLeft\";\n    Alignment[\"BottomCenter\"] = \"bottomCenter\";\n    Alignment[\"BottomRight\"] = \"bottomRight\";\n})(Alignment || (Alignment = {}));\n// Alignment options for Rive animations in a HTML canvas\nvar Layout = /** @class */ (function () {\n    function Layout(params) {\n        var _a, _b, _c, _d, _e, _f;\n        this.fit = (_a = params === null || params === void 0 ? void 0 : params.fit) !== null && _a !== void 0 ? _a : Fit.Contain;\n        this.alignment = (_b = params === null || params === void 0 ? void 0 : params.alignment) !== null && _b !== void 0 ? _b : Alignment.Center;\n        this.minX = (_c = params === null || params === void 0 ? void 0 : params.minX) !== null && _c !== void 0 ? _c : 0;\n        this.minY = (_d = params === null || params === void 0 ? void 0 : params.minY) !== null && _d !== void 0 ? _d : 0;\n        this.maxX = (_e = params === null || params === void 0 ? void 0 : params.maxX) !== null && _e !== void 0 ? _e : 0;\n        this.maxY = (_f = params === null || params === void 0 ? void 0 : params.maxY) !== null && _f !== void 0 ? _f : 0;\n    }\n    // Alternative constructor to build a Layout from an interface/object\n    Layout.new = function (_a) {\n        var fit = _a.fit, alignment = _a.alignment, minX = _a.minX, minY = _a.minY, maxX = _a.maxX, maxY = _a.maxY;\n        console.warn(\"This function is deprecated: please use `new Layout({})` instead\");\n        return new Layout({ fit: fit, alignment: alignment, minX: minX, minY: minY, maxX: maxX, maxY: maxY });\n    };\n    /**\n     * Makes a copy of the layout, replacing any specified parameters\n     */\n    Layout.prototype.copyWith = function (_a) {\n        var fit = _a.fit, alignment = _a.alignment, minX = _a.minX, minY = _a.minY, maxX = _a.maxX, maxY = _a.maxY;\n        return new Layout({\n            fit: fit !== null && fit !== void 0 ? fit : this.fit,\n            alignment: alignment !== null && alignment !== void 0 ? alignment : this.alignment,\n            minX: minX !== null && minX !== void 0 ? minX : this.minX,\n            minY: minY !== null && minY !== void 0 ? minY : this.minY,\n            maxX: maxX !== null && maxX !== void 0 ? maxX : this.maxX,\n            maxY: maxY !== null && maxY !== void 0 ? maxY : this.maxY,\n        });\n    };\n    // Returns fit for the Wasm runtime format\n    Layout.prototype.runtimeFit = function (rive) {\n        if (this.cachedRuntimeFit)\n            return this.cachedRuntimeFit;\n        var fit;\n        if (this.fit === Fit.Cover)\n            fit = rive.Fit.cover;\n        else if (this.fit === Fit.Contain)\n            fit = rive.Fit.contain;\n        else if (this.fit === Fit.Fill)\n            fit = rive.Fit.fill;\n        else if (this.fit === Fit.FitWidth)\n            fit = rive.Fit.fitWidth;\n        else if (this.fit === Fit.FitHeight)\n            fit = rive.Fit.fitHeight;\n        else if (this.fit === Fit.ScaleDown)\n            fit = rive.Fit.scaleDown;\n        else\n            fit = rive.Fit.none;\n        this.cachedRuntimeFit = fit;\n        return fit;\n    };\n    // Returns alignment for the Wasm runtime format\n    Layout.prototype.runtimeAlignment = function (rive) {\n        if (this.cachedRuntimeAlignment)\n            return this.cachedRuntimeAlignment;\n        var alignment;\n        if (this.alignment === Alignment.TopLeft)\n            alignment = rive.Alignment.topLeft;\n        else if (this.alignment === Alignment.TopCenter)\n            alignment = rive.Alignment.topCenter;\n        else if (this.alignment === Alignment.TopRight)\n            alignment = rive.Alignment.topRight;\n        else if (this.alignment === Alignment.CenterLeft)\n            alignment = rive.Alignment.centerLeft;\n        else if (this.alignment === Alignment.CenterRight)\n            alignment = rive.Alignment.centerRight;\n        else if (this.alignment === Alignment.BottomLeft)\n            alignment = rive.Alignment.bottomLeft;\n        else if (this.alignment === Alignment.BottomCenter)\n            alignment = rive.Alignment.bottomCenter;\n        else if (this.alignment === Alignment.BottomRight)\n            alignment = rive.Alignment.bottomRight;\n        else\n            alignment = rive.Alignment.center;\n        this.cachedRuntimeAlignment = alignment;\n        return alignment;\n    };\n    return Layout;\n}());\n\n// Runtime singleton; use getInstance to provide a callback that returns the\n// Rive runtime\nvar RuntimeLoader = /** @class */ (function () {\n    // Class is never instantiated\n    function RuntimeLoader() {\n    }\n    // Loads the runtime\n    RuntimeLoader.loadRuntime = function () {\n        _rive_advanced_mjs__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n            // Loads Wasm bundle\n            locateFile: function () { return RuntimeLoader.wasmURL; },\n        })\n            .then(function (rive) {\n            var _a;\n            RuntimeLoader.runtime = rive;\n            // Fire all the callbacks\n            while (RuntimeLoader.callBackQueue.length > 0) {\n                (_a = RuntimeLoader.callBackQueue.shift()) === null || _a === void 0 ? void 0 : _a(RuntimeLoader.runtime);\n            }\n        })\n            .catch(function () {\n            // In case unpkg fails, or the wasm was not supported, we try to load the fallback module from jsdelivr.\n            // This `rive_fallback.wasm` is compiled to support older architecture.\n            // TODO: (Gordon): preemptively test browser support and load the correct wasm file. Then use jsdelvr only if unpkg fails.\n            var backupJsdelivrUrl = \"https://cdn.jsdelivr.net/npm/\".concat(package_json__WEBPACK_IMPORTED_MODULE_1__.name, \"@\").concat(package_json__WEBPACK_IMPORTED_MODULE_1__.version, \"/rive_fallback.wasm\");\n            if (RuntimeLoader.wasmURL.toLowerCase() !== backupJsdelivrUrl) {\n                console.warn(\"Failed to load WASM from \".concat(RuntimeLoader.wasmURL, \", trying jsdelivr as a backup\"));\n                RuntimeLoader.setWasmUrl(backupJsdelivrUrl);\n                RuntimeLoader.loadRuntime();\n            }\n            else {\n                console.error(\"Could not load Rive WASM file from unpkg or jsdelivr, network connection may be down, or \\\n        you may need to call set a new WASM source via RuntimeLoader.setWasmUrl() and call \\\n        RuntimeLoader.loadRuntime() again\");\n            }\n        });\n    };\n    // Provides a runtime instance via a callback\n    RuntimeLoader.getInstance = function (callback) {\n        // If it's not loading, start loading runtime\n        if (!RuntimeLoader.isLoading) {\n            RuntimeLoader.isLoading = true;\n            RuntimeLoader.loadRuntime();\n        }\n        if (!RuntimeLoader.runtime) {\n            RuntimeLoader.callBackQueue.push(callback);\n        }\n        else {\n            callback(RuntimeLoader.runtime);\n        }\n    };\n    // Provides a runtime instance via a promise\n    RuntimeLoader.awaitInstance = function () {\n        return new Promise(function (resolve) {\n            return RuntimeLoader.getInstance(function (rive) { return resolve(rive); });\n        });\n    };\n    // Manually sets the wasm url\n    RuntimeLoader.setWasmUrl = function (url) {\n        RuntimeLoader.wasmURL = url;\n    };\n    // Flag to indicate that loading has started/completed\n    RuntimeLoader.isLoading = false;\n    // List of callbacks for the runtime that come in while loading\n    RuntimeLoader.callBackQueue = [];\n    // Path to the Wasm file; default path works for testing only;\n    // if embedded wasm is used then this is never used.\n    RuntimeLoader.wasmURL = \"https://unpkg.com/\".concat(package_json__WEBPACK_IMPORTED_MODULE_1__.name, \"@\").concat(package_json__WEBPACK_IMPORTED_MODULE_1__.version, \"/rive.wasm\");\n    return RuntimeLoader;\n}());\n\n// #endregion\n// #region state machines\nvar StateMachineInputType;\n(function (StateMachineInputType) {\n    StateMachineInputType[StateMachineInputType[\"Number\"] = 56] = \"Number\";\n    StateMachineInputType[StateMachineInputType[\"Trigger\"] = 58] = \"Trigger\";\n    StateMachineInputType[StateMachineInputType[\"Boolean\"] = 59] = \"Boolean\";\n})(StateMachineInputType || (StateMachineInputType = {}));\n/**\n * An input for a state machine\n */\nvar StateMachineInput = /** @class */ (function () {\n    function StateMachineInput(type, runtimeInput) {\n        this.type = type;\n        this.runtimeInput = runtimeInput;\n    }\n    Object.defineProperty(StateMachineInput.prototype, \"name\", {\n        /**\n         * Returns the name of the input\n         */\n        get: function () {\n            return this.runtimeInput.name;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(StateMachineInput.prototype, \"value\", {\n        /**\n         * Returns the current value of the input\n         */\n        get: function () {\n            return this.runtimeInput.value;\n        },\n        /**\n         * Sets the value of the input\n         */\n        set: function (value) {\n            this.runtimeInput.value = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Fires a trigger; does nothing on Number or Boolean input types\n     */\n    StateMachineInput.prototype.fire = function () {\n        if (this.type === StateMachineInputType.Trigger) {\n            this.runtimeInput.fire();\n        }\n    };\n    return StateMachineInput;\n}());\n\nvar RiveEventType;\n(function (RiveEventType) {\n    RiveEventType[RiveEventType[\"General\"] = 128] = \"General\";\n    RiveEventType[RiveEventType[\"OpenUrl\"] = 131] = \"OpenUrl\";\n})(RiveEventType || (RiveEventType = {}));\nvar StateMachine = /** @class */ (function () {\n    /**\n     * @constructor\n     * @param stateMachine runtime state machine object\n     * @param instance runtime state machine instance object\n     */\n    function StateMachine(stateMachine, runtime, playing, artboard) {\n        this.stateMachine = stateMachine;\n        this.playing = playing;\n        this.artboard = artboard;\n        /**\n         * Caches the inputs from the runtime\n         */\n        this.inputs = [];\n        this.instance = new runtime.StateMachineInstance(stateMachine, artboard);\n        this.initInputs(runtime);\n    }\n    Object.defineProperty(StateMachine.prototype, \"name\", {\n        get: function () {\n            return this.stateMachine.name;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(StateMachine.prototype, \"statesChanged\", {\n        /**\n         * Returns a list of state names that have changed on this frame\n         */\n        get: function () {\n            var names = [];\n            for (var i = 0; i < this.instance.stateChangedCount(); i++) {\n                names.push(this.instance.stateChangedNameByIndex(i));\n            }\n            return names;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Advances the state machine instance by a given time.\n     * @param time - the time to advance the animation by in seconds\n     */\n    StateMachine.prototype.advance = function (time) {\n        this.instance.advance(time);\n    };\n    /**\n     * Returns the number of events reported from the last advance call\n     * @returns Number of events reported\n     */\n    StateMachine.prototype.reportedEventCount = function () {\n        return this.instance.reportedEventCount();\n    };\n    /**\n     * Returns a RiveEvent object emitted from the last advance call at the given index\n     * of a list of potentially multiple events. If an event at the index is not found,\n     * undefined is returned.\n     * @param i index of the event reported in a list of potentially multiple events\n     * @returns RiveEvent or extended RiveEvent object returned, or undefined\n     */\n    StateMachine.prototype.reportedEventAt = function (i) {\n        return this.instance.reportedEventAt(i);\n    };\n    /**\n     * Fetches references to the state machine's inputs and caches them\n     * @param runtime an instance of the runtime; needed for the SMIInput types\n     */\n    StateMachine.prototype.initInputs = function (runtime) {\n        // Fetch the inputs from the runtime if we don't have them\n        for (var i = 0; i < this.instance.inputCount(); i++) {\n            var input = this.instance.input(i);\n            this.inputs.push(this.mapRuntimeInput(input, runtime));\n        }\n    };\n    /**\n     * Maps a runtime input to it's appropriate type\n     * @param input\n     */\n    StateMachine.prototype.mapRuntimeInput = function (input, runtime) {\n        if (input.type === runtime.SMIInput.bool) {\n            return new StateMachineInput(StateMachineInputType.Boolean, input.asBool());\n        }\n        else if (input.type === runtime.SMIInput.number) {\n            return new StateMachineInput(StateMachineInputType.Number, input.asNumber());\n        }\n        else if (input.type === runtime.SMIInput.trigger) {\n            return new StateMachineInput(StateMachineInputType.Trigger, input.asTrigger());\n        }\n    };\n    /**\n     * Deletes the backing Wasm state machine instance; once this is called, this\n     * state machine is no more.\n     */\n    StateMachine.prototype.cleanup = function () {\n        this.instance.delete();\n    };\n    return StateMachine;\n}());\n// #endregion\n// #region animator\n/**\n * Manages animation\n */\nvar Animator = /** @class */ (function () {\n    /**\n     * Constructs a new animator\n     * @constructor\n     * @param runtime Rive runtime; needed to instance animations & state machines\n     * @param artboard the artboard that holds all animations and state machines\n     * @param animations optional list of animations\n     * @param stateMachines optional list of state machines\n     */\n    function Animator(runtime, artboard, eventManager, animations, stateMachines) {\n        if (animations === void 0) { animations = []; }\n        if (stateMachines === void 0) { stateMachines = []; }\n        this.runtime = runtime;\n        this.artboard = artboard;\n        this.eventManager = eventManager;\n        this.animations = animations;\n        this.stateMachines = stateMachines;\n    }\n    /**\n     * Adds animations and state machines by their names. If names are shared\n     * between animations & state machines, then the first one found will be\n     * created. Best not to use the same names for these in your Rive file.\n     * @param animatable the name(s) of animations and state machines to add\n     * @returns a list of names of the playing animations and state machines\n     */\n    Animator.prototype.add = function (animatables, playing, fireEvent) {\n        if (fireEvent === void 0) { fireEvent = true; }\n        animatables = mapToStringArray(animatables);\n        // If animatables is empty, play or pause everything\n        if (animatables.length === 0) {\n            this.animations.forEach(function (a) { return (a.playing = playing); });\n            this.stateMachines.forEach(function (m) { return (m.playing = playing); });\n        }\n        else {\n            // Play/pause already instanced items, or create new instances\n            var instancedAnimationNames = this.animations.map(function (a) { return a.name; });\n            var instancedMachineNames = this.stateMachines.map(function (m) { return m.name; });\n            for (var i = 0; i < animatables.length; i++) {\n                var aIndex = instancedAnimationNames.indexOf(animatables[i]);\n                var mIndex = instancedMachineNames.indexOf(animatables[i]);\n                if (aIndex >= 0 || mIndex >= 0) {\n                    if (aIndex >= 0) {\n                        // Animation is instanced, play/pause it\n                        this.animations[aIndex].playing = playing;\n                    }\n                    else {\n                        // State machine is instanced, play/pause it\n                        this.stateMachines[mIndex].playing = playing;\n                    }\n                }\n                else {\n                    // Try to create a new animation instance\n                    var anim = this.artboard.animationByName(animatables[i]);\n                    if (anim) {\n                        var newAnimation = new _animation__WEBPACK_IMPORTED_MODULE_2__.Animation(anim, this.artboard, this.runtime, playing);\n                        // Display the first frame of the specified animation\n                        newAnimation.advance(0);\n                        newAnimation.apply(1.0);\n                        this.animations.push(newAnimation);\n                    }\n                    else {\n                        // Try to create a new state machine instance\n                        var sm = this.artboard.stateMachineByName(animatables[i]);\n                        if (sm) {\n                            var newStateMachine = new StateMachine(sm, this.runtime, playing, this.artboard);\n                            this.stateMachines.push(newStateMachine);\n                        }\n                    }\n                }\n            }\n        }\n        // Fire play/paused events for animations\n        if (fireEvent) {\n            if (playing) {\n                this.eventManager.fire({\n                    type: EventType.Play,\n                    data: this.playing,\n                });\n            }\n            else {\n                this.eventManager.fire({\n                    type: EventType.Pause,\n                    data: this.paused,\n                });\n            }\n        }\n        return playing ? this.playing : this.paused;\n    };\n    /**\n     * Adds linear animations by their names.\n     * @param animatables the name(s) of animations to add\n     * @param playing whether animations should play on instantiation\n     */\n    Animator.prototype.initLinearAnimations = function (animatables, playing) {\n        // Play/pause already instanced items, or create new instances\n        // This validation is kept to maintain compatibility with current behavior.\n        // But given that it this is called during artboard initialization\n        // it should probably be safe to remove.\n        var instancedAnimationNames = this.animations.map(function (a) { return a.name; });\n        for (var i = 0; i < animatables.length; i++) {\n            var aIndex = instancedAnimationNames.indexOf(animatables[i]);\n            if (aIndex >= 0) {\n                this.animations[aIndex].playing = playing;\n            }\n            else {\n                // Try to create a new animation instance\n                var anim = this.artboard.animationByName(animatables[i]);\n                if (anim) {\n                    var newAnimation = new _animation__WEBPACK_IMPORTED_MODULE_2__.Animation(anim, this.artboard, this.runtime, playing);\n                    // Display the first frame of the specified animation\n                    newAnimation.advance(0);\n                    newAnimation.apply(1.0);\n                    this.animations.push(newAnimation);\n                }\n            }\n        }\n    };\n    /**\n     * Adds state machines by their names.\n     * @param animatables the name(s) of state machines to add\n     * @param playing whether state machines should play on instantiation\n     */\n    Animator.prototype.initStateMachines = function (animatables, playing) {\n        // Play/pause already instanced items, or create new instances\n        // This validation is kept to maintain compatibility with current behavior.\n        // But given that it this is called during artboard initialization\n        // it should probably be safe to remove.\n        var instancedStateMachineNames = this.stateMachines.map(function (a) { return a.name; });\n        for (var i = 0; i < animatables.length; i++) {\n            var aIndex = instancedStateMachineNames.indexOf(animatables[i]);\n            if (aIndex >= 0) {\n                this.stateMachines[aIndex].playing = playing;\n            }\n            else {\n                // Try to create a new state machine instance\n                var sm = this.artboard.stateMachineByName(animatables[i]);\n                if (sm) {\n                    var newStateMachine = new StateMachine(sm, this.runtime, playing, this.artboard);\n                    this.stateMachines.push(newStateMachine);\n                }\n                else {\n                    // In order to maintain compatibility with current behavior, if a state machine is not found\n                    // we look for an animation with the same name\n                    this.initLinearAnimations([animatables[i]], playing);\n                }\n            }\n        }\n    };\n    /**\n     * Play the named animations/state machines\n     * @param animatables the names of the animations/machines to play; plays all if empty\n     * @returns a list of the playing items\n     */\n    Animator.prototype.play = function (animatables) {\n        return this.add(animatables, true);\n    };\n    /**\n     * Pauses named animations and state machines, or everything if nothing is\n     * specified\n     * @param animatables names of the animations and state machines to pause\n     * @returns a list of names of the animations and state machines paused\n     */\n    Animator.prototype.pause = function (animatables) {\n        return this.add(animatables, false);\n    };\n    /**\n     * Set time of named animations\n     * @param animations names of the animations to scrub\n     * @param value time scrub value, a floating point number to which the playhead is jumped\n     * @returns a list of names of the animations that were scrubbed\n     */\n    Animator.prototype.scrub = function (animatables, value) {\n        var forScrubbing = this.animations.filter(function (a) {\n            return animatables.includes(a.name);\n        });\n        forScrubbing.forEach(function (a) { return (a.scrubTo = value); });\n        return forScrubbing.map(function (a) { return a.name; });\n    };\n    Object.defineProperty(Animator.prototype, \"playing\", {\n        /**\n         * Returns a list of names of all animations and state machines currently\n         * playing\n         */\n        get: function () {\n            return this.animations\n                .filter(function (a) { return a.playing; })\n                .map(function (a) { return a.name; })\n                .concat(this.stateMachines.filter(function (m) { return m.playing; }).map(function (m) { return m.name; }));\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Animator.prototype, \"paused\", {\n        /**\n         * Returns a list of names of all animations and state machines currently\n         * paused\n         */\n        get: function () {\n            return this.animations\n                .filter(function (a) { return !a.playing; })\n                .map(function (a) { return a.name; })\n                .concat(this.stateMachines.filter(function (m) { return !m.playing; }).map(function (m) { return m.name; }));\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Stops and removes all named animations and state machines\n     * @param animatables animations and state machines to remove\n     * @returns a list of names of removed items\n     */\n    Animator.prototype.stop = function (animatables) {\n        var _this = this;\n        animatables = mapToStringArray(animatables);\n        // If nothing's specified, wipe them out, all of them\n        var removedNames = [];\n        // Stop everything\n        if (animatables.length === 0) {\n            removedNames = this.animations\n                .map(function (a) { return a.name; })\n                .concat(this.stateMachines.map(function (m) { return m.name; }));\n            // Clean up before emptying the arrays\n            this.animations.forEach(function (a) { return a.cleanup(); });\n            this.stateMachines.forEach(function (m) { return m.cleanup(); });\n            // Empty out the arrays\n            this.animations.splice(0, this.animations.length);\n            this.stateMachines.splice(0, this.stateMachines.length);\n        }\n        else {\n            // Remove only the named animations/state machines\n            var animationsToRemove = this.animations.filter(function (a) {\n                return animatables.includes(a.name);\n            });\n            animationsToRemove.forEach(function (a) {\n                a.cleanup();\n                _this.animations.splice(_this.animations.indexOf(a), 1);\n            });\n            var machinesToRemove = this.stateMachines.filter(function (m) {\n                return animatables.includes(m.name);\n            });\n            machinesToRemove.forEach(function (m) {\n                m.cleanup();\n                _this.stateMachines.splice(_this.stateMachines.indexOf(m), 1);\n            });\n            removedNames = animationsToRemove\n                .map(function (a) { return a.name; })\n                .concat(machinesToRemove.map(function (m) { return m.name; }));\n        }\n        this.eventManager.fire({\n            type: EventType.Stop,\n            data: removedNames,\n        });\n        // Return the list of animations removed\n        return removedNames;\n    };\n    Object.defineProperty(Animator.prototype, \"isPlaying\", {\n        /**\n         * Returns true if at least one animation is active\n         */\n        get: function () {\n            return (this.animations.reduce(function (acc, curr) { return acc || curr.playing; }, false) ||\n                this.stateMachines.reduce(function (acc, curr) { return acc || curr.playing; }, false));\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Animator.prototype, \"isPaused\", {\n        /**\n         * Returns true if all animations are paused and there's at least one animation\n         */\n        get: function () {\n            return (!this.isPlaying &&\n                (this.animations.length > 0 || this.stateMachines.length > 0));\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Animator.prototype, \"isStopped\", {\n        /**\n         * Returns true if there are no playing or paused animations/state machines\n         */\n        get: function () {\n            return this.animations.length === 0 && this.stateMachines.length === 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * If there are no animations or state machines, add the first one found\n     * @returns the name of the animation or state machine instanced\n     */\n    Animator.prototype.atLeastOne = function (playing, fireEvent) {\n        if (fireEvent === void 0) { fireEvent = true; }\n        var instancedName;\n        if (this.animations.length === 0 && this.stateMachines.length === 0) {\n            if (this.artboard.animationCount() > 0) {\n                // Add the first animation\n                this.add([(instancedName = this.artboard.animationByIndex(0).name)], playing, fireEvent);\n            }\n            else if (this.artboard.stateMachineCount() > 0) {\n                // Add the first state machine\n                this.add([(instancedName = this.artboard.stateMachineByIndex(0).name)], playing, fireEvent);\n            }\n        }\n        return instancedName;\n    };\n    /**\n     * Checks if any animations have looped and if so, fire the appropriate event\n     */\n    Animator.prototype.handleLooping = function () {\n        for (var _i = 0, _a = this.animations.filter(function (a) { return a.playing; }); _i < _a.length; _i++) {\n            var animation = _a[_i];\n            // Emit if the animation looped\n            if (animation.loopValue === 0 && animation.loopCount) {\n                animation.loopCount = 0;\n                // This is a one-shot; if it has ended, delete the instance\n                this.stop(animation.name);\n            }\n            else if (animation.loopValue === 1 && animation.loopCount) {\n                this.eventManager.fire({\n                    type: EventType.Loop,\n                    data: { animation: animation.name, type: LoopType.Loop },\n                });\n                animation.loopCount = 0;\n            }\n            // Wasm indicates a loop at each time the animation\n            // changes direction, so a full loop/lap occurs every\n            // two loop counts\n            else if (animation.loopValue === 2 && animation.loopCount > 1) {\n                this.eventManager.fire({\n                    type: EventType.Loop,\n                    data: { animation: animation.name, type: LoopType.PingPong },\n                });\n                animation.loopCount = 0;\n            }\n        }\n    };\n    /**\n     * Checks if states have changed in state machines and fires a statechange\n     * event\n     */\n    Animator.prototype.handleStateChanges = function () {\n        var statesChanged = [];\n        for (var _i = 0, _a = this.stateMachines.filter(function (sm) { return sm.playing; }); _i < _a.length; _i++) {\n            var stateMachine = _a[_i];\n            statesChanged.push.apply(statesChanged, stateMachine.statesChanged);\n        }\n        if (statesChanged.length > 0) {\n            this.eventManager.fire({\n                type: EventType.StateChange,\n                data: statesChanged,\n            });\n        }\n    };\n    Animator.prototype.handleAdvancing = function (time) {\n        this.eventManager.fire({\n            type: EventType.Advance,\n            data: time,\n        });\n    };\n    return Animator;\n}());\n// #endregion\n// #region events\n/**\n * Supported event types triggered in Rive\n */\nvar EventType;\n(function (EventType) {\n    EventType[\"Load\"] = \"load\";\n    EventType[\"LoadError\"] = \"loaderror\";\n    EventType[\"Play\"] = \"play\";\n    EventType[\"Pause\"] = \"pause\";\n    EventType[\"Stop\"] = \"stop\";\n    EventType[\"Loop\"] = \"loop\";\n    EventType[\"Draw\"] = \"draw\";\n    EventType[\"Advance\"] = \"advance\";\n    EventType[\"StateChange\"] = \"statechange\";\n    EventType[\"RiveEvent\"] = \"riveevent\";\n    EventType[\"AudioStatusChange\"] = \"audiostatuschange\";\n})(EventType || (EventType = {}));\n/**\n * Looping types: one-shot, loop, and ping-pong\n */\nvar LoopType;\n(function (LoopType) {\n    LoopType[\"OneShot\"] = \"oneshot\";\n    LoopType[\"Loop\"] = \"loop\";\n    LoopType[\"PingPong\"] = \"pingpong\";\n})(LoopType || (LoopType = {}));\n// Manages Rive events and listeners\nvar EventManager = /** @class */ (function () {\n    function EventManager(listeners) {\n        if (listeners === void 0) { listeners = []; }\n        this.listeners = listeners;\n    }\n    // Gets listeners of specified type\n    EventManager.prototype.getListeners = function (type) {\n        return this.listeners.filter(function (e) { return e.type === type; });\n    };\n    // Adds a listener\n    EventManager.prototype.add = function (listener) {\n        if (!this.listeners.includes(listener)) {\n            this.listeners.push(listener);\n        }\n    };\n    /**\n     * Removes a listener\n     * @param listener the listener with the callback to be removed\n     */\n    EventManager.prototype.remove = function (listener) {\n        // We can't simply look for the listener as it'll be a different instance to\n        // one originally subscribed. Find all the listeners of the right type and\n        // then check their callbacks which should match.\n        for (var i = 0; i < this.listeners.length; i++) {\n            var currentListener = this.listeners[i];\n            if (currentListener.type === listener.type) {\n                if (currentListener.callback === listener.callback) {\n                    this.listeners.splice(i, 1);\n                    break;\n                }\n            }\n        }\n    };\n    /**\n     * Clears all listeners of specified type, or every listener if no type is\n     * specified\n     * @param type the type of listeners to clear, or all listeners if not\n     * specified\n     */\n    EventManager.prototype.removeAll = function (type) {\n        var _this = this;\n        if (!type) {\n            this.listeners.splice(0, this.listeners.length);\n        }\n        else {\n            this.listeners\n                .filter(function (l) { return l.type === type; })\n                .forEach(function (l) { return _this.remove(l); });\n        }\n    };\n    // Fires an event\n    EventManager.prototype.fire = function (event) {\n        var eventListeners = this.getListeners(event.type);\n        eventListeners.forEach(function (listener) { return listener.callback(event); });\n    };\n    return EventManager;\n}());\n// Manages a queue of tasks\nvar TaskQueueManager = /** @class */ (function () {\n    function TaskQueueManager(eventManager) {\n        this.eventManager = eventManager;\n        this.queue = [];\n    }\n    // Adds a task top the queue\n    TaskQueueManager.prototype.add = function (task) {\n        this.queue.push(task);\n    };\n    // Processes all tasks in the queue\n    TaskQueueManager.prototype.process = function () {\n        while (this.queue.length > 0) {\n            var task = this.queue.shift();\n            if (task === null || task === void 0 ? void 0 : task.action) {\n                task.action();\n            }\n            if (task === null || task === void 0 ? void 0 : task.event) {\n                this.eventManager.fire(task.event);\n            }\n        }\n    };\n    return TaskQueueManager;\n}());\n// #endregion\n// #region Audio\nvar SystemAudioStatus;\n(function (SystemAudioStatus) {\n    SystemAudioStatus[SystemAudioStatus[\"AVAILABLE\"] = 0] = \"AVAILABLE\";\n    SystemAudioStatus[SystemAudioStatus[\"UNAVAILABLE\"] = 1] = \"UNAVAILABLE\";\n})(SystemAudioStatus || (SystemAudioStatus = {}));\n// Class to handle audio context availability and status changes\nvar AudioManager = /** @class */ (function (_super) {\n    __extends(AudioManager, _super);\n    function AudioManager() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this._started = false;\n        _this._enabled = false;\n        _this._status = SystemAudioStatus.UNAVAILABLE;\n        return _this;\n    }\n    AudioManager.prototype.delay = function (time) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, new Promise(function (resolve) { return setTimeout(resolve, time); })];\n            });\n        });\n    };\n    AudioManager.prototype.timeout = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, new Promise(function (_, reject) { return setTimeout(reject, 50); })];\n            });\n        });\n    };\n    // Alerts animations on status changes and removes the listeners to avoid alerting twice.\n    AudioManager.prototype.reportToListeners = function () {\n        this.fire({ type: EventType.AudioStatusChange });\n        this.removeAll();\n    };\n    /**\n     * The audio context has been resolved.\n     * Alert any listeners that we can now play audio.\n     * Rive will now play audio at the configured volume.\n     */\n    AudioManager.prototype.enableAudio = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                if (!this._enabled) {\n                    this._enabled = true;\n                    this._status = SystemAudioStatus.AVAILABLE;\n                    this.reportToListeners();\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    /**\n     * Check if we are able to play audio.\n     *\n     * We currently check the audio context, when resume() returns before a timeout we know that the\n     * audio context is running and we can enable audio.\n     */\n    AudioManager.prototype.testAudio = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!(this._status === SystemAudioStatus.UNAVAILABLE &&\n                            this._audioContext !== null)) return [3 /*break*/, 4];\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, Promise.race([this._audioContext.resume(), this.timeout()])];\n                    case 2:\n                        _b.sent();\n                        this.enableAudio();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        _a = _b.sent();\n                        return [3 /*break*/, 4];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Establish audio for use with rive.\n     * We both test if we can use audio intermittently and listen for user interaction.\n     * The aim is to enable audio playback as soon as the browser allows this.\n     */\n    AudioManager.prototype._establishAudio = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!!this._started) return [3 /*break*/, 5];\n                        this._started = true;\n                        if (!(typeof window == \"undefined\")) return [3 /*break*/, 1];\n                        this.enableAudio();\n                        return [3 /*break*/, 5];\n                    case 1:\n                        this._audioContext = new AudioContext();\n                        this.listenForUserAction();\n                        _a.label = 2;\n                    case 2:\n                        if (!(this._status === SystemAudioStatus.UNAVAILABLE)) return [3 /*break*/, 5];\n                        return [4 /*yield*/, this.testAudio()];\n                    case 3:\n                        _a.sent();\n                        return [4 /*yield*/, this.delay(1000)];\n                    case 4:\n                        _a.sent();\n                        return [3 /*break*/, 2];\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    AudioManager.prototype.listenForUserAction = function () {\n        var _this = this;\n        // NOTE: AudioContexts are ready immediately if requested in a ui callback\n        // we *could* re request one in this listener.\n        var _clickListener = function () { return __awaiter(_this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                // note this has \"better\" results than calling `await this.testAudio()`\n                // as we force audio to be enabled in the current thread, rather than chancing\n                // the thread to be passed over for some other async context\n                this.enableAudio();\n                return [2 /*return*/];\n            });\n        }); };\n        // NOTE: we should test this on mobile/pads\n        document.addEventListener(\"pointerdown\", _clickListener, {\n            once: true,\n        });\n    };\n    /**\n     * Establish the audio context for rive, this lets rive know that we can play audio.\n     */\n    AudioManager.prototype.establishAudio = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                this._establishAudio();\n                return [2 /*return*/];\n            });\n        });\n    };\n    Object.defineProperty(AudioManager.prototype, \"systemVolume\", {\n        get: function () {\n            if (this._status === SystemAudioStatus.UNAVAILABLE) {\n                // We do an immediate test to avoid depending on the delay of the running test\n                this.testAudio();\n                return 0;\n            }\n            return 1;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(AudioManager.prototype, \"status\", {\n        get: function () {\n            return this._status;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return AudioManager;\n}(EventManager));\nvar audioManager = new AudioManager();\nvar FakeResizeObserver = /** @class */ (function () {\n    function FakeResizeObserver() {\n    }\n    FakeResizeObserver.prototype.observe = function () { };\n    FakeResizeObserver.prototype.unobserve = function () { };\n    FakeResizeObserver.prototype.disconnect = function () { };\n    return FakeResizeObserver;\n}());\nvar MyResizeObserver = globalThis.ResizeObserver || FakeResizeObserver;\n/**\n * This class takes care of any observers that will be attached to an animation.\n * It should be treated as a singleton because observers are much more performant\n * when used for observing multiple elements by a single instance.\n */\nvar ObjectObservers = /** @class */ (function () {\n    function ObjectObservers() {\n        var _this = this;\n        this._elementsMap = new Map();\n        /**\n         * Resize observers trigger both when the element changes its size and also when the\n         * element is added or removed from the document.\n         */\n        this._onObservedEntry = function (entry) {\n            var observed = _this._elementsMap.get(entry.target);\n            if (observed !== null) {\n                observed.onResize(entry.target.clientWidth == 0 || entry.target.clientHeight == 0);\n            }\n            else {\n                _this._resizeObserver.unobserve(entry.target);\n            }\n        };\n        this._onObserved = function (entries) {\n            entries.forEach(_this._onObservedEntry);\n        };\n        this._resizeObserver = new MyResizeObserver(this._onObserved);\n    }\n    // Adds an observable element\n    ObjectObservers.prototype.add = function (element, onResize) {\n        var observed = {\n            onResize: onResize,\n            element: element,\n        };\n        this._elementsMap.set(element, observed);\n        this._resizeObserver.observe(element);\n        return observed;\n    };\n    // Removes an observable element\n    ObjectObservers.prototype.remove = function (observed) {\n        this._resizeObserver.unobserve(observed.element);\n        this._elementsMap.delete(observed.element);\n    };\n    return ObjectObservers;\n}());\nvar observers = new ObjectObservers();\nvar RiveFile = /** @class */ (function () {\n    function RiveFile(params) {\n        // Allow the runtime to automatically load assets hosted in Rive's runtime.\n        this.enableRiveAssetCDN = true;\n        this.referenceCount = 0;\n        this.src = params.src;\n        this.buffer = params.buffer;\n        if (params.assetLoader)\n            this.assetLoader = params.assetLoader;\n        this.enableRiveAssetCDN =\n            typeof params.enableRiveAssetCDN == \"boolean\"\n                ? params.enableRiveAssetCDN\n                : true;\n        // New event management system\n        this.eventManager = new EventManager();\n        if (params.onLoad)\n            this.on(EventType.Load, params.onLoad);\n        if (params.onLoadError)\n            this.on(EventType.LoadError, params.onLoadError);\n    }\n    RiveFile.prototype.initData = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, loader, _b;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        if (!this.src) return [3 /*break*/, 2];\n                        _a = this;\n                        return [4 /*yield*/, loadRiveFile(this.src)];\n                    case 1:\n                        _a.buffer = _c.sent();\n                        _c.label = 2;\n                    case 2:\n                        if (this.assetLoader) {\n                            loader = new this.runtime.CustomFileAssetLoader({\n                                loadContents: this.assetLoader,\n                            });\n                        }\n                        // Load the Rive file\n                        _b = this;\n                        return [4 /*yield*/, this.runtime.load(new Uint8Array(this.buffer), loader, this.enableRiveAssetCDN)];\n                    case 3:\n                        // Load the Rive file\n                        _b.file = _c.sent();\n                        if (this.file !== null) {\n                            this.eventManager.fire({\n                                type: EventType.Load,\n                                data: this,\n                            });\n                        }\n                        else {\n                            this.eventManager.fire({\n                                type: EventType.LoadError,\n                                data: null,\n                            });\n                            throw new Error(RiveFile.fileLoadErrorMessage);\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    RiveFile.prototype.init = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        // If no source file url specified, it's a bust\n                        if (!this.src && !this.buffer) {\n                            throw new Error(RiveFile.missingErrorMessage);\n                        }\n                        _a = this;\n                        return [4 /*yield*/, RuntimeLoader.awaitInstance()];\n                    case 1:\n                        _a.runtime = _b.sent();\n                        return [4 /*yield*/, this.initData()];\n                    case 2:\n                        _b.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Subscribe to Rive-generated events\n     * @param type the type of event to subscribe to\n     * @param callback callback to fire when the event occurs\n     */\n    RiveFile.prototype.on = function (type, callback) {\n        this.eventManager.add({\n            type: type,\n            callback: callback,\n        });\n    };\n    /**\n     * Unsubscribes from a Rive-generated event\n     * @param type the type of event to unsubscribe from\n     * @param callback the callback to unsubscribe\n     */\n    RiveFile.prototype.off = function (type, callback) {\n        this.eventManager.remove({\n            type: type,\n            callback: callback,\n        });\n    };\n    RiveFile.prototype.cleanup = function () {\n        var _a;\n        this.referenceCount -= 1;\n        if (this.referenceCount <= 0) {\n            this.removeAllRiveEventListeners();\n            (_a = this.file) === null || _a === void 0 ? void 0 : _a.delete();\n        }\n    };\n    /**\n     * Unsubscribes all Rive listeners from an event type, or everything if no type is\n     * given\n     * @param type the type of event to unsubscribe from, or all types if\n     * undefined\n     */\n    RiveFile.prototype.removeAllRiveEventListeners = function (type) {\n        this.eventManager.removeAll(type);\n    };\n    RiveFile.prototype.getInstance = function () {\n        if (this.file !== null) {\n            this.referenceCount += 1;\n            return this.file;\n        }\n    };\n    // Error message for missing source or buffer\n    RiveFile.missingErrorMessage = \"Rive source file or data buffer required\";\n    // Error message for file load error\n    RiveFile.fileLoadErrorMessage = \"The file failed to load\";\n    return RiveFile;\n}());\n\nvar Rive = /** @class */ (function () {\n    function Rive(params) {\n        var _this = this;\n        var _a;\n        // Tracks if a Rive file is loaded\n        this.loaded = false;\n        /**\n         * Tracks if a Rive file is loaded; we need this in addition to loaded as some\n         * commands (e.g. contents) can be called as soon as the file is loaded.\n         * However, playback commands need to be queued and run in order once initial\n         * animations and autoplay has been sorted out. This applies to play, pause,\n         * and start.\n         */\n        this.readyForPlaying = false;\n        // Runtime artboard\n        this.artboard = null;\n        // place to clear up event listeners\n        this.eventCleanup = null;\n        this.shouldDisableRiveListeners = false;\n        this.automaticallyHandleEvents = false;\n        // Allow the runtime to automatically load assets hosted in Rive's runtime.\n        this.enableRiveAssetCDN = true;\n        // Keep a local value of the set volume to update it asynchronously\n        this._volume = 1;\n        // Whether the canvas element's size is 0\n        this._hasZeroSize = false;\n        // Durations to generate a frame for the last second. Used for performance profiling.\n        this.durations = [];\n        this.frameTimes = [];\n        this.frameCount = 0;\n        this.isTouchScrollEnabled = false;\n        this.onCanvasResize = function (hasZeroSize) {\n            _this._hasZeroSize = hasZeroSize;\n            if (!_this._layout.maxX || !_this._layout.maxY) {\n                _this.resizeToCanvas();\n            }\n        };\n        /**\n         * Used be draw to track when a second of active rendering time has passed.\n         * Used for debugging purposes\n         */\n        this.renderSecondTimer = 0;\n        this.canvas = params.canvas;\n        if (params.canvas.constructor === HTMLCanvasElement) {\n            this._observed = observers.add(this.canvas, this.onCanvasResize);\n        }\n        this.src = params.src;\n        this.buffer = params.buffer;\n        this.riveFile = params.riveFile;\n        this.layout = (_a = params.layout) !== null && _a !== void 0 ? _a : new Layout();\n        this.shouldDisableRiveListeners = !!params.shouldDisableRiveListeners;\n        this.isTouchScrollEnabled = !!params.isTouchScrollEnabled;\n        this.automaticallyHandleEvents = !!params.automaticallyHandleEvents;\n        this.enableRiveAssetCDN =\n            params.enableRiveAssetCDN === undefined\n                ? true\n                : params.enableRiveAssetCDN;\n        // New event management system\n        this.eventManager = new EventManager();\n        if (params.onLoad)\n            this.on(EventType.Load, params.onLoad);\n        if (params.onLoadError)\n            this.on(EventType.LoadError, params.onLoadError);\n        if (params.onPlay)\n            this.on(EventType.Play, params.onPlay);\n        if (params.onPause)\n            this.on(EventType.Pause, params.onPause);\n        if (params.onStop)\n            this.on(EventType.Stop, params.onStop);\n        if (params.onLoop)\n            this.on(EventType.Loop, params.onLoop);\n        if (params.onStateChange)\n            this.on(EventType.StateChange, params.onStateChange);\n        if (params.onAdvance)\n            this.on(EventType.Advance, params.onAdvance);\n        /**\n         * @deprecated Use camelCase'd versions instead.\n         */\n        if (params.onload && !params.onLoad)\n            this.on(EventType.Load, params.onload);\n        if (params.onloaderror && !params.onLoadError)\n            this.on(EventType.LoadError, params.onloaderror);\n        if (params.onplay && !params.onPlay)\n            this.on(EventType.Play, params.onplay);\n        if (params.onpause && !params.onPause)\n            this.on(EventType.Pause, params.onpause);\n        if (params.onstop && !params.onStop)\n            this.on(EventType.Stop, params.onstop);\n        if (params.onloop && !params.onLoop)\n            this.on(EventType.Loop, params.onloop);\n        if (params.onstatechange && !params.onStateChange)\n            this.on(EventType.StateChange, params.onstatechange);\n        /**\n         * Asset loading\n         */\n        if (params.assetLoader)\n            this.assetLoader = params.assetLoader;\n        // Hook up the task queue\n        this.taskQueue = new TaskQueueManager(this.eventManager);\n        this.init({\n            src: this.src,\n            buffer: this.buffer,\n            riveFile: this.riveFile,\n            autoplay: params.autoplay,\n            animations: params.animations,\n            stateMachines: params.stateMachines,\n            artboard: params.artboard,\n            useOffscreenRenderer: params.useOffscreenRenderer,\n        });\n    }\n    // Alternative constructor to build a Rive instance from an interface/object\n    Rive.new = function (params) {\n        console.warn(\"This function is deprecated: please use `new Rive({})` instead\");\n        return new Rive(params);\n    };\n    // Event handler for when audio context becomes available\n    Rive.prototype.onSystemAudioChanged = function () {\n        this.volume = this._volume;\n    };\n    // Initializes the Rive object either from constructor or load()\n    Rive.prototype.init = function (_a) {\n        var _this = this;\n        var src = _a.src, buffer = _a.buffer, riveFile = _a.riveFile, animations = _a.animations, stateMachines = _a.stateMachines, artboard = _a.artboard, _b = _a.autoplay, autoplay = _b === void 0 ? false : _b, _c = _a.useOffscreenRenderer, useOffscreenRenderer = _c === void 0 ? false : _c;\n        this.src = src;\n        this.buffer = buffer;\n        this.riveFile = riveFile;\n        // If no source file url specified, it's a bust\n        if (!this.src && !this.buffer && !this.riveFile) {\n            throw new Error(Rive.missingErrorMessage);\n        }\n        // List of animations that should be initialized.\n        var startingAnimationNames = mapToStringArray(animations);\n        // List of state machines that should be initialized\n        var startingStateMachineNames = mapToStringArray(stateMachines);\n        // Ensure loaded is marked as false if loading new file\n        this.loaded = false;\n        this.readyForPlaying = false;\n        // Ensure the runtime is loaded\n        RuntimeLoader.awaitInstance()\n            .then(function (runtime) {\n            _this.runtime = runtime;\n            // Get the canvas where you want to render the animation and create a renderer\n            _this.renderer = _this.runtime.makeRenderer(_this.canvas, useOffscreenRenderer);\n            // Initial size adjustment based on devicePixelRatio if no width/height are\n            // specified explicitly\n            if (!(_this.canvas.width || _this.canvas.height)) {\n                _this.resizeDrawingSurfaceToCanvas();\n            }\n            // Load Rive data from a source uri or a data buffer\n            _this.initData(artboard, startingAnimationNames, startingStateMachineNames, autoplay)\n                .then(function () { return _this.setupRiveListeners(); })\n                .catch(function (e) {\n                console.error(e);\n            });\n        })\n            .catch(function (e) {\n            console.error(e);\n        });\n    };\n    /**\n     * Setup Rive Listeners on the canvas\n     * @param riveListenerOptions - Enables TouchEvent events on the canvas. Set to true to allow\n     * touch scrolling on the canvas element on touch-enabled devices\n     * i.e. { isTouchScrollEnabled: true }\n     */\n    Rive.prototype.setupRiveListeners = function (riveListenerOptions) {\n        var _this = this;\n        if (!this.shouldDisableRiveListeners) {\n            var activeStateMachines = (this.animator.stateMachines || [])\n                .filter(function (sm) { return sm.playing && _this.runtime.hasListeners(sm.instance); })\n                .map(function (sm) { return sm.instance; });\n            var touchScrollEnabledOption = this.isTouchScrollEnabled;\n            if (riveListenerOptions &&\n                \"isTouchScrollEnabled\" in riveListenerOptions) {\n                touchScrollEnabledOption = riveListenerOptions.isTouchScrollEnabled;\n            }\n            this.eventCleanup = (0,_utils__WEBPACK_IMPORTED_MODULE_3__.registerTouchInteractions)({\n                canvas: this.canvas,\n                artboard: this.artboard,\n                stateMachines: activeStateMachines,\n                renderer: this.renderer,\n                rive: this.runtime,\n                fit: this._layout.runtimeFit(this.runtime),\n                alignment: this._layout.runtimeAlignment(this.runtime),\n                isTouchScrollEnabled: touchScrollEnabledOption,\n            });\n        }\n    };\n    /**\n     * Remove Rive Listeners setup on the canvas\n     */\n    Rive.prototype.removeRiveListeners = function () {\n        if (this.eventCleanup) {\n            this.eventCleanup();\n        }\n    };\n    /**\n     * If the instance has audio and the system audio is not ready\n     * we hook the instance to the audio manager\n     */\n    Rive.prototype.initializeAudio = function () {\n        var _this = this;\n        var _a;\n        // Initialize audio if needed\n        if (audioManager.status == SystemAudioStatus.UNAVAILABLE) {\n            if ((_a = this.artboard) === null || _a === void 0 ? void 0 : _a.hasAudio) {\n                audioManager.add({\n                    type: EventType.AudioStatusChange,\n                    callback: function () { return _this.onSystemAudioChanged(); },\n                });\n                audioManager.establishAudio();\n            }\n        }\n    };\n    // Initializes runtime with Rive data and preps for playing\n    Rive.prototype.initData = function (artboardName, animationNames, stateMachineNames, autoplay) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var error_1, msg;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _b.trys.push([0, 3, , 4]);\n                        if (!(this.riveFile == null)) return [3 /*break*/, 2];\n                        this.riveFile = new RiveFile({\n                            src: this.src,\n                            buffer: this.buffer,\n                            enableRiveAssetCDN: this.enableRiveAssetCDN,\n                            assetLoader: this.assetLoader,\n                        });\n                        return [4 /*yield*/, this.riveFile.init()];\n                    case 1:\n                        _b.sent();\n                        _b.label = 2;\n                    case 2:\n                        this.file = this.riveFile.getInstance();\n                        // Initialize and draw frame\n                        this.initArtboard(artboardName, animationNames, stateMachineNames, autoplay);\n                        // Check for audio\n                        this.initializeAudio();\n                        // Everything's set up, emit a load event\n                        this.loaded = true;\n                        this.eventManager.fire({\n                            type: EventType.Load,\n                            data: (_a = this.src) !== null && _a !== void 0 ? _a : \"buffer\",\n                        });\n                        // Flag ready for playback commands and clear the task queue; this order\n                        // is important or it may infinitely recurse\n                        this.readyForPlaying = true;\n                        this.taskQueue.process();\n                        this.drawFrame();\n                        return [2 /*return*/, Promise.resolve()];\n                    case 3:\n                        error_1 = _b.sent();\n                        msg = \"Problem loading file; may be corrupt!\";\n                        console.warn(msg);\n                        this.eventManager.fire({ type: EventType.LoadError, data: msg });\n                        return [2 /*return*/, Promise.reject(msg)];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    // Initialize for playback\n    Rive.prototype.initArtboard = function (artboardName, animationNames, stateMachineNames, autoplay) {\n        if (!this.file) {\n            return;\n        }\n        // Fetch the artboard\n        var rootArtboard = artboardName\n            ? this.file.artboardByName(artboardName)\n            : this.file.defaultArtboard();\n        // Check we have a working artboard\n        if (!rootArtboard) {\n            var msg = \"Invalid artboard name or no default artboard\";\n            console.warn(msg);\n            this.eventManager.fire({ type: EventType.LoadError, data: msg });\n            return;\n        }\n        this.artboard = rootArtboard;\n        rootArtboard.volume = this._volume * audioManager.systemVolume;\n        // Check that the artboard has at least 1 animation\n        if (this.artboard.animationCount() < 1) {\n            var msg = \"Artboard has no animations\";\n            this.eventManager.fire({ type: EventType.LoadError, data: msg });\n            throw msg;\n        }\n        // Initialize the animator\n        this.animator = new Animator(this.runtime, this.artboard, this.eventManager);\n        // Initialize the animations; as loaded hasn't happened yet, we need to\n        // suppress firing the play/pause events until the load event has fired. To\n        // do this we tell the animator to suppress firing events, and add event\n        // firing to the task queue.\n        var instanceNames;\n        if (animationNames.length > 0 || stateMachineNames.length > 0) {\n            instanceNames = animationNames.concat(stateMachineNames);\n            this.animator.initLinearAnimations(animationNames, autoplay);\n            this.animator.initStateMachines(stateMachineNames, autoplay);\n        }\n        else {\n            instanceNames = [this.animator.atLeastOne(autoplay, false)];\n        }\n        // Queue up firing the playback events\n        this.taskQueue.add({\n            event: {\n                type: autoplay ? EventType.Play : EventType.Pause,\n                data: instanceNames,\n            },\n        });\n    };\n    // Draws the current artboard frame\n    Rive.prototype.drawFrame = function () {\n        this.startRendering();\n    };\n    /**\n     * Draw rendering loop; renders animation frames at the correct time interval.\n     * @param time the time at which to render a frame\n     */\n    Rive.prototype.draw = function (time, onSecond) {\n        // Clear the frameRequestId, as we're now rendering a fresh frame\n        this.frameRequestId = null;\n        var before = performance.now();\n        // On the first pass, make sure lastTime has a valid value\n        if (!this.lastRenderTime) {\n            this.lastRenderTime = time;\n        }\n        // Handle the onSecond callback\n        this.renderSecondTimer += time - this.lastRenderTime;\n        if (this.renderSecondTimer > 5000) {\n            this.renderSecondTimer = 0;\n            onSecond === null || onSecond === void 0 ? void 0 : onSecond();\n        }\n        // Calculate the elapsed time between frames in seconds\n        var elapsedTime = (time - this.lastRenderTime) / 1000;\n        this.lastRenderTime = time;\n        // - Advance non-paused animations by the elapsed number of seconds\n        // - Advance any animations that require scrubbing\n        // - Advance to the first frame even when autoplay is false\n        var activeAnimations = this.animator.animations\n            .filter(function (a) { return a.playing || a.needsScrub; })\n            // The scrubbed animations must be applied first to prevent weird artifacts\n            // if the playing animations conflict with the scrubbed animating attribuates.\n            .sort(function (first) { return (first.needsScrub ? -1 : 1); });\n        for (var _i = 0, activeAnimations_1 = activeAnimations; _i < activeAnimations_1.length; _i++) {\n            var animation = activeAnimations_1[_i];\n            animation.advance(elapsedTime);\n            if (animation.instance.didLoop) {\n                animation.loopCount += 1;\n            }\n            animation.apply(1.0);\n        }\n        // - Advance non-paused state machines by the elapsed number of seconds\n        // - Advance to the first frame even when autoplay is false\n        var activeStateMachines = this.animator.stateMachines.filter(function (a) { return a.playing; });\n        for (var _a = 0, activeStateMachines_1 = activeStateMachines; _a < activeStateMachines_1.length; _a++) {\n            var stateMachine = activeStateMachines_1[_a];\n            // Check for events before the current frame's state machine advance\n            var numEventsReported = stateMachine.reportedEventCount();\n            if (numEventsReported) {\n                for (var i = 0; i < numEventsReported; i++) {\n                    var event_1 = stateMachine.reportedEventAt(i);\n                    if (event_1) {\n                        if (event_1.type === RiveEventType.OpenUrl) {\n                            this.eventManager.fire({\n                                type: EventType.RiveEvent,\n                                data: event_1,\n                            });\n                            // Handle the event side effect if explicitly enabled\n                            if (this.automaticallyHandleEvents) {\n                                var newAnchorTag = document.createElement(\"a\");\n                                var _b = event_1, url = _b.url, target = _b.target;\n                                var sanitizedUrl = (0,_utils__WEBPACK_IMPORTED_MODULE_3__.sanitizeUrl)(url);\n                                url && newAnchorTag.setAttribute(\"href\", sanitizedUrl);\n                                target && newAnchorTag.setAttribute(\"target\", target);\n                                if (sanitizedUrl && sanitizedUrl !== _utils__WEBPACK_IMPORTED_MODULE_3__.BLANK_URL) {\n                                    newAnchorTag.click();\n                                }\n                            }\n                        }\n                        else {\n                            this.eventManager.fire({\n                                type: EventType.RiveEvent,\n                                data: event_1,\n                            });\n                        }\n                    }\n                }\n            }\n            stateMachine.advance(elapsedTime);\n            // stateMachine.instance.apply(this.artboard);\n        }\n        // Once the animations have been applied to the artboard, advance it\n        // by the elapsed time.\n        this.artboard.advance(elapsedTime);\n        var renderer = this.renderer;\n        // Canvas must be wiped to prevent artifacts\n        renderer.clear();\n        renderer.save();\n        // Update the renderer alignment if necessary\n        this.alignRenderer();\n        // Do not draw on 0 canvas size\n        if (!this._hasZeroSize) {\n            this.artboard.draw(renderer);\n        }\n        renderer.restore();\n        renderer.flush();\n        // Check for any animations that looped\n        this.animator.handleLooping();\n        // Check for any state machines that had a state change\n        this.animator.handleStateChanges();\n        // Report advanced time\n        this.animator.handleAdvancing(elapsedTime);\n        // Add duration to create frame to durations array\n        this.frameCount++;\n        var after = performance.now();\n        this.frameTimes.push(after);\n        this.durations.push(after - before);\n        while (this.frameTimes[0] <= after - 1000) {\n            this.frameTimes.shift();\n            this.durations.shift();\n        }\n        // Calling requestAnimationFrame will rerun draw() at the correct rate:\n        // https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Basic_animations\n        if (this.animator.isPlaying) {\n            // Request a new rendering frame\n            this.startRendering();\n        }\n        else if (this.animator.isPaused) {\n            // Reset the end time so on playback it starts at the correct frame\n            this.lastRenderTime = 0;\n        }\n        else if (this.animator.isStopped) {\n            // Reset animation instances, artboard and time\n            // TODO: implement this properly when we have instancing\n            // this.initArtboard();\n            // this.drawFrame();\n            this.lastRenderTime = 0;\n        }\n    };\n    /**\n     * Align the renderer\n     */\n    Rive.prototype.alignRenderer = function () {\n        var _a = this, renderer = _a.renderer, runtime = _a.runtime, _layout = _a._layout, artboard = _a.artboard;\n        // Align things up safe in the knowledge we can restore if changed\n        renderer.align(_layout.runtimeFit(runtime), _layout.runtimeAlignment(runtime), {\n            minX: _layout.minX,\n            minY: _layout.minY,\n            maxX: _layout.maxX,\n            maxY: _layout.maxY,\n        }, artboard.bounds);\n    };\n    Object.defineProperty(Rive.prototype, \"fps\", {\n        get: function () {\n            return this.durations.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Rive.prototype, \"frameTime\", {\n        get: function () {\n            if (this.durations.length === 0) {\n                return 0;\n            }\n            return (this.durations.reduce(function (a, b) { return a + b; }, 0) / this.durations.length).toFixed(4);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Cleans up all Wasm-generated objects that need to be manually destroyed:\n     * artboard instances, animation instances, state machine instances,\n     * renderer instance, file and runtime.\n     *\n     * Once this is called, you will need to initialise a new instance of the\n     * Rive class\n     */\n    Rive.prototype.cleanup = function () {\n        var _a;\n        // Stop the renderer if it hasn't already been stopped.\n        this.stopRendering();\n        // Clean up any artboard, animation or state machine instances.\n        this.cleanupInstances();\n        // Remove from observer\n        if (this._observed !== null) {\n            observers.remove(this._observed);\n        }\n        (_a = this.riveFile) === null || _a === void 0 ? void 0 : _a.cleanup();\n        this.riveFile = null;\n        this.file = null;\n    };\n    /**\n     * Cleans up the Renderer object. Only call this API if you no longer\n     * need to render Rive content in your session.\n     */\n    Rive.prototype.deleteRiveRenderer = function () {\n        var _a;\n        (_a = this.renderer) === null || _a === void 0 ? void 0 : _a.delete();\n        this.renderer = null;\n    };\n    /**\n     * Cleans up any Wasm-generated objects that need to be manually destroyed:\n     * artboard instances, animation instances, state machine instances.\n     *\n     * Once this is called, things will need to be reinitialized or bad things\n     * might happen.\n     */\n    Rive.prototype.cleanupInstances = function () {\n        if (this.eventCleanup !== null) {\n            this.eventCleanup();\n        }\n        // Delete all animation and state machine instances\n        this.stop();\n        if (this.artboard) {\n            this.artboard.delete();\n            this.artboard = null;\n        }\n    };\n    /**\n     * Tries to query the setup Artboard for a text run node with the given name.\n     *\n     * @param textRunName - Name of the text run node associated with a text object\n     * @returns - TextValueRun node or undefined if the text run cannot be queried\n     */\n    Rive.prototype.retrieveTextRun = function (textRunName) {\n        var _a;\n        if (!textRunName) {\n            console.warn(\"No text run name provided\");\n            return;\n        }\n        if (!this.artboard) {\n            console.warn(\"Tried to access text run, but the Artboard is null\");\n            return;\n        }\n        var textRun = this.artboard.textRun(textRunName);\n        if (!textRun) {\n            console.warn(\"Could not access a text run with name '\".concat(textRunName, \"' in the '\").concat((_a = this.artboard) === null || _a === void 0 ? void 0 : _a.name, \"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime.\"));\n            return;\n        }\n        return textRun;\n    };\n    /**\n     * Returns a string from a given text run node name, or undefined if the text run\n     * cannot be queried.\n     *\n     * @param textRunName - Name of the text run node associated with a text object\n     * @returns - String value of the text run node or undefined\n     */\n    Rive.prototype.getTextRunValue = function (textRunName) {\n        var textRun = this.retrieveTextRun(textRunName);\n        return textRun ? textRun.text : undefined;\n    };\n    /**\n     * Sets a text value for a given text run node name if possible\n     *\n     * @param textRunName - Name of the text run node associated with a text object\n     * @param textRunValue - String value to set on the text run node\n     */\n    Rive.prototype.setTextRunValue = function (textRunName, textRunValue) {\n        var textRun = this.retrieveTextRun(textRunName);\n        if (textRun) {\n            textRun.text = textRunValue;\n        }\n    };\n    // Plays specified animations; if none specified, it unpauses everything.\n    Rive.prototype.play = function (animationNames, autoplay) {\n        var _this = this;\n        animationNames = mapToStringArray(animationNames);\n        // If the file's not loaded, queue up the play\n        if (!this.readyForPlaying) {\n            this.taskQueue.add({\n                action: function () { return _this.play(animationNames, autoplay); },\n            });\n            return;\n        }\n        this.animator.play(animationNames);\n        if (this.eventCleanup) {\n            this.eventCleanup();\n        }\n        this.setupRiveListeners();\n        this.startRendering();\n    };\n    // Pauses specified animations; if none specified, pauses all.\n    Rive.prototype.pause = function (animationNames) {\n        var _this = this;\n        animationNames = mapToStringArray(animationNames);\n        // If the file's not loaded, early out, nothing to pause\n        if (!this.readyForPlaying) {\n            this.taskQueue.add({\n                action: function () { return _this.pause(animationNames); },\n            });\n            return;\n        }\n        if (this.eventCleanup) {\n            this.eventCleanup();\n        }\n        this.animator.pause(animationNames);\n    };\n    Rive.prototype.scrub = function (animationNames, value) {\n        var _this = this;\n        animationNames = mapToStringArray(animationNames);\n        // If the file's not loaded, early out, nothing to pause\n        if (!this.readyForPlaying) {\n            this.taskQueue.add({\n                action: function () { return _this.scrub(animationNames, value); },\n            });\n            return;\n        }\n        // Scrub the animation time; we draw a single frame here so that if\n        // nothing's currently playing, the scrubbed animation is still rendered/\n        this.animator.scrub(animationNames, value || 0);\n        this.drawFrame();\n    };\n    // Stops specified animations; if none specifies, stops them all.\n    Rive.prototype.stop = function (animationNames) {\n        var _this = this;\n        animationNames = mapToStringArray(animationNames);\n        // If the file's not loaded, early out, nothing to pause\n        if (!this.readyForPlaying) {\n            this.taskQueue.add({\n                action: function () { return _this.stop(animationNames); },\n            });\n            return;\n        }\n        this.animator.stop(animationNames);\n        if (this.eventCleanup) {\n            this.eventCleanup();\n        }\n    };\n    /**\n     * Resets the animation\n     * @param artboard the name of the artboard, or default if none given\n     * @param animations the names of animations for playback\n     * @param stateMachines the names of state machines for playback\n     * @param autoplay whether to autoplay when reset, defaults to false\n     *\n     */\n    Rive.prototype.reset = function (params) {\n        var _a;\n        // Get the current artboard, animations, state machines, and playback states\n        var artBoardName = params === null || params === void 0 ? void 0 : params.artboard;\n        var animationNames = mapToStringArray(params === null || params === void 0 ? void 0 : params.animations);\n        var stateMachineNames = mapToStringArray(params === null || params === void 0 ? void 0 : params.stateMachines);\n        var autoplay = (_a = params === null || params === void 0 ? void 0 : params.autoplay) !== null && _a !== void 0 ? _a : false;\n        // Stop everything and clean up\n        this.cleanupInstances();\n        // Reinitialize an artboard instance with the state\n        this.initArtboard(artBoardName, animationNames, stateMachineNames, autoplay);\n        this.taskQueue.process();\n    };\n    // Loads a new Rive file, keeping listeners in place\n    Rive.prototype.load = function (params) {\n        this.file = null;\n        // Stop all animations\n        this.stop();\n        // Reinitialize\n        this.init(params);\n    };\n    Object.defineProperty(Rive.prototype, \"layout\", {\n        /**\n         * Returns the current layout. Note that layout should be treated as\n         * immutable. If you want to change the layout, create a new one use the\n         * layout setter\n         */\n        get: function () {\n            return this._layout;\n        },\n        // Sets a new layout\n        set: function (layout) {\n            this._layout = layout;\n            // If the maxX or maxY are 0, then set them to the canvas width and height\n            if (!layout.maxX || !layout.maxY) {\n                this.resizeToCanvas();\n            }\n            if (this.loaded && !this.animator.isPlaying) {\n                this.drawFrame();\n            }\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Sets the layout bounds to the current canvas size; this is typically called\n     * when the canvas is resized\n     */\n    Rive.prototype.resizeToCanvas = function () {\n        this._layout = this.layout.copyWith({\n            minX: 0,\n            minY: 0,\n            maxX: this.canvas.width,\n            maxY: this.canvas.height,\n        });\n    };\n    /**\n     * Accounts for devicePixelRatio as a multiplier to render the size of the canvas drawing surface.\n     * Uses the size of the backing canvas to set new width/height attributes. Need to re-render\n     * and resize the layout to match the new drawing surface afterwards.\n     * Useful function for consumers to include in a window resize listener\n     */\n    Rive.prototype.resizeDrawingSurfaceToCanvas = function (customDevicePixelRatio) {\n        if (this.canvas instanceof HTMLCanvasElement && !!window) {\n            var _a = this.canvas.getBoundingClientRect(), width = _a.width, height = _a.height;\n            var dpr = customDevicePixelRatio || window.devicePixelRatio || 1;\n            this.canvas.width = dpr * width;\n            this.canvas.height = dpr * height;\n            this.startRendering();\n            this.resizeToCanvas();\n        }\n    };\n    Object.defineProperty(Rive.prototype, \"source\", {\n        // Returns the animation source, which may be undefined\n        get: function () {\n            return this.src;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Rive.prototype, \"activeArtboard\", {\n        /**\n         * Returns the name of the active artboard\n         */\n        get: function () {\n            return this.artboard ? this.artboard.name : \"\";\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Rive.prototype, \"animationNames\", {\n        // Returns a list of animation names on the chosen artboard\n        get: function () {\n            // If the file's not loaded, we got nothing to return\n            if (!this.loaded || !this.artboard) {\n                return [];\n            }\n            var animationNames = [];\n            for (var i = 0; i < this.artboard.animationCount(); i++) {\n                animationNames.push(this.artboard.animationByIndex(i).name);\n            }\n            return animationNames;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Rive.prototype, \"stateMachineNames\", {\n        /**\n         * Returns a list of state machine names from the current artboard\n         */\n        get: function () {\n            // If the file's not loaded, we got nothing to return\n            if (!this.loaded || !this.artboard) {\n                return [];\n            }\n            var stateMachineNames = [];\n            for (var i = 0; i < this.artboard.stateMachineCount(); i++) {\n                stateMachineNames.push(this.artboard.stateMachineByIndex(i).name);\n            }\n            return stateMachineNames;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Returns the inputs for the specified instanced state machine, or an empty\n     * list if the name is invalid or the state machine is not instanced\n     * @param name the state machine name\n     * @returns the inputs for the named state machine\n     */\n    Rive.prototype.stateMachineInputs = function (name) {\n        // If the file's not loaded, early out, nothing to pause\n        if (!this.loaded) {\n            return;\n        }\n        var stateMachine = this.animator.stateMachines.find(function (m) { return m.name === name; });\n        return stateMachine === null || stateMachine === void 0 ? void 0 : stateMachine.inputs;\n    };\n    // Returns the input with the provided name at the given path\n    Rive.prototype.retrieveInputAtPath = function (name, path) {\n        if (!name) {\n            console.warn(\"No input name provided for path '\".concat(path, \"'\"));\n            return;\n        }\n        if (!this.artboard) {\n            console.warn(\"Tried to access input: '\".concat(name, \"', at path: '\").concat(path, \"', but the Artboard is null\"));\n            return;\n        }\n        var input = this.artboard.inputByPath(name, path);\n        if (!input) {\n            console.warn(\"Could not access an input with name: '\".concat(name, \"', at path:'\").concat(path, \"'\"));\n            return;\n        }\n        return input;\n    };\n    /**\n     * Set the boolean input with the provided name at the given path with value\n     * @param input the state machine input name\n     * @param value the value to set the input to\n     * @param path the path the input is located at an artboard level\n     */\n    Rive.prototype.setBooleanStateAtPath = function (inputName, value, path) {\n        var input = this.retrieveInputAtPath(inputName, path);\n        if (!input)\n            return;\n        if (input.type === StateMachineInputType.Boolean) {\n            input.asBool().value = value;\n        }\n        else {\n            console.warn(\"Input with name: '\".concat(inputName, \"', at path:'\").concat(path, \"' is not a boolean\"));\n        }\n    };\n    /**\n     * Set the number input with the provided name at the given path with value\n     * @param input the state machine input name\n     * @param value the value to set the input to\n     * @param path the path the input is located at an artboard level\n     */\n    Rive.prototype.setNumberStateAtPath = function (inputName, value, path) {\n        var input = this.retrieveInputAtPath(inputName, path);\n        if (!input)\n            return;\n        if (input.type === StateMachineInputType.Number) {\n            input.asNumber().value = value;\n        }\n        else {\n            console.warn(\"Input with name: '\".concat(inputName, \"', at path:'\").concat(path, \"' is not a number\"));\n        }\n    };\n    /**\n     * Fire the trigger with the provided name at the given path\n     * @param input the state machine input name\n     * @param path the path the input is located at an artboard level\n     */\n    Rive.prototype.fireStateAtPath = function (inputName, path) {\n        var input = this.retrieveInputAtPath(inputName, path);\n        if (!input)\n            return;\n        if (input.type === StateMachineInputType.Trigger) {\n            input.asTrigger().fire();\n        }\n        else {\n            console.warn(\"Input with name: '\".concat(inputName, \"', at path:'\").concat(path, \"' is not a trigger\"));\n        }\n    };\n    // Returns the TextValueRun object for the provided name at the given path\n    Rive.prototype.retrieveTextAtPath = function (name, path) {\n        if (!name) {\n            console.warn(\"No text name provided for path '\".concat(path, \"'\"));\n            return;\n        }\n        if (!path) {\n            console.warn(\"No path provided for text '\".concat(name, \"'\"));\n            return;\n        }\n        if (!this.artboard) {\n            console.warn(\"Tried to access text: '\".concat(name, \"', at path: '\").concat(path, \"', but the Artboard is null\"));\n            return;\n        }\n        var text = this.artboard.textByPath(name, path);\n        if (!text) {\n            console.warn(\"Could not access text with name: '\".concat(name, \"', at path:'\").concat(path, \"'\"));\n            return;\n        }\n        return text;\n    };\n    /**\n     * Retrieves the text value for a specified text run at a given path\n     * @param textName The name of the text run\n     * @param path The path to the text run within the artboard\n     * @returns The text value of the text run, or undefined if not found\n     *\n     * @example\n     * // Get the text value for a text run named \"title\" at one nested artboard deep\n     * const titleText = riveInstance.getTextRunValueAtPath(\"title\", \"artboard1\");\n     *\n     * @example\n     * // Get the text value for a text run named \"subtitle\" within a nested group two artboards deep\n     * const subtitleText = riveInstance.getTextRunValueAtPath(\"subtitle\", \"group/nestedGroup\");\n     *\n     * @remarks\n     * If the text run cannot be found at the specified path, a warning will be logged to the console.\n     */\n    Rive.prototype.getTextRunValueAtPath = function (textName, path) {\n        var run = this.retrieveTextAtPath(textName, path);\n        if (!run) {\n            console.warn(\"Could not get text with name: '\".concat(textName, \"', at path:'\").concat(path, \"'\"));\n            return;\n        }\n        return run.text;\n    };\n    /**\n     * Sets the text value for a specified text run at a given path\n     * @param textName The name of the text run\n     * @param value The new text value to set\n     * @param path The path to the text run within the artboard\n     * @returns void\n     *\n     * @example\n     * // Set the text value for a text run named \"title\" at one nested artboard deep\n     * riveInstance.setTextRunValueAtPath(\"title\", \"New Title\", \"artboard1\");\n     *\n     * @example\n     * // Set the text value for a text run named \"subtitle\" within a nested group two artboards deep\n     * riveInstance.setTextRunValueAtPath(\"subtitle\", \"New Subtitle\", \"group/nestedGroup\");\n     *\n     * @remarks\n     * If the text run cannot be found at the specified path, a warning will be logged to the console.\n     */\n    Rive.prototype.setTextRunValueAtPath = function (textName, value, path) {\n        var run = this.retrieveTextAtPath(textName, path);\n        if (!run) {\n            console.warn(\"Could not set text with name: '\".concat(textName, \"', at path:'\").concat(path, \"'\"));\n            return;\n        }\n        run.text = value;\n    };\n    Object.defineProperty(Rive.prototype, \"playingStateMachineNames\", {\n        // Returns a list of playing machine names\n        get: function () {\n            // If the file's not loaded, we got nothing to return\n            if (!this.loaded) {\n                return [];\n            }\n            return this.animator.stateMachines\n                .filter(function (m) { return m.playing; })\n                .map(function (m) { return m.name; });\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Rive.prototype, \"playingAnimationNames\", {\n        // Returns a list of playing animation names\n        get: function () {\n            // If the file's not loaded, we got nothing to return\n            if (!this.loaded) {\n                return [];\n            }\n            return this.animator.animations.filter(function (a) { return a.playing; }).map(function (a) { return a.name; });\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Rive.prototype, \"pausedAnimationNames\", {\n        // Returns a list of paused animation names\n        get: function () {\n            // If the file's not loaded, we got nothing to return\n            if (!this.loaded) {\n                return [];\n            }\n            return this.animator.animations\n                .filter(function (a) { return !a.playing; })\n                .map(function (a) { return a.name; });\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Rive.prototype, \"pausedStateMachineNames\", {\n        /**\n         *  Returns a list of paused machine names\n         * @returns a list of state machine names that are paused\n         */\n        get: function () {\n            // If the file's not loaded, we got nothing to return\n            if (!this.loaded) {\n                return [];\n            }\n            return this.animator.stateMachines\n                .filter(function (m) { return !m.playing; })\n                .map(function (m) { return m.name; });\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Rive.prototype, \"isPlaying\", {\n        /**\n         * @returns true if any animation is playing\n         */\n        get: function () {\n            return this.animator.isPlaying;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Rive.prototype, \"isPaused\", {\n        /**\n         * @returns true if all instanced animations are paused\n         */\n        get: function () {\n            return this.animator.isPaused;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Rive.prototype, \"isStopped\", {\n        /**\n         * @returns true if no animations are playing or paused\n         */\n        get: function () {\n            return this.animator.isStopped;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Rive.prototype, \"bounds\", {\n        /**\n         * @returns the bounds of the current artboard, or undefined if the artboard\n         * isn't loaded yet.\n         */\n        get: function () {\n            return this.artboard ? this.artboard.bounds : undefined;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Subscribe to Rive-generated events\n     * @param type the type of event to subscribe to\n     * @param callback callback to fire when the event occurs\n     */\n    Rive.prototype.on = function (type, callback) {\n        this.eventManager.add({\n            type: type,\n            callback: callback,\n        });\n    };\n    /**\n     * Unsubscribes from a Rive-generated event\n     * @param type the type of event to unsubscribe from\n     * @param callback the callback to unsubscribe\n     */\n    Rive.prototype.off = function (type, callback) {\n        this.eventManager.remove({\n            type: type,\n            callback: callback,\n        });\n    };\n    /**\n     * Unsubscribes from a Rive-generated event\n     * @deprecated\n     * @param callback the callback to unsubscribe from\n     */\n    Rive.prototype.unsubscribe = function (type, callback) {\n        console.warn(\"This function is deprecated: please use `off()` instead.\");\n        this.off(type, callback);\n    };\n    /**\n     * Unsubscribes all Rive listeners from an event type, or everything if no type is\n     * given\n     * @param type the type of event to unsubscribe from, or all types if\n     * undefined\n     */\n    Rive.prototype.removeAllRiveEventListeners = function (type) {\n        this.eventManager.removeAll(type);\n    };\n    /**\n     * Unsubscribes all listeners from an event type, or everything if no type is\n     * given\n     * @deprecated\n     * @param type the type of event to unsubscribe from, or all types if\n     * undefined\n     */\n    Rive.prototype.unsubscribeAll = function (type) {\n        console.warn(\"This function is deprecated: please use `removeAllRiveEventListeners()` instead.\");\n        this.removeAllRiveEventListeners(type);\n    };\n    /**\n     * Stops the rendering loop; this is different from pausing in that it doesn't\n     * change the state of any animation. It stops rendering from occurring. This\n     * is designed for situations such as when Rive isn't visible.\n     *\n     * The only way to start rendering again is to call `startRendering`.\n     * Animations that are marked as playing will start from the position that\n     * they would have been at if rendering had not been stopped.\n     */\n    Rive.prototype.stopRendering = function () {\n        if (this.loaded && this.frameRequestId) {\n            if (this.runtime.cancelAnimationFrame) {\n                this.runtime.cancelAnimationFrame(this.frameRequestId);\n            }\n            else {\n                cancelAnimationFrame(this.frameRequestId);\n            }\n            this.frameRequestId = null;\n        }\n    };\n    /**\n     * Starts the rendering loop if it has been previously stopped. If the\n     * renderer is already active, then this will have zero effect.\n     */\n    Rive.prototype.startRendering = function () {\n        if (this.loaded && this.artboard && !this.frameRequestId) {\n            if (this.runtime.requestAnimationFrame) {\n                this.frameRequestId = this.runtime.requestAnimationFrame(this.draw.bind(this));\n            }\n            else {\n                this.frameRequestId = requestAnimationFrame(this.draw.bind(this));\n            }\n        }\n    };\n    /**\n     * Enables frames-per-second (FPS) reporting for the runtime\n     * If no callback is provided, Rive will append a fixed-position div at the top-right corner of\n     * the page with the FPS reading\n     * @param fpsCallback - Callback from the runtime during the RAF loop that supplies the FPS value\n     */\n    Rive.prototype.enableFPSCounter = function (fpsCallback) {\n        this.runtime.enableFPSCounter(fpsCallback);\n    };\n    /**\n     * Disables frames-per-second (FPS) reporting for the runtime\n     */\n    Rive.prototype.disableFPSCounter = function () {\n        this.runtime.disableFPSCounter();\n    };\n    Object.defineProperty(Rive.prototype, \"contents\", {\n        /**\n         * Returns the contents of a Rive file: the artboards, animations, and state machines\n         */\n        get: function () {\n            if (!this.loaded) {\n                return undefined;\n            }\n            var riveContents = {\n                artboards: [],\n            };\n            for (var i = 0; i < this.file.artboardCount(); i++) {\n                var artboard = this.file.artboardByIndex(i);\n                var artboardContents = {\n                    name: artboard.name,\n                    animations: [],\n                    stateMachines: [],\n                };\n                for (var j = 0; j < artboard.animationCount(); j++) {\n                    var animation = artboard.animationByIndex(j);\n                    artboardContents.animations.push(animation.name);\n                }\n                for (var k = 0; k < artboard.stateMachineCount(); k++) {\n                    var stateMachine = artboard.stateMachineByIndex(k);\n                    var name_1 = stateMachine.name;\n                    var instance = new this.runtime.StateMachineInstance(stateMachine, artboard);\n                    var inputContents = [];\n                    for (var l = 0; l < instance.inputCount(); l++) {\n                        var input = instance.input(l);\n                        inputContents.push({ name: input.name, type: input.type });\n                    }\n                    artboardContents.stateMachines.push({\n                        name: name_1,\n                        inputs: inputContents,\n                    });\n                }\n                riveContents.artboards.push(artboardContents);\n            }\n            return riveContents;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Rive.prototype, \"volume\", {\n        /**\n         * getter and setter for the volume of the artboard\n         */\n        get: function () {\n            if (this.artboard && this.artboard.volume !== this._volume) {\n                this._volume = this.artboard.volume;\n            }\n            return this._volume;\n        },\n        set: function (value) {\n            this._volume = value;\n            if (this.artboard) {\n                this.artboard.volume = value * audioManager.systemVolume;\n            }\n        },\n        enumerable: false,\n        configurable: true\n    });\n    // Error message for missing source or buffer\n    Rive.missingErrorMessage = \"Rive source file or data buffer required\";\n    return Rive;\n}());\n\n// Loads Rive data from a URI via fetch.\nvar loadRiveFile = function (src) { return __awaiter(void 0, void 0, void 0, function () {\n    var req, res, buffer;\n    return __generator(this, function (_a) {\n        switch (_a.label) {\n            case 0:\n                req = new Request(src);\n                return [4 /*yield*/, fetch(req)];\n            case 1:\n                res = _a.sent();\n                return [4 /*yield*/, res.arrayBuffer()];\n            case 2:\n                buffer = _a.sent();\n                return [2 /*return*/, buffer];\n        }\n    });\n}); };\n// #endregion\n// #region utility functions\n/*\n * Utility function to ensure an object is a string array\n */\nvar mapToStringArray = function (obj) {\n    if (typeof obj === \"string\") {\n        return [obj];\n    }\n    else if (obj instanceof Array) {\n        return obj;\n    }\n    // If obj is undefined, return empty array\n    return [];\n};\n// #endregion\n// #region testing utilities\n// Exports to only be used for tests\nvar Testing = {\n    EventManager: EventManager,\n    TaskQueueManager: TaskQueueManager,\n};\n// #endregion\n// #region asset loaders\n/**\n * Decodes bytes into an audio asset.\n *\n * Be sure to call `.unref()` on the audio once it is no longer needed. This\n * allows the engine to clean it up when it is not used by any more animations.\n */\nvar decodeAudio = function (bytes) {\n    return new Promise(function (resolve) {\n        return RuntimeLoader.getInstance(function (rive) {\n            rive.decodeAudio(bytes, resolve);\n        });\n    });\n};\n/**\n * Decodes bytes into an image.\n *\n * Be sure to call `.unref()` on the image once it is no longer needed. This\n * allows the engine to clean it up when it is not used by any more animations.\n */\nvar decodeImage = function (bytes) {\n    return new Promise(function (resolve) {\n        return RuntimeLoader.getInstance(function (rive) {\n            rive.decodeImage(bytes, resolve);\n        });\n    });\n};\n/**\n * Decodes bytes into a font.\n *\n * Be sure to call `.unref()` on the font once it is no longer needed. This\n * allows the engine to clean it up when it is not used by any more animations.\n */\nvar decodeFont = function (bytes) {\n    return new Promise(function (resolve) {\n        return RuntimeLoader.getInstance(function (rive) {\n            rive.decodeFont(bytes, resolve);\n        });\n    });\n};\n// #endregion\n\n})();\n\n/******/ \treturn __webpack_exports__;\n/******/ })()\n;\n});\n//# sourceMappingURL=rive.js.map","Object.defineProperty(exports,\"__esModule\",{value:!0});var e=require(\"react\"),t=require(\"@rive-app/canvas\");function n(e){return e&&\"object\"==typeof e&&\"default\"in e?e:{default:e}}var i=/*#__PURE__*/n(e),r=function(){return r=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r.apply(this,arguments)};function o(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&\"function\"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}function a(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}u((i=i.apply(e,t||[])).next())})}function s(e,t){var n,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create((\"function\"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),\"function\"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(n)throw new TypeError(\"Generator is already executing.\");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}function u(){var e=\"undefined\"!=typeof window&&\"number\"==typeof window.devicePixelRatio?window.devicePixelRatio:1;return Math.min(Math.max(1,e),3)}\"function\"==typeof SuppressedError&&SuppressedError;var c=function(){function e(){}return e.prototype.observe=function(){},e.prototype.unobserve=function(){},e.prototype.disconnect=function(){},e}();var l=globalThis.ResizeObserver||c,f=void 0!==globalThis.ResizeObserver,d=!f;function v(t,n){void 0===n&&(n=!0);var i=e.useState({width:0,height:0}),r=i[0],o=i[1];e.useEffect(function(){if(\"undefined\"!=typeof window&&n){var e=function(){o({width:window.innerWidth,height:window.innerHeight})};return d&&(e(),window.addEventListener(\"resize\",e)),function(){return window.removeEventListener(\"resize\",e)}}},[]);var a,s,u,c=e.useRef(new l((a=function(e){f&&o({width:e[e.length-1].contentRect.width,height:e[e.length-1].contentRect.height})},s=0,u=0,function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];clearTimeout(u),u=window.setTimeout(function(){return a.apply(e,t)},s)})));return e.useEffect(function(){var e=c.current;if(n){var i=t.current;return t.current&&f&&e.observe(t.current),function(){e.disconnect(),i&&f&&e.unobserve(i)}}e.disconnect()},[t,c]),r}var h={useDevicePixelRatio:!0,fitCanvasToArtboardHeight:!1,useOffscreenRenderer:!0,shouldResizeCanvasToContainer:!0};function p(e){return Object.assign({},h,e)}function b(t){var n=t.riveLoaded,i=void 0!==n&&n,r=t.canvasElem,o=t.containerRef,a=t.options,s=void 0===a?{}:a,c=t.onCanvasHasResized,l=t.artboardBounds,f=p(s),d=e.useState({height:0,width:0}),h=d[0],b=h.height,w=h.width,y=d[1],g=e.useState({height:0,width:0}),m=g[0],R=m.height,C=m.width,E=g[1],O=e.useState(!0),x=O[0],T=O[1],P=f.fitCanvasToArtboardHeight,L=f.shouldResizeCanvasToContainer,S=f.useDevicePixelRatio,k=f.customDevicePixelRatio,M=v(o,L),j=function(t){var n=t||u(),i=e.useState(n),r=i[0],o=i[1];return e.useEffect(function(){if(\"undefined\"!=typeof window&&\"matchMedia\"in window){var e=function(){var e=t||u();o(e)},n=window.matchMedia(\"screen and (resolution: \".concat(r,\"dppx)\"));return n.hasOwnProperty(\"addEventListener\")?n.addEventListener(\"change\",e):n.addListener(e),function(){n.hasOwnProperty(\"removeEventListener\")?n.removeEventListener(\"change\",e):n.removeListener(e)}}},[r,t]),r}(k),z=null!=l?l:{},H=z.maxX,I=z.maxY,D=e.useCallback(function(){var e,t,n,i,r=null!==(t=null===(e=o.current)||void 0===e?void 0:e.clientWidth)&&void 0!==t?t:0,a=null!==(i=null===(n=o.current)||void 0===n?void 0:n.clientHeight)&&void 0!==i?i:0;return P&&l?{width:r,height:r*(l.maxY/l.maxX)}:{width:r,height:a}},[o,P,H,I]);e.useEffect(function(){if(L&&o.current&&i){var e=D(),t=e.width,n=e.height,a=!1;if(r){var s=t!==w||n!==b;if(f.fitCanvasToArtboardHeight&&s&&(o.current.style.height=n+\"px\",a=!0),f.useDevicePixelRatio){if(s||(t*j!==C||n*j!==R)){var u=j*t,l=j*n;r.width=u,r.height=l,r.style.width=t+\"px\",r.style.height=n+\"px\",E({width:u,height:l}),a=!0}}else s&&(r.width=t,r.height=n,E({width:t,height:n}),a=!0);y({width:t,height:n})}c&&(x||a)&&c&&c(),x&&T(!1)}},[r,o,M,j,D,x,T,R,C,b,w,c,L,P,S,i]),e.useEffect(function(){E({width:0,height:0})},[r])}var w,y=function(){function e(){}return e.prototype.observe=function(){},e.prototype.unobserve=function(){},e.prototype.disconnect=function(){},e}(),g=globalThis.IntersectionObserver||y,m=function(){function e(){var e=this;this.elementsMap=new Map,this.onObserved=function(t){t.forEach(function(t){var n=e.elementsMap.get(t.target);n&&n(t)})},this.observer=new g(this.onObserved)}return e.prototype.registerCallback=function(e,t){this.observer.observe(e),this.elementsMap.set(e,t)},e.prototype.removeCallback=function(e){this.observer.unobserve(e),this.elementsMap.delete(e)},e}(),R=function(){return w||(w=new m),w};function C(e){var t=e.setContainerRef,n=e.setCanvasRef,a=e.className,s=void 0===a?\"\":a,u=e.style,c=e.children,l=o(e,[\"setContainerRef\",\"setCanvasRef\",\"className\",\"style\",\"children\"]),f=r({width:\"100%\",height:\"100%\"},u);return i.default.createElement(\"div\",r({ref:t,className:s},!s&&{style:f}),i.default.createElement(\"canvas\",r({ref:n,style:{verticalAlign:\"top\",width:0,height:0}},l),c))}function E(n,o){void 0===o&&(o={});var a=e.useState(null),s=a[0],u=a[1],c=e.useRef(null),l=e.useState(null),f=l[0],d=l[1],v=Boolean(n),h=p(o),w=e.useCallback(function(){f&&(f.startRendering(),f.resizeToCanvas())},[f]);b({riveLoaded:!!f,canvasElem:s,containerRef:c,options:h,onCanvasHasResized:w,artboardBounds:null==f?void 0:f.bounds});var y=e.useCallback(function(e){null===e&&s&&(s.height=0,s.width=0),u(e)},[]);e.useEffect(function(){if(s&&n&&null==f){var e=h.useOffscreenRenderer,i=new t.Rive(r(r({useOffscreenRenderer:e},n),{canvas:s}));i.on(t.EventType.Load,function(){s?d(i):i.cleanup()})}},[s,v,f]);var g=e.useCallback(function(e){c.current=e},[]),m={observe:e.useCallback(function(e,t){R().registerCallback(e,t)},[]),unobserve:e.useCallback(function(e){R().removeCallback(e)},[])},E=m.observe,O=m.unobserve;e.useEffect(function(){var e,t=!1,n=function(){if(s&&t){var e=s.getBoundingClientRect();e.width>0&&e.height>0&&e.top<(window.innerHeight||document.documentElement.clientHeight)&&e.bottom>0&&e.left<(window.innerWidth||document.documentElement.clientWidth)&&e.right>0&&(null==f||f.startRendering(),t=!1)}};return s&&!1!==h.shouldUseIntersectionObserver&&E(s,function(i){i.isIntersecting?f&&f.startRendering():f&&f.stopRendering(),t=!i.isIntersecting,clearTimeout(e),i.isIntersecting||0!==i.boundingClientRect.width||(e=setTimeout(n,10))}),function(){s&&O(s)}},[E,O,f,s,h.shouldUseIntersectionObserver]),e.useEffect(function(){return function(){f&&(f.cleanup(),d(null))}},[f,s]);var x=null==n?void 0:n.animations;e.useEffect(function(){f&&x&&(f.isPlaying?(f.stop(f.animationNames),f.play(x)):f.isPaused&&(f.stop(f.animationNames),f.pause(x)))},[x,f]);var T=e.useCallback(function(e){return i.default.createElement(C,r({setContainerRef:g,setCanvasRef:y},e))},[y,g]);return{canvas:s,container:c.current,setCanvasRef:y,setContainerRef:g,rive:f,RiveComponent:T}}exports.default=function(e){var t=e.src,n=e.artboard,a=e.animations,s=e.stateMachines,u=e.layout,c=e.useOffscreenRenderer,l=void 0===c||c,f=e.shouldDisableRiveListeners,d=void 0!==f&&f,v=e.shouldResizeCanvasToContainer,h=void 0===v||v,p=e.automaticallyHandleEvents,b=void 0!==p&&p,w=e.children,y=o(e,[\"src\",\"artboard\",\"animations\",\"stateMachines\",\"layout\",\"useOffscreenRenderer\",\"shouldDisableRiveListeners\",\"shouldResizeCanvasToContainer\",\"automaticallyHandleEvents\",\"children\"]),g=E({src:t,artboard:n,animations:a,layout:u,stateMachines:s,autoplay:!0,shouldDisableRiveListeners:d,automaticallyHandleEvents:b},{useOffscreenRenderer:l,shouldResizeCanvasToContainer:h}).RiveComponent;return i.default.createElement(g,r({},y),w)},exports.useResizeCanvas=b,exports.useRive=E,exports.useRiveFile=function(n){var i=this,r=e.useState(null),o=r[0],u=r[1],c=e.useState(\"idle\"),l=c[0],f=c[1];return e.useEffect(function(){var e=null;return a(i,void 0,void 0,function(){return s(this,function(i){try{f(\"loading\"),(e=new t.RiveFile(n)).init(),e.on(t.EventType.Load,function(){null==e||e.getInstance(),u(e),f(\"success\")}),e.on(t.EventType.LoadError,function(){f(\"failed\")}),u(e)}catch(e){console.error(e),f(\"failed\")}return[2]})}),function(){null==e||e.cleanup()}},[n.src,n.buffer]),{riveFile:o,status:l}},exports.useStateMachineInput=function(n,i,r,o){var a=e.useState(null),s=a[0],u=a[1];return e.useEffect(function(){function e(){if(n&&i&&r||u(null),n&&i&&r){var e=n.stateMachineInputs(i);if(e){var t=e.find(function(e){return e.name===r});void 0!==o&&t&&(t.value=o),u(t||null)}}else u(null)}e(),n&&n.on(t.EventType.Load,function(){e()})},[n]),s},Object.keys(t).forEach(function(e){\"default\"===e||exports.hasOwnProperty(e)||Object.defineProperty(exports,e,{enumerable:!0,get:function(){return t[e]}})});\n","(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\n    (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.XataScreenshot = {}));\n})(this, (function (exports) { 'use strict';\n\n    /**\n     * Checks if the current browser supports the MediaDevices API.\n     */\n    const checkIfBrowserSupported = () => { var _a; return Boolean((_a = navigator.mediaDevices) === null || _a === void 0 ? void 0 : _a.getDisplayMedia); };\n\n    /*! *****************************************************************************\r\n    Copyright (c) Microsoft Corporation.\r\n\r\n    Permission to use, copy, modify, and/or distribute this software for any\r\n    purpose with or without fee is hereby granted.\r\n\r\n    THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\n    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\n    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\n    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\n    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\n    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\n    PERFORMANCE OF THIS SOFTWARE.\r\n    ***************************************************************************** */\r\n\r\n    function __awaiter(thisArg, _arguments, P, generator) {\r\n        function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n        return new (P || (P = Promise))(function (resolve, reject) {\r\n            function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n            function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n            function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n            step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n        });\r\n    }\n\n    const createVideoElementToCaptureFrames = (mediaStream) => {\n        const video = document.createElement(\"video\");\n        video.autoplay = true;\n        video.muted = true;\n        video.playsInline = true;\n        video.srcObject = mediaStream;\n        video.setAttribute(\"style\", \"position:fixed;top:0;left:0;pointer-events:none;visibility:hidden;\");\n        return video;\n    };\n\n    const paintVideoFrameOnCanvas = (video) => {\n        var _a, _b, _c;\n        // Get the video settings\n        // @ts-ignore because getTracks is very much valid in modern browsers\n        const videoTrackSettings = (_a = video.srcObject) === null || _a === void 0 ? void 0 : _a.getTracks()[0].getSettings();\n        // Create a canvas with the video's size and draw the video frame on it\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = (_b = videoTrackSettings === null || videoTrackSettings === void 0 ? void 0 : videoTrackSettings.width) !== null && _b !== void 0 ? _b : 0;\n        canvas.height = (_c = videoTrackSettings === null || videoTrackSettings === void 0 ? void 0 : videoTrackSettings.height) !== null && _c !== void 0 ? _c : 0;\n        const ctx = canvas.getContext(\"2d\");\n        ctx === null || ctx === void 0 ? void 0 : ctx.drawImage(video, 0, 0);\n        return canvas;\n    };\n\n    const playCameraClickSound = (url) => {\n        const audio = document.createElement(\"audio\");\n        audio.loop = false;\n        audio.src = url;\n        audio.play();\n        audio.remove();\n    };\n\n    const sleep = (timeoutInMs = 300) => new Promise((r) => {\n        setTimeout(r, timeoutInMs);\n    });\n\n    const stopCapture = (video) => {\n        var _a;\n        // @ts-ignore because getTracks is very much valid in modern browsers\n        const tracks = (_a = video.srcObject) === null || _a === void 0 ? void 0 : _a.getTracks();\n        tracks === null || tracks === void 0 ? void 0 : tracks.forEach((track) => track.stop());\n        // This is the only way to clean up a video stream in the browser so...\n        // eslint-disable-next-line no-param-reassign\n        video.srcObject = null;\n        video.remove();\n    };\n\n    const waitForFocus = (result) => __awaiter(void 0, void 0, void 0, function* () {\n        yield sleep();\n        if (document.hasFocus()) {\n            return result;\n        }\n        return waitForFocus(result);\n    });\n\n    /**\n     * Takes a screenshot of the current page using a the native browser [`MediaDevices`](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getDisplayMedia) API.\n     */\n    const takeScreenshot = ({ onCaptureEnd, onCaptureStart, quality = 0.7, type = \"image/jpeg\", soundEffectUrl, } = {}) => __awaiter(void 0, void 0, void 0, function* () {\n        yield (onCaptureStart === null || onCaptureStart === void 0 ? void 0 : onCaptureStart());\n        return navigator.mediaDevices\n            .getDisplayMedia({\n            // This is actually supported, but only in Chrome so not yet part of the TS typedefs, so\n            // @ts-ignore\n            preferCurrentTab: true,\n            video: { frameRate: 30 },\n        })\n            .then(waitForFocus) // We can only proceed if our tab is in focus.\n            .then((result) => __awaiter(void 0, void 0, void 0, function* () {\n            // So we mount the screen capture to a video element...\n            const video = createVideoElementToCaptureFrames(result);\n            // ...which needs to be in the DOM but invisible so we can capture it.\n            document.body.appendChild(video);\n            // Now, we need to wait a bit to capture the right moment...\n            // Hide this modal...\n            // Play camera click sound, because why not\n            if (soundEffectUrl) {\n                playCameraClickSound(soundEffectUrl);\n            }\n            // Wait for the video feed...\n            yield sleep();\n            // Paint the video frame on a canvas...\n            const canvas = paintVideoFrameOnCanvas(video);\n            // Set the data URL in state\n            const screenshot = canvas.toDataURL(type, quality);\n            // Stop sharing screen.\n            stopCapture(video);\n            // Clean up\n            canvas.remove();\n            yield (onCaptureEnd === null || onCaptureEnd === void 0 ? void 0 : onCaptureEnd());\n            return screenshot;\n        }));\n    });\n\n    exports.checkIfBrowserSupported = checkIfBrowserSupported;\n    exports.takeScreenshot = takeScreenshot;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n","/* eslint-env browser */\n\n/**\n * This is the web browser implementation of `debug()`.\n */\n\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = localstorage();\nexports.destroy = (() => {\n\tlet warned = false;\n\n\treturn () => {\n\t\tif (!warned) {\n\t\t\twarned = true;\n\t\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t\t}\n\t};\n})();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n\t'#0000CC',\n\t'#0000FF',\n\t'#0033CC',\n\t'#0033FF',\n\t'#0066CC',\n\t'#0066FF',\n\t'#0099CC',\n\t'#0099FF',\n\t'#00CC00',\n\t'#00CC33',\n\t'#00CC66',\n\t'#00CC99',\n\t'#00CCCC',\n\t'#00CCFF',\n\t'#3300CC',\n\t'#3300FF',\n\t'#3333CC',\n\t'#3333FF',\n\t'#3366CC',\n\t'#3366FF',\n\t'#3399CC',\n\t'#3399FF',\n\t'#33CC00',\n\t'#33CC33',\n\t'#33CC66',\n\t'#33CC99',\n\t'#33CCCC',\n\t'#33CCFF',\n\t'#6600CC',\n\t'#6600FF',\n\t'#6633CC',\n\t'#6633FF',\n\t'#66CC00',\n\t'#66CC33',\n\t'#9900CC',\n\t'#9900FF',\n\t'#9933CC',\n\t'#9933FF',\n\t'#99CC00',\n\t'#99CC33',\n\t'#CC0000',\n\t'#CC0033',\n\t'#CC0066',\n\t'#CC0099',\n\t'#CC00CC',\n\t'#CC00FF',\n\t'#CC3300',\n\t'#CC3333',\n\t'#CC3366',\n\t'#CC3399',\n\t'#CC33CC',\n\t'#CC33FF',\n\t'#CC6600',\n\t'#CC6633',\n\t'#CC9900',\n\t'#CC9933',\n\t'#CCCC00',\n\t'#CCCC33',\n\t'#FF0000',\n\t'#FF0033',\n\t'#FF0066',\n\t'#FF0099',\n\t'#FF00CC',\n\t'#FF00FF',\n\t'#FF3300',\n\t'#FF3333',\n\t'#FF3366',\n\t'#FF3399',\n\t'#FF33CC',\n\t'#FF33FF',\n\t'#FF6600',\n\t'#FF6633',\n\t'#FF9900',\n\t'#FF9933',\n\t'#FFCC00',\n\t'#FFCC33'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\n// eslint-disable-next-line complexity\nfunction useColors() {\n\t// NB: In an Electron preload script, document will be defined but not fully\n\t// initialized. Since we know we're in Chrome, we'll just detect this case\n\t// explicitly\n\tif (typeof window !== 'undefined' && window.process && (window.process.type === 'renderer' || window.process.__nwjs)) {\n\t\treturn true;\n\t}\n\n\t// Internet Explorer and Edge do not support colors.\n\tif (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) {\n\t\treturn false;\n\t}\n\n\t// Is webkit? http://stackoverflow.com/a/16459606/376773\n\t// document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n\treturn (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n\t\t// Is firebug? http://stackoverflow.com/a/398120/376773\n\t\t(typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n\t\t// Is firefox >= v31?\n\t\t// https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31) ||\n\t\t// Double check webkit in userAgent just in case we are in a worker\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\targs[0] = (this.useColors ? '%c' : '') +\n\t\tthis.namespace +\n\t\t(this.useColors ? ' %c' : ' ') +\n\t\targs[0] +\n\t\t(this.useColors ? '%c ' : ' ') +\n\t\t'+' + module.exports.humanize(this.diff);\n\n\tif (!this.useColors) {\n\t\treturn;\n\t}\n\n\tconst c = 'color: ' + this.color;\n\targs.splice(1, 0, c, 'color: inherit');\n\n\t// The final \"%c\" is somewhat tricky, because there could be other\n\t// arguments passed either before or after the %c, so we need to\n\t// figure out the correct index to insert the CSS into\n\tlet index = 0;\n\tlet lastC = 0;\n\targs[0].replace(/%[a-zA-Z%]/g, match => {\n\t\tif (match === '%%') {\n\t\t\treturn;\n\t\t}\n\t\tindex++;\n\t\tif (match === '%c') {\n\t\t\t// We only are interested in the *last* %c\n\t\t\t// (the user may have provided their own)\n\t\t\tlastC = index;\n\t\t}\n\t});\n\n\targs.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.debug()` when available.\n * No-op when `console.debug` is not a \"function\".\n * If `console.debug` is not available, falls back\n * to `console.log`.\n *\n * @api public\n */\nexports.log = console.debug || console.log || (() => {});\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\ttry {\n\t\tif (namespaces) {\n\t\t\texports.storage.setItem('debug', namespaces);\n\t\t} else {\n\t\t\texports.storage.removeItem('debug');\n\t\t}\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\nfunction load() {\n\tlet r;\n\ttry {\n\t\tr = exports.storage.getItem('debug');\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n\n\t// If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n\tif (!r && typeof process !== 'undefined' && 'env' in process) {\n\t\tr = process.env.DEBUG;\n\t}\n\n\treturn r;\n}\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n\ttry {\n\t\t// TVMLKit (Apple TV JS Runtime) does not have a window object, just localStorage in the global context\n\t\t// The Browser also has localStorage in the global context.\n\t\treturn localStorage;\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nformatters.j = function (v) {\n\ttry {\n\t\treturn JSON.stringify(v);\n\t} catch (error) {\n\t\treturn '[UnexpectedJSONParseError]: ' + error.message;\n\t}\n};\n","\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n */\n\nfunction setup(env) {\n\tcreateDebug.debug = createDebug;\n\tcreateDebug.default = createDebug;\n\tcreateDebug.coerce = coerce;\n\tcreateDebug.disable = disable;\n\tcreateDebug.enable = enable;\n\tcreateDebug.enabled = enabled;\n\tcreateDebug.humanize = require('ms');\n\tcreateDebug.destroy = destroy;\n\n\tObject.keys(env).forEach(key => {\n\t\tcreateDebug[key] = env[key];\n\t});\n\n\t/**\n\t* The currently active debug mode names, and names to skip.\n\t*/\n\n\tcreateDebug.names = [];\n\tcreateDebug.skips = [];\n\n\t/**\n\t* Map of special \"%n\" handling functions, for the debug \"format\" argument.\n\t*\n\t* Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n\t*/\n\tcreateDebug.formatters = {};\n\n\t/**\n\t* Selects a color for a debug namespace\n\t* @param {String} namespace The namespace string for the debug instance to be colored\n\t* @return {Number|String} An ANSI color code for the given namespace\n\t* @api private\n\t*/\n\tfunction selectColor(namespace) {\n\t\tlet hash = 0;\n\n\t\tfor (let i = 0; i < namespace.length; i++) {\n\t\t\thash = ((hash << 5) - hash) + namespace.charCodeAt(i);\n\t\t\thash |= 0; // Convert to 32bit integer\n\t\t}\n\n\t\treturn createDebug.colors[Math.abs(hash) % createDebug.colors.length];\n\t}\n\tcreateDebug.selectColor = selectColor;\n\n\t/**\n\t* Create a debugger with the given `namespace`.\n\t*\n\t* @param {String} namespace\n\t* @return {Function}\n\t* @api public\n\t*/\n\tfunction createDebug(namespace) {\n\t\tlet prevTime;\n\t\tlet enableOverride = null;\n\t\tlet namespacesCache;\n\t\tlet enabledCache;\n\n\t\tfunction debug(...args) {\n\t\t\t// Disabled?\n\t\t\tif (!debug.enabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst self = debug;\n\n\t\t\t// Set `diff` timestamp\n\t\t\tconst curr = Number(new Date());\n\t\t\tconst ms = curr - (prevTime || curr);\n\t\t\tself.diff = ms;\n\t\t\tself.prev = prevTime;\n\t\t\tself.curr = curr;\n\t\t\tprevTime = curr;\n\n\t\t\targs[0] = createDebug.coerce(args[0]);\n\n\t\t\tif (typeof args[0] !== 'string') {\n\t\t\t\t// Anything else let's inspect with %O\n\t\t\t\targs.unshift('%O');\n\t\t\t}\n\n\t\t\t// Apply any `formatters` transformations\n\t\t\tlet index = 0;\n\t\t\targs[0] = args[0].replace(/%([a-zA-Z%])/g, (match, format) => {\n\t\t\t\t// If we encounter an escaped % then don't increase the array index\n\t\t\t\tif (match === '%%') {\n\t\t\t\t\treturn '%';\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t\tconst formatter = createDebug.formatters[format];\n\t\t\t\tif (typeof formatter === 'function') {\n\t\t\t\t\tconst val = args[index];\n\t\t\t\t\tmatch = formatter.call(self, val);\n\n\t\t\t\t\t// Now we need to remove `args[index]` since it's inlined in the `format`\n\t\t\t\t\targs.splice(index, 1);\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\t\t\t\treturn match;\n\t\t\t});\n\n\t\t\t// Apply env-specific formatting (colors, etc.)\n\t\t\tcreateDebug.formatArgs.call(self, args);\n\n\t\t\tconst logFn = self.log || createDebug.log;\n\t\t\tlogFn.apply(self, args);\n\t\t}\n\n\t\tdebug.namespace = namespace;\n\t\tdebug.useColors = createDebug.useColors();\n\t\tdebug.color = createDebug.selectColor(namespace);\n\t\tdebug.extend = extend;\n\t\tdebug.destroy = createDebug.destroy; // XXX Temporary. Will be removed in the next major release.\n\n\t\tObject.defineProperty(debug, 'enabled', {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: false,\n\t\t\tget: () => {\n\t\t\t\tif (enableOverride !== null) {\n\t\t\t\t\treturn enableOverride;\n\t\t\t\t}\n\t\t\t\tif (namespacesCache !== createDebug.namespaces) {\n\t\t\t\t\tnamespacesCache = createDebug.namespaces;\n\t\t\t\t\tenabledCache = createDebug.enabled(namespace);\n\t\t\t\t}\n\n\t\t\t\treturn enabledCache;\n\t\t\t},\n\t\t\tset: v => {\n\t\t\t\tenableOverride = v;\n\t\t\t}\n\t\t});\n\n\t\t// Env-specific initialization logic for debug instances\n\t\tif (typeof createDebug.init === 'function') {\n\t\t\tcreateDebug.init(debug);\n\t\t}\n\n\t\treturn debug;\n\t}\n\n\tfunction extend(namespace, delimiter) {\n\t\tconst newDebug = createDebug(this.namespace + (typeof delimiter === 'undefined' ? ':' : delimiter) + namespace);\n\t\tnewDebug.log = this.log;\n\t\treturn newDebug;\n\t}\n\n\t/**\n\t* Enables a debug mode by namespaces. This can include modes\n\t* separated by a colon and wildcards.\n\t*\n\t* @param {String} namespaces\n\t* @api public\n\t*/\n\tfunction enable(namespaces) {\n\t\tcreateDebug.save(namespaces);\n\t\tcreateDebug.namespaces = namespaces;\n\n\t\tcreateDebug.names = [];\n\t\tcreateDebug.skips = [];\n\n\t\tlet i;\n\t\tconst split = (typeof namespaces === 'string' ? namespaces : '').split(/[\\s,]+/);\n\t\tconst len = split.length;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (!split[i]) {\n\t\t\t\t// ignore empty strings\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tnamespaces = split[i].replace(/\\*/g, '.*?');\n\n\t\t\tif (namespaces[0] === '-') {\n\t\t\t\tcreateDebug.skips.push(new RegExp('^' + namespaces.slice(1) + '$'));\n\t\t\t} else {\n\t\t\t\tcreateDebug.names.push(new RegExp('^' + namespaces + '$'));\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t* Disable debug output.\n\t*\n\t* @return {String} namespaces\n\t* @api public\n\t*/\n\tfunction disable() {\n\t\tconst namespaces = [\n\t\t\t...createDebug.names.map(toNamespace),\n\t\t\t...createDebug.skips.map(toNamespace).map(namespace => '-' + namespace)\n\t\t].join(',');\n\t\tcreateDebug.enable('');\n\t\treturn namespaces;\n\t}\n\n\t/**\n\t* Returns true if the given mode name is enabled, false otherwise.\n\t*\n\t* @param {String} name\n\t* @return {Boolean}\n\t* @api public\n\t*/\n\tfunction enabled(name) {\n\t\tif (name[name.length - 1] === '*') {\n\t\t\treturn true;\n\t\t}\n\n\t\tlet i;\n\t\tlet len;\n\n\t\tfor (i = 0, len = createDebug.skips.length; i < len; i++) {\n\t\t\tif (createDebug.skips[i].test(name)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0, len = createDebug.names.length; i < len; i++) {\n\t\t\tif (createDebug.names[i].test(name)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t* Convert regexp to namespace\n\t*\n\t* @param {RegExp} regxep\n\t* @return {String} namespace\n\t* @api private\n\t*/\n\tfunction toNamespace(regexp) {\n\t\treturn regexp.toString()\n\t\t\t.substring(2, regexp.toString().length - 2)\n\t\t\t.replace(/\\.\\*\\?$/, '*');\n\t}\n\n\t/**\n\t* Coerce `val`.\n\t*\n\t* @param {Mixed} val\n\t* @return {Mixed}\n\t* @api private\n\t*/\n\tfunction coerce(val) {\n\t\tif (val instanceof Error) {\n\t\t\treturn val.stack || val.message;\n\t\t}\n\t\treturn val;\n\t}\n\n\t/**\n\t* XXX DO NOT USE. This is a temporary stub function.\n\t* XXX It WILL be removed in the next major release.\n\t*/\n\tfunction destroy() {\n\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t}\n\n\tcreateDebug.enable(createDebug.load());\n\n\treturn createDebug;\n}\n\nmodule.exports = setup;\n","'use strict';\n\nvar isMergeableObject = function isMergeableObject(value) {\n\treturn isNonNullObject(value)\n\t\t&& !isSpecial(value)\n};\n\nfunction isNonNullObject(value) {\n\treturn !!value && typeof value === 'object'\n}\n\nfunction isSpecial(value) {\n\tvar stringValue = Object.prototype.toString.call(value);\n\n\treturn stringValue === '[object RegExp]'\n\t\t|| stringValue === '[object Date]'\n\t\t|| isReactElement(value)\n}\n\n// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25\nvar canUseSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;\n\nfunction isReactElement(value) {\n\treturn value.$$typeof === REACT_ELEMENT_TYPE\n}\n\nfunction emptyTarget(val) {\n\treturn Array.isArray(val) ? [] : {}\n}\n\nfunction cloneUnlessOtherwiseSpecified(value, options) {\n\treturn (options.clone !== false && options.isMergeableObject(value))\n\t\t? deepmerge(emptyTarget(value), value, options)\n\t\t: value\n}\n\nfunction defaultArrayMerge(target, source, options) {\n\treturn target.concat(source).map(function(element) {\n\t\treturn cloneUnlessOtherwiseSpecified(element, options)\n\t})\n}\n\nfunction getMergeFunction(key, options) {\n\tif (!options.customMerge) {\n\t\treturn deepmerge\n\t}\n\tvar customMerge = options.customMerge(key);\n\treturn typeof customMerge === 'function' ? customMerge : deepmerge\n}\n\nfunction getEnumerableOwnPropertySymbols(target) {\n\treturn Object.getOwnPropertySymbols\n\t\t? Object.getOwnPropertySymbols(target).filter(function(symbol) {\n\t\t\treturn Object.propertyIsEnumerable.call(target, symbol)\n\t\t})\n\t\t: []\n}\n\nfunction getKeys(target) {\n\treturn Object.keys(target).concat(getEnumerableOwnPropertySymbols(target))\n}\n\nfunction propertyIsOnObject(object, property) {\n\ttry {\n\t\treturn property in object\n\t} catch(_) {\n\t\treturn false\n\t}\n}\n\n// Protects from prototype poisoning and unexpected merging up the prototype chain.\nfunction propertyIsUnsafe(target, key) {\n\treturn propertyIsOnObject(target, key) // Properties are safe to merge if they don't exist in the target yet,\n\t\t&& !(Object.hasOwnProperty.call(target, key) // unsafe if they exist up the prototype chain,\n\t\t\t&& Object.propertyIsEnumerable.call(target, key)) // and also unsafe if they're nonenumerable.\n}\n\nfunction mergeObject(target, source, options) {\n\tvar destination = {};\n\tif (options.isMergeableObject(target)) {\n\t\tgetKeys(target).forEach(function(key) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(target[key], options);\n\t\t});\n\t}\n\tgetKeys(source).forEach(function(key) {\n\t\tif (propertyIsUnsafe(target, key)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (propertyIsOnObject(target, key) && options.isMergeableObject(source[key])) {\n\t\t\tdestination[key] = getMergeFunction(key, options)(target[key], source[key], options);\n\t\t} else {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(source[key], options);\n\t\t}\n\t});\n\treturn destination\n}\n\nfunction deepmerge(target, source, options) {\n\toptions = options || {};\n\toptions.arrayMerge = options.arrayMerge || defaultArrayMerge;\n\toptions.isMergeableObject = options.isMergeableObject || isMergeableObject;\n\t// cloneUnlessOtherwiseSpecified is added to `options` so that custom arrayMerge()\n\t// implementations can use it. The caller may not replace it.\n\toptions.cloneUnlessOtherwiseSpecified = cloneUnlessOtherwiseSpecified;\n\n\tvar sourceIsArray = Array.isArray(source);\n\tvar targetIsArray = Array.isArray(target);\n\tvar sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;\n\n\tif (!sourceAndTargetTypesMatch) {\n\t\treturn cloneUnlessOtherwiseSpecified(source, options)\n\t} else if (sourceIsArray) {\n\t\treturn options.arrayMerge(target, source, options)\n\t} else {\n\t\treturn mergeObject(target, source, options)\n\t}\n}\n\ndeepmerge.all = function deepmergeAll(array, options) {\n\tif (!Array.isArray(array)) {\n\t\tthrow new Error('first argument should be an array')\n\t}\n\n\treturn array.reduce(function(prev, next) {\n\t\treturn deepmerge(prev, next, options)\n\t}, {})\n};\n\nvar deepmerge_1 = deepmerge;\n\nmodule.exports = deepmerge_1;\n","'use strict';\n\nvar hasOwn = Object.prototype.hasOwnProperty;\nvar toStr = Object.prototype.toString;\nvar defineProperty = Object.defineProperty;\nvar gOPD = Object.getOwnPropertyDescriptor;\n\nvar isArray = function isArray(arr) {\n\tif (typeof Array.isArray === 'function') {\n\t\treturn Array.isArray(arr);\n\t}\n\n\treturn toStr.call(arr) === '[object Array]';\n};\n\nvar isPlainObject = function isPlainObject(obj) {\n\tif (!obj || toStr.call(obj) !== '[object Object]') {\n\t\treturn false;\n\t}\n\n\tvar hasOwnConstructor = hasOwn.call(obj, 'constructor');\n\tvar hasIsPrototypeOf = obj.constructor && obj.constructor.prototype && hasOwn.call(obj.constructor.prototype, 'isPrototypeOf');\n\t// Not own constructor property must be Object\n\tif (obj.constructor && !hasOwnConstructor && !hasIsPrototypeOf) {\n\t\treturn false;\n\t}\n\n\t// Own properties are enumerated firstly, so to speed up,\n\t// if last one is own, then all properties are own.\n\tvar key;\n\tfor (key in obj) { /**/ }\n\n\treturn typeof key === 'undefined' || hasOwn.call(obj, key);\n};\n\n// If name is '__proto__', and Object.defineProperty is available, define __proto__ as an own property on target\nvar setProperty = function setProperty(target, options) {\n\tif (defineProperty && options.name === '__proto__') {\n\t\tdefineProperty(target, options.name, {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true,\n\t\t\tvalue: options.newValue,\n\t\t\twritable: true\n\t\t});\n\t} else {\n\t\ttarget[options.name] = options.newValue;\n\t}\n};\n\n// Return undefined instead of __proto__ if '__proto__' is not an own property\nvar getProperty = function getProperty(obj, name) {\n\tif (name === '__proto__') {\n\t\tif (!hasOwn.call(obj, name)) {\n\t\t\treturn void 0;\n\t\t} else if (gOPD) {\n\t\t\t// In early versions of node, obj['__proto__'] is buggy when obj has\n\t\t\t// __proto__ as an own property. Object.getOwnPropertyDescriptor() works.\n\t\t\treturn gOPD(obj, name).value;\n\t\t}\n\t}\n\n\treturn obj[name];\n};\n\nmodule.exports = function extend() {\n\tvar options, name, src, copy, copyIsArray, clone;\n\tvar target = arguments[0];\n\tvar i = 1;\n\tvar length = arguments.length;\n\tvar deep = false;\n\n\t// Handle a deep copy situation\n\tif (typeof target === 'boolean') {\n\t\tdeep = target;\n\t\ttarget = arguments[1] || {};\n\t\t// skip the boolean and the target\n\t\ti = 2;\n\t}\n\tif (target == null || (typeof target !== 'object' && typeof target !== 'function')) {\n\t\ttarget = {};\n\t}\n\n\tfor (; i < length; ++i) {\n\t\toptions = arguments[i];\n\t\t// Only deal with non-null/undefined values\n\t\tif (options != null) {\n\t\t\t// Extend the base object\n\t\t\tfor (name in options) {\n\t\t\t\tsrc = getProperty(target, name);\n\t\t\t\tcopy = getProperty(options, name);\n\n\t\t\t\t// Prevent never-ending loop\n\t\t\t\tif (target !== copy) {\n\t\t\t\t\t// Recurse if we're merging plain objects or arrays\n\t\t\t\t\tif (deep && copy && (isPlainObject(copy) || (copyIsArray = isArray(copy)))) {\n\t\t\t\t\t\tif (copyIsArray) {\n\t\t\t\t\t\t\tcopyIsArray = false;\n\t\t\t\t\t\t\tclone = src && isArray(src) ? src : [];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclone = src && isPlainObject(src) ? src : {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Never move original objects, clone them\n\t\t\t\t\t\tsetProperty(target, { name: name, newValue: extend(deep, clone, copy) });\n\n\t\t\t\t\t// Don't bring in undefined values\n\t\t\t\t\t} else if (typeof copy !== 'undefined') {\n\t\t\t\t\t\tsetProperty(target, { name: name, newValue: copy });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Return the modified object\n\treturn target;\n};\n","// http://www.w3.org/TR/CSS21/grammar.html\n// https://github.com/visionmedia/css-parse/pull/49#issuecomment-30088027\nvar COMMENT_REGEX = /\\/\\*[^*]*\\*+([^/*][^*]*\\*+)*\\//g;\n\nvar NEWLINE_REGEX = /\\n/g;\nvar WHITESPACE_REGEX = /^\\s*/;\n\n// declaration\nvar PROPERTY_REGEX = /^(\\*?[-#/*\\\\\\w]+(\\[[0-9a-z_-]+\\])?)\\s*/;\nvar COLON_REGEX = /^:\\s*/;\nvar VALUE_REGEX = /^((?:'(?:\\\\'|.)*?'|\"(?:\\\\\"|.)*?\"|\\([^)]*?\\)|[^};])+)/;\nvar SEMICOLON_REGEX = /^[;\\s]*/;\n\n// https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String/Trim#Polyfill\nvar TRIM_REGEX = /^\\s+|\\s+$/g;\n\n// strings\nvar NEWLINE = '\\n';\nvar FORWARD_SLASH = '/';\nvar ASTERISK = '*';\nvar EMPTY_STRING = '';\n\n// types\nvar TYPE_COMMENT = 'comment';\nvar TYPE_DECLARATION = 'declaration';\n\n/**\n * @param {String} style\n * @param {Object} [options]\n * @return {Object[]}\n * @throws {TypeError}\n * @throws {Error}\n */\nmodule.exports = function (style, options) {\n  if (typeof style !== 'string') {\n    throw new TypeError('First argument must be a string');\n  }\n\n  if (!style) return [];\n\n  options = options || {};\n\n  /**\n   * Positional.\n   */\n  var lineno = 1;\n  var column = 1;\n\n  /**\n   * Update lineno and column based on `str`.\n   *\n   * @param {String} str\n   */\n  function updatePosition(str) {\n    var lines = str.match(NEWLINE_REGEX);\n    if (lines) lineno += lines.length;\n    var i = str.lastIndexOf(NEWLINE);\n    column = ~i ? str.length - i : column + str.length;\n  }\n\n  /**\n   * Mark position and patch `node.position`.\n   *\n   * @return {Function}\n   */\n  function position() {\n    var start = { line: lineno, column: column };\n    return function (node) {\n      node.position = new Position(start);\n      whitespace();\n      return node;\n    };\n  }\n\n  /**\n   * Store position information for a node.\n   *\n   * @constructor\n   * @property {Object} start\n   * @property {Object} end\n   * @property {undefined|String} source\n   */\n  function Position(start) {\n    this.start = start;\n    this.end = { line: lineno, column: column };\n    this.source = options.source;\n  }\n\n  /**\n   * Non-enumerable source string.\n   */\n  Position.prototype.content = style;\n\n  var errorsList = [];\n\n  /**\n   * Error `msg`.\n   *\n   * @param {String} msg\n   * @throws {Error}\n   */\n  function error(msg) {\n    var err = new Error(\n      options.source + ':' + lineno + ':' + column + ': ' + msg\n    );\n    err.reason = msg;\n    err.filename = options.source;\n    err.line = lineno;\n    err.column = column;\n    err.source = style;\n\n    if (options.silent) {\n      errorsList.push(err);\n    } else {\n      throw err;\n    }\n  }\n\n  /**\n   * Match `re` and return captures.\n   *\n   * @param {RegExp} re\n   * @return {undefined|Array}\n   */\n  function match(re) {\n    var m = re.exec(style);\n    if (!m) return;\n    var str = m[0];\n    updatePosition(str);\n    style = style.slice(str.length);\n    return m;\n  }\n\n  /**\n   * Parse whitespace.\n   */\n  function whitespace() {\n    match(WHITESPACE_REGEX);\n  }\n\n  /**\n   * Parse comments.\n   *\n   * @param {Object[]} [rules]\n   * @return {Object[]}\n   */\n  function comments(rules) {\n    var c;\n    rules = rules || [];\n    while ((c = comment())) {\n      if (c !== false) {\n        rules.push(c);\n      }\n    }\n    return rules;\n  }\n\n  /**\n   * Parse comment.\n   *\n   * @return {Object}\n   * @throws {Error}\n   */\n  function comment() {\n    var pos = position();\n    if (FORWARD_SLASH != style.charAt(0) || ASTERISK != style.charAt(1)) return;\n\n    var i = 2;\n    while (\n      EMPTY_STRING != style.charAt(i) &&\n      (ASTERISK != style.charAt(i) || FORWARD_SLASH != style.charAt(i + 1))\n    ) {\n      ++i;\n    }\n    i += 2;\n\n    if (EMPTY_STRING === style.charAt(i - 1)) {\n      return error('End of comment missing');\n    }\n\n    var str = style.slice(2, i - 2);\n    column += 2;\n    updatePosition(str);\n    style = style.slice(i);\n    column += 2;\n\n    return pos({\n      type: TYPE_COMMENT,\n      comment: str\n    });\n  }\n\n  /**\n   * Parse declaration.\n   *\n   * @return {Object}\n   * @throws {Error}\n   */\n  function declaration() {\n    var pos = position();\n\n    // prop\n    var prop = match(PROPERTY_REGEX);\n    if (!prop) return;\n    comment();\n\n    // :\n    if (!match(COLON_REGEX)) return error(\"property missing ':'\");\n\n    // val\n    var val = match(VALUE_REGEX);\n\n    var ret = pos({\n      type: TYPE_DECLARATION,\n      property: trim(prop[0].replace(COMMENT_REGEX, EMPTY_STRING)),\n      value: val\n        ? trim(val[0].replace(COMMENT_REGEX, EMPTY_STRING))\n        : EMPTY_STRING\n    });\n\n    // ;\n    match(SEMICOLON_REGEX);\n\n    return ret;\n  }\n\n  /**\n   * Parse declarations.\n   *\n   * @return {Object[]}\n   */\n  function declarations() {\n    var decls = [];\n\n    comments(decls);\n\n    // declarations\n    var decl;\n    while ((decl = declaration())) {\n      if (decl !== false) {\n        decls.push(decl);\n        comments(decls);\n      }\n    }\n\n    return decls;\n  }\n\n  whitespace();\n  return declarations();\n};\n\n/**\n * Trim `str`.\n *\n * @param {String} str\n * @return {String}\n */\nfunction trim(str) {\n  return str ? str.replace(TRIM_REGEX, EMPTY_STRING) : EMPTY_STRING;\n}\n","/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar w = d * 7;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function(val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isFinite(val)) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'weeks':\n    case 'week':\n    case 'w':\n      return n * w;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (msAbs >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (msAbs >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (msAbs >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return plural(ms, msAbs, d, 'day');\n  }\n  if (msAbs >= h) {\n    return plural(ms, msAbs, h, 'hour');\n  }\n  if (msAbs >= m) {\n    return plural(ms, msAbs, m, 'minute');\n  }\n  if (msAbs >= s) {\n    return plural(ms, msAbs, s, 'second');\n  }\n  return ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, msAbs, n, name) {\n  var isPlural = msAbs >= n * 1.5;\n  return Math.round(ms / n) + ' ' + name + (isPlural ? 's' : '');\n}\n","/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar inline_style_parser_1 = __importDefault(require(\"inline-style-parser\"));\n/**\n * Parses inline style to object.\n *\n * @param style - Inline style.\n * @param iterator - Iterator.\n * @returns - Style object or null.\n *\n * @example Parsing inline style to object:\n *\n * ```js\n * import parse from 'style-to-object';\n * parse('line-height: 42;'); // { 'line-height': '42' }\n * ```\n */\nfunction StyleToObject(style, iterator) {\n    var styleObject = null;\n    if (!style || typeof style !== 'string') {\n        return styleObject;\n    }\n    var declarations = (0, inline_style_parser_1.default)(style);\n    var hasIterator = typeof iterator === 'function';\n    declarations.forEach(function (declaration) {\n        if (declaration.type !== 'declaration') {\n            return;\n        }\n        var property = declaration.property, value = declaration.value;\n        if (hasIterator) {\n            iterator(property, value, declaration);\n        }\n        else if (value) {\n            styleObject = styleObject || {};\n            styleObject[property] = value;\n        }\n    });\n    return styleObject;\n}\nexports.default = StyleToObject;\n//# sourceMappingURL=index.js.map","module.exports = window[\"React\"];","/*!\n\tCopyright (c) 2018 Jed Watson.\n\tLicensed under the MIT License (MIT), see\n\thttp://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction classNames () {\n\t\tvar classes = '';\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (arg) {\n\t\t\t\tclasses = appendClass(classes, parseValue(arg));\n\t\t\t}\n\t\t}\n\n\t\treturn classes;\n\t}\n\n\tfunction parseValue (arg) {\n\t\tif (typeof arg === 'string' || typeof arg === 'number') {\n\t\t\treturn arg;\n\t\t}\n\n\t\tif (typeof arg !== 'object') {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (Array.isArray(arg)) {\n\t\t\treturn classNames.apply(null, arg);\n\t\t}\n\n\t\tif (arg.toString !== Object.prototype.toString && !arg.toString.toString().includes('[native code]')) {\n\t\t\treturn arg.toString();\n\t\t}\n\n\t\tvar classes = '';\n\n\t\tfor (var key in arg) {\n\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\tclasses = appendClass(classes, key);\n\t\t\t}\n\t\t}\n\n\t\treturn classes;\n\t}\n\n\tfunction appendClass (value, newClass) {\n\t\tif (!newClass) {\n\t\t\treturn value;\n\t\t}\n\t\n\t\tif (value) {\n\t\t\treturn value + ' ' + newClass;\n\t\t}\n\t\n\t\treturn value + newClass;\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"plugins\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"primitives\"];","/**\n * WordPress dependencies\n */\nimport { Path, SVG } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst more = /*#__PURE__*/_jsx(SVG, {\n  viewBox: \"0 0 24 24\",\n  xmlns: \"http://www.w3.org/2000/svg\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"M4 9v1.5h16V9H4zm12 5.5h4V13h-4v1.5zm-6 0h4V13h-4v1.5zm-6 0h4V13H4v1.5z\"\n  })\n});\nexport default more;\n//# sourceMappingURL=more.js.map","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"privateApis\"];","/**\n * WordPress dependencies\n */\nimport { __dangerousOptInToUnstableAPIsOnlyForCoreModules } from '@wordpress/private-apis';\n\nconst optInStrings = [\n\t'I know using unstable features means my theme or plugin will inevitably break in the next version of WordPress.',\n\t'I acknowledge private features are not for use in themes or plugins and doing so will break in the next version of WordPress.',\n];\n\nfunction optInToUnstableAPIs() {\n\tlet error;\n\tfor ( const optInString of optInStrings ) {\n\t\ttry {\n\t\t\treturn __dangerousOptInToUnstableAPIsOnlyForCoreModules(\n\t\t\t\toptInString,\n\t\t\t\t'@wordpress/edit-site'\n\t\t\t);\n\t\t} catch ( anError ) {\n\t\t\terror = anError;\n\t\t}\n\t}\n\n\tthrow error;\n}\n\nexport const { lock, unlock } = optInToUnstableAPIs();\n","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"editor\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"data\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"element\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"blockEditor\"];","const showLogs =\n\t( typeof window !== 'undefined' &&\n\t\twindow?.bigSkyInitialState?.isDevMode ) ||\n\tfalse;\n\nconst globalConsole = typeof window !== 'undefined' ? window.console : console;\n\nfunction storeLastPayload( payload ) {\n\tif ( ! showLogs ) {\n\t\treturn;\n\t}\n\twindow.bigSkyInitialState.lastPayload = payload;\n}\n\nexport default {\n\tinfo: showLogs ? globalConsole.info.bind( globalConsole ) : () => {},\n\twarn: showLogs ? globalConsole.warn.bind( globalConsole ) : () => {},\n\terror: showLogs ? globalConsole.error.bind( globalConsole ) : () => {},\n\tstoreLastPayload,\n};\n","function createParser(onParse) {\n  let isFirstChunk, buffer, startingPosition, startingFieldLength, eventId, eventName, data;\n  return reset(), { feed, reset };\n  function reset() {\n    isFirstChunk = !0, buffer = \"\", startingPosition = 0, startingFieldLength = -1, eventId = void 0, eventName = void 0, data = \"\";\n  }\n  function feed(chunk) {\n    buffer = buffer ? buffer + chunk : chunk, isFirstChunk && hasBom(buffer) && (buffer = buffer.slice(BOM.length)), isFirstChunk = !1;\n    const length = buffer.length;\n    let position = 0, discardTrailingNewline = !1;\n    for (; position < length; ) {\n      discardTrailingNewline && (buffer[position] === `\n` && ++position, discardTrailingNewline = !1);\n      let lineLength = -1, fieldLength = startingFieldLength, character;\n      for (let index = startingPosition; lineLength < 0 && index < length; ++index)\n        character = buffer[index], character === \":\" && fieldLength < 0 ? fieldLength = index - position : character === \"\\r\" ? (discardTrailingNewline = !0, lineLength = index - position) : character === `\n` && (lineLength = index - position);\n      if (lineLength < 0) {\n        startingPosition = length - position, startingFieldLength = fieldLength;\n        break;\n      } else\n        startingPosition = 0, startingFieldLength = -1;\n      parseEventStreamLine(buffer, position, fieldLength, lineLength), position += lineLength + 1;\n    }\n    position === length ? buffer = \"\" : position > 0 && (buffer = buffer.slice(position));\n  }\n  function parseEventStreamLine(lineBuffer, index, fieldLength, lineLength) {\n    if (lineLength === 0) {\n      data.length > 0 && (onParse({\n        type: \"event\",\n        id: eventId,\n        event: eventName || void 0,\n        data: data.slice(0, -1)\n        // remove trailing newline\n      }), data = \"\", eventId = void 0), eventName = void 0;\n      return;\n    }\n    const noValue = fieldLength < 0, field = lineBuffer.slice(index, index + (noValue ? lineLength : fieldLength));\n    let step = 0;\n    noValue ? step = lineLength : lineBuffer[index + fieldLength + 1] === \" \" ? step = fieldLength + 2 : step = fieldLength + 1;\n    const position = index + step, valueLength = lineLength - step, value = lineBuffer.slice(position, position + valueLength).toString();\n    if (field === \"data\")\n      data += value ? `${value}\n` : `\n`;\n    else if (field === \"event\")\n      eventName = value;\n    else if (field === \"id\" && !value.includes(\"\\0\"))\n      eventId = value;\n    else if (field === \"retry\") {\n      const retry = parseInt(value, 10);\n      Number.isNaN(retry) || onParse({ type: \"reconnect-interval\", value: retry });\n    }\n  }\n}\nconst BOM = [239, 187, 191];\nfunction hasBom(buffer) {\n  return BOM.every((charCode, index) => buffer.charCodeAt(index) === charCode);\n}\nexport {\n  createParser\n};\n//# sourceMappingURL=index.js.map\n","import { createParser } from \"./index.js\";\nclass EventSourceParserStream extends TransformStream {\n  constructor() {\n    let parser;\n    super({\n      start(controller) {\n        parser = createParser((event) => {\n          event.type === \"event\" && controller.enqueue(event);\n        });\n      },\n      transform(chunk) {\n        parser.feed(chunk);\n      }\n    });\n  }\n}\nexport {\n  EventSourceParserStream\n};\n//# sourceMappingURL=stream.js.map\n","/**\n * Internal dependencies\n */\nimport log from '../utils/log-debug.js';\nimport { EventSourceParserStream } from 'eventsource-parser/stream';\n\n// TODO: extract all this to a JSON configuration file\nexport const ChatModelService = {\n\tWPCOM_JETPACK_AI: 'wpcom-jetpack-ai',\n\tWPCOM_OPENAI: 'wpcom-openai', // the wpcom OpenAI proxy\n\tOPENAI: 'openai',\n\tGROQ: 'groq',\n\tOLLAMA: 'ollama',\n\tLMSTUDIO: 'lmstudio',\n\tLOCALAI: 'localai',\n\tLOCAL_GRAPH: 'local-graph',\n\tWPCOM_GRAPH: 'wpcom-graph',\n\tgetAvailable: () => {\n\t\tconst services = [\n\t\t\tChatModelService.WPCOM_JETPACK_AI,\n\t\t\tChatModelService.WPCOM_OPENAI,\n\t\t\tChatModelService.OLLAMA,\n\t\t\tChatModelService.LMSTUDIO,\n\t\t\tChatModelService.LOCALAI,\n\t\t\tChatModelService.OPENAI,\n\t\t\tChatModelService.GROQ,\n\t\t\tChatModelService.LOCAL_GRAPH,\n\t\t\tChatModelService.WPCOM_GRAPH,\n\t\t];\n\t\treturn services;\n\t},\n\tgetDefault: () => {\n\t\treturn ChatModelService.OPENAI;\n\t},\n\tgetDefaultApiKey: ( service ) => {\n\t\tif (\n\t\t\tservice === ChatModelService.GROQ &&\n\t\t\ttypeof process !== 'undefined'\n\t\t) {\n\t\t\treturn process.env.GROQ_API_KEY;\n\t\t} else if (\n\t\t\tservice === ChatModelService.OPENAI &&\n\t\t\ttypeof process !== 'undefined'\n\t\t) {\n\t\t\treturn process.env.OPENAI_API_KEY;\n\t\t}\n\t\treturn null;\n\t},\n};\n\nexport const ChatModelType = {\n\tGPT_4O_MINI: 'gpt-4o-mini',\n\tGPT_4_TURBO: 'gpt-4-turbo',\n\tGPT_4O: 'gpt-4o-2024-11-20',\n\tLLAMA3_70B_8192: 'llama3-70b-8192',\n\tLLAMA3_70B_8192_WPCOM: 'llama3-70b',\n\tGEMMA_7b_INSTRUCT: 'gemma:7b-instruct-q5_K_M',\n\tPHI_3_MEDIUM: 'legraphista/Phi-3-medium-128k-instruct-IMat-GGUF',\n\tMISTRAL_03: 'mistral-0.3',\n\tHERMES_2_PRO_MISTRAL: 'hermes-2-pro-mistral',\n\tisMultimodal: ( model ) => model === ChatModelType.GPT_4O,\n\tsupportsToolMessages: ( model ) =>\n\t\t[\n\t\t\tChatModelType.GPT_4O,\n\t\t\tChatModelType.GPT_4_TURBO,\n\t\t\tChatModelType.GPT_4O_MINI,\n\t\t\tChatModelType.LLAMA3_70B_8192,\n\t\t\tChatModelType.MISTRAL_03,\n\t\t\tChatModelType.HERMES_2_PRO_MISTRAL,\n\t\t\tChatModelType.LOCAL_GRAPH,\n\t\t\tChatModelType.WPCOM_GRAPH,\n\t\t].includes( model ),\n\tgetAvailable: ( service ) => {\n\t\tif ( service === ChatModelService.GROQ ) {\n\t\t\treturn [ ChatModelType.LLAMA3_70B_8192 ];\n\t\t} else if (\n\t\t\t[\n\t\t\t\tChatModelService.WPCOM_JETPACK_AI,\n\t\t\t\tChatModelService.WPCOM_OPENAI,\n\t\t\t].includes( service )\n\t\t) {\n\t\t\treturn [\n\t\t\t\tChatModelType.GPT_4O,\n\t\t\t\tChatModelType.GPT_4_TURBO,\n\t\t\t\tChatModelType.GPT_4O_MINI,\n\t\t\t\tChatModelType.LLAMA3_70B_8192_WPCOM,\n\t\t\t];\n\t\t} else if ( service === ChatModelService.OLLAMA ) {\n\t\t\t// TODO: obtain dynamically\n\t\t\treturn [ ChatModelType.GEMMA_7b_INSTRUCT ];\n\t\t} else if ( service === ChatModelService.LOCALAI ) {\n\t\t\t// TODO: obtain dynamically\n\t\t\treturn [\n\t\t\t\tChatModelType.MISTRAL_03,\n\t\t\t\tChatModelType.HERMES_2_PRO_MISTRAL,\n\t\t\t];\n\t\t} else if ( service === ChatModelService.LMSTUDIO ) {\n\t\t\treturn [ ChatModelType.PHI_3_MEDIUM ];\n\t\t}\n\t\treturn [\n\t\t\tChatModelType.GPT_4O_MINI,\n\t\t\tChatModelType.GPT_4_TURBO,\n\t\t\tChatModelType.GPT_4O,\n\t\t];\n\t},\n\tgetDefault( service = null ) {\n\t\tif ( ! service ) {\n\t\t\tservice = ChatModelService.getDefault();\n\t\t}\n\t\tif ( service === ChatModelService.GROQ ) {\n\t\t\treturn ChatModelType.LLAMA3_70B_8192;\n\t\t} else if (\n\t\t\t[\n\t\t\t\tChatModelService.WPCOM_JETPACK_AI,\n\t\t\t\tChatModelService.WPCOM_OPENAI,\n\t\t\t\tChatModelService.OPENAI,\n\t\t\t].includes( service )\n\t\t) {\n\t\t\treturn ChatModelType.GPT_4O;\n\t\t} else if ( service === ChatModelService.OLLAMA ) {\n\t\t\treturn ChatModelType.GEMMA_7b_INSTRUCT;\n\t\t} else if ( service === ChatModelService.LOCALAI ) {\n\t\t\treturn ChatModelType.HERMES_2_PRO_MISTRAL;\n\t\t}\n\t\treturn ChatModelType.GPT_4O;\n\t},\n};\n\n// reformat the message history based on what the model supports\nconst formatMessagesForModel = ( messages, model ) => {\n\tconst maxImageURLLength = 200; // typically they are base64-encoded so very large\n\tconst isMultimodal = ChatModelType.isMultimodal( model );\n\tconst supportsToolMessages = ChatModelType.supportsToolMessages( model );\n\n\t// if it's not multimodal, convert any multipart \"content\" properties to a simple string containing a list of image URLs.\n\tif ( ! isMultimodal ) {\n\t\tmessages = messages.map( ( message ) => {\n\t\t\tif ( message.content && Array.isArray( message.content ) ) {\n\t\t\t\tconst text = message.content\n\t\t\t\t\t.filter( ( content ) => content.type === 'text' )\n\t\t\t\t\t.map( ( content ) => content.text )\n\t\t\t\t\t.join( '\\n' );\n\t\t\t\tconst imageUrls = message.content\n\t\t\t\t\t.filter( ( content ) => content.type === 'image_url' )\n\t\t\t\t\t.map( ( content ) =>\n\t\t\t\t\t\tcontent.image_url.substring( 0, maxImageURLLength )\n\t\t\t\t\t)\n\t\t\t\t\t.join( '\\n' );\n\t\t\t\tmessage.content = [ text, imageUrls ].join( '\\n' );\n\t\t\t}\n\t\t\treturn message;\n\t\t} );\n\t}\n\n\tif ( ! supportsToolMessages ) {\n\t\tconsole.warn( 'remapping history', messages );\n\t\tmessages = messages.map( ( message ) => {\n\t\t\tif ( message.role === 'tool' ) {\n\t\t\t\treturn {\n\t\t\t\t\t...message,\n\t\t\t\t\trole: 'user',\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn message;\n\t\t} );\n\t\tconsole.warn( 'remapped history', messages );\n\t}\n\n\t// JSON-serialize any tool call arguments in messages[X].tool_calls[Y].function.arguments\n\tmessages = messages.map( ( message ) => {\n\t\tif ( message.tool_calls ) {\n\t\t\treturn {\n\t\t\t\t...message,\n\t\t\t\ttool_calls: message.tool_calls.map( ( tool_call ) => {\n\t\t\t\t\tif ( typeof tool_call.function.arguments !== 'string' ) {\n\t\t\t\t\t\ttool_call.function.arguments = JSON.stringify(\n\t\t\t\t\t\t\ttool_call.function.arguments\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn tool_call;\n\t\t\t\t} ),\n\t\t\t};\n\t\t}\n\t\treturn message;\n\t} );\n\n\treturn messages;\n};\n\nconst DEFAULT_SYSTEM_PROMPT = 'You are a helpful AI assistant.';\n\nfunction formatMessages(\n\thistory,\n\tinstructions,\n\tadditionalInstructions,\n\tmaxHistoryLength,\n\tmodel\n) {\n\tconst trimmedMessages = history.slice( -maxHistoryLength );\n\n\tconst firstNonToolMessageIndex = trimmedMessages.findIndex(\n\t\t( message ) => message.role !== 'tool'\n\t);\n\n\tif ( firstNonToolMessageIndex > 0 ) {\n\t\ttrimmedMessages.splice( 0, firstNonToolMessageIndex );\n\t}\n\n\tconst messages = [\n\t\t{\n\t\t\trole: 'system',\n\t\t\tcontent: instructions,\n\t\t},\n\t\t...formatMessagesForModel( trimmedMessages, model ),\n\t];\n\n\tif ( additionalInstructions ) {\n\t\tmessages.push( {\n\t\t\trole: 'system',\n\t\t\tcontent: additionalInstructions,\n\t\t} );\n\t}\n\n\treturn messages;\n}\n\nclass ChatModel {\n\tconstructor( { apiKey, feature, sessionId } ) {\n\t\tthis.apiKey = apiKey;\n\t\tthis.feature = feature;\n\t\tthis.sessionId = sessionId;\n\t\tthis.abortController = null;\n\t}\n\n\tgetApiKey() {\n\t\treturn this.apiKey;\n\t}\n\n\t/**\n\t * A higher level call to the chat completions API. This method formats the history, sets defaults,\n\t * calls the API, and returns the assistant response message.\n\t *\n\t * @param {Object}        params                        The parameters for the API call\n\t * @param {string}        params.model                  The model to use\n\t * @param {Array<Object>} params.messages               The history of messages (OpenAI Chat Completion format)\n\t * @param {Array<Object>} params.tools                  The tools to use (Swagger/JSONSchema format)\n\t * @param {string}        params.instructions           The system prompt\n\t * @param {string}        params.additionalInstructions The agent loop prompt\n\t * @param {number}        params.temperature            The temperature to use\n\t * @param {number}        params.maxTokens              The maximum number of tokens to generate\n\t * @param {Array<string>} params.tags                   The tags to use for analytics\n\t * @param {Function}      params.middleware             The middleware to use\n\t * @param {string}        params.sessionId              The session ID\n\t * @param {boolean}       params.store                  Whether to store the conversation for debugging in OpenAI dashboard for evaluation: https://platform.openai.com/docs/guides/evals\n\t * @return {Promise<Object>} The response message\n\t */\n\tasync run( {\n\t\tmodel,\n\t\tmessages,\n\t\ttools,\n\t\tinstructions,\n\t\tadditionalInstructions,\n\t\ttemperature,\n\t\tmaxTokens,\n\t\ttags,\n\t\tmiddleware,\n\t\tsessionId,\n\t\tstore,\n\t} ) {\n\t\tif ( ! messages || ! messages.length ) {\n\t\t\tthrow new Error( 'Missing history' );\n\t\t}\n\n\t\tmodel = model ?? this.getDefaultModel();\n\t\tmessages = formatMessages(\n\t\t\tmessages,\n\t\t\tinstructions ?? DEFAULT_SYSTEM_PROMPT,\n\t\t\tadditionalInstructions,\n\t\t\tthis.maxHistoryLength,\n\t\t\tmodel\n\t\t);\n\t\ttemperature = temperature ?? this.getDefaultTemperature( model );\n\t\tconst max_tokens = maxTokens ?? this.getDefaultMaxTokens( model );\n\n\t\tconst invokeChatModel = middleware\n\t\t\t? middleware( this.call.bind( this ), {\n\t\t\t\t\ttags,\n\t\t\t  } )\n\t\t\t: this.call.bind( this );\n\n\t\tconst response = await invokeChatModel( {\n\t\t\tmodel,\n\t\t\ttemperature,\n\t\t\tmax_tokens,\n\t\t\tmessages,\n\t\t\ttools,\n\t\t\tsessionId,\n\t\t\tstore,\n\t\t} );\n\n\t\tconst choice = response.choices[ 0 ];\n\n\t\tif ( choice.finish_reason === 'tool_calls' ) {\n\t\t} else if ( choice.finish_reason === 'length' ) {\n\t\t\tthrow new Error( 'Finish reason length not implemented' );\n\t\t} else if ( choice.finish_reason === 'content_filter' ) {\n\t\t\t// throw new Error( 'The server rejected the request' );\n\t\t} else if ( choice.finish_reason === 'stop' ) {\n\t\t}\n\n\t\t// This is to preserve the ID of the OpenAI response so we can track responses across systems.\n\t\tif ( ! choice.message.id && response.id ) {\n\t\t\tchoice.message.id = response.id;\n\t\t}\n\n\t\treturn choice.message;\n\t}\n\n\t/**\n\t * A direct Chat Completions call. Simply makes the call and checks for HTTP errors.\n\t * @see https://platform.openai.com/docs/api-reference/chat/create\n\t *\n\t * @param {Object}        request             The request object\n\t * @param {string}        request.model       The model to use\n\t * @param {number}        request.temperature The temperature to use\n\t * @param {number}        request.max_tokens  The maximum number of tokens to generate\n\t * @param {Array<Object>} request.messages    The messages to use\n\t * @param {Array<Object>} request.tools       The tools to use\n\t * @param {string}        request.tool_choice The tool to use\n\t * @return {Promise<Object>} The response object\n\t */\n\tasync call( request ) {\n\t\tconst params = this.getParams( request );\n\t\tconst headers = this.getHeaders();\n\t\tthis.abortController = new AbortController();\n\n\t\tlog.info(\n\t\t\t`🤖 Calling ${ this.constructor.name } with model ${ params.model }, temperature ${ params.temperature }, max_tokens ${ params.max_tokens }`\n\t\t);\n\t\tlog.storeLastPayload( params );\n\n\t\tconst serviceRequest = await fetch( this.getServiceUrl(), {\n\t\t\tmethod: 'POST',\n\t\t\theaders,\n\t\t\tbody: JSON.stringify( params ),\n\t\t\tsignal: this.abortController.signal,\n\t\t} );\n\n\t\tif ( serviceRequest.status === 401 ) {\n\t\t\tthrow new Error( 'Unauthorized' );\n\t\t} else if ( serviceRequest.status === 403 ) {\n\t\t\tthrow new Error( 'Forbidden' );\n\t\t} else if ( serviceRequest.status === 429 ) {\n\t\t\tthrow new Error( 'Rate limit exceeded' );\n\t\t} else if ( serviceRequest.status === 500 ) {\n\t\t\tconst responseText = await serviceRequest.text();\n\t\t\tthrow new Error( `Internal server error: ${ responseText }` );\n\t\t}\n\n\t\tlet response;\n\n\t\ttry {\n\t\t\tresponse = await serviceRequest.json();\n\t\t} catch ( error ) {\n\t\t\tif ( error.name === 'AbortError' ) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tconsole.error( 'Error parsing response', error );\n\t\t\tthrow new Error( 'Unexpected response format' );\n\t\t} finally {\n\t\t\tthis.abortController = null;\n\t\t}\n\n\t\t// if response.code is set and response.choices is not, assume it's an error\n\t\tif ( response.code && ! response.choices ) {\n\t\t\tthrow new Error( `${ response.code } ${ response.message ?? '' }` );\n\t\t}\n\n\t\tif ( response.error ) {\n\t\t\tconsole.error( 'Chat Model Error', response.error, params );\n\t\t\tthrow new Error(\n\t\t\t\t`${ response.error.type }: ${ response.error.message }`\n\t\t\t);\n\t\t}\n\n\t\tif ( ! response?.choices || response?.choices.length > 1 ) {\n\t\t\tconsole.error(\n\t\t\t\t'Invalid response from server, unexpected number of choices',\n\t\t\t\tresponse,\n\t\t\t\tresponse?.choices\n\t\t\t);\n\t\t\tthrow new Error( 'Invalid response from server' );\n\t\t}\n\n\t\treturn response;\n\t}\n\n\t/**\n\t *\n\t * @param {*}             request\n\t * @param {string}        request.model                  The model to use\n\t * @param {Array<Object>} request.messages               The messages to use\n\t * @param {Array<Object>} request.tools                  The tools to use\n\t * @param {string}        request.instructions           The system prompt\n\t * @param {string}        request.additionalInstructions The agent loop prompt\n\t * @param {number}        request.temperature            The temperature to use\n\t * @param {number}        request.maxTokens              The maximum number of tokens to generate\n\t * @param {Array<string>} request.tags                   The tags to use for analytics\n\t * @param {Function}      request.middleware             The middleware to use\n\t * @return {*} An async iterable of events\n\t */\n\tasync *runStream( {\n\t\tmodel,\n\t\tmessages,\n\t\ttools,\n\t\tinstructions,\n\t\tadditionalInstructions,\n\t\ttemperature,\n\t\tmaxTokens,\n\t\t// graphConfig,\n\t} ) {\n\t\tif ( ! messages || ! messages.length ) {\n\t\t\tthrow new Error( 'Missing history' );\n\t\t}\n\t\tthis.abortController = new AbortController();\n\t\tconst headers = this.getHeaders();\n\t\t// headers[ 'Content-Type' ] = 'text/event-stream';\n\t\tmodel = model ?? this.getDefaultModel();\n\t\tmessages = formatMessages(\n\t\t\tmessages,\n\t\t\tinstructions ?? DEFAULT_SYSTEM_PROMPT,\n\t\t\tadditionalInstructions,\n\t\t\tthis.maxHistoryLength,\n\t\t\tmodel\n\t\t);\n\t\ttemperature = temperature ?? this.getDefaultTemperature( model );\n\t\tconst max_tokens = maxTokens ?? this.getDefaultMaxTokens( model );\n\n\t\tlog.info(\n\t\t\t`🤖 Streaming ${ this.constructor.name } with model ${ model }, temperature ${ temperature }, max_tokens ${ max_tokens }`\n\t\t);\n\n\t\tconst params = this.getParams( {\n\t\t\tmodel,\n\t\t\ttemperature,\n\t\t\tmax_tokens,\n\t\t\tmessages,\n\t\t\ttools,\n\t\t\tstream: true,\n\t\t} );\n\n\t\tconst response = await fetch( this.getServiceUrl(), {\n\t\t\tmethod: 'POST',\n\t\t\theaders,\n\t\t\tbody: JSON.stringify( params ),\n\t\t\tsignal: this.abortController.signal,\n\t\t} );\n\n\t\tif ( response.status === 401 ) {\n\t\t\tthrow new Error( 'Unauthorized' );\n\t\t} else if ( response.status === 403 ) {\n\t\t\tthrow new Error( 'Forbidden' );\n\t\t} else if ( response.status === 429 ) {\n\t\t\tthrow new Error( 'Rate limit exceeded' );\n\t\t} else if ( response.status === 500 ) {\n\t\t\tconst responseText = await response.text();\n\t\t\tthrow new Error( `Internal server error: ${ responseText }` );\n\t\t}\n\n\t\tconst reader = response.body\n\t\t\t.pipeThrough( new TextDecoderStream() )\n\t\t\t.pipeThrough( new EventSourceParserStream() )\n\t\t\t.getReader();\n\n\t\ttry {\n\t\t\twhile ( true ) {\n\t\t\t\tconst { done, value } = await reader.read();\n\t\t\t\tif ( done ) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif ( value.data === '[DONE]' ) {\n\t\t\t\t\tyield {\n\t\t\t\t\t\tevent: 'done',\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tconst data = JSON.parse( value.data );\n\n\t\t\t\tif ( data.object === 'chat.completion.error' ) {\n\t\t\t\t\tyield {\n\t\t\t\t\t\tevent: 'chat.completion.error',\n\t\t\t\t\t\tdata,\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\t} else if ( data.object === 'chat.completion.chunk' ) {\n\t\t\t\t\tyield {\n\t\t\t\t\t\tevent: 'chat.message.partial',\n\t\t\t\t\t\tdata,\n\t\t\t\t\t};\n\t\t\t\t} else if (\n\t\t\t\t\tdata.object === 'moderation.result.combined' &&\n\t\t\t\t\tObject.keys( data.result ).length > 0\n\t\t\t\t) {\n\t\t\t\t\tyield {\n\t\t\t\t\t\tevent: 'moderation.result.combined',\n\t\t\t\t\t\tdata: data.result,\n\t\t\t\t\t};\n\t\t\t\t} else if (\n\t\t\t\t\t[\n\t\t\t\t\t\t'moderation.result.custom',\n\t\t\t\t\t\t'moderation.result.openai',\n\t\t\t\t\t\t'moderation.result.classifications',\n\t\t\t\t\t].includes( data.object )\n\t\t\t\t) {\n\t\t\t\t\t// silently ignore\n\t\t\t\t\tconsole.log( data.object, data );\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error( 'Unknown object type', value );\n\t\t\t\t}\n\t\t\t}\n\t\t} catch ( err ) {\n\t\t\tconsole.error( 'Stream reading error:', err );\n\t\t} finally {\n\t\t\treader.releaseLock();\n\t\t}\n\t}\n\n\tabortRequest() {\n\t\tif ( this.abortController ) {\n\t\t\tthis.abortController.abort();\n\t\t}\n\t}\n\n\tgetParams( {\n\t\tmodel,\n\t\ttemperature,\n\t\tmax_tokens,\n\t\tmessages,\n\t\ttools,\n\t\tsessionId,\n\t\ttool_choice = null,\n\t\tstream = false,\n\t\tresponse_format = 'text',\n\t} ) {\n\t\tconst params = {\n\t\t\tstream,\n\t\t\tmodel,\n\t\t\ttemperature,\n\t\t\tmessages,\n\t\t\tmax_tokens,\n\t\t\tresponse_format,\n\t\t\tsessionId,\n\t\t};\n\n\t\tif ( tools?.length ) {\n\t\t\tparams.tools = tools;\n\t\t}\n\n\t\tif ( tool_choice ) {\n\t\t\tparams.tool_choice = {\n\t\t\t\ttype: 'function',\n\t\t\t\tfunction: { name: tool_choice },\n\t\t\t};\n\t\t}\n\n\t\treturn params;\n\t}\n\n\tgetHeaders() {\n\t\treturn {\n\t\t\tAuthorization: `Bearer ${ this.apiKey }`,\n\t\t\t'Content-Type': 'application/json',\n\t\t};\n\t}\n\n\tgetDefaultMaxTokens( /* model */ ) {\n\t\treturn 4096;\n\t}\n\n\tgetDefaultTemperature( /* model */ ) {\n\t\treturn 0.2;\n\t}\n\n\tgetDefaultModel() {\n\t\tthrow new Error( 'Not implemented' );\n\t}\n\n\tgetServiceUrl() {\n\t\tthrow new Error( 'Not implemented' );\n\t}\n\n\tstatic getInstance( service, apiKey, feature, sessionId ) {\n\t\tconst params = { apiKey, feature, sessionId };\n\t\tswitch ( service ) {\n\t\t\tcase ChatModelService.GROQ:\n\t\t\t\treturn new GroqChatModel( params );\n\t\t\tcase ChatModelService.OPENAI:\n\t\t\t\treturn new OpenAIChatModel( params );\n\t\t\tcase ChatModelService.WPCOM_JETPACK_AI:\n\t\t\t\treturn new WPCOMJetpackAIChatModel( params );\n\t\t\tcase ChatModelService.WPCOM_OPENAI:\n\t\t\t\treturn new WPCOMOpenAIChatModel( params );\n\t\t\tcase ChatModelService.OLLAMA:\n\t\t\t\treturn new OllamaChatModel( params );\n\t\t\tcase ChatModelService.LMSTUDIO:\n\t\t\t\treturn new LMStudioChatModel( params );\n\t\t\tcase ChatModelService.LOCALAI:\n\t\t\t\treturn new LocalAIChatModel( params );\n\t\t\tcase ChatModelService.LOCAL_GRAPH:\n\t\t\t\treturn new LocalGraphChatModel( params );\n\t\t\tcase ChatModelService.WPCOM_GRAPH:\n\t\t\t\treturn new WPCOMGraphChatModel( params );\n\t\t\tdefault:\n\t\t\t\tthrow new Error( `Unknown service: ${ service }` );\n\t\t}\n\t}\n}\n\nexport class WPCOMJetpackAIChatModel extends ChatModel {\n\tgetDefaultModel() {\n\t\treturn ChatModelType.GPT_4O;\n\t}\n\n\tgetParams( request ) {\n\t\tconst params = super.getParams( request );\n\t\tif ( this.feature ) {\n\t\t\tparams.feature = this.feature;\n\t\t}\n\n\t\tif ( this.sessionId ) {\n\t\t\tparams.session_id = this.sessionId;\n\t\t}\n\n\t\t// Store is a parameter to tell OpenAI to store the conversation for debugging in OpenAI dashboard for evaluation: https://platform.openai.com/docs/guides/evals\n\t\tif ( request.store ) {\n\t\t\tparams.store = request.store;\n\t\t}\n\n\t\treturn params;\n\t}\n\n\tgetServiceUrl() {\n\t\treturn 'https://public-api.wordpress.com/wpcom/v2/jetpack-ai-query';\n\t}\n}\n\nexport class WPCOMOpenAIChatModel extends ChatModel {\n\tgetHeaders() {\n\t\tconst headers = super.getHeaders();\n\t\tif ( this.feature ) {\n\t\t\theaders[ 'X-WPCOM-AI-Feature' ] = this.feature;\n\t\t\theaders[ 'Access-Control-Request-Headers' ] =\n\t\t\t\t'authorization,content-type,X-WPCOM-AI-Feature';\n\t\t}\n\n\t\tif ( this.sessionId ) {\n\t\t\theaders[ 'X-WPCOM-Session-ID' ] = this.sessionId;\n\t\t}\n\n\t\treturn headers;\n\t}\n\n\tgetDefaultModel() {\n\t\treturn ChatModelType.GPT_4O;\n\t}\n\n\tgetServiceUrl() {\n\t\treturn 'https://public-api.wordpress.com/wpcom/v2/openai-proxy/v1/chat/completions';\n\t}\n}\n\nexport class OllamaChatModel extends ChatModel {\n\tgetDefaultModel() {\n\t\treturn ChatModelType.GEMMA_7b_INSTRUCT;\n\t}\n\n\tgetServiceUrl() {\n\t\treturn 'http://localhost:11434/api/chat';\n\t}\n}\n\nexport class LMStudioChatModel extends ChatModel {\n\tgetDefaultModel() {\n\t\treturn ChatModelType.PHI_3_MEDIUM;\n\t}\n\n\tgetServiceUrl() {\n\t\treturn 'http://localhost:1234/v1/chat/completions';\n\t}\n}\n\nexport class LocalAIChatModel extends ChatModel {\n\tgetDefaultModel() {\n\t\treturn ChatModelType.HERMES_2_PRO_MISTRAL;\n\t}\n\n\tgetServiceUrl() {\n\t\treturn 'http://localhost:1234/v1/chat/completions';\n\t}\n}\n\nexport class LocalGraphChatModel extends ChatModel {\n\tconstructor( { apiKey, feature, sessionId } ) {\n\t\tsuper( { apiKey, feature, sessionId } );\n\t}\n\n\tgetApiKey() {\n\t\treturn this.apiKey;\n\t}\n\tgetDefaultModel() {\n\t\treturn ChatModelType.GPT_4O;\n\t}\n\n\tgetServiceUrl() {\n\t\treturn 'http://localhost:8000/ai-services/graphs/chat/completions';\n\t}\n}\n\nexport class WPCOMGraphChatModel extends ChatModel {\n\tconstructor( { apiKey, feature, sessionId } ) {\n\t\tsuper( { apiKey, feature, sessionId } );\n\t}\n\n\tgetHeaders() {\n\t\tconst headers = super.getHeaders();\n\t\tif ( this.feature ) {\n\t\t\theaders[ 'X-WPCOM-AI-Feature' ] = this.feature;\n\t\t\theaders[ 'Access-Control-Request-Headers' ] =\n\t\t\t\t'authorization,content-type,X-WPCOM-AI-Feature';\n\t\t}\n\n\t\tif ( this.sessionId ) {\n\t\t\theaders[ 'X-WPCOM-Session-ID' ] = this.sessionId;\n\t\t}\n\n\t\treturn headers;\n\t}\n\n\tgetDefaultModel() {\n\t\treturn ChatModelType.GPT_4O;\n\t}\n\n\tgetServiceUrl() {\n\t\treturn 'https://public-api.wordpress.com/wpcom/v2/graphs/v1/chat/completions';\n\t}\n}\nexport class OpenAIChatModel extends ChatModel {\n\tgetDefaultModel() {\n\t\treturn ChatModelType.GPT_4O;\n\t}\n\n\tgetServiceUrl() {\n\t\treturn 'https://api.openai.com/v1/chat/completions';\n\t}\n\n\tgetParams( request ) {\n\t\tconst params = super.getParams( request );\n\n\t\t// make sure the response_format is in the correct format\n\t\tif ( typeof params.response_format === 'string' ) {\n\t\t\tparams.response_format = {\n\t\t\t\ttype: params.response_format,\n\t\t\t};\n\t\t}\n\n\t\treturn params;\n\t}\n}\n\nexport class GroqChatModel extends ChatModel {\n\tgetDefaultModel() {\n\t\treturn ChatModelType.LLAMA3_70B_8192;\n\t}\n\n\tgetDefaultTemperature() {\n\t\treturn 0.1;\n\t}\n\n\tgetDefaultMaxTokens() {\n\t\treturn 8192;\n\t}\n\n\tgetServiceUrl() {\n\t\treturn 'https://api.groq.com/openai/v1/chat/completions';\n\t}\n}\n\nexport default ChatModel;\n","import { createReduxStore, createSelector } from '@wordpress/data';\n\nconst initialState = {\n\tagents: [],\n\tactiveAgentId: null,\n\tstarted: false,\n\tchangeAgentCount: 0,\n};\n\nexport const actions = {\n\tsetAgentStarted: ( started ) => {\n\t\treturn {\n\t\t\ttype: 'SET_AGENT_STARTED',\n\t\t\tstarted,\n\t\t};\n\t},\n\tsetActiveAgent: ( agentId ) => {\n\t\treturn {\n\t\t\ttype: 'SET_ACTIVE_AGENT',\n\t\t\tagentId,\n\t\t};\n\t},\n\tregisterAgent: ( agent ) => {\n\t\treturn {\n\t\t\ttype: 'REGISTER_AGENT',\n\t\t\tagent,\n\t\t};\n\t},\n\tincrementChangeAgentCount: () => {\n\t\treturn {\n\t\t\ttype: 'INCREMENT_CHANGE_AGENT_COUNT',\n\t\t};\n\t},\n\tresetChangeAgentCount: () => {\n\t\treturn {\n\t\t\ttype: 'RESET_CHANGE_AGENT_COUNT',\n\t\t};\n\t},\n};\n\nexport const reducer = ( state = initialState, action ) => {\n\tswitch ( action.type ) {\n\t\tcase 'REGISTER_AGENT':\n\t\t\tconst { agent } = action;\n\t\t\tconst existingAgentIndex = state.agents.findIndex(\n\t\t\t\t( a ) => a.id === agent.id\n\t\t\t);\n\n\t\t\tif ( existingAgentIndex !== -1 ) {\n\t\t\t\tconst updatedAgents = [ ...state.agents ];\n\t\t\t\tupdatedAgents[ existingAgentIndex ] = agent;\n\t\t\t\treturn { ...state, agents: updatedAgents };\n\t\t\t}\n\t\t\treturn { ...state, agents: [ ...state.agents, agent ] };\n\t\tcase 'SET_ACTIVE_AGENT':\n\t\t\treturn { ...state, activeAgentId: action.agentId };\n\t\tcase 'SET_AGENT_STARTED':\n\t\t\treturn { ...state, started: action.started };\n\t\tcase 'INCREMENT_CHANGE_AGENT_COUNT':\n\t\t\treturn { ...state, changeAgentCount: state.changeAgentCount + 1 };\n\t\tcase 'RESET_CHANGE_AGENT_COUNT':\n\t\t\treturn { ...state, changeAgentCount: 0 };\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nexport const selectors = {\n\tgetActiveAgentId: ( state ) => state.activeAgentId,\n\tgetAgents: ( state ) => state.agents,\n\tisAgentStarted: ( state ) => state.started,\n\tgetChangeAgentCount: ( state ) => state.changeAgentCount,\n\n\tgetActiveAgent: createSelector(\n\t\t( state ) =>\n\t\t\tstate.agents.find( ( agent ) => agent.id === state.activeAgentId ),\n\t\t( state ) => [ state.agents, state.activeAgentId ]\n\t),\n\n\tgetActiveAgentName: createSelector(\n\t\t( state ) => selectors.getActiveAgent( state )?.name,\n\t\t( state ) => [ state.agents, state.activeAgentId ]\n\t),\n};\n\nexport const slice = {\n\treducer,\n\tactions,\n\tselectors,\n};\n\nexport function createAgentsStore( name, defaultValues ) {\n\treturn createReduxStore( name, {\n\t\treducer,\n\t\tactions,\n\t\tselectors,\n\t\tinitialState: {\n\t\t\t...initialState,\n\t\t\t...defaultValues,\n\t\t},\n\t} );\n}\n","// From https://stackoverflow.com/questions/105034/how-do-i-create-a-guid-uuid\n// ignore no-bitwise error\n\n/* eslint-disable no-bitwise */\nexport default function uuidv4() {\n\treturn '10000000-1000-4000-8000-100000000000'.replace( /[018]/g, ( c ) =>\n\t\t(\n\t\t\tc ^\n\t\t\t( crypto.getRandomValues( new Uint8Array( 1 ) )[ 0 ] &\n\t\t\t\t( 15 >> ( c / 4 ) ) )\n\t\t).toString( 16 )\n\t);\n}\n/* eslint-enable no-bitwise */\n","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"i18n\"];","/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\n\nexport const messageRoles = {\n\tSYSTEM: 'system',\n\tUSER: 'user',\n\tASSISTANT: 'assistant',\n\tLOCAL_ASSISTANT: 'local_assistant', // Used for messages that are shown to user but not returned to the model.\n\tUSER_CHOICE: 'user_choice',\n\tCONFIRM: 'confirm',\n\tACTION: 'action',\n\tCOMPONENT: 'component',\n\tTHINKING: 'thinking',\n\tERROR: 'error',\n\tTOOL_CALL: 'tool_call',\n\tTOOL: 'tool',\n\tSCREENSHOT: 'screenshot',\n\tSET_TOPIC: 'set_topic',\n\tSET_COLOR: 'set_color',\n\tSET_FONT: 'set_font',\n\tSET_SITE_TITLE: 'set_site_title',\n\tSET_SITE_DESCRIPTION: 'set_site_description',\n\tSET_SITE_LOCATION: 'set_site_location',\n\tSAVE_PAGE: 'save_page',\n};\n\nexport const isChatMessage = ( message ) =>\n\ttypeof message.content === 'string' &&\n\t( message.role === messageRoles.USER ||\n\t\tmessage.role === messageRoles.ASSISTANT ||\n\t\tmessage.role === messageRoles.TOOL );\n\nexport const typeAnotherRequest = __( 'Type another request …', 'big-sky' );\n\nexport const defaultSiteMetadata = {\n\tsiteDescription: null,\n\tsiteLocation: null,\n\tsiteTitle: null,\n\tsiteType: null,\n\ttopic: null,\n\tcolorRequest: null,\n\tcurrentColor: null,\n\tcurrentFont: null,\n\tdefaultImageStyle: 'photographic',\n\tpatterns: {},\n};\n\nexport const animationTiming = {\n\tscrollWaitTime: 500,\n\tassistantMessageThinkingTime: 1000,\n\tvisualAdjustmentWaitTime: 2000,\n};\n\nexport const dockViews = {\n\tCHAT: 'chat',\n\tCOMPLETED: 'completed',\n\tHANDOFF: 'handoff',\n\tPENDING: 'pending',\n\tMENUS: 'menus',\n};\n\nexport const MAX_VARIATIONS_TO_SHOW = 6;\n\nexport const sectionStyleRegex = /\\bis-style-(\\S+)\\b/g;\n\nexport const patternKeys = {\n\tITEMS_KEY: 'Items',\n\tITEM_KEY: 'Item',\n\tSECTIONS_KEY: 'Sections',\n\tSECTION_KEY: 'Section',\n};\n","import { createReduxStore, createSelector } from '@wordpress/data';\nimport uuidv4 from '../../utils/uuid.js';\nimport ChatModel from '../ai/chat-model.js';\nimport { messageRoles } from '@utils/constants';\n\nconst initialState = {\n\t// Global\n\terror: null,\n\tenabled: true,\n\tfeature: 'unknown',\n\n\t// LLM related\n\tmodel: null,\n\tservice: null,\n\ttemperature: 0.1,\n\tapiKey: null,\n\tstream: false,\n\tresponse_format: 'text',\n\n\t// graph related (langgraph)\n\tgraphConfig: {},\n\n\t// Chat-API-related\n\tmessages: [],\n\tdocuments: [],\n\ttool_calls: [],\n\tisToolRunning: false,\n\tisFetchingChatCompletion: false,\n\n\t// Assistants-API-related\n\tbaseUrl: null, // default to null\n\t// Store is a parameter to tell OpenAI to store the conversation for debugging in OpenAI dashboard for evaluation: https://platform.openai.com/docs/guides/evals\n\tstore: false,\n};\n\n/**\n * Ensure that a message is massaged into the correct internal format, even if it was created by the Assistant API\n *\n * @param {Object} message\n * @return {Object} The filtered message\n */\nfunction filterChatMessage( message ) {\n\tlet filteredContent = message.content;\n\t// let filteredToolCalls = message.tool_calls;\n\n\tif ( typeof filteredContent === 'undefined' || filteredContent === null ) {\n\t\tfilteredContent = '';\n\t}\n\t// the message.content is sometimes an array like this:\n\t// [{ type: 'text', text: { annotations: [], value: 'foo' }}]\n\t// it needs to be transformed to this:\n\t// [{ type: 'text', text: 'foo' }]\n\t// TODO: do the same thing when syncing back to the assistant API\n\tif ( Array.isArray( filteredContent ) ) {\n\t\tfilteredContent = filteredContent.map( ( content ) => {\n\t\t\tif (\n\t\t\t\tcontent.type === 'text' &&\n\t\t\t\ttypeof content.text?.value === 'string'\n\t\t\t) {\n\t\t\t\treturn {\n\t\t\t\t\t...content,\n\t\t\t\t\ttext: content.text.value,\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn content;\n\t\t} );\n\t}\n\n\treturn {\n\t\t...message,\n\t\tcontent: filteredContent,\n\t};\n}\n\nconst getChatModel = ( select ) => {\n\tconst { service, apiKey, feature, sessionId } = select( ( state ) => ( {\n\t\tservice: state.root.service,\n\t\tapiKey: state.root.apiKey,\n\t\tfeature: state.root.feature,\n\t\tsessionId: state.root.sessionId,\n\t} ) );\n\tif ( ! service || ! apiKey ) {\n\t\tthrow new Error( 'Service and API key are required' );\n\t}\n\treturn ChatModel.getInstance( service, apiKey, feature, sessionId );\n};\n\n/**\n * Make a Chat Completion call\n *\n * @param {Object}        request\n * @param {string}        request.model\n * @param {number}        request.temperature\n * @param {number}        request.maxTokens\n * @param {Array<Object>} request.messages\n * @param {Array<Object>} request.tools\n * @param {Object}        request.instructions\n * @param {Object}        request.additionalInstructions\n */\nconst runChatCompletion =\n\t( request ) =>\n\tasync ( { select, dispatch } ) => {\n\t\tconst {\n\t\t\tstream,\n\t\t\tmodel,\n\t\t\ttemperature,\n\t\t\tmessages,\n\t\t\tfeature,\n\t\t\tresponse_format,\n\t\t\tstore,\n\t\t} = select( ( state ) => {\n\t\t\treturn {\n\t\t\t\tmodel: state.root.model,\n\t\t\t\ttemperature: state.root.temperature,\n\t\t\t\tmessages: state.root.messages,\n\t\t\t\tfeature: state.root.feature,\n\t\t\t\tstream: state.root.stream,\n\t\t\t\tresponse_format: state.root.response_format || '',\n\t\t\t\tstore: state.root.store,\n\t\t\t};\n\t\t} );\n\n\t\t// dispatch an error if service or apiKey are missing\n\t\tif ( ! model || ! temperature ) {\n\t\t\tconsole.error( 'Model and temperature are required', {\n\t\t\t\tmodel,\n\t\t\t\ttemperature,\n\t\t\t\tmessages,\n\t\t\t\tfeature,\n\t\t\t} );\n\t\t\tdispatch( {\n\t\t\t\ttype: 'CHAT_ERROR',\n\t\t\t\terror: 'Model and temperature are required',\n\t\t\t} );\n\t\t\treturn;\n\t\t}\n\n\t\tdispatch( { type: 'CHAT_BEGIN_REQUEST' } );\n\t\ttry {\n\t\t\tif ( stream ) {\n\t\t\t\tdispatch( { type: 'CHAT_BEGIN_REQUEST' } );\n\t\t\t\tconst chatCompletionThreadStream = await getChatModel(\n\t\t\t\t\tselect\n\t\t\t\t).runStream( {\n\t\t\t\t\t...request,\n\t\t\t\t\tmessages,\n\t\t\t\t\tmodel,\n\t\t\t\t\ttemperature,\n\t\t\t\t\tfeature,\n\t\t\t\t\tstore,\n\t\t\t\t\t// graphConfig,\n\t\t\t\t} );\n\t\t\t\tconst message = {\n\t\t\t\t\tcreated_at: Date.now() / 1000,\n\t\t\t\t\trole: 'assistant',\n\t\t\t\t\tcontent: '',\n\t\t\t\t\ttool_calls: [],\n\t\t\t\t};\n\t\t\t\tfor await ( const event of chatCompletionThreadStream ) {\n\t\t\t\t\tswitch ( event.event ) {\n\t\t\t\t\t\tcase 'chat.message.partial':\n\t\t\t\t\t\t\t// handle tool_calls\n\t\t\t\t\t\t\tmessage.id = event.data.id; // redundant but oh well\n\t\t\t\t\t\t\tif ( event.data.choices[ 0 ].delta.tool_calls ) {\n\t\t\t\t\t\t\t\tfor ( const toolCall of event.data.choices[ 0 ]\n\t\t\t\t\t\t\t\t\t.delta.tool_calls ) {\n\t\t\t\t\t\t\t\t\tconst existingToolCall = message.tool_calls[\n\t\t\t\t\t\t\t\t\t\ttoolCall.index\n\t\t\t\t\t\t\t\t\t] ?? {\n\t\t\t\t\t\t\t\t\t\tfunction: {\n\t\t\t\t\t\t\t\t\t\t\tname: '',\n\t\t\t\t\t\t\t\t\t\t\targuments: '',\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\tconst updatedToolCall = {\n\t\t\t\t\t\t\t\t\t\t...existingToolCall,\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\tif ( toolCall.id ) {\n\t\t\t\t\t\t\t\t\t\tupdatedToolCall.id = toolCall.id;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif ( toolCall.type ) {\n\t\t\t\t\t\t\t\t\t\tupdatedToolCall.type = toolCall.type;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif ( toolCall.function.name ) {\n\t\t\t\t\t\t\t\t\t\tupdatedToolCall.function.name +=\n\t\t\t\t\t\t\t\t\t\t\ttoolCall.function.name;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif ( toolCall.function.arguments ) {\n\t\t\t\t\t\t\t\t\t\tupdatedToolCall.function.arguments +=\n\t\t\t\t\t\t\t\t\t\t\ttoolCall.function.arguments;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tmessage.tool_calls[ toolCall.index ] =\n\t\t\t\t\t\t\t\t\t\tupdatedToolCall;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// handle content\n\t\t\t\t\t\t\tif ( event.data.choices[ 0 ].delta.content ) {\n\t\t\t\t\t\t\t\tmessage.content +=\n\t\t\t\t\t\t\t\t\tevent.data.choices[ 0 ].delta.content;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( event.data.finish_reason ) {\n\t\t\t\t\t\t\t\tmessage.finish_reason =\n\t\t\t\t\t\t\t\t\tevent.data.finish_reason;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdispatch( {\n\t\t\t\t\t\t\t\ttype: 'ADD_MESSAGE',\n\t\t\t\t\t\t\t\tmessage,\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'chat.completion.error':\n\t\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t\t'Chat completion error',\n\t\t\t\t\t\t\t\tevent.data\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tdispatch( {\n\t\t\t\t\t\t\t\ttype: 'CHAT_ERROR',\n\t\t\t\t\t\t\t\terror: event.data.error,\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\tdispatch( { type: 'CHAT_END_REQUEST' } );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'done':\n\t\t\t\t\t\t\tdispatch( { type: 'CHAT_END_REQUEST' } );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst assistantMessage = await getChatModel( select ).run( {\n\t\t\t\t...request,\n\t\t\t\tmessages,\n\t\t\t\tmodel,\n\t\t\t\ttemperature,\n\t\t\t\tfeature,\n\t\t\t\tresponse_format,\n\t\t\t\tstore,\n\t\t\t} );\n\t\t\tdispatch( actions.addMessage( assistantMessage ) );\n\t\t\tdispatch( { type: 'CHAT_END_REQUEST' } );\n\t\t} catch ( error ) {\n\t\t\tconsole.error( 'Chat error', error );\n\t\t\tdispatch( { type: 'CHAT_ERROR', error: error.message } );\n\t\t}\n\t};\n\n/**\n * Set the result of a tool call, and if it's a promise then resolve it first.\n *\n * @param {number} toolCallId\n * @param {*}      promise\n * @return {Object} The resulting action\n */\nconst setToolResult =\n\t( toolCallId, promise ) =>\n\tasync ( { dispatch } ) => {\n\t\tdispatch( {\n\t\t\ttype: 'TOOL_BEGIN_REQUEST',\n\t\t\tts: Date.now(),\n\t\t\ttool_call_id: toolCallId,\n\t\t} );\n\t\ttry {\n\t\t\tconst result = await promise;\n\t\t\tdispatch( {\n\t\t\t\ttype: 'TOOL_END_REQUEST',\n\t\t\t\tid: `tc:${ toolCallId }`,\n\t\t\t\tts: Date.now(),\n\t\t\t\ttool_call_id: toolCallId,\n\t\t\t\tresult,\n\t\t\t} );\n\t\t} catch ( error ) {\n\t\t\tdispatch( {\n\t\t\t\ttype: 'TOOL_ERROR',\n\t\t\t\tid: toolCallId,\n\t\t\t\terror: error.message || 'There was an error',\n\t\t\t} );\n\t\t}\n\t};\n\n/**\n * REDUCERS\n */\n\n// TODO: I think this may be related to Assistants API that I'm ripping out in https://github.com/Automattic/big-sky-plugin/pull/2142\nconst addMessageReducer = ( state, message ) => {\n\tmessage = filterChatMessage( message );\n\n\t// if the message has the same ID as an existing message, update it\n\tconst existingMessageIndex = state.messages.findIndex(\n\t\t( existingMessage ) => existingMessage.id === message.id\n\t);\n\n\tif ( existingMessageIndex !== -1 ) {\n\t\t// update thread_id if present\n\t\treturn {\n\t\t\t...state,\n\t\t\tmessages: [\n\t\t\t\t...state.messages.slice( 0, existingMessageIndex ),\n\t\t\t\t{\n\t\t\t\t\t...state.messages[ existingMessageIndex ],\n\t\t\t\t\tthread_id: message.thread_id,\n\t\t\t\t\tstate: message.state,\n\t\t\t\t\tcontent: message.content,\n\t\t\t\t\tadditional_kwargs: message.additional_kwargs,\n\t\t\t\t\ttool_calls: message.tool_calls,\n\t\t\t\t},\n\t\t\t\t...state.messages.slice( existingMessageIndex + 1 ),\n\t\t\t],\n\t\t};\n\t}\n\n\t// special processing for tools - add the tool call messages\n\tif ( message.role === 'tool' && message.tool_call_id ) {\n\t\t// if there's an existing tool call result for this tool call ID, don't add it\n\t\tconst existingToolCallResultMessage = state.messages.find(\n\t\t\t( existingMessage ) =>\n\t\t\t\texistingMessage.role === 'tool' &&\n\t\t\t\texistingMessage.tool_call_id === message.tool_call_id\n\t\t);\n\n\t\tif ( existingToolCallResultMessage ) {\n\t\t\tconsole.warn( 'tool call result already exists', {\n\t\t\t\tmessage,\n\t\t\t\texistingToolCallResultMessage,\n\t\t\t} );\n\t\t\treturn state;\n\t\t}\n\n\t\t// Check if there is a corresponding assistant message with this tool call ID\n\t\tconst hasMatchingAssistantMessage = state.messages.some(\n\t\t\t( existingMessage ) =>\n\t\t\t\texistingMessage.role === 'assistant' &&\n\t\t\t\texistingMessage.tool_calls?.some(\n\t\t\t\t\t( toolCall ) => toolCall.id === message.tool_call_id\n\t\t\t\t)\n\t\t);\n\n\t\tif ( ! hasMatchingAssistantMessage ) {\n\t\t\treturn state;\n\t\t}\n\t}\n\n\t// Ensure all messages have created_at\n\tif (\n\t\t! message.created_at ||\n\t\tstate.messages.some( ( m ) => ! m.created_at )\n\t) {\n\t\tconsole.warn(\n\t\t\t'All messages must have a created_at timestamp',\n\t\t\tmessage,\n\t\t\tstate.messages\n\t\t);\n\t}\n\n\treturn {\n\t\t...state,\n\t\tmessages: sortMessageHistory( [ ...state.messages, message ] ),\n\t};\n};\n\nconst sortMessageHistory = ( messages ) => {\n\tconst sortedMessages = [ ...messages ];\n\tsortedMessages.sort( ( a, b ) => a.created_at - b.created_at );\n\n\t// Move tool messages after their corresponding assistant messages\n\tfor ( let i = 0; i < sortedMessages.length; i++ ) {\n\t\tif (\n\t\t\tsortedMessages[ i ].role === 'assistant' &&\n\t\t\tsortedMessages[ i ].tool_calls &&\n\t\t\tsortedMessages[ i ].tool_calls.length > 0\n\t\t) {\n\t\t\tlet insertIndex = i + 1;\n\t\t\tfor ( let j = i + 1; j < sortedMessages.length; j++ ) {\n\t\t\t\tif (\n\t\t\t\t\tsortedMessages[ j ].role === 'tool' &&\n\t\t\t\t\tsortedMessages[ i ].tool_calls.some(\n\t\t\t\t\t\t( call ) => call.id === sortedMessages[ j ].tool_call_id\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tconst toolMessage = sortedMessages.splice( j, 1 )[ 0 ];\n\t\t\t\t\tsortedMessages.splice( insertIndex, 0, toolMessage );\n\t\t\t\t\tinsertIndex++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn sortedMessages;\n};\n\nexport const reducer = ( state = initialState, action ) => {\n\tswitch ( action.type ) {\n\t\t// LLM-related\n\t\tcase 'SET_ENABLED':\n\t\t\treturn { ...state, enabled: action.enabled };\n\t\tcase 'SET_ERROR':\n\t\t\treturn { ...state, error: action.error };\n\t\tcase 'SET_STREAM':\n\t\t\treturn { ...state, stream: action.stream };\n\t\tcase 'SET_SERVICE':\n\t\t\treturn { ...state, service: action.service };\n\t\tcase 'SET_API_KEY':\n\t\t\treturn { ...state, apiKey: action.apiKey };\n\t\tcase 'SET_BASE_URL':\n\t\t\treturn { ...state, baseUrl: action.baseUrl };\n\t\tcase 'SET_FEATURE':\n\t\t\treturn { ...state, feature: action.feature };\n\t\tcase 'SET_SESSION_ID':\n\t\t\treturn { ...state, sessionId: action.sessionId };\n\t\tcase 'SET_MODEL':\n\t\t\treturn { ...state, model: action.model };\n\t\tcase 'SET_TEMPERATURE':\n\t\t\treturn { ...state, temperature: action.temperature };\n\t\tcase 'SET_STORE_CONVERSATION':\n\t\t\treturn { ...state, store: action.store };\n\n\t\t// Chat Completion\n\t\tcase 'CHAT_BEGIN_REQUEST':\n\t\t\treturn { ...state, isFetchingChatCompletion: true };\n\t\tcase 'CHAT_END_REQUEST':\n\t\t\treturn { ...state, isFetchingChatCompletion: false };\n\t\tcase 'CHAT_ERROR':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisFetchingChatCompletion: false,\n\t\t\t\terror: action.error,\n\t\t\t};\n\n\t\t// Begin Tool Processing\n\t\tcase 'TOOL_BEGIN_REQUEST':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttool_calls: [\n\t\t\t\t\t...state.tool_calls,\n\t\t\t\t\t{\n\t\t\t\t\t\tid: action.tool_call_id,\n\t\t\t\t\t\tcreated_at: action.ts,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tisToolRunning: true,\n\t\t\t};\n\t\tcase 'TOOL_CALL_UPDATE':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttool_calls: state.tool_calls.map( ( tc ) => {\n\t\t\t\t\tif ( tc.id === action.tool_call_id ) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...tc,\n\t\t\t\t\t\t\t...action.update,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\treturn tc;\n\t\t\t\t} ),\n\t\t\t};\n\t\tcase 'TOOL_UPDATE_REQUEST':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttool_calls: state.tool_calls.map( ( tc ) => {\n\t\t\t\t\tif ( tc.id === action.delta.id ) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tname: action.delta.function.name ?? tc.name,\n\t\t\t\t\t\t\targuments: action.delta.function.arguments\n\t\t\t\t\t\t\t\t? tc.arguments + action.delta.function.arguments\n\t\t\t\t\t\t\t\t: tc.arguments,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\treturn tc;\n\t\t\t\t} ),\n\t\t\t};\n\t\tcase 'TOOL_END_REQUEST':\n\t\t\treturn {\n\t\t\t\t...addMessageReducer( state, {\n\t\t\t\t\trole: 'tool',\n\t\t\t\t\tid: action.id,\n\t\t\t\t\tcreated_at: action.ts / 1000,\n\t\t\t\t\ttool_call_id: action.tool_call_id,\n\t\t\t\t\tcontent: action.result,\n\t\t\t\t} ),\n\t\t\t\terror: null,\n\t\t\t\tisToolRunning: false,\n\t\t\t\ttool_calls: state.tool_calls.filter(\n\t\t\t\t\t( tc ) => tc.id !== action.tool_call_id\n\t\t\t\t),\n\t\t\t};\n\t\tcase 'TOOL_ERROR':\n\t\t\treturn {\n\t\t\t\t...addMessageReducer( state, {\n\t\t\t\t\trole: 'tool',\n\t\t\t\t\tid: action.id,\n\t\t\t\t\ttool_call_id: action.tool_call_id,\n\t\t\t\t\tcontent: 'Error',\n\t\t\t\t} ),\n\t\t\t\terror: action.error,\n\t\t\t\tisToolRunning: false,\n\t\t\t\ttool_calls: state.tool_calls.map( ( tc ) => {\n\t\t\t\t\tif ( tc.id === action.tool_call_id ) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...tc,\n\t\t\t\t\t\t\terror: action.error,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\treturn tc;\n\t\t\t\t} ),\n\t\t\t};\n\n\t\t// Add and Clear Messages\n\t\tcase 'ADD_MESSAGE':\n\t\t\treturn addMessageReducer( state, action.message );\n\t\tcase 'ADD_MESSAGE_TOOL_CALL':\n\t\t\t// add an assistant message with the tool calls\n\t\t\tstate = addMessageReducer( state, {\n\t\t\t\tid: action.id,\n\t\t\t\trole: 'assistant',\n\t\t\t\tcreated_at: action.ts / 1000,\n\t\t\t\ttool_calls: action.tool_calls,\n\t\t\t} );\n\t\t\treturn state;\n\t\tcase 'APPLY_MESSAGE_CONTENT_DELTA':\n\t\t\tconst id = action.id;\n\t\t\tconst contentDelta = action.content;\n\t\t\tconst messageIndex = state.messages.findIndex(\n\t\t\t\t( message ) => message.id === id\n\t\t\t);\n\t\t\tif ( messageIndex === -1 ) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\tconst message = { ...state.messages[ messageIndex ] };\n\t\t\tconsole.warn( 'got message', message );\n\t\t\tcontentDelta.forEach( ( delta ) => {\n\t\t\t\tconst { index, text } = delta;\n\t\t\t\tif ( message.content[ index ] ) {\n\t\t\t\t\tmessage.content[ index ].text += text.value;\n\t\t\t\t} else {\n\t\t\t\t\tmessage.content.push( {\n\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\ttext: text.value,\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t} );\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tmessages: [\n\t\t\t\t\t...state.messages.slice( 0, messageIndex ),\n\t\t\t\t\tmessage,\n\t\t\t\t\t...state.messages.slice( messageIndex + 1 ),\n\t\t\t\t],\n\t\t\t};\n\n\t\tcase 'SET_MESSAGES':\n\t\t\treturn { ...state, messages: action.messages };\n\n\t\tcase 'CLEAR_MESSAGES':\n\t\t\tswitch ( action.messageType ) {\n\t\t\t\tcase 'tool':\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...state,\n\t\t\t\t\t\tmessages: state.messages.filter(\n\t\t\t\t\t\t\t( _message ) =>\n\t\t\t\t\t\t\t\t! (\n\t\t\t\t\t\t\t\t\t_message.role === messageRoles.ASSISTANT &&\n\t\t\t\t\t\t\t\t\t_message.content === ''\n\t\t\t\t\t\t\t\t) &&\n\t\t\t\t\t\t\t\t_message.role !== messageRoles.TOOL &&\n\t\t\t\t\t\t\t\t! _message.tool_calls?.length\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\tcase 'system':\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...state,\n\t\t\t\t\t\tmessages: state.messages.filter(\n\t\t\t\t\t\t\t( _message ) =>\n\t\t\t\t\t\t\t\t_message.role !== messageRoles.SYSTEM\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\tcase 'all':\n\t\t\t\tdefault:\n\t\t\t\t\treturn { ...state, messages: [] };\n\t\t\t}\n\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\n/**\n * Extract Tool Calls from state.\n *\n * @param {*}      state         The state\n * @param {string} function_name If provided, only return tool calls for this function\n * @return {Array} \t An array of tool calls\n */\nconst getToolCalls = ( state, function_name = null ) => {\n\tconst messagesWithToolCalls = state.messages\n\t\t.filter(\n\t\t\t( message ) =>\n\t\t\t\tmessage.role === 'assistant' &&\n\t\t\t\tmessage.tool_calls?.some(\n\t\t\t\t\t( toolCall ) =>\n\t\t\t\t\t\t! function_name ||\n\t\t\t\t\t\ttoolCall.function.name === function_name\n\t\t\t\t)\n\t\t)\n\t\t.map( ( message ) => message.tool_calls );\n\n\tconst toolCalls = messagesWithToolCalls.reduce(\n\t\t( acc, val ) => acc.concat( val ),\n\t\t[]\n\t);\n\n\treturn toolCalls;\n};\n\n/**\n * Extract Tool Outputs from state.\n *\n * @param {*} state The state\n * @return {Array} An array of tool outputs\n */\nconst getToolOutputs = createSelector(\n\t( state ) =>\n\t\tstate.messages\n\t\t\t.filter( ( message ) => message.role === 'tool' )\n\t\t\t.map( ( message ) => ( {\n\t\t\t\ttool_call_id: message.tool_call_id,\n\t\t\t\toutput: message.content,\n\t\t\t} ) ),\n\t( state ) => [ state.messages ]\n);\n\nexport const selectors = {\n\tisEnabled: ( state ) => {\n\t\treturn state.enabled;\n\t},\n\tisLoading: () => false,\n\tisRunning: ( state ) =>\n\t\tstate.isToolRunning || state.isFetchingChatCompletion,\n\tisServiceAvailable: ( state ) =>\n\t\tstate.enabled && ! state.error && state.service && state.apiKey,\n\tisChatAvailable: ( state ) => selectors.isServiceAvailable( state ),\n\tisAvailable: ( state ) => selectors.isChatAvailable( state ),\n\tisAwaitingUserInput: ( state ) =>\n\t\tselectors.getPendingToolCalls( state ).length > 0 ||\n\t\tselectors.getRunningToolCallIds( state ).length > 0 ||\n\t\tselectors.getAssistantMessage( state ),\n\tgetStream: ( state ) => state.stream,\n\tgetService: ( state ) => state.service,\n\tgetModel: ( state ) => state.model,\n\tgetTemperature: ( state ) => state.temperature,\n\tgetFeature: ( state ) => state.feature,\n\tgetApiKey: ( state ) => state.apiKey,\n\tgetBaseUrl: ( state ) => state.baseUrl,\n\tgetError: ( state ) => state.error,\n\tgetMessages: ( state ) => state.messages,\n\tgetDocuments: ( state ) => state.documents,\n\tgetAssistantMessage: ( state ) => {\n\t\t// TODO: I think this may be related to Assistants API that I'm ripping out in https://github.com/Automattic/big-sky-plugin/pull/2142\n\t\t// return the last message only if it's an assistant message with content\n\t\tconst lastMessage = state.messages[ state.messages.length - 1 ];\n\t\treturn lastMessage?.role === 'assistant' && lastMessage.content\n\t\t\t? lastMessage.content\n\t\t\t: null;\n\t},\n\tgetToolOutputs,\n\tgetPendingToolCalls: createSelector(\n\t\t( state, function_name = null ) => {\n\t\t\tconst toolCalls = getToolCalls( state, function_name );\n\t\t\tconst runningToolCalls = selectors.getRunningToolCallIds( state );\n\t\t\tconst toolOutputs = getToolOutputs( state );\n\n\t\t\tconst result = toolCalls.filter(\n\t\t\t\t( toolCall ) =>\n\t\t\t\t\t! runningToolCalls.includes( toolCall.id ) &&\n\t\t\t\t\t! toolOutputs.some(\n\t\t\t\t\t\t( toolOutput ) =>\n\t\t\t\t\t\t\ttoolOutput.tool_call_id === toolCall.id\n\t\t\t\t\t)\n\t\t\t);\n\n\t\t\treturn result;\n\t\t},\n\t\t( state ) => [ state.messages ]\n\t),\n\tgetRunningToolCallIds: ( state ) => {\n\t\treturn state.tool_calls.map( ( tc ) => tc.id );\n\t},\n\tgetAdditionalMessages: createSelector(\n\t\t// TODO: I think this may be related to Assistants API that I'm ripping out in https://github.com/Automattic/big-sky-plugin/pull/2142\n\t\t( state ) => {\n\t\t\t// user/assistant messages without a threadId are considered not to have been synced\n\t\t\treturn state.messages.filter(\n\t\t\t\t( message ) =>\n\t\t\t\t\t[ 'assistant', 'user' ].includes( message.role ) &&\n\t\t\t\t\tmessage.content &&\n\t\t\t\t\t! message.thread_id\n\t\t\t);\n\t\t},\n\t\t( state ) => [ state.messages ]\n\t),\n\tgetGraphConfig: ( state ) => state.graphConfig, // TODO: I think this may be related to Assistants API that I'm ripping out in https://github.com/Automattic/big-sky-plugin/pull/2142\n\tisStoringConversation: ( state ) => state.store,\n};\n\n/*\n * ACTIONS\n */\n\nconst addMessage = ( message ) => {\n\treturn {\n\t\ttype: 'ADD_MESSAGE',\n\t\tmessage: {\n\t\t\t...message,\n\t\t\tid: message.id || uuidv4(),\n\t\t\tcreated_at: message.created_at || Date.now() / 1000,\n\t\t},\n\t};\n};\n\nconst agentSay = ( content ) => {\n\treturn addMessage( {\n\t\trole: 'assistant',\n\t\tcontent: [\n\t\t\t{\n\t\t\t\ttype: 'text',\n\t\t\t\ttext: content,\n\t\t\t},\n\t\t],\n\t} );\n};\n\nconst clearMessages = ( type = 'all' ) => ( {\n\ttype: 'CLEAR_MESSAGES',\n\tmessageType: type,\n} );\n\nconst clearError = () => ( {\n\ttype: 'CHAT_ERROR',\n\terror: null,\n} );\n\nexport const actions = {\n\tsetEnabled: ( enabled ) => {\n\t\treturn {\n\t\t\ttype: 'SET_ENABLED',\n\t\t\tenabled,\n\t\t};\n\t},\n\tsetError: ( error ) => {\n\t\treturn {\n\t\t\ttype: 'SET_ERROR',\n\t\t\terror,\n\t\t};\n\t},\n\tsetGraphConfig: ( graphConfig ) => ( {\n\t\ttype: 'SET_GRAPH_CONFIG',\n\t\tgraphConfig,\n\t} ),\n\tsetStream: ( stream ) => ( {\n\t\ttype: 'SET_STREAM',\n\t\tstream,\n\t} ),\n\tsetService: ( service ) => ( {\n\t\ttype: 'SET_SERVICE',\n\t\tservice,\n\t} ),\n\tsetApiKey: ( apiKey ) => ( {\n\t\ttype: 'SET_API_KEY',\n\t\tapiKey,\n\t} ),\n\tsetBaseUrl: ( baseUrl ) => ( {\n\t\ttype: 'SET_BASE_URL',\n\t\tbaseUrl,\n\t} ),\n\tsetFeature: ( feature ) => ( {\n\t\ttype: 'SET_FEATURE',\n\t\tfeature,\n\t} ),\n\tsetSessionId: ( sessionId ) => ( {\n\t\ttype: 'SET_SESSION_ID',\n\t\tsessionId,\n\t} ),\n\tsetTemperature: ( temperature ) => ( {\n\t\ttype: 'SET_TEMPERATURE',\n\t\ttemperature,\n\t} ),\n\tsetModel: ( model ) => ( {\n\t\ttype: 'SET_MODEL',\n\t\tmodel,\n\t} ),\n\tsetStoreConversation: ( store ) => ( {\n\t\ttype: 'SET_STORE_CONVERSATION',\n\t\tstore,\n\t} ),\n\tclearError,\n\tsetToolResult,\n\trunChatCompletion,\n\taddMessage,\n\tagentSay,\n\tclearMessages,\n\taddSystemMessage: ( content ) =>\n\t\taddMessage( {\n\t\t\trole: 'system',\n\t\t\tcontent,\n\t\t} ),\n\tuserSay: ( content, image_urls = [] ) =>\n\t\taddMessage( {\n\t\t\trole: 'user',\n\t\t\tid: uuidv4(),\n\t\t\tcontent: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'text',\n\t\t\t\t\ttext: content,\n\t\t\t\t},\n\t\t\t\t...image_urls?.map( ( image_url ) => ( {\n\t\t\t\t\ttype: 'image_url',\n\t\t\t\t\timage_url, //: 'data:image/jpeg;base64,$base64'\n\t\t\t\t} ) ),\n\t\t\t],\n\t\t} ),\n\t// Used to resend the last user message to a different assistant without repeating the message in the chat history.\n\tuserSayRepeat:\n\t\t() =>\n\t\t( { select } ) => {\n\t\t\tconst {\n\t\t\t\tmodel,\n\t\t\t\ttemperature,\n\t\t\t\tmessages,\n\t\t\t\tfeature,\n\t\t\t\tstream,\n\t\t\t\tresponse_format,\n\t\t\t\tstore,\n\t\t\t} = select( ( state ) => ( {\n\t\t\t\tmodel: state.root.model,\n\t\t\t\ttemperature: state.root.temperature,\n\t\t\t\tmessages: state.root.messages,\n\t\t\t\tfeature: state.root.feature,\n\t\t\t\tstream: state.root.stream,\n\t\t\t\tresponse_format: state.root.response_format || '',\n\t\t\t\tstore: state.root.store,\n\t\t\t} ) );\n\n\t\t\treturn runChatCompletion( {\n\t\t\t\tmodel,\n\t\t\t\ttemperature,\n\t\t\t\tmessages,\n\t\t\t\tfeature,\n\t\t\t\tstream,\n\t\t\t\tresponse_format,\n\t\t\t\tstore,\n\t\t\t} );\n\t\t},\n\tcall: ( name, args, id ) => ( {\n\t\ttype: 'ADD_MESSAGE',\n\t\tmessage: {\n\t\t\tid: uuidv4(),\n\t\t\tcreated_at: Date.now() / 1000,\n\t\t\trole: 'assistant',\n\t\t\ttool_calls: [\n\t\t\t\t{\n\t\t\t\t\tid: id ?? uuidv4(),\n\t\t\t\t\ttype: 'function',\n\t\t\t\t\tfunction: {\n\t\t\t\t\t\tname,\n\t\t\t\t\t\targuments: JSON.stringify( args ),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t} ),\n};\n\nexport const slice = {\n\treducer,\n\tactions,\n\tselectors,\n};\n\nexport function createChatStore( name, defaultValues ) {\n\tconsole.warn( 'createChatStore', name, defaultValues );\n\treturn createReduxStore( name, {\n\t\treducer,\n\t\tactions,\n\t\tselectors,\n\t\tinitialState: { ...initialState, ...defaultValues },\n\t} );\n}\n","import { createReduxStore } from '@wordpress/data';\n\nconst initialState = {\n\ttoolkits: [],\n\tcontexts: {},\n\tcallbacks: {},\n\ttools: {},\n};\n\nexport const actions = {\n\tregisterToolkit: ( toolkit ) => {\n\t\treturn {\n\t\t\ttype: 'REGISTER_TOOLKIT',\n\t\t\ttoolkit,\n\t\t};\n\t},\n\tsetCallbacks: ( name, callbacks ) => {\n\t\treturn {\n\t\t\ttype: 'REGISTER_TOOLKIT_CALLBACKS',\n\t\t\tname,\n\t\t\tcallbacks,\n\t\t};\n\t},\n\tsetContext: ( name, context ) => {\n\t\treturn {\n\t\t\ttype: 'REGISTER_TOOLKIT_CONTEXT',\n\t\t\tname,\n\t\t\tcontext,\n\t\t};\n\t},\n};\n\nconst registerToolkit = ( state, action ) => {\n\tconst { toolkit } = action;\n\n\t// if the toolkit includes callbacks, register the callbacks\n\tif ( toolkit.callbacks ) {\n\t\tstate = setCallbacks( state, {\n\t\t\tname: toolkit.name,\n\t\t\tcallbacks: toolkit.callbacks,\n\t\t} );\n\t}\n\n\t// if the toolkit includes context, register the context\n\tif ( toolkit.context ) {\n\t\tstate = setContext( state, {\n\t\t\tname: toolkit.name,\n\t\t\tcontext: toolkit.context,\n\t\t} );\n\t}\n\n\t// if the toolkit includes tools, register the tools\n\tif ( toolkit.tools ) {\n\t\tstate = setTools( state, {\n\t\t\tname: toolkit.name,\n\t\t\ttools: toolkit.tools,\n\t\t} );\n\t}\n\n\t// if there's an existing toolkit with the same name, replace it\n\tconst existingToolkitIndex = state.toolkits.findIndex(\n\t\t( t ) => t.name === toolkit.name\n\t);\n\tif ( existingToolkitIndex !== -1 ) {\n\t\treturn {\n\t\t\t...state,\n\t\t\ttoolkits: [\n\t\t\t\t...state.toolkits.slice( 0, existingToolkitIndex ),\n\t\t\t\ttoolkit,\n\t\t\t\t...state.toolkits.slice( existingToolkitIndex + 1 ),\n\t\t\t],\n\t\t};\n\t}\n\n\t// otherwise, add the new toolkit\n\treturn {\n\t\t...state,\n\t\ttoolkits: [ ...state.toolkits, toolkit ],\n\t};\n};\n\nconst setCallbacks = ( state, action ) => {\n\tconst { name, callbacks } = action;\n\treturn {\n\t\t...state,\n\t\tcallbacks: {\n\t\t\t...state.callbacks,\n\t\t\t[ name ]: callbacks,\n\t\t},\n\t};\n};\n\nconst setContext = ( state, action ) => {\n\tconst { name, context } = action;\n\tconst existingContext = state.contexts[ name ] || {};\n\n\treturn {\n\t\t...state,\n\t\tcontexts: {\n\t\t\t...state.contexts,\n\t\t\t[ name ]: context.hasOwnProperty( 'fromAssistantId' )\n\t\t\t\t? { ...existingContext, ...context }\n\t\t\t\t: context,\n\t\t},\n\t};\n};\n\nconst setTools = ( state, action ) => {\n\tconst { name, tools } = action;\n\treturn {\n\t\t...state,\n\t\ttools: {\n\t\t\t...state.tools,\n\t\t\t[ name ]: tools,\n\t\t},\n\t};\n};\n\nexport const reducer = ( state = initialState, action ) => {\n\tswitch ( action.type ) {\n\t\tcase 'REGISTER_TOOLKIT':\n\t\t\treturn registerToolkit( state, action );\n\t\tcase 'REGISTER_TOOLKIT_CALLBACKS':\n\t\t\treturn setCallbacks( state, action );\n\t\tcase 'REGISTER_TOOLKIT_CONTEXT':\n\t\t\treturn setContext( state, action );\n\t\tcase 'REGISTER_TOOLKIT_TOOLS':\n\t\t\treturn setTools( state, action );\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nexport const selectors = {\n\tgetToolkits: ( state ) => {\n\t\treturn state.toolkits;\n\t},\n\tgetToolkit: ( state, name ) => {\n\t\treturn state.toolkits[ name ];\n\t},\n\tgetContexts: ( state ) => {\n\t\treturn state.contexts;\n\t},\n\tgetCallbacks: ( state ) => {\n\t\treturn state.callbacks;\n\t},\n\tgetTools: ( state ) => {\n\t\treturn state.tools;\n\t},\n};\n\nexport const slice = {\n\treducer,\n\tactions,\n\tselectors,\n};\n\nexport function createToolkitsStore( name, defaultValues ) {\n\treturn createReduxStore( name, {\n\t\treducer,\n\t\tactions,\n\t\tselectors,\n\t\tinitialState: { ...initialState, ...defaultValues },\n\t} );\n}\n","// Utility functions for namespacing\nexport const createNamespacedSelectors = ( namespace, selectors ) => {\n\tconst namespacedSelectors = {};\n\tfor ( const key in selectors ) {\n\t\tif ( Object.prototype.hasOwnProperty.call( selectors, key ) ) {\n\t\t\tnamespacedSelectors[ key ] = ( state, ...args ) =>\n\t\t\t\tselectors[ key ]( state[ namespace ], ...args );\n\t\t}\n\t}\n\treturn namespacedSelectors;\n};\n\n// this function creates namespaced actions by ensuring that thunks are called with the correct namespace\nexport const createNamespacedActions = ( namespace, actions ) => {\n\tconst namespacedActions = {};\n\tfor ( const key in actions ) {\n\t\tif ( Object.prototype.hasOwnProperty.call( actions, key ) ) {\n\t\t\tnamespacedActions[ key ] = ( ...args ) => {\n\t\t\t\tconst action = actions[ key ]( ...args );\n\t\t\t\tif ( typeof action === 'function' ) {\n\t\t\t\t\treturn ( { select, ...thunkArgs } ) => {\n\t\t\t\t\t\treturn action( {\n\t\t\t\t\t\t\tselect: ( callback ) => {\n\t\t\t\t\t\t\t\treturn select( ( state ) => {\n\t\t\t\t\t\t\t\t\treturn callback( {\n\t\t\t\t\t\t\t\t\t\troot: state.root[ namespace ],\n\t\t\t\t\t\t\t\t\t\tmetadata: state.metadata,\n\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t...thunkArgs,\n\t\t\t\t\t\t} );\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn action;\n\t\t\t};\n\t\t}\n\t}\n\treturn namespacedActions;\n};\n","import { combineReducers, createReduxStore, register } from '@wordpress/data';\nimport { createNamespacedActions, createNamespacedSelectors } from './utils.js';\nimport {\n\tactions as agentsActions,\n\treducer as agentsReducer,\n\tselectors as agentsSelectors,\n} from './agents.js';\n\nimport {\n\tactions as toolkitsActions,\n\treducer as toolkitsReducer,\n\tselectors as toolkitsSelectors,\n} from './toolkits.js';\n\nimport {\n\tactions as chatActions,\n\treducer as chatReducer,\n\tselectors as chatSelectors,\n} from './chat.js';\n\nconst store = createReduxStore( 'big-sky-agents', {\n\treducer: combineReducers( {\n\t\tagents: agentsReducer,\n\t\ttoolkits: toolkitsReducer,\n\t\tchat: chatReducer,\n\t} ),\n\tactions: {\n\t\t...createNamespacedActions( 'agents', agentsActions ),\n\t\t...createNamespacedActions( 'toolkits', toolkitsActions ),\n\t\t...createNamespacedActions( 'chat', chatActions ),\n\t},\n\tselectors: {\n\t\t...createNamespacedSelectors( 'agents', agentsSelectors ),\n\t\t...createNamespacedSelectors( 'toolkits', toolkitsSelectors ),\n\t\t...createNamespacedSelectors( 'chat', chatSelectors ),\n\t},\n} );\n\nregister( store );\nexport { store };\n","export default [];\n","import { dispatch, register } from '@wordpress/data';\nimport { createContext, useMemo } from '@wordpress/element';\nimport { store as defaultAgentsStore } from '../../store/index.js';\nimport { createAgentsStore } from '../../store/agents.js';\nimport defaultAgents from '../../ai/agents/default-agents.js';\nimport uuidv4 from '../../../utils/uuid.js';\n\n// Register default agents in the store\ndefaultAgents.forEach( ( agent ) => {\n\tdispatch( defaultAgentsStore ).registerAgent( agent );\n} );\n\nexport const Context = createContext( defaultAgentsStore );\nconst { Consumer, Provider } = Context;\nexport const AgentsConsumer = Consumer;\n\n// Create a Map to store instances\nconst storeInstances = new Map();\n\nfunction AgentsProvider( { children, ...options } ) {\n\t// Create a stable key for the current set of options\n\tconst optionsKey = JSON.stringify( options );\n\n\t// Use useMemo to create or retrieve the store instance\n\tconst store = useMemo( () => {\n\t\tif ( ! storeInstances.has( optionsKey ) ) {\n\t\t\tconst newStore = createAgentsStore(\n\t\t\t\t`agents-${ uuidv4() }`,\n\t\t\t\toptions\n\t\t\t);\n\t\t\tregister( newStore );\n\t\t\tstoreInstances.set( optionsKey, newStore );\n\t\t}\n\t\treturn storeInstances.get( optionsKey );\n\t}, [ options, optionsKey ] );\n\n\treturn <Provider value={ store }>{ children }</Provider>;\n}\n\nexport default AgentsProvider;\n","import { useCallback, useContext } from '@wordpress/element';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { Context } from './context.jsx';\nimport defaultAgents from '../../ai/agents/default-agents.js';\n\nfunction useAgents() {\n\tconst agentStore = useContext( Context );\n\n\tconst { registerAgent, setActiveAgent, setAgentStarted } =\n\t\tuseDispatch( agentStore );\n\tconst { agents, activeAgentId, activeAgent, name, started } = useSelect(\n\t\t( select ) => {\n\t\t\tconst store = select( agentStore );\n\t\t\treturn {\n\t\t\t\tname: store.getActiveAgentName(),\n\t\t\t\tagents: store.getAgents(),\n\t\t\t\tactiveAgent: store.getActiveAgent(),\n\t\t\t\tactiveAgentId: store.getActiveAgentId(),\n\t\t\t\tstarted: store.isAgentStarted(),\n\t\t\t};\n\t\t}\n\t);\n\n\tconst registerDefaultAgents = useCallback( () => {\n\t\tdefaultAgents.forEach( ( agent ) => {\n\t\t\tregisterAgent( agent );\n\t\t} );\n\t}, [ registerAgent ] );\n\n\treturn {\n\t\tagents,\n\t\tname,\n\t\tstarted,\n\t\tactiveAgent,\n\t\tactiveAgentId,\n\t\tsetAgentStarted,\n\t\tsetActiveAgent,\n\t\tregisterAgent,\n\t\tregisterDefaultAgents,\n\t};\n}\n\nexport default useAgents;\n","/**\n * WordPress dependencies\n */\nimport { createContext } from '@wordpress/element';\nimport { dispatch, register } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { store as defaultChat } from '../../store/index.js';\nimport { createChatStore } from '../../store/chat.js';\nimport uuidv4 from '../../../utils/uuid.js';\nimport { ChatModelService, ChatModelType } from '../../ai/chat-model.js';\n\n// set up default chat store\ndispatch( defaultChat ).setService( ChatModelService.OPENAI );\ndispatch( defaultChat ).setModel( ChatModelType.GPT_4O );\n\nexport const Context = createContext( defaultChat );\nconst { Consumer, Provider } = Context;\nexport const ChatConsumer = Consumer;\n\nfunction ChatProvider( { children, ...options } ) {\n\tconst store = createChatStore( `chat-${ uuidv4() }`, options );\n\tregister( store );\n\treturn <Provider value={ store }>{ children }</Provider>;\n}\n\nexport default ChatProvider;\n","/**\n * WordPress dependencies\n */\nimport { useContext } from '@wordpress/element';\nimport { useDispatch, useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { Context } from './context.jsx';\n\n/**\n * A custom react hook exposing the chat context for use.\n *\n * This exposes the `chat` value provided via the\n * <a href=\"#ChatProvider\">Chat Provider</a> to a component implementing\n * this hook.\n *\n * It acts similarly to the `useContext` react hook.\n *\n * @example\n * ```js\n * import {\n *   ChatProvider,\n *   createChat,\n *   useChat,\n * } from '@automattic/big-sky-';\n *\n * const chat = createChat();\n *\n * const SomeChildUsingChat = ( props ) => {\n *   const chat = useChat();\n *   // ...logic implementing the chat in other react hooks.\n * };\n *\n *\n * const ParentProvidingChat = ( props ) => {\n *   return <ChatProvider value={ chat }>\n *     <SomeChildUsingChat { ...props } />\n *   </ChatProvider>\n * };\n * ```\n *\n * @return {Function}  A custom react hook exposing the chat context value.\n */\n\nexport default function useChat() {\n\tconst agentStore = useContext( Context );\n\n\tconst {\n\t\treset,\n\t\tsetEnabled,\n\t\tcall,\n\t\taddSystemMessage,\n\t\tuserSay,\n\t\tuserSayRepeat,\n\t\tclearMessages,\n\t\tsetToolResult,\n\t\trunChatCompletion,\n\t\tagentSay,\n\t\tsubmitToolOutputs,\n\t\tsetService,\n\t\tsetModel,\n\t\tsetTemperature,\n\t\tsetApiKey,\n\t\tsetFeature,\n\t\tsetBaseUrl,\n\t\tsetSessionId,\n\t\tsetStream,\n\t\tsetGraphConfig,\n\t\tsetError,\n\t\tsetStoreConversation,\n\t\tincrementChangeAgentCount,\n\t\tresetChangeAgentCount,\n\t} = useDispatch( agentStore );\n\n\tconst {\n\t\tbaseUrl,\n\t\tservice,\n\t\ttemperature,\n\t\tapiKey,\n\t\terror,\n\t\tmodel,\n\t\tloading,\n\t\trunning,\n\n\t\tenabled,\n\t\tmessages,\n\t\tdocuments,\n\t\tassistantMessage,\n\t\tpendingToolCalls,\n\t\tadditionalMessages,\n\t\ttoolOutputs,\n\t\tisAvailable,\n\t\tisChatAvailable,\n\t\tisAwaitingUserInput,\n\t\tfeature,\n\t\tstream,\n\t\tgraphConfig,\n\t\tisStoringConversation,\n\t\tgetChangeAgentCount,\n\t} = useSelect( ( select ) => ( {\n\t\tbaseUrl: select( agentStore ).getBaseUrl(),\n\t\tservice: select( agentStore ).getService(),\n\t\ttemperature: select( agentStore ).getTemperature(),\n\t\tapiKey: select( agentStore ).getApiKey(),\n\t\terror: select( agentStore ).getError(),\n\t\tmodel: select( agentStore ).getModel(),\n\t\tloading: select( agentStore ).isLoading(),\n\t\trunning: select( agentStore ).isRunning(),\n\t\tenabled: select( agentStore ).isEnabled(),\n\t\tmessages: select( agentStore ).getMessages(),\n\t\tdocuments: select( agentStore ).getDocuments(),\n\t\tassistantMessage: select( agentStore ).getAssistantMessage(),\n\t\tpendingToolCalls: select( agentStore ).getPendingToolCalls(),\n\t\tadditionalMessages: select( agentStore ).getAdditionalMessages(),\n\t\ttoolOutputs: select( agentStore ).getToolOutputs(),\n\t\tisAvailable: select( agentStore ).isAvailable(),\n\t\tisChatAvailable: select( agentStore ).isChatAvailable(),\n\t\tisAwaitingUserInput: select( agentStore ).isAwaitingUserInput(),\n\t\tfeature: select( agentStore ).getFeature(),\n\t\tstream: select( agentStore ).getStream(),\n\t\tgraphConfig: select( agentStore ).getGraphConfig(),\n\t\tisStoringConversation: select( agentStore ).isStoringConversation(),\n\t\tgetChangeAgentCount: select( agentStore ).getChangeAgentCount,\n\t} ) );\n\n\treturn {\n\t\t// running state\n\t\tenabled,\n\t\tsetEnabled,\n\t\tloading,\n\t\trunning,\n\t\terror,\n\t\tsetError,\n\n\t\t// graph config\n\t\tgraphConfig,\n\t\tsetGraphConfig,\n\n\t\t// stream\n\t\tstream,\n\t\tsetStream,\n\n\t\t// auth\n\t\tapiKey,\n\t\tsetApiKey,\n\n\t\t// logging\n\t\tfeature,\n\t\tsetFeature,\n\t\tsetSessionId,\n\n\t\t// llm\n\t\tmodel,\n\t\tsetModel,\n\t\tservice,\n\t\tsetService,\n\t\tbaseUrl,\n\t\tsetBaseUrl,\n\t\ttemperature,\n\t\tsetTemperature,\n\n\t\t// messages\n\t\tmessages,\n\t\tclearMessages,\n\t\tuserSay,\n\t\tuserSayRepeat,\n\t\taddSystemMessage,\n\t\tassistantMessage,\n\t\tagentSay,\n\n\t\t// documents\n\t\tdocuments,\n\n\t\t// tools\n\t\tcall,\n\t\tsetToolResult,\n\t\tpendingToolCalls,\n\t\ttoolOutputs,\n\n\t\t// chat\n\t\tisChatAvailable,\n\t\trunChatCompletion,\n\n\t\t// assistants\n\t\tsubmitToolOutputs,\n\t\tisAvailable,\n\t\tisAwaitingUserInput,\n\t\tadditionalMessages,\n\t\treset,\n\t\tisStoringConversation,\n\t\tsetStoreConversation,\n\n\t\t// change agent count\n\t\tgetChangeAgentCount,\n\t\tincrementChangeAgentCount,\n\t\tresetChangeAgentCount,\n\t};\n}\n","export default [];\n","import { dispatch, register } from '@wordpress/data';\nimport { createContext } from '@wordpress/element';\nimport { store as defaultToolkitsStore } from '../../store/index.js';\nimport { createToolkitsStore } from '../../store/toolkits.js';\nimport defaultToolkits from '../../ai/toolkits/default-toolkits.js';\nimport uuidv4 from '../../../utils/uuid.js';\n\ndefaultToolkits.forEach( ( toolkit ) => {\n\tdispatch( defaultToolkitsStore ).registerToolkit( toolkit );\n} );\n\nexport const Context = createContext( defaultToolkitsStore );\nconst { Consumer, Provider } = Context;\nexport const ToolkitsConsumer = Consumer;\n\nfunction ToolkitsProvider( { children, ...options } ) {\n\tconst store = createToolkitsStore( `toolkits-${ uuidv4() }`, options );\n\tregister( store );\n\treturn <Provider value={ store }>{ children }</Provider>;\n}\nexport default ToolkitsProvider;\n","/**\n * WordPress dependencies\n */\nimport { useCallback, useContext, useMemo } from '@wordpress/element';\nimport { useDispatch, useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport defaultToolkits from '../../ai/toolkits/default-toolkits.js';\nimport useAgents from '../agents-provider/use-agents.js';\n\n/**\n * Internal dependencies\n */\nimport { Context } from './context.jsx';\nimport useChat from '../chat-provider/use-chat.js';\n\nfunction deepMerge( target, source ) {\n\tif ( typeof target !== 'object' || typeof source !== 'object' ) {\n\t\treturn source;\n\t}\n\n\tfor ( const key in source ) {\n\t\tif ( source.hasOwnProperty( key ) ) {\n\t\t\tif ( source[ key ] instanceof Array ) {\n\t\t\t\tif ( ! target[ key ] ) {\n\t\t\t\t\ttarget[ key ] = [];\n\t\t\t\t}\n\t\t\t\ttarget[ key ] = target[ key ].concat( source[ key ] );\n\t\t\t} else if ( source[ key ] instanceof Object ) {\n\t\t\t\tif ( ! target[ key ] ) {\n\t\t\t\t\ttarget[ key ] = {};\n\t\t\t\t}\n\t\t\t\ttarget[ key ] = deepMerge( target[ key ], source[ key ] );\n\t\t\t} else {\n\t\t\t\ttarget[ key ] = source[ key ];\n\t\t\t}\n\t\t}\n\t}\n\treturn target;\n}\n\nfunction resolveAgentToolkits( agent, allToolkits ) {\n\tconst toolkits =\n\t\ttypeof agent.toolkits === 'function'\n\t\t\t? agent.toolkits()\n\t\t\t: agent.toolkits;\n\n\tconst resolvedToolkits =\n\t\ttoolkits?.map( ( toolkit ) => {\n\t\t\tif ( typeof toolkit === 'string' ) {\n\t\t\t\tconst foundToolkit = allToolkits.find(\n\t\t\t\t\t( t ) => t.name === toolkit\n\t\t\t\t);\n\t\t\t\tif ( ! foundToolkit ) {\n\t\t\t\t\tconsole.warn( `Toolkit ${ toolkit } not found.` );\n\t\t\t\t}\n\t\t\t\treturn foundToolkit;\n\t\t\t}\n\t\t\treturn toolkit;\n\t\t} ) ?? [];\n\n\treturn resolvedToolkits.filter( Boolean );\n}\n\nfunction resolveToolkitTools( toolkits, allTools, context ) {\n\treturn (\n\t\ttoolkits?.reduce( ( acc, toolkit ) => {\n\t\t\t// if the toolkit is a string, look up the instance\n\t\t\tif ( typeof toolkit === 'string' ) {\n\t\t\t\ttoolkit = toolkits.find( ( t ) => t.name === toolkit );\n\t\t\t}\n\n\t\t\tif ( ! toolkit ) {\n\t\t\t\t// if the toolkit can't be found, it might not be registered yet.\n\t\t\t\t// we rely on the hasToolkits function to check if the required toolkits are loaded\n\t\t\t\t// before making the agent interactive\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tconst toolkitToolsFunc = toolkit.tools ?? allTools[ toolkit.name ];\n\t\t\tconst toolkitTools =\n\t\t\t\ttypeof toolkitToolsFunc === 'function'\n\t\t\t\t\t? toolkitToolsFunc( context )\n\t\t\t\t\t: toolkitToolsFunc;\n\n\t\t\tif ( ! toolkitTools ) {\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\treturn [\n\t\t\t\t...acc,\n\t\t\t\t// deduplicate\n\t\t\t\t...toolkitTools.filter(\n\t\t\t\t\t( tool ) => ! acc.some( ( t ) => t.name === tool.name )\n\t\t\t\t),\n\t\t\t];\n\t\t}, [] ) ?? []\n\t);\n}\n\nfunction resolveAgentTools( agent, context, toolkitTools ) {\n\tconst tools =\n\t\ttypeof agent.tools === 'function'\n\t\t\t? agent.tools( context, toolkitTools )\n\t\t\t: agent.tools;\n\n\t// remap string values to the same-named toolkit tool\n\tconst resolvedTools = tools?.map( ( tool ) => {\n\t\tif ( typeof tool === 'string' ) {\n\t\t\treturn toolkitTools.find( ( t ) => t.name === tool );\n\t\t}\n\t\treturn tool;\n\t} );\n\n\treturn resolvedTools ?? toolkitTools;\n}\n\nexport default function useToolkits() {\n\tconst toolkitsStore = useContext( Context );\n\tconst { activeAgent } = useAgents();\n\tconst { registerToolkit, setCallbacks, setContext } =\n\t\tuseDispatch( toolkitsStore );\n\tconst { call, agentSay, userSay } = useChat();\n\tconst {\n\t\ttoolkits: allToolkits,\n\t\tcontexts: allContexts,\n\t\tcallbacks: allCallbacks,\n\t\ttools: allTools,\n\t} = useSelect( ( select ) => ( {\n\t\ttoolkits: select( toolkitsStore ).getToolkits(),\n\t\tcontexts: select( toolkitsStore ).getContexts(),\n\t\tcallbacks: select( toolkitsStore ).getCallbacks(),\n\t\ttools: select( toolkitsStore ).getTools(),\n\t} ) );\n\n\tconst registerDefaultToolkits = useCallback( () => {\n\t\tdefaultToolkits.forEach( ( tool ) => {\n\t\t\tregisterToolkit( tool );\n\t\t} );\n\t}, [ registerToolkit ] );\n\n\t// resolve toolkits for the current agent\n\tconst toolkits = useMemo( () => {\n\t\tif ( ! activeAgent ) {\n\t\t\treturn [];\n\t\t}\n\t\t// the agents toolkits are the ones that are required by the agent, whether using a string (therefore looked up) or as an instance\n\t\treturn resolveAgentToolkits( activeAgent, allToolkits );\n\t}, [ activeAgent, allToolkits ] );\n\n\t// used to actually call the tool, e.g. callbacks.getWeather( { location: \"Boston, MA\" } )\n\tconst callbacks = useMemo( () => {\n\t\treturn toolkits?.reduce( ( acc, toolkit ) => {\n\t\t\tconst toolkitCallbacks =\n\t\t\t\ttoolkit?.callbacks ?? allCallbacks[ toolkit.name ];\n\n\t\t\tif ( ! toolkitCallbacks ) {\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t...acc,\n\t\t\t\t...toolkitCallbacks,\n\t\t\t};\n\t\t}, {} );\n\t}, [ toolkits, allCallbacks ] );\n\n\t// merged context from all toolkits\n\tconst context = useMemo( () => {\n\t\treturn toolkits.reduce( ( acc, toolkit ) => {\n\t\t\tconst toolkitContext =\n\t\t\t\ttoolkit.context ?? allContexts[ toolkit.name ];\n\n\t\t\tif ( ! toolkitContext ) {\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tconst result = deepMerge( acc, toolkitContext );\n\t\t\treturn result;\n\t\t}, {} );\n\t}, [ toolkits, allContexts ] );\n\n\t// flattened array of tools, avoiding duplicates\n\t// tools work like this:\n\t// - if the agent has a tools() function, it's called with the context and all toolkit tools\n\t// - if the agent has a tools property, it's used as-is\n\t// - tools that are strings (e.g. 'askUser') are resolved to the same-named toolkit tool\n\t// - tools that are objects are used as-is\n\t// - agents with no tools property will use all toolkit tools\n\tconst tools = useMemo( () => {\n\t\tif ( ! activeAgent ) {\n\t\t\treturn [];\n\t\t}\n\n\t\t// get the full set of tools from those toolkits\n\t\tconst toolkitTools = resolveToolkitTools( toolkits, allTools, context );\n\n\t\t// get the subset of tools, if any, that the agent chooses\n\t\tconst agentTools = resolveAgentTools(\n\t\t\tactiveAgent,\n\t\t\tcontext,\n\t\t\ttoolkitTools\n\t\t);\n\n\t\treturn agentTools;\n\t}, [ activeAgent, toolkits, allTools, context ] );\n\n\t// used to pretend the agent invoked something, e.g. invoke.askUser( { question: \"What would you like to do next?\" } )\n\tconst invoke = useMemo( () => {\n\t\tconst invokeTools = tools.reduce( ( acc, tool ) => {\n\t\t\tacc[ tool.name ] = ( args, id ) => call( tool.name, args, id );\n\t\t\treturn acc;\n\t\t}, {} );\n\t\treturn {\n\t\t\t...invokeTools,\n\t\t\tuserSay,\n\t\t\tagentSay,\n\t\t};\n\t}, [ agentSay, call, tools, userSay ] );\n\n\tconst hasToolkits = useCallback(\n\t\t( requestedToolkits ) => {\n\t\t\treturn requestedToolkits.every( ( requestedToolkit ) => {\n\t\t\t\tif ( typeof requestedToolkit === 'string' ) {\n\t\t\t\t\treturn allToolkits.some(\n\t\t\t\t\t\t( toolkit ) => toolkit.name === requestedToolkit\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t} );\n\t\t},\n\t\t[ allToolkits ]\n\t);\n\n\tconst reset = useCallback( () => {\n\t\t// call reset() on each toolkit if defined and it's a function\n\t\ttoolkits.forEach( ( toolkit ) => {\n\t\t\tif ( toolkit.reset && typeof toolkit.reset === 'function' ) {\n\t\t\t\ttoolkit.reset();\n\t\t\t}\n\t\t} );\n\t}, [ toolkits ] );\n\n\treturn {\n\t\treset,\n\t\thasToolkits,\n\t\ttools,\n\t\tcontext,\n\t\tinvoke,\n\t\tcallbacks,\n\t\tregisterToolkit,\n\t\tsetCallbacks,\n\t\tsetContext,\n\t\tregisterDefaultToolkits,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { useContext, useEffect } from '@wordpress/element';\nimport { useDispatch } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { Context } from './context.jsx';\n\nconst useToolkit = ( toolkit ) => {\n\tconst toolkitsStore = useContext( Context );\n\tconst { registerToolkit } = useDispatch( toolkitsStore );\n\n\tuseEffect( () => {\n\t\tregisterToolkit( toolkit );\n\t}, [ registerToolkit, toolkit ] );\n};\n\nexport default useToolkit;\n","import { useCallback, useMemo } from '@wordpress/element';\nimport useChat from '../components/chat-provider/use-chat.js';\nimport useToolkits from '../components/toolkits-provider/use-toolkits.js';\nimport useAgents from '../components/agents-provider/use-agents.js';\n\nconst tryParse = ( json ) => {\n\ttry {\n\t\treturn JSON.parse( json );\n\t} catch ( error ) {\n\t\treturn json;\n\t}\n};\n\nconst useNextToolCall = ( toolName ) => {\n\tconst { pendingToolCalls, setToolResult } = useChat();\n\tconst toolCall = useMemo( () => {\n\t\tconst nextToolCall = pendingToolCalls?.find(\n\t\t\t( request ) => request.function.name === toolName\n\t\t);\n\t\tif ( nextToolCall ) {\n\t\t\treturn {\n\t\t\t\t...nextToolCall,\n\t\t\t\tfunction: {\n\t\t\t\t\t...nextToolCall.function,\n\t\t\t\t\targuments: tryParse( nextToolCall.function.arguments ),\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\treturn nextToolCall;\n\t}, [ pendingToolCalls, toolName ] );\n\tconst { invoke, context } = useToolkits();\n\tconst { activeAgent } = useAgents();\n\n\tconst respond = useCallback(\n\t\t( value, toolResponse ) => {\n\t\t\tsetToolResult( toolCall.id, toolResponse ?? value );\n\t\t\tif ( activeAgent.onToolResult ) {\n\t\t\t\tactiveAgent.onToolResult(\n\t\t\t\t\ttoolCall.function.name,\n\t\t\t\t\tvalue,\n\t\t\t\t\tinvoke,\n\t\t\t\t\tcontext\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\t[ setToolResult, toolCall, activeAgent, invoke, context ]\n\t);\n\n\treturn {\n\t\targs: toolCall?.function?.arguments,\n\t\trespond,\n\t};\n};\n\nexport default useNextToolCall;\n","import useNextToolCall from '../hooks/use-next-tool-call.js';\n\nconst withToolCall = ( toolName, ChildComponent ) => {\n\tconst ToolCall = ( props ) => {\n\t\tconst { args, respond } = useNextToolCall( toolName );\n\t\treturn (\n\t\t\t<ChildComponent { ...props } args={ args } respond={ respond } />\n\t\t);\n\t};\n\n\treturn ToolCall;\n};\n\nexport default withToolCall;\n","export const toOpenAITool = ( tool ) => {\n\t// default to a single string parameter called \"value\"\n\tconst parameters = tool.parameters ?? {\n\t\ttype: 'object',\n\t\tproperties: {\n\t\t\tvalue: {\n\t\t\t\ttype: 'string',\n\t\t\t},\n\t\t},\n\t\trequired: [ 'value' ],\n\t};\n\n\t// enable structured output if strict is true\n\tparameters.additionalProperties = ! tool.strict;\n\treturn {\n\t\ttype: 'function',\n\t\tfunction: {\n\t\t\tname: tool.name,\n\t\t\tstrict: !! tool.strict,\n\t\t\tdescription: tool.description,\n\t\t\tparameters,\n\t\t},\n\t};\n};\n\nexport const toAssistantOpenAITool = ( tool ) => {\n\tconst openAITool = toOpenAITool( tool );\n\t// remove \"strict\" prop\n\tdelete openAITool.strict;\n\treturn openAITool;\n};\n","/**\n * WordPress dependencies\n */\nimport { useEffect, useMemo, useState } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport useAgents from '../components/agents-provider/use-agents.js';\nimport useChat from '../components/chat-provider/use-chat.js';\nimport useToolkits from '../components/toolkits-provider/use-toolkits.js';\nimport { toOpenAITool } from '../ai/utils/openai.js';\nimport log from '../utils/log-debug.js';\n\nconst useAgentExecutor = () => {\n\tconst { activeAgent, started, setAgentStarted } = useAgents();\n\n\tconst {\n\t\tmessages,\n\t\tisChatAvailable,\n\t\tloading,\n\t\trunning,\n\t\tisAvailable,\n\t\tisAwaitingUserInput,\n\t\tenabled,\n\t\tassistantMessage,\n\t\terror,\n\t\trunChatCompletion,\n\t\ttoolOutputs,\n\t\tpendingToolCalls,\n\t\tsetToolResult,\n\t\tagentSay,\n\t\tresetChangeAgentCount,\n\t} = useChat();\n\n\tconst { tools, invoke, hasToolkits, context, callbacks } = useToolkits();\n\n\tconst [ instructions, setInstructions ] = useState( '' );\n\tconst [ additionalInstructions, setAdditionalInstructions ] =\n\t\tuseState( '' );\n\tconst [ prevToolOutputsLength, setPrevToolOutputsLength ] = useState( 0 );\n\n\t// execute tools using callbacks\n\tuseEffect( () => {\n\t\t// process tool calls for any tools with callbacks\n\t\t// note that tools without callbacks will be processed outside this loop,\n\t\t// and will need responses before the ChatModel can run again\n\t\tif (\n\t\t\t! running &&\n\t\t\t! error &&\n\t\t\tisAvailable &&\n\t\t\tpendingToolCalls.length > 0\n\t\t) {\n\t\t\tpendingToolCalls.forEach( ( tool_call ) => {\n\t\t\t\tconst args =\n\t\t\t\t\ttypeof tool_call.function.arguments === 'string'\n\t\t\t\t\t\t? ( () => {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\treturn JSON.parse(\n\t\t\t\t\t\t\t\t\t\ttool_call.function.arguments\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} catch ( e ) {\n\t\t\t\t\t\t\t\t\treturn tool_call.function.arguments;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t  } )()\n\t\t\t\t\t\t: tool_call.function.arguments;\n\n\t\t\t\t// see: https://community.openai.com/t/model-tries-to-call-unknown-function-multi-tool-use-parallel/490653/7\n\t\t\t\tif ( tool_call.function.name === 'multi_tool_use.parallel' ) {\n\t\t\t\t\t/**\n\t\t\t\t\t * Looks like this:\n\t\t\t\t\t * multi_tool_use.parallel({\"tool_uses\":[{\"recipient_name\":\"WPSiteSpec\",\"parameters\":{\"title\":\"Lorem Ipsum\",\"description\":\"Lorem ipsum dolor sit amet, consectetur adipiscing elit.\",\"type\":\"Blog\",\"topic\":\"Lorem Ipsum\",\"location\":\"Lorem Ipsum\"}}]})\n\t\t\t\t\t *\n\t\t\t\t\t * I assume the result is supposed to be an array... but I could be wrong.\n\t\t\t\t\t */\n\t\t\t\t\tconst promises = args.tool_uses.map( ( tool_use ) => {\n\t\t\t\t\t\tconst callback = callbacks[ tool_use.recipient_name ];\n\n\t\t\t\t\t\tif ( typeof callback === 'function' ) {\n\t\t\t\t\t\t\tlog.info(\n\t\t\t\t\t\t\t\t'🧠 Parallel tool callback',\n\t\t\t\t\t\t\t\ttool_use.recipient_name\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\treturn callback( tool_use.parameters );\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn `Unknown tool ${ tool_use.recipient_name }`;\n\t\t\t\t\t} );\n\n\t\t\t\t\tconst toolResult = Promise.all( promises );\n\n\t\t\t\t\tsetToolResult( tool_call.id, toolResult );\n\t\t\t\t}\n\n\t\t\t\tconst callback = callbacks[ tool_call.function.name ];\n\n\t\t\t\tif ( typeof callback === 'function' ) {\n\t\t\t\t\tif ( tool_call.function.name !== 'change_assistant' ) {\n\t\t\t\t\t\t// Expand args to a string that is easier to read\n\t\t\t\t\t\tconst argsString = Object.entries( args )\n\t\t\t\t\t\t\t.map(\n\t\t\t\t\t\t\t\t( [ key, value ] ) =>\n\t\t\t\t\t\t\t\t\t`        -- ${ key }: ${ value }`\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.join( '\\n' );\n\n\t\t\t\t\t\tlog.info(\n\t\t\t\t\t\t\t`🧠 Calling Tool:\n\t-- Name: ${ tool_call.function.name }\n\t-- Args:\n${ argsString }`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\t// Reset change agent count if the tool being called is not change_assistant\n\t\t\t\t\tif ( tool_call.function.name !== 'change_assistant' ) {\n\t\t\t\t\t\tresetChangeAgentCount();\n\t\t\t\t\t}\n\t\t\t\t\tsetToolResult( tool_call.id, callback( args ) );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}, [\n\t\tcallbacks,\n\t\terror,\n\t\tisAvailable,\n\t\tpendingToolCalls,\n\t\trunning,\n\t\tsetToolResult,\n\t\tresetChangeAgentCount,\n\t] );\n\n\tconst toolkitsLoaded = useMemo( () => {\n\t\treturn ! activeAgent?.toolkits || hasToolkits( activeAgent?.toolkits );\n\t}, [ hasToolkits, activeAgent ] );\n\n\tuseEffect( () => {\n\t\tif ( activeAgent && toolkitsLoaded ) {\n\t\t\tconst newInstructions =\n\t\t\t\ttypeof activeAgent.instructions === 'function'\n\t\t\t\t\t? activeAgent.instructions( context )\n\t\t\t\t\t: activeAgent.instructions;\n\n\t\t\tconst newAdditionalInstructions =\n\t\t\t\ttypeof activeAgent.additionalInstructions === 'function'\n\t\t\t\t\t? activeAgent.additionalInstructions( context )\n\t\t\t\t\t: activeAgent.additionalInstructions;\n\n\t\t\tif ( newInstructions && newInstructions !== instructions ) {\n\t\t\t\tsetInstructions( newInstructions );\n\t\t\t}\n\n\t\t\tif ( newAdditionalInstructions !== additionalInstructions ) {\n\t\t\t\tsetAdditionalInstructions( newAdditionalInstructions );\n\t\t\t}\n\t\t}\n\t}, [\n\t\tadditionalInstructions,\n\t\tactiveAgent,\n\t\tinstructions,\n\t\ttools,\n\t\tcontext,\n\t\ttoolkitsLoaded,\n\t] );\n\n\t/**\n\t * Call agent.onStart() at the beginning\n\t */\n\tuseEffect( () => {\n\t\tif (\n\t\t\tisAvailable &&\n\t\t\ttoolkitsLoaded &&\n\t\t\t! isAwaitingUserInput &&\n\t\t\t! running &&\n\t\t\t! loading &&\n\t\t\t! started &&\n\t\t\tmessages.length === 0 &&\n\t\t\tactiveAgent\n\t\t) {\n\t\t\tlog.info( '🧠 setAgentStarted', {\n\t\t\t\tisAvailable,\n\t\t\t\ttoolkitsLoaded,\n\t\t\t\tisAwaitingUserInput,\n\t\t\t\trunning,\n\t\t\t\tloading,\n\t\t\t\tstarted,\n\t\t\t\tmessages,\n\t\t\t\tactiveAgent,\n\t\t\t} );\n\t\t\tsetAgentStarted( true );\n\t\t\tif ( typeof activeAgent.onStart === 'function' ) {\n\t\t\t\tactiveAgent.onStart( invoke );\n\t\t\t}\n\t\t}\n\t}, [\n\t\tmessages,\n\t\tagentSay,\n\t\tactiveAgent,\n\t\tinvoke,\n\t\tisAvailable,\n\t\tisAwaitingUserInput,\n\t\ttoolkitsLoaded,\n\t\tloading,\n\t\trunning,\n\t\tsetAgentStarted,\n\t\tstarted,\n\t] );\n\n\t/**\n\t * Run a chat completion\n\t */\n\tuseEffect( () => {\n\t\tif (\n\t\t\tactiveAgent &&\n\t\t\tisChatAvailable &&\n\t\t\t! running &&\n\t\t\tinstructions &&\n\t\t\tmessages.length > 0 &&\n\t\t\t! isAwaitingUserInput\n\t\t) {\n\t\t\tconst openAITools = tools.map( toOpenAITool );\n\t\t\tconst newInstructions =\n\t\t\t\ttypeof activeAgent.instructions === 'function'\n\t\t\t\t\t? activeAgent.instructions( context )\n\t\t\t\t\t: activeAgent.instructions;\n\n\t\t\tconst newAdditionalInstructions =\n\t\t\t\ttypeof activeAgent.additionalInstructions === 'function'\n\t\t\t\t\t? activeAgent.additionalInstructions( context )\n\t\t\t\t\t: activeAgent.additionalInstructions;\n\n\t\t\trunChatCompletion( {\n\t\t\t\ttools: openAITools,\n\t\t\t\tinstructions: newInstructions,\n\t\t\t\tadditionalInstructions: newAdditionalInstructions,\n\t\t\t} );\n\t\t}\n\t}, [\n\t\tadditionalInstructions,\n\t\tassistantMessage,\n\t\tenabled,\n\t\terror,\n\t\tmessages,\n\t\tinstructions,\n\t\tisAwaitingUserInput,\n\t\tisChatAvailable,\n\t\trunChatCompletion,\n\t\trunning,\n\t\ttools,\n\t\tactiveAgent?.instructions,\n\t\tactiveAgent?.additionalInstructions,\n\t\tactiveAgent,\n\t\tcontext,\n\t] );\n\n\tuseEffect( () => {\n\t\tif ( toolOutputs.length > prevToolOutputsLength && activeAgent ) {\n\t\t\tconst newToolOutputs = toolOutputs.slice( prevToolOutputsLength );\n\n\t\t\tnewToolOutputs.forEach( ( toolOutput ) => {\n\t\t\t\tconst toolCall = toolOutputs.find(\n\t\t\t\t\t( tc ) => tc.id === toolOutput.tool_call_id\n\t\t\t\t);\n\n\t\t\t\tif ( toolCall ) {\n\t\t\t\t\tconst toolName = toolCall.toolName;\n\t\t\t\t\tconst value = toolOutput.output;\n\n\t\t\t\t\tif ( typeof activeAgent.onToolResult === 'function' ) {\n\t\t\t\t\t\tactiveAgent.onToolResult(\n\t\t\t\t\t\t\ttoolName,\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\tcallbacks,\n\t\t\t\t\t\t\tcontext\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tsetPrevToolOutputsLength( toolOutputs.length );\n\t\t}\n\t}, [\n\t\ttoolOutputs,\n\t\tactiveAgent,\n\t\tcallbacks,\n\t\tprevToolOutputsLength,\n\t\tcontext,\n\t] );\n};\n\nexport default useAgentExecutor;\n","export default function deepEqual( obj1, obj2 ) {\n\tif ( obj1 === obj2 ) {\n\t\treturn true;\n\t}\n\tif (\n\t\ttypeof obj1 !== 'object' ||\n\t\ttypeof obj2 !== 'object' ||\n\t\tobj1 === null ||\n\t\tobj2 === null\n\t) {\n\t\treturn false;\n\t}\n\tif ( Array.isArray( obj1 ) && Array.isArray( obj2 ) ) {\n\t\tif ( obj1.length !== obj2.length ) {\n\t\t\treturn false;\n\t\t}\n\t\t// Sort both arrays and compare them\n\t\tconst sortedObj1 = [ ...obj1 ].sort();\n\t\tconst sortedObj2 = [ ...obj2 ].sort();\n\t\treturn sortedObj1.every( ( item, index ) =>\n\t\t\tdeepEqual( item, sortedObj2[ index ] )\n\t\t);\n\t}\n\tconst keys1 = Object.keys( obj1 );\n\tconst keys2 = Object.keys( obj2 );\n\tif ( keys1.length !== keys2.length ) {\n\t\treturn false;\n\t}\n\tfor ( const key of keys1 ) {\n\t\tif (\n\t\t\t! keys2.includes( key ) ||\n\t\t\t! deepEqual( obj1[ key ], obj2[ key ] )\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n","import { useEffect } from '@wordpress/element';\nimport useChat from '../components/chat-provider/use-chat.js';\nimport useAgents from '../components/agents-provider/use-agents.js';\nimport deepEqual from '../../utils/deep-equal.js';\n\nconst useChatSettings = ( options ) => {\n\tconst {\n\t\tapiKey,\n\t\tfeature,\n\t\tservice,\n\t\tmodel,\n\t\tbaseUrl,\n\t\tsetApiKey,\n\t\tsetService,\n\t\tsetFeature,\n\t\tsetModel,\n\t\tsetBaseUrl,\n\t\tsessionId,\n\t\tsetSessionId,\n\t\tstream,\n\t\tsetStream,\n\t\tsetGraphConfig,\n\t\tgraphConfig,\n\t\tisStoringConversation,\n\t\tsetStoreConversation,\n\t} = useChat();\n\tconst { activeAgentId, setActiveAgent } = useAgents();\n\n\t// if chat.apiKey !== apiKey, set it\n\tuseEffect( () => {\n\t\tif ( options.apiKey && options.apiKey !== apiKey ) {\n\t\t\tsetApiKey( options.apiKey );\n\t\t}\n\t}, [ apiKey, options.apiKey, setApiKey ] );\n\n\t// if chat.service !== service, set it\n\tuseEffect( () => {\n\t\tif ( options.service && options.service !== service ) {\n\t\t\tsetService( options.service );\n\t\t}\n\t}, [ options, service, setService ] );\n\n\t// if chat.stream !== stream, set it\n\tuseEffect( () => {\n\t\tif ( options.stream !== undefined && options.stream !== stream ) {\n\t\t\tsetStream( options.stream );\n\t\t}\n\t}, [ options, stream, setStream ] );\n\n\t// if chat.model !== model, set it\n\tuseEffect( () => {\n\t\tif ( options.model && options.model !== model ) {\n\t\t\tsetModel( options.model );\n\t\t}\n\t}, [ model, options, options.model, setModel ] );\n\n\t// if chat.feature !== feature, set it\n\tuseEffect( () => {\n\t\tif ( options.feature && options.feature !== feature ) {\n\t\t\tsetFeature( options.feature );\n\t\t}\n\t}, [ feature, options.feature, setFeature ] );\n\n\tuseEffect( () => {\n\t\tif ( options.initialAgentId && ! activeAgentId ) {\n\t\t\tsetActiveAgent( options.initialAgentId );\n\t\t}\n\t}, [ activeAgentId, options.initialAgentId, setActiveAgent ] );\n\n\tuseEffect( () => {\n\t\tif ( options.baseUrl && options.baseUrl !== baseUrl ) {\n\t\t\tsetBaseUrl( options.baseUrl );\n\t\t}\n\t}, [ baseUrl, options.baseUrl, setBaseUrl ] );\n\n\tuseEffect( () => {\n\t\tif (\n\t\t\toptions.graphConfig &&\n\t\t\t! deepEqual( options.graphConfig, graphConfig )\n\t\t) {\n\t\t\tsetGraphConfig( options.graphConfig );\n\t\t}\n\t}, [ graphConfig, options.graphConfig, setGraphConfig ] );\n\n\tuseEffect( () => {\n\t\tif ( options.sessionId && options.sessionId !== sessionId ) {\n\t\t\tsetSessionId( options.sessionId );\n\t\t}\n\t}, [ sessionId, options.sessionId, setSessionId ] );\n\n\tuseEffect( () => {\n\t\tif (\n\t\t\toptions.store !== undefined &&\n\t\t\toptions.store !== isStoringConversation\n\t\t) {\n\t\t\tsetStoreConversation( options.store );\n\t\t}\n\t}, [ isStoringConversation, options.store, setStoreConversation ] );\n};\n\nexport default useChatSettings;\n","'use strict';\n/**\n * Internal dependencies\n */\nimport log from '../../utils/log-debug.js';\n// Adapted from doT.js, 2011-2014, Laura Doktorova, https://github.com/olado/doT\n// Licensed under the MIT license.\n\n/**\n * {{ }}\tfor evaluation\n * {{= }}\tfor interpolation\n * {{! }}\tfor interpolation with encoding\n * {{# }}\tfor compile-time evaluation/includes and partials\n * {{## #}}\tfor compile-time defines\n * {{? }}\tfor conditionals\n * For array iteration:\n * {{~ arrayname :varname}}\n *   {{= varname.title}}\n *   {{= varname.description}}\n * {{~}}\n */\n\nconst templateSettings = {\n\targName: 'it',\n\tencoders: {},\n\tselfContained: false,\n\tstrip: true,\n\tinternalPrefix: '_val',\n\tencodersPrefix: '_enc',\n\tdelimiters: {\n\t\tstart: '{{',\n\t\tend: '}}',\n\t},\n};\n\n// depends on selfContained mode\nconst encoderType = {\n\tfalse: 'function',\n\ttrue: 'string',\n};\n\nconst defaultSyntax = {\n\tevaluate: /\\{\\{([\\s\\S]+?(\\}?)+)\\}\\}/g,\n\tinterpolate: /\\{\\{=([\\s\\S]+?)\\}\\}/g,\n\ttypeInterpolate: /\\{\\{%([nsb])=([\\s\\S]+?)\\}\\}/g,\n\tencode: /\\{\\{([a-z_$]+[\\w$]*)?!([\\s\\S]+?)\\}\\}/g,\n\tuse: /\\{\\{#([\\s\\S]+?)\\}\\}/g,\n\tuseParams:\n\t\t/(^|[^\\w$])def(?:\\.|\\[[\\'\\\"])([\\w$\\.]+)(?:[\\'\\\"]\\])?\\s*\\:\\s*([\\w$]+(?:\\.[\\w$]+|\\[[^\\]]+\\])*|\\\"[^\\\"]+\\\"|\\'[^\\']+\\'|\\{[^\\}]+\\}|\\[[^\\]]*\\])/g,\n\tdefine: /\\{\\{##\\s*([\\w\\.$]+)\\s*(\\:|=)([\\s\\S]+?)#\\}\\}/g,\n\tdefineParams: /^\\s*([\\w$]+):([\\s\\S]+)/,\n\tconditional: /\\{\\{\\?(\\?)?\\s*([\\s\\S]*?)\\s*\\}\\}/g,\n\titerate:\n\t\t/\\{\\{~\\s*(?:\\}\\}|([\\s\\S]+?)\\s*\\:\\s*([\\w$]+)\\s*(?:\\:\\s*([\\w$]+))?\\s*\\}\\})/g,\n};\n\nconst currentSyntax = { ...defaultSyntax };\n\nconst TYPES = {\n\tn: 'number',\n\ts: 'string',\n\tb: 'boolean',\n};\n\nfunction resolveDefs( c, syn, block, def ) {\n\treturn ( typeof block === 'string' ? block : block.toString() )\n\t\t.replace( syn.define, ( _1, code, assign, value ) => {\n\t\t\tif ( code.indexOf( 'def.' ) === 0 ) {\n\t\t\t\tcode = code.substring( 4 );\n\t\t\t}\n\t\t\tif ( ! ( code in def ) ) {\n\t\t\t\tif ( assign === ':' ) {\n\t\t\t\t\tvalue.replace( syn.defineParams, ( _2, param, v ) => {\n\t\t\t\t\t\tdef[ code ] = { arg: param, text: v };\n\t\t\t\t\t} );\n\t\t\t\t\tif ( ! ( code in def ) ) {\n\t\t\t\t\t\tdef[ code ] = value;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tnew Function( 'def', `def['${ code }']=${ value }` )( def );\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn '';\n\t\t} )\n\t\t.replace( syn.use, ( _1, code ) => {\n\t\t\tcode = code.replace( syn.useParams, ( _2, s, d, param ) => {\n\t\t\t\tif ( def[ d ] && def[ d ].arg && param ) {\n\t\t\t\t\tconst rw = unescape(\n\t\t\t\t\t\t( d + ':' + param ).replace( /'|\\\\/g, '_' )\n\t\t\t\t\t);\n\t\t\t\t\tdef.__exp = def.__exp || {};\n\t\t\t\t\tdef.__exp[ rw ] = def[ d ].text.replace(\n\t\t\t\t\t\tnew RegExp(\n\t\t\t\t\t\t\t`(^|[^\\\\w$])${ def[ d ].arg }([^\\\\w$])`,\n\t\t\t\t\t\t\t'g'\n\t\t\t\t\t\t),\n\t\t\t\t\t\t`$1${ param }$2`\n\t\t\t\t\t);\n\t\t\t\t\treturn s + `def.__exp['${ rw }']`;\n\t\t\t\t}\n\t\t\t} );\n\t\t\tconst v = new Function( 'def', 'return ' + code )( def );\n\t\t\treturn v ? resolveDefs( c, syn, v, def ) : v;\n\t\t} );\n}\n\nfunction unescape( code ) {\n\treturn code.replace( /\\\\('|\\\\)/g, '$1' ).replace( /[\\r\\t\\n]/g, ' ' );\n}\n\nexport function compile( tmpl, def ) {\n\tlet sid = 0;\n\tlet str = resolveDefs( templateSettings, currentSyntax, tmpl, def || {} );\n\tconst needEncoders = {};\n\n\tstr = (\n\t\t\"let out='\" +\n\t\t( templateSettings.strip\n\t\t\t? str\n\t\t\t\t\t.trim()\n\t\t\t\t\t.replace( /[\\t ]+(\\r|\\n)/g, '\\n' ) // remove trailing spaces\n\t\t\t\t\t.replace( /(\\r|\\n)[\\t ]+/g, ' ' ) // leading spaces reduced to \" \"\n\t\t\t\t\t.replace( /\\r|\\n|\\t|\\/\\*[\\s\\S]*?\\*\\//g, '' ) // remove breaks, tabs and JS comments\n\t\t\t: str\n\t\t)\n\t\t\t.replace( /'|\\\\/g, '\\\\$&' )\n\t\t\t.replace(\n\t\t\t\tcurrentSyntax.interpolate,\n\t\t\t\t( _, code ) => `'+(${ unescape( code ) })+'`\n\t\t\t)\n\t\t\t.replace( currentSyntax.typeInterpolate, ( _, typ, code ) => {\n\t\t\t\tsid++;\n\t\t\t\tconst val = templateSettings.internalPrefix + sid;\n\t\t\t\tconst error = `throw new Error(\"expected ${ TYPES[ typ ] }, got \"+ (typeof ${ val }))`;\n\t\t\t\treturn `';const ${ val }=(${ unescape(\n\t\t\t\t\tcode\n\t\t\t\t) });if(typeof ${ val }!==\"${\n\t\t\t\t\tTYPES[ typ ]\n\t\t\t\t}\") ${ error };out+=${ val }+'`;\n\t\t\t} )\n\t\t\t.replace( currentSyntax.encode, ( _, enc = '', code ) => {\n\t\t\t\tneedEncoders[ enc ] = true;\n\t\t\t\tcode = unescape( code );\n\t\t\t\t// eslint-disable-next-line no-nested-ternary\n\t\t\t\tconst e = templateSettings.selfContained\n\t\t\t\t\t? enc\n\t\t\t\t\t: enc\n\t\t\t\t\t? '.' + enc\n\t\t\t\t\t: '[\"\"]';\n\t\t\t\treturn `'+${ templateSettings.encodersPrefix }${ e }(${ code })+'`;\n\t\t\t} )\n\t\t\t.replace( currentSyntax.conditional, ( _, elseCase, code ) => {\n\t\t\t\tif ( code ) {\n\t\t\t\t\tcode = unescape( code );\n\t\t\t\t\treturn elseCase\n\t\t\t\t\t\t? `';}else if(${ code }){out+='`\n\t\t\t\t\t\t: `';if(${ code }){out+='`;\n\t\t\t\t}\n\t\t\t\treturn elseCase ? \"';}else{out+='\" : \"';}out+='\";\n\t\t\t} )\n\t\t\t.replace( currentSyntax.iterate, ( _, arr, vName, iName ) => {\n\t\t\t\tif ( ! arr ) {\n\t\t\t\t\treturn \"';} } out+='\";\n\t\t\t\t}\n\t\t\t\tsid++;\n\t\t\t\tconst defI = iName ? `let ${ iName }=-1;` : '';\n\t\t\t\tconst incI = iName ? `${ iName }++;` : '';\n\t\t\t\tconst val = templateSettings.internalPrefix + sid;\n\t\t\t\treturn `';const ${ val }=${ unescape(\n\t\t\t\t\tarr\n\t\t\t\t) };if(${ val }){${ defI }for (const ${ vName } of ${ val }){${ incI }out+='`;\n\t\t\t} )\n\t\t\t.replace(\n\t\t\t\tcurrentSyntax.evaluate,\n\t\t\t\t( _, code ) => `';${ unescape( code ) }out+='`\n\t\t\t) +\n\t\t\"';return out;\"\n\t)\n\t\t.replace( /\\n/g, '\\\\n' )\n\t\t.replace( /\\t/g, '\\\\t' )\n\t\t.replace( /\\r/g, '\\\\r' )\n\t\t.replace( /(\\s|;|\\}|^|\\{)out\\+='';/g, '$1' )\n\t\t.replace( /\\+''/g, '' );\n\n\tconst args = Array.isArray( templateSettings.argName )\n\t\t? properties( templateSettings.argName )\n\t\t: templateSettings.argName;\n\n\tif ( Object.keys( needEncoders ).length === 0 ) {\n\t\treturn try_( () => new Function( args, str ) );\n\t}\n\tcheckEncoders( templateSettings, needEncoders );\n\tstr = `return function(${ args }){${ str }};`;\n\treturn try_( () =>\n\t\ttemplateSettings.selfContained\n\t\t\t? new Function(\n\t\t\t\t\t( str =\n\t\t\t\t\t\taddEncoders( templateSettings, needEncoders ) + str )\n\t\t\t  )()\n\t\t\t: new Function( templateSettings.encodersPrefix, str )(\n\t\t\t\t\ttemplateSettings.encoders\n\t\t\t  )\n\t);\n\n\tfunction try_( f ) {\n\t\ttry {\n\t\t\treturn f();\n\t\t} catch ( e ) {\n\t\t\tlog.error( 'Could not create a template function: ' + str );\n\t\t\tthrow e;\n\t\t}\n\t}\n}\n\nfunction properties( args ) {\n\treturn args.reduce( ( s, a, i ) => s + ( i ? ',' : '' ) + a, '{' ) + '}';\n}\n\nfunction checkEncoders( c, encoders ) {\n\tconst typ = encoderType[ c.selfContained ];\n\tfor ( const enc in encoders ) {\n\t\tconst e = c.encoders[ enc ];\n\t\tif ( ! e ) {\n\t\t\tthrow new Error( `unknown encoder \"${ enc }\"` );\n\t\t}\n\t\tif ( typeof e !== typ ) {\n\t\t\tthrow new Error(\n\t\t\t\t`selfContained ${ c.selfContained }: encoder type must be \"${ typ }\"`\n\t\t\t);\n\t\t}\n\t}\n}\n\nfunction addEncoders( c, encoders ) {\n\tlet s = '';\n\tfor ( const enc in encoders ) {\n\t\ts += `const ${ c.encodersPrefix }${ enc }=${ c.encoders[ enc ] };`;\n\t}\n\treturn s;\n}\n","import { compile as compileDotTemplate } from './utils/dot.js';\nimport { compile as compileFString } from './utils/fstring.js';\n\nexport class Formatter {\n\tformat( /* values */ ) {\n\t\tthrow new Error( 'Not implemented' );\n\t}\n}\n\nexport class StringPromptTemplate extends Formatter {\n\tconstructor( {\n\t\tinputVariables,\n\t\ttemplate, // string version of the template, for easy comparison\n\t\tengine,\n\t\tformatters = {},\n\t\t...options\n\t} ) {\n\t\tsuper();\n\t\tthis.validate( engine, inputVariables );\n\t\tthis.inputVariables = inputVariables;\n\t\tthis.engine = engine;\n\t\tthis.template = template;\n\t\tthis.formatters = formatters;\n\t\tObject.assign( this, options );\n\t}\n\n\tvalidate( engine, inputVariables ) {\n\t\ttry {\n\t\t\tconst dummyInputs = inputVariables.reduce( ( acc, v ) => {\n\t\t\t\tacc[ v ] = 'foo';\n\t\t\t\treturn acc;\n\t\t\t}, {} );\n\t\t\tengine( dummyInputs );\n\t\t} catch ( e ) {\n\t\t\tthrow new Error(\n\t\t\t\t`Invalid inputs: ${ e.message }, inputs: ${ inputVariables.join(\n\t\t\t\t\t', '\n\t\t\t\t) }`\n\t\t\t);\n\t\t}\n\t}\n\n\tformat( values ) {\n\t\t// apply formatters\n\t\tconst formattedValues = this.inputVariables.reduce( ( acc, v ) => {\n\t\t\tif ( v in this.formatters ) {\n\t\t\t\tacc[ v ] = this.formatters[ v ].format( values );\n\t\t\t} else {\n\t\t\t\tacc[ v ] = values[ v ];\n\t\t\t}\n\t\t\treturn acc;\n\t\t}, {} );\n\t\treturn this.engine( formattedValues );\n\t}\n}\n\n/**\n * A PromptTemplate is a template string that can be formatted with values.\n *\n * Values can be static or a function that returns a value.\n *\n * Formatters can be anything that implements the format and equals methods.\n */\nexport class FStringPromptTemplate extends StringPromptTemplate {\n\tconstructor( { template, ...options } ) {\n\t\tconst engine = compileFString( template );\n\t\tsuper( {\n\t\t\tinputVariables: engine.variables,\n\t\t\tengine,\n\t\t\ttemplate,\n\t\t\t...options,\n\t\t} );\n\t\tthis.engine = engine;\n\t}\n\n\tstatic fromString( template, options ) {\n\t\treturn new FStringPromptTemplate( { template, ...options } );\n\t}\n}\n\nexport class DotPromptTemplate extends StringPromptTemplate {\n\tconstructor( { template, inputVariables, ...options } ) {\n\t\tconst engine = compileDotTemplate( template );\n\t\tsuper( { engine, template, inputVariables, ...options } );\n\t}\n\n\tstatic fromString( template, inputVariables = [], options = {} ) {\n\t\treturn new DotPromptTemplate( {\n\t\t\ttemplate,\n\t\t\tinputVariables,\n\t\t\t...options,\n\t\t} );\n\t}\n}\n","/**\n * Internal dependencies\n */\nimport log from '../../utils/log-debug.js';\nimport { DotPromptTemplate } from '../prompt-template.js';\n\nconst instructions = DotPromptTemplate.fromString(\n\t`You are a helpful assistant.`\n);\n\nclass Agent {\n\tget toolkits() {\n\t\treturn [];\n\t}\n\n\tget id() {\n\t\tthrow new Error( `Agent ${ this.id } must implement id` );\n\t}\n\n\tget name() {\n\t\tthrow new Error( `Agent ${ this.id } must implement name` );\n\t}\n\n\tget description() {\n\t\tthrow new Error( `Agent ${ this.id } must implement description` );\n\t}\n\n\tonToolResult( toolName, value, callbacks, context ) {\n\t\t// do nothing by default\n\t\tlog.info( 'onToolResult', {\n\t\t\ttoolName,\n\t\t\tvalue,\n\t\t\tcallbacks,\n\t\t\tcontext,\n\t\t} );\n\t}\n\n\tinstructions( context ) {\n\t\treturn instructions.format( context );\n\t}\n\n\tadditionalInstructions() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * Tools\n\t */\n\n\ttools() {\n\t\treturn [];\n\t}\n\n\t/**\n\t * Lifecycle methods\n\t */\n\n\tonStart( { askUser } ) {\n\t\taskUser( {\n\t\t\tquestion: 'What can I help you with?',\n\t\t} );\n\t}\n}\n\nexport default Agent;\n","export const ASSISTANTS = {\n\tROUTER: 'big-sky-router',\n\tSPEC: 'big-sky-spec',\n\tCONTENT: 'big-sky-content',\n\tCOLOR: 'big-sky-color',\n\tPATTERN: 'big-sky-pattern',\n\tFONT: 'big-sky-font',\n\tPAGE: 'big-sky-page',\n\tHELP: 'big-sky-help',\n\tLAYOUT: 'big-sky-layout',\n\tIMAGE: 'big-sky-image',\n};\n\n// Remove the spec assistant because it's only used for onboarding, and should not be routed to.\nexport const assistantIds = Object.values( ASSISTANTS ).filter(\n\t( id ) => id !== ASSISTANTS.SPEC\n);\n","/**\n * Internal dependencies\n */\nimport { ASSISTANTS } from '@ai/assistants/constants.js';\n\nexport const languagePrompt =\n\ttypeof window !== 'undefined' && window.bigSkyInitialState?.userLanguage\n\t\t? window.bigSkyInitialState.userLanguage\n\t\t: 'English (United States)';\n\nexport const analysisPrompt = `IMPORTANT: The content between <request_analysis> tags is strictly for internal model reasoning only. This is a hard requirement: Never include or reference any content from inside <request_analysis> tags in your response to the user.\nConduct your analysis inside <request_analysis> tags.`;\n\nexport const getSiteContextPrompt = ( context, fields ) => {\n\tconst metadata = context?.site || {};\n\tconst prompt = [];\n\n\tconst shouldIncludeField = ( field ) =>\n\t\t! fields || fields.includes( field );\n\n\tif ( metadata.siteTitle && shouldIncludeField( 'siteTitle' ) ) {\n\t\tprompt.push( ` - Site Title: ${ metadata.siteTitle }` );\n\t}\n\n\tif ( metadata.siteDescription && shouldIncludeField( 'siteDescription' ) ) {\n\t\tprompt.push( ` - Site Description: ${ metadata.siteDescription }` );\n\t}\n\n\tif ( metadata.siteLocation?.name && shouldIncludeField( 'siteLocation' ) ) {\n\t\tprompt.push( ` - Site Location: ${ metadata.siteLocation.name }` );\n\t}\n\n\tif ( metadata.topic && shouldIncludeField( 'topic' ) ) {\n\t\tprompt.push( ` - Site Topic: ${ metadata.topic }` );\n\t}\n\n\treturn prompt.join( '\\n' );\n};\n\nexport const getSelectedBlockContextPrompt = ( context, fields ) => {\n\tconst selectedBlock = context?.selectedBlock;\n\n\tif ( ! selectedBlock?.clientId ) {\n\t\treturn 'No selected block';\n\t}\n\n\tconst prompt = [];\n\n\tconst shouldIncludeField = ( field ) =>\n\t\t! fields || fields.includes( field );\n\n\tif ( selectedBlock?.clientId && shouldIncludeField( 'clientId' ) ) {\n\t\tprompt.push( ` - clientId: ${ selectedBlock.clientId }` );\n\t}\n\n\tif ( shouldIncludeField( 'type' ) ) {\n\t\t// Some blocks use name, some use type. If the user is asking for type and the block\n\t\t// only uses name, show the name instead.\n\t\tif ( selectedBlock?.type ) {\n\t\t\tprompt.push( ` - type: ${ selectedBlock.type }` );\n\t\t} else if ( selectedBlock?.name ) {\n\t\t\tprompt.push( ` - name: ${ selectedBlock.name }` );\n\t\t}\n\t}\n\n\t// Get the selected block content\n\tif ( selectedBlock?.content && shouldIncludeField( 'content' ) ) {\n\t\tprompt.push( ` - content: ${ selectedBlock.content }` );\n\t}\n\n\treturn prompt.join( '\\n' );\n};\n\nexport const getReturnToRouterPrompt = ( context ) => {\n\tif ( ! isForwardedByRouter( context ) ) {\n\t\treturn ` - For any other requests, immediately call 'change_assistant' with the toAssistantId '${ ASSISTANTS.ROUTER }'.`;\n\t}\n\treturn '';\n};\n\nexport const isForwardedByRouter = ( context ) => {\n\tconst fromAssistantId = context?.fromAssistantId;\n\tif ( fromAssistantId === ASSISTANTS.ROUTER ) {\n\t\treturn true;\n\t}\n\treturn false;\n};\n\nexport const helpAssistantPrompt = `If the input contains a question mark or starts with question words (who, what, where, when, why, how, can, could, should, would, will, do, does, did, is, are, was, were), immediately call 'change_assistant' with the toAssistantId '${ ASSISTANTS.HELP }'.`;\nexport const helpActionPrompt = `Call change_assistant tool with the toAssistantId '${ ASSISTANTS.HELP }'`;\n\nexport const routerAssistantPrompt = `For any other requests, immediately call 'change_assistant' with the toAssistantId '${ ASSISTANTS.ROUTER }'.`;\nexport const routerActionPrompt = `Call change_assistant tool with the toAssistantId '${ ASSISTANTS.ROUTER }'`;\n\nexport const invalidRequestPrompt = `If the user input is not related to WordPress, WordPress.com, WordPress hosting, website building or website design changes, let the user know that you are not able to help with that, remind them what you can help with and wait for further input`;\n\nexport const dontReturnToRouterPrompt = `If the request has been forwarded by '${ ASSISTANTS.ROUTER }', never return to '${ ASSISTANTS.ROUTER }'. In this case if you are not able to handle the request always call 'change_assistant' with the toAssistantId '${ ASSISTANTS.HELP }'`;\n","import { assistantIds, ASSISTANTS } from '../../constants.js';\n\nconst changeAssistantTool = ( currentAssistantId ) => {\n\treturn {\n\t\tname: 'change_assistant',\n\t\tdescription:\n\t\t\t\"Changes the active assistant and reinitializes the chat with the user's request\",\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\ttoAssistantId: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tenum:\n\t\t\t\t\t\tcurrentAssistantId === ASSISTANTS.ROUTER\n\t\t\t\t\t\t\t? assistantIds\n\t\t\t\t\t\t\t: [ ASSISTANTS.ROUTER, ASSISTANTS.HELP ],\n\t\t\t\t\tdescription: 'The ID of the assistant to switch to',\n\t\t\t\t},\n\t\t\t\tfromAssistantId: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tenum: [ currentAssistantId ],\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The ID of the assistant that was active before the change',\n\t\t\t\t},\n\t\t\t\treason: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The reason for the assistant change. This will be used for debugging purposes.',\n\t\t\t\t},\n\t\t\t\tuserRequest: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: `The original user request that will be passed to the new assistant. DO NOT MODIFY THIS VALUE unless explicitly instructed to do so when toAssistantId is ${ ASSISTANTS.HELP }.`,\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'toAssistantId', 'fromAssistantId', 'userRequest' ],\n\t\t},\n\t};\n};\n\nexport default changeAssistantTool;\n","import changeAssistantTool from '@ai/assistants/shared/change-assistant/change-assistant-tool';\nimport { ASSISTANTS } from '@ai/assistants/constants.js';\n\nconst routerToolkit = {\n\tname: 'router',\n\ttools: () => {\n\t\tconst tools = [ changeAssistantTool( ASSISTANTS.ROUTER ) ];\n\t\treturn tools;\n\t},\n};\n\nexport default routerToolkit;\n","/**\n * @typedef Options\n *   Configuration.\n * @property {boolean | null | undefined} [jsx=false]\n *   Support JSX identifiers (default: `false`).\n */\n\nconst startRe = /[$_\\p{ID_Start}]/u\nconst contRe = /[$_\\u{200C}\\u{200D}\\p{ID_Continue}]/u\nconst contReJsx = /[-$_\\u{200C}\\u{200D}\\p{ID_Continue}]/u\nconst nameRe = /^[$_\\p{ID_Start}][$_\\u{200C}\\u{200D}\\p{ID_Continue}]*$/u\nconst nameReJsx = /^[$_\\p{ID_Start}][-$_\\u{200C}\\u{200D}\\p{ID_Continue}]*$/u\n\n/** @type {Options} */\nconst emptyOptions = {}\n\n/**\n * Checks if the given code point can start an identifier.\n *\n * @param {number | undefined} code\n *   Code point to check.\n * @returns {boolean}\n *   Whether `code` can start an identifier.\n */\n// Note: `undefined` is supported so you can pass the result from `''.codePointAt`.\nexport function start(code) {\n  return code ? startRe.test(String.fromCodePoint(code)) : false\n}\n\n/**\n * Checks if the given code point can continue an identifier.\n *\n * @param {number | undefined} code\n *   Code point to check.\n * @param {Options | null | undefined} [options]\n *   Configuration (optional).\n * @returns {boolean}\n *   Whether `code` can continue an identifier.\n */\n// Note: `undefined` is supported so you can pass the result from `''.codePointAt`.\nexport function cont(code, options) {\n  const settings = options || emptyOptions\n  const re = settings.jsx ? contReJsx : contRe\n  return code ? re.test(String.fromCodePoint(code)) : false\n}\n\n/**\n * Checks if the given value is a valid identifier name.\n *\n * @param {string} name\n *   Identifier to check.\n * @param {Options | null | undefined} [options]\n *   Configuration (optional).\n * @returns {boolean}\n *   Whether `name` can be an identifier.\n */\nexport function name(name, options) {\n  const settings = options || emptyOptions\n  const re = settings.jsx ? nameReJsx : nameRe\n  return re.test(name)\n}\n","/**\n * @typedef {import('hast').Nodes} Nodes\n */\n\n// HTML whitespace expression.\n// See <https://infra.spec.whatwg.org/#ascii-whitespace>.\nconst re = /[ \\t\\n\\f\\r]/g\n\n/**\n * Check if the given value is *inter-element whitespace*.\n *\n * @param {Nodes | string} thing\n *   Thing to check (`Node` or `string`).\n * @returns {boolean}\n *   Whether the `value` is inter-element whitespace (`boolean`): consisting of\n *   zero or more of space, tab (`\\t`), line feed (`\\n`), carriage return\n *   (`\\r`), or form feed (`\\f`); if a node is passed it must be a `Text` node,\n *   whose `value` field is checked.\n */\nexport function whitespace(thing) {\n  return typeof thing === 'object'\n    ? thing.type === 'text'\n      ? empty(thing.value)\n      : false\n    : empty(thing)\n}\n\n/**\n * @param {string} value\n * @returns {boolean}\n */\nfunction empty(value) {\n  return value.replace(re, '') === ''\n}\n","/**\n * @typedef {import('./info.js').Info} Info\n * @typedef {Record<string, Info>} Properties\n * @typedef {Record<string, string>} Normal\n */\n\nexport class Schema {\n  /**\n   * @constructor\n   * @param {Properties} property\n   * @param {Normal} normal\n   * @param {string} [space]\n   */\n  constructor(property, normal, space) {\n    this.property = property\n    this.normal = normal\n    if (space) {\n      this.space = space\n    }\n  }\n}\n\n/** @type {Properties} */\nSchema.prototype.property = {}\n/** @type {Normal} */\nSchema.prototype.normal = {}\n/** @type {string|null} */\nSchema.prototype.space = null\n","/**\n * @typedef {import('./schema.js').Properties} Properties\n * @typedef {import('./schema.js').Normal} Normal\n */\n\nimport {Schema} from './schema.js'\n\n/**\n * @param {Schema[]} definitions\n * @param {string} [space]\n * @returns {Schema}\n */\nexport function merge(definitions, space) {\n  /** @type {Properties} */\n  const property = {}\n  /** @type {Normal} */\n  const normal = {}\n  let index = -1\n\n  while (++index < definitions.length) {\n    Object.assign(property, definitions[index].property)\n    Object.assign(normal, definitions[index].normal)\n  }\n\n  return new Schema(property, normal, space)\n}\n","/**\n * @param {string} value\n * @returns {string}\n */\nexport function normalize(value) {\n  return value.toLowerCase()\n}\n","export class Info {\n  /**\n   * @constructor\n   * @param {string} property\n   * @param {string} attribute\n   */\n  constructor(property, attribute) {\n    /** @type {string} */\n    this.property = property\n    /** @type {string} */\n    this.attribute = attribute\n  }\n}\n\n/** @type {string|null} */\nInfo.prototype.space = null\nInfo.prototype.boolean = false\nInfo.prototype.booleanish = false\nInfo.prototype.overloadedBoolean = false\nInfo.prototype.number = false\nInfo.prototype.commaSeparated = false\nInfo.prototype.spaceSeparated = false\nInfo.prototype.commaOrSpaceSeparated = false\nInfo.prototype.mustUseProperty = false\nInfo.prototype.defined = false\n","let powers = 0\n\nexport const boolean = increment()\nexport const booleanish = increment()\nexport const overloadedBoolean = increment()\nexport const number = increment()\nexport const spaceSeparated = increment()\nexport const commaSeparated = increment()\nexport const commaOrSpaceSeparated = increment()\n\nfunction increment() {\n  return 2 ** ++powers\n}\n","import {Info} from './info.js'\nimport * as types from './types.js'\n\n/** @type {Array<keyof types>} */\n// @ts-expect-error: hush.\nconst checks = Object.keys(types)\n\nexport class DefinedInfo extends Info {\n  /**\n   * @constructor\n   * @param {string} property\n   * @param {string} attribute\n   * @param {number|null} [mask]\n   * @param {string} [space]\n   */\n  constructor(property, attribute, mask, space) {\n    let index = -1\n\n    super(property, attribute)\n\n    mark(this, 'space', space)\n\n    if (typeof mask === 'number') {\n      while (++index < checks.length) {\n        const check = checks[index]\n        mark(this, checks[index], (mask & types[check]) === types[check])\n      }\n    }\n  }\n}\n\nDefinedInfo.prototype.defined = true\n\n/**\n * @param {DefinedInfo} values\n * @param {string} key\n * @param {unknown} value\n */\nfunction mark(values, key, value) {\n  if (value) {\n    // @ts-expect-error: assume `value` matches the expected value of `key`.\n    values[key] = value\n  }\n}\n","/**\n * @typedef {import('./schema.js').Properties} Properties\n * @typedef {import('./schema.js').Normal} Normal\n *\n * @typedef {Record<string, string>} Attributes\n *\n * @typedef {Object} Definition\n * @property {Record<string, number|null>} properties\n * @property {(attributes: Attributes, property: string) => string} transform\n * @property {string} [space]\n * @property {Attributes} [attributes]\n * @property {Array<string>} [mustUseProperty]\n */\n\nimport {normalize} from '../normalize.js'\nimport {Schema} from './schema.js'\nimport {DefinedInfo} from './defined-info.js'\n\nconst own = {}.hasOwnProperty\n\n/**\n * @param {Definition} definition\n * @returns {Schema}\n */\nexport function create(definition) {\n  /** @type {Properties} */\n  const property = {}\n  /** @type {Normal} */\n  const normal = {}\n  /** @type {string} */\n  let prop\n\n  for (prop in definition.properties) {\n    if (own.call(definition.properties, prop)) {\n      const value = definition.properties[prop]\n      const info = new DefinedInfo(\n        prop,\n        definition.transform(definition.attributes || {}, prop),\n        value,\n        definition.space\n      )\n\n      if (\n        definition.mustUseProperty &&\n        definition.mustUseProperty.includes(prop)\n      ) {\n        info.mustUseProperty = true\n      }\n\n      property[prop] = info\n\n      normal[normalize(prop)] = prop\n      normal[normalize(info.attribute)] = prop\n    }\n  }\n\n  return new Schema(property, normal, definition.space)\n}\n","import {create} from './util/create.js'\n\nexport const xlink = create({\n  space: 'xlink',\n  transform(_, prop) {\n    return 'xlink:' + prop.slice(5).toLowerCase()\n  },\n  properties: {\n    xLinkActuate: null,\n    xLinkArcRole: null,\n    xLinkHref: null,\n    xLinkRole: null,\n    xLinkShow: null,\n    xLinkTitle: null,\n    xLinkType: null\n  }\n})\n","import {create} from './util/create.js'\n\nexport const xml = create({\n  space: 'xml',\n  transform(_, prop) {\n    return 'xml:' + prop.slice(3).toLowerCase()\n  },\n  properties: {xmlLang: null, xmlBase: null, xmlSpace: null}\n})\n","/**\n * @param {Record<string, string>} attributes\n * @param {string} attribute\n * @returns {string}\n */\nexport function caseSensitiveTransform(attributes, attribute) {\n  return attribute in attributes ? attributes[attribute] : attribute\n}\n","import {caseSensitiveTransform} from './case-sensitive-transform.js'\n\n/**\n * @param {Record<string, string>} attributes\n * @param {string} property\n * @returns {string}\n */\nexport function caseInsensitiveTransform(attributes, property) {\n  return caseSensitiveTransform(attributes, property.toLowerCase())\n}\n","import {create} from './util/create.js'\nimport {caseInsensitiveTransform} from './util/case-insensitive-transform.js'\n\nexport const xmlns = create({\n  space: 'xmlns',\n  attributes: {xmlnsxlink: 'xmlns:xlink'},\n  transform: caseInsensitiveTransform,\n  properties: {xmlns: null, xmlnsXLink: null}\n})\n","import {booleanish, number, spaceSeparated} from './util/types.js'\nimport {create} from './util/create.js'\n\nexport const aria = create({\n  transform(_, prop) {\n    return prop === 'role' ? prop : 'aria-' + prop.slice(4).toLowerCase()\n  },\n  properties: {\n    ariaActiveDescendant: null,\n    ariaAtomic: booleanish,\n    ariaAutoComplete: null,\n    ariaBusy: booleanish,\n    ariaChecked: booleanish,\n    ariaColCount: number,\n    ariaColIndex: number,\n    ariaColSpan: number,\n    ariaControls: spaceSeparated,\n    ariaCurrent: null,\n    ariaDescribedBy: spaceSeparated,\n    ariaDetails: null,\n    ariaDisabled: booleanish,\n    ariaDropEffect: spaceSeparated,\n    ariaErrorMessage: null,\n    ariaExpanded: booleanish,\n    ariaFlowTo: spaceSeparated,\n    ariaGrabbed: booleanish,\n    ariaHasPopup: null,\n    ariaHidden: booleanish,\n    ariaInvalid: null,\n    ariaKeyShortcuts: null,\n    ariaLabel: null,\n    ariaLabelledBy: spaceSeparated,\n    ariaLevel: number,\n    ariaLive: null,\n    ariaModal: booleanish,\n    ariaMultiLine: booleanish,\n    ariaMultiSelectable: booleanish,\n    ariaOrientation: null,\n    ariaOwns: spaceSeparated,\n    ariaPlaceholder: null,\n    ariaPosInSet: number,\n    ariaPressed: booleanish,\n    ariaReadOnly: booleanish,\n    ariaRelevant: null,\n    ariaRequired: booleanish,\n    ariaRoleDescription: spaceSeparated,\n    ariaRowCount: number,\n    ariaRowIndex: number,\n    ariaRowSpan: number,\n    ariaSelected: booleanish,\n    ariaSetSize: number,\n    ariaSort: null,\n    ariaValueMax: number,\n    ariaValueMin: number,\n    ariaValueNow: number,\n    ariaValueText: null,\n    role: null\n  }\n})\n","import {\n  boolean,\n  overloadedBoolean,\n  booleanish,\n  number,\n  spaceSeparated,\n  commaSeparated\n} from './util/types.js'\nimport {create} from './util/create.js'\nimport {caseInsensitiveTransform} from './util/case-insensitive-transform.js'\n\nexport const html = create({\n  space: 'html',\n  attributes: {\n    acceptcharset: 'accept-charset',\n    classname: 'class',\n    htmlfor: 'for',\n    httpequiv: 'http-equiv'\n  },\n  transform: caseInsensitiveTransform,\n  mustUseProperty: ['checked', 'multiple', 'muted', 'selected'],\n  properties: {\n    // Standard Properties.\n    abbr: null,\n    accept: commaSeparated,\n    acceptCharset: spaceSeparated,\n    accessKey: spaceSeparated,\n    action: null,\n    allow: null,\n    allowFullScreen: boolean,\n    allowPaymentRequest: boolean,\n    allowUserMedia: boolean,\n    alt: null,\n    as: null,\n    async: boolean,\n    autoCapitalize: null,\n    autoComplete: spaceSeparated,\n    autoFocus: boolean,\n    autoPlay: boolean,\n    blocking: spaceSeparated,\n    capture: null,\n    charSet: null,\n    checked: boolean,\n    cite: null,\n    className: spaceSeparated,\n    cols: number,\n    colSpan: null,\n    content: null,\n    contentEditable: booleanish,\n    controls: boolean,\n    controlsList: spaceSeparated,\n    coords: number | commaSeparated,\n    crossOrigin: null,\n    data: null,\n    dateTime: null,\n    decoding: null,\n    default: boolean,\n    defer: boolean,\n    dir: null,\n    dirName: null,\n    disabled: boolean,\n    download: overloadedBoolean,\n    draggable: booleanish,\n    encType: null,\n    enterKeyHint: null,\n    fetchPriority: null,\n    form: null,\n    formAction: null,\n    formEncType: null,\n    formMethod: null,\n    formNoValidate: boolean,\n    formTarget: null,\n    headers: spaceSeparated,\n    height: number,\n    hidden: boolean,\n    high: number,\n    href: null,\n    hrefLang: null,\n    htmlFor: spaceSeparated,\n    httpEquiv: spaceSeparated,\n    id: null,\n    imageSizes: null,\n    imageSrcSet: null,\n    inert: boolean,\n    inputMode: null,\n    integrity: null,\n    is: null,\n    isMap: boolean,\n    itemId: null,\n    itemProp: spaceSeparated,\n    itemRef: spaceSeparated,\n    itemScope: boolean,\n    itemType: spaceSeparated,\n    kind: null,\n    label: null,\n    lang: null,\n    language: null,\n    list: null,\n    loading: null,\n    loop: boolean,\n    low: number,\n    manifest: null,\n    max: null,\n    maxLength: number,\n    media: null,\n    method: null,\n    min: null,\n    minLength: number,\n    multiple: boolean,\n    muted: boolean,\n    name: null,\n    nonce: null,\n    noModule: boolean,\n    noValidate: boolean,\n    onAbort: null,\n    onAfterPrint: null,\n    onAuxClick: null,\n    onBeforeMatch: null,\n    onBeforePrint: null,\n    onBeforeToggle: null,\n    onBeforeUnload: null,\n    onBlur: null,\n    onCancel: null,\n    onCanPlay: null,\n    onCanPlayThrough: null,\n    onChange: null,\n    onClick: null,\n    onClose: null,\n    onContextLost: null,\n    onContextMenu: null,\n    onContextRestored: null,\n    onCopy: null,\n    onCueChange: null,\n    onCut: null,\n    onDblClick: null,\n    onDrag: null,\n    onDragEnd: null,\n    onDragEnter: null,\n    onDragExit: null,\n    onDragLeave: null,\n    onDragOver: null,\n    onDragStart: null,\n    onDrop: null,\n    onDurationChange: null,\n    onEmptied: null,\n    onEnded: null,\n    onError: null,\n    onFocus: null,\n    onFormData: null,\n    onHashChange: null,\n    onInput: null,\n    onInvalid: null,\n    onKeyDown: null,\n    onKeyPress: null,\n    onKeyUp: null,\n    onLanguageChange: null,\n    onLoad: null,\n    onLoadedData: null,\n    onLoadedMetadata: null,\n    onLoadEnd: null,\n    onLoadStart: null,\n    onMessage: null,\n    onMessageError: null,\n    onMouseDown: null,\n    onMouseEnter: null,\n    onMouseLeave: null,\n    onMouseMove: null,\n    onMouseOut: null,\n    onMouseOver: null,\n    onMouseUp: null,\n    onOffline: null,\n    onOnline: null,\n    onPageHide: null,\n    onPageShow: null,\n    onPaste: null,\n    onPause: null,\n    onPlay: null,\n    onPlaying: null,\n    onPopState: null,\n    onProgress: null,\n    onRateChange: null,\n    onRejectionHandled: null,\n    onReset: null,\n    onResize: null,\n    onScroll: null,\n    onScrollEnd: null,\n    onSecurityPolicyViolation: null,\n    onSeeked: null,\n    onSeeking: null,\n    onSelect: null,\n    onSlotChange: null,\n    onStalled: null,\n    onStorage: null,\n    onSubmit: null,\n    onSuspend: null,\n    onTimeUpdate: null,\n    onToggle: null,\n    onUnhandledRejection: null,\n    onUnload: null,\n    onVolumeChange: null,\n    onWaiting: null,\n    onWheel: null,\n    open: boolean,\n    optimum: number,\n    pattern: null,\n    ping: spaceSeparated,\n    placeholder: null,\n    playsInline: boolean,\n    popover: null,\n    popoverTarget: null,\n    popoverTargetAction: null,\n    poster: null,\n    preload: null,\n    readOnly: boolean,\n    referrerPolicy: null,\n    rel: spaceSeparated,\n    required: boolean,\n    reversed: boolean,\n    rows: number,\n    rowSpan: number,\n    sandbox: spaceSeparated,\n    scope: null,\n    scoped: boolean,\n    seamless: boolean,\n    selected: boolean,\n    shadowRootClonable: boolean,\n    shadowRootDelegatesFocus: boolean,\n    shadowRootMode: null,\n    shape: null,\n    size: number,\n    sizes: null,\n    slot: null,\n    span: number,\n    spellCheck: booleanish,\n    src: null,\n    srcDoc: null,\n    srcLang: null,\n    srcSet: null,\n    start: number,\n    step: null,\n    style: null,\n    tabIndex: number,\n    target: null,\n    title: null,\n    translate: null,\n    type: null,\n    typeMustMatch: boolean,\n    useMap: null,\n    value: booleanish,\n    width: number,\n    wrap: null,\n    writingSuggestions: null,\n\n    // Legacy.\n    // See: https://html.spec.whatwg.org/#other-elements,-attributes-and-apis\n    align: null, // Several. Use CSS `text-align` instead,\n    aLink: null, // `<body>`. Use CSS `a:active {color}` instead\n    archive: spaceSeparated, // `<object>`. List of URIs to archives\n    axis: null, // `<td>` and `<th>`. Use `scope` on `<th>`\n    background: null, // `<body>`. Use CSS `background-image` instead\n    bgColor: null, // `<body>` and table elements. Use CSS `background-color` instead\n    border: number, // `<table>`. Use CSS `border-width` instead,\n    borderColor: null, // `<table>`. Use CSS `border-color` instead,\n    bottomMargin: number, // `<body>`\n    cellPadding: null, // `<table>`\n    cellSpacing: null, // `<table>`\n    char: null, // Several table elements. When `align=char`, sets the character to align on\n    charOff: null, // Several table elements. When `char`, offsets the alignment\n    classId: null, // `<object>`\n    clear: null, // `<br>`. Use CSS `clear` instead\n    code: null, // `<object>`\n    codeBase: null, // `<object>`\n    codeType: null, // `<object>`\n    color: null, // `<font>` and `<hr>`. Use CSS instead\n    compact: boolean, // Lists. Use CSS to reduce space between items instead\n    declare: boolean, // `<object>`\n    event: null, // `<script>`\n    face: null, // `<font>`. Use CSS instead\n    frame: null, // `<table>`\n    frameBorder: null, // `<iframe>`. Use CSS `border` instead\n    hSpace: number, // `<img>` and `<object>`\n    leftMargin: number, // `<body>`\n    link: null, // `<body>`. Use CSS `a:link {color: *}` instead\n    longDesc: null, // `<frame>`, `<iframe>`, and `<img>`. Use an `<a>`\n    lowSrc: null, // `<img>`. Use a `<picture>`\n    marginHeight: number, // `<body>`\n    marginWidth: number, // `<body>`\n    noResize: boolean, // `<frame>`\n    noHref: boolean, // `<area>`. Use no href instead of an explicit `nohref`\n    noShade: boolean, // `<hr>`. Use background-color and height instead of borders\n    noWrap: boolean, // `<td>` and `<th>`\n    object: null, // `<applet>`\n    profile: null, // `<head>`\n    prompt: null, // `<isindex>`\n    rev: null, // `<link>`\n    rightMargin: number, // `<body>`\n    rules: null, // `<table>`\n    scheme: null, // `<meta>`\n    scrolling: booleanish, // `<frame>`. Use overflow in the child context\n    standby: null, // `<object>`\n    summary: null, // `<table>`\n    text: null, // `<body>`. Use CSS `color` instead\n    topMargin: number, // `<body>`\n    valueType: null, // `<param>`\n    version: null, // `<html>`. Use a doctype.\n    vAlign: null, // Several. Use CSS `vertical-align` instead\n    vLink: null, // `<body>`. Use CSS `a:visited {color}` instead\n    vSpace: number, // `<img>` and `<object>`\n\n    // Non-standard Properties.\n    allowTransparency: null,\n    autoCorrect: null,\n    autoSave: null,\n    disablePictureInPicture: boolean,\n    disableRemotePlayback: boolean,\n    prefix: null,\n    property: null,\n    results: number,\n    security: null,\n    unselectable: null\n  }\n})\n","import {\n  boolean,\n  number,\n  spaceSeparated,\n  commaSeparated,\n  commaOrSpaceSeparated\n} from './util/types.js'\nimport {create} from './util/create.js'\nimport {caseSensitiveTransform} from './util/case-sensitive-transform.js'\n\nexport const svg = create({\n  space: 'svg',\n  attributes: {\n    accentHeight: 'accent-height',\n    alignmentBaseline: 'alignment-baseline',\n    arabicForm: 'arabic-form',\n    baselineShift: 'baseline-shift',\n    capHeight: 'cap-height',\n    className: 'class',\n    clipPath: 'clip-path',\n    clipRule: 'clip-rule',\n    colorInterpolation: 'color-interpolation',\n    colorInterpolationFilters: 'color-interpolation-filters',\n    colorProfile: 'color-profile',\n    colorRendering: 'color-rendering',\n    crossOrigin: 'crossorigin',\n    dataType: 'datatype',\n    dominantBaseline: 'dominant-baseline',\n    enableBackground: 'enable-background',\n    fillOpacity: 'fill-opacity',\n    fillRule: 'fill-rule',\n    floodColor: 'flood-color',\n    floodOpacity: 'flood-opacity',\n    fontFamily: 'font-family',\n    fontSize: 'font-size',\n    fontSizeAdjust: 'font-size-adjust',\n    fontStretch: 'font-stretch',\n    fontStyle: 'font-style',\n    fontVariant: 'font-variant',\n    fontWeight: 'font-weight',\n    glyphName: 'glyph-name',\n    glyphOrientationHorizontal: 'glyph-orientation-horizontal',\n    glyphOrientationVertical: 'glyph-orientation-vertical',\n    hrefLang: 'hreflang',\n    horizAdvX: 'horiz-adv-x',\n    horizOriginX: 'horiz-origin-x',\n    horizOriginY: 'horiz-origin-y',\n    imageRendering: 'image-rendering',\n    letterSpacing: 'letter-spacing',\n    lightingColor: 'lighting-color',\n    markerEnd: 'marker-end',\n    markerMid: 'marker-mid',\n    markerStart: 'marker-start',\n    navDown: 'nav-down',\n    navDownLeft: 'nav-down-left',\n    navDownRight: 'nav-down-right',\n    navLeft: 'nav-left',\n    navNext: 'nav-next',\n    navPrev: 'nav-prev',\n    navRight: 'nav-right',\n    navUp: 'nav-up',\n    navUpLeft: 'nav-up-left',\n    navUpRight: 'nav-up-right',\n    onAbort: 'onabort',\n    onActivate: 'onactivate',\n    onAfterPrint: 'onafterprint',\n    onBeforePrint: 'onbeforeprint',\n    onBegin: 'onbegin',\n    onCancel: 'oncancel',\n    onCanPlay: 'oncanplay',\n    onCanPlayThrough: 'oncanplaythrough',\n    onChange: 'onchange',\n    onClick: 'onclick',\n    onClose: 'onclose',\n    onCopy: 'oncopy',\n    onCueChange: 'oncuechange',\n    onCut: 'oncut',\n    onDblClick: 'ondblclick',\n    onDrag: 'ondrag',\n    onDragEnd: 'ondragend',\n    onDragEnter: 'ondragenter',\n    onDragExit: 'ondragexit',\n    onDragLeave: 'ondragleave',\n    onDragOver: 'ondragover',\n    onDragStart: 'ondragstart',\n    onDrop: 'ondrop',\n    onDurationChange: 'ondurationchange',\n    onEmptied: 'onemptied',\n    onEnd: 'onend',\n    onEnded: 'onended',\n    onError: 'onerror',\n    onFocus: 'onfocus',\n    onFocusIn: 'onfocusin',\n    onFocusOut: 'onfocusout',\n    onHashChange: 'onhashchange',\n    onInput: 'oninput',\n    onInvalid: 'oninvalid',\n    onKeyDown: 'onkeydown',\n    onKeyPress: 'onkeypress',\n    onKeyUp: 'onkeyup',\n    onLoad: 'onload',\n    onLoadedData: 'onloadeddata',\n    onLoadedMetadata: 'onloadedmetadata',\n    onLoadStart: 'onloadstart',\n    onMessage: 'onmessage',\n    onMouseDown: 'onmousedown',\n    onMouseEnter: 'onmouseenter',\n    onMouseLeave: 'onmouseleave',\n    onMouseMove: 'onmousemove',\n    onMouseOut: 'onmouseout',\n    onMouseOver: 'onmouseover',\n    onMouseUp: 'onmouseup',\n    onMouseWheel: 'onmousewheel',\n    onOffline: 'onoffline',\n    onOnline: 'ononline',\n    onPageHide: 'onpagehide',\n    onPageShow: 'onpageshow',\n    onPaste: 'onpaste',\n    onPause: 'onpause',\n    onPlay: 'onplay',\n    onPlaying: 'onplaying',\n    onPopState: 'onpopstate',\n    onProgress: 'onprogress',\n    onRateChange: 'onratechange',\n    onRepeat: 'onrepeat',\n    onReset: 'onreset',\n    onResize: 'onresize',\n    onScroll: 'onscroll',\n    onSeeked: 'onseeked',\n    onSeeking: 'onseeking',\n    onSelect: 'onselect',\n    onShow: 'onshow',\n    onStalled: 'onstalled',\n    onStorage: 'onstorage',\n    onSubmit: 'onsubmit',\n    onSuspend: 'onsuspend',\n    onTimeUpdate: 'ontimeupdate',\n    onToggle: 'ontoggle',\n    onUnload: 'onunload',\n    onVolumeChange: 'onvolumechange',\n    onWaiting: 'onwaiting',\n    onZoom: 'onzoom',\n    overlinePosition: 'overline-position',\n    overlineThickness: 'overline-thickness',\n    paintOrder: 'paint-order',\n    panose1: 'panose-1',\n    pointerEvents: 'pointer-events',\n    referrerPolicy: 'referrerpolicy',\n    renderingIntent: 'rendering-intent',\n    shapeRendering: 'shape-rendering',\n    stopColor: 'stop-color',\n    stopOpacity: 'stop-opacity',\n    strikethroughPosition: 'strikethrough-position',\n    strikethroughThickness: 'strikethrough-thickness',\n    strokeDashArray: 'stroke-dasharray',\n    strokeDashOffset: 'stroke-dashoffset',\n    strokeLineCap: 'stroke-linecap',\n    strokeLineJoin: 'stroke-linejoin',\n    strokeMiterLimit: 'stroke-miterlimit',\n    strokeOpacity: 'stroke-opacity',\n    strokeWidth: 'stroke-width',\n    tabIndex: 'tabindex',\n    textAnchor: 'text-anchor',\n    textDecoration: 'text-decoration',\n    textRendering: 'text-rendering',\n    transformOrigin: 'transform-origin',\n    typeOf: 'typeof',\n    underlinePosition: 'underline-position',\n    underlineThickness: 'underline-thickness',\n    unicodeBidi: 'unicode-bidi',\n    unicodeRange: 'unicode-range',\n    unitsPerEm: 'units-per-em',\n    vAlphabetic: 'v-alphabetic',\n    vHanging: 'v-hanging',\n    vIdeographic: 'v-ideographic',\n    vMathematical: 'v-mathematical',\n    vectorEffect: 'vector-effect',\n    vertAdvY: 'vert-adv-y',\n    vertOriginX: 'vert-origin-x',\n    vertOriginY: 'vert-origin-y',\n    wordSpacing: 'word-spacing',\n    writingMode: 'writing-mode',\n    xHeight: 'x-height',\n    // These were camelcased in Tiny. Now lowercased in SVG 2\n    playbackOrder: 'playbackorder',\n    timelineBegin: 'timelinebegin'\n  },\n  transform: caseSensitiveTransform,\n  properties: {\n    about: commaOrSpaceSeparated,\n    accentHeight: number,\n    accumulate: null,\n    additive: null,\n    alignmentBaseline: null,\n    alphabetic: number,\n    amplitude: number,\n    arabicForm: null,\n    ascent: number,\n    attributeName: null,\n    attributeType: null,\n    azimuth: number,\n    bandwidth: null,\n    baselineShift: null,\n    baseFrequency: null,\n    baseProfile: null,\n    bbox: null,\n    begin: null,\n    bias: number,\n    by: null,\n    calcMode: null,\n    capHeight: number,\n    className: spaceSeparated,\n    clip: null,\n    clipPath: null,\n    clipPathUnits: null,\n    clipRule: null,\n    color: null,\n    colorInterpolation: null,\n    colorInterpolationFilters: null,\n    colorProfile: null,\n    colorRendering: null,\n    content: null,\n    contentScriptType: null,\n    contentStyleType: null,\n    crossOrigin: null,\n    cursor: null,\n    cx: null,\n    cy: null,\n    d: null,\n    dataType: null,\n    defaultAction: null,\n    descent: number,\n    diffuseConstant: number,\n    direction: null,\n    display: null,\n    dur: null,\n    divisor: number,\n    dominantBaseline: null,\n    download: boolean,\n    dx: null,\n    dy: null,\n    edgeMode: null,\n    editable: null,\n    elevation: number,\n    enableBackground: null,\n    end: null,\n    event: null,\n    exponent: number,\n    externalResourcesRequired: null,\n    fill: null,\n    fillOpacity: number,\n    fillRule: null,\n    filter: null,\n    filterRes: null,\n    filterUnits: null,\n    floodColor: null,\n    floodOpacity: null,\n    focusable: null,\n    focusHighlight: null,\n    fontFamily: null,\n    fontSize: null,\n    fontSizeAdjust: null,\n    fontStretch: null,\n    fontStyle: null,\n    fontVariant: null,\n    fontWeight: null,\n    format: null,\n    fr: null,\n    from: null,\n    fx: null,\n    fy: null,\n    g1: commaSeparated,\n    g2: commaSeparated,\n    glyphName: commaSeparated,\n    glyphOrientationHorizontal: null,\n    glyphOrientationVertical: null,\n    glyphRef: null,\n    gradientTransform: null,\n    gradientUnits: null,\n    handler: null,\n    hanging: number,\n    hatchContentUnits: null,\n    hatchUnits: null,\n    height: null,\n    href: null,\n    hrefLang: null,\n    horizAdvX: number,\n    horizOriginX: number,\n    horizOriginY: number,\n    id: null,\n    ideographic: number,\n    imageRendering: null,\n    initialVisibility: null,\n    in: null,\n    in2: null,\n    intercept: number,\n    k: number,\n    k1: number,\n    k2: number,\n    k3: number,\n    k4: number,\n    kernelMatrix: commaOrSpaceSeparated,\n    kernelUnitLength: null,\n    keyPoints: null, // SEMI_COLON_SEPARATED\n    keySplines: null, // SEMI_COLON_SEPARATED\n    keyTimes: null, // SEMI_COLON_SEPARATED\n    kerning: null,\n    lang: null,\n    lengthAdjust: null,\n    letterSpacing: null,\n    lightingColor: null,\n    limitingConeAngle: number,\n    local: null,\n    markerEnd: null,\n    markerMid: null,\n    markerStart: null,\n    markerHeight: null,\n    markerUnits: null,\n    markerWidth: null,\n    mask: null,\n    maskContentUnits: null,\n    maskUnits: null,\n    mathematical: null,\n    max: null,\n    media: null,\n    mediaCharacterEncoding: null,\n    mediaContentEncodings: null,\n    mediaSize: number,\n    mediaTime: null,\n    method: null,\n    min: null,\n    mode: null,\n    name: null,\n    navDown: null,\n    navDownLeft: null,\n    navDownRight: null,\n    navLeft: null,\n    navNext: null,\n    navPrev: null,\n    navRight: null,\n    navUp: null,\n    navUpLeft: null,\n    navUpRight: null,\n    numOctaves: null,\n    observer: null,\n    offset: null,\n    onAbort: null,\n    onActivate: null,\n    onAfterPrint: null,\n    onBeforePrint: null,\n    onBegin: null,\n    onCancel: null,\n    onCanPlay: null,\n    onCanPlayThrough: null,\n    onChange: null,\n    onClick: null,\n    onClose: null,\n    onCopy: null,\n    onCueChange: null,\n    onCut: null,\n    onDblClick: null,\n    onDrag: null,\n    onDragEnd: null,\n    onDragEnter: null,\n    onDragExit: null,\n    onDragLeave: null,\n    onDragOver: null,\n    onDragStart: null,\n    onDrop: null,\n    onDurationChange: null,\n    onEmptied: null,\n    onEnd: null,\n    onEnded: null,\n    onError: null,\n    onFocus: null,\n    onFocusIn: null,\n    onFocusOut: null,\n    onHashChange: null,\n    onInput: null,\n    onInvalid: null,\n    onKeyDown: null,\n    onKeyPress: null,\n    onKeyUp: null,\n    onLoad: null,\n    onLoadedData: null,\n    onLoadedMetadata: null,\n    onLoadStart: null,\n    onMessage: null,\n    onMouseDown: null,\n    onMouseEnter: null,\n    onMouseLeave: null,\n    onMouseMove: null,\n    onMouseOut: null,\n    onMouseOver: null,\n    onMouseUp: null,\n    onMouseWheel: null,\n    onOffline: null,\n    onOnline: null,\n    onPageHide: null,\n    onPageShow: null,\n    onPaste: null,\n    onPause: null,\n    onPlay: null,\n    onPlaying: null,\n    onPopState: null,\n    onProgress: null,\n    onRateChange: null,\n    onRepeat: null,\n    onReset: null,\n    onResize: null,\n    onScroll: null,\n    onSeeked: null,\n    onSeeking: null,\n    onSelect: null,\n    onShow: null,\n    onStalled: null,\n    onStorage: null,\n    onSubmit: null,\n    onSuspend: null,\n    onTimeUpdate: null,\n    onToggle: null,\n    onUnload: null,\n    onVolumeChange: null,\n    onWaiting: null,\n    onZoom: null,\n    opacity: null,\n    operator: null,\n    order: null,\n    orient: null,\n    orientation: null,\n    origin: null,\n    overflow: null,\n    overlay: null,\n    overlinePosition: number,\n    overlineThickness: number,\n    paintOrder: null,\n    panose1: null,\n    path: null,\n    pathLength: number,\n    patternContentUnits: null,\n    patternTransform: null,\n    patternUnits: null,\n    phase: null,\n    ping: spaceSeparated,\n    pitch: null,\n    playbackOrder: null,\n    pointerEvents: null,\n    points: null,\n    pointsAtX: number,\n    pointsAtY: number,\n    pointsAtZ: number,\n    preserveAlpha: null,\n    preserveAspectRatio: null,\n    primitiveUnits: null,\n    propagate: null,\n    property: commaOrSpaceSeparated,\n    r: null,\n    radius: null,\n    referrerPolicy: null,\n    refX: null,\n    refY: null,\n    rel: commaOrSpaceSeparated,\n    rev: commaOrSpaceSeparated,\n    renderingIntent: null,\n    repeatCount: null,\n    repeatDur: null,\n    requiredExtensions: commaOrSpaceSeparated,\n    requiredFeatures: commaOrSpaceSeparated,\n    requiredFonts: commaOrSpaceSeparated,\n    requiredFormats: commaOrSpaceSeparated,\n    resource: null,\n    restart: null,\n    result: null,\n    rotate: null,\n    rx: null,\n    ry: null,\n    scale: null,\n    seed: null,\n    shapeRendering: null,\n    side: null,\n    slope: null,\n    snapshotTime: null,\n    specularConstant: number,\n    specularExponent: number,\n    spreadMethod: null,\n    spacing: null,\n    startOffset: null,\n    stdDeviation: null,\n    stemh: null,\n    stemv: null,\n    stitchTiles: null,\n    stopColor: null,\n    stopOpacity: null,\n    strikethroughPosition: number,\n    strikethroughThickness: number,\n    string: null,\n    stroke: null,\n    strokeDashArray: commaOrSpaceSeparated,\n    strokeDashOffset: null,\n    strokeLineCap: null,\n    strokeLineJoin: null,\n    strokeMiterLimit: number,\n    strokeOpacity: number,\n    strokeWidth: null,\n    style: null,\n    surfaceScale: number,\n    syncBehavior: null,\n    syncBehaviorDefault: null,\n    syncMaster: null,\n    syncTolerance: null,\n    syncToleranceDefault: null,\n    systemLanguage: commaOrSpaceSeparated,\n    tabIndex: number,\n    tableValues: null,\n    target: null,\n    targetX: number,\n    targetY: number,\n    textAnchor: null,\n    textDecoration: null,\n    textRendering: null,\n    textLength: null,\n    timelineBegin: null,\n    title: null,\n    transformBehavior: null,\n    type: null,\n    typeOf: commaOrSpaceSeparated,\n    to: null,\n    transform: null,\n    transformOrigin: null,\n    u1: null,\n    u2: null,\n    underlinePosition: number,\n    underlineThickness: number,\n    unicode: null,\n    unicodeBidi: null,\n    unicodeRange: null,\n    unitsPerEm: number,\n    values: null,\n    vAlphabetic: number,\n    vMathematical: number,\n    vectorEffect: null,\n    vHanging: number,\n    vIdeographic: number,\n    version: null,\n    vertAdvY: number,\n    vertOriginX: number,\n    vertOriginY: number,\n    viewBox: null,\n    viewTarget: null,\n    visibility: null,\n    width: null,\n    widths: null,\n    wordSpacing: null,\n    writingMode: null,\n    x: null,\n    x1: null,\n    x2: null,\n    xChannelSelector: null,\n    xHeight: number,\n    y: null,\n    y1: null,\n    y2: null,\n    yChannelSelector: null,\n    z: null,\n    zoomAndPan: null\n  }\n})\n","/**\n * @typedef {import('./lib/util/info.js').Info} Info\n * @typedef {import('./lib/util/schema.js').Schema} Schema\n */\n\nimport {merge} from './lib/util/merge.js'\nimport {xlink} from './lib/xlink.js'\nimport {xml} from './lib/xml.js'\nimport {xmlns} from './lib/xmlns.js'\nimport {aria} from './lib/aria.js'\nimport {html as htmlBase} from './lib/html.js'\nimport {svg as svgBase} from './lib/svg.js'\n\nexport {find} from './lib/find.js'\nexport {hastToReact} from './lib/hast-to-react.js'\nexport {normalize} from './lib/normalize.js'\nexport const html = merge([xml, xlink, xmlns, aria, htmlBase], 'html')\nexport const svg = merge([xml, xlink, xmlns, aria, svgBase], 'svg')\n","/**\n * @typedef {import('./util/schema.js').Schema} Schema\n */\n\nimport {normalize} from './normalize.js'\nimport {DefinedInfo} from './util/defined-info.js'\nimport {Info} from './util/info.js'\n\nconst valid = /^data[-\\w.:]+$/i\nconst dash = /-[a-z]/g\nconst cap = /[A-Z]/g\n\n/**\n * @param {Schema} schema\n * @param {string} value\n * @returns {Info}\n */\nexport function find(schema, value) {\n  const normal = normalize(value)\n  let prop = value\n  let Type = Info\n\n  if (normal in schema.normal) {\n    return schema.property[schema.normal[normal]]\n  }\n\n  if (normal.length > 4 && normal.slice(0, 4) === 'data' && valid.test(value)) {\n    // Attribute or property.\n    if (value.charAt(4) === '-') {\n      // Turn it into a property.\n      const rest = value.slice(5).replace(dash, camelcase)\n      prop = 'data' + rest.charAt(0).toUpperCase() + rest.slice(1)\n    } else {\n      // Turn it into an attribute.\n      const rest = value.slice(4)\n\n      if (!dash.test(rest)) {\n        let dashes = rest.replace(cap, kebab)\n\n        if (dashes.charAt(0) !== '-') {\n          dashes = '-' + dashes\n        }\n\n        value = 'data' + dashes\n      }\n    }\n\n    Type = DefinedInfo\n  }\n\n  return new Type(prop, value)\n}\n\n/**\n * @param {string} $0\n * @returns {string}\n */\nfunction kebab($0) {\n  return '-' + $0.toLowerCase()\n}\n\n/**\n * @param {string} $0\n * @returns {string}\n */\nfunction camelcase($0) {\n  return $0.charAt(1).toUpperCase()\n}\n","/**\n * `hast` is close to `React`, but differs in a couple of cases.\n *\n * To get a React property from a hast property, check if it is in\n * `hastToReact`, if it is, then use the corresponding value,\n * otherwise, use the hast property.\n *\n * @type {Record<string, string>}\n */\nexport const hastToReact = {\n  classId: 'classID',\n  dataType: 'datatype',\n  itemId: 'itemID',\n  strokeDashArray: 'strokeDasharray',\n  strokeDashOffset: 'strokeDashoffset',\n  strokeLineCap: 'strokeLinecap',\n  strokeLineJoin: 'strokeLinejoin',\n  strokeMiterLimit: 'strokeMiterlimit',\n  typeOf: 'typeof',\n  xLinkActuate: 'xlinkActuate',\n  xLinkArcRole: 'xlinkArcrole',\n  xLinkHref: 'xlinkHref',\n  xLinkRole: 'xlinkRole',\n  xLinkShow: 'xlinkShow',\n  xLinkTitle: 'xlinkTitle',\n  xLinkType: 'xlinkType',\n  xmlnsXLink: 'xmlnsXlink'\n}\n","import StyleToObject from '../cjs/index.js';\n\n// ensure compatibility with rollup umd build\nexport default StyleToObject.default || StyleToObject;\n","/**\n * @typedef {import('unist').Node} Node\n * @typedef {import('unist').Point} Point\n * @typedef {import('unist').Position} Position\n */\n\n/**\n * @typedef NodeLike\n * @property {string} type\n * @property {PositionLike | null | undefined} [position]\n *\n * @typedef PositionLike\n * @property {PointLike | null | undefined} [start]\n * @property {PointLike | null | undefined} [end]\n *\n * @typedef PointLike\n * @property {number | null | undefined} [line]\n * @property {number | null | undefined} [column]\n * @property {number | null | undefined} [offset]\n */\n\n/**\n * Get the ending point of `node`.\n *\n * @param node\n *   Node.\n * @returns\n *   Point.\n */\nexport const pointEnd = point('end')\n\n/**\n * Get the starting point of `node`.\n *\n * @param node\n *   Node.\n * @returns\n *   Point.\n */\nexport const pointStart = point('start')\n\n/**\n * Get the positional info of `node`.\n *\n * @param {'end' | 'start'} type\n *   Side.\n * @returns\n *   Getter.\n */\nfunction point(type) {\n  return point\n\n  /**\n   * Get the point info of `node` at a bound side.\n   *\n   * @param {Node | NodeLike | null | undefined} [node]\n   * @returns {Point | undefined}\n   */\n  function point(node) {\n    const point = (node && node.position && node.position[type]) || {}\n\n    if (\n      typeof point.line === 'number' &&\n      point.line > 0 &&\n      typeof point.column === 'number' &&\n      point.column > 0\n    ) {\n      return {\n        line: point.line,\n        column: point.column,\n        offset:\n          typeof point.offset === 'number' && point.offset > -1\n            ? point.offset\n            : undefined\n      }\n    }\n  }\n}\n\n/**\n * Get the positional info of `node`.\n *\n * @param {Node | NodeLike | null | undefined} [node]\n *   Node.\n * @returns {Position | undefined}\n *   Position.\n */\nexport function position(node) {\n  const start = pointStart(node)\n  const end = pointEnd(node)\n\n  if (start && end) {\n    return {start, end}\n  }\n}\n","/**\n * @typedef {import('unist').Node} Node\n * @typedef {import('unist').Point} Point\n * @typedef {import('unist').Position} Position\n */\n\n/**\n * @typedef NodeLike\n * @property {string} type\n * @property {PositionLike | null | undefined} [position]\n *\n * @typedef PointLike\n * @property {number | null | undefined} [line]\n * @property {number | null | undefined} [column]\n * @property {number | null | undefined} [offset]\n *\n * @typedef PositionLike\n * @property {PointLike | null | undefined} [start]\n * @property {PointLike | null | undefined} [end]\n */\n\n/**\n * Serialize the positional info of a point, position (start and end points),\n * or node.\n *\n * @param {Node | NodeLike | Point | PointLike | Position | PositionLike | null | undefined} [value]\n *   Node, position, or point.\n * @returns {string}\n *   Pretty printed positional info of a node (`string`).\n *\n *   In the format of a range `ls:cs-le:ce` (when given `node` or `position`)\n *   or a point `l:c` (when given `point`), where `l` stands for line, `c` for\n *   column, `s` for `start`, and `e` for end.\n *   An empty string (`''`) is returned if the given value is neither `node`,\n *   `position`, nor `point`.\n */\nexport function stringifyPosition(value) {\n  // Nothing.\n  if (!value || typeof value !== 'object') {\n    return ''\n  }\n\n  // Node.\n  if ('position' in value || 'type' in value) {\n    return position(value.position)\n  }\n\n  // Position.\n  if ('start' in value || 'end' in value) {\n    return position(value)\n  }\n\n  // Point.\n  if ('line' in value || 'column' in value) {\n    return point(value)\n  }\n\n  // ?\n  return ''\n}\n\n/**\n * @param {Point | PointLike | null | undefined} point\n * @returns {string}\n */\nfunction point(point) {\n  return index(point && point.line) + ':' + index(point && point.column)\n}\n\n/**\n * @param {Position | PositionLike | null | undefined} pos\n * @returns {string}\n */\nfunction position(pos) {\n  return point(pos && pos.start) + '-' + point(pos && pos.end)\n}\n\n/**\n * @param {number | null | undefined} value\n * @returns {number}\n */\nfunction index(value) {\n  return value && typeof value === 'number' ? value : 1\n}\n","/**\n * @typedef {import('unist').Node} Node\n * @typedef {import('unist').Point} Point\n * @typedef {import('unist').Position} Position\n */\n\n/**\n * @typedef {object & {type: string, position?: Position | undefined}} NodeLike\n *\n * @typedef Options\n *   Configuration.\n * @property {Array<Node> | null | undefined} [ancestors]\n *   Stack of (inclusive) ancestor nodes surrounding the message (optional).\n * @property {Error | null | undefined} [cause]\n *   Original error cause of the message (optional).\n * @property {Point | Position | null | undefined} [place]\n *   Place of message (optional).\n * @property {string | null | undefined} [ruleId]\n *   Category of message (optional, example: `'my-rule'`).\n * @property {string | null | undefined} [source]\n *   Namespace of who sent the message (optional, example: `'my-package'`).\n */\n\nimport {stringifyPosition} from 'unist-util-stringify-position'\n\n/**\n * Message.\n */\nexport class VFileMessage extends Error {\n  /**\n   * Create a message for `reason`.\n   *\n   * > 🪦 **Note**: also has obsolete signatures.\n   *\n   * @overload\n   * @param {string} reason\n   * @param {Options | null | undefined} [options]\n   * @returns\n   *\n   * @overload\n   * @param {string} reason\n   * @param {Node | NodeLike | null | undefined} parent\n   * @param {string | null | undefined} [origin]\n   * @returns\n   *\n   * @overload\n   * @param {string} reason\n   * @param {Point | Position | null | undefined} place\n   * @param {string | null | undefined} [origin]\n   * @returns\n   *\n   * @overload\n   * @param {string} reason\n   * @param {string | null | undefined} [origin]\n   * @returns\n   *\n   * @overload\n   * @param {Error | VFileMessage} cause\n   * @param {Node | NodeLike | null | undefined} parent\n   * @param {string | null | undefined} [origin]\n   * @returns\n   *\n   * @overload\n   * @param {Error | VFileMessage} cause\n   * @param {Point | Position | null | undefined} place\n   * @param {string | null | undefined} [origin]\n   * @returns\n   *\n   * @overload\n   * @param {Error | VFileMessage} cause\n   * @param {string | null | undefined} [origin]\n   * @returns\n   *\n   * @param {Error | VFileMessage | string} causeOrReason\n   *   Reason for message, should use markdown.\n   * @param {Node | NodeLike | Options | Point | Position | string | null | undefined} [optionsOrParentOrPlace]\n   *   Configuration (optional).\n   * @param {string | null | undefined} [origin]\n   *   Place in code where the message originates (example:\n   *   `'my-package:my-rule'` or `'my-rule'`).\n   * @returns\n   *   Instance of `VFileMessage`.\n   */\n  // eslint-disable-next-line complexity\n  constructor(causeOrReason, optionsOrParentOrPlace, origin) {\n    super()\n\n    if (typeof optionsOrParentOrPlace === 'string') {\n      origin = optionsOrParentOrPlace\n      optionsOrParentOrPlace = undefined\n    }\n\n    /** @type {string} */\n    let reason = ''\n    /** @type {Options} */\n    let options = {}\n    let legacyCause = false\n\n    if (optionsOrParentOrPlace) {\n      // Point.\n      if (\n        'line' in optionsOrParentOrPlace &&\n        'column' in optionsOrParentOrPlace\n      ) {\n        options = {place: optionsOrParentOrPlace}\n      }\n      // Position.\n      else if (\n        'start' in optionsOrParentOrPlace &&\n        'end' in optionsOrParentOrPlace\n      ) {\n        options = {place: optionsOrParentOrPlace}\n      }\n      // Node.\n      else if ('type' in optionsOrParentOrPlace) {\n        options = {\n          ancestors: [optionsOrParentOrPlace],\n          place: optionsOrParentOrPlace.position\n        }\n      }\n      // Options.\n      else {\n        options = {...optionsOrParentOrPlace}\n      }\n    }\n\n    if (typeof causeOrReason === 'string') {\n      reason = causeOrReason\n    }\n    // Error.\n    else if (!options.cause && causeOrReason) {\n      legacyCause = true\n      reason = causeOrReason.message\n      options.cause = causeOrReason\n    }\n\n    if (!options.ruleId && !options.source && typeof origin === 'string') {\n      const index = origin.indexOf(':')\n\n      if (index === -1) {\n        options.ruleId = origin\n      } else {\n        options.source = origin.slice(0, index)\n        options.ruleId = origin.slice(index + 1)\n      }\n    }\n\n    if (!options.place && options.ancestors && options.ancestors) {\n      const parent = options.ancestors[options.ancestors.length - 1]\n\n      if (parent) {\n        options.place = parent.position\n      }\n    }\n\n    const start =\n      options.place && 'start' in options.place\n        ? options.place.start\n        : options.place\n\n    /* eslint-disable no-unused-expressions */\n    /**\n     * Stack of ancestor nodes surrounding the message.\n     *\n     * @type {Array<Node> | undefined}\n     */\n    this.ancestors = options.ancestors || undefined\n\n    /**\n     * Original error cause of the message.\n     *\n     * @type {Error | undefined}\n     */\n    this.cause = options.cause || undefined\n\n    /**\n     * Starting column of message.\n     *\n     * @type {number | undefined}\n     */\n    this.column = start ? start.column : undefined\n\n    /**\n     * State of problem.\n     *\n     * * `true` — error, file not usable\n     * * `false` — warning, change may be needed\n     * * `undefined` — change likely not needed\n     *\n     * @type {boolean | null | undefined}\n     */\n    this.fatal = undefined\n\n    /**\n     * Path of a file (used throughout the `VFile` ecosystem).\n     *\n     * @type {string | undefined}\n     */\n    this.file\n\n    // Field from `Error`.\n    /**\n     * Reason for message.\n     *\n     * @type {string}\n     */\n    this.message = reason\n\n    /**\n     * Starting line of error.\n     *\n     * @type {number | undefined}\n     */\n    this.line = start ? start.line : undefined\n\n    // Field from `Error`.\n    /**\n     * Serialized positional info of message.\n     *\n     * On normal errors, this would be something like `ParseError`, buit in\n     * `VFile` messages we use this space to show where an error happened.\n     */\n    this.name = stringifyPosition(options.place) || '1:1'\n\n    /**\n     * Place of message.\n     *\n     * @type {Point | Position | undefined}\n     */\n    this.place = options.place || undefined\n\n    /**\n     * Reason for message, should use markdown.\n     *\n     * @type {string}\n     */\n    this.reason = this.message\n\n    /**\n     * Category of message (example: `'my-rule'`).\n     *\n     * @type {string | undefined}\n     */\n    this.ruleId = options.ruleId || undefined\n\n    /**\n     * Namespace of message (example: `'my-package'`).\n     *\n     * @type {string | undefined}\n     */\n    this.source = options.source || undefined\n\n    // Field from `Error`.\n    /**\n     * Stack of message.\n     *\n     * This is used by normal errors to show where something happened in\n     * programming code, irrelevant for `VFile` messages,\n     *\n     * @type {string}\n     */\n    this.stack =\n      legacyCause && options.cause && typeof options.cause.stack === 'string'\n        ? options.cause.stack\n        : ''\n\n    // The following fields are “well known”.\n    // Not standard.\n    // Feel free to add other non-standard fields to your messages.\n\n    /**\n     * Specify the source value that’s being reported, which is deemed\n     * incorrect.\n     *\n     * @type {string | undefined}\n     */\n    this.actual\n\n    /**\n     * Suggest acceptable values that can be used instead of `actual`.\n     *\n     * @type {Array<string> | undefined}\n     */\n    this.expected\n\n    /**\n     * Long form description of the message (you should use markdown).\n     *\n     * @type {string | undefined}\n     */\n    this.note\n\n    /**\n     * Link to docs for the message.\n     *\n     * > 👉 **Note**: this must be an absolute URL that can be passed as `x`\n     * > to `new URL(x)`.\n     *\n     * @type {string | undefined}\n     */\n    this.url\n    /* eslint-enable no-unused-expressions */\n  }\n}\n\nVFileMessage.prototype.file = ''\nVFileMessage.prototype.name = ''\nVFileMessage.prototype.reason = ''\nVFileMessage.prototype.message = ''\nVFileMessage.prototype.stack = ''\nVFileMessage.prototype.column = undefined\nVFileMessage.prototype.line = undefined\nVFileMessage.prototype.ancestors = undefined\nVFileMessage.prototype.cause = undefined\nVFileMessage.prototype.fatal = undefined\nVFileMessage.prototype.place = undefined\nVFileMessage.prototype.ruleId = undefined\nVFileMessage.prototype.source = undefined\n","// Register MDX nodes in mdast:\n/// <reference types=\"mdast-util-mdx-expression\" />\n/// <reference types=\"mdast-util-mdx-jsx\" />\n/// <reference types=\"mdast-util-mdxjs-esm\" />\n\n/**\n * @typedef {import('estree').Identifier} Identifier\n * @typedef {import('estree').Literal} Literal\n * @typedef {import('estree').MemberExpression} MemberExpression\n * @typedef {import('estree').Expression} Expression\n * @typedef {import('estree').Program} Program\n *\n * @typedef {import('hast').Element} Element\n * @typedef {import('hast').Nodes} Nodes\n * @typedef {import('hast').Parents} Parents\n * @typedef {import('hast').Root} Root\n * @typedef {import('hast').Text} Text\n *\n * @typedef {import('mdast-util-mdx-expression').MdxFlowExpressionHast} MdxFlowExpression\n * @typedef {import('mdast-util-mdx-expression').MdxTextExpressionHast} MdxTextExpression\n *\n * @typedef {import('mdast-util-mdx-jsx').MdxJsxFlowElementHast} MdxJsxFlowElement\n * @typedef {import('mdast-util-mdx-jsx').MdxJsxTextElementHast} MdxJsxTextElement\n *\n * @typedef {import('mdast-util-mdxjs-esm').MdxjsEsmHast} MdxjsEsm\n *\n * @typedef {import('property-information').Schema} Schema\n *\n * @typedef {import('unist').Position} Position\n *\n * @typedef {import('./components.js').Components} Components\n */\n\n/**\n * @typedef {JSX.Element | string | null | undefined} Child\n *   Child.\n *\n * @callback Create\n *   Create something in development or production.\n * @param {Nodes} node\n *   hast node.\n * @param {unknown} type\n *   Fragment symbol or tag name.\n * @param {Props} props\n *   Properties and children.\n * @param {string | undefined} key\n *   Key.\n * @returns {JSX.Element}\n *   Result.\n *\n * @callback CreateEvaluater\n *   Create an evaluator that turns ESTree ASTs from embedded MDX into values.\n * @returns {Evaluater}\n *   Evaluater.\n *\n * @typedef {'html' | 'react'} ElementAttributeNameCase\n *   Casing to use for attribute names.\n *\n *   HTML casing is for example `class`, `stroke-linecap`, `xml:lang`.\n *   React casing is for example `className`, `strokeLinecap`, `xmlLang`.\n *\n * @callback EvaluateExpression\n *   Turn an MDX expression into a value.\n * @param {Expression} expression\n *   ESTree expression.\n * @returns {unknown}\n *   Result of expression.\n *\n * @callback EvaluateProgram\n *   Turn an MDX program (export/import statements) into a value.\n * @param {Program} expression\n *   ESTree program.\n * @returns {unknown}\n *   Result of program;\n *   should likely be `undefined` as ESM changes the scope but doesn’t yield\n *   something.\n *\n * @typedef Evaluater\n *   Evaluator that turns ESTree ASTs from embedded MDX into values.\n * @property {EvaluateExpression} evaluateExpression\n *   Evaluate an expression.\n * @property {EvaluateProgram} evaluateProgram\n *   Evaluate a program.\n *\n * @typedef {[string, Value]} Field\n *   Property field.\n *\n * @typedef {unknown} Fragment\n *   Represent the children, typically a symbol.\n *\n * @callback Jsx\n *   Create a production element.\n * @param {unknown} type\n *   Element type: `Fragment` symbol, tag name (`string`), component.\n * @param {Props} props\n *   Element props, `children`, and maybe `node`.\n * @param {string | undefined} [key]\n *   Dynamicly generated key to use.\n * @returns {JSX.Element}\n *   Element from your framework.\n *\n * @callback JsxDev\n *   Create a development element.\n * @param {unknown} type\n *   Element type: `Fragment` symbol, tag name (`string`), component.\n * @param {Props} props\n *   Element props, `children`, and maybe `node`.\n * @param {string | undefined} key\n *   Dynamicly generated key to use.\n * @param {boolean} isStaticChildren\n *   Whether two or more children are passed (in an array), which is whether\n *   `jsxs` or `jsx` would be used.\n * @param {Source} source\n *   Info about source.\n * @param {undefined} self\n *   Nothing (this is used by frameworks that have components, we don’t).\n * @returns {JSX.Element}\n *   Element from your framework.\n *\n * @typedef {{children?: Array<Child> | Child, node?: Element | MdxJsxFlowElement | MdxJsxTextElement | undefined, [prop: string]: Array<Child> | Child | Element | MdxJsxFlowElement | MdxJsxTextElement | Value | undefined}} Props\n *   Properties and children.\n *\n * @typedef RegularFields\n *   Configuration.\n * @property {Partial<Components> | null | undefined} [components]\n *   Components to use (optional).\n * @property {CreateEvaluater | null | undefined} [createEvaluater]\n *   Create an evaluator that turns ESTree ASTs into values (optional).\n * @property {ElementAttributeNameCase | null | undefined} [elementAttributeNameCase='react']\n *   Specify casing to use for attribute names (default: `'react'`).\n * @property {string | null | undefined} [filePath]\n *   File path to the original source file (optional).\n *\n *   Passed in source info to `jsxDEV` when using the automatic runtime with\n *   `development: true`.\n * @property {boolean | null | undefined} [ignoreInvalidStyle=false]\n *   Ignore invalid CSS in `style` props (default: `false`);\n *   the default behavior is to throw an error.\n * @property {boolean | null | undefined} [passKeys=true]\n *   Generate keys to optimize frameworks that support them (default: `true`).\n *\n *   > 👉 **Note**: Solid currently fails if keys are passed.\n * @property {boolean | null | undefined} [passNode=false]\n *   Pass the hast element node to components (default: `false`).\n * @property {Space | null | undefined} [space='html']\n *   Whether `tree` is in the `'html'` or `'svg'` space (default: `'html'`).\n *\n *   When an `<svg>` element is found in the HTML space, this package already\n *   automatically switches to and from the SVG space when entering and exiting\n *   it.\n * @property {StylePropertyNameCase | null | undefined} [stylePropertyNameCase='dom']\n *   Specify casing to use for property names in `style` objects (default:\n *   `'dom'`).\n * @property {boolean | null | undefined} [tableCellAlignToStyle=true]\n *   Turn obsolete `align` props on `td` and `th` into CSS `style` props\n *   (default: `true`).\n *\n * @typedef RuntimeDevelopment\n *   Runtime fields when development is on.\n * @property {Fragment} Fragment\n *   Fragment.\n * @property {true} development\n *   Whether to use `jsxDEV` (when on) or `jsx` and `jsxs` (when off).\n * @property {Jsx | null | undefined} [jsx]\n *   Dynamic JSX (optional).\n * @property {JsxDev} jsxDEV\n *   Development JSX.\n * @property {Jsx | null | undefined} [jsxs]\n *   Static JSX (optional).\n *\n * @typedef RuntimeProduction\n *   Runtime fields when development is off.\n * @property {Fragment} Fragment\n *   Fragment.\n * @property {false | null | undefined} [development]\n *   Whether to use `jsxDEV` (when on) or `jsx` and `jsxs` (when off) (optional).\n * @property {Jsx} jsx\n *   Dynamic JSX.\n * @property {JsxDev | null | undefined} [jsxDEV]\n *   Development JSX (optional).\n * @property {Jsx} jsxs\n *   Static JSX.\n *\n * @typedef RuntimeUnknown\n *   Runtime fields when development might be on or off.\n * @property {Fragment} Fragment\n *   Fragment.\n * @property {boolean} development\n *   Whether to use `jsxDEV` (when on) or `jsx` and `jsxs` (when off).\n * @property {Jsx | null | undefined} [jsx]\n *   Dynamic JSX (optional).\n * @property {JsxDev | null | undefined} [jsxDEV]\n *   Development JSX (optional).\n * @property {Jsx | null | undefined} [jsxs]\n *   Static JSX (optional).\n *\n * @typedef Source\n *   Info about source.\n * @property {number | undefined} columnNumber\n *   Column where thing starts (0-indexed).\n * @property {string | undefined} fileName\n *   Name of source file.\n * @property {number | undefined} lineNumber\n *   Line where thing starts (1-indexed).\n *\n * @typedef {'html' | 'svg'} Space\n *   Namespace.\n *\n *   > 👉 **Note**: hast is not XML.\n *   > It supports SVG as embedded in HTML.\n *   > It does not support the features available in XML.\n *   > Passing SVG might break but fragments of modern SVG should be fine.\n *   > Use `xast` if you need to support SVG as XML.\n *\n * @typedef State\n *   Info passed around.\n * @property {unknown} Fragment\n *   Fragment symbol.\n * @property {Array<Parents>} ancestors\n *   Stack of parents.\n * @property {Partial<Components>} components\n *   Components to swap.\n * @property {Create} create\n *   Create something in development or production.\n * @property {ElementAttributeNameCase} elementAttributeNameCase\n *   Casing to use for attribute names.\n * @property {Evaluater | undefined} evaluater\n *   Evaluator that turns ESTree ASTs into values.\n * @property {string | undefined} filePath\n *   File path.\n * @property {boolean} ignoreInvalidStyle\n *   Ignore invalid CSS in `style` props.\n * @property {boolean} passKeys\n *   Generate keys to optimize frameworks that support them.\n * @property {boolean} passNode\n *   Pass `node` to components.\n * @property {Schema} schema\n *   Current schema.\n * @property {StylePropertyNameCase} stylePropertyNameCase\n *   Casing to use for property names in `style` objects.\n * @property {boolean} tableCellAlignToStyle\n *   Turn obsolete `align` props on `td` and `th` into CSS `style` props.\n *\n * @typedef {Record<string, string>} Style\n *   Style map.\n *\n * @typedef {'css' | 'dom'} StylePropertyNameCase\n *   Casing to use for property names in `style` objects.\n *\n *   CSS casing is for example `background-color` and `-webkit-line-clamp`.\n *   DOM casing is for example `backgroundColor` and `WebkitLineClamp`.\n *\n * @typedef {Style | boolean | number | string} Value\n *   Primitive property value and `Style` map.\n */\n\n/**\n * @typedef {RuntimeDevelopment & RegularFields} Development\n *   Configuration (development).\n * @typedef {Development | Production | Unknown} Options\n *   Configuration.\n * @typedef {RegularFields & RuntimeProduction} Production\n *   Configuration (production).\n * @typedef {RegularFields & RuntimeUnknown} Unknown\n *   Configuration (production or development).\n */\n\nimport {stringify as commas} from 'comma-separated-tokens'\nimport {ok as assert} from 'devlop'\nimport {name as isIdentifierName} from 'estree-util-is-identifier-name'\nimport {whitespace} from 'hast-util-whitespace'\nimport {find, hastToReact, html, svg} from 'property-information'\nimport {stringify as spaces} from 'space-separated-tokens'\nimport styleToObject from 'style-to-object'\nimport {pointStart} from 'unist-util-position'\nimport {VFileMessage} from 'vfile-message'\n\nconst own = {}.hasOwnProperty\n\n/** @type {Map<string, number>} */\nconst emptyMap = new Map()\n\nconst cap = /[A-Z]/g\nconst dashSomething = /-([a-z])/g\n\n// `react-dom` triggers a warning for *any* white space in tables.\n// To follow GFM, `mdast-util-to-hast` injects line endings between elements.\n// Other tools might do so too, but they don’t do here, so we remove all of\n// that.\n\n// See: <https://github.com/facebook/react/pull/7081>.\n// See: <https://github.com/facebook/react/pull/7515>.\n// See: <https://github.com/remarkjs/remark-react/issues/64>.\n// See: <https://github.com/rehypejs/rehype-react/pull/29>.\n// See: <https://github.com/rehypejs/rehype-react/pull/32>.\n// See: <https://github.com/rehypejs/rehype-react/pull/45>.\nconst tableElements = new Set(['table', 'tbody', 'thead', 'tfoot', 'tr'])\n\nconst tableCellElement = new Set(['td', 'th'])\n\nconst docs = 'https://github.com/syntax-tree/hast-util-to-jsx-runtime'\n\n/**\n * Transform a hast tree to preact, react, solid, svelte, vue, etc.,\n * with an automatic JSX runtime.\n *\n * @param {Nodes} tree\n *   Tree to transform.\n * @param {Options} options\n *   Configuration (required).\n * @returns {JSX.Element}\n *   JSX element.\n */\n\nexport function toJsxRuntime(tree, options) {\n  if (!options || options.Fragment === undefined) {\n    throw new TypeError('Expected `Fragment` in options')\n  }\n\n  const filePath = options.filePath || undefined\n  /** @type {Create} */\n  let create\n\n  if (options.development) {\n    if (typeof options.jsxDEV !== 'function') {\n      throw new TypeError(\n        'Expected `jsxDEV` in options when `development: true`'\n      )\n    }\n\n    create = developmentCreate(filePath, options.jsxDEV)\n  } else {\n    if (typeof options.jsx !== 'function') {\n      throw new TypeError('Expected `jsx` in production options')\n    }\n\n    if (typeof options.jsxs !== 'function') {\n      throw new TypeError('Expected `jsxs` in production options')\n    }\n\n    create = productionCreate(filePath, options.jsx, options.jsxs)\n  }\n\n  /** @type {State} */\n  const state = {\n    Fragment: options.Fragment,\n    ancestors: [],\n    components: options.components || {},\n    create,\n    elementAttributeNameCase: options.elementAttributeNameCase || 'react',\n    evaluater: options.createEvaluater ? options.createEvaluater() : undefined,\n    filePath,\n    ignoreInvalidStyle: options.ignoreInvalidStyle || false,\n    passKeys: options.passKeys !== false,\n    passNode: options.passNode || false,\n    schema: options.space === 'svg' ? svg : html,\n    stylePropertyNameCase: options.stylePropertyNameCase || 'dom',\n    tableCellAlignToStyle: options.tableCellAlignToStyle !== false\n  }\n\n  const result = one(state, tree, undefined)\n\n  // JSX element.\n  if (result && typeof result !== 'string') {\n    return result\n  }\n\n  // Text node or something that turned into nothing.\n  return state.create(\n    tree,\n    state.Fragment,\n    {children: result || undefined},\n    undefined\n  )\n}\n\n/**\n * Transform a node.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Nodes} node\n *   Current node.\n * @param {string | undefined} key\n *   Key.\n * @returns {Child | undefined}\n *   Child, optional.\n */\nfunction one(state, node, key) {\n  if (node.type === 'element') {\n    return element(state, node, key)\n  }\n\n  if (node.type === 'mdxFlowExpression' || node.type === 'mdxTextExpression') {\n    return mdxExpression(state, node)\n  }\n\n  if (node.type === 'mdxJsxFlowElement' || node.type === 'mdxJsxTextElement') {\n    return mdxJsxElement(state, node, key)\n  }\n\n  if (node.type === 'mdxjsEsm') {\n    return mdxEsm(state, node)\n  }\n\n  if (node.type === 'root') {\n    return root(state, node, key)\n  }\n\n  if (node.type === 'text') {\n    return text(state, node)\n  }\n}\n\n/**\n * Handle element.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Element} node\n *   Current node.\n * @param {string | undefined} key\n *   Key.\n * @returns {Child | undefined}\n *   Child, optional.\n */\nfunction element(state, node, key) {\n  const parentSchema = state.schema\n  let schema = parentSchema\n\n  if (node.tagName.toLowerCase() === 'svg' && parentSchema.space === 'html') {\n    schema = svg\n    state.schema = schema\n  }\n\n  state.ancestors.push(node)\n\n  const type = findComponentFromName(state, node.tagName, false)\n  const props = createElementProps(state, node)\n  let children = createChildren(state, node)\n\n  if (tableElements.has(node.tagName)) {\n    children = children.filter(function (child) {\n      return typeof child === 'string' ? !whitespace(child) : true\n    })\n  }\n\n  addNode(state, props, type, node)\n  addChildren(props, children)\n\n  // Restore.\n  state.ancestors.pop()\n  state.schema = parentSchema\n\n  return state.create(node, type, props, key)\n}\n\n/**\n * Handle MDX expression.\n *\n * @param {State} state\n *   Info passed around.\n * @param {MdxFlowExpression | MdxTextExpression} node\n *   Current node.\n * @returns {Child | undefined}\n *   Child, optional.\n */\nfunction mdxExpression(state, node) {\n  if (node.data && node.data.estree && state.evaluater) {\n    const program = node.data.estree\n    const expression = program.body[0]\n    assert(expression.type === 'ExpressionStatement')\n\n    // Assume result is a child.\n    return /** @type {Child | undefined} */ (\n      state.evaluater.evaluateExpression(expression.expression)\n    )\n  }\n\n  crashEstree(state, node.position)\n}\n\n/**\n * Handle MDX ESM.\n *\n * @param {State} state\n *   Info passed around.\n * @param {MdxjsEsm} node\n *   Current node.\n * @returns {Child | undefined}\n *   Child, optional.\n */\nfunction mdxEsm(state, node) {\n  if (node.data && node.data.estree && state.evaluater) {\n    // Assume result is a child.\n    return /** @type {Child | undefined} */ (\n      state.evaluater.evaluateProgram(node.data.estree)\n    )\n  }\n\n  crashEstree(state, node.position)\n}\n\n/**\n * Handle MDX JSX.\n *\n * @param {State} state\n *   Info passed around.\n * @param {MdxJsxFlowElement | MdxJsxTextElement} node\n *   Current node.\n * @param {string | undefined} key\n *   Key.\n * @returns {Child | undefined}\n *   Child, optional.\n */\nfunction mdxJsxElement(state, node, key) {\n  const parentSchema = state.schema\n  let schema = parentSchema\n\n  if (node.name === 'svg' && parentSchema.space === 'html') {\n    schema = svg\n    state.schema = schema\n  }\n\n  state.ancestors.push(node)\n\n  const type =\n    node.name === null\n      ? state.Fragment\n      : findComponentFromName(state, node.name, true)\n  const props = createJsxElementProps(state, node)\n  const children = createChildren(state, node)\n\n  addNode(state, props, type, node)\n  addChildren(props, children)\n\n  // Restore.\n  state.ancestors.pop()\n  state.schema = parentSchema\n\n  return state.create(node, type, props, key)\n}\n\n/**\n * Handle root.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Root} node\n *   Current node.\n * @param {string | undefined} key\n *   Key.\n * @returns {Child | undefined}\n *   Child, optional.\n */\nfunction root(state, node, key) {\n  /** @type {Props} */\n  const props = {}\n\n  addChildren(props, createChildren(state, node))\n\n  return state.create(node, state.Fragment, props, key)\n}\n\n/**\n * Handle text.\n *\n * @param {State} _\n *   Info passed around.\n * @param {Text} node\n *   Current node.\n * @returns {Child | undefined}\n *   Child, optional.\n */\nfunction text(_, node) {\n  return node.value\n}\n\n/**\n * Add `node` to props.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Props} props\n *   Props.\n * @param {unknown} type\n *   Type.\n * @param {Element | MdxJsxFlowElement | MdxJsxTextElement} node\n *   Node.\n * @returns {undefined}\n *   Nothing.\n */\nfunction addNode(state, props, type, node) {\n  // If this is swapped out for a component:\n  if (typeof type !== 'string' && type !== state.Fragment && state.passNode) {\n    props.node = node\n  }\n}\n\n/**\n * Add children to props.\n *\n * @param {Props} props\n *   Props.\n * @param {Array<Child>} children\n *   Children.\n * @returns {undefined}\n *   Nothing.\n */\nfunction addChildren(props, children) {\n  if (children.length > 0) {\n    const value = children.length > 1 ? children : children[0]\n\n    if (value) {\n      props.children = value\n    }\n  }\n}\n\n/**\n * @param {string | undefined} _\n *   Path to file.\n * @param {Jsx} jsx\n *   Dynamic.\n * @param {Jsx} jsxs\n *   Static.\n * @returns {Create}\n *   Create a production element.\n */\nfunction productionCreate(_, jsx, jsxs) {\n  return create\n  /** @type {Create} */\n  function create(_, type, props, key) {\n    // Only an array when there are 2 or more children.\n    const isStaticChildren = Array.isArray(props.children)\n    const fn = isStaticChildren ? jsxs : jsx\n    return key ? fn(type, props, key) : fn(type, props)\n  }\n}\n\n/**\n * @param {string | undefined} filePath\n *   Path to file.\n * @param {JsxDev} jsxDEV\n *   Development.\n * @returns {Create}\n *   Create a development element.\n */\nfunction developmentCreate(filePath, jsxDEV) {\n  return create\n  /** @type {Create} */\n  function create(node, type, props, key) {\n    // Only an array when there are 2 or more children.\n    const isStaticChildren = Array.isArray(props.children)\n    const point = pointStart(node)\n    return jsxDEV(\n      type,\n      props,\n      key,\n      isStaticChildren,\n      {\n        columnNumber: point ? point.column - 1 : undefined,\n        fileName: filePath,\n        lineNumber: point ? point.line : undefined\n      },\n      undefined\n    )\n  }\n}\n\n/**\n * Create props from an element.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Element} node\n *   Current element.\n * @returns {Props}\n *   Props.\n */\nfunction createElementProps(state, node) {\n  /** @type {Props} */\n  const props = {}\n  /** @type {string | undefined} */\n  let alignValue\n  /** @type {string} */\n  let prop\n\n  for (prop in node.properties) {\n    if (prop !== 'children' && own.call(node.properties, prop)) {\n      const result = createProperty(state, prop, node.properties[prop])\n\n      if (result) {\n        const [key, value] = result\n\n        if (\n          state.tableCellAlignToStyle &&\n          key === 'align' &&\n          typeof value === 'string' &&\n          tableCellElement.has(node.tagName)\n        ) {\n          alignValue = value\n        } else {\n          props[key] = value\n        }\n      }\n    }\n  }\n\n  if (alignValue) {\n    // Assume style is an object.\n    const style = /** @type {Style} */ (props.style || (props.style = {}))\n    style[state.stylePropertyNameCase === 'css' ? 'text-align' : 'textAlign'] =\n      alignValue\n  }\n\n  return props\n}\n\n/**\n * Create props from a JSX element.\n *\n * @param {State} state\n *   Info passed around.\n * @param {MdxJsxFlowElement | MdxJsxTextElement} node\n *   Current JSX element.\n * @returns {Props}\n *   Props.\n */\nfunction createJsxElementProps(state, node) {\n  /** @type {Props} */\n  const props = {}\n\n  for (const attribute of node.attributes) {\n    if (attribute.type === 'mdxJsxExpressionAttribute') {\n      if (attribute.data && attribute.data.estree && state.evaluater) {\n        const program = attribute.data.estree\n        const expression = program.body[0]\n        assert(expression.type === 'ExpressionStatement')\n        const objectExpression = expression.expression\n        assert(objectExpression.type === 'ObjectExpression')\n        const property = objectExpression.properties[0]\n        assert(property.type === 'SpreadElement')\n\n        Object.assign(\n          props,\n          state.evaluater.evaluateExpression(property.argument)\n        )\n      } else {\n        crashEstree(state, node.position)\n      }\n    } else {\n      // For JSX, the author is responsible of passing in the correct values.\n      const name = attribute.name\n      /** @type {unknown} */\n      let value\n\n      if (attribute.value && typeof attribute.value === 'object') {\n        if (\n          attribute.value.data &&\n          attribute.value.data.estree &&\n          state.evaluater\n        ) {\n          const program = attribute.value.data.estree\n          const expression = program.body[0]\n          assert(expression.type === 'ExpressionStatement')\n          value = state.evaluater.evaluateExpression(expression.expression)\n        } else {\n          crashEstree(state, node.position)\n        }\n      } else {\n        value = attribute.value === null ? true : attribute.value\n      }\n\n      // Assume a prop.\n      props[name] = /** @type {Props[keyof Props]} */ (value)\n    }\n  }\n\n  return props\n}\n\n/**\n * Create children.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Parents} node\n *   Current element.\n * @returns {Array<Child>}\n *   Children.\n */\nfunction createChildren(state, node) {\n  /** @type {Array<Child>} */\n  const children = []\n  let index = -1\n  /** @type {Map<string, number>} */\n  // Note: test this when Solid doesn’t want to merge my upcoming PR.\n  /* c8 ignore next */\n  const countsByName = state.passKeys ? new Map() : emptyMap\n\n  while (++index < node.children.length) {\n    const child = node.children[index]\n    /** @type {string | undefined} */\n    let key\n\n    if (state.passKeys) {\n      const name =\n        child.type === 'element'\n          ? child.tagName\n          : child.type === 'mdxJsxFlowElement' ||\n              child.type === 'mdxJsxTextElement'\n            ? child.name\n            : undefined\n\n      if (name) {\n        const count = countsByName.get(name) || 0\n        key = name + '-' + count\n        countsByName.set(name, count + 1)\n      }\n    }\n\n    const result = one(state, child, key)\n    if (result !== undefined) children.push(result)\n  }\n\n  return children\n}\n\n/**\n * Handle a property.\n *\n * @param {State} state\n *   Info passed around.\n * @param {string} prop\n *   Key.\n * @param {Array<number | string> | boolean | number | string | null | undefined} value\n *   hast property value.\n * @returns {Field | undefined}\n *   Field for runtime, optional.\n */\nfunction createProperty(state, prop, value) {\n  const info = find(state.schema, prop)\n\n  // Ignore nullish and `NaN` values.\n  if (\n    value === null ||\n    value === undefined ||\n    (typeof value === 'number' && Number.isNaN(value))\n  ) {\n    return\n  }\n\n  if (Array.isArray(value)) {\n    // Accept `array`.\n    // Most props are space-separated.\n    value = info.commaSeparated ? commas(value) : spaces(value)\n  }\n\n  // React only accepts `style` as object.\n  if (info.property === 'style') {\n    let styleObject =\n      typeof value === 'object' ? value : parseStyle(state, String(value))\n\n    if (state.stylePropertyNameCase === 'css') {\n      styleObject = transformStylesToCssCasing(styleObject)\n    }\n\n    return ['style', styleObject]\n  }\n\n  return [\n    state.elementAttributeNameCase === 'react' && info.space\n      ? hastToReact[info.property] || info.property\n      : info.attribute,\n    value\n  ]\n}\n\n/**\n * Parse a CSS declaration to an object.\n *\n * @param {State} state\n *   Info passed around.\n * @param {string} value\n *   CSS declarations.\n * @returns {Style}\n *   Properties.\n * @throws\n *   Throws `VFileMessage` when CSS cannot be parsed.\n */\nfunction parseStyle(state, value) {\n  /** @type {Style} */\n  const result = {}\n\n  try {\n    // @ts-expect-error: `style-to-object` types are broken.\n    styleToObject(value, replacer)\n  } catch (error) {\n    if (!state.ignoreInvalidStyle) {\n      const cause = /** @type {Error} */ (error)\n      const message = new VFileMessage('Cannot parse `style` attribute', {\n        ancestors: state.ancestors,\n        cause,\n        ruleId: 'style',\n        source: 'hast-util-to-jsx-runtime'\n      })\n      message.file = state.filePath || undefined\n      message.url = docs + '#cannot-parse-style-attribute'\n\n      throw message\n    }\n  }\n\n  return result\n\n  /**\n   * Add a CSS property (normal, so with dashes) to `result` as a DOM CSS\n   * property.\n   *\n   * @param {string} name\n   *   Key.\n   * @param {string} value\n   *   Value\n   * @returns {undefined}\n   *   Nothing.\n   */\n  function replacer(name, value) {\n    let key = name\n\n    if (key.slice(0, 2) !== '--') {\n      if (key.slice(0, 4) === '-ms-') key = 'ms-' + key.slice(4)\n      key = key.replace(dashSomething, toCamel)\n    }\n\n    result[key] = value\n  }\n}\n\n/**\n * Create a JSX name from a string.\n *\n * @param {State} state\n *   To do.\n * @param {string} name\n *   Name.\n * @param {boolean} allowExpression\n *   Allow member expressions and identifiers.\n * @returns {unknown}\n *   To do.\n */\nfunction findComponentFromName(state, name, allowExpression) {\n  /** @type {Identifier | Literal | MemberExpression} */\n  let result\n\n  if (!allowExpression) {\n    result = {type: 'Literal', value: name}\n  } else if (name.includes('.')) {\n    const identifiers = name.split('.')\n    let index = -1\n    /** @type {Identifier | Literal | MemberExpression | undefined} */\n    let node\n\n    while (++index < identifiers.length) {\n      /** @type {Identifier | Literal} */\n      const prop = isIdentifierName(identifiers[index])\n        ? {type: 'Identifier', name: identifiers[index]}\n        : {type: 'Literal', value: identifiers[index]}\n      node = node\n        ? {\n            type: 'MemberExpression',\n            object: node,\n            property: prop,\n            computed: Boolean(index && prop.type === 'Literal'),\n            optional: false\n          }\n        : prop\n    }\n\n    assert(node, 'always a result')\n    result = node\n  } else {\n    result =\n      isIdentifierName(name) && !/^[a-z]/.test(name)\n        ? {type: 'Identifier', name}\n        : {type: 'Literal', value: name}\n  }\n\n  // Only literals can be passed in `components` currently.\n  // No identifiers / member expressions.\n  if (result.type === 'Literal') {\n    const name = /** @type {keyof JSX.IntrinsicElements} */ (result.value)\n\n    return own.call(state.components, name) ? state.components[name] : name\n  }\n\n  // Assume component.\n  if (state.evaluater) {\n    return state.evaluater.evaluateExpression(result)\n  }\n\n  crashEstree(state)\n}\n\n/**\n * @param {State} state\n * @param {Position | undefined} [place]\n * @returns {never}\n */\nfunction crashEstree(state, place) {\n  const message = new VFileMessage(\n    'Cannot handle MDX estrees without `createEvaluater`',\n    {\n      ancestors: state.ancestors,\n      place,\n      ruleId: 'mdx-estree',\n      source: 'hast-util-to-jsx-runtime'\n    }\n  )\n  message.file = state.filePath || undefined\n  message.url = docs + '#cannot-handle-mdx-estrees-without-createevaluater'\n\n  throw message\n}\n\n/**\n * Transform a DOM casing style object to a CSS casing style object.\n *\n * @param {Style} domCasing\n * @returns {Style}\n */\nfunction transformStylesToCssCasing(domCasing) {\n  /** @type {Style} */\n  const cssCasing = {}\n  /** @type {string} */\n  let from\n\n  for (from in domCasing) {\n    if (own.call(domCasing, from)) {\n      cssCasing[transformStyleToCssCasing(from)] = domCasing[from]\n    }\n  }\n\n  return cssCasing\n}\n\n/**\n * Transform a DOM casing style field to a CSS casing style field.\n *\n * @param {string} from\n * @returns {string}\n */\nfunction transformStyleToCssCasing(from) {\n  let to = from.replace(cap, toDash)\n  // Handle `ms-xxx` -> `-ms-xxx`.\n  if (to.slice(0, 3) === 'ms-') to = '-' + to\n  return to\n}\n\n/**\n * Make `$1` capitalized.\n *\n * @param {string} _\n *   Whatever.\n * @param {string} $1\n *   Single ASCII alphabetical.\n * @returns {string}\n *   Capitalized `$1`.\n */\nfunction toCamel(_, $1) {\n  return $1.toUpperCase()\n}\n\n/**\n * Make `$0` dash cased.\n *\n * @param {string} $0\n *   Capitalized ASCII leter.\n * @returns {string}\n *   Dash and lower letter.\n */\nfunction toDash($0) {\n  return '-' + $0.toLowerCase()\n}\n","/**\n * @typedef Options\n *   Configuration for `stringify`.\n * @property {boolean} [padLeft=true]\n *   Whether to pad a space before a token.\n * @property {boolean} [padRight=false]\n *   Whether to pad a space after a token.\n */\n\n/**\n * @typedef {Options} StringifyOptions\n *   Please use `StringifyOptions` instead.\n */\n\n/**\n * Parse comma-separated tokens to an array.\n *\n * @param {string} value\n *   Comma-separated tokens.\n * @returns {Array<string>}\n *   List of tokens.\n */\nexport function parse(value) {\n  /** @type {Array<string>} */\n  const tokens = []\n  const input = String(value || '')\n  let index = input.indexOf(',')\n  let start = 0\n  /** @type {boolean} */\n  let end = false\n\n  while (!end) {\n    if (index === -1) {\n      index = input.length\n      end = true\n    }\n\n    const token = input.slice(start, index).trim()\n\n    if (token || !end) {\n      tokens.push(token)\n    }\n\n    start = index + 1\n    index = input.indexOf(',', start)\n  }\n\n  return tokens\n}\n\n/**\n * Serialize an array of strings or numbers to comma-separated tokens.\n *\n * @param {Array<string|number>} values\n *   List of tokens.\n * @param {Options} [options]\n *   Configuration for `stringify` (optional).\n * @returns {string}\n *   Comma-separated tokens.\n */\nexport function stringify(values, options) {\n  const settings = options || {}\n\n  // Ensure the last empty entry is seen.\n  const input = values[values.length - 1] === '' ? [...values, ''] : values\n\n  return input\n    .join(\n      (settings.padRight ? ' ' : '') +\n        ',' +\n        (settings.padLeft === false ? '' : ' ')\n    )\n    .trim()\n}\n","/**\n * Parse space-separated tokens to an array of strings.\n *\n * @param {string} value\n *   Space-separated tokens.\n * @returns {Array<string>}\n *   List of tokens.\n */\nexport function parse(value) {\n  const input = String(value || '').trim()\n  return input ? input.split(/[ \\t\\n\\r\\f]+/g) : []\n}\n\n/**\n * Serialize an array of strings as space separated-tokens.\n *\n * @param {Array<string|number>} values\n *   List of tokens.\n * @returns {string}\n *   Space-separated tokens.\n */\nexport function stringify(values) {\n  return values.join(' ').trim()\n}\n","/**\n * HTML URL properties.\n *\n * Each key is a property name and each value is a list of tag names it applies\n * to or `null` if it applies to all elements.\n *\n * @type {Record<string, Array<string> | null>}\n */\nexport const urlAttributes = {\n  action: ['form'],\n  cite: ['blockquote', 'del', 'ins', 'q'],\n  data: ['object'],\n  formAction: ['button', 'input'],\n  href: ['a', 'area', 'base', 'link'],\n  icon: ['menuitem'],\n  itemId: null,\n  manifest: ['html'],\n  ping: ['a', 'area'],\n  poster: ['video'],\n  src: [\n    'audio',\n    'embed',\n    'iframe',\n    'img',\n    'input',\n    'script',\n    'source',\n    'track',\n    'video'\n  ]\n}\n","/**\n * @typedef {import('mdast').Nodes} Nodes\n *\n * @typedef Options\n *   Configuration (optional).\n * @property {boolean | null | undefined} [includeImageAlt=true]\n *   Whether to use `alt` for `image`s (default: `true`).\n * @property {boolean | null | undefined} [includeHtml=true]\n *   Whether to use `value` of HTML (default: `true`).\n */\n\n/** @type {Options} */\nconst emptyOptions = {}\n\n/**\n * Get the text content of a node or list of nodes.\n *\n * Prefers the node’s plain-text fields, otherwise serializes its children,\n * and if the given value is an array, serialize the nodes in it.\n *\n * @param {unknown} [value]\n *   Thing to serialize, typically `Node`.\n * @param {Options | null | undefined} [options]\n *   Configuration (optional).\n * @returns {string}\n *   Serialized `value`.\n */\nexport function toString(value, options) {\n  const settings = options || emptyOptions\n  const includeImageAlt =\n    typeof settings.includeImageAlt === 'boolean'\n      ? settings.includeImageAlt\n      : true\n  const includeHtml =\n    typeof settings.includeHtml === 'boolean' ? settings.includeHtml : true\n\n  return one(value, includeImageAlt, includeHtml)\n}\n\n/**\n * One node or several nodes.\n *\n * @param {unknown} value\n *   Thing to serialize.\n * @param {boolean} includeImageAlt\n *   Include image `alt`s.\n * @param {boolean} includeHtml\n *   Include HTML.\n * @returns {string}\n *   Serialized node.\n */\nfunction one(value, includeImageAlt, includeHtml) {\n  if (node(value)) {\n    if ('value' in value) {\n      return value.type === 'html' && !includeHtml ? '' : value.value\n    }\n\n    if (includeImageAlt && 'alt' in value && value.alt) {\n      return value.alt\n    }\n\n    if ('children' in value) {\n      return all(value.children, includeImageAlt, includeHtml)\n    }\n  }\n\n  if (Array.isArray(value)) {\n    return all(value, includeImageAlt, includeHtml)\n  }\n\n  return ''\n}\n\n/**\n * Serialize a list of nodes.\n *\n * @param {Array<unknown>} values\n *   Thing to serialize.\n * @param {boolean} includeImageAlt\n *   Include image `alt`s.\n * @param {boolean} includeHtml\n *   Include HTML.\n * @returns {string}\n *   Serialized nodes.\n */\nfunction all(values, includeImageAlt, includeHtml) {\n  /** @type {Array<string>} */\n  const result = []\n  let index = -1\n\n  while (++index < values.length) {\n    result[index] = one(values[index], includeImageAlt, includeHtml)\n  }\n\n  return result.join('')\n}\n\n/**\n * Check if `value` looks like a node.\n *\n * @param {unknown} value\n *   Thing.\n * @returns {value is Nodes}\n *   Whether `value` is a node.\n */\nfunction node(value) {\n  return Boolean(value && typeof value === 'object')\n}\n","/**\n * Like `Array#splice`, but smarter for giant arrays.\n *\n * `Array#splice` takes all items to be inserted as individual argument which\n * causes a stack overflow in V8 when trying to insert 100k items for instance.\n *\n * Otherwise, this does not return the removed items, and takes `items` as an\n * array instead of rest parameters.\n *\n * @template {unknown} T\n *   Item type.\n * @param {Array<T>} list\n *   List to operate on.\n * @param {number} start\n *   Index to remove/insert at (can be negative).\n * @param {number} remove\n *   Number of items to remove.\n * @param {Array<T>} items\n *   Items to inject into `list`.\n * @returns {undefined}\n *   Nothing.\n */\nexport function splice(list, start, remove, items) {\n  const end = list.length\n  let chunkStart = 0\n  /** @type {Array<unknown>} */\n  let parameters\n\n  // Make start between zero and `end` (included).\n  if (start < 0) {\n    start = -start > end ? 0 : end + start\n  } else {\n    start = start > end ? end : start\n  }\n  remove = remove > 0 ? remove : 0\n\n  // No need to chunk the items if there’s only a couple (10k) items.\n  if (items.length < 10000) {\n    parameters = Array.from(items)\n    parameters.unshift(start, remove)\n    // @ts-expect-error Hush, it’s fine.\n    list.splice(...parameters)\n  } else {\n    // Delete `remove` items starting from `start`\n    if (remove) list.splice(start, remove)\n\n    // Insert the items in chunks to not cause stack overflows.\n    while (chunkStart < items.length) {\n      parameters = items.slice(chunkStart, chunkStart + 10000)\n      parameters.unshift(start, 0)\n      // @ts-expect-error Hush, it’s fine.\n      list.splice(...parameters)\n      chunkStart += 10000\n      start += 10000\n    }\n  }\n}\n\n/**\n * Append `items` (an array) at the end of `list` (another array).\n * When `list` was empty, returns `items` instead.\n *\n * This prevents a potentially expensive operation when `list` is empty,\n * and adds items in batches to prevent V8 from hanging.\n *\n * @template {unknown} T\n *   Item type.\n * @param {Array<T>} list\n *   List to operate on.\n * @param {Array<T>} items\n *   Items to add to `list`.\n * @returns {Array<T>}\n *   Either `list` or `items`.\n */\nexport function push(list, items) {\n  if (list.length > 0) {\n    splice(list, list.length, 0, items)\n    return list\n  }\n  return items\n}\n","/**\n * Some of the internal operations of micromark do lots of editing\n * operations on very large arrays. This runs into problems with two\n * properties of most circa-2020 JavaScript interpreters:\n *\n *  - Array-length modifications at the high end of an array (push/pop) are\n *    expected to be common and are implemented in (amortized) time\n *    proportional to the number of elements added or removed, whereas\n *    other operations (shift/unshift and splice) are much less efficient.\n *  - Function arguments are passed on the stack, so adding tens of thousands\n *    of elements to an array with `arr.push[...newElements]` will frequently\n *    cause stack overflows. (see <https://stackoverflow.com/questions/22123769/rangeerror-maximum-call-stack-size-exceeded-why>)\n *\n * SpliceBuffers are an implementation of gap buffers, which are a\n * generalization of the \"queue made of two stacks\" idea. The splice buffer\n * maintains a cursor, and moving the cursor has cost proportional to the\n * distance the cursor moves, but inserting, deleting, or splicing in\n * new information at the cursor is as efficient as the push/pop operation.\n * This allows for an efficient sequence of splices (or pushes, pops, shifts,\n * or unshifts) as long such edits happen at the same part of the array or\n * generally sweep through the array from the beginning to the end.\n *\n * The interface for splice buffers also supports large numbers of inputs by\n * passing a single array argument rather passing multiple arguments on the\n * function call stack.\n *\n * @template T\n *   Item type.\n */\nexport class SpliceBuffer {\n  /**\n   * @param {ReadonlyArray<T> | null | undefined} [initial]\n   *   Initial items (optional).\n   * @returns\n   *   Splice buffer.\n   */\n  constructor(initial) {\n    /** @type {Array<T>} */\n    this.left = initial ? [...initial] : [];\n    /** @type {Array<T>} */\n    this.right = [];\n  }\n\n  /**\n   * Array access;\n   * does not move the cursor.\n   *\n   * @param {number} index\n   *   Index.\n   * @return {T}\n   *   Item.\n   */\n  get(index) {\n    if (index < 0 || index >= this.left.length + this.right.length) {\n      throw new RangeError('Cannot access index `' + index + '` in a splice buffer of size `' + (this.left.length + this.right.length) + '`');\n    }\n    if (index < this.left.length) return this.left[index];\n    return this.right[this.right.length - index + this.left.length - 1];\n  }\n\n  /**\n   * The length of the splice buffer, one greater than the largest index in the\n   * array.\n   */\n  get length() {\n    return this.left.length + this.right.length;\n  }\n\n  /**\n   * Remove and return `list[0]`;\n   * moves the cursor to `0`.\n   *\n   * @returns {T | undefined}\n   *   Item, optional.\n   */\n  shift() {\n    this.setCursor(0);\n    return this.right.pop();\n  }\n\n  /**\n   * Slice the buffer to get an array;\n   * does not move the cursor.\n   *\n   * @param {number} start\n   *   Start.\n   * @param {number | null | undefined} [end]\n   *   End (optional).\n   * @returns {Array<T>}\n   *   Array of items.\n   */\n  slice(start, end) {\n    /** @type {number} */\n    const stop = end === null || end === undefined ? Number.POSITIVE_INFINITY : end;\n    if (stop < this.left.length) {\n      return this.left.slice(start, stop);\n    }\n    if (start > this.left.length) {\n      return this.right.slice(this.right.length - stop + this.left.length, this.right.length - start + this.left.length).reverse();\n    }\n    return this.left.slice(start).concat(this.right.slice(this.right.length - stop + this.left.length).reverse());\n  }\n\n  /**\n   * Mimics the behavior of Array.prototype.splice() except for the change of\n   * interface necessary to avoid segfaults when patching in very large arrays.\n   *\n   * This operation moves cursor is moved to `start` and results in the cursor\n   * placed after any inserted items.\n   *\n   * @param {number} start\n   *   Start;\n   *   zero-based index at which to start changing the array;\n   *   negative numbers count backwards from the end of the array and values\n   *   that are out-of bounds are clamped to the appropriate end of the array.\n   * @param {number | null | undefined} [deleteCount=0]\n   *   Delete count (default: `0`);\n   *   maximum number of elements to delete, starting from start.\n   * @param {Array<T> | null | undefined} [items=[]]\n   *   Items to include in place of the deleted items (default: `[]`).\n   * @return {Array<T>}\n   *   Any removed items.\n   */\n  splice(start, deleteCount, items) {\n    /** @type {number} */\n    const count = deleteCount || 0;\n    this.setCursor(Math.trunc(start));\n    const removed = this.right.splice(this.right.length - count, Number.POSITIVE_INFINITY);\n    if (items) chunkedPush(this.left, items);\n    return removed.reverse();\n  }\n\n  /**\n   * Remove and return the highest-numbered item in the array, so\n   * `list[list.length - 1]`;\n   * Moves the cursor to `length`.\n   *\n   * @returns {T | undefined}\n   *   Item, optional.\n   */\n  pop() {\n    this.setCursor(Number.POSITIVE_INFINITY);\n    return this.left.pop();\n  }\n\n  /**\n   * Inserts a single item to the high-numbered side of the array;\n   * moves the cursor to `length`.\n   *\n   * @param {T} item\n   *   Item.\n   * @returns {undefined}\n   *   Nothing.\n   */\n  push(item) {\n    this.setCursor(Number.POSITIVE_INFINITY);\n    this.left.push(item);\n  }\n\n  /**\n   * Inserts many items to the high-numbered side of the array.\n   * Moves the cursor to `length`.\n   *\n   * @param {Array<T>} items\n   *   Items.\n   * @returns {undefined}\n   *   Nothing.\n   */\n  pushMany(items) {\n    this.setCursor(Number.POSITIVE_INFINITY);\n    chunkedPush(this.left, items);\n  }\n\n  /**\n   * Inserts a single item to the low-numbered side of the array;\n   * Moves the cursor to `0`.\n   *\n   * @param {T} item\n   *   Item.\n   * @returns {undefined}\n   *   Nothing.\n   */\n  unshift(item) {\n    this.setCursor(0);\n    this.right.push(item);\n  }\n\n  /**\n   * Inserts many items to the low-numbered side of the array;\n   * moves the cursor to `0`.\n   *\n   * @param {Array<T>} items\n   *   Items.\n   * @returns {undefined}\n   *   Nothing.\n   */\n  unshiftMany(items) {\n    this.setCursor(0);\n    chunkedPush(this.right, items.reverse());\n  }\n\n  /**\n   * Move the cursor to a specific position in the array. Requires\n   * time proportional to the distance moved.\n   *\n   * If `n < 0`, the cursor will end up at the beginning.\n   * If `n > length`, the cursor will end up at the end.\n   *\n   * @param {number} n\n   *   Position.\n   * @return {undefined}\n   *   Nothing.\n   */\n  setCursor(n) {\n    if (n === this.left.length || n > this.left.length && this.right.length === 0 || n < 0 && this.left.length === 0) return;\n    if (n < this.left.length) {\n      // Move cursor to the this.left\n      const removed = this.left.splice(n, Number.POSITIVE_INFINITY);\n      chunkedPush(this.right, removed.reverse());\n    } else {\n      // Move cursor to the this.right\n      const removed = this.right.splice(this.left.length + this.right.length - n, Number.POSITIVE_INFINITY);\n      chunkedPush(this.left, removed.reverse());\n    }\n  }\n}\n\n/**\n * Avoid stack overflow by pushing items onto the stack in segments\n *\n * @template T\n *   Item type.\n * @param {Array<T>} list\n *   List to inject into.\n * @param {ReadonlyArray<T>} right\n *   Items to inject.\n * @return {undefined}\n *   Nothing.\n */\nfunction chunkedPush(list, right) {\n  /** @type {number} */\n  let chunkStart = 0;\n  if (right.length < 10000) {\n    list.push(...right);\n  } else {\n    while (chunkStart < right.length) {\n      list.push(...right.slice(chunkStart, chunkStart + 10000));\n      chunkStart += 10000;\n    }\n  }\n}","/**\n * @typedef {import('micromark-util-types').Chunk} Chunk\n * @typedef {import('micromark-util-types').Event} Event\n * @typedef {import('micromark-util-types').Token} Token\n */\n\nimport { splice } from 'micromark-util-chunked';\nimport { SpliceBuffer } from './lib/splice-buffer.js';\n\n// Hidden API exposed for testing.\nexport { SpliceBuffer } from './lib/splice-buffer.js';\n\n/**\n * Tokenize subcontent.\n *\n * @param {Array<Event>} eventsArray\n *   List of events.\n * @returns {boolean}\n *   Whether subtokens were found.\n */\n// eslint-disable-next-line complexity\nexport function subtokenize(eventsArray) {\n  /** @type {Record<string, number>} */\n  const jumps = {};\n  let index = -1;\n  /** @type {Event} */\n  let event;\n  /** @type {number | undefined} */\n  let lineIndex;\n  /** @type {number} */\n  let otherIndex;\n  /** @type {Event} */\n  let otherEvent;\n  /** @type {Array<Event>} */\n  let parameters;\n  /** @type {Array<Event>} */\n  let subevents;\n  /** @type {boolean | undefined} */\n  let more;\n  const events = new SpliceBuffer(eventsArray);\n  while (++index < events.length) {\n    while (index in jumps) {\n      index = jumps[index];\n    }\n    event = events.get(index);\n\n    // Add a hook for the GFM tasklist extension, which needs to know if text\n    // is in the first content of a list item.\n    if (index && event[1].type === \"chunkFlow\" && events.get(index - 1)[1].type === \"listItemPrefix\") {\n      subevents = event[1]._tokenizer.events;\n      otherIndex = 0;\n      if (otherIndex < subevents.length && subevents[otherIndex][1].type === \"lineEndingBlank\") {\n        otherIndex += 2;\n      }\n      if (otherIndex < subevents.length && subevents[otherIndex][1].type === \"content\") {\n        while (++otherIndex < subevents.length) {\n          if (subevents[otherIndex][1].type === \"content\") {\n            break;\n          }\n          if (subevents[otherIndex][1].type === \"chunkText\") {\n            subevents[otherIndex][1]._isInFirstContentOfListItem = true;\n            otherIndex++;\n          }\n        }\n      }\n    }\n\n    // Enter.\n    if (event[0] === 'enter') {\n      if (event[1].contentType) {\n        Object.assign(jumps, subcontent(events, index));\n        index = jumps[index];\n        more = true;\n      }\n    }\n    // Exit.\n    else if (event[1]._container) {\n      otherIndex = index;\n      lineIndex = undefined;\n      while (otherIndex--) {\n        otherEvent = events.get(otherIndex);\n        if (otherEvent[1].type === \"lineEnding\" || otherEvent[1].type === \"lineEndingBlank\") {\n          if (otherEvent[0] === 'enter') {\n            if (lineIndex) {\n              events.get(lineIndex)[1].type = \"lineEndingBlank\";\n            }\n            otherEvent[1].type = \"lineEnding\";\n            lineIndex = otherIndex;\n          }\n        } else {\n          break;\n        }\n      }\n      if (lineIndex) {\n        // Fix position.\n        event[1].end = Object.assign({}, events.get(lineIndex)[1].start);\n\n        // Switch container exit w/ line endings.\n        parameters = events.slice(lineIndex, index);\n        parameters.unshift(event);\n        events.splice(lineIndex, index - lineIndex + 1, parameters);\n      }\n    }\n  }\n\n  // The changes to the `events` buffer must be copied back into the eventsArray\n  splice(eventsArray, 0, Number.POSITIVE_INFINITY, events.slice(0));\n  return !more;\n}\n\n/**\n * Tokenize embedded tokens.\n *\n * @param {SpliceBuffer<Event>} events\n * @param {number} eventIndex\n * @returns {Record<string, number>}\n */\nfunction subcontent(events, eventIndex) {\n  const token = events.get(eventIndex)[1];\n  const context = events.get(eventIndex)[2];\n  let startPosition = eventIndex - 1;\n  /** @type {Array<number>} */\n  const startPositions = [];\n  const tokenizer = token._tokenizer || context.parser[token.contentType](token.start);\n  const childEvents = tokenizer.events;\n  /** @type {Array<[number, number]>} */\n  const jumps = [];\n  /** @type {Record<string, number>} */\n  const gaps = {};\n  /** @type {Array<Chunk>} */\n  let stream;\n  /** @type {Token | undefined} */\n  let previous;\n  let index = -1;\n  /** @type {Token | undefined} */\n  let current = token;\n  let adjust = 0;\n  let start = 0;\n  const breaks = [start];\n\n  // Loop forward through the linked tokens to pass them in order to the\n  // subtokenizer.\n  while (current) {\n    // Find the position of the event for this token.\n    while (events.get(++startPosition)[1] !== current) {\n      // Empty.\n    }\n    startPositions.push(startPosition);\n    if (!current._tokenizer) {\n      stream = context.sliceStream(current);\n      if (!current.next) {\n        stream.push(null);\n      }\n      if (previous) {\n        tokenizer.defineSkip(current.start);\n      }\n      if (current._isInFirstContentOfListItem) {\n        tokenizer._gfmTasklistFirstContentOfListItem = true;\n      }\n      tokenizer.write(stream);\n      if (current._isInFirstContentOfListItem) {\n        tokenizer._gfmTasklistFirstContentOfListItem = undefined;\n      }\n    }\n\n    // Unravel the next token.\n    previous = current;\n    current = current.next;\n  }\n\n  // Now, loop back through all events (and linked tokens), to figure out which\n  // parts belong where.\n  current = token;\n  while (++index < childEvents.length) {\n    if (\n    // Find a void token that includes a break.\n    childEvents[index][0] === 'exit' && childEvents[index - 1][0] === 'enter' && childEvents[index][1].type === childEvents[index - 1][1].type && childEvents[index][1].start.line !== childEvents[index][1].end.line) {\n      start = index + 1;\n      breaks.push(start);\n      // Help GC.\n      current._tokenizer = undefined;\n      current.previous = undefined;\n      current = current.next;\n    }\n  }\n\n  // Help GC.\n  tokenizer.events = [];\n\n  // If there’s one more token (which is the cases for lines that end in an\n  // EOF), that’s perfect: the last point we found starts it.\n  // If there isn’t then make sure any remaining content is added to it.\n  if (current) {\n    // Help GC.\n    current._tokenizer = undefined;\n    current.previous = undefined;\n  } else {\n    breaks.pop();\n  }\n\n  // Now splice the events from the subtokenizer into the current events,\n  // moving back to front so that splice indices aren’t affected.\n  index = breaks.length;\n  while (index--) {\n    const slice = childEvents.slice(breaks[index], breaks[index + 1]);\n    const start = startPositions.pop();\n    jumps.push([start, start + slice.length - 1]);\n    events.splice(start, 2, slice);\n  }\n  jumps.reverse();\n  index = -1;\n  while (++index < jumps.length) {\n    gaps[adjust + jumps[index][0]] = adjust + jumps[index][1];\n    adjust += jumps[index][1] - jumps[index][0] - 1;\n  }\n  return gaps;\n}","/**\n * @typedef {import('micromark-util-types').Extension} Extension\n * @typedef {import('micromark-util-types').Handles} Handles\n * @typedef {import('micromark-util-types').HtmlExtension} HtmlExtension\n * @typedef {import('micromark-util-types').NormalizedExtension} NormalizedExtension\n */\n\nimport {splice} from 'micromark-util-chunked'\n\nconst hasOwnProperty = {}.hasOwnProperty\n\n/**\n * Combine multiple syntax extensions into one.\n *\n * @param {Array<Extension>} extensions\n *   List of syntax extensions.\n * @returns {NormalizedExtension}\n *   A single combined extension.\n */\nexport function combineExtensions(extensions) {\n  /** @type {NormalizedExtension} */\n  const all = {}\n  let index = -1\n\n  while (++index < extensions.length) {\n    syntaxExtension(all, extensions[index])\n  }\n\n  return all\n}\n\n/**\n * Merge `extension` into `all`.\n *\n * @param {NormalizedExtension} all\n *   Extension to merge into.\n * @param {Extension} extension\n *   Extension to merge.\n * @returns {undefined}\n */\nfunction syntaxExtension(all, extension) {\n  /** @type {keyof Extension} */\n  let hook\n\n  for (hook in extension) {\n    const maybe = hasOwnProperty.call(all, hook) ? all[hook] : undefined\n    /** @type {Record<string, unknown>} */\n    const left = maybe || (all[hook] = {})\n    /** @type {Record<string, unknown> | undefined} */\n    const right = extension[hook]\n    /** @type {string} */\n    let code\n\n    if (right) {\n      for (code in right) {\n        if (!hasOwnProperty.call(left, code)) left[code] = []\n        const value = right[code]\n        constructs(\n          // @ts-expect-error Looks like a list.\n          left[code],\n          Array.isArray(value) ? value : value ? [value] : []\n        )\n      }\n    }\n  }\n}\n\n/**\n * Merge `list` into `existing` (both lists of constructs).\n * Mutates `existing`.\n *\n * @param {Array<unknown>} existing\n * @param {Array<unknown>} list\n * @returns {undefined}\n */\nfunction constructs(existing, list) {\n  let index = -1\n  /** @type {Array<unknown>} */\n  const before = []\n\n  while (++index < list.length) {\n    // @ts-expect-error Looks like an object.\n    ;(list[index].add === 'after' ? existing : before).push(list[index])\n  }\n\n  splice(existing, 0, 0, before)\n}\n\n/**\n * Combine multiple HTML extensions into one.\n *\n * @param {Array<HtmlExtension>} htmlExtensions\n *   List of HTML extensions.\n * @returns {HtmlExtension}\n *   A single combined HTML extension.\n */\nexport function combineHtmlExtensions(htmlExtensions) {\n  /** @type {HtmlExtension} */\n  const handlers = {}\n  let index = -1\n\n  while (++index < htmlExtensions.length) {\n    htmlExtension(handlers, htmlExtensions[index])\n  }\n\n  return handlers\n}\n\n/**\n * Merge `extension` into `all`.\n *\n * @param {HtmlExtension} all\n *   Extension to merge into.\n * @param {HtmlExtension} extension\n *   Extension to merge.\n * @returns {undefined}\n */\nfunction htmlExtension(all, extension) {\n  /** @type {keyof HtmlExtension} */\n  let hook\n\n  for (hook in extension) {\n    const maybe = hasOwnProperty.call(all, hook) ? all[hook] : undefined\n    const left = maybe || (all[hook] = {})\n    const right = extension[hook]\n    /** @type {keyof Handles} */\n    let type\n\n    if (right) {\n      for (type in right) {\n        // @ts-expect-error assume document vs regular handler are managed correctly.\n        left[type] = right[type]\n      }\n    }\n  }\n}\n","/**\n * @typedef {import('micromark-util-types').Code} Code\n */\n\n/**\n * Check whether the character code represents an ASCII alpha (`a` through `z`,\n * case insensitive).\n *\n * An **ASCII alpha** is an ASCII upper alpha or ASCII lower alpha.\n *\n * An **ASCII upper alpha** is a character in the inclusive range U+0041 (`A`)\n * to U+005A (`Z`).\n *\n * An **ASCII lower alpha** is a character in the inclusive range U+0061 (`a`)\n * to U+007A (`z`).\n *\n * @param code\n *   Code.\n * @returns {boolean}\n *   Whether it matches.\n */\nexport const asciiAlpha = regexCheck(/[A-Za-z]/);\n\n/**\n * Check whether the character code represents an ASCII alphanumeric (`a`\n * through `z`, case insensitive, or `0` through `9`).\n *\n * An **ASCII alphanumeric** is an ASCII digit (see `asciiDigit`) or ASCII alpha\n * (see `asciiAlpha`).\n *\n * @param code\n *   Code.\n * @returns {boolean}\n *   Whether it matches.\n */\nexport const asciiAlphanumeric = regexCheck(/[\\dA-Za-z]/);\n\n/**\n * Check whether the character code represents an ASCII atext.\n *\n * atext is an ASCII alphanumeric (see `asciiAlphanumeric`), or a character in\n * the inclusive ranges U+0023 NUMBER SIGN (`#`) to U+0027 APOSTROPHE (`'`),\n * U+002A ASTERISK (`*`), U+002B PLUS SIGN (`+`), U+002D DASH (`-`), U+002F\n * SLASH (`/`), U+003D EQUALS TO (`=`), U+003F QUESTION MARK (`?`), U+005E\n * CARET (`^`) to U+0060 GRAVE ACCENT (`` ` ``), or U+007B LEFT CURLY BRACE\n * (`{`) to U+007E TILDE (`~`).\n *\n * See:\n * **\\[RFC5322]**:\n * [Internet Message Format](https://tools.ietf.org/html/rfc5322).\n * P. Resnick.\n * IETF.\n *\n * @param code\n *   Code.\n * @returns {boolean}\n *   Whether it matches.\n */\nexport const asciiAtext = regexCheck(/[#-'*+\\--9=?A-Z^-~]/);\n\n/**\n * Check whether a character code is an ASCII control character.\n *\n * An **ASCII control** is a character in the inclusive range U+0000 NULL (NUL)\n * to U+001F (US), or U+007F (DEL).\n *\n * @param {Code} code\n *   Code.\n * @returns {boolean}\n *   Whether it matches.\n */\nexport function asciiControl(code) {\n  return (\n    // Special whitespace codes (which have negative values), C0 and Control\n    // character DEL\n    code !== null && (code < 32 || code === 127)\n  );\n}\n\n/**\n * Check whether the character code represents an ASCII digit (`0` through `9`).\n *\n * An **ASCII digit** is a character in the inclusive range U+0030 (`0`) to\n * U+0039 (`9`).\n *\n * @param code\n *   Code.\n * @returns {boolean}\n *   Whether it matches.\n */\nexport const asciiDigit = regexCheck(/\\d/);\n\n/**\n * Check whether the character code represents an ASCII hex digit (`a` through\n * `f`, case insensitive, or `0` through `9`).\n *\n * An **ASCII hex digit** is an ASCII digit (see `asciiDigit`), ASCII upper hex\n * digit, or an ASCII lower hex digit.\n *\n * An **ASCII upper hex digit** is a character in the inclusive range U+0041\n * (`A`) to U+0046 (`F`).\n *\n * An **ASCII lower hex digit** is a character in the inclusive range U+0061\n * (`a`) to U+0066 (`f`).\n *\n * @param code\n *   Code.\n * @returns {boolean}\n *   Whether it matches.\n */\nexport const asciiHexDigit = regexCheck(/[\\dA-Fa-f]/);\n\n/**\n * Check whether the character code represents ASCII punctuation.\n *\n * An **ASCII punctuation** is a character in the inclusive ranges U+0021\n * EXCLAMATION MARK (`!`) to U+002F SLASH (`/`), U+003A COLON (`:`) to U+0040 AT\n * SIGN (`@`), U+005B LEFT SQUARE BRACKET (`[`) to U+0060 GRAVE ACCENT\n * (`` ` ``), or U+007B LEFT CURLY BRACE (`{`) to U+007E TILDE (`~`).\n *\n * @param code\n *   Code.\n * @returns {boolean}\n *   Whether it matches.\n */\nexport const asciiPunctuation = regexCheck(/[!-/:-@[-`{-~]/);\n\n/**\n * Check whether a character code is a markdown line ending.\n *\n * A **markdown line ending** is the virtual characters M-0003 CARRIAGE RETURN\n * LINE FEED (CRLF), M-0004 LINE FEED (LF) and M-0005 CARRIAGE RETURN (CR).\n *\n * In micromark, the actual character U+000A LINE FEED (LF) and U+000D CARRIAGE\n * RETURN (CR) are replaced by these virtual characters depending on whether\n * they occurred together.\n *\n * @param {Code} code\n *   Code.\n * @returns {boolean}\n *   Whether it matches.\n */\nexport function markdownLineEnding(code) {\n  return code !== null && code < -2;\n}\n\n/**\n * Check whether a character code is a markdown line ending (see\n * `markdownLineEnding`) or markdown space (see `markdownSpace`).\n *\n * @param {Code} code\n *   Code.\n * @returns {boolean}\n *   Whether it matches.\n */\nexport function markdownLineEndingOrSpace(code) {\n  return code !== null && (code < 0 || code === 32);\n}\n\n/**\n * Check whether a character code is a markdown space.\n *\n * A **markdown space** is the concrete character U+0020 SPACE (SP) and the\n * virtual characters M-0001 VIRTUAL SPACE (VS) and M-0002 HORIZONTAL TAB (HT).\n *\n * In micromark, the actual character U+0009 CHARACTER TABULATION (HT) is\n * replaced by one M-0002 HORIZONTAL TAB (HT) and between 0 and 3 M-0001 VIRTUAL\n * SPACE (VS) characters, depending on the column at which the tab occurred.\n *\n * @param {Code} code\n *   Code.\n * @returns {boolean}\n *   Whether it matches.\n */\nexport function markdownSpace(code) {\n  return code === -2 || code === -1 || code === 32;\n}\n\n// Size note: removing ASCII from the regex and using `asciiPunctuation` here\n// In fact adds to the bundle size.\n/**\n * Check whether the character code represents Unicode punctuation.\n *\n * A **Unicode punctuation** is a character in the Unicode `Pc` (Punctuation,\n * Connector), `Pd` (Punctuation, Dash), `Pe` (Punctuation, Close), `Pf`\n * (Punctuation, Final quote), `Pi` (Punctuation, Initial quote), `Po`\n * (Punctuation, Other), or `Ps` (Punctuation, Open) categories, or an ASCII\n * punctuation (see `asciiPunctuation`).\n *\n * See:\n * **\\[UNICODE]**:\n * [The Unicode Standard](https://www.unicode.org/versions/).\n * Unicode Consortium.\n *\n * @param code\n *   Code.\n * @returns\n *   Whether it matches.\n */\nexport const unicodePunctuation = regexCheck(/\\p{P}|\\p{S}/u);\n\n/**\n * Check whether the character code represents Unicode whitespace.\n *\n * Note that this does handle micromark specific markdown whitespace characters.\n * See `markdownLineEndingOrSpace` to check that.\n *\n * A **Unicode whitespace** is a character in the Unicode `Zs` (Separator,\n * Space) category, or U+0009 CHARACTER TABULATION (HT), U+000A LINE FEED (LF),\n * U+000C (FF), or U+000D CARRIAGE RETURN (CR) (**\\[UNICODE]**).\n *\n * See:\n * **\\[UNICODE]**:\n * [The Unicode Standard](https://www.unicode.org/versions/).\n * Unicode Consortium.\n *\n * @param code\n *   Code.\n * @returns\n *   Whether it matches.\n */\nexport const unicodeWhitespace = regexCheck(/\\s/);\n\n/**\n * Create a code check from a regex.\n *\n * @param {RegExp} regex\n * @returns {(code: Code) => boolean}\n */\nfunction regexCheck(regex) {\n  return check;\n\n  /**\n   * Check whether a code matches the bound regex.\n   *\n   * @param {Code} code\n   *   Character code.\n   * @returns {boolean}\n   *   Whether the character code matches the bound regex.\n   */\n  function check(code) {\n    return code !== null && code > -1 && regex.test(String.fromCharCode(code));\n  }\n}","/**\n * @typedef {import('micromark-util-types').Effects} Effects\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenType} TokenType\n */\n\nimport {markdownSpace} from 'micromark-util-character'\n\n// To do: implement `spaceOrTab`, `spaceOrTabMinMax`, `spaceOrTabWithOptions`.\n\n/**\n * Parse spaces and tabs.\n *\n * There is no `nok` parameter:\n *\n * *   spaces in markdown are often optional, in which case this factory can be\n *     used and `ok` will be switched to whether spaces were found or not\n * *   one line ending or space can be detected with `markdownSpace(code)` right\n *     before using `factorySpace`\n *\n * ###### Examples\n *\n * Where `␉` represents a tab (plus how much it expands) and `␠` represents a\n * single space.\n *\n * ```markdown\n * ␉\n * ␠␠␠␠\n * ␉␠\n * ```\n *\n * @param {Effects} effects\n *   Context.\n * @param {State} ok\n *   State switched to when successful.\n * @param {TokenType} type\n *   Type (`' \\t'`).\n * @param {number | undefined} [max=Infinity]\n *   Max (exclusive).\n * @returns {State}\n *   Start state.\n */\nexport function factorySpace(effects, ok, type, max) {\n  const limit = max ? max - 1 : Number.POSITIVE_INFINITY\n  let size = 0\n  return start\n\n  /** @type {State} */\n  function start(code) {\n    if (markdownSpace(code)) {\n      effects.enter(type)\n      return prefix(code)\n    }\n    return ok(code)\n  }\n\n  /** @type {State} */\n  function prefix(code) {\n    if (markdownSpace(code) && size++ < limit) {\n      effects.consume(code)\n      return prefix\n    }\n    effects.exit(type)\n    return ok(code)\n  }\n}\n","/**\n * @typedef {import('micromark-util-types').InitialConstruct} InitialConstruct\n * @typedef {import('micromark-util-types').Initializer} Initializer\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').Token} Token\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n */\n\nimport {factorySpace} from 'micromark-factory-space'\nimport {markdownLineEnding} from 'micromark-util-character'\n/** @type {InitialConstruct} */\nexport const content = {\n  tokenize: initializeContent\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Initializer}\n */\nfunction initializeContent(effects) {\n  const contentStart = effects.attempt(\n    this.parser.constructs.contentInitial,\n    afterContentStartConstruct,\n    paragraphInitial\n  )\n  /** @type {Token} */\n  let previous\n  return contentStart\n\n  /** @type {State} */\n  function afterContentStartConstruct(code) {\n    if (code === null) {\n      effects.consume(code)\n      return\n    }\n    effects.enter('lineEnding')\n    effects.consume(code)\n    effects.exit('lineEnding')\n    return factorySpace(effects, contentStart, 'linePrefix')\n  }\n\n  /** @type {State} */\n  function paragraphInitial(code) {\n    effects.enter('paragraph')\n    return lineStart(code)\n  }\n\n  /** @type {State} */\n  function lineStart(code) {\n    const token = effects.enter('chunkText', {\n      contentType: 'text',\n      previous\n    })\n    if (previous) {\n      previous.next = token\n    }\n    previous = token\n    return data(code)\n  }\n\n  /** @type {State} */\n  function data(code) {\n    if (code === null) {\n      effects.exit('chunkText')\n      effects.exit('paragraph')\n      effects.consume(code)\n      return\n    }\n    if (markdownLineEnding(code)) {\n      effects.consume(code)\n      effects.exit('chunkText')\n      return lineStart\n    }\n\n    // Data.\n    effects.consume(code)\n    return data\n  }\n}\n","/**\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').ContainerState} ContainerState\n * @typedef {import('micromark-util-types').InitialConstruct} InitialConstruct\n * @typedef {import('micromark-util-types').Initializer} Initializer\n * @typedef {import('micromark-util-types').Point} Point\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').Token} Token\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\n/**\n * @typedef {[Construct, ContainerState]} StackItem\n */\n\nimport {factorySpace} from 'micromark-factory-space'\nimport {markdownLineEnding} from 'micromark-util-character'\nimport {splice} from 'micromark-util-chunked'\n/** @type {InitialConstruct} */\nexport const document = {\n  tokenize: initializeDocument\n}\n\n/** @type {Construct} */\nconst containerConstruct = {\n  tokenize: tokenizeContainer\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Initializer}\n */\nfunction initializeDocument(effects) {\n  const self = this\n  /** @type {Array<StackItem>} */\n  const stack = []\n  let continued = 0\n  /** @type {TokenizeContext | undefined} */\n  let childFlow\n  /** @type {Token | undefined} */\n  let childToken\n  /** @type {number} */\n  let lineStartOffset\n  return start\n\n  /** @type {State} */\n  function start(code) {\n    // First we iterate through the open blocks, starting with the root\n    // document, and descending through last children down to the last open\n    // block.\n    // Each block imposes a condition that the line must satisfy if the block is\n    // to remain open.\n    // For example, a block quote requires a `>` character.\n    // A paragraph requires a non-blank line.\n    // In this phase we may match all or just some of the open blocks.\n    // But we cannot close unmatched blocks yet, because we may have a lazy\n    // continuation line.\n    if (continued < stack.length) {\n      const item = stack[continued]\n      self.containerState = item[1]\n      return effects.attempt(\n        item[0].continuation,\n        documentContinue,\n        checkNewContainers\n      )(code)\n    }\n\n    // Done.\n    return checkNewContainers(code)\n  }\n\n  /** @type {State} */\n  function documentContinue(code) {\n    continued++\n\n    // Note: this field is called `_closeFlow` but it also closes containers.\n    // Perhaps a good idea to rename it but it’s already used in the wild by\n    // extensions.\n    if (self.containerState._closeFlow) {\n      self.containerState._closeFlow = undefined\n      if (childFlow) {\n        closeFlow()\n      }\n\n      // Note: this algorithm for moving events around is similar to the\n      // algorithm when dealing with lazy lines in `writeToChild`.\n      const indexBeforeExits = self.events.length\n      let indexBeforeFlow = indexBeforeExits\n      /** @type {Point | undefined} */\n      let point\n\n      // Find the flow chunk.\n      while (indexBeforeFlow--) {\n        if (\n          self.events[indexBeforeFlow][0] === 'exit' &&\n          self.events[indexBeforeFlow][1].type === 'chunkFlow'\n        ) {\n          point = self.events[indexBeforeFlow][1].end\n          break\n        }\n      }\n      exitContainers(continued)\n\n      // Fix positions.\n      let index = indexBeforeExits\n      while (index < self.events.length) {\n        self.events[index][1].end = Object.assign({}, point)\n        index++\n      }\n\n      // Inject the exits earlier (they’re still also at the end).\n      splice(\n        self.events,\n        indexBeforeFlow + 1,\n        0,\n        self.events.slice(indexBeforeExits)\n      )\n\n      // Discard the duplicate exits.\n      self.events.length = index\n      return checkNewContainers(code)\n    }\n    return start(code)\n  }\n\n  /** @type {State} */\n  function checkNewContainers(code) {\n    // Next, after consuming the continuation markers for existing blocks, we\n    // look for new block starts (e.g. `>` for a block quote).\n    // If we encounter a new block start, we close any blocks unmatched in\n    // step 1 before creating the new block as a child of the last matched\n    // block.\n    if (continued === stack.length) {\n      // No need to `check` whether there’s a container, of `exitContainers`\n      // would be moot.\n      // We can instead immediately `attempt` to parse one.\n      if (!childFlow) {\n        return documentContinued(code)\n      }\n\n      // If we have concrete content, such as block HTML or fenced code,\n      // we can’t have containers “pierce” into them, so we can immediately\n      // start.\n      if (childFlow.currentConstruct && childFlow.currentConstruct.concrete) {\n        return flowStart(code)\n      }\n\n      // If we do have flow, it could still be a blank line,\n      // but we’d be interrupting it w/ a new container if there’s a current\n      // construct.\n      // To do: next major: remove `_gfmTableDynamicInterruptHack` (no longer\n      // needed in micromark-extension-gfm-table@1.0.6).\n      self.interrupt = Boolean(\n        childFlow.currentConstruct && !childFlow._gfmTableDynamicInterruptHack\n      )\n    }\n\n    // Check if there is a new container.\n    self.containerState = {}\n    return effects.check(\n      containerConstruct,\n      thereIsANewContainer,\n      thereIsNoNewContainer\n    )(code)\n  }\n\n  /** @type {State} */\n  function thereIsANewContainer(code) {\n    if (childFlow) closeFlow()\n    exitContainers(continued)\n    return documentContinued(code)\n  }\n\n  /** @type {State} */\n  function thereIsNoNewContainer(code) {\n    self.parser.lazy[self.now().line] = continued !== stack.length\n    lineStartOffset = self.now().offset\n    return flowStart(code)\n  }\n\n  /** @type {State} */\n  function documentContinued(code) {\n    // Try new containers.\n    self.containerState = {}\n    return effects.attempt(\n      containerConstruct,\n      containerContinue,\n      flowStart\n    )(code)\n  }\n\n  /** @type {State} */\n  function containerContinue(code) {\n    continued++\n    stack.push([self.currentConstruct, self.containerState])\n    // Try another.\n    return documentContinued(code)\n  }\n\n  /** @type {State} */\n  function flowStart(code) {\n    if (code === null) {\n      if (childFlow) closeFlow()\n      exitContainers(0)\n      effects.consume(code)\n      return\n    }\n    childFlow = childFlow || self.parser.flow(self.now())\n    effects.enter('chunkFlow', {\n      contentType: 'flow',\n      previous: childToken,\n      _tokenizer: childFlow\n    })\n    return flowContinue(code)\n  }\n\n  /** @type {State} */\n  function flowContinue(code) {\n    if (code === null) {\n      writeToChild(effects.exit('chunkFlow'), true)\n      exitContainers(0)\n      effects.consume(code)\n      return\n    }\n    if (markdownLineEnding(code)) {\n      effects.consume(code)\n      writeToChild(effects.exit('chunkFlow'))\n      // Get ready for the next line.\n      continued = 0\n      self.interrupt = undefined\n      return start\n    }\n    effects.consume(code)\n    return flowContinue\n  }\n\n  /**\n   * @param {Token} token\n   * @param {boolean | undefined} [eof]\n   * @returns {undefined}\n   */\n  function writeToChild(token, eof) {\n    const stream = self.sliceStream(token)\n    if (eof) stream.push(null)\n    token.previous = childToken\n    if (childToken) childToken.next = token\n    childToken = token\n    childFlow.defineSkip(token.start)\n    childFlow.write(stream)\n\n    // Alright, so we just added a lazy line:\n    //\n    // ```markdown\n    // > a\n    // b.\n    //\n    // Or:\n    //\n    // > ~~~c\n    // d\n    //\n    // Or:\n    //\n    // > | e |\n    // f\n    // ```\n    //\n    // The construct in the second example (fenced code) does not accept lazy\n    // lines, so it marked itself as done at the end of its first line, and\n    // then the content construct parses `d`.\n    // Most constructs in markdown match on the first line: if the first line\n    // forms a construct, a non-lazy line can’t “unmake” it.\n    //\n    // The construct in the third example is potentially a GFM table, and\n    // those are *weird*.\n    // It *could* be a table, from the first line, if the following line\n    // matches a condition.\n    // In this case, that second line is lazy, which “unmakes” the first line\n    // and turns the whole into one content block.\n    //\n    // We’ve now parsed the non-lazy and the lazy line, and can figure out\n    // whether the lazy line started a new flow block.\n    // If it did, we exit the current containers between the two flow blocks.\n    if (self.parser.lazy[token.start.line]) {\n      let index = childFlow.events.length\n      while (index--) {\n        if (\n          // The token starts before the line ending…\n          childFlow.events[index][1].start.offset < lineStartOffset &&\n          // …and either is not ended yet…\n          (!childFlow.events[index][1].end ||\n            // …or ends after it.\n            childFlow.events[index][1].end.offset > lineStartOffset)\n        ) {\n          // Exit: there’s still something open, which means it’s a lazy line\n          // part of something.\n          return\n        }\n      }\n\n      // Note: this algorithm for moving events around is similar to the\n      // algorithm when closing flow in `documentContinue`.\n      const indexBeforeExits = self.events.length\n      let indexBeforeFlow = indexBeforeExits\n      /** @type {boolean | undefined} */\n      let seen\n      /** @type {Point | undefined} */\n      let point\n\n      // Find the previous chunk (the one before the lazy line).\n      while (indexBeforeFlow--) {\n        if (\n          self.events[indexBeforeFlow][0] === 'exit' &&\n          self.events[indexBeforeFlow][1].type === 'chunkFlow'\n        ) {\n          if (seen) {\n            point = self.events[indexBeforeFlow][1].end\n            break\n          }\n          seen = true\n        }\n      }\n      exitContainers(continued)\n\n      // Fix positions.\n      index = indexBeforeExits\n      while (index < self.events.length) {\n        self.events[index][1].end = Object.assign({}, point)\n        index++\n      }\n\n      // Inject the exits earlier (they’re still also at the end).\n      splice(\n        self.events,\n        indexBeforeFlow + 1,\n        0,\n        self.events.slice(indexBeforeExits)\n      )\n\n      // Discard the duplicate exits.\n      self.events.length = index\n    }\n  }\n\n  /**\n   * @param {number} size\n   * @returns {undefined}\n   */\n  function exitContainers(size) {\n    let index = stack.length\n\n    // Exit open containers.\n    while (index-- > size) {\n      const entry = stack[index]\n      self.containerState = entry[1]\n      entry[0].exit.call(self, effects)\n    }\n    stack.length = size\n  }\n  function closeFlow() {\n    childFlow.write([null])\n    childToken = undefined\n    childFlow = undefined\n    self.containerState._closeFlow = undefined\n  }\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeContainer(effects, ok, nok) {\n  // Always populated by defaults.\n\n  return factorySpace(\n    effects,\n    effects.attempt(this.parser.constructs.document, ok, nok),\n    'linePrefix',\n    this.parser.constructs.disable.null.includes('codeIndented') ? undefined : 4\n  )\n}\n","/**\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { factorySpace } from 'micromark-factory-space';\nimport { markdownLineEnding, markdownSpace } from 'micromark-util-character';\n/** @type {Construct} */\nexport const blankLine = {\n  tokenize: tokenizeBlankLine,\n  partial: true\n};\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeBlankLine(effects, ok, nok) {\n  return start;\n\n  /**\n   * Start of blank line.\n   *\n   * > 👉 **Note**: `␠` represents a space character.\n   *\n   * ```markdown\n   * > | ␠␠␊\n   *     ^\n   * > | ␊\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    return markdownSpace(code) ? factorySpace(effects, after, \"linePrefix\")(code) : after(code);\n  }\n\n  /**\n   * At eof/eol, after optional whitespace.\n   *\n   * > 👉 **Note**: `␠` represents a space character.\n   *\n   * ```markdown\n   * > | ␠␠␊\n   *       ^\n   * > | ␊\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function after(code) {\n    return code === null || markdownLineEnding(code) ? ok(code) : nok(code);\n  }\n}","/**\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').Resolver} Resolver\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').Token} Token\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { factorySpace } from 'micromark-factory-space';\nimport { markdownLineEnding } from 'micromark-util-character';\nimport { subtokenize } from 'micromark-util-subtokenize';\n/**\n * No name because it must not be turned off.\n * @type {Construct}\n */\nexport const content = {\n  tokenize: tokenizeContent,\n  resolve: resolveContent\n};\n\n/** @type {Construct} */\nconst continuationConstruct = {\n  tokenize: tokenizeContinuation,\n  partial: true\n};\n\n/**\n * Content is transparent: it’s parsed right now. That way, definitions are also\n * parsed right now: before text in paragraphs (specifically, media) are parsed.\n *\n * @type {Resolver}\n */\nfunction resolveContent(events) {\n  subtokenize(events);\n  return events;\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeContent(effects, ok) {\n  /** @type {Token | undefined} */\n  let previous;\n  return chunkStart;\n\n  /**\n   * Before a content chunk.\n   *\n   * ```markdown\n   * > | abc\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function chunkStart(code) {\n    effects.enter(\"content\");\n    previous = effects.enter(\"chunkContent\", {\n      contentType: \"content\"\n    });\n    return chunkInside(code);\n  }\n\n  /**\n   * In a content chunk.\n   *\n   * ```markdown\n   * > | abc\n   *     ^^^\n   * ```\n   *\n   * @type {State}\n   */\n  function chunkInside(code) {\n    if (code === null) {\n      return contentEnd(code);\n    }\n\n    // To do: in `markdown-rs`, each line is parsed on its own, and everything\n    // is stitched together resolving.\n    if (markdownLineEnding(code)) {\n      return effects.check(continuationConstruct, contentContinue, contentEnd)(code);\n    }\n\n    // Data.\n    effects.consume(code);\n    return chunkInside;\n  }\n\n  /**\n   *\n   *\n   * @type {State}\n   */\n  function contentEnd(code) {\n    effects.exit(\"chunkContent\");\n    effects.exit(\"content\");\n    return ok(code);\n  }\n\n  /**\n   *\n   *\n   * @type {State}\n   */\n  function contentContinue(code) {\n    effects.consume(code);\n    effects.exit(\"chunkContent\");\n    previous.next = effects.enter(\"chunkContent\", {\n      contentType: \"content\",\n      previous\n    });\n    previous = previous.next;\n    return chunkInside;\n  }\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeContinuation(effects, ok, nok) {\n  const self = this;\n  return startLookahead;\n\n  /**\n   *\n   *\n   * @type {State}\n   */\n  function startLookahead(code) {\n    effects.exit(\"chunkContent\");\n    effects.enter(\"lineEnding\");\n    effects.consume(code);\n    effects.exit(\"lineEnding\");\n    return factorySpace(effects, prefixed, \"linePrefix\");\n  }\n\n  /**\n   *\n   *\n   * @type {State}\n   */\n  function prefixed(code) {\n    if (code === null || markdownLineEnding(code)) {\n      return nok(code);\n    }\n\n    // Always populated by defaults.\n\n    const tail = self.events[self.events.length - 1];\n    if (!self.parser.constructs.disable.null.includes('codeIndented') && tail && tail[1].type === \"linePrefix\" && tail[2].sliceSerialize(tail[1], true).length >= 4) {\n      return ok(code);\n    }\n    return effects.interrupt(self.parser.constructs.flow, nok, ok)(code);\n  }\n}","/**\n * @typedef {import('micromark-util-types').InitialConstruct} InitialConstruct\n * @typedef {import('micromark-util-types').Initializer} Initializer\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n */\n\nimport {blankLine, content} from 'micromark-core-commonmark'\nimport {factorySpace} from 'micromark-factory-space'\nimport {markdownLineEnding} from 'micromark-util-character'\n/** @type {InitialConstruct} */\nexport const flow = {\n  tokenize: initializeFlow\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Initializer}\n */\nfunction initializeFlow(effects) {\n  const self = this\n  const initial = effects.attempt(\n    // Try to parse a blank line.\n    blankLine,\n    atBlankEnding,\n    // Try to parse initial flow (essentially, only code).\n    effects.attempt(\n      this.parser.constructs.flowInitial,\n      afterConstruct,\n      factorySpace(\n        effects,\n        effects.attempt(\n          this.parser.constructs.flow,\n          afterConstruct,\n          effects.attempt(content, afterConstruct)\n        ),\n        'linePrefix'\n      )\n    )\n  )\n  return initial\n\n  /** @type {State} */\n  function atBlankEnding(code) {\n    if (code === null) {\n      effects.consume(code)\n      return\n    }\n    effects.enter('lineEndingBlank')\n    effects.consume(code)\n    effects.exit('lineEndingBlank')\n    self.currentConstruct = undefined\n    return initial\n  }\n\n  /** @type {State} */\n  function afterConstruct(code) {\n    if (code === null) {\n      effects.consume(code)\n      return\n    }\n    effects.enter('lineEnding')\n    effects.consume(code)\n    effects.exit('lineEnding')\n    self.currentConstruct = undefined\n    return initial\n  }\n}\n","/**\n * @typedef {import('micromark-util-types').Code} Code\n * @typedef {import('micromark-util-types').InitialConstruct} InitialConstruct\n * @typedef {import('micromark-util-types').Initializer} Initializer\n * @typedef {import('micromark-util-types').Resolver} Resolver\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n */\n\nexport const resolver = {\n  resolveAll: createResolver()\n}\nexport const string = initializeFactory('string')\nexport const text = initializeFactory('text')\n\n/**\n * @param {'string' | 'text'} field\n * @returns {InitialConstruct}\n */\nfunction initializeFactory(field) {\n  return {\n    tokenize: initializeText,\n    resolveAll: createResolver(\n      field === 'text' ? resolveAllLineSuffixes : undefined\n    )\n  }\n\n  /**\n   * @this {TokenizeContext}\n   * @type {Initializer}\n   */\n  function initializeText(effects) {\n    const self = this\n    const constructs = this.parser.constructs[field]\n    const text = effects.attempt(constructs, start, notText)\n    return start\n\n    /** @type {State} */\n    function start(code) {\n      return atBreak(code) ? text(code) : notText(code)\n    }\n\n    /** @type {State} */\n    function notText(code) {\n      if (code === null) {\n        effects.consume(code)\n        return\n      }\n      effects.enter('data')\n      effects.consume(code)\n      return data\n    }\n\n    /** @type {State} */\n    function data(code) {\n      if (atBreak(code)) {\n        effects.exit('data')\n        return text(code)\n      }\n\n      // Data.\n      effects.consume(code)\n      return data\n    }\n\n    /**\n     * @param {Code} code\n     * @returns {boolean}\n     */\n    function atBreak(code) {\n      if (code === null) {\n        return true\n      }\n      const list = constructs[code]\n      let index = -1\n      if (list) {\n        // Always populated by defaults.\n\n        while (++index < list.length) {\n          const item = list[index]\n          if (!item.previous || item.previous.call(self, self.previous)) {\n            return true\n          }\n        }\n      }\n      return false\n    }\n  }\n}\n\n/**\n * @param {Resolver | undefined} [extraResolver]\n * @returns {Resolver}\n */\nfunction createResolver(extraResolver) {\n  return resolveAllText\n\n  /** @type {Resolver} */\n  function resolveAllText(events, context) {\n    let index = -1\n    /** @type {number | undefined} */\n    let enter\n\n    // A rather boring computation (to merge adjacent `data` events) which\n    // improves mm performance by 29%.\n    while (++index <= events.length) {\n      if (enter === undefined) {\n        if (events[index] && events[index][1].type === 'data') {\n          enter = index\n          index++\n        }\n      } else if (!events[index] || events[index][1].type !== 'data') {\n        // Don’t do anything if there is one data token.\n        if (index !== enter + 2) {\n          events[enter][1].end = events[index - 1][1].end\n          events.splice(enter + 2, index - enter - 2)\n          index = enter + 2\n        }\n        enter = undefined\n      }\n    }\n    return extraResolver ? extraResolver(events, context) : events\n  }\n}\n\n/**\n * A rather ugly set of instructions which again looks at chunks in the input\n * stream.\n * The reason to do this here is that it is *much* faster to parse in reverse.\n * And that we can’t hook into `null` to split the line suffix before an EOF.\n * To do: figure out if we can make this into a clean utility, or even in core.\n * As it will be useful for GFMs literal autolink extension (and maybe even\n * tables?)\n *\n * @type {Resolver}\n */\nfunction resolveAllLineSuffixes(events, context) {\n  let eventIndex = 0 // Skip first.\n\n  while (++eventIndex <= events.length) {\n    if (\n      (eventIndex === events.length ||\n        events[eventIndex][1].type === 'lineEnding') &&\n      events[eventIndex - 1][1].type === 'data'\n    ) {\n      const data = events[eventIndex - 1][1]\n      const chunks = context.sliceStream(data)\n      let index = chunks.length\n      let bufferIndex = -1\n      let size = 0\n      /** @type {boolean | undefined} */\n      let tabs\n      while (index--) {\n        const chunk = chunks[index]\n        if (typeof chunk === 'string') {\n          bufferIndex = chunk.length\n          while (chunk.charCodeAt(bufferIndex - 1) === 32) {\n            size++\n            bufferIndex--\n          }\n          if (bufferIndex) break\n          bufferIndex = -1\n        }\n        // Number\n        else if (chunk === -2) {\n          tabs = true\n          size++\n        } else if (chunk === -1) {\n          // Empty\n        } else {\n          // Replacement character, exit.\n          index++\n          break\n        }\n      }\n      if (size) {\n        const token = {\n          type:\n            eventIndex === events.length || tabs || size < 2\n              ? 'lineSuffix'\n              : 'hardBreakTrailing',\n          start: {\n            line: data.end.line,\n            column: data.end.column - size,\n            offset: data.end.offset - size,\n            _index: data.start._index + index,\n            _bufferIndex: index\n              ? bufferIndex\n              : data.start._bufferIndex + bufferIndex\n          },\n          end: Object.assign({}, data.end)\n        }\n        data.end = Object.assign({}, token.start)\n        if (data.start.offset === data.end.offset) {\n          Object.assign(data, token)\n        } else {\n          events.splice(\n            eventIndex,\n            0,\n            ['enter', token, context],\n            ['exit', token, context]\n          )\n          eventIndex += 2\n        }\n      }\n      eventIndex++\n    }\n  }\n  return events\n}\n","/**\n * @typedef {import('micromark-util-types').Event} Event\n * @typedef {import('micromark-util-types').Resolver} Resolver\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n */\n\n/**\n * Call all `resolveAll`s.\n *\n * @param {Array<{resolveAll?: Resolver | undefined}>} constructs\n *   List of constructs, optionally with `resolveAll`s.\n * @param {Array<Event>} events\n *   List of events.\n * @param {TokenizeContext} context\n *   Context used by `tokenize`.\n * @returns {Array<Event>}\n *   Changed events.\n */\nexport function resolveAll(constructs, events, context) {\n  /** @type {Array<Resolver>} */\n  const called = []\n  let index = -1\n\n  while (++index < constructs.length) {\n    const resolve = constructs[index].resolveAll\n\n    if (resolve && !called.includes(resolve)) {\n      events = resolve(events, context)\n      called.push(resolve)\n    }\n  }\n\n  return events\n}\n","/**\n * @typedef {import('micromark-util-types').Chunk} Chunk\n * @typedef {import('micromark-util-types').Code} Code\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').ConstructRecord} ConstructRecord\n * @typedef {import('micromark-util-types').Effects} Effects\n * @typedef {import('micromark-util-types').InitialConstruct} InitialConstruct\n * @typedef {import('micromark-util-types').ParseContext} ParseContext\n * @typedef {import('micromark-util-types').Point} Point\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').Token} Token\n * @typedef {import('micromark-util-types').TokenType} TokenType\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n */\n\n/**\n * @callback Restore\n * @returns {undefined}\n *\n * @typedef Info\n * @property {Restore} restore\n * @property {number} from\n *\n * @callback ReturnHandle\n *   Handle a successful run.\n * @param {Construct} construct\n * @param {Info} info\n * @returns {undefined}\n */\n\nimport {markdownLineEnding} from 'micromark-util-character'\nimport {push, splice} from 'micromark-util-chunked'\nimport {resolveAll} from 'micromark-util-resolve-all'\n/**\n * Create a tokenizer.\n * Tokenizers deal with one type of data (e.g., containers, flow, text).\n * The parser is the object dealing with it all.\n * `initialize` works like other constructs, except that only its `tokenize`\n * function is used, in which case it doesn’t receive an `ok` or `nok`.\n * `from` can be given to set the point before the first character, although\n * when further lines are indented, they must be set with `defineSkip`.\n *\n * @param {ParseContext} parser\n * @param {InitialConstruct} initialize\n * @param {Omit<Point, '_bufferIndex' | '_index'> | undefined} [from]\n * @returns {TokenizeContext}\n */\nexport function createTokenizer(parser, initialize, from) {\n  /** @type {Point} */\n  let point = Object.assign(\n    from\n      ? Object.assign({}, from)\n      : {\n          line: 1,\n          column: 1,\n          offset: 0\n        },\n    {\n      _index: 0,\n      _bufferIndex: -1\n    }\n  )\n  /** @type {Record<string, number>} */\n  const columnStart = {}\n  /** @type {Array<Construct>} */\n  const resolveAllConstructs = []\n  /** @type {Array<Chunk>} */\n  let chunks = []\n  /** @type {Array<Token>} */\n  let stack = []\n  /** @type {boolean | undefined} */\n  let consumed = true\n\n  /**\n   * Tools used for tokenizing.\n   *\n   * @type {Effects}\n   */\n  const effects = {\n    consume,\n    enter,\n    exit,\n    attempt: constructFactory(onsuccessfulconstruct),\n    check: constructFactory(onsuccessfulcheck),\n    interrupt: constructFactory(onsuccessfulcheck, {\n      interrupt: true\n    })\n  }\n\n  /**\n   * State and tools for resolving and serializing.\n   *\n   * @type {TokenizeContext}\n   */\n  const context = {\n    previous: null,\n    code: null,\n    containerState: {},\n    events: [],\n    parser,\n    sliceStream,\n    sliceSerialize,\n    now,\n    defineSkip,\n    write\n  }\n\n  /**\n   * The state function.\n   *\n   * @type {State | undefined}\n   */\n  let state = initialize.tokenize.call(context, effects)\n\n  /**\n   * Track which character we expect to be consumed, to catch bugs.\n   *\n   * @type {Code}\n   */\n  let expectedCode\n  if (initialize.resolveAll) {\n    resolveAllConstructs.push(initialize)\n  }\n  return context\n\n  /** @type {TokenizeContext['write']} */\n  function write(slice) {\n    chunks = push(chunks, slice)\n    main()\n\n    // Exit if we’re not done, resolve might change stuff.\n    if (chunks[chunks.length - 1] !== null) {\n      return []\n    }\n    addResult(initialize, 0)\n\n    // Otherwise, resolve, and exit.\n    context.events = resolveAll(resolveAllConstructs, context.events, context)\n    return context.events\n  }\n\n  //\n  // Tools.\n  //\n\n  /** @type {TokenizeContext['sliceSerialize']} */\n  function sliceSerialize(token, expandTabs) {\n    return serializeChunks(sliceStream(token), expandTabs)\n  }\n\n  /** @type {TokenizeContext['sliceStream']} */\n  function sliceStream(token) {\n    return sliceChunks(chunks, token)\n  }\n\n  /** @type {TokenizeContext['now']} */\n  function now() {\n    // This is a hot path, so we clone manually instead of `Object.assign({}, point)`\n    const {line, column, offset, _index, _bufferIndex} = point\n    return {\n      line,\n      column,\n      offset,\n      _index,\n      _bufferIndex\n    }\n  }\n\n  /** @type {TokenizeContext['defineSkip']} */\n  function defineSkip(value) {\n    columnStart[value.line] = value.column\n    accountForPotentialSkip()\n  }\n\n  //\n  // State management.\n  //\n\n  /**\n   * Main loop (note that `_index` and `_bufferIndex` in `point` are modified by\n   * `consume`).\n   * Here is where we walk through the chunks, which either include strings of\n   * several characters, or numerical character codes.\n   * The reason to do this in a loop instead of a call is so the stack can\n   * drain.\n   *\n   * @returns {undefined}\n   */\n  function main() {\n    /** @type {number} */\n    let chunkIndex\n    while (point._index < chunks.length) {\n      const chunk = chunks[point._index]\n\n      // If we’re in a buffer chunk, loop through it.\n      if (typeof chunk === 'string') {\n        chunkIndex = point._index\n        if (point._bufferIndex < 0) {\n          point._bufferIndex = 0\n        }\n        while (\n          point._index === chunkIndex &&\n          point._bufferIndex < chunk.length\n        ) {\n          go(chunk.charCodeAt(point._bufferIndex))\n        }\n      } else {\n        go(chunk)\n      }\n    }\n  }\n\n  /**\n   * Deal with one code.\n   *\n   * @param {Code} code\n   * @returns {undefined}\n   */\n  function go(code) {\n    consumed = undefined\n    expectedCode = code\n    state = state(code)\n  }\n\n  /** @type {Effects['consume']} */\n  function consume(code) {\n    if (markdownLineEnding(code)) {\n      point.line++\n      point.column = 1\n      point.offset += code === -3 ? 2 : 1\n      accountForPotentialSkip()\n    } else if (code !== -1) {\n      point.column++\n      point.offset++\n    }\n\n    // Not in a string chunk.\n    if (point._bufferIndex < 0) {\n      point._index++\n    } else {\n      point._bufferIndex++\n\n      // At end of string chunk.\n      // @ts-expect-error Points w/ non-negative `_bufferIndex` reference\n      // strings.\n      if (point._bufferIndex === chunks[point._index].length) {\n        point._bufferIndex = -1\n        point._index++\n      }\n    }\n\n    // Expose the previous character.\n    context.previous = code\n\n    // Mark as consumed.\n    consumed = true\n  }\n\n  /** @type {Effects['enter']} */\n  function enter(type, fields) {\n    /** @type {Token} */\n    // @ts-expect-error Patch instead of assign required fields to help GC.\n    const token = fields || {}\n    token.type = type\n    token.start = now()\n    context.events.push(['enter', token, context])\n    stack.push(token)\n    return token\n  }\n\n  /** @type {Effects['exit']} */\n  function exit(type) {\n    const token = stack.pop()\n    token.end = now()\n    context.events.push(['exit', token, context])\n    return token\n  }\n\n  /**\n   * Use results.\n   *\n   * @type {ReturnHandle}\n   */\n  function onsuccessfulconstruct(construct, info) {\n    addResult(construct, info.from)\n  }\n\n  /**\n   * Discard results.\n   *\n   * @type {ReturnHandle}\n   */\n  function onsuccessfulcheck(_, info) {\n    info.restore()\n  }\n\n  /**\n   * Factory to attempt/check/interrupt.\n   *\n   * @param {ReturnHandle} onreturn\n   * @param {{interrupt?: boolean | undefined} | undefined} [fields]\n   */\n  function constructFactory(onreturn, fields) {\n    return hook\n\n    /**\n     * Handle either an object mapping codes to constructs, a list of\n     * constructs, or a single construct.\n     *\n     * @param {Array<Construct> | Construct | ConstructRecord} constructs\n     * @param {State} returnState\n     * @param {State | undefined} [bogusState]\n     * @returns {State}\n     */\n    function hook(constructs, returnState, bogusState) {\n      /** @type {Array<Construct>} */\n      let listOfConstructs\n      /** @type {number} */\n      let constructIndex\n      /** @type {Construct} */\n      let currentConstruct\n      /** @type {Info} */\n      let info\n      return Array.isArray(constructs) /* c8 ignore next 1 */\n        ? handleListOfConstructs(constructs)\n        : 'tokenize' in constructs\n        ? // @ts-expect-error Looks like a construct.\n          handleListOfConstructs([constructs])\n        : handleMapOfConstructs(constructs)\n\n      /**\n       * Handle a list of construct.\n       *\n       * @param {ConstructRecord} map\n       * @returns {State}\n       */\n      function handleMapOfConstructs(map) {\n        return start\n\n        /** @type {State} */\n        function start(code) {\n          const def = code !== null && map[code]\n          const all = code !== null && map.null\n          const list = [\n            // To do: add more extension tests.\n            /* c8 ignore next 2 */\n            ...(Array.isArray(def) ? def : def ? [def] : []),\n            ...(Array.isArray(all) ? all : all ? [all] : [])\n          ]\n          return handleListOfConstructs(list)(code)\n        }\n      }\n\n      /**\n       * Handle a list of construct.\n       *\n       * @param {Array<Construct>} list\n       * @returns {State}\n       */\n      function handleListOfConstructs(list) {\n        listOfConstructs = list\n        constructIndex = 0\n        if (list.length === 0) {\n          return bogusState\n        }\n        return handleConstruct(list[constructIndex])\n      }\n\n      /**\n       * Handle a single construct.\n       *\n       * @param {Construct} construct\n       * @returns {State}\n       */\n      function handleConstruct(construct) {\n        return start\n\n        /** @type {State} */\n        function start(code) {\n          // To do: not needed to store if there is no bogus state, probably?\n          // Currently doesn’t work because `inspect` in document does a check\n          // w/o a bogus, which doesn’t make sense. But it does seem to help perf\n          // by not storing.\n          info = store()\n          currentConstruct = construct\n          if (!construct.partial) {\n            context.currentConstruct = construct\n          }\n\n          // Always populated by defaults.\n\n          if (\n            construct.name &&\n            context.parser.constructs.disable.null.includes(construct.name)\n          ) {\n            return nok(code)\n          }\n          return construct.tokenize.call(\n            // If we do have fields, create an object w/ `context` as its\n            // prototype.\n            // This allows a “live binding”, which is needed for `interrupt`.\n            fields ? Object.assign(Object.create(context), fields) : context,\n            effects,\n            ok,\n            nok\n          )(code)\n        }\n      }\n\n      /** @type {State} */\n      function ok(code) {\n        consumed = true\n        onreturn(currentConstruct, info)\n        return returnState\n      }\n\n      /** @type {State} */\n      function nok(code) {\n        consumed = true\n        info.restore()\n        if (++constructIndex < listOfConstructs.length) {\n          return handleConstruct(listOfConstructs[constructIndex])\n        }\n        return bogusState\n      }\n    }\n  }\n\n  /**\n   * @param {Construct} construct\n   * @param {number} from\n   * @returns {undefined}\n   */\n  function addResult(construct, from) {\n    if (construct.resolveAll && !resolveAllConstructs.includes(construct)) {\n      resolveAllConstructs.push(construct)\n    }\n    if (construct.resolve) {\n      splice(\n        context.events,\n        from,\n        context.events.length - from,\n        construct.resolve(context.events.slice(from), context)\n      )\n    }\n    if (construct.resolveTo) {\n      context.events = construct.resolveTo(context.events, context)\n    }\n  }\n\n  /**\n   * Store state.\n   *\n   * @returns {Info}\n   */\n  function store() {\n    const startPoint = now()\n    const startPrevious = context.previous\n    const startCurrentConstruct = context.currentConstruct\n    const startEventsIndex = context.events.length\n    const startStack = Array.from(stack)\n    return {\n      restore,\n      from: startEventsIndex\n    }\n\n    /**\n     * Restore state.\n     *\n     * @returns {undefined}\n     */\n    function restore() {\n      point = startPoint\n      context.previous = startPrevious\n      context.currentConstruct = startCurrentConstruct\n      context.events.length = startEventsIndex\n      stack = startStack\n      accountForPotentialSkip()\n    }\n  }\n\n  /**\n   * Move the current point a bit forward in the line when it’s on a column\n   * skip.\n   *\n   * @returns {undefined}\n   */\n  function accountForPotentialSkip() {\n    if (point.line in columnStart && point.column < 2) {\n      point.column = columnStart[point.line]\n      point.offset += columnStart[point.line] - 1\n    }\n  }\n}\n\n/**\n * Get the chunks from a slice of chunks in the range of a token.\n *\n * @param {Array<Chunk>} chunks\n * @param {Pick<Token, 'end' | 'start'>} token\n * @returns {Array<Chunk>}\n */\nfunction sliceChunks(chunks, token) {\n  const startIndex = token.start._index\n  const startBufferIndex = token.start._bufferIndex\n  const endIndex = token.end._index\n  const endBufferIndex = token.end._bufferIndex\n  /** @type {Array<Chunk>} */\n  let view\n  if (startIndex === endIndex) {\n    // @ts-expect-error `_bufferIndex` is used on string chunks.\n    view = [chunks[startIndex].slice(startBufferIndex, endBufferIndex)]\n  } else {\n    view = chunks.slice(startIndex, endIndex)\n    if (startBufferIndex > -1) {\n      const head = view[0]\n      if (typeof head === 'string') {\n        view[0] = head.slice(startBufferIndex)\n      } else {\n        view.shift()\n      }\n    }\n    if (endBufferIndex > 0) {\n      // @ts-expect-error `_bufferIndex` is used on string chunks.\n      view.push(chunks[endIndex].slice(0, endBufferIndex))\n    }\n  }\n  return view\n}\n\n/**\n * Get the string value of a slice of chunks.\n *\n * @param {Array<Chunk>} chunks\n * @param {boolean | undefined} [expandTabs=false]\n * @returns {string}\n */\nfunction serializeChunks(chunks, expandTabs) {\n  let index = -1\n  /** @type {Array<string>} */\n  const result = []\n  /** @type {boolean | undefined} */\n  let atTab\n  while (++index < chunks.length) {\n    const chunk = chunks[index]\n    /** @type {string} */\n    let value\n    if (typeof chunk === 'string') {\n      value = chunk\n    } else\n      switch (chunk) {\n        case -5: {\n          value = '\\r'\n          break\n        }\n        case -4: {\n          value = '\\n'\n          break\n        }\n        case -3: {\n          value = '\\r' + '\\n'\n          break\n        }\n        case -2: {\n          value = expandTabs ? ' ' : '\\t'\n          break\n        }\n        case -1: {\n          if (!expandTabs && atTab) continue\n          value = ' '\n          break\n        }\n        default: {\n          // Currently only replacement character.\n          value = String.fromCharCode(chunk)\n        }\n      }\n    atTab = chunk === -2\n    result.push(value)\n  }\n  return result.join('')\n}\n","/**\n * @typedef {import('micromark-util-types').Code} Code\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { factorySpace } from 'micromark-factory-space';\nimport { markdownLineEnding, markdownSpace } from 'micromark-util-character';\n/** @type {Construct} */\nexport const thematicBreak = {\n  name: 'thematicBreak',\n  tokenize: tokenizeThematicBreak\n};\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeThematicBreak(effects, ok, nok) {\n  let size = 0;\n  /** @type {NonNullable<Code>} */\n  let marker;\n  return start;\n\n  /**\n   * Start of thematic break.\n   *\n   * ```markdown\n   * > | ***\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    effects.enter(\"thematicBreak\");\n    // To do: parse indent like `markdown-rs`.\n    return before(code);\n  }\n\n  /**\n   * After optional whitespace, at marker.\n   *\n   * ```markdown\n   * > | ***\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function before(code) {\n    marker = code;\n    return atBreak(code);\n  }\n\n  /**\n   * After something, before something else.\n   *\n   * ```markdown\n   * > | ***\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function atBreak(code) {\n    if (code === marker) {\n      effects.enter(\"thematicBreakSequence\");\n      return sequence(code);\n    }\n    if (size >= 3 && (code === null || markdownLineEnding(code))) {\n      effects.exit(\"thematicBreak\");\n      return ok(code);\n    }\n    return nok(code);\n  }\n\n  /**\n   * In sequence.\n   *\n   * ```markdown\n   * > | ***\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function sequence(code) {\n    if (code === marker) {\n      effects.consume(code);\n      size++;\n      return sequence;\n    }\n    effects.exit(\"thematicBreakSequence\");\n    return markdownSpace(code) ? factorySpace(effects, atBreak, \"whitespace\")(code) : atBreak(code);\n  }\n}","/**\n * @typedef {import('micromark-util-types').Code} Code\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').ContainerState} ContainerState\n * @typedef {import('micromark-util-types').Exiter} Exiter\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { factorySpace } from 'micromark-factory-space';\nimport { asciiDigit, markdownSpace } from 'micromark-util-character';\nimport { blankLine } from './blank-line.js';\nimport { thematicBreak } from './thematic-break.js';\n\n/** @type {Construct} */\nexport const list = {\n  name: 'list',\n  tokenize: tokenizeListStart,\n  continuation: {\n    tokenize: tokenizeListContinuation\n  },\n  exit: tokenizeListEnd\n};\n\n/** @type {Construct} */\nconst listItemPrefixWhitespaceConstruct = {\n  tokenize: tokenizeListItemPrefixWhitespace,\n  partial: true\n};\n\n/** @type {Construct} */\nconst indentConstruct = {\n  tokenize: tokenizeIndent,\n  partial: true\n};\n\n// To do: `markdown-rs` parses list items on their own and later stitches them\n// together.\n\n/**\n * @type {Tokenizer}\n * @this {TokenizeContext}\n */\nfunction tokenizeListStart(effects, ok, nok) {\n  const self = this;\n  const tail = self.events[self.events.length - 1];\n  let initialSize = tail && tail[1].type === \"linePrefix\" ? tail[2].sliceSerialize(tail[1], true).length : 0;\n  let size = 0;\n  return start;\n\n  /** @type {State} */\n  function start(code) {\n    const kind = self.containerState.type || (code === 42 || code === 43 || code === 45 ? \"listUnordered\" : \"listOrdered\");\n    if (kind === \"listUnordered\" ? !self.containerState.marker || code === self.containerState.marker : asciiDigit(code)) {\n      if (!self.containerState.type) {\n        self.containerState.type = kind;\n        effects.enter(kind, {\n          _container: true\n        });\n      }\n      if (kind === \"listUnordered\") {\n        effects.enter(\"listItemPrefix\");\n        return code === 42 || code === 45 ? effects.check(thematicBreak, nok, atMarker)(code) : atMarker(code);\n      }\n      if (!self.interrupt || code === 49) {\n        effects.enter(\"listItemPrefix\");\n        effects.enter(\"listItemValue\");\n        return inside(code);\n      }\n    }\n    return nok(code);\n  }\n\n  /** @type {State} */\n  function inside(code) {\n    if (asciiDigit(code) && ++size < 10) {\n      effects.consume(code);\n      return inside;\n    }\n    if ((!self.interrupt || size < 2) && (self.containerState.marker ? code === self.containerState.marker : code === 41 || code === 46)) {\n      effects.exit(\"listItemValue\");\n      return atMarker(code);\n    }\n    return nok(code);\n  }\n\n  /**\n   * @type {State}\n   **/\n  function atMarker(code) {\n    effects.enter(\"listItemMarker\");\n    effects.consume(code);\n    effects.exit(\"listItemMarker\");\n    self.containerState.marker = self.containerState.marker || code;\n    return effects.check(blankLine,\n    // Can’t be empty when interrupting.\n    self.interrupt ? nok : onBlank, effects.attempt(listItemPrefixWhitespaceConstruct, endOfPrefix, otherPrefix));\n  }\n\n  /** @type {State} */\n  function onBlank(code) {\n    self.containerState.initialBlankLine = true;\n    initialSize++;\n    return endOfPrefix(code);\n  }\n\n  /** @type {State} */\n  function otherPrefix(code) {\n    if (markdownSpace(code)) {\n      effects.enter(\"listItemPrefixWhitespace\");\n      effects.consume(code);\n      effects.exit(\"listItemPrefixWhitespace\");\n      return endOfPrefix;\n    }\n    return nok(code);\n  }\n\n  /** @type {State} */\n  function endOfPrefix(code) {\n    self.containerState.size = initialSize + self.sliceSerialize(effects.exit(\"listItemPrefix\"), true).length;\n    return ok(code);\n  }\n}\n\n/**\n * @type {Tokenizer}\n * @this {TokenizeContext}\n */\nfunction tokenizeListContinuation(effects, ok, nok) {\n  const self = this;\n  self.containerState._closeFlow = undefined;\n  return effects.check(blankLine, onBlank, notBlank);\n\n  /** @type {State} */\n  function onBlank(code) {\n    self.containerState.furtherBlankLines = self.containerState.furtherBlankLines || self.containerState.initialBlankLine;\n\n    // We have a blank line.\n    // Still, try to consume at most the items size.\n    return factorySpace(effects, ok, \"listItemIndent\", self.containerState.size + 1)(code);\n  }\n\n  /** @type {State} */\n  function notBlank(code) {\n    if (self.containerState.furtherBlankLines || !markdownSpace(code)) {\n      self.containerState.furtherBlankLines = undefined;\n      self.containerState.initialBlankLine = undefined;\n      return notInCurrentItem(code);\n    }\n    self.containerState.furtherBlankLines = undefined;\n    self.containerState.initialBlankLine = undefined;\n    return effects.attempt(indentConstruct, ok, notInCurrentItem)(code);\n  }\n\n  /** @type {State} */\n  function notInCurrentItem(code) {\n    // While we do continue, we signal that the flow should be closed.\n    self.containerState._closeFlow = true;\n    // As we’re closing flow, we’re no longer interrupting.\n    self.interrupt = undefined;\n    // Always populated by defaults.\n\n    return factorySpace(effects, effects.attempt(list, ok, nok), \"linePrefix\", self.parser.constructs.disable.null.includes('codeIndented') ? undefined : 4)(code);\n  }\n}\n\n/**\n * @type {Tokenizer}\n * @this {TokenizeContext}\n */\nfunction tokenizeIndent(effects, ok, nok) {\n  const self = this;\n  return factorySpace(effects, afterPrefix, \"listItemIndent\", self.containerState.size + 1);\n\n  /** @type {State} */\n  function afterPrefix(code) {\n    const tail = self.events[self.events.length - 1];\n    return tail && tail[1].type === \"listItemIndent\" && tail[2].sliceSerialize(tail[1], true).length === self.containerState.size ? ok(code) : nok(code);\n  }\n}\n\n/**\n * @type {Exiter}\n * @this {TokenizeContext}\n */\nfunction tokenizeListEnd(effects) {\n  effects.exit(this.containerState.type);\n}\n\n/**\n * @type {Tokenizer}\n * @this {TokenizeContext}\n */\nfunction tokenizeListItemPrefixWhitespace(effects, ok, nok) {\n  const self = this;\n\n  // Always populated by defaults.\n\n  return factorySpace(effects, afterPrefix, \"listItemPrefixWhitespace\", self.parser.constructs.disable.null.includes('codeIndented') ? undefined : 4 + 1);\n\n  /** @type {State} */\n  function afterPrefix(code) {\n    const tail = self.events[self.events.length - 1];\n    return !markdownSpace(code) && tail && tail[1].type === \"listItemPrefixWhitespace\" ? ok(code) : nok(code);\n  }\n}","/**\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').Exiter} Exiter\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { factorySpace } from 'micromark-factory-space';\nimport { markdownSpace } from 'micromark-util-character';\n/** @type {Construct} */\nexport const blockQuote = {\n  name: 'blockQuote',\n  tokenize: tokenizeBlockQuoteStart,\n  continuation: {\n    tokenize: tokenizeBlockQuoteContinuation\n  },\n  exit\n};\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeBlockQuoteStart(effects, ok, nok) {\n  const self = this;\n  return start;\n\n  /**\n   * Start of block quote.\n   *\n   * ```markdown\n   * > | > a\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    if (code === 62) {\n      const state = self.containerState;\n      if (!state.open) {\n        effects.enter(\"blockQuote\", {\n          _container: true\n        });\n        state.open = true;\n      }\n      effects.enter(\"blockQuotePrefix\");\n      effects.enter(\"blockQuoteMarker\");\n      effects.consume(code);\n      effects.exit(\"blockQuoteMarker\");\n      return after;\n    }\n    return nok(code);\n  }\n\n  /**\n   * After `>`, before optional whitespace.\n   *\n   * ```markdown\n   * > | > a\n   *      ^\n   * ```\n   *\n   * @type {State}\n   */\n  function after(code) {\n    if (markdownSpace(code)) {\n      effects.enter(\"blockQuotePrefixWhitespace\");\n      effects.consume(code);\n      effects.exit(\"blockQuotePrefixWhitespace\");\n      effects.exit(\"blockQuotePrefix\");\n      return ok;\n    }\n    effects.exit(\"blockQuotePrefix\");\n    return ok(code);\n  }\n}\n\n/**\n * Start of block quote continuation.\n *\n * ```markdown\n *   | > a\n * > | > b\n *     ^\n * ```\n *\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeBlockQuoteContinuation(effects, ok, nok) {\n  const self = this;\n  return contStart;\n\n  /**\n   * Start of block quote continuation.\n   *\n   * Also used to parse the first block quote opening.\n   *\n   * ```markdown\n   *   | > a\n   * > | > b\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function contStart(code) {\n    if (markdownSpace(code)) {\n      // Always populated by defaults.\n\n      return factorySpace(effects, contBefore, \"linePrefix\", self.parser.constructs.disable.null.includes('codeIndented') ? undefined : 4)(code);\n    }\n    return contBefore(code);\n  }\n\n  /**\n   * At `>`, after optional whitespace.\n   *\n   * Also used to parse the first block quote opening.\n   *\n   * ```markdown\n   *   | > a\n   * > | > b\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function contBefore(code) {\n    return effects.attempt(blockQuote, ok, nok)(code);\n  }\n}\n\n/** @type {Exiter} */\nfunction exit(effects) {\n  effects.exit(\"blockQuote\");\n}","/**\n * @typedef {import('micromark-util-types').Effects} Effects\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenType} TokenType\n */\n\nimport {\n  asciiControl,\n  markdownLineEndingOrSpace,\n  markdownLineEnding\n} from 'micromark-util-character'\n/**\n * Parse destinations.\n *\n * ###### Examples\n *\n * ```markdown\n * <a>\n * <a\\>b>\n * <a b>\n * <a)>\n * a\n * a\\)b\n * a(b)c\n * a(b)\n * ```\n *\n * @param {Effects} effects\n *   Context.\n * @param {State} ok\n *   State switched to when successful.\n * @param {State} nok\n *   State switched to when unsuccessful.\n * @param {TokenType} type\n *   Type for whole (`<a>` or `b`).\n * @param {TokenType} literalType\n *   Type when enclosed (`<a>`).\n * @param {TokenType} literalMarkerType\n *   Type for enclosing (`<` and `>`).\n * @param {TokenType} rawType\n *   Type when not enclosed (`b`).\n * @param {TokenType} stringType\n *   Type for the value (`a` or `b`).\n * @param {number | undefined} [max=Infinity]\n *   Depth of nested parens (inclusive).\n * @returns {State}\n *   Start state.\n */ // eslint-disable-next-line max-params\nexport function factoryDestination(\n  effects,\n  ok,\n  nok,\n  type,\n  literalType,\n  literalMarkerType,\n  rawType,\n  stringType,\n  max\n) {\n  const limit = max || Number.POSITIVE_INFINITY\n  let balance = 0\n  return start\n\n  /**\n   * Start of destination.\n   *\n   * ```markdown\n   * > | <aa>\n   *     ^\n   * > | aa\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    if (code === 60) {\n      effects.enter(type)\n      effects.enter(literalType)\n      effects.enter(literalMarkerType)\n      effects.consume(code)\n      effects.exit(literalMarkerType)\n      return enclosedBefore\n    }\n\n    // ASCII control, space, closing paren.\n    if (code === null || code === 32 || code === 41 || asciiControl(code)) {\n      return nok(code)\n    }\n    effects.enter(type)\n    effects.enter(rawType)\n    effects.enter(stringType)\n    effects.enter('chunkString', {\n      contentType: 'string'\n    })\n    return raw(code)\n  }\n\n  /**\n   * After `<`, at an enclosed destination.\n   *\n   * ```markdown\n   * > | <aa>\n   *      ^\n   * ```\n   *\n   * @type {State}\n   */\n  function enclosedBefore(code) {\n    if (code === 62) {\n      effects.enter(literalMarkerType)\n      effects.consume(code)\n      effects.exit(literalMarkerType)\n      effects.exit(literalType)\n      effects.exit(type)\n      return ok\n    }\n    effects.enter(stringType)\n    effects.enter('chunkString', {\n      contentType: 'string'\n    })\n    return enclosed(code)\n  }\n\n  /**\n   * In enclosed destination.\n   *\n   * ```markdown\n   * > | <aa>\n   *      ^\n   * ```\n   *\n   * @type {State}\n   */\n  function enclosed(code) {\n    if (code === 62) {\n      effects.exit('chunkString')\n      effects.exit(stringType)\n      return enclosedBefore(code)\n    }\n    if (code === null || code === 60 || markdownLineEnding(code)) {\n      return nok(code)\n    }\n    effects.consume(code)\n    return code === 92 ? enclosedEscape : enclosed\n  }\n\n  /**\n   * After `\\`, at a special character.\n   *\n   * ```markdown\n   * > | <a\\*a>\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function enclosedEscape(code) {\n    if (code === 60 || code === 62 || code === 92) {\n      effects.consume(code)\n      return enclosed\n    }\n    return enclosed(code)\n  }\n\n  /**\n   * In raw destination.\n   *\n   * ```markdown\n   * > | aa\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function raw(code) {\n    if (\n      !balance &&\n      (code === null || code === 41 || markdownLineEndingOrSpace(code))\n    ) {\n      effects.exit('chunkString')\n      effects.exit(stringType)\n      effects.exit(rawType)\n      effects.exit(type)\n      return ok(code)\n    }\n    if (balance < limit && code === 40) {\n      effects.consume(code)\n      balance++\n      return raw\n    }\n    if (code === 41) {\n      effects.consume(code)\n      balance--\n      return raw\n    }\n\n    // ASCII control (but *not* `\\0`) and space and `(`.\n    // Note: in `markdown-rs`, `\\0` exists in codes, in `micromark-js` it\n    // doesn’t.\n    if (code === null || code === 32 || code === 40 || asciiControl(code)) {\n      return nok(code)\n    }\n    effects.consume(code)\n    return code === 92 ? rawEscape : raw\n  }\n\n  /**\n   * After `\\`, at special character.\n   *\n   * ```markdown\n   * > | a\\*a\n   *       ^\n   * ```\n   *\n   * @type {State}\n   */\n  function rawEscape(code) {\n    if (code === 40 || code === 41 || code === 92) {\n      effects.consume(code)\n      return raw\n    }\n    return raw(code)\n  }\n}\n","/**\n * @typedef {import('micromark-util-types').Effects} Effects\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').TokenType} TokenType\n */\n\nimport {markdownLineEnding, markdownSpace} from 'micromark-util-character'\n/**\n * Parse labels.\n *\n * > 👉 **Note**: labels in markdown are capped at 999 characters in the string.\n *\n * ###### Examples\n *\n * ```markdown\n * [a]\n * [a\n * b]\n * [a\\]b]\n * ```\n *\n * @this {TokenizeContext}\n *   Tokenize context.\n * @param {Effects} effects\n *   Context.\n * @param {State} ok\n *   State switched to when successful.\n * @param {State} nok\n *   State switched to when unsuccessful.\n * @param {TokenType} type\n *   Type of the whole label (`[a]`).\n * @param {TokenType} markerType\n *   Type for the markers (`[` and `]`).\n * @param {TokenType} stringType\n *   Type for the identifier (`a`).\n * @returns {State}\n *   Start state.\n */ // eslint-disable-next-line max-params\nexport function factoryLabel(effects, ok, nok, type, markerType, stringType) {\n  const self = this\n  let size = 0\n  /** @type {boolean} */\n  let seen\n  return start\n\n  /**\n   * Start of label.\n   *\n   * ```markdown\n   * > | [a]\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    effects.enter(type)\n    effects.enter(markerType)\n    effects.consume(code)\n    effects.exit(markerType)\n    effects.enter(stringType)\n    return atBreak\n  }\n\n  /**\n   * In label, at something, before something else.\n   *\n   * ```markdown\n   * > | [a]\n   *      ^\n   * ```\n   *\n   * @type {State}\n   */\n  function atBreak(code) {\n    if (\n      size > 999 ||\n      code === null ||\n      code === 91 ||\n      (code === 93 && !seen) ||\n      // To do: remove in the future once we’ve switched from\n      // `micromark-extension-footnote` to `micromark-extension-gfm-footnote`,\n      // which doesn’t need this.\n      // Hidden footnotes hook.\n      /* c8 ignore next 3 */\n      (code === 94 &&\n        !size &&\n        '_hiddenFootnoteSupport' in self.parser.constructs)\n    ) {\n      return nok(code)\n    }\n    if (code === 93) {\n      effects.exit(stringType)\n      effects.enter(markerType)\n      effects.consume(code)\n      effects.exit(markerType)\n      effects.exit(type)\n      return ok\n    }\n\n    // To do: indent? Link chunks and EOLs together?\n    if (markdownLineEnding(code)) {\n      effects.enter('lineEnding')\n      effects.consume(code)\n      effects.exit('lineEnding')\n      return atBreak\n    }\n    effects.enter('chunkString', {\n      contentType: 'string'\n    })\n    return labelInside(code)\n  }\n\n  /**\n   * In label, in text.\n   *\n   * ```markdown\n   * > | [a]\n   *      ^\n   * ```\n   *\n   * @type {State}\n   */\n  function labelInside(code) {\n    if (\n      code === null ||\n      code === 91 ||\n      code === 93 ||\n      markdownLineEnding(code) ||\n      size++ > 999\n    ) {\n      effects.exit('chunkString')\n      return atBreak(code)\n    }\n    effects.consume(code)\n    if (!seen) seen = !markdownSpace(code)\n    return code === 92 ? labelEscape : labelInside\n  }\n\n  /**\n   * After `\\`, at a special character.\n   *\n   * ```markdown\n   * > | [a\\*a]\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function labelEscape(code) {\n    if (code === 91 || code === 92 || code === 93) {\n      effects.consume(code)\n      size++\n      return labelInside\n    }\n    return labelInside(code)\n  }\n}\n","/**\n * @typedef {import('micromark-util-types').Code} Code\n * @typedef {import('micromark-util-types').Effects} Effects\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenType} TokenType\n */\n\nimport {factorySpace} from 'micromark-factory-space'\nimport {markdownLineEnding} from 'micromark-util-character'\n/**\n * Parse titles.\n *\n * ###### Examples\n *\n * ```markdown\n * \"a\"\n * 'b'\n * (c)\n * \"a\n * b\"\n * 'a\n *     b'\n * (a\\)b)\n * ```\n *\n * @param {Effects} effects\n *   Context.\n * @param {State} ok\n *   State switched to when successful.\n * @param {State} nok\n *   State switched to when unsuccessful.\n * @param {TokenType} type\n *   Type of the whole title (`\"a\"`, `'b'`, `(c)`).\n * @param {TokenType} markerType\n *   Type for the markers (`\"`, `'`, `(`, and `)`).\n * @param {TokenType} stringType\n *   Type for the value (`a`).\n * @returns {State}\n *   Start state.\n */ // eslint-disable-next-line max-params\nexport function factoryTitle(effects, ok, nok, type, markerType, stringType) {\n  /** @type {NonNullable<Code>} */\n  let marker\n  return start\n\n  /**\n   * Start of title.\n   *\n   * ```markdown\n   * > | \"a\"\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    if (code === 34 || code === 39 || code === 40) {\n      effects.enter(type)\n      effects.enter(markerType)\n      effects.consume(code)\n      effects.exit(markerType)\n      marker = code === 40 ? 41 : code\n      return begin\n    }\n    return nok(code)\n  }\n\n  /**\n   * After opening marker.\n   *\n   * This is also used at the closing marker.\n   *\n   * ```markdown\n   * > | \"a\"\n   *      ^\n   * ```\n   *\n   * @type {State}\n   */\n  function begin(code) {\n    if (code === marker) {\n      effects.enter(markerType)\n      effects.consume(code)\n      effects.exit(markerType)\n      effects.exit(type)\n      return ok\n    }\n    effects.enter(stringType)\n    return atBreak(code)\n  }\n\n  /**\n   * At something, before something else.\n   *\n   * ```markdown\n   * > | \"a\"\n   *      ^\n   * ```\n   *\n   * @type {State}\n   */\n  function atBreak(code) {\n    if (code === marker) {\n      effects.exit(stringType)\n      return begin(marker)\n    }\n    if (code === null) {\n      return nok(code)\n    }\n\n    // Note: blank lines can’t exist in content.\n    if (markdownLineEnding(code)) {\n      // To do: use `space_or_tab_eol_with_options`, connect.\n      effects.enter('lineEnding')\n      effects.consume(code)\n      effects.exit('lineEnding')\n      return factorySpace(effects, atBreak, 'linePrefix')\n    }\n    effects.enter('chunkString', {\n      contentType: 'string'\n    })\n    return inside(code)\n  }\n\n  /**\n   *\n   *\n   * @type {State}\n   */\n  function inside(code) {\n    if (code === marker || code === null || markdownLineEnding(code)) {\n      effects.exit('chunkString')\n      return atBreak(code)\n    }\n    effects.consume(code)\n    return code === 92 ? escape : inside\n  }\n\n  /**\n   * After `\\`, at a special character.\n   *\n   * ```markdown\n   * > | \"a\\*b\"\n   *      ^\n   * ```\n   *\n   * @type {State}\n   */\n  function escape(code) {\n    if (code === marker || code === 92) {\n      effects.consume(code)\n      return inside\n    }\n    return inside(code)\n  }\n}\n","/**\n * @typedef {import('micromark-util-types').Effects} Effects\n * @typedef {import('micromark-util-types').State} State\n */\n\nimport {factorySpace} from 'micromark-factory-space'\nimport {markdownLineEnding, markdownSpace} from 'micromark-util-character'\n/**\n * Parse spaces and tabs.\n *\n * There is no `nok` parameter:\n *\n * *   line endings or spaces in markdown are often optional, in which case this\n *     factory can be used and `ok` will be switched to whether spaces were found\n *     or not\n * *   one line ending or space can be detected with\n *     `markdownLineEndingOrSpace(code)` right before using `factoryWhitespace`\n *\n * @param {Effects} effects\n *   Context.\n * @param {State} ok\n *   State switched to when successful.\n * @returns {State}\n *   Start state.\n */\nexport function factoryWhitespace(effects, ok) {\n  /** @type {boolean} */\n  let seen\n  return start\n\n  /** @type {State} */\n  function start(code) {\n    if (markdownLineEnding(code)) {\n      effects.enter('lineEnding')\n      effects.consume(code)\n      effects.exit('lineEnding')\n      seen = true\n      return start\n    }\n    if (markdownSpace(code)) {\n      return factorySpace(\n        effects,\n        start,\n        seen ? 'linePrefix' : 'lineSuffix'\n      )(code)\n    }\n    return ok(code)\n  }\n}\n","/**\n * Normalize an identifier (as found in references, definitions).\n *\n * Collapses markdown whitespace, trim, and then lower- and uppercase.\n *\n * Some characters are considered “uppercase”, such as U+03F4 (`ϴ`), but if their\n * lowercase counterpart (U+03B8 (`θ`)) is uppercased will result in a different\n * uppercase character (U+0398 (`Θ`)).\n * So, to get a canonical form, we perform both lower- and uppercase.\n *\n * Using uppercase last makes sure keys will never interact with default\n * prototypal values (such as `constructor`): nothing in the prototype of\n * `Object` is uppercase.\n *\n * @param {string} value\n *   Identifier to normalize.\n * @returns {string}\n *   Normalized identifier.\n */\nexport function normalizeIdentifier(value) {\n  return (\n    value\n      // Collapse markdown whitespace.\n      .replace(/[\\t\\n\\r ]+/g, ' ')\n      // Trim.\n      .replace(/^ | $/g, '')\n      // Some characters are considered “uppercase”, but if their lowercase\n      // counterpart is uppercased will result in a different uppercase\n      // character.\n      // Hence, to get that form, we perform both lower- and uppercase.\n      // Upper case makes sure keys will not interact with default prototypal\n      // methods: no method is uppercase.\n      .toLowerCase()\n      .toUpperCase()\n  )\n}\n","/**\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { factoryDestination } from 'micromark-factory-destination';\nimport { factoryLabel } from 'micromark-factory-label';\nimport { factorySpace } from 'micromark-factory-space';\nimport { factoryTitle } from 'micromark-factory-title';\nimport { factoryWhitespace } from 'micromark-factory-whitespace';\nimport { markdownLineEnding, markdownLineEndingOrSpace, markdownSpace } from 'micromark-util-character';\nimport { normalizeIdentifier } from 'micromark-util-normalize-identifier';\n/** @type {Construct} */\nexport const definition = {\n  name: 'definition',\n  tokenize: tokenizeDefinition\n};\n\n/** @type {Construct} */\nconst titleBefore = {\n  tokenize: tokenizeTitleBefore,\n  partial: true\n};\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeDefinition(effects, ok, nok) {\n  const self = this;\n  /** @type {string} */\n  let identifier;\n  return start;\n\n  /**\n   * At start of a definition.\n   *\n   * ```markdown\n   * > | [a]: b \"c\"\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    // Do not interrupt paragraphs (but do follow definitions).\n    // To do: do `interrupt` the way `markdown-rs` does.\n    // To do: parse whitespace the way `markdown-rs` does.\n    effects.enter(\"definition\");\n    return before(code);\n  }\n\n  /**\n   * After optional whitespace, at `[`.\n   *\n   * ```markdown\n   * > | [a]: b \"c\"\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function before(code) {\n    // To do: parse whitespace the way `markdown-rs` does.\n\n    return factoryLabel.call(self, effects, labelAfter,\n    // Note: we don’t need to reset the way `markdown-rs` does.\n    nok, \"definitionLabel\", \"definitionLabelMarker\", \"definitionLabelString\")(code);\n  }\n\n  /**\n   * After label.\n   *\n   * ```markdown\n   * > | [a]: b \"c\"\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function labelAfter(code) {\n    identifier = normalizeIdentifier(self.sliceSerialize(self.events[self.events.length - 1][1]).slice(1, -1));\n    if (code === 58) {\n      effects.enter(\"definitionMarker\");\n      effects.consume(code);\n      effects.exit(\"definitionMarker\");\n      return markerAfter;\n    }\n    return nok(code);\n  }\n\n  /**\n   * After marker.\n   *\n   * ```markdown\n   * > | [a]: b \"c\"\n   *         ^\n   * ```\n   *\n   * @type {State}\n   */\n  function markerAfter(code) {\n    // Note: whitespace is optional.\n    return markdownLineEndingOrSpace(code) ? factoryWhitespace(effects, destinationBefore)(code) : destinationBefore(code);\n  }\n\n  /**\n   * Before destination.\n   *\n   * ```markdown\n   * > | [a]: b \"c\"\n   *          ^\n   * ```\n   *\n   * @type {State}\n   */\n  function destinationBefore(code) {\n    return factoryDestination(effects, destinationAfter,\n    // Note: we don’t need to reset the way `markdown-rs` does.\n    nok, \"definitionDestination\", \"definitionDestinationLiteral\", \"definitionDestinationLiteralMarker\", \"definitionDestinationRaw\", \"definitionDestinationString\")(code);\n  }\n\n  /**\n   * After destination.\n   *\n   * ```markdown\n   * > | [a]: b \"c\"\n   *           ^\n   * ```\n   *\n   * @type {State}\n   */\n  function destinationAfter(code) {\n    return effects.attempt(titleBefore, after, after)(code);\n  }\n\n  /**\n   * After definition.\n   *\n   * ```markdown\n   * > | [a]: b\n   *           ^\n   * > | [a]: b \"c\"\n   *               ^\n   * ```\n   *\n   * @type {State}\n   */\n  function after(code) {\n    return markdownSpace(code) ? factorySpace(effects, afterWhitespace, \"whitespace\")(code) : afterWhitespace(code);\n  }\n\n  /**\n   * After definition, after optional whitespace.\n   *\n   * ```markdown\n   * > | [a]: b\n   *           ^\n   * > | [a]: b \"c\"\n   *               ^\n   * ```\n   *\n   * @type {State}\n   */\n  function afterWhitespace(code) {\n    if (code === null || markdownLineEnding(code)) {\n      effects.exit(\"definition\");\n\n      // Note: we don’t care about uniqueness.\n      // It’s likely that that doesn’t happen very frequently.\n      // It is more likely that it wastes precious time.\n      self.parser.defined.push(identifier);\n\n      // To do: `markdown-rs` interrupt.\n      // // You’d be interrupting.\n      // tokenizer.interrupt = true\n      return ok(code);\n    }\n    return nok(code);\n  }\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeTitleBefore(effects, ok, nok) {\n  return titleBefore;\n\n  /**\n   * After destination, at whitespace.\n   *\n   * ```markdown\n   * > | [a]: b\n   *           ^\n   * > | [a]: b \"c\"\n   *           ^\n   * ```\n   *\n   * @type {State}\n   */\n  function titleBefore(code) {\n    return markdownLineEndingOrSpace(code) ? factoryWhitespace(effects, beforeMarker)(code) : nok(code);\n  }\n\n  /**\n   * At title.\n   *\n   * ```markdown\n   *   | [a]: b\n   * > | \"c\"\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function beforeMarker(code) {\n    return factoryTitle(effects, titleAfter, nok, \"definitionTitle\", \"definitionTitleMarker\", \"definitionTitleString\")(code);\n  }\n\n  /**\n   * After title.\n   *\n   * ```markdown\n   * > | [a]: b \"c\"\n   *               ^\n   * ```\n   *\n   * @type {State}\n   */\n  function titleAfter(code) {\n    return markdownSpace(code) ? factorySpace(effects, titleAfterOptionalWhitespace, \"whitespace\")(code) : titleAfterOptionalWhitespace(code);\n  }\n\n  /**\n   * After title, after optional whitespace.\n   *\n   * ```markdown\n   * > | [a]: b \"c\"\n   *               ^\n   * ```\n   *\n   * @type {State}\n   */\n  function titleAfterOptionalWhitespace(code) {\n    return code === null || markdownLineEnding(code) ? ok(code) : nok(code);\n  }\n}","/**\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { factorySpace } from 'micromark-factory-space';\nimport { markdownLineEnding, markdownSpace } from 'micromark-util-character';\n/** @type {Construct} */\nexport const codeIndented = {\n  name: 'codeIndented',\n  tokenize: tokenizeCodeIndented\n};\n\n/** @type {Construct} */\nconst furtherStart = {\n  tokenize: tokenizeFurtherStart,\n  partial: true\n};\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeCodeIndented(effects, ok, nok) {\n  const self = this;\n  return start;\n\n  /**\n   * Start of code (indented).\n   *\n   * > **Parsing note**: it is not needed to check if this first line is a\n   * > filled line (that it has a non-whitespace character), because blank lines\n   * > are parsed already, so we never run into that.\n   *\n   * ```markdown\n   * > |     aaa\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    // To do: manually check if interrupting like `markdown-rs`.\n\n    effects.enter(\"codeIndented\");\n    // To do: use an improved `space_or_tab` function like `markdown-rs`,\n    // so that we can drop the next state.\n    return factorySpace(effects, afterPrefix, \"linePrefix\", 4 + 1)(code);\n  }\n\n  /**\n   * At start, after 1 or 4 spaces.\n   *\n   * ```markdown\n   * > |     aaa\n   *         ^\n   * ```\n   *\n   * @type {State}\n   */\n  function afterPrefix(code) {\n    const tail = self.events[self.events.length - 1];\n    return tail && tail[1].type === \"linePrefix\" && tail[2].sliceSerialize(tail[1], true).length >= 4 ? atBreak(code) : nok(code);\n  }\n\n  /**\n   * At a break.\n   *\n   * ```markdown\n   * > |     aaa\n   *         ^  ^\n   * ```\n   *\n   * @type {State}\n   */\n  function atBreak(code) {\n    if (code === null) {\n      return after(code);\n    }\n    if (markdownLineEnding(code)) {\n      return effects.attempt(furtherStart, atBreak, after)(code);\n    }\n    effects.enter(\"codeFlowValue\");\n    return inside(code);\n  }\n\n  /**\n   * In code content.\n   *\n   * ```markdown\n   * > |     aaa\n   *         ^^^^\n   * ```\n   *\n   * @type {State}\n   */\n  function inside(code) {\n    if (code === null || markdownLineEnding(code)) {\n      effects.exit(\"codeFlowValue\");\n      return atBreak(code);\n    }\n    effects.consume(code);\n    return inside;\n  }\n\n  /** @type {State} */\n  function after(code) {\n    effects.exit(\"codeIndented\");\n    // To do: allow interrupting like `markdown-rs`.\n    // Feel free to interrupt.\n    // tokenizer.interrupt = false\n    return ok(code);\n  }\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeFurtherStart(effects, ok, nok) {\n  const self = this;\n  return furtherStart;\n\n  /**\n   * At eol, trying to parse another indent.\n   *\n   * ```markdown\n   * > |     aaa\n   *            ^\n   *   |     bbb\n   * ```\n   *\n   * @type {State}\n   */\n  function furtherStart(code) {\n    // To do: improve `lazy` / `pierce` handling.\n    // If this is a lazy line, it can’t be code.\n    if (self.parser.lazy[self.now().line]) {\n      return nok(code);\n    }\n    if (markdownLineEnding(code)) {\n      effects.enter(\"lineEnding\");\n      effects.consume(code);\n      effects.exit(\"lineEnding\");\n      return furtherStart;\n    }\n\n    // To do: the code here in `micromark-js` is a bit different from\n    // `markdown-rs` because there it can attempt spaces.\n    // We can’t yet.\n    //\n    // To do: use an improved `space_or_tab` function like `markdown-rs`,\n    // so that we can drop the next state.\n    return factorySpace(effects, afterPrefix, \"linePrefix\", 4 + 1)(code);\n  }\n\n  /**\n   * At start, after 1 or 4 spaces.\n   *\n   * ```markdown\n   * > |     aaa\n   *         ^\n   * ```\n   *\n   * @type {State}\n   */\n  function afterPrefix(code) {\n    const tail = self.events[self.events.length - 1];\n    return tail && tail[1].type === \"linePrefix\" && tail[2].sliceSerialize(tail[1], true).length >= 4 ? ok(code) : markdownLineEnding(code) ? furtherStart(code) : nok(code);\n  }\n}","/**\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').Resolver} Resolver\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').Token} Token\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { factorySpace } from 'micromark-factory-space';\nimport { markdownLineEnding, markdownLineEndingOrSpace, markdownSpace } from 'micromark-util-character';\nimport { splice } from 'micromark-util-chunked';\n/** @type {Construct} */\nexport const headingAtx = {\n  name: 'headingAtx',\n  tokenize: tokenizeHeadingAtx,\n  resolve: resolveHeadingAtx\n};\n\n/** @type {Resolver} */\nfunction resolveHeadingAtx(events, context) {\n  let contentEnd = events.length - 2;\n  let contentStart = 3;\n  /** @type {Token} */\n  let content;\n  /** @type {Token} */\n  let text;\n\n  // Prefix whitespace, part of the opening.\n  if (events[contentStart][1].type === \"whitespace\") {\n    contentStart += 2;\n  }\n\n  // Suffix whitespace, part of the closing.\n  if (contentEnd - 2 > contentStart && events[contentEnd][1].type === \"whitespace\") {\n    contentEnd -= 2;\n  }\n  if (events[contentEnd][1].type === \"atxHeadingSequence\" && (contentStart === contentEnd - 1 || contentEnd - 4 > contentStart && events[contentEnd - 2][1].type === \"whitespace\")) {\n    contentEnd -= contentStart + 1 === contentEnd ? 2 : 4;\n  }\n  if (contentEnd > contentStart) {\n    content = {\n      type: \"atxHeadingText\",\n      start: events[contentStart][1].start,\n      end: events[contentEnd][1].end\n    };\n    text = {\n      type: \"chunkText\",\n      start: events[contentStart][1].start,\n      end: events[contentEnd][1].end,\n      contentType: \"text\"\n    };\n    splice(events, contentStart, contentEnd - contentStart + 1, [['enter', content, context], ['enter', text, context], ['exit', text, context], ['exit', content, context]]);\n  }\n  return events;\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeHeadingAtx(effects, ok, nok) {\n  let size = 0;\n  return start;\n\n  /**\n   * Start of a heading (atx).\n   *\n   * ```markdown\n   * > | ## aa\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    // To do: parse indent like `markdown-rs`.\n    effects.enter(\"atxHeading\");\n    return before(code);\n  }\n\n  /**\n   * After optional whitespace, at `#`.\n   *\n   * ```markdown\n   * > | ## aa\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function before(code) {\n    effects.enter(\"atxHeadingSequence\");\n    return sequenceOpen(code);\n  }\n\n  /**\n   * In opening sequence.\n   *\n   * ```markdown\n   * > | ## aa\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function sequenceOpen(code) {\n    if (code === 35 && size++ < 6) {\n      effects.consume(code);\n      return sequenceOpen;\n    }\n\n    // Always at least one `#`.\n    if (code === null || markdownLineEndingOrSpace(code)) {\n      effects.exit(\"atxHeadingSequence\");\n      return atBreak(code);\n    }\n    return nok(code);\n  }\n\n  /**\n   * After something, before something else.\n   *\n   * ```markdown\n   * > | ## aa\n   *       ^\n   * ```\n   *\n   * @type {State}\n   */\n  function atBreak(code) {\n    if (code === 35) {\n      effects.enter(\"atxHeadingSequence\");\n      return sequenceFurther(code);\n    }\n    if (code === null || markdownLineEnding(code)) {\n      effects.exit(\"atxHeading\");\n      // To do: interrupt like `markdown-rs`.\n      // // Feel free to interrupt.\n      // tokenizer.interrupt = false\n      return ok(code);\n    }\n    if (markdownSpace(code)) {\n      return factorySpace(effects, atBreak, \"whitespace\")(code);\n    }\n\n    // To do: generate `data` tokens, add the `text` token later.\n    // Needs edit map, see: `markdown.rs`.\n    effects.enter(\"atxHeadingText\");\n    return data(code);\n  }\n\n  /**\n   * In further sequence (after whitespace).\n   *\n   * Could be normal “visible” hashes in the heading or a final sequence.\n   *\n   * ```markdown\n   * > | ## aa ##\n   *           ^\n   * ```\n   *\n   * @type {State}\n   */\n  function sequenceFurther(code) {\n    if (code === 35) {\n      effects.consume(code);\n      return sequenceFurther;\n    }\n    effects.exit(\"atxHeadingSequence\");\n    return atBreak(code);\n  }\n\n  /**\n   * In text.\n   *\n   * ```markdown\n   * > | ## aa\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function data(code) {\n    if (code === null || code === 35 || markdownLineEndingOrSpace(code)) {\n      effects.exit(\"atxHeadingText\");\n      return atBreak(code);\n    }\n    effects.consume(code);\n    return data;\n  }\n}","/**\n * @typedef {import('micromark-util-types').Code} Code\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').Resolver} Resolver\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { factorySpace } from 'micromark-factory-space';\nimport { markdownLineEnding, markdownSpace } from 'micromark-util-character';\n/** @type {Construct} */\nexport const setextUnderline = {\n  name: 'setextUnderline',\n  tokenize: tokenizeSetextUnderline,\n  resolveTo: resolveToSetextUnderline\n};\n\n/** @type {Resolver} */\nfunction resolveToSetextUnderline(events, context) {\n  // To do: resolve like `markdown-rs`.\n  let index = events.length;\n  /** @type {number | undefined} */\n  let content;\n  /** @type {number | undefined} */\n  let text;\n  /** @type {number | undefined} */\n  let definition;\n\n  // Find the opening of the content.\n  // It’ll always exist: we don’t tokenize if it isn’t there.\n  while (index--) {\n    if (events[index][0] === 'enter') {\n      if (events[index][1].type === \"content\") {\n        content = index;\n        break;\n      }\n      if (events[index][1].type === \"paragraph\") {\n        text = index;\n      }\n    }\n    // Exit\n    else {\n      if (events[index][1].type === \"content\") {\n        // Remove the content end (if needed we’ll add it later)\n        events.splice(index, 1);\n      }\n      if (!definition && events[index][1].type === \"definition\") {\n        definition = index;\n      }\n    }\n  }\n  const heading = {\n    type: \"setextHeading\",\n    start: Object.assign({}, events[text][1].start),\n    end: Object.assign({}, events[events.length - 1][1].end)\n  };\n\n  // Change the paragraph to setext heading text.\n  events[text][1].type = \"setextHeadingText\";\n\n  // If we have definitions in the content, we’ll keep on having content,\n  // but we need move it.\n  if (definition) {\n    events.splice(text, 0, ['enter', heading, context]);\n    events.splice(definition + 1, 0, ['exit', events[content][1], context]);\n    events[content][1].end = Object.assign({}, events[definition][1].end);\n  } else {\n    events[content][1] = heading;\n  }\n\n  // Add the heading exit at the end.\n  events.push(['exit', heading, context]);\n  return events;\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeSetextUnderline(effects, ok, nok) {\n  const self = this;\n  /** @type {NonNullable<Code>} */\n  let marker;\n  return start;\n\n  /**\n   * At start of heading (setext) underline.\n   *\n   * ```markdown\n   *   | aa\n   * > | ==\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    let index = self.events.length;\n    /** @type {boolean | undefined} */\n    let paragraph;\n    // Find an opening.\n    while (index--) {\n      // Skip enter/exit of line ending, line prefix, and content.\n      // We can now either have a definition or a paragraph.\n      if (self.events[index][1].type !== \"lineEnding\" && self.events[index][1].type !== \"linePrefix\" && self.events[index][1].type !== \"content\") {\n        paragraph = self.events[index][1].type === \"paragraph\";\n        break;\n      }\n    }\n\n    // To do: handle lazy/pierce like `markdown-rs`.\n    // To do: parse indent like `markdown-rs`.\n    if (!self.parser.lazy[self.now().line] && (self.interrupt || paragraph)) {\n      effects.enter(\"setextHeadingLine\");\n      marker = code;\n      return before(code);\n    }\n    return nok(code);\n  }\n\n  /**\n   * After optional whitespace, at `-` or `=`.\n   *\n   * ```markdown\n   *   | aa\n   * > | ==\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function before(code) {\n    effects.enter(\"setextHeadingLineSequence\");\n    return inside(code);\n  }\n\n  /**\n   * In sequence.\n   *\n   * ```markdown\n   *   | aa\n   * > | ==\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function inside(code) {\n    if (code === marker) {\n      effects.consume(code);\n      return inside;\n    }\n    effects.exit(\"setextHeadingLineSequence\");\n    return markdownSpace(code) ? factorySpace(effects, after, \"lineSuffix\")(code) : after(code);\n  }\n\n  /**\n   * After sequence, after optional whitespace.\n   *\n   * ```markdown\n   *   | aa\n   * > | ==\n   *       ^\n   * ```\n   *\n   * @type {State}\n   */\n  function after(code) {\n    if (code === null || markdownLineEnding(code)) {\n      effects.exit(\"setextHeadingLine\");\n      return ok(code);\n    }\n    return nok(code);\n  }\n}","/**\n * List of lowercase HTML “block” tag names.\n *\n * The list, when parsing HTML (flow), results in more relaxed rules (condition\n * 6).\n * Because they are known blocks, the HTML-like syntax doesn’t have to be\n * strictly parsed.\n * For tag names not in this list, a more strict algorithm (condition 7) is used\n * to detect whether the HTML-like syntax is seen as HTML (flow) or not.\n *\n * This is copied from:\n * <https://spec.commonmark.org/0.30/#html-blocks>.\n *\n * > 👉 **Note**: `search` was added in `CommonMark@0.31`.\n */\nexport const htmlBlockNames = [\n  'address',\n  'article',\n  'aside',\n  'base',\n  'basefont',\n  'blockquote',\n  'body',\n  'caption',\n  'center',\n  'col',\n  'colgroup',\n  'dd',\n  'details',\n  'dialog',\n  'dir',\n  'div',\n  'dl',\n  'dt',\n  'fieldset',\n  'figcaption',\n  'figure',\n  'footer',\n  'form',\n  'frame',\n  'frameset',\n  'h1',\n  'h2',\n  'h3',\n  'h4',\n  'h5',\n  'h6',\n  'head',\n  'header',\n  'hr',\n  'html',\n  'iframe',\n  'legend',\n  'li',\n  'link',\n  'main',\n  'menu',\n  'menuitem',\n  'nav',\n  'noframes',\n  'ol',\n  'optgroup',\n  'option',\n  'p',\n  'param',\n  'search',\n  'section',\n  'summary',\n  'table',\n  'tbody',\n  'td',\n  'tfoot',\n  'th',\n  'thead',\n  'title',\n  'tr',\n  'track',\n  'ul'\n]\n\n/**\n * List of lowercase HTML “raw” tag names.\n *\n * The list, when parsing HTML (flow), results in HTML that can include lines\n * without exiting, until a closing tag also in this list is found (condition\n * 1).\n *\n * This module is copied from:\n * <https://spec.commonmark.org/0.30/#html-blocks>.\n *\n * > 👉 **Note**: `textarea` was added in `CommonMark@0.30`.\n */\nexport const htmlRawNames = ['pre', 'script', 'style', 'textarea']\n","/**\n * @typedef {import('micromark-util-types').Code} Code\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').Resolver} Resolver\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { asciiAlpha, asciiAlphanumeric, markdownLineEnding, markdownLineEndingOrSpace, markdownSpace } from 'micromark-util-character';\nimport { htmlBlockNames, htmlRawNames } from 'micromark-util-html-tag-name';\nimport { blankLine } from './blank-line.js';\n\n/** @type {Construct} */\nexport const htmlFlow = {\n  name: 'htmlFlow',\n  tokenize: tokenizeHtmlFlow,\n  resolveTo: resolveToHtmlFlow,\n  concrete: true\n};\n\n/** @type {Construct} */\nconst blankLineBefore = {\n  tokenize: tokenizeBlankLineBefore,\n  partial: true\n};\nconst nonLazyContinuationStart = {\n  tokenize: tokenizeNonLazyContinuationStart,\n  partial: true\n};\n\n/** @type {Resolver} */\nfunction resolveToHtmlFlow(events) {\n  let index = events.length;\n  while (index--) {\n    if (events[index][0] === 'enter' && events[index][1].type === \"htmlFlow\") {\n      break;\n    }\n  }\n  if (index > 1 && events[index - 2][1].type === \"linePrefix\") {\n    // Add the prefix start to the HTML token.\n    events[index][1].start = events[index - 2][1].start;\n    // Add the prefix start to the HTML line token.\n    events[index + 1][1].start = events[index - 2][1].start;\n    // Remove the line prefix.\n    events.splice(index - 2, 2);\n  }\n  return events;\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeHtmlFlow(effects, ok, nok) {\n  const self = this;\n  /** @type {number} */\n  let marker;\n  /** @type {boolean} */\n  let closingTag;\n  /** @type {string} */\n  let buffer;\n  /** @type {number} */\n  let index;\n  /** @type {Code} */\n  let markerB;\n  return start;\n\n  /**\n   * Start of HTML (flow).\n   *\n   * ```markdown\n   * > | <x />\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    // To do: parse indent like `markdown-rs`.\n    return before(code);\n  }\n\n  /**\n   * At `<`, after optional whitespace.\n   *\n   * ```markdown\n   * > | <x />\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function before(code) {\n    effects.enter(\"htmlFlow\");\n    effects.enter(\"htmlFlowData\");\n    effects.consume(code);\n    return open;\n  }\n\n  /**\n   * After `<`, at tag name or other stuff.\n   *\n   * ```markdown\n   * > | <x />\n   *      ^\n   * > | <!doctype>\n   *      ^\n   * > | <!--xxx-->\n   *      ^\n   * ```\n   *\n   * @type {State}\n   */\n  function open(code) {\n    if (code === 33) {\n      effects.consume(code);\n      return declarationOpen;\n    }\n    if (code === 47) {\n      effects.consume(code);\n      closingTag = true;\n      return tagCloseStart;\n    }\n    if (code === 63) {\n      effects.consume(code);\n      marker = 3;\n      // To do:\n      // tokenizer.concrete = true\n      // To do: use `markdown-rs` style interrupt.\n      // While we’re in an instruction instead of a declaration, we’re on a `?`\n      // right now, so we do need to search for `>`, similar to declarations.\n      return self.interrupt ? ok : continuationDeclarationInside;\n    }\n\n    // ASCII alphabetical.\n    if (asciiAlpha(code)) {\n      effects.consume(code);\n      // @ts-expect-error: not null.\n      buffer = String.fromCharCode(code);\n      return tagName;\n    }\n    return nok(code);\n  }\n\n  /**\n   * After `<!`, at declaration, comment, or CDATA.\n   *\n   * ```markdown\n   * > | <!doctype>\n   *       ^\n   * > | <!--xxx-->\n   *       ^\n   * > | <![CDATA[>&<]]>\n   *       ^\n   * ```\n   *\n   * @type {State}\n   */\n  function declarationOpen(code) {\n    if (code === 45) {\n      effects.consume(code);\n      marker = 2;\n      return commentOpenInside;\n    }\n    if (code === 91) {\n      effects.consume(code);\n      marker = 5;\n      index = 0;\n      return cdataOpenInside;\n    }\n\n    // ASCII alphabetical.\n    if (asciiAlpha(code)) {\n      effects.consume(code);\n      marker = 4;\n      // // Do not form containers.\n      // tokenizer.concrete = true\n      return self.interrupt ? ok : continuationDeclarationInside;\n    }\n    return nok(code);\n  }\n\n  /**\n   * After `<!-`, inside a comment, at another `-`.\n   *\n   * ```markdown\n   * > | <!--xxx-->\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function commentOpenInside(code) {\n    if (code === 45) {\n      effects.consume(code);\n      // // Do not form containers.\n      // tokenizer.concrete = true\n      return self.interrupt ? ok : continuationDeclarationInside;\n    }\n    return nok(code);\n  }\n\n  /**\n   * After `<![`, inside CDATA, expecting `CDATA[`.\n   *\n   * ```markdown\n   * > | <![CDATA[>&<]]>\n   *        ^^^^^^\n   * ```\n   *\n   * @type {State}\n   */\n  function cdataOpenInside(code) {\n    const value = \"CDATA[\";\n    if (code === value.charCodeAt(index++)) {\n      effects.consume(code);\n      if (index === value.length) {\n        // // Do not form containers.\n        // tokenizer.concrete = true\n        return self.interrupt ? ok : continuation;\n      }\n      return cdataOpenInside;\n    }\n    return nok(code);\n  }\n\n  /**\n   * After `</`, in closing tag, at tag name.\n   *\n   * ```markdown\n   * > | </x>\n   *       ^\n   * ```\n   *\n   * @type {State}\n   */\n  function tagCloseStart(code) {\n    if (asciiAlpha(code)) {\n      effects.consume(code);\n      // @ts-expect-error: not null.\n      buffer = String.fromCharCode(code);\n      return tagName;\n    }\n    return nok(code);\n  }\n\n  /**\n   * In tag name.\n   *\n   * ```markdown\n   * > | <ab>\n   *      ^^\n   * > | </ab>\n   *       ^^\n   * ```\n   *\n   * @type {State}\n   */\n  function tagName(code) {\n    if (code === null || code === 47 || code === 62 || markdownLineEndingOrSpace(code)) {\n      const slash = code === 47;\n      const name = buffer.toLowerCase();\n      if (!slash && !closingTag && htmlRawNames.includes(name)) {\n        marker = 1;\n        // // Do not form containers.\n        // tokenizer.concrete = true\n        return self.interrupt ? ok(code) : continuation(code);\n      }\n      if (htmlBlockNames.includes(buffer.toLowerCase())) {\n        marker = 6;\n        if (slash) {\n          effects.consume(code);\n          return basicSelfClosing;\n        }\n\n        // // Do not form containers.\n        // tokenizer.concrete = true\n        return self.interrupt ? ok(code) : continuation(code);\n      }\n      marker = 7;\n      // Do not support complete HTML when interrupting.\n      return self.interrupt && !self.parser.lazy[self.now().line] ? nok(code) : closingTag ? completeClosingTagAfter(code) : completeAttributeNameBefore(code);\n    }\n\n    // ASCII alphanumerical and `-`.\n    if (code === 45 || asciiAlphanumeric(code)) {\n      effects.consume(code);\n      buffer += String.fromCharCode(code);\n      return tagName;\n    }\n    return nok(code);\n  }\n\n  /**\n   * After closing slash of a basic tag name.\n   *\n   * ```markdown\n   * > | <div/>\n   *          ^\n   * ```\n   *\n   * @type {State}\n   */\n  function basicSelfClosing(code) {\n    if (code === 62) {\n      effects.consume(code);\n      // // Do not form containers.\n      // tokenizer.concrete = true\n      return self.interrupt ? ok : continuation;\n    }\n    return nok(code);\n  }\n\n  /**\n   * After closing slash of a complete tag name.\n   *\n   * ```markdown\n   * > | <x/>\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function completeClosingTagAfter(code) {\n    if (markdownSpace(code)) {\n      effects.consume(code);\n      return completeClosingTagAfter;\n    }\n    return completeEnd(code);\n  }\n\n  /**\n   * At an attribute name.\n   *\n   * At first, this state is used after a complete tag name, after whitespace,\n   * where it expects optional attributes or the end of the tag.\n   * It is also reused after attributes, when expecting more optional\n   * attributes.\n   *\n   * ```markdown\n   * > | <a />\n   *        ^\n   * > | <a :b>\n   *        ^\n   * > | <a _b>\n   *        ^\n   * > | <a b>\n   *        ^\n   * > | <a >\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function completeAttributeNameBefore(code) {\n    if (code === 47) {\n      effects.consume(code);\n      return completeEnd;\n    }\n\n    // ASCII alphanumerical and `:` and `_`.\n    if (code === 58 || code === 95 || asciiAlpha(code)) {\n      effects.consume(code);\n      return completeAttributeName;\n    }\n    if (markdownSpace(code)) {\n      effects.consume(code);\n      return completeAttributeNameBefore;\n    }\n    return completeEnd(code);\n  }\n\n  /**\n   * In attribute name.\n   *\n   * ```markdown\n   * > | <a :b>\n   *         ^\n   * > | <a _b>\n   *         ^\n   * > | <a b>\n   *         ^\n   * ```\n   *\n   * @type {State}\n   */\n  function completeAttributeName(code) {\n    // ASCII alphanumerical and `-`, `.`, `:`, and `_`.\n    if (code === 45 || code === 46 || code === 58 || code === 95 || asciiAlphanumeric(code)) {\n      effects.consume(code);\n      return completeAttributeName;\n    }\n    return completeAttributeNameAfter(code);\n  }\n\n  /**\n   * After attribute name, at an optional initializer, the end of the tag, or\n   * whitespace.\n   *\n   * ```markdown\n   * > | <a b>\n   *         ^\n   * > | <a b=c>\n   *         ^\n   * ```\n   *\n   * @type {State}\n   */\n  function completeAttributeNameAfter(code) {\n    if (code === 61) {\n      effects.consume(code);\n      return completeAttributeValueBefore;\n    }\n    if (markdownSpace(code)) {\n      effects.consume(code);\n      return completeAttributeNameAfter;\n    }\n    return completeAttributeNameBefore(code);\n  }\n\n  /**\n   * Before unquoted, double quoted, or single quoted attribute value, allowing\n   * whitespace.\n   *\n   * ```markdown\n   * > | <a b=c>\n   *          ^\n   * > | <a b=\"c\">\n   *          ^\n   * ```\n   *\n   * @type {State}\n   */\n  function completeAttributeValueBefore(code) {\n    if (code === null || code === 60 || code === 61 || code === 62 || code === 96) {\n      return nok(code);\n    }\n    if (code === 34 || code === 39) {\n      effects.consume(code);\n      markerB = code;\n      return completeAttributeValueQuoted;\n    }\n    if (markdownSpace(code)) {\n      effects.consume(code);\n      return completeAttributeValueBefore;\n    }\n    return completeAttributeValueUnquoted(code);\n  }\n\n  /**\n   * In double or single quoted attribute value.\n   *\n   * ```markdown\n   * > | <a b=\"c\">\n   *           ^\n   * > | <a b='c'>\n   *           ^\n   * ```\n   *\n   * @type {State}\n   */\n  function completeAttributeValueQuoted(code) {\n    if (code === markerB) {\n      effects.consume(code);\n      markerB = null;\n      return completeAttributeValueQuotedAfter;\n    }\n    if (code === null || markdownLineEnding(code)) {\n      return nok(code);\n    }\n    effects.consume(code);\n    return completeAttributeValueQuoted;\n  }\n\n  /**\n   * In unquoted attribute value.\n   *\n   * ```markdown\n   * > | <a b=c>\n   *          ^\n   * ```\n   *\n   * @type {State}\n   */\n  function completeAttributeValueUnquoted(code) {\n    if (code === null || code === 34 || code === 39 || code === 47 || code === 60 || code === 61 || code === 62 || code === 96 || markdownLineEndingOrSpace(code)) {\n      return completeAttributeNameAfter(code);\n    }\n    effects.consume(code);\n    return completeAttributeValueUnquoted;\n  }\n\n  /**\n   * After double or single quoted attribute value, before whitespace or the\n   * end of the tag.\n   *\n   * ```markdown\n   * > | <a b=\"c\">\n   *            ^\n   * ```\n   *\n   * @type {State}\n   */\n  function completeAttributeValueQuotedAfter(code) {\n    if (code === 47 || code === 62 || markdownSpace(code)) {\n      return completeAttributeNameBefore(code);\n    }\n    return nok(code);\n  }\n\n  /**\n   * In certain circumstances of a complete tag where only an `>` is allowed.\n   *\n   * ```markdown\n   * > | <a b=\"c\">\n   *             ^\n   * ```\n   *\n   * @type {State}\n   */\n  function completeEnd(code) {\n    if (code === 62) {\n      effects.consume(code);\n      return completeAfter;\n    }\n    return nok(code);\n  }\n\n  /**\n   * After `>` in a complete tag.\n   *\n   * ```markdown\n   * > | <x>\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function completeAfter(code) {\n    if (code === null || markdownLineEnding(code)) {\n      // // Do not form containers.\n      // tokenizer.concrete = true\n      return continuation(code);\n    }\n    if (markdownSpace(code)) {\n      effects.consume(code);\n      return completeAfter;\n    }\n    return nok(code);\n  }\n\n  /**\n   * In continuation of any HTML kind.\n   *\n   * ```markdown\n   * > | <!--xxx-->\n   *          ^\n   * ```\n   *\n   * @type {State}\n   */\n  function continuation(code) {\n    if (code === 45 && marker === 2) {\n      effects.consume(code);\n      return continuationCommentInside;\n    }\n    if (code === 60 && marker === 1) {\n      effects.consume(code);\n      return continuationRawTagOpen;\n    }\n    if (code === 62 && marker === 4) {\n      effects.consume(code);\n      return continuationClose;\n    }\n    if (code === 63 && marker === 3) {\n      effects.consume(code);\n      return continuationDeclarationInside;\n    }\n    if (code === 93 && marker === 5) {\n      effects.consume(code);\n      return continuationCdataInside;\n    }\n    if (markdownLineEnding(code) && (marker === 6 || marker === 7)) {\n      effects.exit(\"htmlFlowData\");\n      return effects.check(blankLineBefore, continuationAfter, continuationStart)(code);\n    }\n    if (code === null || markdownLineEnding(code)) {\n      effects.exit(\"htmlFlowData\");\n      return continuationStart(code);\n    }\n    effects.consume(code);\n    return continuation;\n  }\n\n  /**\n   * In continuation, at eol.\n   *\n   * ```markdown\n   * > | <x>\n   *        ^\n   *   | asd\n   * ```\n   *\n   * @type {State}\n   */\n  function continuationStart(code) {\n    return effects.check(nonLazyContinuationStart, continuationStartNonLazy, continuationAfter)(code);\n  }\n\n  /**\n   * In continuation, at eol, before non-lazy content.\n   *\n   * ```markdown\n   * > | <x>\n   *        ^\n   *   | asd\n   * ```\n   *\n   * @type {State}\n   */\n  function continuationStartNonLazy(code) {\n    effects.enter(\"lineEnding\");\n    effects.consume(code);\n    effects.exit(\"lineEnding\");\n    return continuationBefore;\n  }\n\n  /**\n   * In continuation, before non-lazy content.\n   *\n   * ```markdown\n   *   | <x>\n   * > | asd\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function continuationBefore(code) {\n    if (code === null || markdownLineEnding(code)) {\n      return continuationStart(code);\n    }\n    effects.enter(\"htmlFlowData\");\n    return continuation(code);\n  }\n\n  /**\n   * In comment continuation, after one `-`, expecting another.\n   *\n   * ```markdown\n   * > | <!--xxx-->\n   *             ^\n   * ```\n   *\n   * @type {State}\n   */\n  function continuationCommentInside(code) {\n    if (code === 45) {\n      effects.consume(code);\n      return continuationDeclarationInside;\n    }\n    return continuation(code);\n  }\n\n  /**\n   * In raw continuation, after `<`, at `/`.\n   *\n   * ```markdown\n   * > | <script>console.log(1)</script>\n   *                            ^\n   * ```\n   *\n   * @type {State}\n   */\n  function continuationRawTagOpen(code) {\n    if (code === 47) {\n      effects.consume(code);\n      buffer = '';\n      return continuationRawEndTag;\n    }\n    return continuation(code);\n  }\n\n  /**\n   * In raw continuation, after `</`, in a raw tag name.\n   *\n   * ```markdown\n   * > | <script>console.log(1)</script>\n   *                             ^^^^^^\n   * ```\n   *\n   * @type {State}\n   */\n  function continuationRawEndTag(code) {\n    if (code === 62) {\n      const name = buffer.toLowerCase();\n      if (htmlRawNames.includes(name)) {\n        effects.consume(code);\n        return continuationClose;\n      }\n      return continuation(code);\n    }\n    if (asciiAlpha(code) && buffer.length < 8) {\n      effects.consume(code);\n      // @ts-expect-error: not null.\n      buffer += String.fromCharCode(code);\n      return continuationRawEndTag;\n    }\n    return continuation(code);\n  }\n\n  /**\n   * In cdata continuation, after `]`, expecting `]>`.\n   *\n   * ```markdown\n   * > | <![CDATA[>&<]]>\n   *                  ^\n   * ```\n   *\n   * @type {State}\n   */\n  function continuationCdataInside(code) {\n    if (code === 93) {\n      effects.consume(code);\n      return continuationDeclarationInside;\n    }\n    return continuation(code);\n  }\n\n  /**\n   * In declaration or instruction continuation, at `>`.\n   *\n   * ```markdown\n   * > | <!-->\n   *         ^\n   * > | <?>\n   *       ^\n   * > | <!q>\n   *        ^\n   * > | <!--ab-->\n   *             ^\n   * > | <![CDATA[>&<]]>\n   *                   ^\n   * ```\n   *\n   * @type {State}\n   */\n  function continuationDeclarationInside(code) {\n    if (code === 62) {\n      effects.consume(code);\n      return continuationClose;\n    }\n\n    // More dashes.\n    if (code === 45 && marker === 2) {\n      effects.consume(code);\n      return continuationDeclarationInside;\n    }\n    return continuation(code);\n  }\n\n  /**\n   * In closed continuation: everything we get until the eol/eof is part of it.\n   *\n   * ```markdown\n   * > | <!doctype>\n   *               ^\n   * ```\n   *\n   * @type {State}\n   */\n  function continuationClose(code) {\n    if (code === null || markdownLineEnding(code)) {\n      effects.exit(\"htmlFlowData\");\n      return continuationAfter(code);\n    }\n    effects.consume(code);\n    return continuationClose;\n  }\n\n  /**\n   * Done.\n   *\n   * ```markdown\n   * > | <!doctype>\n   *               ^\n   * ```\n   *\n   * @type {State}\n   */\n  function continuationAfter(code) {\n    effects.exit(\"htmlFlow\");\n    // // Feel free to interrupt.\n    // tokenizer.interrupt = false\n    // // No longer concrete.\n    // tokenizer.concrete = false\n    return ok(code);\n  }\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeNonLazyContinuationStart(effects, ok, nok) {\n  const self = this;\n  return start;\n\n  /**\n   * At eol, before continuation.\n   *\n   * ```markdown\n   * > | * ```js\n   *            ^\n   *   | b\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    if (markdownLineEnding(code)) {\n      effects.enter(\"lineEnding\");\n      effects.consume(code);\n      effects.exit(\"lineEnding\");\n      return after;\n    }\n    return nok(code);\n  }\n\n  /**\n   * A continuation.\n   *\n   * ```markdown\n   *   | * ```js\n   * > | b\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function after(code) {\n    return self.parser.lazy[self.now().line] ? nok(code) : ok(code);\n  }\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeBlankLineBefore(effects, ok, nok) {\n  return start;\n\n  /**\n   * Before eol, expecting blank line.\n   *\n   * ```markdown\n   * > | <div>\n   *          ^\n   *   |\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    effects.enter(\"lineEnding\");\n    effects.consume(code);\n    effects.exit(\"lineEnding\");\n    return effects.attempt(blankLine, ok, nok);\n  }\n}","/**\n * @typedef {import('micromark-util-types').Code} Code\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { factorySpace } from 'micromark-factory-space';\nimport { markdownLineEnding, markdownSpace } from 'micromark-util-character';\n/** @type {Construct} */\nconst nonLazyContinuation = {\n  tokenize: tokenizeNonLazyContinuation,\n  partial: true\n};\n\n/** @type {Construct} */\nexport const codeFenced = {\n  name: 'codeFenced',\n  tokenize: tokenizeCodeFenced,\n  concrete: true\n};\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeCodeFenced(effects, ok, nok) {\n  const self = this;\n  /** @type {Construct} */\n  const closeStart = {\n    tokenize: tokenizeCloseStart,\n    partial: true\n  };\n  let initialPrefix = 0;\n  let sizeOpen = 0;\n  /** @type {NonNullable<Code>} */\n  let marker;\n  return start;\n\n  /**\n   * Start of code.\n   *\n   * ```markdown\n   * > | ~~~js\n   *     ^\n   *   | alert(1)\n   *   | ~~~\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    // To do: parse whitespace like `markdown-rs`.\n    return beforeSequenceOpen(code);\n  }\n\n  /**\n   * In opening fence, after prefix, at sequence.\n   *\n   * ```markdown\n   * > | ~~~js\n   *     ^\n   *   | alert(1)\n   *   | ~~~\n   * ```\n   *\n   * @type {State}\n   */\n  function beforeSequenceOpen(code) {\n    const tail = self.events[self.events.length - 1];\n    initialPrefix = tail && tail[1].type === \"linePrefix\" ? tail[2].sliceSerialize(tail[1], true).length : 0;\n    marker = code;\n    effects.enter(\"codeFenced\");\n    effects.enter(\"codeFencedFence\");\n    effects.enter(\"codeFencedFenceSequence\");\n    return sequenceOpen(code);\n  }\n\n  /**\n   * In opening fence sequence.\n   *\n   * ```markdown\n   * > | ~~~js\n   *      ^\n   *   | alert(1)\n   *   | ~~~\n   * ```\n   *\n   * @type {State}\n   */\n  function sequenceOpen(code) {\n    if (code === marker) {\n      sizeOpen++;\n      effects.consume(code);\n      return sequenceOpen;\n    }\n    if (sizeOpen < 3) {\n      return nok(code);\n    }\n    effects.exit(\"codeFencedFenceSequence\");\n    return markdownSpace(code) ? factorySpace(effects, infoBefore, \"whitespace\")(code) : infoBefore(code);\n  }\n\n  /**\n   * In opening fence, after the sequence (and optional whitespace), before info.\n   *\n   * ```markdown\n   * > | ~~~js\n   *        ^\n   *   | alert(1)\n   *   | ~~~\n   * ```\n   *\n   * @type {State}\n   */\n  function infoBefore(code) {\n    if (code === null || markdownLineEnding(code)) {\n      effects.exit(\"codeFencedFence\");\n      return self.interrupt ? ok(code) : effects.check(nonLazyContinuation, atNonLazyBreak, after)(code);\n    }\n    effects.enter(\"codeFencedFenceInfo\");\n    effects.enter(\"chunkString\", {\n      contentType: \"string\"\n    });\n    return info(code);\n  }\n\n  /**\n   * In info.\n   *\n   * ```markdown\n   * > | ~~~js\n   *        ^\n   *   | alert(1)\n   *   | ~~~\n   * ```\n   *\n   * @type {State}\n   */\n  function info(code) {\n    if (code === null || markdownLineEnding(code)) {\n      effects.exit(\"chunkString\");\n      effects.exit(\"codeFencedFenceInfo\");\n      return infoBefore(code);\n    }\n    if (markdownSpace(code)) {\n      effects.exit(\"chunkString\");\n      effects.exit(\"codeFencedFenceInfo\");\n      return factorySpace(effects, metaBefore, \"whitespace\")(code);\n    }\n    if (code === 96 && code === marker) {\n      return nok(code);\n    }\n    effects.consume(code);\n    return info;\n  }\n\n  /**\n   * In opening fence, after info and whitespace, before meta.\n   *\n   * ```markdown\n   * > | ~~~js eval\n   *           ^\n   *   | alert(1)\n   *   | ~~~\n   * ```\n   *\n   * @type {State}\n   */\n  function metaBefore(code) {\n    if (code === null || markdownLineEnding(code)) {\n      return infoBefore(code);\n    }\n    effects.enter(\"codeFencedFenceMeta\");\n    effects.enter(\"chunkString\", {\n      contentType: \"string\"\n    });\n    return meta(code);\n  }\n\n  /**\n   * In meta.\n   *\n   * ```markdown\n   * > | ~~~js eval\n   *           ^\n   *   | alert(1)\n   *   | ~~~\n   * ```\n   *\n   * @type {State}\n   */\n  function meta(code) {\n    if (code === null || markdownLineEnding(code)) {\n      effects.exit(\"chunkString\");\n      effects.exit(\"codeFencedFenceMeta\");\n      return infoBefore(code);\n    }\n    if (code === 96 && code === marker) {\n      return nok(code);\n    }\n    effects.consume(code);\n    return meta;\n  }\n\n  /**\n   * At eol/eof in code, before a non-lazy closing fence or content.\n   *\n   * ```markdown\n   * > | ~~~js\n   *          ^\n   * > | alert(1)\n   *             ^\n   *   | ~~~\n   * ```\n   *\n   * @type {State}\n   */\n  function atNonLazyBreak(code) {\n    return effects.attempt(closeStart, after, contentBefore)(code);\n  }\n\n  /**\n   * Before code content, not a closing fence, at eol.\n   *\n   * ```markdown\n   *   | ~~~js\n   * > | alert(1)\n   *             ^\n   *   | ~~~\n   * ```\n   *\n   * @type {State}\n   */\n  function contentBefore(code) {\n    effects.enter(\"lineEnding\");\n    effects.consume(code);\n    effects.exit(\"lineEnding\");\n    return contentStart;\n  }\n\n  /**\n   * Before code content, not a closing fence.\n   *\n   * ```markdown\n   *   | ~~~js\n   * > | alert(1)\n   *     ^\n   *   | ~~~\n   * ```\n   *\n   * @type {State}\n   */\n  function contentStart(code) {\n    return initialPrefix > 0 && markdownSpace(code) ? factorySpace(effects, beforeContentChunk, \"linePrefix\", initialPrefix + 1)(code) : beforeContentChunk(code);\n  }\n\n  /**\n   * Before code content, after optional prefix.\n   *\n   * ```markdown\n   *   | ~~~js\n   * > | alert(1)\n   *     ^\n   *   | ~~~\n   * ```\n   *\n   * @type {State}\n   */\n  function beforeContentChunk(code) {\n    if (code === null || markdownLineEnding(code)) {\n      return effects.check(nonLazyContinuation, atNonLazyBreak, after)(code);\n    }\n    effects.enter(\"codeFlowValue\");\n    return contentChunk(code);\n  }\n\n  /**\n   * In code content.\n   *\n   * ```markdown\n   *   | ~~~js\n   * > | alert(1)\n   *     ^^^^^^^^\n   *   | ~~~\n   * ```\n   *\n   * @type {State}\n   */\n  function contentChunk(code) {\n    if (code === null || markdownLineEnding(code)) {\n      effects.exit(\"codeFlowValue\");\n      return beforeContentChunk(code);\n    }\n    effects.consume(code);\n    return contentChunk;\n  }\n\n  /**\n   * After code.\n   *\n   * ```markdown\n   *   | ~~~js\n   *   | alert(1)\n   * > | ~~~\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function after(code) {\n    effects.exit(\"codeFenced\");\n    return ok(code);\n  }\n\n  /**\n   * @this {TokenizeContext}\n   * @type {Tokenizer}\n   */\n  function tokenizeCloseStart(effects, ok, nok) {\n    let size = 0;\n    return startBefore;\n\n    /**\n     *\n     *\n     * @type {State}\n     */\n    function startBefore(code) {\n      effects.enter(\"lineEnding\");\n      effects.consume(code);\n      effects.exit(\"lineEnding\");\n      return start;\n    }\n\n    /**\n     * Before closing fence, at optional whitespace.\n     *\n     * ```markdown\n     *   | ~~~js\n     *   | alert(1)\n     * > | ~~~\n     *     ^\n     * ```\n     *\n     * @type {State}\n     */\n    function start(code) {\n      // Always populated by defaults.\n\n      // To do: `enter` here or in next state?\n      effects.enter(\"codeFencedFence\");\n      return markdownSpace(code) ? factorySpace(effects, beforeSequenceClose, \"linePrefix\", self.parser.constructs.disable.null.includes('codeIndented') ? undefined : 4)(code) : beforeSequenceClose(code);\n    }\n\n    /**\n     * In closing fence, after optional whitespace, at sequence.\n     *\n     * ```markdown\n     *   | ~~~js\n     *   | alert(1)\n     * > | ~~~\n     *     ^\n     * ```\n     *\n     * @type {State}\n     */\n    function beforeSequenceClose(code) {\n      if (code === marker) {\n        effects.enter(\"codeFencedFenceSequence\");\n        return sequenceClose(code);\n      }\n      return nok(code);\n    }\n\n    /**\n     * In closing fence sequence.\n     *\n     * ```markdown\n     *   | ~~~js\n     *   | alert(1)\n     * > | ~~~\n     *     ^\n     * ```\n     *\n     * @type {State}\n     */\n    function sequenceClose(code) {\n      if (code === marker) {\n        size++;\n        effects.consume(code);\n        return sequenceClose;\n      }\n      if (size >= sizeOpen) {\n        effects.exit(\"codeFencedFenceSequence\");\n        return markdownSpace(code) ? factorySpace(effects, sequenceCloseAfter, \"whitespace\")(code) : sequenceCloseAfter(code);\n      }\n      return nok(code);\n    }\n\n    /**\n     * After closing fence sequence, after optional whitespace.\n     *\n     * ```markdown\n     *   | ~~~js\n     *   | alert(1)\n     * > | ~~~\n     *        ^\n     * ```\n     *\n     * @type {State}\n     */\n    function sequenceCloseAfter(code) {\n      if (code === null || markdownLineEnding(code)) {\n        effects.exit(\"codeFencedFence\");\n        return ok(code);\n      }\n      return nok(code);\n    }\n  }\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeNonLazyContinuation(effects, ok, nok) {\n  const self = this;\n  return start;\n\n  /**\n   *\n   *\n   * @type {State}\n   */\n  function start(code) {\n    if (code === null) {\n      return nok(code);\n    }\n    effects.enter(\"lineEnding\");\n    effects.consume(code);\n    effects.exit(\"lineEnding\");\n    return lineStart;\n  }\n\n  /**\n   *\n   *\n   * @type {State}\n   */\n  function lineStart(code) {\n    return self.parser.lazy[self.now().line] ? nok(code) : ok(code);\n  }\n}","/// <reference lib=\"dom\" />\n\n/* eslint-env browser */\n\nconst element = document.createElement('i')\n\n/**\n * @param {string} value\n * @returns {string|false}\n */\nexport function decodeNamedCharacterReference(value) {\n  const characterReference = '&' + value + ';'\n  element.innerHTML = characterReference\n  const char = element.textContent\n\n  // Some named character references do not require the closing semicolon\n  // (`&not`, for instance), which leads to situations where parsing the assumed\n  // named reference of `&notit;` will result in the string `¬it;`.\n  // When we encounter a trailing semicolon after parsing, and the character\n  // reference to decode was not a semicolon (`&semi;`), we can assume that the\n  // matching was not complete.\n  // @ts-expect-error: TypeScript is wrong that `textContent` on elements can\n  // yield `null`.\n  if (char.charCodeAt(char.length - 1) === 59 /* `;` */ && value !== 'semi') {\n    return false\n  }\n\n  // If the decoded string is equal to the input, the character reference was\n  // not valid.\n  // @ts-expect-error: TypeScript is wrong that `textContent` on elements can\n  // yield `null`.\n  return char === characterReference ? false : char\n}\n","/**\n * @typedef {import('micromark-util-types').Code} Code\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { decodeNamedCharacterReference } from 'decode-named-character-reference';\nimport { asciiAlphanumeric, asciiDigit, asciiHexDigit } from 'micromark-util-character';\n/** @type {Construct} */\nexport const characterReference = {\n  name: 'characterReference',\n  tokenize: tokenizeCharacterReference\n};\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeCharacterReference(effects, ok, nok) {\n  const self = this;\n  let size = 0;\n  /** @type {number} */\n  let max;\n  /** @type {(code: Code) => boolean} */\n  let test;\n  return start;\n\n  /**\n   * Start of character reference.\n   *\n   * ```markdown\n   * > | a&amp;b\n   *      ^\n   * > | a&#123;b\n   *      ^\n   * > | a&#x9;b\n   *      ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    effects.enter(\"characterReference\");\n    effects.enter(\"characterReferenceMarker\");\n    effects.consume(code);\n    effects.exit(\"characterReferenceMarker\");\n    return open;\n  }\n\n  /**\n   * After `&`, at `#` for numeric references or alphanumeric for named\n   * references.\n   *\n   * ```markdown\n   * > | a&amp;b\n   *       ^\n   * > | a&#123;b\n   *       ^\n   * > | a&#x9;b\n   *       ^\n   * ```\n   *\n   * @type {State}\n   */\n  function open(code) {\n    if (code === 35) {\n      effects.enter(\"characterReferenceMarkerNumeric\");\n      effects.consume(code);\n      effects.exit(\"characterReferenceMarkerNumeric\");\n      return numeric;\n    }\n    effects.enter(\"characterReferenceValue\");\n    max = 31;\n    test = asciiAlphanumeric;\n    return value(code);\n  }\n\n  /**\n   * After `#`, at `x` for hexadecimals or digit for decimals.\n   *\n   * ```markdown\n   * > | a&#123;b\n   *        ^\n   * > | a&#x9;b\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function numeric(code) {\n    if (code === 88 || code === 120) {\n      effects.enter(\"characterReferenceMarkerHexadecimal\");\n      effects.consume(code);\n      effects.exit(\"characterReferenceMarkerHexadecimal\");\n      effects.enter(\"characterReferenceValue\");\n      max = 6;\n      test = asciiHexDigit;\n      return value;\n    }\n    effects.enter(\"characterReferenceValue\");\n    max = 7;\n    test = asciiDigit;\n    return value(code);\n  }\n\n  /**\n   * After markers (`&#x`, `&#`, or `&`), in value, before `;`.\n   *\n   * The character reference kind defines what and how many characters are\n   * allowed.\n   *\n   * ```markdown\n   * > | a&amp;b\n   *       ^^^\n   * > | a&#123;b\n   *        ^^^\n   * > | a&#x9;b\n   *         ^\n   * ```\n   *\n   * @type {State}\n   */\n  function value(code) {\n    if (code === 59 && size) {\n      const token = effects.exit(\"characterReferenceValue\");\n      if (test === asciiAlphanumeric && !decodeNamedCharacterReference(self.sliceSerialize(token))) {\n        return nok(code);\n      }\n\n      // To do: `markdown-rs` uses a different name:\n      // `CharacterReferenceMarkerSemi`.\n      effects.enter(\"characterReferenceMarker\");\n      effects.consume(code);\n      effects.exit(\"characterReferenceMarker\");\n      effects.exit(\"characterReference\");\n      return ok;\n    }\n    if (test(code) && size++ < max) {\n      effects.consume(code);\n      return value;\n    }\n    return nok(code);\n  }\n}","/**\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { asciiPunctuation } from 'micromark-util-character';\n/** @type {Construct} */\nexport const characterEscape = {\n  name: 'characterEscape',\n  tokenize: tokenizeCharacterEscape\n};\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeCharacterEscape(effects, ok, nok) {\n  return start;\n\n  /**\n   * Start of character escape.\n   *\n   * ```markdown\n   * > | a\\*b\n   *      ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    effects.enter(\"characterEscape\");\n    effects.enter(\"escapeMarker\");\n    effects.consume(code);\n    effects.exit(\"escapeMarker\");\n    return inside;\n  }\n\n  /**\n   * After `\\`, at punctuation.\n   *\n   * ```markdown\n   * > | a\\*b\n   *       ^\n   * ```\n   *\n   * @type {State}\n   */\n  function inside(code) {\n    // ASCII punctuation.\n    if (asciiPunctuation(code)) {\n      effects.enter(\"characterEscapeValue\");\n      effects.consume(code);\n      effects.exit(\"characterEscapeValue\");\n      effects.exit(\"characterEscape\");\n      return ok;\n    }\n    return nok(code);\n  }\n}","/**\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { factorySpace } from 'micromark-factory-space';\nimport { markdownLineEnding } from 'micromark-util-character';\n/** @type {Construct} */\nexport const lineEnding = {\n  name: 'lineEnding',\n  tokenize: tokenizeLineEnding\n};\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeLineEnding(effects, ok) {\n  return start;\n\n  /** @type {State} */\n  function start(code) {\n    effects.enter(\"lineEnding\");\n    effects.consume(code);\n    effects.exit(\"lineEnding\");\n    return factorySpace(effects, ok, \"linePrefix\");\n  }\n}","/**\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').Event} Event\n * @typedef {import('micromark-util-types').Resolver} Resolver\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').Token} Token\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { factoryDestination } from 'micromark-factory-destination';\nimport { factoryLabel } from 'micromark-factory-label';\nimport { factoryTitle } from 'micromark-factory-title';\nimport { factoryWhitespace } from 'micromark-factory-whitespace';\nimport { markdownLineEndingOrSpace } from 'micromark-util-character';\nimport { push, splice } from 'micromark-util-chunked';\nimport { normalizeIdentifier } from 'micromark-util-normalize-identifier';\nimport { resolveAll } from 'micromark-util-resolve-all';\n/** @type {Construct} */\nexport const labelEnd = {\n  name: 'labelEnd',\n  tokenize: tokenizeLabelEnd,\n  resolveTo: resolveToLabelEnd,\n  resolveAll: resolveAllLabelEnd\n};\n\n/** @type {Construct} */\nconst resourceConstruct = {\n  tokenize: tokenizeResource\n};\n/** @type {Construct} */\nconst referenceFullConstruct = {\n  tokenize: tokenizeReferenceFull\n};\n/** @type {Construct} */\nconst referenceCollapsedConstruct = {\n  tokenize: tokenizeReferenceCollapsed\n};\n\n/** @type {Resolver} */\nfunction resolveAllLabelEnd(events) {\n  let index = -1;\n  while (++index < events.length) {\n    const token = events[index][1];\n    if (token.type === \"labelImage\" || token.type === \"labelLink\" || token.type === \"labelEnd\") {\n      // Remove the marker.\n      events.splice(index + 1, token.type === \"labelImage\" ? 4 : 2);\n      token.type = \"data\";\n      index++;\n    }\n  }\n  return events;\n}\n\n/** @type {Resolver} */\nfunction resolveToLabelEnd(events, context) {\n  let index = events.length;\n  let offset = 0;\n  /** @type {Token} */\n  let token;\n  /** @type {number | undefined} */\n  let open;\n  /** @type {number | undefined} */\n  let close;\n  /** @type {Array<Event>} */\n  let media;\n\n  // Find an opening.\n  while (index--) {\n    token = events[index][1];\n    if (open) {\n      // If we see another link, or inactive link label, we’ve been here before.\n      if (token.type === \"link\" || token.type === \"labelLink\" && token._inactive) {\n        break;\n      }\n\n      // Mark other link openings as inactive, as we can’t have links in\n      // links.\n      if (events[index][0] === 'enter' && token.type === \"labelLink\") {\n        token._inactive = true;\n      }\n    } else if (close) {\n      if (events[index][0] === 'enter' && (token.type === \"labelImage\" || token.type === \"labelLink\") && !token._balanced) {\n        open = index;\n        if (token.type !== \"labelLink\") {\n          offset = 2;\n          break;\n        }\n      }\n    } else if (token.type === \"labelEnd\") {\n      close = index;\n    }\n  }\n  const group = {\n    type: events[open][1].type === \"labelLink\" ? \"link\" : \"image\",\n    start: Object.assign({}, events[open][1].start),\n    end: Object.assign({}, events[events.length - 1][1].end)\n  };\n  const label = {\n    type: \"label\",\n    start: Object.assign({}, events[open][1].start),\n    end: Object.assign({}, events[close][1].end)\n  };\n  const text = {\n    type: \"labelText\",\n    start: Object.assign({}, events[open + offset + 2][1].end),\n    end: Object.assign({}, events[close - 2][1].start)\n  };\n  media = [['enter', group, context], ['enter', label, context]];\n\n  // Opening marker.\n  media = push(media, events.slice(open + 1, open + offset + 3));\n\n  // Text open.\n  media = push(media, [['enter', text, context]]);\n\n  // Always populated by defaults.\n\n  // Between.\n  media = push(media, resolveAll(context.parser.constructs.insideSpan.null, events.slice(open + offset + 4, close - 3), context));\n\n  // Text close, marker close, label close.\n  media = push(media, [['exit', text, context], events[close - 2], events[close - 1], ['exit', label, context]]);\n\n  // Reference, resource, or so.\n  media = push(media, events.slice(close + 1));\n\n  // Media close.\n  media = push(media, [['exit', group, context]]);\n  splice(events, open, events.length, media);\n  return events;\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeLabelEnd(effects, ok, nok) {\n  const self = this;\n  let index = self.events.length;\n  /** @type {Token} */\n  let labelStart;\n  /** @type {boolean} */\n  let defined;\n\n  // Find an opening.\n  while (index--) {\n    if ((self.events[index][1].type === \"labelImage\" || self.events[index][1].type === \"labelLink\") && !self.events[index][1]._balanced) {\n      labelStart = self.events[index][1];\n      break;\n    }\n  }\n  return start;\n\n  /**\n   * Start of label end.\n   *\n   * ```markdown\n   * > | [a](b) c\n   *       ^\n   * > | [a][b] c\n   *       ^\n   * > | [a][] b\n   *       ^\n   * > | [a] b\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    // If there is not an okay opening.\n    if (!labelStart) {\n      return nok(code);\n    }\n\n    // If the corresponding label (link) start is marked as inactive,\n    // it means we’d be wrapping a link, like this:\n    //\n    // ```markdown\n    // > | a [b [c](d) e](f) g.\n    //                  ^\n    // ```\n    //\n    // We can’t have that, so it’s just balanced brackets.\n    if (labelStart._inactive) {\n      return labelEndNok(code);\n    }\n    defined = self.parser.defined.includes(normalizeIdentifier(self.sliceSerialize({\n      start: labelStart.end,\n      end: self.now()\n    })));\n    effects.enter(\"labelEnd\");\n    effects.enter(\"labelMarker\");\n    effects.consume(code);\n    effects.exit(\"labelMarker\");\n    effects.exit(\"labelEnd\");\n    return after;\n  }\n\n  /**\n   * After `]`.\n   *\n   * ```markdown\n   * > | [a](b) c\n   *       ^\n   * > | [a][b] c\n   *       ^\n   * > | [a][] b\n   *       ^\n   * > | [a] b\n   *       ^\n   * ```\n   *\n   * @type {State}\n   */\n  function after(code) {\n    // Note: `markdown-rs` also parses GFM footnotes here, which for us is in\n    // an extension.\n\n    // Resource (`[asd](fgh)`)?\n    if (code === 40) {\n      return effects.attempt(resourceConstruct, labelEndOk, defined ? labelEndOk : labelEndNok)(code);\n    }\n\n    // Full (`[asd][fgh]`) or collapsed (`[asd][]`) reference?\n    if (code === 91) {\n      return effects.attempt(referenceFullConstruct, labelEndOk, defined ? referenceNotFull : labelEndNok)(code);\n    }\n\n    // Shortcut (`[asd]`) reference?\n    return defined ? labelEndOk(code) : labelEndNok(code);\n  }\n\n  /**\n   * After `]`, at `[`, but not at a full reference.\n   *\n   * > 👉 **Note**: we only get here if the label is defined.\n   *\n   * ```markdown\n   * > | [a][] b\n   *        ^\n   * > | [a] b\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function referenceNotFull(code) {\n    return effects.attempt(referenceCollapsedConstruct, labelEndOk, labelEndNok)(code);\n  }\n\n  /**\n   * Done, we found something.\n   *\n   * ```markdown\n   * > | [a](b) c\n   *           ^\n   * > | [a][b] c\n   *           ^\n   * > | [a][] b\n   *          ^\n   * > | [a] b\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function labelEndOk(code) {\n    // Note: `markdown-rs` does a bunch of stuff here.\n    return ok(code);\n  }\n\n  /**\n   * Done, it’s nothing.\n   *\n   * There was an okay opening, but we didn’t match anything.\n   *\n   * ```markdown\n   * > | [a](b c\n   *        ^\n   * > | [a][b c\n   *        ^\n   * > | [a] b\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function labelEndNok(code) {\n    labelStart._balanced = true;\n    return nok(code);\n  }\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeResource(effects, ok, nok) {\n  return resourceStart;\n\n  /**\n   * At a resource.\n   *\n   * ```markdown\n   * > | [a](b) c\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function resourceStart(code) {\n    effects.enter(\"resource\");\n    effects.enter(\"resourceMarker\");\n    effects.consume(code);\n    effects.exit(\"resourceMarker\");\n    return resourceBefore;\n  }\n\n  /**\n   * In resource, after `(`, at optional whitespace.\n   *\n   * ```markdown\n   * > | [a](b) c\n   *         ^\n   * ```\n   *\n   * @type {State}\n   */\n  function resourceBefore(code) {\n    return markdownLineEndingOrSpace(code) ? factoryWhitespace(effects, resourceOpen)(code) : resourceOpen(code);\n  }\n\n  /**\n   * In resource, after optional whitespace, at `)` or a destination.\n   *\n   * ```markdown\n   * > | [a](b) c\n   *         ^\n   * ```\n   *\n   * @type {State}\n   */\n  function resourceOpen(code) {\n    if (code === 41) {\n      return resourceEnd(code);\n    }\n    return factoryDestination(effects, resourceDestinationAfter, resourceDestinationMissing, \"resourceDestination\", \"resourceDestinationLiteral\", \"resourceDestinationLiteralMarker\", \"resourceDestinationRaw\", \"resourceDestinationString\", 32)(code);\n  }\n\n  /**\n   * In resource, after destination, at optional whitespace.\n   *\n   * ```markdown\n   * > | [a](b) c\n   *          ^\n   * ```\n   *\n   * @type {State}\n   */\n  function resourceDestinationAfter(code) {\n    return markdownLineEndingOrSpace(code) ? factoryWhitespace(effects, resourceBetween)(code) : resourceEnd(code);\n  }\n\n  /**\n   * At invalid destination.\n   *\n   * ```markdown\n   * > | [a](<<) b\n   *         ^\n   * ```\n   *\n   * @type {State}\n   */\n  function resourceDestinationMissing(code) {\n    return nok(code);\n  }\n\n  /**\n   * In resource, after destination and whitespace, at `(` or title.\n   *\n   * ```markdown\n   * > | [a](b ) c\n   *           ^\n   * ```\n   *\n   * @type {State}\n   */\n  function resourceBetween(code) {\n    if (code === 34 || code === 39 || code === 40) {\n      return factoryTitle(effects, resourceTitleAfter, nok, \"resourceTitle\", \"resourceTitleMarker\", \"resourceTitleString\")(code);\n    }\n    return resourceEnd(code);\n  }\n\n  /**\n   * In resource, after title, at optional whitespace.\n   *\n   * ```markdown\n   * > | [a](b \"c\") d\n   *              ^\n   * ```\n   *\n   * @type {State}\n   */\n  function resourceTitleAfter(code) {\n    return markdownLineEndingOrSpace(code) ? factoryWhitespace(effects, resourceEnd)(code) : resourceEnd(code);\n  }\n\n  /**\n   * In resource, at `)`.\n   *\n   * ```markdown\n   * > | [a](b) d\n   *          ^\n   * ```\n   *\n   * @type {State}\n   */\n  function resourceEnd(code) {\n    if (code === 41) {\n      effects.enter(\"resourceMarker\");\n      effects.consume(code);\n      effects.exit(\"resourceMarker\");\n      effects.exit(\"resource\");\n      return ok;\n    }\n    return nok(code);\n  }\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeReferenceFull(effects, ok, nok) {\n  const self = this;\n  return referenceFull;\n\n  /**\n   * In a reference (full), at the `[`.\n   *\n   * ```markdown\n   * > | [a][b] d\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function referenceFull(code) {\n    return factoryLabel.call(self, effects, referenceFullAfter, referenceFullMissing, \"reference\", \"referenceMarker\", \"referenceString\")(code);\n  }\n\n  /**\n   * In a reference (full), after `]`.\n   *\n   * ```markdown\n   * > | [a][b] d\n   *          ^\n   * ```\n   *\n   * @type {State}\n   */\n  function referenceFullAfter(code) {\n    return self.parser.defined.includes(normalizeIdentifier(self.sliceSerialize(self.events[self.events.length - 1][1]).slice(1, -1))) ? ok(code) : nok(code);\n  }\n\n  /**\n   * In reference (full) that was missing.\n   *\n   * ```markdown\n   * > | [a][b d\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function referenceFullMissing(code) {\n    return nok(code);\n  }\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeReferenceCollapsed(effects, ok, nok) {\n  return referenceCollapsedStart;\n\n  /**\n   * In reference (collapsed), at `[`.\n   *\n   * > 👉 **Note**: we only get here if the label is defined.\n   *\n   * ```markdown\n   * > | [a][] d\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function referenceCollapsedStart(code) {\n    // We only attempt a collapsed label if there’s a `[`.\n\n    effects.enter(\"reference\");\n    effects.enter(\"referenceMarker\");\n    effects.consume(code);\n    effects.exit(\"referenceMarker\");\n    return referenceCollapsedOpen;\n  }\n\n  /**\n   * In reference (collapsed), at `]`.\n   *\n   * > 👉 **Note**: we only get here if the label is defined.\n   *\n   * ```markdown\n   * > | [a][] d\n   *         ^\n   * ```\n   *\n   *  @type {State}\n   */\n  function referenceCollapsedOpen(code) {\n    if (code === 93) {\n      effects.enter(\"referenceMarker\");\n      effects.consume(code);\n      effects.exit(\"referenceMarker\");\n      effects.exit(\"reference\");\n      return ok;\n    }\n    return nok(code);\n  }\n}","/**\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { labelEnd } from './label-end.js';\n\n/** @type {Construct} */\nexport const labelStartImage = {\n  name: 'labelStartImage',\n  tokenize: tokenizeLabelStartImage,\n  resolveAll: labelEnd.resolveAll\n};\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeLabelStartImage(effects, ok, nok) {\n  const self = this;\n  return start;\n\n  /**\n   * Start of label (image) start.\n   *\n   * ```markdown\n   * > | a ![b] c\n   *       ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    effects.enter(\"labelImage\");\n    effects.enter(\"labelImageMarker\");\n    effects.consume(code);\n    effects.exit(\"labelImageMarker\");\n    return open;\n  }\n\n  /**\n   * After `!`, at `[`.\n   *\n   * ```markdown\n   * > | a ![b] c\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function open(code) {\n    if (code === 91) {\n      effects.enter(\"labelMarker\");\n      effects.consume(code);\n      effects.exit(\"labelMarker\");\n      effects.exit(\"labelImage\");\n      return after;\n    }\n    return nok(code);\n  }\n\n  /**\n   * After `![`.\n   *\n   * ```markdown\n   * > | a ![b] c\n   *         ^\n   * ```\n   *\n   * This is needed in because, when GFM footnotes are enabled, images never\n   * form when started with a `^`.\n   * Instead, links form:\n   *\n   * ```markdown\n   * ![^a](b)\n   *\n   * ![^a][b]\n   *\n   * [b]: c\n   * ```\n   *\n   * ```html\n   * <p>!<a href=\\\"b\\\">^a</a></p>\n   * <p>!<a href=\\\"c\\\">^a</a></p>\n   * ```\n   *\n   * @type {State}\n   */\n  function after(code) {\n    // To do: use a new field to do this, this is still needed for\n    // `micromark-extension-gfm-footnote`, but the `label-start-link`\n    // behavior isn’t.\n    // Hidden footnotes hook.\n    /* c8 ignore next 3 */\n    return code === 94 && '_hiddenFootnoteSupport' in self.parser.constructs ? nok(code) : ok(code);\n  }\n}","/**\n * @typedef {import('micromark-util-types').Code} Code\n */\n\nimport {\n  markdownLineEndingOrSpace,\n  unicodePunctuation,\n  unicodeWhitespace\n} from 'micromark-util-character'\n/**\n * Classify whether a code represents whitespace, punctuation, or something\n * else.\n *\n * Used for attention (emphasis, strong), whose sequences can open or close\n * based on the class of surrounding characters.\n *\n * > 👉 **Note**: eof (`null`) is seen as whitespace.\n *\n * @param {Code} code\n *   Code.\n * @returns {typeof constants.characterGroupWhitespace | typeof constants.characterGroupPunctuation | undefined}\n *   Group.\n */\nexport function classifyCharacter(code) {\n  if (\n    code === null ||\n    markdownLineEndingOrSpace(code) ||\n    unicodeWhitespace(code)\n  ) {\n    return 1\n  }\n  if (unicodePunctuation(code)) {\n    return 2\n  }\n}\n","/**\n * @typedef {import('micromark-util-types').Code} Code\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').Event} Event\n * @typedef {import('micromark-util-types').Point} Point\n * @typedef {import('micromark-util-types').Resolver} Resolver\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').Token} Token\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { push, splice } from 'micromark-util-chunked';\nimport { classifyCharacter } from 'micromark-util-classify-character';\nimport { resolveAll } from 'micromark-util-resolve-all';\n/** @type {Construct} */\nexport const attention = {\n  name: 'attention',\n  tokenize: tokenizeAttention,\n  resolveAll: resolveAllAttention\n};\n\n/**\n * Take all events and resolve attention to emphasis or strong.\n *\n * @type {Resolver}\n */\n// eslint-disable-next-line complexity\nfunction resolveAllAttention(events, context) {\n  let index = -1;\n  /** @type {number} */\n  let open;\n  /** @type {Token} */\n  let group;\n  /** @type {Token} */\n  let text;\n  /** @type {Token} */\n  let openingSequence;\n  /** @type {Token} */\n  let closingSequence;\n  /** @type {number} */\n  let use;\n  /** @type {Array<Event>} */\n  let nextEvents;\n  /** @type {number} */\n  let offset;\n\n  // Walk through all events.\n  //\n  // Note: performance of this is fine on an mb of normal markdown, but it’s\n  // a bottleneck for malicious stuff.\n  while (++index < events.length) {\n    // Find a token that can close.\n    if (events[index][0] === 'enter' && events[index][1].type === 'attentionSequence' && events[index][1]._close) {\n      open = index;\n\n      // Now walk back to find an opener.\n      while (open--) {\n        // Find a token that can open the closer.\n        if (events[open][0] === 'exit' && events[open][1].type === 'attentionSequence' && events[open][1]._open &&\n        // If the markers are the same:\n        context.sliceSerialize(events[open][1]).charCodeAt(0) === context.sliceSerialize(events[index][1]).charCodeAt(0)) {\n          // If the opening can close or the closing can open,\n          // and the close size *is not* a multiple of three,\n          // but the sum of the opening and closing size *is* multiple of three,\n          // then don’t match.\n          if ((events[open][1]._close || events[index][1]._open) && (events[index][1].end.offset - events[index][1].start.offset) % 3 && !((events[open][1].end.offset - events[open][1].start.offset + events[index][1].end.offset - events[index][1].start.offset) % 3)) {\n            continue;\n          }\n\n          // Number of markers to use from the sequence.\n          use = events[open][1].end.offset - events[open][1].start.offset > 1 && events[index][1].end.offset - events[index][1].start.offset > 1 ? 2 : 1;\n          const start = Object.assign({}, events[open][1].end);\n          const end = Object.assign({}, events[index][1].start);\n          movePoint(start, -use);\n          movePoint(end, use);\n          openingSequence = {\n            type: use > 1 ? \"strongSequence\" : \"emphasisSequence\",\n            start,\n            end: Object.assign({}, events[open][1].end)\n          };\n          closingSequence = {\n            type: use > 1 ? \"strongSequence\" : \"emphasisSequence\",\n            start: Object.assign({}, events[index][1].start),\n            end\n          };\n          text = {\n            type: use > 1 ? \"strongText\" : \"emphasisText\",\n            start: Object.assign({}, events[open][1].end),\n            end: Object.assign({}, events[index][1].start)\n          };\n          group = {\n            type: use > 1 ? \"strong\" : \"emphasis\",\n            start: Object.assign({}, openingSequence.start),\n            end: Object.assign({}, closingSequence.end)\n          };\n          events[open][1].end = Object.assign({}, openingSequence.start);\n          events[index][1].start = Object.assign({}, closingSequence.end);\n          nextEvents = [];\n\n          // If there are more markers in the opening, add them before.\n          if (events[open][1].end.offset - events[open][1].start.offset) {\n            nextEvents = push(nextEvents, [['enter', events[open][1], context], ['exit', events[open][1], context]]);\n          }\n\n          // Opening.\n          nextEvents = push(nextEvents, [['enter', group, context], ['enter', openingSequence, context], ['exit', openingSequence, context], ['enter', text, context]]);\n\n          // Always populated by defaults.\n\n          // Between.\n          nextEvents = push(nextEvents, resolveAll(context.parser.constructs.insideSpan.null, events.slice(open + 1, index), context));\n\n          // Closing.\n          nextEvents = push(nextEvents, [['exit', text, context], ['enter', closingSequence, context], ['exit', closingSequence, context], ['exit', group, context]]);\n\n          // If there are more markers in the closing, add them after.\n          if (events[index][1].end.offset - events[index][1].start.offset) {\n            offset = 2;\n            nextEvents = push(nextEvents, [['enter', events[index][1], context], ['exit', events[index][1], context]]);\n          } else {\n            offset = 0;\n          }\n          splice(events, open - 1, index - open + 3, nextEvents);\n          index = open + nextEvents.length - offset - 2;\n          break;\n        }\n      }\n    }\n  }\n\n  // Remove remaining sequences.\n  index = -1;\n  while (++index < events.length) {\n    if (events[index][1].type === 'attentionSequence') {\n      events[index][1].type = 'data';\n    }\n  }\n  return events;\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeAttention(effects, ok) {\n  const attentionMarkers = this.parser.constructs.attentionMarkers.null;\n  const previous = this.previous;\n  const before = classifyCharacter(previous);\n\n  /** @type {NonNullable<Code>} */\n  let marker;\n  return start;\n\n  /**\n   * Before a sequence.\n   *\n   * ```markdown\n   * > | **\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    marker = code;\n    effects.enter('attentionSequence');\n    return inside(code);\n  }\n\n  /**\n   * In a sequence.\n   *\n   * ```markdown\n   * > | **\n   *     ^^\n   * ```\n   *\n   * @type {State}\n   */\n  function inside(code) {\n    if (code === marker) {\n      effects.consume(code);\n      return inside;\n    }\n    const token = effects.exit('attentionSequence');\n\n    // To do: next major: move this to resolver, just like `markdown-rs`.\n    const after = classifyCharacter(code);\n\n    // Always populated by defaults.\n\n    const open = !after || after === 2 && before || attentionMarkers.includes(code);\n    const close = !before || before === 2 && after || attentionMarkers.includes(previous);\n    token._open = Boolean(marker === 42 ? open : open && (before || !close));\n    token._close = Boolean(marker === 42 ? close : close && (after || !open));\n    return ok(code);\n  }\n}\n\n/**\n * Move a point a bit.\n *\n * Note: `move` only works inside lines! It’s not possible to move past other\n * chunks (replacement characters, tabs, or line endings).\n *\n * @param {Point} point\n * @param {number} offset\n * @returns {undefined}\n */\nfunction movePoint(point, offset) {\n  point.column += offset;\n  point.offset += offset;\n  point._bufferIndex += offset;\n}","/**\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { asciiAlpha, asciiAlphanumeric, asciiAtext, asciiControl } from 'micromark-util-character';\n/** @type {Construct} */\nexport const autolink = {\n  name: 'autolink',\n  tokenize: tokenizeAutolink\n};\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeAutolink(effects, ok, nok) {\n  let size = 0;\n  return start;\n\n  /**\n   * Start of an autolink.\n   *\n   * ```markdown\n   * > | a<https://example.com>b\n   *      ^\n   * > | a<user@example.com>b\n   *      ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    effects.enter(\"autolink\");\n    effects.enter(\"autolinkMarker\");\n    effects.consume(code);\n    effects.exit(\"autolinkMarker\");\n    effects.enter(\"autolinkProtocol\");\n    return open;\n  }\n\n  /**\n   * After `<`, at protocol or atext.\n   *\n   * ```markdown\n   * > | a<https://example.com>b\n   *       ^\n   * > | a<user@example.com>b\n   *       ^\n   * ```\n   *\n   * @type {State}\n   */\n  function open(code) {\n    if (asciiAlpha(code)) {\n      effects.consume(code);\n      return schemeOrEmailAtext;\n    }\n    if (code === 64) {\n      return nok(code);\n    }\n    return emailAtext(code);\n  }\n\n  /**\n   * At second byte of protocol or atext.\n   *\n   * ```markdown\n   * > | a<https://example.com>b\n   *        ^\n   * > | a<user@example.com>b\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function schemeOrEmailAtext(code) {\n    // ASCII alphanumeric and `+`, `-`, and `.`.\n    if (code === 43 || code === 45 || code === 46 || asciiAlphanumeric(code)) {\n      // Count the previous alphabetical from `open` too.\n      size = 1;\n      return schemeInsideOrEmailAtext(code);\n    }\n    return emailAtext(code);\n  }\n\n  /**\n   * In ambiguous protocol or atext.\n   *\n   * ```markdown\n   * > | a<https://example.com>b\n   *        ^\n   * > | a<user@example.com>b\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function schemeInsideOrEmailAtext(code) {\n    if (code === 58) {\n      effects.consume(code);\n      size = 0;\n      return urlInside;\n    }\n\n    // ASCII alphanumeric and `+`, `-`, and `.`.\n    if ((code === 43 || code === 45 || code === 46 || asciiAlphanumeric(code)) && size++ < 32) {\n      effects.consume(code);\n      return schemeInsideOrEmailAtext;\n    }\n    size = 0;\n    return emailAtext(code);\n  }\n\n  /**\n   * After protocol, in URL.\n   *\n   * ```markdown\n   * > | a<https://example.com>b\n   *             ^\n   * ```\n   *\n   * @type {State}\n   */\n  function urlInside(code) {\n    if (code === 62) {\n      effects.exit(\"autolinkProtocol\");\n      effects.enter(\"autolinkMarker\");\n      effects.consume(code);\n      effects.exit(\"autolinkMarker\");\n      effects.exit(\"autolink\");\n      return ok;\n    }\n\n    // ASCII control, space, or `<`.\n    if (code === null || code === 32 || code === 60 || asciiControl(code)) {\n      return nok(code);\n    }\n    effects.consume(code);\n    return urlInside;\n  }\n\n  /**\n   * In email atext.\n   *\n   * ```markdown\n   * > | a<user.name@example.com>b\n   *              ^\n   * ```\n   *\n   * @type {State}\n   */\n  function emailAtext(code) {\n    if (code === 64) {\n      effects.consume(code);\n      return emailAtSignOrDot;\n    }\n    if (asciiAtext(code)) {\n      effects.consume(code);\n      return emailAtext;\n    }\n    return nok(code);\n  }\n\n  /**\n   * In label, after at-sign or dot.\n   *\n   * ```markdown\n   * > | a<user.name@example.com>b\n   *                 ^       ^\n   * ```\n   *\n   * @type {State}\n   */\n  function emailAtSignOrDot(code) {\n    return asciiAlphanumeric(code) ? emailLabel(code) : nok(code);\n  }\n\n  /**\n   * In label, where `.` and `>` are allowed.\n   *\n   * ```markdown\n   * > | a<user.name@example.com>b\n   *                   ^\n   * ```\n   *\n   * @type {State}\n   */\n  function emailLabel(code) {\n    if (code === 46) {\n      effects.consume(code);\n      size = 0;\n      return emailAtSignOrDot;\n    }\n    if (code === 62) {\n      // Exit, then change the token type.\n      effects.exit(\"autolinkProtocol\").type = \"autolinkEmail\";\n      effects.enter(\"autolinkMarker\");\n      effects.consume(code);\n      effects.exit(\"autolinkMarker\");\n      effects.exit(\"autolink\");\n      return ok;\n    }\n    return emailValue(code);\n  }\n\n  /**\n   * In label, where `.` and `>` are *not* allowed.\n   *\n   * Though, this is also used in `emailLabel` to parse other values.\n   *\n   * ```markdown\n   * > | a<user.name@ex-ample.com>b\n   *                    ^\n   * ```\n   *\n   * @type {State}\n   */\n  function emailValue(code) {\n    // ASCII alphanumeric or `-`.\n    if ((code === 45 || asciiAlphanumeric(code)) && size++ < 63) {\n      const next = code === 45 ? emailValue : emailLabel;\n      effects.consume(code);\n      return next;\n    }\n    return nok(code);\n  }\n}","/**\n * @typedef {import('micromark-util-types').Code} Code\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { factorySpace } from 'micromark-factory-space';\nimport { asciiAlpha, asciiAlphanumeric, markdownLineEnding, markdownLineEndingOrSpace, markdownSpace } from 'micromark-util-character';\n/** @type {Construct} */\nexport const htmlText = {\n  name: 'htmlText',\n  tokenize: tokenizeHtmlText\n};\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeHtmlText(effects, ok, nok) {\n  const self = this;\n  /** @type {NonNullable<Code> | undefined} */\n  let marker;\n  /** @type {number} */\n  let index;\n  /** @type {State} */\n  let returnState;\n  return start;\n\n  /**\n   * Start of HTML (text).\n   *\n   * ```markdown\n   * > | a <b> c\n   *       ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    effects.enter(\"htmlText\");\n    effects.enter(\"htmlTextData\");\n    effects.consume(code);\n    return open;\n  }\n\n  /**\n   * After `<`, at tag name or other stuff.\n   *\n   * ```markdown\n   * > | a <b> c\n   *        ^\n   * > | a <!doctype> c\n   *        ^\n   * > | a <!--b--> c\n   *        ^\n   * ```\n   *\n   * @type {State}\n   */\n  function open(code) {\n    if (code === 33) {\n      effects.consume(code);\n      return declarationOpen;\n    }\n    if (code === 47) {\n      effects.consume(code);\n      return tagCloseStart;\n    }\n    if (code === 63) {\n      effects.consume(code);\n      return instruction;\n    }\n\n    // ASCII alphabetical.\n    if (asciiAlpha(code)) {\n      effects.consume(code);\n      return tagOpen;\n    }\n    return nok(code);\n  }\n\n  /**\n   * After `<!`, at declaration, comment, or CDATA.\n   *\n   * ```markdown\n   * > | a <!doctype> c\n   *         ^\n   * > | a <!--b--> c\n   *         ^\n   * > | a <![CDATA[>&<]]> c\n   *         ^\n   * ```\n   *\n   * @type {State}\n   */\n  function declarationOpen(code) {\n    if (code === 45) {\n      effects.consume(code);\n      return commentOpenInside;\n    }\n    if (code === 91) {\n      effects.consume(code);\n      index = 0;\n      return cdataOpenInside;\n    }\n    if (asciiAlpha(code)) {\n      effects.consume(code);\n      return declaration;\n    }\n    return nok(code);\n  }\n\n  /**\n   * In a comment, after `<!-`, at another `-`.\n   *\n   * ```markdown\n   * > | a <!--b--> c\n   *          ^\n   * ```\n   *\n   * @type {State}\n   */\n  function commentOpenInside(code) {\n    if (code === 45) {\n      effects.consume(code);\n      return commentEnd;\n    }\n    return nok(code);\n  }\n\n  /**\n   * In comment.\n   *\n   * ```markdown\n   * > | a <!--b--> c\n   *           ^\n   * ```\n   *\n   * @type {State}\n   */\n  function comment(code) {\n    if (code === null) {\n      return nok(code);\n    }\n    if (code === 45) {\n      effects.consume(code);\n      return commentClose;\n    }\n    if (markdownLineEnding(code)) {\n      returnState = comment;\n      return lineEndingBefore(code);\n    }\n    effects.consume(code);\n    return comment;\n  }\n\n  /**\n   * In comment, after `-`.\n   *\n   * ```markdown\n   * > | a <!--b--> c\n   *             ^\n   * ```\n   *\n   * @type {State}\n   */\n  function commentClose(code) {\n    if (code === 45) {\n      effects.consume(code);\n      return commentEnd;\n    }\n    return comment(code);\n  }\n\n  /**\n   * In comment, after `--`.\n   *\n   * ```markdown\n   * > | a <!--b--> c\n   *              ^\n   * ```\n   *\n   * @type {State}\n   */\n  function commentEnd(code) {\n    return code === 62 ? end(code) : code === 45 ? commentClose(code) : comment(code);\n  }\n\n  /**\n   * After `<![`, in CDATA, expecting `CDATA[`.\n   *\n   * ```markdown\n   * > | a <![CDATA[>&<]]> b\n   *          ^^^^^^\n   * ```\n   *\n   * @type {State}\n   */\n  function cdataOpenInside(code) {\n    const value = \"CDATA[\";\n    if (code === value.charCodeAt(index++)) {\n      effects.consume(code);\n      return index === value.length ? cdata : cdataOpenInside;\n    }\n    return nok(code);\n  }\n\n  /**\n   * In CDATA.\n   *\n   * ```markdown\n   * > | a <![CDATA[>&<]]> b\n   *                ^^^\n   * ```\n   *\n   * @type {State}\n   */\n  function cdata(code) {\n    if (code === null) {\n      return nok(code);\n    }\n    if (code === 93) {\n      effects.consume(code);\n      return cdataClose;\n    }\n    if (markdownLineEnding(code)) {\n      returnState = cdata;\n      return lineEndingBefore(code);\n    }\n    effects.consume(code);\n    return cdata;\n  }\n\n  /**\n   * In CDATA, after `]`, at another `]`.\n   *\n   * ```markdown\n   * > | a <![CDATA[>&<]]> b\n   *                    ^\n   * ```\n   *\n   * @type {State}\n   */\n  function cdataClose(code) {\n    if (code === 93) {\n      effects.consume(code);\n      return cdataEnd;\n    }\n    return cdata(code);\n  }\n\n  /**\n   * In CDATA, after `]]`, at `>`.\n   *\n   * ```markdown\n   * > | a <![CDATA[>&<]]> b\n   *                     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function cdataEnd(code) {\n    if (code === 62) {\n      return end(code);\n    }\n    if (code === 93) {\n      effects.consume(code);\n      return cdataEnd;\n    }\n    return cdata(code);\n  }\n\n  /**\n   * In declaration.\n   *\n   * ```markdown\n   * > | a <!b> c\n   *          ^\n   * ```\n   *\n   * @type {State}\n   */\n  function declaration(code) {\n    if (code === null || code === 62) {\n      return end(code);\n    }\n    if (markdownLineEnding(code)) {\n      returnState = declaration;\n      return lineEndingBefore(code);\n    }\n    effects.consume(code);\n    return declaration;\n  }\n\n  /**\n   * In instruction.\n   *\n   * ```markdown\n   * > | a <?b?> c\n   *         ^\n   * ```\n   *\n   * @type {State}\n   */\n  function instruction(code) {\n    if (code === null) {\n      return nok(code);\n    }\n    if (code === 63) {\n      effects.consume(code);\n      return instructionClose;\n    }\n    if (markdownLineEnding(code)) {\n      returnState = instruction;\n      return lineEndingBefore(code);\n    }\n    effects.consume(code);\n    return instruction;\n  }\n\n  /**\n   * In instruction, after `?`, at `>`.\n   *\n   * ```markdown\n   * > | a <?b?> c\n   *           ^\n   * ```\n   *\n   * @type {State}\n   */\n  function instructionClose(code) {\n    return code === 62 ? end(code) : instruction(code);\n  }\n\n  /**\n   * After `</`, in closing tag, at tag name.\n   *\n   * ```markdown\n   * > | a </b> c\n   *         ^\n   * ```\n   *\n   * @type {State}\n   */\n  function tagCloseStart(code) {\n    // ASCII alphabetical.\n    if (asciiAlpha(code)) {\n      effects.consume(code);\n      return tagClose;\n    }\n    return nok(code);\n  }\n\n  /**\n   * After `</x`, in a tag name.\n   *\n   * ```markdown\n   * > | a </b> c\n   *          ^\n   * ```\n   *\n   * @type {State}\n   */\n  function tagClose(code) {\n    // ASCII alphanumerical and `-`.\n    if (code === 45 || asciiAlphanumeric(code)) {\n      effects.consume(code);\n      return tagClose;\n    }\n    return tagCloseBetween(code);\n  }\n\n  /**\n   * In closing tag, after tag name.\n   *\n   * ```markdown\n   * > | a </b> c\n   *          ^\n   * ```\n   *\n   * @type {State}\n   */\n  function tagCloseBetween(code) {\n    if (markdownLineEnding(code)) {\n      returnState = tagCloseBetween;\n      return lineEndingBefore(code);\n    }\n    if (markdownSpace(code)) {\n      effects.consume(code);\n      return tagCloseBetween;\n    }\n    return end(code);\n  }\n\n  /**\n   * After `<x`, in opening tag name.\n   *\n   * ```markdown\n   * > | a <b> c\n   *         ^\n   * ```\n   *\n   * @type {State}\n   */\n  function tagOpen(code) {\n    // ASCII alphanumerical and `-`.\n    if (code === 45 || asciiAlphanumeric(code)) {\n      effects.consume(code);\n      return tagOpen;\n    }\n    if (code === 47 || code === 62 || markdownLineEndingOrSpace(code)) {\n      return tagOpenBetween(code);\n    }\n    return nok(code);\n  }\n\n  /**\n   * In opening tag, after tag name.\n   *\n   * ```markdown\n   * > | a <b> c\n   *         ^\n   * ```\n   *\n   * @type {State}\n   */\n  function tagOpenBetween(code) {\n    if (code === 47) {\n      effects.consume(code);\n      return end;\n    }\n\n    // ASCII alphabetical and `:` and `_`.\n    if (code === 58 || code === 95 || asciiAlpha(code)) {\n      effects.consume(code);\n      return tagOpenAttributeName;\n    }\n    if (markdownLineEnding(code)) {\n      returnState = tagOpenBetween;\n      return lineEndingBefore(code);\n    }\n    if (markdownSpace(code)) {\n      effects.consume(code);\n      return tagOpenBetween;\n    }\n    return end(code);\n  }\n\n  /**\n   * In attribute name.\n   *\n   * ```markdown\n   * > | a <b c> d\n   *          ^\n   * ```\n   *\n   * @type {State}\n   */\n  function tagOpenAttributeName(code) {\n    // ASCII alphabetical and `-`, `.`, `:`, and `_`.\n    if (code === 45 || code === 46 || code === 58 || code === 95 || asciiAlphanumeric(code)) {\n      effects.consume(code);\n      return tagOpenAttributeName;\n    }\n    return tagOpenAttributeNameAfter(code);\n  }\n\n  /**\n   * After attribute name, before initializer, the end of the tag, or\n   * whitespace.\n   *\n   * ```markdown\n   * > | a <b c> d\n   *           ^\n   * ```\n   *\n   * @type {State}\n   */\n  function tagOpenAttributeNameAfter(code) {\n    if (code === 61) {\n      effects.consume(code);\n      return tagOpenAttributeValueBefore;\n    }\n    if (markdownLineEnding(code)) {\n      returnState = tagOpenAttributeNameAfter;\n      return lineEndingBefore(code);\n    }\n    if (markdownSpace(code)) {\n      effects.consume(code);\n      return tagOpenAttributeNameAfter;\n    }\n    return tagOpenBetween(code);\n  }\n\n  /**\n   * Before unquoted, double quoted, or single quoted attribute value, allowing\n   * whitespace.\n   *\n   * ```markdown\n   * > | a <b c=d> e\n   *            ^\n   * ```\n   *\n   * @type {State}\n   */\n  function tagOpenAttributeValueBefore(code) {\n    if (code === null || code === 60 || code === 61 || code === 62 || code === 96) {\n      return nok(code);\n    }\n    if (code === 34 || code === 39) {\n      effects.consume(code);\n      marker = code;\n      return tagOpenAttributeValueQuoted;\n    }\n    if (markdownLineEnding(code)) {\n      returnState = tagOpenAttributeValueBefore;\n      return lineEndingBefore(code);\n    }\n    if (markdownSpace(code)) {\n      effects.consume(code);\n      return tagOpenAttributeValueBefore;\n    }\n    effects.consume(code);\n    return tagOpenAttributeValueUnquoted;\n  }\n\n  /**\n   * In double or single quoted attribute value.\n   *\n   * ```markdown\n   * > | a <b c=\"d\"> e\n   *             ^\n   * ```\n   *\n   * @type {State}\n   */\n  function tagOpenAttributeValueQuoted(code) {\n    if (code === marker) {\n      effects.consume(code);\n      marker = undefined;\n      return tagOpenAttributeValueQuotedAfter;\n    }\n    if (code === null) {\n      return nok(code);\n    }\n    if (markdownLineEnding(code)) {\n      returnState = tagOpenAttributeValueQuoted;\n      return lineEndingBefore(code);\n    }\n    effects.consume(code);\n    return tagOpenAttributeValueQuoted;\n  }\n\n  /**\n   * In unquoted attribute value.\n   *\n   * ```markdown\n   * > | a <b c=d> e\n   *            ^\n   * ```\n   *\n   * @type {State}\n   */\n  function tagOpenAttributeValueUnquoted(code) {\n    if (code === null || code === 34 || code === 39 || code === 60 || code === 61 || code === 96) {\n      return nok(code);\n    }\n    if (code === 47 || code === 62 || markdownLineEndingOrSpace(code)) {\n      return tagOpenBetween(code);\n    }\n    effects.consume(code);\n    return tagOpenAttributeValueUnquoted;\n  }\n\n  /**\n   * After double or single quoted attribute value, before whitespace or the end\n   * of the tag.\n   *\n   * ```markdown\n   * > | a <b c=\"d\"> e\n   *               ^\n   * ```\n   *\n   * @type {State}\n   */\n  function tagOpenAttributeValueQuotedAfter(code) {\n    if (code === 47 || code === 62 || markdownLineEndingOrSpace(code)) {\n      return tagOpenBetween(code);\n    }\n    return nok(code);\n  }\n\n  /**\n   * In certain circumstances of a tag where only an `>` is allowed.\n   *\n   * ```markdown\n   * > | a <b c=\"d\"> e\n   *               ^\n   * ```\n   *\n   * @type {State}\n   */\n  function end(code) {\n    if (code === 62) {\n      effects.consume(code);\n      effects.exit(\"htmlTextData\");\n      effects.exit(\"htmlText\");\n      return ok;\n    }\n    return nok(code);\n  }\n\n  /**\n   * At eol.\n   *\n   * > 👉 **Note**: we can’t have blank lines in text, so no need to worry about\n   * > empty tokens.\n   *\n   * ```markdown\n   * > | a <!--a\n   *            ^\n   *   | b-->\n   * ```\n   *\n   * @type {State}\n   */\n  function lineEndingBefore(code) {\n    effects.exit(\"htmlTextData\");\n    effects.enter(\"lineEnding\");\n    effects.consume(code);\n    effects.exit(\"lineEnding\");\n    return lineEndingAfter;\n  }\n\n  /**\n   * After eol, at optional whitespace.\n   *\n   * > 👉 **Note**: we can’t have blank lines in text, so no need to worry about\n   * > empty tokens.\n   *\n   * ```markdown\n   *   | a <!--a\n   * > | b-->\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function lineEndingAfter(code) {\n    // Always populated by defaults.\n\n    return markdownSpace(code) ? factorySpace(effects, lineEndingAfterPrefix, \"linePrefix\", self.parser.constructs.disable.null.includes('codeIndented') ? undefined : 4)(code) : lineEndingAfterPrefix(code);\n  }\n\n  /**\n   * After eol, after optional whitespace.\n   *\n   * > 👉 **Note**: we can’t have blank lines in text, so no need to worry about\n   * > empty tokens.\n   *\n   * ```markdown\n   *   | a <!--a\n   * > | b-->\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function lineEndingAfterPrefix(code) {\n    effects.enter(\"htmlTextData\");\n    return returnState(code);\n  }\n}","/**\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { labelEnd } from './label-end.js';\n\n/** @type {Construct} */\nexport const labelStartLink = {\n  name: 'labelStartLink',\n  tokenize: tokenizeLabelStartLink,\n  resolveAll: labelEnd.resolveAll\n};\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeLabelStartLink(effects, ok, nok) {\n  const self = this;\n  return start;\n\n  /**\n   * Start of label (link) start.\n   *\n   * ```markdown\n   * > | a [b] c\n   *       ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    effects.enter(\"labelLink\");\n    effects.enter(\"labelMarker\");\n    effects.consume(code);\n    effects.exit(\"labelMarker\");\n    effects.exit(\"labelLink\");\n    return after;\n  }\n\n  /** @type {State} */\n  function after(code) {\n    // To do: this isn’t needed in `micromark-extension-gfm-footnote`,\n    // remove.\n    // Hidden footnotes hook.\n    /* c8 ignore next 3 */\n    return code === 94 && '_hiddenFootnoteSupport' in self.parser.constructs ? nok(code) : ok(code);\n  }\n}","/**\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { markdownLineEnding } from 'micromark-util-character';\n/** @type {Construct} */\nexport const hardBreakEscape = {\n  name: 'hardBreakEscape',\n  tokenize: tokenizeHardBreakEscape\n};\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeHardBreakEscape(effects, ok, nok) {\n  return start;\n\n  /**\n   * Start of a hard break (escape).\n   *\n   * ```markdown\n   * > | a\\\n   *      ^\n   *   | b\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    effects.enter(\"hardBreakEscape\");\n    effects.consume(code);\n    return after;\n  }\n\n  /**\n   * After `\\`, at eol.\n   *\n   * ```markdown\n   * > | a\\\n   *       ^\n   *   | b\n   * ```\n   *\n   *  @type {State}\n   */\n  function after(code) {\n    if (markdownLineEnding(code)) {\n      effects.exit(\"hardBreakEscape\");\n      return ok(code);\n    }\n    return nok(code);\n  }\n}","/**\n * @typedef {import('micromark-util-types').Construct} Construct\n * @typedef {import('micromark-util-types').Previous} Previous\n * @typedef {import('micromark-util-types').Resolver} Resolver\n * @typedef {import('micromark-util-types').State} State\n * @typedef {import('micromark-util-types').Token} Token\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Tokenizer} Tokenizer\n */\n\nimport { markdownLineEnding } from 'micromark-util-character';\n/** @type {Construct} */\nexport const codeText = {\n  name: 'codeText',\n  tokenize: tokenizeCodeText,\n  resolve: resolveCodeText,\n  previous\n};\n\n// To do: next major: don’t resolve, like `markdown-rs`.\n/** @type {Resolver} */\nfunction resolveCodeText(events) {\n  let tailExitIndex = events.length - 4;\n  let headEnterIndex = 3;\n  /** @type {number} */\n  let index;\n  /** @type {number | undefined} */\n  let enter;\n\n  // If we start and end with an EOL or a space.\n  if ((events[headEnterIndex][1].type === \"lineEnding\" || events[headEnterIndex][1].type === 'space') && (events[tailExitIndex][1].type === \"lineEnding\" || events[tailExitIndex][1].type === 'space')) {\n    index = headEnterIndex;\n\n    // And we have data.\n    while (++index < tailExitIndex) {\n      if (events[index][1].type === \"codeTextData\") {\n        // Then we have padding.\n        events[headEnterIndex][1].type = \"codeTextPadding\";\n        events[tailExitIndex][1].type = \"codeTextPadding\";\n        headEnterIndex += 2;\n        tailExitIndex -= 2;\n        break;\n      }\n    }\n  }\n\n  // Merge adjacent spaces and data.\n  index = headEnterIndex - 1;\n  tailExitIndex++;\n  while (++index <= tailExitIndex) {\n    if (enter === undefined) {\n      if (index !== tailExitIndex && events[index][1].type !== \"lineEnding\") {\n        enter = index;\n      }\n    } else if (index === tailExitIndex || events[index][1].type === \"lineEnding\") {\n      events[enter][1].type = \"codeTextData\";\n      if (index !== enter + 2) {\n        events[enter][1].end = events[index - 1][1].end;\n        events.splice(enter + 2, index - enter - 2);\n        tailExitIndex -= index - enter - 2;\n        index = enter + 2;\n      }\n      enter = undefined;\n    }\n  }\n  return events;\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Previous}\n */\nfunction previous(code) {\n  // If there is a previous code, there will always be a tail.\n  return code !== 96 || this.events[this.events.length - 1][1].type === \"characterEscape\";\n}\n\n/**\n * @this {TokenizeContext}\n * @type {Tokenizer}\n */\nfunction tokenizeCodeText(effects, ok, nok) {\n  const self = this;\n  let sizeOpen = 0;\n  /** @type {number} */\n  let size;\n  /** @type {Token} */\n  let token;\n  return start;\n\n  /**\n   * Start of code (text).\n   *\n   * ```markdown\n   * > | `a`\n   *     ^\n   * > | \\`a`\n   *      ^\n   * ```\n   *\n   * @type {State}\n   */\n  function start(code) {\n    effects.enter(\"codeText\");\n    effects.enter(\"codeTextSequence\");\n    return sequenceOpen(code);\n  }\n\n  /**\n   * In opening sequence.\n   *\n   * ```markdown\n   * > | `a`\n   *     ^\n   * ```\n   *\n   * @type {State}\n   */\n  function sequenceOpen(code) {\n    if (code === 96) {\n      effects.consume(code);\n      sizeOpen++;\n      return sequenceOpen;\n    }\n    effects.exit(\"codeTextSequence\");\n    return between(code);\n  }\n\n  /**\n   * Between something and something else.\n   *\n   * ```markdown\n   * > | `a`\n   *      ^^\n   * ```\n   *\n   * @type {State}\n   */\n  function between(code) {\n    // EOF.\n    if (code === null) {\n      return nok(code);\n    }\n\n    // To do: next major: don’t do spaces in resolve, but when compiling,\n    // like `markdown-rs`.\n    // Tabs don’t work, and virtual spaces don’t make sense.\n    if (code === 32) {\n      effects.enter('space');\n      effects.consume(code);\n      effects.exit('space');\n      return between;\n    }\n\n    // Closing fence? Could also be data.\n    if (code === 96) {\n      token = effects.enter(\"codeTextSequence\");\n      size = 0;\n      return sequenceClose(code);\n    }\n    if (markdownLineEnding(code)) {\n      effects.enter(\"lineEnding\");\n      effects.consume(code);\n      effects.exit(\"lineEnding\");\n      return between;\n    }\n\n    // Data.\n    effects.enter(\"codeTextData\");\n    return data(code);\n  }\n\n  /**\n   * In data.\n   *\n   * ```markdown\n   * > | `a`\n   *      ^\n   * ```\n   *\n   * @type {State}\n   */\n  function data(code) {\n    if (code === null || code === 32 || code === 96 || markdownLineEnding(code)) {\n      effects.exit(\"codeTextData\");\n      return between(code);\n    }\n    effects.consume(code);\n    return data;\n  }\n\n  /**\n   * In closing sequence.\n   *\n   * ```markdown\n   * > | `a`\n   *       ^\n   * ```\n   *\n   * @type {State}\n   */\n  function sequenceClose(code) {\n    // More.\n    if (code === 96) {\n      effects.consume(code);\n      size++;\n      return sequenceClose;\n    }\n\n    // Done!\n    if (size === sizeOpen) {\n      effects.exit(\"codeTextSequence\");\n      effects.exit(\"codeText\");\n      return ok(code);\n    }\n\n    // More or less accents: mark as data.\n    token.type = \"codeTextData\";\n    return data(code);\n  }\n}","/**\n * @typedef {import('micromark-util-types').Extension} Extension\n */\n\nimport {\n  attention,\n  autolink,\n  blockQuote,\n  characterEscape,\n  characterReference,\n  codeFenced,\n  codeIndented,\n  codeText,\n  definition,\n  hardBreakEscape,\n  headingAtx,\n  htmlFlow,\n  htmlText,\n  labelEnd,\n  labelStartImage,\n  labelStartLink,\n  lineEnding,\n  list,\n  setextUnderline,\n  thematicBreak\n} from 'micromark-core-commonmark'\nimport {resolver as resolveText} from './initialize/text.js'\n\n/** @satisfies {Extension['document']} */\nexport const document = {\n  [42]: list,\n  [43]: list,\n  [45]: list,\n  [48]: list,\n  [49]: list,\n  [50]: list,\n  [51]: list,\n  [52]: list,\n  [53]: list,\n  [54]: list,\n  [55]: list,\n  [56]: list,\n  [57]: list,\n  [62]: blockQuote\n}\n\n/** @satisfies {Extension['contentInitial']} */\nexport const contentInitial = {\n  [91]: definition\n}\n\n/** @satisfies {Extension['flowInitial']} */\nexport const flowInitial = {\n  [-2]: codeIndented,\n  [-1]: codeIndented,\n  [32]: codeIndented\n}\n\n/** @satisfies {Extension['flow']} */\nexport const flow = {\n  [35]: headingAtx,\n  [42]: thematicBreak,\n  [45]: [setextUnderline, thematicBreak],\n  [60]: htmlFlow,\n  [61]: setextUnderline,\n  [95]: thematicBreak,\n  [96]: codeFenced,\n  [126]: codeFenced\n}\n\n/** @satisfies {Extension['string']} */\nexport const string = {\n  [38]: characterReference,\n  [92]: characterEscape\n}\n\n/** @satisfies {Extension['text']} */\nexport const text = {\n  [-5]: lineEnding,\n  [-4]: lineEnding,\n  [-3]: lineEnding,\n  [33]: labelStartImage,\n  [38]: characterReference,\n  [42]: attention,\n  [60]: [autolink, htmlText],\n  [91]: labelStartLink,\n  [92]: [hardBreakEscape, characterEscape],\n  [93]: labelEnd,\n  [95]: attention,\n  [96]: codeText\n}\n\n/** @satisfies {Extension['insideSpan']} */\nexport const insideSpan = {\n  null: [attention, resolveText]\n}\n\n/** @satisfies {Extension['attentionMarkers']} */\nexport const attentionMarkers = {\n  null: [42, 95]\n}\n\n/** @satisfies {Extension['disable']} */\nexport const disable = {\n  null: []\n}\n","/**\n * @typedef {import('micromark-util-types').Chunk} Chunk\n * @typedef {import('micromark-util-types').Code} Code\n * @typedef {import('micromark-util-types').Encoding} Encoding\n * @typedef {import('micromark-util-types').Value} Value\n */\n\n/**\n * @callback Preprocessor\n * @param {Value} value\n * @param {Encoding | null | undefined} [encoding]\n * @param {boolean | null | undefined} [end=false]\n * @returns {Array<Chunk>}\n */\n\nconst search = /[\\0\\t\\n\\r]/g\n\n/**\n * @returns {Preprocessor}\n */\nexport function preprocess() {\n  let column = 1\n  let buffer = ''\n  /** @type {boolean | undefined} */\n  let start = true\n  /** @type {boolean | undefined} */\n  let atCarriageReturn\n  return preprocessor\n\n  /** @type {Preprocessor} */\n  // eslint-disable-next-line complexity\n  function preprocessor(value, encoding, end) {\n    /** @type {Array<Chunk>} */\n    const chunks = []\n    /** @type {RegExpMatchArray | null} */\n    let match\n    /** @type {number} */\n    let next\n    /** @type {number} */\n    let startPosition\n    /** @type {number} */\n    let endPosition\n    /** @type {Code} */\n    let code\n    value =\n      buffer +\n      (typeof value === 'string'\n        ? value.toString()\n        : new TextDecoder(encoding || undefined).decode(value))\n    startPosition = 0\n    buffer = ''\n    if (start) {\n      // To do: `markdown-rs` actually parses BOMs (byte order mark).\n      if (value.charCodeAt(0) === 65279) {\n        startPosition++\n      }\n      start = undefined\n    }\n    while (startPosition < value.length) {\n      search.lastIndex = startPosition\n      match = search.exec(value)\n      endPosition =\n        match && match.index !== undefined ? match.index : value.length\n      code = value.charCodeAt(endPosition)\n      if (!match) {\n        buffer = value.slice(startPosition)\n        break\n      }\n      if (code === 10 && startPosition === endPosition && atCarriageReturn) {\n        chunks.push(-3)\n        atCarriageReturn = undefined\n      } else {\n        if (atCarriageReturn) {\n          chunks.push(-5)\n          atCarriageReturn = undefined\n        }\n        if (startPosition < endPosition) {\n          chunks.push(value.slice(startPosition, endPosition))\n          column += endPosition - startPosition\n        }\n        switch (code) {\n          case 0: {\n            chunks.push(65533)\n            column++\n            break\n          }\n          case 9: {\n            next = Math.ceil(column / 4) * 4\n            chunks.push(-2)\n            while (column++ < next) chunks.push(-1)\n            break\n          }\n          case 10: {\n            chunks.push(-4)\n            column = 1\n            break\n          }\n          default: {\n            atCarriageReturn = true\n            column = 1\n          }\n        }\n      }\n      startPosition = endPosition + 1\n    }\n    if (end) {\n      if (atCarriageReturn) chunks.push(-5)\n      if (buffer) chunks.push(buffer)\n      chunks.push(null)\n    }\n    return chunks\n  }\n}\n","/**\n * Turn the number (in string form as either hexa- or plain decimal) coming from\n * a numeric character reference into a character.\n *\n * Sort of like `String.fromCodePoint(Number.parseInt(value, base))`, but makes\n * non-characters and control characters safe.\n *\n * @param {string} value\n *   Value to decode.\n * @param {number} base\n *   Numeric base.\n * @returns {string}\n *   Character.\n */\nexport function decodeNumericCharacterReference(value, base) {\n  const code = Number.parseInt(value, base);\n  if (\n  // C0 except for HT, LF, FF, CR, space.\n  code < 9 || code === 11 || code > 13 && code < 32 ||\n  // Control character (DEL) of C0, and C1 controls.\n  code > 126 && code < 160 ||\n  // Lone high surrogates and low surrogates.\n  code > 55_295 && code < 57_344 ||\n  // Noncharacters.\n  code > 64_975 && code < 65_008 || /* eslint-disable no-bitwise */\n  (code & 65_535) === 65_535 || (code & 65_535) === 65_534 || /* eslint-enable no-bitwise */\n  // Out of range\n  code > 1_114_111) {\n    return \"\\uFFFD\";\n  }\n  return String.fromCodePoint(code);\n}","import {decodeNamedCharacterReference} from 'decode-named-character-reference'\nimport {decodeNumericCharacterReference} from 'micromark-util-decode-numeric-character-reference'\nconst characterEscapeOrReference =\n  /\\\\([!-/:-@[-`{-~])|&(#(?:\\d{1,7}|x[\\da-f]{1,6})|[\\da-z]{1,31});/gi\n\n/**\n * Decode markdown strings (which occur in places such as fenced code info\n * strings, destinations, labels, and titles).\n *\n * The “string” content type allows character escapes and -references.\n * This decodes those.\n *\n * @param {string} value\n *   Value to decode.\n * @returns {string}\n *   Decoded value.\n */\nexport function decodeString(value) {\n  return value.replace(characterEscapeOrReference, decode)\n}\n\n/**\n * @param {string} $0\n * @param {string} $1\n * @param {string} $2\n * @returns {string}\n */\nfunction decode($0, $1, $2) {\n  if ($1) {\n    // Escape.\n    return $1\n  }\n\n  // Reference.\n  const head = $2.charCodeAt(0)\n  if (head === 35) {\n    const head = $2.charCodeAt(1)\n    const hex = head === 120 || head === 88\n    return decodeNumericCharacterReference($2.slice(hex ? 2 : 1), hex ? 16 : 10)\n  }\n  return decodeNamedCharacterReference($2) || $0\n}\n","/**\n * @typedef {import('mdast').Break} Break\n * @typedef {import('mdast').Blockquote} Blockquote\n * @typedef {import('mdast').Code} Code\n * @typedef {import('mdast').Definition} Definition\n * @typedef {import('mdast').Emphasis} Emphasis\n * @typedef {import('mdast').Heading} Heading\n * @typedef {import('mdast').Html} Html\n * @typedef {import('mdast').Image} Image\n * @typedef {import('mdast').InlineCode} InlineCode\n * @typedef {import('mdast').Link} Link\n * @typedef {import('mdast').List} List\n * @typedef {import('mdast').ListItem} ListItem\n * @typedef {import('mdast').Nodes} Nodes\n * @typedef {import('mdast').Paragraph} Paragraph\n * @typedef {import('mdast').Parent} Parent\n * @typedef {import('mdast').PhrasingContent} PhrasingContent\n * @typedef {import('mdast').ReferenceType} ReferenceType\n * @typedef {import('mdast').Root} Root\n * @typedef {import('mdast').Strong} Strong\n * @typedef {import('mdast').Text} Text\n * @typedef {import('mdast').ThematicBreak} ThematicBreak\n *\n * @typedef {import('micromark-util-types').Encoding} Encoding\n * @typedef {import('micromark-util-types').Event} Event\n * @typedef {import('micromark-util-types').ParseOptions} ParseOptions\n * @typedef {import('micromark-util-types').Token} Token\n * @typedef {import('micromark-util-types').TokenizeContext} TokenizeContext\n * @typedef {import('micromark-util-types').Value} Value\n *\n * @typedef {import('unist').Point} Point\n *\n * @typedef {import('../index.js').CompileData} CompileData\n */\n\n/**\n * @typedef {Omit<Parent, 'children' | 'type'> & {type: 'fragment', children: Array<PhrasingContent>}} Fragment\n */\n\n/**\n * @callback Transform\n *   Extra transform, to change the AST afterwards.\n * @param {Root} tree\n *   Tree to transform.\n * @returns {Root | null | undefined | void}\n *   New tree or nothing (in which case the current tree is used).\n *\n * @callback Handle\n *   Handle a token.\n * @param {CompileContext} this\n *   Context.\n * @param {Token} token\n *   Current token.\n * @returns {undefined | void}\n *   Nothing.\n *\n * @typedef {Record<string, Handle>} Handles\n *   Token types mapping to handles\n *\n * @callback OnEnterError\n *   Handle the case where the `right` token is open, but it is closed (by the\n *   `left` token) or because we reached the end of the document.\n * @param {Omit<CompileContext, 'sliceSerialize'>} this\n *   Context.\n * @param {Token | undefined} left\n *   Left token.\n * @param {Token} right\n *   Right token.\n * @returns {undefined}\n *   Nothing.\n *\n * @callback OnExitError\n *   Handle the case where the `right` token is open but it is closed by\n *   exiting the `left` token.\n * @param {Omit<CompileContext, 'sliceSerialize'>} this\n *   Context.\n * @param {Token} left\n *   Left token.\n * @param {Token} right\n *   Right token.\n * @returns {undefined}\n *   Nothing.\n *\n * @typedef {[Token, OnEnterError | undefined]} TokenTuple\n *   Open token on the stack, with an optional error handler for when\n *   that token isn’t closed properly.\n */\n\n/**\n * @typedef Config\n *   Configuration.\n *\n *   We have our defaults, but extensions will add more.\n * @property {Array<string>} canContainEols\n *   Token types where line endings are used.\n * @property {Handles} enter\n *   Opening handles.\n * @property {Handles} exit\n *   Closing handles.\n * @property {Array<Transform>} transforms\n *   Tree transforms.\n *\n * @typedef {Partial<Config>} Extension\n *   Change how markdown tokens from micromark are turned into mdast.\n *\n * @typedef CompileContext\n *   mdast compiler context.\n * @property {Array<Fragment | Nodes>} stack\n *   Stack of nodes.\n * @property {Array<TokenTuple>} tokenStack\n *   Stack of tokens.\n * @property {(this: CompileContext) => undefined} buffer\n *   Capture some of the output data.\n * @property {(this: CompileContext) => string} resume\n *   Stop capturing and access the output data.\n * @property {(this: CompileContext, node: Nodes, token: Token, onError?: OnEnterError) => undefined} enter\n *   Enter a node.\n * @property {(this: CompileContext, token: Token, onError?: OnExitError) => undefined} exit\n *   Exit a node.\n * @property {TokenizeContext['sliceSerialize']} sliceSerialize\n *   Get the string value of a token.\n * @property {Config} config\n *   Configuration.\n * @property {CompileData} data\n *   Info passed around; key/value store.\n *\n * @typedef FromMarkdownOptions\n *   Configuration for how to build mdast.\n * @property {Array<Extension | Array<Extension>> | null | undefined} [mdastExtensions]\n *   Extensions for this utility to change how tokens are turned into a tree.\n *\n * @typedef {ParseOptions & FromMarkdownOptions} Options\n *   Configuration.\n */\n\nimport { toString } from 'mdast-util-to-string';\nimport { parse, postprocess, preprocess } from 'micromark';\nimport { decodeNumericCharacterReference } from 'micromark-util-decode-numeric-character-reference';\nimport { decodeString } from 'micromark-util-decode-string';\nimport { normalizeIdentifier } from 'micromark-util-normalize-identifier';\nimport { decodeNamedCharacterReference } from 'decode-named-character-reference';\nimport { stringifyPosition } from 'unist-util-stringify-position';\nconst own = {}.hasOwnProperty;\n\n/**\n * Turn markdown into a syntax tree.\n *\n * @overload\n * @param {Value} value\n * @param {Encoding | null | undefined} [encoding]\n * @param {Options | null | undefined} [options]\n * @returns {Root}\n *\n * @overload\n * @param {Value} value\n * @param {Options | null | undefined} [options]\n * @returns {Root}\n *\n * @param {Value} value\n *   Markdown to parse.\n * @param {Encoding | Options | null | undefined} [encoding]\n *   Character encoding for when `value` is `Buffer`.\n * @param {Options | null | undefined} [options]\n *   Configuration.\n * @returns {Root}\n *   mdast tree.\n */\nexport function fromMarkdown(value, encoding, options) {\n  if (typeof encoding !== 'string') {\n    options = encoding;\n    encoding = undefined;\n  }\n  return compiler(options)(postprocess(parse(options).document().write(preprocess()(value, encoding, true))));\n}\n\n/**\n * Note this compiler only understand complete buffering, not streaming.\n *\n * @param {Options | null | undefined} [options]\n */\nfunction compiler(options) {\n  /** @type {Config} */\n  const config = {\n    transforms: [],\n    canContainEols: ['emphasis', 'fragment', 'heading', 'paragraph', 'strong'],\n    enter: {\n      autolink: opener(link),\n      autolinkProtocol: onenterdata,\n      autolinkEmail: onenterdata,\n      atxHeading: opener(heading),\n      blockQuote: opener(blockQuote),\n      characterEscape: onenterdata,\n      characterReference: onenterdata,\n      codeFenced: opener(codeFlow),\n      codeFencedFenceInfo: buffer,\n      codeFencedFenceMeta: buffer,\n      codeIndented: opener(codeFlow, buffer),\n      codeText: opener(codeText, buffer),\n      codeTextData: onenterdata,\n      data: onenterdata,\n      codeFlowValue: onenterdata,\n      definition: opener(definition),\n      definitionDestinationString: buffer,\n      definitionLabelString: buffer,\n      definitionTitleString: buffer,\n      emphasis: opener(emphasis),\n      hardBreakEscape: opener(hardBreak),\n      hardBreakTrailing: opener(hardBreak),\n      htmlFlow: opener(html, buffer),\n      htmlFlowData: onenterdata,\n      htmlText: opener(html, buffer),\n      htmlTextData: onenterdata,\n      image: opener(image),\n      label: buffer,\n      link: opener(link),\n      listItem: opener(listItem),\n      listItemValue: onenterlistitemvalue,\n      listOrdered: opener(list, onenterlistordered),\n      listUnordered: opener(list),\n      paragraph: opener(paragraph),\n      reference: onenterreference,\n      referenceString: buffer,\n      resourceDestinationString: buffer,\n      resourceTitleString: buffer,\n      setextHeading: opener(heading),\n      strong: opener(strong),\n      thematicBreak: opener(thematicBreak)\n    },\n    exit: {\n      atxHeading: closer(),\n      atxHeadingSequence: onexitatxheadingsequence,\n      autolink: closer(),\n      autolinkEmail: onexitautolinkemail,\n      autolinkProtocol: onexitautolinkprotocol,\n      blockQuote: closer(),\n      characterEscapeValue: onexitdata,\n      characterReferenceMarkerHexadecimal: onexitcharacterreferencemarker,\n      characterReferenceMarkerNumeric: onexitcharacterreferencemarker,\n      characterReferenceValue: onexitcharacterreferencevalue,\n      characterReference: onexitcharacterreference,\n      codeFenced: closer(onexitcodefenced),\n      codeFencedFence: onexitcodefencedfence,\n      codeFencedFenceInfo: onexitcodefencedfenceinfo,\n      codeFencedFenceMeta: onexitcodefencedfencemeta,\n      codeFlowValue: onexitdata,\n      codeIndented: closer(onexitcodeindented),\n      codeText: closer(onexitcodetext),\n      codeTextData: onexitdata,\n      data: onexitdata,\n      definition: closer(),\n      definitionDestinationString: onexitdefinitiondestinationstring,\n      definitionLabelString: onexitdefinitionlabelstring,\n      definitionTitleString: onexitdefinitiontitlestring,\n      emphasis: closer(),\n      hardBreakEscape: closer(onexithardbreak),\n      hardBreakTrailing: closer(onexithardbreak),\n      htmlFlow: closer(onexithtmlflow),\n      htmlFlowData: onexitdata,\n      htmlText: closer(onexithtmltext),\n      htmlTextData: onexitdata,\n      image: closer(onexitimage),\n      label: onexitlabel,\n      labelText: onexitlabeltext,\n      lineEnding: onexitlineending,\n      link: closer(onexitlink),\n      listItem: closer(),\n      listOrdered: closer(),\n      listUnordered: closer(),\n      paragraph: closer(),\n      referenceString: onexitreferencestring,\n      resourceDestinationString: onexitresourcedestinationstring,\n      resourceTitleString: onexitresourcetitlestring,\n      resource: onexitresource,\n      setextHeading: closer(onexitsetextheading),\n      setextHeadingLineSequence: onexitsetextheadinglinesequence,\n      setextHeadingText: onexitsetextheadingtext,\n      strong: closer(),\n      thematicBreak: closer()\n    }\n  };\n  configure(config, (options || {}).mdastExtensions || []);\n\n  /** @type {CompileData} */\n  const data = {};\n  return compile;\n\n  /**\n   * Turn micromark events into an mdast tree.\n   *\n   * @param {Array<Event>} events\n   *   Events.\n   * @returns {Root}\n   *   mdast tree.\n   */\n  function compile(events) {\n    /** @type {Root} */\n    let tree = {\n      type: 'root',\n      children: []\n    };\n    /** @type {Omit<CompileContext, 'sliceSerialize'>} */\n    const context = {\n      stack: [tree],\n      tokenStack: [],\n      config,\n      enter,\n      exit,\n      buffer,\n      resume,\n      data\n    };\n    /** @type {Array<number>} */\n    const listStack = [];\n    let index = -1;\n    while (++index < events.length) {\n      // We preprocess lists to add `listItem` tokens, and to infer whether\n      // items the list itself are spread out.\n      if (events[index][1].type === \"listOrdered\" || events[index][1].type === \"listUnordered\") {\n        if (events[index][0] === 'enter') {\n          listStack.push(index);\n        } else {\n          const tail = listStack.pop();\n          index = prepareList(events, tail, index);\n        }\n      }\n    }\n    index = -1;\n    while (++index < events.length) {\n      const handler = config[events[index][0]];\n      if (own.call(handler, events[index][1].type)) {\n        handler[events[index][1].type].call(Object.assign({\n          sliceSerialize: events[index][2].sliceSerialize\n        }, context), events[index][1]);\n      }\n    }\n\n    // Handle tokens still being open.\n    if (context.tokenStack.length > 0) {\n      const tail = context.tokenStack[context.tokenStack.length - 1];\n      const handler = tail[1] || defaultOnError;\n      handler.call(context, undefined, tail[0]);\n    }\n\n    // Figure out `root` position.\n    tree.position = {\n      start: point(events.length > 0 ? events[0][1].start : {\n        line: 1,\n        column: 1,\n        offset: 0\n      }),\n      end: point(events.length > 0 ? events[events.length - 2][1].end : {\n        line: 1,\n        column: 1,\n        offset: 0\n      })\n    };\n\n    // Call transforms.\n    index = -1;\n    while (++index < config.transforms.length) {\n      tree = config.transforms[index](tree) || tree;\n    }\n    return tree;\n  }\n\n  /**\n   * @param {Array<Event>} events\n   * @param {number} start\n   * @param {number} length\n   * @returns {number}\n   */\n  function prepareList(events, start, length) {\n    let index = start - 1;\n    let containerBalance = -1;\n    let listSpread = false;\n    /** @type {Token | undefined} */\n    let listItem;\n    /** @type {number | undefined} */\n    let lineIndex;\n    /** @type {number | undefined} */\n    let firstBlankLineIndex;\n    /** @type {boolean | undefined} */\n    let atMarker;\n    while (++index <= length) {\n      const event = events[index];\n      switch (event[1].type) {\n        case \"listUnordered\":\n        case \"listOrdered\":\n        case \"blockQuote\":\n          {\n            if (event[0] === 'enter') {\n              containerBalance++;\n            } else {\n              containerBalance--;\n            }\n            atMarker = undefined;\n            break;\n          }\n        case \"lineEndingBlank\":\n          {\n            if (event[0] === 'enter') {\n              if (listItem && !atMarker && !containerBalance && !firstBlankLineIndex) {\n                firstBlankLineIndex = index;\n              }\n              atMarker = undefined;\n            }\n            break;\n          }\n        case \"linePrefix\":\n        case \"listItemValue\":\n        case \"listItemMarker\":\n        case \"listItemPrefix\":\n        case \"listItemPrefixWhitespace\":\n          {\n            // Empty.\n\n            break;\n          }\n        default:\n          {\n            atMarker = undefined;\n          }\n      }\n      if (!containerBalance && event[0] === 'enter' && event[1].type === \"listItemPrefix\" || containerBalance === -1 && event[0] === 'exit' && (event[1].type === \"listUnordered\" || event[1].type === \"listOrdered\")) {\n        if (listItem) {\n          let tailIndex = index;\n          lineIndex = undefined;\n          while (tailIndex--) {\n            const tailEvent = events[tailIndex];\n            if (tailEvent[1].type === \"lineEnding\" || tailEvent[1].type === \"lineEndingBlank\") {\n              if (tailEvent[0] === 'exit') continue;\n              if (lineIndex) {\n                events[lineIndex][1].type = \"lineEndingBlank\";\n                listSpread = true;\n              }\n              tailEvent[1].type = \"lineEnding\";\n              lineIndex = tailIndex;\n            } else if (tailEvent[1].type === \"linePrefix\" || tailEvent[1].type === \"blockQuotePrefix\" || tailEvent[1].type === \"blockQuotePrefixWhitespace\" || tailEvent[1].type === \"blockQuoteMarker\" || tailEvent[1].type === \"listItemIndent\") {\n              // Empty\n            } else {\n              break;\n            }\n          }\n          if (firstBlankLineIndex && (!lineIndex || firstBlankLineIndex < lineIndex)) {\n            listItem._spread = true;\n          }\n\n          // Fix position.\n          listItem.end = Object.assign({}, lineIndex ? events[lineIndex][1].start : event[1].end);\n          events.splice(lineIndex || index, 0, ['exit', listItem, event[2]]);\n          index++;\n          length++;\n        }\n\n        // Create a new list item.\n        if (event[1].type === \"listItemPrefix\") {\n          /** @type {Token} */\n          const item = {\n            type: 'listItem',\n            _spread: false,\n            start: Object.assign({}, event[1].start),\n            // @ts-expect-error: we’ll add `end` in a second.\n            end: undefined\n          };\n          listItem = item;\n          events.splice(index, 0, ['enter', item, event[2]]);\n          index++;\n          length++;\n          firstBlankLineIndex = undefined;\n          atMarker = true;\n        }\n      }\n    }\n    events[start][1]._spread = listSpread;\n    return length;\n  }\n\n  /**\n   * Create an opener handle.\n   *\n   * @param {(token: Token) => Nodes} create\n   *   Create a node.\n   * @param {Handle | undefined} [and]\n   *   Optional function to also run.\n   * @returns {Handle}\n   *   Handle.\n   */\n  function opener(create, and) {\n    return open;\n\n    /**\n     * @this {CompileContext}\n     * @param {Token} token\n     * @returns {undefined}\n     */\n    function open(token) {\n      enter.call(this, create(token), token);\n      if (and) and.call(this, token);\n    }\n  }\n\n  /**\n   * @this {CompileContext}\n   * @returns {undefined}\n   */\n  function buffer() {\n    this.stack.push({\n      type: 'fragment',\n      children: []\n    });\n  }\n\n  /**\n   * @this {CompileContext}\n   *   Context.\n   * @param {Nodes} node\n   *   Node to enter.\n   * @param {Token} token\n   *   Corresponding token.\n   * @param {OnEnterError | undefined} [errorHandler]\n   *   Handle the case where this token is open, but it is closed by something else.\n   * @returns {undefined}\n   *   Nothing.\n   */\n  function enter(node, token, errorHandler) {\n    const parent = this.stack[this.stack.length - 1];\n    /** @type {Array<Nodes>} */\n    const siblings = parent.children;\n    siblings.push(node);\n    this.stack.push(node);\n    this.tokenStack.push([token, errorHandler]);\n    node.position = {\n      start: point(token.start),\n      // @ts-expect-error: `end` will be patched later.\n      end: undefined\n    };\n  }\n\n  /**\n   * Create a closer handle.\n   *\n   * @param {Handle | undefined} [and]\n   *   Optional function to also run.\n   * @returns {Handle}\n   *   Handle.\n   */\n  function closer(and) {\n    return close;\n\n    /**\n     * @this {CompileContext}\n     * @param {Token} token\n     * @returns {undefined}\n     */\n    function close(token) {\n      if (and) and.call(this, token);\n      exit.call(this, token);\n    }\n  }\n\n  /**\n   * @this {CompileContext}\n   *   Context.\n   * @param {Token} token\n   *   Corresponding token.\n   * @param {OnExitError | undefined} [onExitError]\n   *   Handle the case where another token is open.\n   * @returns {undefined}\n   *   Nothing.\n   */\n  function exit(token, onExitError) {\n    const node = this.stack.pop();\n    const open = this.tokenStack.pop();\n    if (!open) {\n      throw new Error('Cannot close `' + token.type + '` (' + stringifyPosition({\n        start: token.start,\n        end: token.end\n      }) + '): it’s not open');\n    } else if (open[0].type !== token.type) {\n      if (onExitError) {\n        onExitError.call(this, token, open[0]);\n      } else {\n        const handler = open[1] || defaultOnError;\n        handler.call(this, token, open[0]);\n      }\n    }\n    node.position.end = point(token.end);\n  }\n\n  /**\n   * @this {CompileContext}\n   * @returns {string}\n   */\n  function resume() {\n    return toString(this.stack.pop());\n  }\n\n  //\n  // Handlers.\n  //\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onenterlistordered() {\n    this.data.expectingFirstListItemValue = true;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onenterlistitemvalue(token) {\n    if (this.data.expectingFirstListItemValue) {\n      const ancestor = this.stack[this.stack.length - 2];\n      ancestor.start = Number.parseInt(this.sliceSerialize(token), 10);\n      this.data.expectingFirstListItemValue = undefined;\n    }\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onexitcodefencedfenceinfo() {\n    const data = this.resume();\n    const node = this.stack[this.stack.length - 1];\n    node.lang = data;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onexitcodefencedfencemeta() {\n    const data = this.resume();\n    const node = this.stack[this.stack.length - 1];\n    node.meta = data;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onexitcodefencedfence() {\n    // Exit if this is the closing fence.\n    if (this.data.flowCodeInside) return;\n    this.buffer();\n    this.data.flowCodeInside = true;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onexitcodefenced() {\n    const data = this.resume();\n    const node = this.stack[this.stack.length - 1];\n    node.value = data.replace(/^(\\r?\\n|\\r)|(\\r?\\n|\\r)$/g, '');\n    this.data.flowCodeInside = undefined;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onexitcodeindented() {\n    const data = this.resume();\n    const node = this.stack[this.stack.length - 1];\n    node.value = data.replace(/(\\r?\\n|\\r)$/g, '');\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onexitdefinitionlabelstring(token) {\n    const label = this.resume();\n    const node = this.stack[this.stack.length - 1];\n    node.label = label;\n    node.identifier = normalizeIdentifier(this.sliceSerialize(token)).toLowerCase();\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onexitdefinitiontitlestring() {\n    const data = this.resume();\n    const node = this.stack[this.stack.length - 1];\n    node.title = data;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onexitdefinitiondestinationstring() {\n    const data = this.resume();\n    const node = this.stack[this.stack.length - 1];\n    node.url = data;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onexitatxheadingsequence(token) {\n    const node = this.stack[this.stack.length - 1];\n    if (!node.depth) {\n      const depth = this.sliceSerialize(token).length;\n      node.depth = depth;\n    }\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onexitsetextheadingtext() {\n    this.data.setextHeadingSlurpLineEnding = true;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onexitsetextheadinglinesequence(token) {\n    const node = this.stack[this.stack.length - 1];\n    node.depth = this.sliceSerialize(token).codePointAt(0) === 61 ? 1 : 2;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onexitsetextheading() {\n    this.data.setextHeadingSlurpLineEnding = undefined;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onenterdata(token) {\n    const node = this.stack[this.stack.length - 1];\n    /** @type {Array<Nodes>} */\n    const siblings = node.children;\n    let tail = siblings[siblings.length - 1];\n    if (!tail || tail.type !== 'text') {\n      // Add a new text node.\n      tail = text();\n      tail.position = {\n        start: point(token.start),\n        // @ts-expect-error: we’ll add `end` later.\n        end: undefined\n      };\n      siblings.push(tail);\n    }\n    this.stack.push(tail);\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onexitdata(token) {\n    const tail = this.stack.pop();\n    tail.value += this.sliceSerialize(token);\n    tail.position.end = point(token.end);\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onexitlineending(token) {\n    const context = this.stack[this.stack.length - 1];\n    // If we’re at a hard break, include the line ending in there.\n    if (this.data.atHardBreak) {\n      const tail = context.children[context.children.length - 1];\n      tail.position.end = point(token.end);\n      this.data.atHardBreak = undefined;\n      return;\n    }\n    if (!this.data.setextHeadingSlurpLineEnding && config.canContainEols.includes(context.type)) {\n      onenterdata.call(this, token);\n      onexitdata.call(this, token);\n    }\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onexithardbreak() {\n    this.data.atHardBreak = true;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onexithtmlflow() {\n    const data = this.resume();\n    const node = this.stack[this.stack.length - 1];\n    node.value = data;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onexithtmltext() {\n    const data = this.resume();\n    const node = this.stack[this.stack.length - 1];\n    node.value = data;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onexitcodetext() {\n    const data = this.resume();\n    const node = this.stack[this.stack.length - 1];\n    node.value = data;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onexitlink() {\n    const node = this.stack[this.stack.length - 1];\n    // Note: there are also `identifier` and `label` fields on this link node!\n    // These are used / cleaned here.\n\n    // To do: clean.\n    if (this.data.inReference) {\n      /** @type {ReferenceType} */\n      const referenceType = this.data.referenceType || 'shortcut';\n      node.type += 'Reference';\n      // @ts-expect-error: mutate.\n      node.referenceType = referenceType;\n      // @ts-expect-error: mutate.\n      delete node.url;\n      delete node.title;\n    } else {\n      // @ts-expect-error: mutate.\n      delete node.identifier;\n      // @ts-expect-error: mutate.\n      delete node.label;\n    }\n    this.data.referenceType = undefined;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onexitimage() {\n    const node = this.stack[this.stack.length - 1];\n    // Note: there are also `identifier` and `label` fields on this link node!\n    // These are used / cleaned here.\n\n    // To do: clean.\n    if (this.data.inReference) {\n      /** @type {ReferenceType} */\n      const referenceType = this.data.referenceType || 'shortcut';\n      node.type += 'Reference';\n      // @ts-expect-error: mutate.\n      node.referenceType = referenceType;\n      // @ts-expect-error: mutate.\n      delete node.url;\n      delete node.title;\n    } else {\n      // @ts-expect-error: mutate.\n      delete node.identifier;\n      // @ts-expect-error: mutate.\n      delete node.label;\n    }\n    this.data.referenceType = undefined;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onexitlabeltext(token) {\n    const string = this.sliceSerialize(token);\n    const ancestor = this.stack[this.stack.length - 2];\n    // @ts-expect-error: stash this on the node, as it might become a reference\n    // later.\n    ancestor.label = decodeString(string);\n    // @ts-expect-error: same as above.\n    ancestor.identifier = normalizeIdentifier(string).toLowerCase();\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onexitlabel() {\n    const fragment = this.stack[this.stack.length - 1];\n    const value = this.resume();\n    const node = this.stack[this.stack.length - 1];\n    // Assume a reference.\n    this.data.inReference = true;\n    if (node.type === 'link') {\n      /** @type {Array<PhrasingContent>} */\n      const children = fragment.children;\n      node.children = children;\n    } else {\n      node.alt = value;\n    }\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onexitresourcedestinationstring() {\n    const data = this.resume();\n    const node = this.stack[this.stack.length - 1];\n    node.url = data;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onexitresourcetitlestring() {\n    const data = this.resume();\n    const node = this.stack[this.stack.length - 1];\n    node.title = data;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onexitresource() {\n    this.data.inReference = undefined;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onenterreference() {\n    this.data.referenceType = 'collapsed';\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onexitreferencestring(token) {\n    const label = this.resume();\n    const node = this.stack[this.stack.length - 1];\n    // @ts-expect-error: stash this on the node, as it might become a reference\n    // later.\n    node.label = label;\n    // @ts-expect-error: same as above.\n    node.identifier = normalizeIdentifier(this.sliceSerialize(token)).toLowerCase();\n    this.data.referenceType = 'full';\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n\n  function onexitcharacterreferencemarker(token) {\n    this.data.characterReferenceType = token.type;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onexitcharacterreferencevalue(token) {\n    const data = this.sliceSerialize(token);\n    const type = this.data.characterReferenceType;\n    /** @type {string} */\n    let value;\n    if (type) {\n      value = decodeNumericCharacterReference(data, type === \"characterReferenceMarkerNumeric\" ? 10 : 16);\n      this.data.characterReferenceType = undefined;\n    } else {\n      const result = decodeNamedCharacterReference(data);\n      value = result;\n    }\n    const tail = this.stack[this.stack.length - 1];\n    tail.value += value;\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onexitcharacterreference(token) {\n    const tail = this.stack.pop();\n    tail.position.end = point(token.end);\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onexitautolinkprotocol(token) {\n    onexitdata.call(this, token);\n    const node = this.stack[this.stack.length - 1];\n    node.url = this.sliceSerialize(token);\n  }\n\n  /**\n   * @this {CompileContext}\n   * @type {Handle}\n   */\n  function onexitautolinkemail(token) {\n    onexitdata.call(this, token);\n    const node = this.stack[this.stack.length - 1];\n    node.url = 'mailto:' + this.sliceSerialize(token);\n  }\n\n  //\n  // Creaters.\n  //\n\n  /** @returns {Blockquote} */\n  function blockQuote() {\n    return {\n      type: 'blockquote',\n      children: []\n    };\n  }\n\n  /** @returns {Code} */\n  function codeFlow() {\n    return {\n      type: 'code',\n      lang: null,\n      meta: null,\n      value: ''\n    };\n  }\n\n  /** @returns {InlineCode} */\n  function codeText() {\n    return {\n      type: 'inlineCode',\n      value: ''\n    };\n  }\n\n  /** @returns {Definition} */\n  function definition() {\n    return {\n      type: 'definition',\n      identifier: '',\n      label: null,\n      title: null,\n      url: ''\n    };\n  }\n\n  /** @returns {Emphasis} */\n  function emphasis() {\n    return {\n      type: 'emphasis',\n      children: []\n    };\n  }\n\n  /** @returns {Heading} */\n  function heading() {\n    return {\n      type: 'heading',\n      // @ts-expect-error `depth` will be set later.\n      depth: 0,\n      children: []\n    };\n  }\n\n  /** @returns {Break} */\n  function hardBreak() {\n    return {\n      type: 'break'\n    };\n  }\n\n  /** @returns {Html} */\n  function html() {\n    return {\n      type: 'html',\n      value: ''\n    };\n  }\n\n  /** @returns {Image} */\n  function image() {\n    return {\n      type: 'image',\n      title: null,\n      url: '',\n      alt: null\n    };\n  }\n\n  /** @returns {Link} */\n  function link() {\n    return {\n      type: 'link',\n      title: null,\n      url: '',\n      children: []\n    };\n  }\n\n  /**\n   * @param {Token} token\n   * @returns {List}\n   */\n  function list(token) {\n    return {\n      type: 'list',\n      ordered: token.type === 'listOrdered',\n      start: null,\n      spread: token._spread,\n      children: []\n    };\n  }\n\n  /**\n   * @param {Token} token\n   * @returns {ListItem}\n   */\n  function listItem(token) {\n    return {\n      type: 'listItem',\n      spread: token._spread,\n      checked: null,\n      children: []\n    };\n  }\n\n  /** @returns {Paragraph} */\n  function paragraph() {\n    return {\n      type: 'paragraph',\n      children: []\n    };\n  }\n\n  /** @returns {Strong} */\n  function strong() {\n    return {\n      type: 'strong',\n      children: []\n    };\n  }\n\n  /** @returns {Text} */\n  function text() {\n    return {\n      type: 'text',\n      value: ''\n    };\n  }\n\n  /** @returns {ThematicBreak} */\n  function thematicBreak() {\n    return {\n      type: 'thematicBreak'\n    };\n  }\n}\n\n/**\n * Copy a point-like value.\n *\n * @param {Point} d\n *   Point-like value.\n * @returns {Point}\n *   unist point.\n */\nfunction point(d) {\n  return {\n    line: d.line,\n    column: d.column,\n    offset: d.offset\n  };\n}\n\n/**\n * @param {Config} combined\n * @param {Array<Array<Extension> | Extension>} extensions\n * @returns {undefined}\n */\nfunction configure(combined, extensions) {\n  let index = -1;\n  while (++index < extensions.length) {\n    const value = extensions[index];\n    if (Array.isArray(value)) {\n      configure(combined, value);\n    } else {\n      extension(combined, value);\n    }\n  }\n}\n\n/**\n * @param {Config} combined\n * @param {Extension} extension\n * @returns {undefined}\n */\nfunction extension(combined, extension) {\n  /** @type {keyof Extension} */\n  let key;\n  for (key in extension) {\n    if (own.call(extension, key)) {\n      switch (key) {\n        case 'canContainEols':\n          {\n            const right = extension[key];\n            if (right) {\n              combined[key].push(...right);\n            }\n            break;\n          }\n        case 'transforms':\n          {\n            const right = extension[key];\n            if (right) {\n              combined[key].push(...right);\n            }\n            break;\n          }\n        case 'enter':\n        case 'exit':\n          {\n            const right = extension[key];\n            if (right) {\n              Object.assign(combined[key], right);\n            }\n            break;\n          }\n        // No default\n      }\n    }\n  }\n}\n\n/** @type {OnEnterError} */\nfunction defaultOnError(left, right) {\n  if (left) {\n    throw new Error('Cannot close `' + left.type + '` (' + stringifyPosition({\n      start: left.start,\n      end: left.end\n    }) + '): a different token (`' + right.type + '`, ' + stringifyPosition({\n      start: right.start,\n      end: right.end\n    }) + ') is open');\n  } else {\n    throw new Error('Cannot close document, a token (`' + right.type + '`, ' + stringifyPosition({\n      start: right.start,\n      end: right.end\n    }) + ') is still open');\n  }\n}","/**\n * @typedef {import('micromark-util-types').Event} Event\n */\n\nimport {subtokenize} from 'micromark-util-subtokenize'\n\n/**\n * @param {Array<Event>} events\n * @returns {Array<Event>}\n */\nexport function postprocess(events) {\n  while (!subtokenize(events)) {\n    // Empty\n  }\n  return events\n}\n","/**\n * @typedef {import('micromark-util-types').Create} Create\n * @typedef {import('micromark-util-types').FullNormalizedExtension} FullNormalizedExtension\n * @typedef {import('micromark-util-types').InitialConstruct} InitialConstruct\n * @typedef {import('micromark-util-types').ParseContext} ParseContext\n * @typedef {import('micromark-util-types').ParseOptions} ParseOptions\n */\n\nimport {combineExtensions} from 'micromark-util-combine-extensions'\nimport {content} from './initialize/content.js'\nimport {document} from './initialize/document.js'\nimport {flow} from './initialize/flow.js'\nimport {string, text} from './initialize/text.js'\nimport {createTokenizer} from './create-tokenizer.js'\nimport * as defaultConstructs from './constructs.js'\n\n/**\n * @param {ParseOptions | null | undefined} [options]\n * @returns {ParseContext}\n */\nexport function parse(options) {\n  const settings = options || {}\n  const constructs =\n    /** @type {FullNormalizedExtension} */\n    combineExtensions([defaultConstructs, ...(settings.extensions || [])])\n\n  /** @type {ParseContext} */\n  const parser = {\n    defined: [],\n    lazy: {},\n    constructs,\n    content: create(content),\n    document: create(document),\n    flow: create(flow),\n    string: create(string),\n    text: create(text)\n  }\n  return parser\n\n  /**\n   * @param {InitialConstruct} initial\n   */\n  function create(initial) {\n    return creator\n    /** @type {Create} */\n    function creator(from) {\n      return createTokenizer(parser, initial, from)\n    }\n  }\n}\n","/**\n * @typedef {import('mdast').Root} Root\n * @typedef {import('mdast-util-from-markdown').Options} FromMarkdownOptions\n * @typedef {import('unified').Parser<Root>} Parser\n * @typedef {import('unified').Processor<Root>} Processor\n */\n\n/**\n * @typedef {Omit<FromMarkdownOptions, 'extensions' | 'mdastExtensions'>} Options\n */\n\nimport {fromMarkdown} from 'mdast-util-from-markdown'\n\n/**\n * Aadd support for parsing from markdown.\n *\n * @param {Readonly<Options> | null | undefined} [options]\n *   Configuration (optional).\n * @returns {undefined}\n *   Nothing.\n */\nexport default function remarkParse(options) {\n  /** @type {Processor} */\n  // @ts-expect-error: TS in JSDoc generates wrong types if `this` is typed regularly.\n  const self = this\n\n  self.parser = parser\n\n  /**\n   * @type {Parser}\n   */\n  function parser(doc) {\n    return fromMarkdown(doc, {\n      ...self.data('settings'),\n      ...options,\n      // Note: these options are not in the readme.\n      // The goal is for them to be set by plugins on `data` instead of being\n      // passed by users.\n      extensions: self.data('micromarkExtensions') || [],\n      mdastExtensions: self.data('fromMarkdownExtensions') || []\n    })\n  }\n}\n","export const VOID       = -1;\nexport const PRIMITIVE  = 0;\nexport const ARRAY      = 1;\nexport const OBJECT     = 2;\nexport const DATE       = 3;\nexport const REGEXP     = 4;\nexport const MAP        = 5;\nexport const SET        = 6;\nexport const ERROR      = 7;\nexport const BIGINT     = 8;\n// export const SYMBOL = 9;\n","import {\n  VOID, PRIMITIVE,\n  ARRAY, OBJECT,\n  DATE, REGEXP, MAP, SET,\n  ERROR, BIGINT\n} from './types.js';\n\nconst env = typeof self === 'object' ? self : globalThis;\n\nconst deserializer = ($, _) => {\n  const as = (out, index) => {\n    $.set(index, out);\n    return out;\n  };\n\n  const unpair = index => {\n    if ($.has(index))\n      return $.get(index);\n\n    const [type, value] = _[index];\n    switch (type) {\n      case PRIMITIVE:\n      case VOID:\n        return as(value, index);\n      case ARRAY: {\n        const arr = as([], index);\n        for (const index of value)\n          arr.push(unpair(index));\n        return arr;\n      }\n      case OBJECT: {\n        const object = as({}, index);\n        for (const [key, index] of value)\n          object[unpair(key)] = unpair(index);\n        return object;\n      }\n      case DATE:\n        return as(new Date(value), index);\n      case REGEXP: {\n        const {source, flags} = value;\n        return as(new RegExp(source, flags), index);\n      }\n      case MAP: {\n        const map = as(new Map, index);\n        for (const [key, index] of value)\n          map.set(unpair(key), unpair(index));\n        return map;\n      }\n      case SET: {\n        const set = as(new Set, index);\n        for (const index of value)\n          set.add(unpair(index));\n        return set;\n      }\n      case ERROR: {\n        const {name, message} = value;\n        return as(new env[name](message), index);\n      }\n      case BIGINT:\n        return as(BigInt(value), index);\n      case 'BigInt':\n        return as(Object(BigInt(value)), index);\n    }\n    return as(new env[type](value), index);\n  };\n\n  return unpair;\n};\n\n/**\n * @typedef {Array<string,any>} Record a type representation\n */\n\n/**\n * Returns a deserialized value from a serialized array of Records.\n * @param {Record[]} serialized a previously serialized value.\n * @returns {any}\n */\nexport const deserialize = serialized => deserializer(new Map, serialized)(0);\n","import {\n  VOID, PRIMITIVE,\n  ARRAY, OBJECT,\n  DATE, REGEXP, MAP, SET,\n  ERROR, BIGINT\n} from './types.js';\n\nconst EMPTY = '';\n\nconst {toString} = {};\nconst {keys} = Object;\n\nconst typeOf = value => {\n  const type = typeof value;\n  if (type !== 'object' || !value)\n    return [PRIMITIVE, type];\n\n  const asString = toString.call(value).slice(8, -1);\n  switch (asString) {\n    case 'Array':\n      return [ARRAY, EMPTY];\n    case 'Object':\n      return [OBJECT, EMPTY];\n    case 'Date':\n      return [DATE, EMPTY];\n    case 'RegExp':\n      return [REGEXP, EMPTY];\n    case 'Map':\n      return [MAP, EMPTY];\n    case 'Set':\n      return [SET, EMPTY];\n  }\n\n  if (asString.includes('Array'))\n    return [ARRAY, asString];\n\n  if (asString.includes('Error'))\n    return [ERROR, asString];\n\n  return [OBJECT, asString];\n};\n\nconst shouldSkip = ([TYPE, type]) => (\n  TYPE === PRIMITIVE &&\n  (type === 'function' || type === 'symbol')\n);\n\nconst serializer = (strict, json, $, _) => {\n\n  const as = (out, value) => {\n    const index = _.push(out) - 1;\n    $.set(value, index);\n    return index;\n  };\n\n  const pair = value => {\n    if ($.has(value))\n      return $.get(value);\n\n    let [TYPE, type] = typeOf(value);\n    switch (TYPE) {\n      case PRIMITIVE: {\n        let entry = value;\n        switch (type) {\n          case 'bigint':\n            TYPE = BIGINT;\n            entry = value.toString();\n            break;\n          case 'function':\n          case 'symbol':\n            if (strict)\n              throw new TypeError('unable to serialize ' + type);\n            entry = null;\n            break;\n          case 'undefined':\n            return as([VOID], value);\n        }\n        return as([TYPE, entry], value);\n      }\n      case ARRAY: {\n        if (type)\n          return as([type, [...value]], value);\n  \n        const arr = [];\n        const index = as([TYPE, arr], value);\n        for (const entry of value)\n          arr.push(pair(entry));\n        return index;\n      }\n      case OBJECT: {\n        if (type) {\n          switch (type) {\n            case 'BigInt':\n              return as([type, value.toString()], value);\n            case 'Boolean':\n            case 'Number':\n            case 'String':\n              return as([type, value.valueOf()], value);\n          }\n        }\n\n        if (json && ('toJSON' in value))\n          return pair(value.toJSON());\n\n        const entries = [];\n        const index = as([TYPE, entries], value);\n        for (const key of keys(value)) {\n          if (strict || !shouldSkip(typeOf(value[key])))\n            entries.push([pair(key), pair(value[key])]);\n        }\n        return index;\n      }\n      case DATE:\n        return as([TYPE, value.toISOString()], value);\n      case REGEXP: {\n        const {source, flags} = value;\n        return as([TYPE, {source, flags}], value);\n      }\n      case MAP: {\n        const entries = [];\n        const index = as([TYPE, entries], value);\n        for (const [key, entry] of value) {\n          if (strict || !(shouldSkip(typeOf(key)) || shouldSkip(typeOf(entry))))\n            entries.push([pair(key), pair(entry)]);\n        }\n        return index;\n      }\n      case SET: {\n        const entries = [];\n        const index = as([TYPE, entries], value);\n        for (const entry of value) {\n          if (strict || !shouldSkip(typeOf(entry)))\n            entries.push(pair(entry));\n        }\n        return index;\n      }\n    }\n\n    const {message} = value;\n    return as([TYPE, {name: type, message}], value);\n  };\n\n  return pair;\n};\n\n/**\n * @typedef {Array<string,any>} Record a type representation\n */\n\n/**\n * Returns an array of serialized Records.\n * @param {any} value a serializable value.\n * @param {{json?: boolean, lossy?: boolean}?} options an object with a `lossy` or `json` property that,\n *  if `true`, will not throw errors on incompatible types, and behave more\n *  like JSON stringify would behave. Symbol and Function will be discarded.\n * @returns {Record[]}\n */\n export const serialize = (value, {json, lossy} = {}) => {\n  const _ = [];\n  return serializer(!(json || lossy), !!json, new Map, _)(value), _;\n};\n","import {deserialize} from './deserialize.js';\nimport {serialize} from './serialize.js';\n\n/**\n * @typedef {Array<string,any>} Record a type representation\n */\n\n/**\n * Returns an array of serialized Records.\n * @param {any} any a serializable value.\n * @param {{transfer?: any[], json?: boolean, lossy?: boolean}?} options an object with\n * a transfer option (ignored when polyfilled) and/or non standard fields that\n * fallback to the polyfill if present.\n * @returns {Record[]}\n */\nexport default typeof structuredClone === \"function\" ?\n  /* c8 ignore start */\n  (any, options) => (\n    options && ('json' in options || 'lossy' in options) ?\n      deserialize(serialize(any, options)) : structuredClone(any)\n  ) :\n  (any, options) => deserialize(serialize(any, options));\n  /* c8 ignore stop */\n\nexport {deserialize, serialize};\n","import {asciiAlphanumeric} from 'micromark-util-character'\nimport {encode} from 'micromark-util-encode'\n/**\n * Make a value safe for injection as a URL.\n *\n * This encodes unsafe characters with percent-encoding and skips already\n * encoded sequences (see `normalizeUri`).\n * Further unsafe characters are encoded as character references (see\n * `micromark-util-encode`).\n *\n * A regex of allowed protocols can be given, in which case the URL is\n * sanitized.\n * For example, `/^(https?|ircs?|mailto|xmpp)$/i` can be used for `a[href]`, or\n * `/^https?$/i` for `img[src]` (this is what `github.com` allows).\n * If the URL includes an unknown protocol (one not matched by `protocol`, such\n * as a dangerous example, `javascript:`), the value is ignored.\n *\n * @param {string | null | undefined} url\n *   URI to sanitize.\n * @param {RegExp | null | undefined} [protocol]\n *   Allowed protocols.\n * @returns {string}\n *   Sanitized URI.\n */\nexport function sanitizeUri(url, protocol) {\n  const value = encode(normalizeUri(url || ''))\n  if (!protocol) {\n    return value\n  }\n  const colon = value.indexOf(':')\n  const questionMark = value.indexOf('?')\n  const numberSign = value.indexOf('#')\n  const slash = value.indexOf('/')\n  if (\n    // If there is no protocol, it’s relative.\n    colon < 0 ||\n    // If the first colon is after a `?`, `#`, or `/`, it’s not a protocol.\n    (slash > -1 && colon > slash) ||\n    (questionMark > -1 && colon > questionMark) ||\n    (numberSign > -1 && colon > numberSign) ||\n    // It is a protocol, it should be allowed.\n    protocol.test(value.slice(0, colon))\n  ) {\n    return value\n  }\n  return ''\n}\n\n/**\n * Normalize a URL.\n *\n * Encode unsafe characters with percent-encoding, skipping already encoded\n * sequences.\n *\n * @param {string} value\n *   URI to normalize.\n * @returns {string}\n *   Normalized URI.\n */\nexport function normalizeUri(value) {\n  /** @type {Array<string>} */\n  const result = []\n  let index = -1\n  let start = 0\n  let skip = 0\n  while (++index < value.length) {\n    const code = value.charCodeAt(index)\n    /** @type {string} */\n    let replace = ''\n\n    // A correct percent encoded value.\n    if (\n      code === 37 &&\n      asciiAlphanumeric(value.charCodeAt(index + 1)) &&\n      asciiAlphanumeric(value.charCodeAt(index + 2))\n    ) {\n      skip = 2\n    }\n    // ASCII.\n    else if (code < 128) {\n      if (!/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(code))) {\n        replace = String.fromCharCode(code)\n      }\n    }\n    // Astral.\n    else if (code > 55_295 && code < 57_344) {\n      const next = value.charCodeAt(index + 1)\n\n      // A correct surrogate pair.\n      if (code < 56_320 && next > 56_319 && next < 57_344) {\n        replace = String.fromCharCode(code, next)\n        skip = 1\n      }\n      // Lone surrogate.\n      else {\n        replace = '\\uFFFD'\n      }\n    }\n    // Unicode.\n    else {\n      replace = String.fromCharCode(code)\n    }\n    if (replace) {\n      result.push(value.slice(start, index), encodeURIComponent(replace))\n      start = index + skip + 1\n      replace = ''\n    }\n    if (skip) {\n      index += skip\n      skip = 0\n    }\n  }\n  return result.join('') + value.slice(start)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('hast').ElementContent} ElementContent\n *\n * @typedef {import('./state.js').State} State\n */\n\n/**\n * @callback FootnoteBackContentTemplate\n *   Generate content for the backreference dynamically.\n *\n *   For the following markdown:\n *\n *   ```markdown\n *   Alpha[^micromark], bravo[^micromark], and charlie[^remark].\n *\n *   [^remark]: things about remark\n *   [^micromark]: things about micromark\n *   ```\n *\n *   This function will be called with:\n *\n *   *  `0` and `0` for the backreference from `things about micromark` to\n *      `alpha`, as it is the first used definition, and the first call to it\n *   *  `0` and `1` for the backreference from `things about micromark` to\n *      `bravo`, as it is the first used definition, and the second call to it\n *   *  `1` and `0` for the backreference from `things about remark` to\n *      `charlie`, as it is the second used definition\n * @param {number} referenceIndex\n *   Index of the definition in the order that they are first referenced,\n *   0-indexed.\n * @param {number} rereferenceIndex\n *   Index of calls to the same definition, 0-indexed.\n * @returns {Array<ElementContent> | ElementContent | string}\n *   Content for the backreference when linking back from definitions to their\n *   reference.\n *\n * @callback FootnoteBackLabelTemplate\n *   Generate a back label dynamically.\n *\n *   For the following markdown:\n *\n *   ```markdown\n *   Alpha[^micromark], bravo[^micromark], and charlie[^remark].\n *\n *   [^remark]: things about remark\n *   [^micromark]: things about micromark\n *   ```\n *\n *   This function will be called with:\n *\n *   *  `0` and `0` for the backreference from `things about micromark` to\n *      `alpha`, as it is the first used definition, and the first call to it\n *   *  `0` and `1` for the backreference from `things about micromark` to\n *      `bravo`, as it is the first used definition, and the second call to it\n *   *  `1` and `0` for the backreference from `things about remark` to\n *      `charlie`, as it is the second used definition\n * @param {number} referenceIndex\n *   Index of the definition in the order that they are first referenced,\n *   0-indexed.\n * @param {number} rereferenceIndex\n *   Index of calls to the same definition, 0-indexed.\n * @returns {string}\n *   Back label to use when linking back from definitions to their reference.\n */\n\nimport structuredClone from '@ungap/structured-clone'\nimport {normalizeUri} from 'micromark-util-sanitize-uri'\n\n/**\n * Generate the default content that GitHub uses on backreferences.\n *\n * @param {number} _\n *   Index of the definition in the order that they are first referenced,\n *   0-indexed.\n * @param {number} rereferenceIndex\n *   Index of calls to the same definition, 0-indexed.\n * @returns {Array<ElementContent>}\n *   Content.\n */\nexport function defaultFootnoteBackContent(_, rereferenceIndex) {\n  /** @type {Array<ElementContent>} */\n  const result = [{type: 'text', value: '↩'}]\n\n  if (rereferenceIndex > 1) {\n    result.push({\n      type: 'element',\n      tagName: 'sup',\n      properties: {},\n      children: [{type: 'text', value: String(rereferenceIndex)}]\n    })\n  }\n\n  return result\n}\n\n/**\n * Generate the default label that GitHub uses on backreferences.\n *\n * @param {number} referenceIndex\n *   Index of the definition in the order that they are first referenced,\n *   0-indexed.\n * @param {number} rereferenceIndex\n *   Index of calls to the same definition, 0-indexed.\n * @returns {string}\n *   Label.\n */\nexport function defaultFootnoteBackLabel(referenceIndex, rereferenceIndex) {\n  return (\n    'Back to reference ' +\n    (referenceIndex + 1) +\n    (rereferenceIndex > 1 ? '-' + rereferenceIndex : '')\n  )\n}\n\n/**\n * Generate a hast footer for called footnote definitions.\n *\n * @param {State} state\n *   Info passed around.\n * @returns {Element | undefined}\n *   `section` element or `undefined`.\n */\n// eslint-disable-next-line complexity\nexport function footer(state) {\n  const clobberPrefix =\n    typeof state.options.clobberPrefix === 'string'\n      ? state.options.clobberPrefix\n      : 'user-content-'\n  const footnoteBackContent =\n    state.options.footnoteBackContent || defaultFootnoteBackContent\n  const footnoteBackLabel =\n    state.options.footnoteBackLabel || defaultFootnoteBackLabel\n  const footnoteLabel = state.options.footnoteLabel || 'Footnotes'\n  const footnoteLabelTagName = state.options.footnoteLabelTagName || 'h2'\n  const footnoteLabelProperties = state.options.footnoteLabelProperties || {\n    className: ['sr-only']\n  }\n  /** @type {Array<ElementContent>} */\n  const listItems = []\n  let referenceIndex = -1\n\n  while (++referenceIndex < state.footnoteOrder.length) {\n    const definition = state.footnoteById.get(\n      state.footnoteOrder[referenceIndex]\n    )\n\n    if (!definition) {\n      continue\n    }\n\n    const content = state.all(definition)\n    const id = String(definition.identifier).toUpperCase()\n    const safeId = normalizeUri(id.toLowerCase())\n    let rereferenceIndex = 0\n    /** @type {Array<ElementContent>} */\n    const backReferences = []\n    const counts = state.footnoteCounts.get(id)\n\n    // eslint-disable-next-line no-unmodified-loop-condition\n    while (counts !== undefined && ++rereferenceIndex <= counts) {\n      if (backReferences.length > 0) {\n        backReferences.push({type: 'text', value: ' '})\n      }\n\n      let children =\n        typeof footnoteBackContent === 'string'\n          ? footnoteBackContent\n          : footnoteBackContent(referenceIndex, rereferenceIndex)\n\n      if (typeof children === 'string') {\n        children = {type: 'text', value: children}\n      }\n\n      backReferences.push({\n        type: 'element',\n        tagName: 'a',\n        properties: {\n          href:\n            '#' +\n            clobberPrefix +\n            'fnref-' +\n            safeId +\n            (rereferenceIndex > 1 ? '-' + rereferenceIndex : ''),\n          dataFootnoteBackref: '',\n          ariaLabel:\n            typeof footnoteBackLabel === 'string'\n              ? footnoteBackLabel\n              : footnoteBackLabel(referenceIndex, rereferenceIndex),\n          className: ['data-footnote-backref']\n        },\n        children: Array.isArray(children) ? children : [children]\n      })\n    }\n\n    const tail = content[content.length - 1]\n\n    if (tail && tail.type === 'element' && tail.tagName === 'p') {\n      const tailTail = tail.children[tail.children.length - 1]\n      if (tailTail && tailTail.type === 'text') {\n        tailTail.value += ' '\n      } else {\n        tail.children.push({type: 'text', value: ' '})\n      }\n\n      tail.children.push(...backReferences)\n    } else {\n      content.push(...backReferences)\n    }\n\n    /** @type {Element} */\n    const listItem = {\n      type: 'element',\n      tagName: 'li',\n      properties: {id: clobberPrefix + 'fn-' + safeId},\n      children: state.wrap(content, true)\n    }\n\n    state.patch(definition, listItem)\n\n    listItems.push(listItem)\n  }\n\n  if (listItems.length === 0) {\n    return\n  }\n\n  return {\n    type: 'element',\n    tagName: 'section',\n    properties: {dataFootnotes: true, className: ['footnotes']},\n    children: [\n      {\n        type: 'element',\n        tagName: footnoteLabelTagName,\n        properties: {\n          ...structuredClone(footnoteLabelProperties),\n          id: 'footnote-label'\n        },\n        children: [{type: 'text', value: footnoteLabel}]\n      },\n      {type: 'text', value: '\\n'},\n      {\n        type: 'element',\n        tagName: 'ol',\n        properties: {},\n        children: state.wrap(listItems, true)\n      },\n      {type: 'text', value: '\\n'}\n    ]\n  }\n}\n","/**\n * @typedef {import('unist').Node} Node\n * @typedef {import('unist').Parent} Parent\n */\n\n/**\n * @template Fn\n * @template Fallback\n * @typedef {Fn extends (value: any) => value is infer Thing ? Thing : Fallback} Predicate\n */\n\n/**\n * @callback Check\n *   Check that an arbitrary value is a node.\n * @param {unknown} this\n *   The given context.\n * @param {unknown} [node]\n *   Anything (typically a node).\n * @param {number | null | undefined} [index]\n *   The node’s position in its parent.\n * @param {Parent | null | undefined} [parent]\n *   The node’s parent.\n * @returns {boolean}\n *   Whether this is a node and passes a test.\n *\n * @typedef {Record<string, unknown> | Node} Props\n *   Object to check for equivalence.\n *\n *   Note: `Node` is included as it is common but is not indexable.\n *\n * @typedef {Array<Props | TestFunction | string> | Props | TestFunction | string | null | undefined} Test\n *   Check for an arbitrary node.\n *\n * @callback TestFunction\n *   Check if a node passes a test.\n * @param {unknown} this\n *   The given context.\n * @param {Node} node\n *   A node.\n * @param {number | undefined} [index]\n *   The node’s position in its parent.\n * @param {Parent | undefined} [parent]\n *   The node’s parent.\n * @returns {boolean | undefined | void}\n *   Whether this node passes the test.\n *\n *   Note: `void` is included until TS sees no return as `undefined`.\n */\n\n/**\n * Check if `node` is a `Node` and whether it passes the given test.\n *\n * @param {unknown} node\n *   Thing to check, typically `Node`.\n * @param {Test} test\n *   A check for a specific node.\n * @param {number | null | undefined} index\n *   The node’s position in its parent.\n * @param {Parent | null | undefined} parent\n *   The node’s parent.\n * @param {unknown} context\n *   Context object (`this`) to pass to `test` functions.\n * @returns {boolean}\n *   Whether `node` is a node and passes a test.\n */\nexport const is =\n  // Note: overloads in JSDoc can’t yet use different `@template`s.\n  /**\n   * @type {(\n   *   (<Condition extends string>(node: unknown, test: Condition, index?: number | null | undefined, parent?: Parent | null | undefined, context?: unknown) => node is Node & {type: Condition}) &\n   *   (<Condition extends Props>(node: unknown, test: Condition, index?: number | null | undefined, parent?: Parent | null | undefined, context?: unknown) => node is Node & Condition) &\n   *   (<Condition extends TestFunction>(node: unknown, test: Condition, index?: number | null | undefined, parent?: Parent | null | undefined, context?: unknown) => node is Node & Predicate<Condition, Node>) &\n   *   ((node?: null | undefined) => false) &\n   *   ((node: unknown, test?: null | undefined, index?: number | null | undefined, parent?: Parent | null | undefined, context?: unknown) => node is Node) &\n   *   ((node: unknown, test?: Test, index?: number | null | undefined, parent?: Parent | null | undefined, context?: unknown) => boolean)\n   * )}\n   */\n  (\n    /**\n     * @param {unknown} [node]\n     * @param {Test} [test]\n     * @param {number | null | undefined} [index]\n     * @param {Parent | null | undefined} [parent]\n     * @param {unknown} [context]\n     * @returns {boolean}\n     */\n    // eslint-disable-next-line max-params\n    function (node, test, index, parent, context) {\n      const check = convert(test)\n\n      if (\n        index !== undefined &&\n        index !== null &&\n        (typeof index !== 'number' ||\n          index < 0 ||\n          index === Number.POSITIVE_INFINITY)\n      ) {\n        throw new Error('Expected positive finite index')\n      }\n\n      if (\n        parent !== undefined &&\n        parent !== null &&\n        (!is(parent) || !parent.children)\n      ) {\n        throw new Error('Expected parent node')\n      }\n\n      if (\n        (parent === undefined || parent === null) !==\n        (index === undefined || index === null)\n      ) {\n        throw new Error('Expected both parent and index')\n      }\n\n      return looksLikeANode(node)\n        ? check.call(context, node, index, parent)\n        : false\n    }\n  )\n\n/**\n * Generate an assertion from a test.\n *\n * Useful if you’re going to test many nodes, for example when creating a\n * utility where something else passes a compatible test.\n *\n * The created function is a bit faster because it expects valid input only:\n * a `node`, `index`, and `parent`.\n *\n * @param {Test} test\n *   *   when nullish, checks if `node` is a `Node`.\n *   *   when `string`, works like passing `(node) => node.type === test`.\n *   *   when `function` checks if function passed the node is true.\n *   *   when `object`, checks that all keys in test are in node, and that they have (strictly) equal values.\n *   *   when `array`, checks if any one of the subtests pass.\n * @returns {Check}\n *   An assertion.\n */\nexport const convert =\n  // Note: overloads in JSDoc can’t yet use different `@template`s.\n  /**\n   * @type {(\n   *   (<Condition extends string>(test: Condition) => (node: unknown, index?: number | null | undefined, parent?: Parent | null | undefined, context?: unknown) => node is Node & {type: Condition}) &\n   *   (<Condition extends Props>(test: Condition) => (node: unknown, index?: number | null | undefined, parent?: Parent | null | undefined, context?: unknown) => node is Node & Condition) &\n   *   (<Condition extends TestFunction>(test: Condition) => (node: unknown, index?: number | null | undefined, parent?: Parent | null | undefined, context?: unknown) => node is Node & Predicate<Condition, Node>) &\n   *   ((test?: null | undefined) => (node?: unknown, index?: number | null | undefined, parent?: Parent | null | undefined, context?: unknown) => node is Node) &\n   *   ((test?: Test) => Check)\n   * )}\n   */\n  (\n    /**\n     * @param {Test} [test]\n     * @returns {Check}\n     */\n    function (test) {\n      if (test === null || test === undefined) {\n        return ok\n      }\n\n      if (typeof test === 'function') {\n        return castFactory(test)\n      }\n\n      if (typeof test === 'object') {\n        return Array.isArray(test) ? anyFactory(test) : propsFactory(test)\n      }\n\n      if (typeof test === 'string') {\n        return typeFactory(test)\n      }\n\n      throw new Error('Expected function, string, or object as test')\n    }\n  )\n\n/**\n * @param {Array<Props | TestFunction | string>} tests\n * @returns {Check}\n */\nfunction anyFactory(tests) {\n  /** @type {Array<Check>} */\n  const checks = []\n  let index = -1\n\n  while (++index < tests.length) {\n    checks[index] = convert(tests[index])\n  }\n\n  return castFactory(any)\n\n  /**\n   * @this {unknown}\n   * @type {TestFunction}\n   */\n  function any(...parameters) {\n    let index = -1\n\n    while (++index < checks.length) {\n      if (checks[index].apply(this, parameters)) return true\n    }\n\n    return false\n  }\n}\n\n/**\n * Turn an object into a test for a node with a certain fields.\n *\n * @param {Props} check\n * @returns {Check}\n */\nfunction propsFactory(check) {\n  const checkAsRecord = /** @type {Record<string, unknown>} */ (check)\n\n  return castFactory(all)\n\n  /**\n   * @param {Node} node\n   * @returns {boolean}\n   */\n  function all(node) {\n    const nodeAsRecord = /** @type {Record<string, unknown>} */ (\n      /** @type {unknown} */ (node)\n    )\n\n    /** @type {string} */\n    let key\n\n    for (key in check) {\n      if (nodeAsRecord[key] !== checkAsRecord[key]) return false\n    }\n\n    return true\n  }\n}\n\n/**\n * Turn a string into a test for a node with a certain type.\n *\n * @param {string} check\n * @returns {Check}\n */\nfunction typeFactory(check) {\n  return castFactory(type)\n\n  /**\n   * @param {Node} node\n   */\n  function type(node) {\n    return node && node.type === check\n  }\n}\n\n/**\n * Turn a custom test into a test for a node that passes that test.\n *\n * @param {TestFunction} testFunction\n * @returns {Check}\n */\nfunction castFactory(testFunction) {\n  return check\n\n  /**\n   * @this {unknown}\n   * @type {Check}\n   */\n  function check(value, index, parent) {\n    return Boolean(\n      looksLikeANode(value) &&\n        testFunction.call(\n          this,\n          value,\n          typeof index === 'number' ? index : undefined,\n          parent || undefined\n        )\n    )\n  }\n}\n\nfunction ok() {\n  return true\n}\n\n/**\n * @param {unknown} value\n * @returns {value is Node}\n */\nfunction looksLikeANode(value) {\n  return value !== null && typeof value === 'object' && 'type' in value\n}\n","/**\n * @typedef {import('unist').Node} UnistNode\n * @typedef {import('unist').Parent} UnistParent\n */\n\n/**\n * @typedef {Exclude<import('unist-util-is').Test, undefined> | undefined} Test\n *   Test from `unist-util-is`.\n *\n *   Note: we have remove and add `undefined`, because otherwise when generating\n *   automatic `.d.ts` files, TS tries to flatten paths from a local perspective,\n *   which doesn’t work when publishing on npm.\n */\n\n/**\n * @typedef {(\n *   Fn extends (value: any) => value is infer Thing\n *   ? Thing\n *   : Fallback\n * )} Predicate\n *   Get the value of a type guard `Fn`.\n * @template Fn\n *   Value; typically function that is a type guard (such as `(x): x is Y`).\n * @template Fallback\n *   Value to yield if `Fn` is not a type guard.\n */\n\n/**\n * @typedef {(\n *   Check extends null | undefined // No test.\n *   ? Value\n *   : Value extends {type: Check} // String (type) test.\n *   ? Value\n *   : Value extends Check // Partial test.\n *   ? Value\n *   : Check extends Function // Function test.\n *   ? Predicate<Check, Value> extends Value\n *     ? Predicate<Check, Value>\n *     : never\n *   : never // Some other test?\n * )} MatchesOne\n *   Check whether a node matches a primitive check in the type system.\n * @template Value\n *   Value; typically unist `Node`.\n * @template Check\n *   Value; typically `unist-util-is`-compatible test, but not arrays.\n */\n\n/**\n * @typedef {(\n *   Check extends Array<any>\n *   ? MatchesOne<Value, Check[keyof Check]>\n *   : MatchesOne<Value, Check>\n * )} Matches\n *   Check whether a node matches a check in the type system.\n * @template Value\n *   Value; typically unist `Node`.\n * @template Check\n *   Value; typically `unist-util-is`-compatible test.\n */\n\n/**\n * @typedef {0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10} Uint\n *   Number; capped reasonably.\n */\n\n/**\n * @typedef {I extends 0 ? 1 : I extends 1 ? 2 : I extends 2 ? 3 : I extends 3 ? 4 : I extends 4 ? 5 : I extends 5 ? 6 : I extends 6 ? 7 : I extends 7 ? 8 : I extends 8 ? 9 : 10} Increment\n *   Increment a number in the type system.\n * @template {Uint} [I=0]\n *   Index.\n */\n\n/**\n * @typedef {(\n *   Node extends UnistParent\n *   ? Node extends {children: Array<infer Children>}\n *     ? Child extends Children ? Node : never\n *     : never\n *   : never\n * )} InternalParent\n *   Collect nodes that can be parents of `Child`.\n * @template {UnistNode} Node\n *   All node types in a tree.\n * @template {UnistNode} Child\n *   Node to search for.\n */\n\n/**\n * @typedef {InternalParent<InclusiveDescendant<Tree>, Child>} Parent\n *   Collect nodes in `Tree` that can be parents of `Child`.\n * @template {UnistNode} Tree\n *   All node types in a tree.\n * @template {UnistNode} Child\n *   Node to search for.\n */\n\n/**\n * @typedef {(\n *   Depth extends Max\n *   ? never\n *   :\n *     | InternalParent<Node, Child>\n *     | InternalAncestor<Node, InternalParent<Node, Child>, Max, Increment<Depth>>\n * )} InternalAncestor\n *   Collect nodes in `Tree` that can be ancestors of `Child`.\n * @template {UnistNode} Node\n *   All node types in a tree.\n * @template {UnistNode} Child\n *   Node to search for.\n * @template {Uint} [Max=10]\n *   Max; searches up to this depth.\n * @template {Uint} [Depth=0]\n *   Current depth.\n */\n\n/**\n * @typedef {InternalAncestor<InclusiveDescendant<Tree>, Child>} Ancestor\n *   Collect nodes in `Tree` that can be ancestors of `Child`.\n * @template {UnistNode} Tree\n *   All node types in a tree.\n * @template {UnistNode} Child\n *   Node to search for.\n */\n\n/**\n * @typedef {(\n *   Tree extends UnistParent\n *     ? Depth extends Max\n *       ? Tree\n *       : Tree | InclusiveDescendant<Tree['children'][number], Max, Increment<Depth>>\n *     : Tree\n * )} InclusiveDescendant\n *   Collect all (inclusive) descendants of `Tree`.\n *\n *   > 👉 **Note**: for performance reasons, this seems to be the fastest way to\n *   > recurse without actually running into an infinite loop, which the\n *   > previous version did.\n *   >\n *   > Practically, a max of `2` is typically enough assuming a `Root` is\n *   > passed, but it doesn’t improve performance.\n *   > It gets higher with `List > ListItem > Table > TableRow > TableCell`.\n *   > Using up to `10` doesn’t hurt or help either.\n * @template {UnistNode} Tree\n *   Tree type.\n * @template {Uint} [Max=10]\n *   Max; searches up to this depth.\n * @template {Uint} [Depth=0]\n *   Current depth.\n */\n\n/**\n * @typedef {'skip' | boolean} Action\n *   Union of the action types.\n *\n * @typedef {number} Index\n *   Move to the sibling at `index` next (after node itself is completely\n *   traversed).\n *\n *   Useful if mutating the tree, such as removing the node the visitor is\n *   currently on, or any of its previous siblings.\n *   Results less than 0 or greater than or equal to `children.length` stop\n *   traversing the parent.\n *\n * @typedef {[(Action | null | undefined | void)?, (Index | null | undefined)?]} ActionTuple\n *   List with one or two values, the first an action, the second an index.\n *\n * @typedef {Action | ActionTuple | Index | null | undefined | void} VisitorResult\n *   Any value that can be returned from a visitor.\n */\n\n/**\n * @callback Visitor\n *   Handle a node (matching `test`, if given).\n *\n *   Visitors are free to transform `node`.\n *   They can also transform the parent of node (the last of `ancestors`).\n *\n *   Replacing `node` itself, if `SKIP` is not returned, still causes its\n *   descendants to be walked (which is a bug).\n *\n *   When adding or removing previous siblings of `node` (or next siblings, in\n *   case of reverse), the `Visitor` should return a new `Index` to specify the\n *   sibling to traverse after `node` is traversed.\n *   Adding or removing next siblings of `node` (or previous siblings, in case\n *   of reverse) is handled as expected without needing to return a new `Index`.\n *\n *   Removing the children property of an ancestor still results in them being\n *   traversed.\n * @param {Visited} node\n *   Found node.\n * @param {Array<VisitedParents>} ancestors\n *   Ancestors of `node`.\n * @returns {VisitorResult}\n *   What to do next.\n *\n *   An `Index` is treated as a tuple of `[CONTINUE, Index]`.\n *   An `Action` is treated as a tuple of `[Action]`.\n *\n *   Passing a tuple back only makes sense if the `Action` is `SKIP`.\n *   When the `Action` is `EXIT`, that action can be returned.\n *   When the `Action` is `CONTINUE`, `Index` can be returned.\n * @template {UnistNode} [Visited=UnistNode]\n *   Visited node type.\n * @template {UnistParent} [VisitedParents=UnistParent]\n *   Ancestor type.\n */\n\n/**\n * @typedef {Visitor<Matches<InclusiveDescendant<Tree>, Check>, Ancestor<Tree, Matches<InclusiveDescendant<Tree>, Check>>>} BuildVisitor\n *   Build a typed `Visitor` function from a tree and a test.\n *\n *   It will infer which values are passed as `node` and which as `parents`.\n * @template {UnistNode} [Tree=UnistNode]\n *   Tree type.\n * @template {Test} [Check=Test]\n *   Test type.\n */\n\nimport {convert} from 'unist-util-is'\nimport {color} from 'unist-util-visit-parents/do-not-use-color'\n\n/** @type {Readonly<ActionTuple>} */\nconst empty = []\n\n/**\n * Continue traversing as normal.\n */\nexport const CONTINUE = true\n\n/**\n * Stop traversing immediately.\n */\nexport const EXIT = false\n\n/**\n * Do not traverse this node’s children.\n */\nexport const SKIP = 'skip'\n\n/**\n * Visit nodes, with ancestral information.\n *\n * This algorithm performs *depth-first* *tree traversal* in *preorder*\n * (**NLR**) or if `reverse` is given, in *reverse preorder* (**NRL**).\n *\n * You can choose for which nodes `visitor` is called by passing a `test`.\n * For complex tests, you should test yourself in `visitor`, as it will be\n * faster and will have improved type information.\n *\n * Walking the tree is an intensive task.\n * Make use of the return values of the visitor when possible.\n * Instead of walking a tree multiple times, walk it once, use `unist-util-is`\n * to check if a node matches, and then perform different operations.\n *\n * You can change the tree.\n * See `Visitor` for more info.\n *\n * @overload\n * @param {Tree} tree\n * @param {Check} check\n * @param {BuildVisitor<Tree, Check>} visitor\n * @param {boolean | null | undefined} [reverse]\n * @returns {undefined}\n *\n * @overload\n * @param {Tree} tree\n * @param {BuildVisitor<Tree>} visitor\n * @param {boolean | null | undefined} [reverse]\n * @returns {undefined}\n *\n * @param {UnistNode} tree\n *   Tree to traverse.\n * @param {Visitor | Test} test\n *   `unist-util-is`-compatible test\n * @param {Visitor | boolean | null | undefined} [visitor]\n *   Handle each node.\n * @param {boolean | null | undefined} [reverse]\n *   Traverse in reverse preorder (NRL) instead of the default preorder (NLR).\n * @returns {undefined}\n *   Nothing.\n *\n * @template {UnistNode} Tree\n *   Node type.\n * @template {Test} Check\n *   `unist-util-is`-compatible test.\n */\nexport function visitParents(tree, test, visitor, reverse) {\n  /** @type {Test} */\n  let check\n\n  if (typeof test === 'function' && typeof visitor !== 'function') {\n    reverse = visitor\n    // @ts-expect-error no visitor given, so `visitor` is test.\n    visitor = test\n  } else {\n    // @ts-expect-error visitor given, so `test` isn’t a visitor.\n    check = test\n  }\n\n  const is = convert(check)\n  const step = reverse ? -1 : 1\n\n  factory(tree, undefined, [])()\n\n  /**\n   * @param {UnistNode} node\n   * @param {number | undefined} index\n   * @param {Array<UnistParent>} parents\n   */\n  function factory(node, index, parents) {\n    const value = /** @type {Record<string, unknown>} */ (\n      node && typeof node === 'object' ? node : {}\n    )\n\n    if (typeof value.type === 'string') {\n      const name =\n        // `hast`\n        typeof value.tagName === 'string'\n          ? value.tagName\n          : // `xast`\n          typeof value.name === 'string'\n          ? value.name\n          : undefined\n\n      Object.defineProperty(visit, 'name', {\n        value:\n          'node (' + color(node.type + (name ? '<' + name + '>' : '')) + ')'\n      })\n    }\n\n    return visit\n\n    function visit() {\n      /** @type {Readonly<ActionTuple>} */\n      let result = empty\n      /** @type {Readonly<ActionTuple>} */\n      let subresult\n      /** @type {number} */\n      let offset\n      /** @type {Array<UnistParent>} */\n      let grandparents\n\n      if (!test || is(node, index, parents[parents.length - 1] || undefined)) {\n        // @ts-expect-error: `visitor` is now a visitor.\n        result = toResult(visitor(node, parents))\n\n        if (result[0] === EXIT) {\n          return result\n        }\n      }\n\n      if ('children' in node && node.children) {\n        const nodeAsParent = /** @type {UnistParent} */ (node)\n\n        if (nodeAsParent.children && result[0] !== SKIP) {\n          offset = (reverse ? nodeAsParent.children.length : -1) + step\n          grandparents = parents.concat(nodeAsParent)\n\n          while (offset > -1 && offset < nodeAsParent.children.length) {\n            const child = nodeAsParent.children[offset]\n\n            subresult = factory(child, offset, grandparents)()\n\n            if (subresult[0] === EXIT) {\n              return subresult\n            }\n\n            offset =\n              typeof subresult[1] === 'number' ? subresult[1] : offset + step\n          }\n        }\n      }\n\n      return result\n    }\n  }\n}\n\n/**\n * Turn a return value into a clean result.\n *\n * @param {VisitorResult} value\n *   Valid return values from visitors.\n * @returns {Readonly<ActionTuple>}\n *   Clean result.\n */\nfunction toResult(value) {\n  if (Array.isArray(value)) {\n    return value\n  }\n\n  if (typeof value === 'number') {\n    return [CONTINUE, value]\n  }\n\n  return value === null || value === undefined ? empty : [value]\n}\n","/**\n * @typedef {import('unist').Node} UnistNode\n * @typedef {import('unist').Parent} UnistParent\n * @typedef {import('unist-util-visit-parents').VisitorResult} VisitorResult\n */\n\n/**\n * @typedef {Exclude<import('unist-util-is').Test, undefined> | undefined} Test\n *   Test from `unist-util-is`.\n *\n *   Note: we have remove and add `undefined`, because otherwise when generating\n *   automatic `.d.ts` files, TS tries to flatten paths from a local perspective,\n *   which doesn’t work when publishing on npm.\n */\n\n// To do: use types from `unist-util-visit-parents` when it’s released.\n\n/**\n * @typedef {(\n *   Fn extends (value: any) => value is infer Thing\n *   ? Thing\n *   : Fallback\n * )} Predicate\n *   Get the value of a type guard `Fn`.\n * @template Fn\n *   Value; typically function that is a type guard (such as `(x): x is Y`).\n * @template Fallback\n *   Value to yield if `Fn` is not a type guard.\n */\n\n/**\n * @typedef {(\n *   Check extends null | undefined // No test.\n *   ? Value\n *   : Value extends {type: Check} // String (type) test.\n *   ? Value\n *   : Value extends Check // Partial test.\n *   ? Value\n *   : Check extends Function // Function test.\n *   ? Predicate<Check, Value> extends Value\n *     ? Predicate<Check, Value>\n *     : never\n *   : never // Some other test?\n * )} MatchesOne\n *   Check whether a node matches a primitive check in the type system.\n * @template Value\n *   Value; typically unist `Node`.\n * @template Check\n *   Value; typically `unist-util-is`-compatible test, but not arrays.\n */\n\n/**\n * @typedef {(\n *   Check extends Array<any>\n *   ? MatchesOne<Value, Check[keyof Check]>\n *   : MatchesOne<Value, Check>\n * )} Matches\n *   Check whether a node matches a check in the type system.\n * @template Value\n *   Value; typically unist `Node`.\n * @template Check\n *   Value; typically `unist-util-is`-compatible test.\n */\n\n/**\n * @typedef {0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10} Uint\n *   Number; capped reasonably.\n */\n\n/**\n * @typedef {I extends 0 ? 1 : I extends 1 ? 2 : I extends 2 ? 3 : I extends 3 ? 4 : I extends 4 ? 5 : I extends 5 ? 6 : I extends 6 ? 7 : I extends 7 ? 8 : I extends 8 ? 9 : 10} Increment\n *   Increment a number in the type system.\n * @template {Uint} [I=0]\n *   Index.\n */\n\n/**\n * @typedef {(\n *   Node extends UnistParent\n *   ? Node extends {children: Array<infer Children>}\n *     ? Child extends Children ? Node : never\n *     : never\n *   : never\n * )} InternalParent\n *   Collect nodes that can be parents of `Child`.\n * @template {UnistNode} Node\n *   All node types in a tree.\n * @template {UnistNode} Child\n *   Node to search for.\n */\n\n/**\n * @typedef {InternalParent<InclusiveDescendant<Tree>, Child>} Parent\n *   Collect nodes in `Tree` that can be parents of `Child`.\n * @template {UnistNode} Tree\n *   All node types in a tree.\n * @template {UnistNode} Child\n *   Node to search for.\n */\n\n/**\n * @typedef {(\n *   Depth extends Max\n *   ? never\n *   :\n *     | InternalParent<Node, Child>\n *     | InternalAncestor<Node, InternalParent<Node, Child>, Max, Increment<Depth>>\n * )} InternalAncestor\n *   Collect nodes in `Tree` that can be ancestors of `Child`.\n * @template {UnistNode} Node\n *   All node types in a tree.\n * @template {UnistNode} Child\n *   Node to search for.\n * @template {Uint} [Max=10]\n *   Max; searches up to this depth.\n * @template {Uint} [Depth=0]\n *   Current depth.\n */\n\n/**\n * @typedef {(\n *   Tree extends UnistParent\n *     ? Depth extends Max\n *       ? Tree\n *       : Tree | InclusiveDescendant<Tree['children'][number], Max, Increment<Depth>>\n *     : Tree\n * )} InclusiveDescendant\n *   Collect all (inclusive) descendants of `Tree`.\n *\n *   > 👉 **Note**: for performance reasons, this seems to be the fastest way to\n *   > recurse without actually running into an infinite loop, which the\n *   > previous version did.\n *   >\n *   > Practically, a max of `2` is typically enough assuming a `Root` is\n *   > passed, but it doesn’t improve performance.\n *   > It gets higher with `List > ListItem > Table > TableRow > TableCell`.\n *   > Using up to `10` doesn’t hurt or help either.\n * @template {UnistNode} Tree\n *   Tree type.\n * @template {Uint} [Max=10]\n *   Max; searches up to this depth.\n * @template {Uint} [Depth=0]\n *   Current depth.\n */\n\n/**\n * @callback Visitor\n *   Handle a node (matching `test`, if given).\n *\n *   Visitors are free to transform `node`.\n *   They can also transform `parent`.\n *\n *   Replacing `node` itself, if `SKIP` is not returned, still causes its\n *   descendants to be walked (which is a bug).\n *\n *   When adding or removing previous siblings of `node` (or next siblings, in\n *   case of reverse), the `Visitor` should return a new `Index` to specify the\n *   sibling to traverse after `node` is traversed.\n *   Adding or removing next siblings of `node` (or previous siblings, in case\n *   of reverse) is handled as expected without needing to return a new `Index`.\n *\n *   Removing the children property of `parent` still results in them being\n *   traversed.\n * @param {Visited} node\n *   Found node.\n * @param {Visited extends UnistNode ? number | undefined : never} index\n *   Index of `node` in `parent`.\n * @param {Ancestor extends UnistParent ? Ancestor | undefined : never} parent\n *   Parent of `node`.\n * @returns {VisitorResult}\n *   What to do next.\n *\n *   An `Index` is treated as a tuple of `[CONTINUE, Index]`.\n *   An `Action` is treated as a tuple of `[Action]`.\n *\n *   Passing a tuple back only makes sense if the `Action` is `SKIP`.\n *   When the `Action` is `EXIT`, that action can be returned.\n *   When the `Action` is `CONTINUE`, `Index` can be returned.\n * @template {UnistNode} [Visited=UnistNode]\n *   Visited node type.\n * @template {UnistParent} [Ancestor=UnistParent]\n *   Ancestor type.\n */\n\n/**\n * @typedef {Visitor<Visited, Parent<Ancestor, Visited>>} BuildVisitorFromMatch\n *   Build a typed `Visitor` function from a node and all possible parents.\n *\n *   It will infer which values are passed as `node` and which as `parent`.\n * @template {UnistNode} Visited\n *   Node type.\n * @template {UnistParent} Ancestor\n *   Parent type.\n */\n\n/**\n * @typedef {(\n *   BuildVisitorFromMatch<\n *     Matches<Descendant, Check>,\n *     Extract<Descendant, UnistParent>\n *   >\n * )} BuildVisitorFromDescendants\n *   Build a typed `Visitor` function from a list of descendants and a test.\n *\n *   It will infer which values are passed as `node` and which as `parent`.\n * @template {UnistNode} Descendant\n *   Node type.\n * @template {Test} Check\n *   Test type.\n */\n\n/**\n * @typedef {(\n *   BuildVisitorFromDescendants<\n *     InclusiveDescendant<Tree>,\n *     Check\n *   >\n * )} BuildVisitor\n *   Build a typed `Visitor` function from a tree and a test.\n *\n *   It will infer which values are passed as `node` and which as `parent`.\n * @template {UnistNode} [Tree=UnistNode]\n *   Node type.\n * @template {Test} [Check=Test]\n *   Test type.\n */\n\nimport {visitParents} from 'unist-util-visit-parents'\n\nexport {CONTINUE, EXIT, SKIP} from 'unist-util-visit-parents'\n\n/**\n * Visit nodes.\n *\n * This algorithm performs *depth-first* *tree traversal* in *preorder*\n * (**NLR**) or if `reverse` is given, in *reverse preorder* (**NRL**).\n *\n * You can choose for which nodes `visitor` is called by passing a `test`.\n * For complex tests, you should test yourself in `visitor`, as it will be\n * faster and will have improved type information.\n *\n * Walking the tree is an intensive task.\n * Make use of the return values of the visitor when possible.\n * Instead of walking a tree multiple times, walk it once, use `unist-util-is`\n * to check if a node matches, and then perform different operations.\n *\n * You can change the tree.\n * See `Visitor` for more info.\n *\n * @overload\n * @param {Tree} tree\n * @param {Check} check\n * @param {BuildVisitor<Tree, Check>} visitor\n * @param {boolean | null | undefined} [reverse]\n * @returns {undefined}\n *\n * @overload\n * @param {Tree} tree\n * @param {BuildVisitor<Tree>} visitor\n * @param {boolean | null | undefined} [reverse]\n * @returns {undefined}\n *\n * @param {UnistNode} tree\n *   Tree to traverse.\n * @param {Visitor | Test} testOrVisitor\n *   `unist-util-is`-compatible test (optional, omit to pass a visitor).\n * @param {Visitor | boolean | null | undefined} [visitorOrReverse]\n *   Handle each node (when test is omitted, pass `reverse`).\n * @param {boolean | null | undefined} [maybeReverse=false]\n *   Traverse in reverse preorder (NRL) instead of the default preorder (NLR).\n * @returns {undefined}\n *   Nothing.\n *\n * @template {UnistNode} Tree\n *   Node type.\n * @template {Test} Check\n *   `unist-util-is`-compatible test.\n */\nexport function visit(tree, testOrVisitor, visitorOrReverse, maybeReverse) {\n  /** @type {boolean | null | undefined} */\n  let reverse\n  /** @type {Test} */\n  let test\n  /** @type {Visitor} */\n  let visitor\n\n  if (\n    typeof testOrVisitor === 'function' &&\n    typeof visitorOrReverse !== 'function'\n  ) {\n    test = undefined\n    visitor = testOrVisitor\n    reverse = visitorOrReverse\n  } else {\n    // @ts-expect-error: assume the overload with test was given.\n    test = testOrVisitor\n    // @ts-expect-error: assume the overload with test was given.\n    visitor = visitorOrReverse\n    reverse = maybeReverse\n  }\n\n  visitParents(tree, test, overload, reverse)\n\n  /**\n   * @param {UnistNode} node\n   * @param {Array<UnistParent>} parents\n   */\n  function overload(node, parents) {\n    const parent = parents[parents.length - 1]\n    const index = parent ? parent.children.indexOf(node) : undefined\n    return visitor(node, index, parent)\n  }\n}\n","/**\n * @typedef {import('hast').ElementContent} ElementContent\n *\n * @typedef {import('mdast').Nodes} Nodes\n * @typedef {import('mdast').Reference} Reference\n *\n * @typedef {import('./state.js').State} State\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Return the content of a reference without definition as plain text.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Extract<Nodes, Reference>} node\n *   Reference node (image, link).\n * @returns {Array<ElementContent>}\n *   hast content.\n */\nexport function revert(state, node) {\n  const subtype = node.referenceType\n  let suffix = ']'\n\n  if (subtype === 'collapsed') {\n    suffix += '[]'\n  } else if (subtype === 'full') {\n    suffix += '[' + (node.label || node.identifier) + ']'\n  }\n\n  if (node.type === 'imageReference') {\n    return [{type: 'text', value: '![' + node.alt + suffix}]\n  }\n\n  const contents = state.all(node)\n  const head = contents[0]\n\n  if (head && head.type === 'text') {\n    head.value = '[' + head.value\n  } else {\n    contents.unshift({type: 'text', value: '['})\n  }\n\n  const tail = contents[contents.length - 1]\n\n  if (tail && tail.type === 'text') {\n    tail.value += suffix\n  } else {\n    contents.push({type: 'text', value: suffix})\n  }\n\n  return contents\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('hast').ElementContent} ElementContent\n * @typedef {import('hast').Properties} Properties\n * @typedef {import('mdast').ListItem} ListItem\n * @typedef {import('mdast').Parents} Parents\n * @typedef {import('../state.js').State} State\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Turn an mdast `listItem` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {ListItem} node\n *   mdast node.\n * @param {Parents | undefined} parent\n *   Parent of `node`.\n * @returns {Element}\n *   hast node.\n */\nexport function listItem(state, node, parent) {\n  const results = state.all(node)\n  const loose = parent ? listLoose(parent) : listItemLoose(node)\n  /** @type {Properties} */\n  const properties = {}\n  /** @type {Array<ElementContent>} */\n  const children = []\n\n  if (typeof node.checked === 'boolean') {\n    const head = results[0]\n    /** @type {Element} */\n    let paragraph\n\n    if (head && head.type === 'element' && head.tagName === 'p') {\n      paragraph = head\n    } else {\n      paragraph = {type: 'element', tagName: 'p', properties: {}, children: []}\n      results.unshift(paragraph)\n    }\n\n    if (paragraph.children.length > 0) {\n      paragraph.children.unshift({type: 'text', value: ' '})\n    }\n\n    paragraph.children.unshift({\n      type: 'element',\n      tagName: 'input',\n      properties: {type: 'checkbox', checked: node.checked, disabled: true},\n      children: []\n    })\n\n    // According to github-markdown-css, this class hides bullet.\n    // See: <https://github.com/sindresorhus/github-markdown-css>.\n    properties.className = ['task-list-item']\n  }\n\n  let index = -1\n\n  while (++index < results.length) {\n    const child = results[index]\n\n    // Add eols before nodes, except if this is a loose, first paragraph.\n    if (\n      loose ||\n      index !== 0 ||\n      child.type !== 'element' ||\n      child.tagName !== 'p'\n    ) {\n      children.push({type: 'text', value: '\\n'})\n    }\n\n    if (child.type === 'element' && child.tagName === 'p' && !loose) {\n      children.push(...child.children)\n    } else {\n      children.push(child)\n    }\n  }\n\n  const tail = results[results.length - 1]\n\n  // Add a final eol.\n  if (tail && (loose || tail.type !== 'element' || tail.tagName !== 'p')) {\n    children.push({type: 'text', value: '\\n'})\n  }\n\n  /** @type {Element} */\n  const result = {type: 'element', tagName: 'li', properties, children}\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n\n/**\n * @param {Parents} node\n * @return {Boolean}\n */\nfunction listLoose(node) {\n  let loose = false\n  if (node.type === 'list') {\n    loose = node.spread || false\n    const children = node.children\n    let index = -1\n\n    while (!loose && ++index < children.length) {\n      loose = listItemLoose(children[index])\n    }\n  }\n\n  return loose\n}\n\n/**\n * @param {ListItem} node\n * @return {Boolean}\n */\nfunction listItemLoose(node) {\n  const spread = node.spread\n\n  return spread === null || spread === undefined\n    ? node.children.length > 1\n    : spread\n}\n","const tab = 9 /* `\\t` */\nconst space = 32 /* ` ` */\n\n/**\n * Remove initial and final spaces and tabs at the line breaks in `value`.\n * Does not trim initial and final spaces and tabs of the value itself.\n *\n * @param {string} value\n *   Value to trim.\n * @returns {string}\n *   Trimmed value.\n */\nexport function trimLines(value) {\n  const source = String(value)\n  const search = /\\r?\\n|\\r/g\n  let match = search.exec(source)\n  let last = 0\n  /** @type {Array<string>} */\n  const lines = []\n\n  while (match) {\n    lines.push(\n      trimLine(source.slice(last, match.index), last > 0, true),\n      match[0]\n    )\n\n    last = match.index + match[0].length\n    match = search.exec(source)\n  }\n\n  lines.push(trimLine(source.slice(last), last > 0, false))\n\n  return lines.join('')\n}\n\n/**\n * @param {string} value\n *   Line to trim.\n * @param {boolean} start\n *   Whether to trim the start of the line.\n * @param {boolean} end\n *   Whether to trim the end of the line.\n * @returns {string}\n *   Trimmed line.\n */\nfunction trimLine(value, start, end) {\n  let startIndex = 0\n  let endIndex = value.length\n\n  if (start) {\n    let code = value.codePointAt(startIndex)\n\n    while (code === tab || code === space) {\n      startIndex++\n      code = value.codePointAt(startIndex)\n    }\n  }\n\n  if (end) {\n    let code = value.codePointAt(endIndex - 1)\n\n    while (code === tab || code === space) {\n      endIndex--\n      code = value.codePointAt(endIndex - 1)\n    }\n  }\n\n  return endIndex > startIndex ? value.slice(startIndex, endIndex) : ''\n}\n","import {blockquote} from './blockquote.js'\nimport {hardBreak} from './break.js'\nimport {code} from './code.js'\nimport {strikethrough} from './delete.js'\nimport {emphasis} from './emphasis.js'\nimport {footnoteReference} from './footnote-reference.js'\nimport {heading} from './heading.js'\nimport {html} from './html.js'\nimport {imageReference} from './image-reference.js'\nimport {image} from './image.js'\nimport {inlineCode} from './inline-code.js'\nimport {linkReference} from './link-reference.js'\nimport {link} from './link.js'\nimport {listItem} from './list-item.js'\nimport {list} from './list.js'\nimport {paragraph} from './paragraph.js'\nimport {root} from './root.js'\nimport {strong} from './strong.js'\nimport {table} from './table.js'\nimport {tableRow} from './table-row.js'\nimport {tableCell} from './table-cell.js'\nimport {text} from './text.js'\nimport {thematicBreak} from './thematic-break.js'\n\n/**\n * Default handlers for nodes.\n *\n * @satisfies {import('../state.js').Handlers}\n */\nexport const handlers = {\n  blockquote,\n  break: hardBreak,\n  code,\n  delete: strikethrough,\n  emphasis,\n  footnoteReference,\n  heading,\n  html,\n  imageReference,\n  image,\n  inlineCode,\n  linkReference,\n  link,\n  listItem,\n  list,\n  paragraph,\n  // @ts-expect-error: root is different, but hard to type.\n  root,\n  strong,\n  table,\n  tableCell,\n  tableRow,\n  text,\n  thematicBreak,\n  toml: ignore,\n  yaml: ignore,\n  definition: ignore,\n  footnoteDefinition: ignore\n}\n\n// Return nothing for nodes that are ignored.\nfunction ignore() {\n  return undefined\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('mdast').Blockquote} Blockquote\n * @typedef {import('../state.js').State} State\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Turn an mdast `blockquote` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Blockquote} node\n *   mdast node.\n * @returns {Element}\n *   hast node.\n */\nexport function blockquote(state, node) {\n  /** @type {Element} */\n  const result = {\n    type: 'element',\n    tagName: 'blockquote',\n    properties: {},\n    children: state.wrap(state.all(node), true)\n  }\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('hast').Text} Text\n * @typedef {import('mdast').Break} Break\n * @typedef {import('../state.js').State} State\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Turn an mdast `break` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Break} node\n *   mdast node.\n * @returns {Array<Element | Text>}\n *   hast element content.\n */\nexport function hardBreak(state, node) {\n  /** @type {Element} */\n  const result = {type: 'element', tagName: 'br', properties: {}, children: []}\n  state.patch(node, result)\n  return [state.applyData(node, result), {type: 'text', value: '\\n'}]\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('hast').Properties} Properties\n * @typedef {import('mdast').Code} Code\n * @typedef {import('../state.js').State} State\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Turn an mdast `code` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Code} node\n *   mdast node.\n * @returns {Element}\n *   hast node.\n */\nexport function code(state, node) {\n  const value = node.value ? node.value + '\\n' : ''\n  /** @type {Properties} */\n  const properties = {}\n\n  if (node.lang) {\n    properties.className = ['language-' + node.lang]\n  }\n\n  // Create `<code>`.\n  /** @type {Element} */\n  let result = {\n    type: 'element',\n    tagName: 'code',\n    properties,\n    children: [{type: 'text', value}]\n  }\n\n  if (node.meta) {\n    result.data = {meta: node.meta}\n  }\n\n  state.patch(node, result)\n  result = state.applyData(node, result)\n\n  // Create `<pre>`.\n  result = {type: 'element', tagName: 'pre', properties: {}, children: [result]}\n  state.patch(node, result)\n  return result\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('mdast').Delete} Delete\n * @typedef {import('../state.js').State} State\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Turn an mdast `delete` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Delete} node\n *   mdast node.\n * @returns {Element}\n *   hast node.\n */\nexport function strikethrough(state, node) {\n  /** @type {Element} */\n  const result = {\n    type: 'element',\n    tagName: 'del',\n    properties: {},\n    children: state.all(node)\n  }\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('mdast').Emphasis} Emphasis\n * @typedef {import('../state.js').State} State\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Turn an mdast `emphasis` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Emphasis} node\n *   mdast node.\n * @returns {Element}\n *   hast node.\n */\nexport function emphasis(state, node) {\n  /** @type {Element} */\n  const result = {\n    type: 'element',\n    tagName: 'em',\n    properties: {},\n    children: state.all(node)\n  }\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('mdast').FootnoteReference} FootnoteReference\n * @typedef {import('../state.js').State} State\n */\n\nimport {normalizeUri} from 'micromark-util-sanitize-uri'\n\n/**\n * Turn an mdast `footnoteReference` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {FootnoteReference} node\n *   mdast node.\n * @returns {Element}\n *   hast node.\n */\nexport function footnoteReference(state, node) {\n  const clobberPrefix =\n    typeof state.options.clobberPrefix === 'string'\n      ? state.options.clobberPrefix\n      : 'user-content-'\n  const id = String(node.identifier).toUpperCase()\n  const safeId = normalizeUri(id.toLowerCase())\n  const index = state.footnoteOrder.indexOf(id)\n  /** @type {number} */\n  let counter\n\n  let reuseCounter = state.footnoteCounts.get(id)\n\n  if (reuseCounter === undefined) {\n    reuseCounter = 0\n    state.footnoteOrder.push(id)\n    counter = state.footnoteOrder.length\n  } else {\n    counter = index + 1\n  }\n\n  reuseCounter += 1\n  state.footnoteCounts.set(id, reuseCounter)\n\n  /** @type {Element} */\n  const link = {\n    type: 'element',\n    tagName: 'a',\n    properties: {\n      href: '#' + clobberPrefix + 'fn-' + safeId,\n      id:\n        clobberPrefix +\n        'fnref-' +\n        safeId +\n        (reuseCounter > 1 ? '-' + reuseCounter : ''),\n      dataFootnoteRef: true,\n      ariaDescribedBy: ['footnote-label']\n    },\n    children: [{type: 'text', value: String(counter)}]\n  }\n  state.patch(node, link)\n\n  /** @type {Element} */\n  const sup = {\n    type: 'element',\n    tagName: 'sup',\n    properties: {},\n    children: [link]\n  }\n  state.patch(node, sup)\n  return state.applyData(node, sup)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('mdast').Heading} Heading\n * @typedef {import('../state.js').State} State\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Turn an mdast `heading` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Heading} node\n *   mdast node.\n * @returns {Element}\n *   hast node.\n */\nexport function heading(state, node) {\n  /** @type {Element} */\n  const result = {\n    type: 'element',\n    tagName: 'h' + node.depth,\n    properties: {},\n    children: state.all(node)\n  }\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('mdast').Html} Html\n * @typedef {import('../state.js').State} State\n * @typedef {import('../../index.js').Raw} Raw\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Turn an mdast `html` node into hast (`raw` node in dangerous mode, otherwise\n * nothing).\n *\n * @param {State} state\n *   Info passed around.\n * @param {Html} node\n *   mdast node.\n * @returns {Element | Raw | undefined}\n *   hast node.\n */\nexport function html(state, node) {\n  if (state.options.allowDangerousHtml) {\n    /** @type {Raw} */\n    const result = {type: 'raw', value: node.value}\n    state.patch(node, result)\n    return state.applyData(node, result)\n  }\n\n  return undefined\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('hast').ElementContent} ElementContent\n * @typedef {import('hast').Properties} Properties\n * @typedef {import('mdast').ImageReference} ImageReference\n * @typedef {import('../state.js').State} State\n */\n\nimport {normalizeUri} from 'micromark-util-sanitize-uri'\nimport {revert} from '../revert.js'\n\n/**\n * Turn an mdast `imageReference` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {ImageReference} node\n *   mdast node.\n * @returns {Array<ElementContent> | ElementContent}\n *   hast node.\n */\nexport function imageReference(state, node) {\n  const id = String(node.identifier).toUpperCase()\n  const definition = state.definitionById.get(id)\n\n  if (!definition) {\n    return revert(state, node)\n  }\n\n  /** @type {Properties} */\n  const properties = {src: normalizeUri(definition.url || ''), alt: node.alt}\n\n  if (definition.title !== null && definition.title !== undefined) {\n    properties.title = definition.title\n  }\n\n  /** @type {Element} */\n  const result = {type: 'element', tagName: 'img', properties, children: []}\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('hast').Properties} Properties\n * @typedef {import('mdast').Image} Image\n * @typedef {import('../state.js').State} State\n */\n\nimport {normalizeUri} from 'micromark-util-sanitize-uri'\n\n/**\n * Turn an mdast `image` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Image} node\n *   mdast node.\n * @returns {Element}\n *   hast node.\n */\nexport function image(state, node) {\n  /** @type {Properties} */\n  const properties = {src: normalizeUri(node.url)}\n\n  if (node.alt !== null && node.alt !== undefined) {\n    properties.alt = node.alt\n  }\n\n  if (node.title !== null && node.title !== undefined) {\n    properties.title = node.title\n  }\n\n  /** @type {Element} */\n  const result = {type: 'element', tagName: 'img', properties, children: []}\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('hast').Text} Text\n * @typedef {import('mdast').InlineCode} InlineCode\n * @typedef {import('../state.js').State} State\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Turn an mdast `inlineCode` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {InlineCode} node\n *   mdast node.\n * @returns {Element}\n *   hast node.\n */\nexport function inlineCode(state, node) {\n  /** @type {Text} */\n  const text = {type: 'text', value: node.value.replace(/\\r?\\n|\\r/g, ' ')}\n  state.patch(node, text)\n\n  /** @type {Element} */\n  const result = {\n    type: 'element',\n    tagName: 'code',\n    properties: {},\n    children: [text]\n  }\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('hast').ElementContent} ElementContent\n * @typedef {import('hast').Properties} Properties\n * @typedef {import('mdast').LinkReference} LinkReference\n * @typedef {import('../state.js').State} State\n */\n\nimport {normalizeUri} from 'micromark-util-sanitize-uri'\nimport {revert} from '../revert.js'\n\n/**\n * Turn an mdast `linkReference` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {LinkReference} node\n *   mdast node.\n * @returns {Array<ElementContent> | ElementContent}\n *   hast node.\n */\nexport function linkReference(state, node) {\n  const id = String(node.identifier).toUpperCase()\n  const definition = state.definitionById.get(id)\n\n  if (!definition) {\n    return revert(state, node)\n  }\n\n  /** @type {Properties} */\n  const properties = {href: normalizeUri(definition.url || '')}\n\n  if (definition.title !== null && definition.title !== undefined) {\n    properties.title = definition.title\n  }\n\n  /** @type {Element} */\n  const result = {\n    type: 'element',\n    tagName: 'a',\n    properties,\n    children: state.all(node)\n  }\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('hast').Properties} Properties\n * @typedef {import('mdast').Link} Link\n * @typedef {import('../state.js').State} State\n */\n\nimport {normalizeUri} from 'micromark-util-sanitize-uri'\n\n/**\n * Turn an mdast `link` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Link} node\n *   mdast node.\n * @returns {Element}\n *   hast node.\n */\nexport function link(state, node) {\n  /** @type {Properties} */\n  const properties = {href: normalizeUri(node.url)}\n\n  if (node.title !== null && node.title !== undefined) {\n    properties.title = node.title\n  }\n\n  /** @type {Element} */\n  const result = {\n    type: 'element',\n    tagName: 'a',\n    properties,\n    children: state.all(node)\n  }\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('hast').Properties} Properties\n * @typedef {import('mdast').List} List\n * @typedef {import('../state.js').State} State\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Turn an mdast `list` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {List} node\n *   mdast node.\n * @returns {Element}\n *   hast node.\n */\nexport function list(state, node) {\n  /** @type {Properties} */\n  const properties = {}\n  const results = state.all(node)\n  let index = -1\n\n  if (typeof node.start === 'number' && node.start !== 1) {\n    properties.start = node.start\n  }\n\n  // Like GitHub, add a class for custom styling.\n  while (++index < results.length) {\n    const child = results[index]\n\n    if (\n      child.type === 'element' &&\n      child.tagName === 'li' &&\n      child.properties &&\n      Array.isArray(child.properties.className) &&\n      child.properties.className.includes('task-list-item')\n    ) {\n      properties.className = ['contains-task-list']\n      break\n    }\n  }\n\n  /** @type {Element} */\n  const result = {\n    type: 'element',\n    tagName: node.ordered ? 'ol' : 'ul',\n    properties,\n    children: state.wrap(results, true)\n  }\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('mdast').Paragraph} Paragraph\n * @typedef {import('../state.js').State} State\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Turn an mdast `paragraph` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Paragraph} node\n *   mdast node.\n * @returns {Element}\n *   hast node.\n */\nexport function paragraph(state, node) {\n  /** @type {Element} */\n  const result = {\n    type: 'element',\n    tagName: 'p',\n    properties: {},\n    children: state.all(node)\n  }\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Parents} HastParents\n * @typedef {import('hast').Root} HastRoot\n * @typedef {import('mdast').Root} MdastRoot\n * @typedef {import('../state.js').State} State\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Turn an mdast `root` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {MdastRoot} node\n *   mdast node.\n * @returns {HastParents}\n *   hast node.\n */\nexport function root(state, node) {\n  /** @type {HastRoot} */\n  const result = {type: 'root', children: state.wrap(state.all(node))}\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('mdast').Strong} Strong\n * @typedef {import('../state.js').State} State\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Turn an mdast `strong` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Strong} node\n *   mdast node.\n * @returns {Element}\n *   hast node.\n */\nexport function strong(state, node) {\n  /** @type {Element} */\n  const result = {\n    type: 'element',\n    tagName: 'strong',\n    properties: {},\n    children: state.all(node)\n  }\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('mdast').Table} Table\n * @typedef {import('../state.js').State} State\n */\n\nimport {pointEnd, pointStart} from 'unist-util-position'\n\n/**\n * Turn an mdast `table` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {Table} node\n *   mdast node.\n * @returns {Element}\n *   hast node.\n */\nexport function table(state, node) {\n  const rows = state.all(node)\n  const firstRow = rows.shift()\n  /** @type {Array<Element>} */\n  const tableContent = []\n\n  if (firstRow) {\n    /** @type {Element} */\n    const head = {\n      type: 'element',\n      tagName: 'thead',\n      properties: {},\n      children: state.wrap([firstRow], true)\n    }\n    state.patch(node.children[0], head)\n    tableContent.push(head)\n  }\n\n  if (rows.length > 0) {\n    /** @type {Element} */\n    const body = {\n      type: 'element',\n      tagName: 'tbody',\n      properties: {},\n      children: state.wrap(rows, true)\n    }\n\n    const start = pointStart(node.children[1])\n    const end = pointEnd(node.children[node.children.length - 1])\n    if (start && end) body.position = {start, end}\n    tableContent.push(body)\n  }\n\n  /** @type {Element} */\n  const result = {\n    type: 'element',\n    tagName: 'table',\n    properties: {},\n    children: state.wrap(tableContent, true)\n  }\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('mdast').TableCell} TableCell\n * @typedef {import('../state.js').State} State\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Turn an mdast `tableCell` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {TableCell} node\n *   mdast node.\n * @returns {Element}\n *   hast node.\n */\nexport function tableCell(state, node) {\n  // Note: this function is normally not called: see `table-row` for how rows\n  // and their cells are compiled.\n  /** @type {Element} */\n  const result = {\n    type: 'element',\n    tagName: 'td', // Assume body cell.\n    properties: {},\n    children: state.all(node)\n  }\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('hast').ElementContent} ElementContent\n * @typedef {import('hast').Properties} Properties\n * @typedef {import('mdast').Parents} Parents\n * @typedef {import('mdast').TableRow} TableRow\n * @typedef {import('../state.js').State} State\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Turn an mdast `tableRow` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {TableRow} node\n *   mdast node.\n * @param {Parents | undefined} parent\n *   Parent of `node`.\n * @returns {Element}\n *   hast node.\n */\nexport function tableRow(state, node, parent) {\n  const siblings = parent ? parent.children : undefined\n  // Generate a body row when without parent.\n  const rowIndex = siblings ? siblings.indexOf(node) : 1\n  const tagName = rowIndex === 0 ? 'th' : 'td'\n  // To do: option to use `style`?\n  const align = parent && parent.type === 'table' ? parent.align : undefined\n  const length = align ? align.length : node.children.length\n  let cellIndex = -1\n  /** @type {Array<ElementContent>} */\n  const cells = []\n\n  while (++cellIndex < length) {\n    // Note: can also be undefined.\n    const cell = node.children[cellIndex]\n    /** @type {Properties} */\n    const properties = {}\n    const alignValue = align ? align[cellIndex] : undefined\n\n    if (alignValue) {\n      properties.align = alignValue\n    }\n\n    /** @type {Element} */\n    let result = {type: 'element', tagName, properties, children: []}\n\n    if (cell) {\n      result.children = state.all(cell)\n      state.patch(cell, result)\n      result = state.applyData(cell, result)\n    }\n\n    cells.push(result)\n  }\n\n  /** @type {Element} */\n  const result = {\n    type: 'element',\n    tagName: 'tr',\n    properties: {},\n    children: state.wrap(cells, true)\n  }\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} HastElement\n * @typedef {import('hast').Text} HastText\n * @typedef {import('mdast').Text} MdastText\n * @typedef {import('../state.js').State} State\n */\n\nimport {trimLines} from 'trim-lines'\n\n/**\n * Turn an mdast `text` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {MdastText} node\n *   mdast node.\n * @returns {HastElement | HastText}\n *   hast node.\n */\nexport function text(state, node) {\n  /** @type {HastText} */\n  const result = {type: 'text', value: trimLines(String(node.value))}\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('mdast').ThematicBreak} ThematicBreak\n * @typedef {import('../state.js').State} State\n */\n\n// Make VS Code show references to the above types.\n''\n\n/**\n * Turn an mdast `thematicBreak` node into hast.\n *\n * @param {State} state\n *   Info passed around.\n * @param {ThematicBreak} node\n *   mdast node.\n * @returns {Element}\n *   hast node.\n */\nexport function thematicBreak(state, node) {\n  /** @type {Element} */\n  const result = {\n    type: 'element',\n    tagName: 'hr',\n    properties: {},\n    children: []\n  }\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n","/**\n * @typedef {import('hast').Element} HastElement\n * @typedef {import('hast').ElementContent} HastElementContent\n * @typedef {import('hast').Nodes} HastNodes\n * @typedef {import('hast').Properties} HastProperties\n * @typedef {import('hast').RootContent} HastRootContent\n * @typedef {import('hast').Text} HastText\n *\n * @typedef {import('mdast').Definition} MdastDefinition\n * @typedef {import('mdast').FootnoteDefinition} MdastFootnoteDefinition\n * @typedef {import('mdast').Nodes} MdastNodes\n * @typedef {import('mdast').Parents} MdastParents\n *\n * @typedef {import('vfile').VFile} VFile\n *\n * @typedef {import('./footer.js').FootnoteBackContentTemplate} FootnoteBackContentTemplate\n * @typedef {import('./footer.js').FootnoteBackLabelTemplate} FootnoteBackLabelTemplate\n */\n\n/**\n * @callback Handler\n *   Handle a node.\n * @param {State} state\n *   Info passed around.\n * @param {any} node\n *   mdast node to handle.\n * @param {MdastParents | undefined} parent\n *   Parent of `node`.\n * @returns {Array<HastElementContent> | HastElementContent | undefined}\n *   hast node.\n *\n * @typedef {Partial<Record<MdastNodes['type'], Handler>>} Handlers\n *   Handle nodes.\n *\n * @typedef Options\n *   Configuration (optional).\n * @property {boolean | null | undefined} [allowDangerousHtml=false]\n *   Whether to persist raw HTML in markdown in the hast tree (default:\n *   `false`).\n * @property {string | null | undefined} [clobberPrefix='user-content-']\n *   Prefix to use before the `id` property on footnotes to prevent them from\n *   *clobbering* (default: `'user-content-'`).\n *\n *   Pass `''` for trusted markdown and when you are careful with\n *   polyfilling.\n *   You could pass a different prefix.\n *\n *   DOM clobbering is this:\n *\n *   ```html\n *   <p id=\"x\"></p>\n *   <script>alert(x) // `x` now refers to the `p#x` DOM element</script>\n *   ```\n *\n *   The above example shows that elements are made available by browsers, by\n *   their ID, on the `window` object.\n *   This is a security risk because you might be expecting some other variable\n *   at that place.\n *   It can also break polyfills.\n *   Using a prefix solves these problems.\n * @property {VFile | null | undefined} [file]\n *   Corresponding virtual file representing the input document (optional).\n * @property {FootnoteBackContentTemplate | string | null | undefined} [footnoteBackContent]\n *   Content of the backreference back to references (default: `defaultFootnoteBackContent`).\n *\n *   The default value is:\n *\n *   ```js\n *   function defaultFootnoteBackContent(_, rereferenceIndex) {\n *     const result = [{type: 'text', value: '↩'}]\n *\n *     if (rereferenceIndex > 1) {\n *       result.push({\n *         type: 'element',\n *         tagName: 'sup',\n *         properties: {},\n *         children: [{type: 'text', value: String(rereferenceIndex)}]\n *       })\n *     }\n *\n *     return result\n *   }\n *   ```\n *\n *   This content is used in the `a` element of each backreference (the `↩`\n *   links).\n * @property {FootnoteBackLabelTemplate | string | null | undefined} [footnoteBackLabel]\n *   Label to describe the backreference back to references (default:\n *   `defaultFootnoteBackLabel`).\n *\n *   The default value is:\n *\n *   ```js\n *   function defaultFootnoteBackLabel(referenceIndex, rereferenceIndex) {\n *    return (\n *      'Back to reference ' +\n *      (referenceIndex + 1) +\n *      (rereferenceIndex > 1 ? '-' + rereferenceIndex : '')\n *    )\n *   }\n *   ```\n *\n *   Change it when the markdown is not in English.\n *\n *   This label is used in the `ariaLabel` property on each backreference\n *   (the `↩` links).\n *   It affects users of assistive technology.\n * @property {string | null | undefined} [footnoteLabel='Footnotes']\n *   Textual label to use for the footnotes section (default: `'Footnotes'`).\n *\n *   Change it when the markdown is not in English.\n *\n *   This label is typically hidden visually (assuming a `sr-only` CSS class\n *   is defined that does that) and so affects screen readers only.\n *   If you do have such a class, but want to show this section to everyone,\n *   pass different properties with the `footnoteLabelProperties` option.\n * @property {HastProperties | null | undefined} [footnoteLabelProperties={className: ['sr-only']}]\n *   Properties to use on the footnote label (default: `{className:\n *   ['sr-only']}`).\n *\n *   Change it to show the label and add other properties.\n *\n *   This label is typically hidden visually (assuming an `sr-only` CSS class\n *   is defined that does that) and so affects screen readers only.\n *   If you do have such a class, but want to show this section to everyone,\n *   pass an empty string.\n *   You can also add different properties.\n *\n *   > **Note**: `id: 'footnote-label'` is always added, because footnote\n *   > calls use it with `aria-describedby` to provide an accessible label.\n * @property {string | null | undefined} [footnoteLabelTagName='h2']\n *   HTML tag name to use for the footnote label element (default: `'h2'`).\n *\n *   Change it to match your document structure.\n *\n *   This label is typically hidden visually (assuming a `sr-only` CSS class\n *   is defined that does that) and so affects screen readers only.\n *   If you do have such a class, but want to show this section to everyone,\n *   pass different properties with the `footnoteLabelProperties` option.\n * @property {Handlers | null | undefined} [handlers]\n *   Extra handlers for nodes (optional).\n * @property {Array<MdastNodes['type']> | null | undefined} [passThrough]\n *   List of custom mdast node types to pass through (keep) in hast (note that\n *   the node itself is passed, but eventual children are transformed)\n *   (optional).\n * @property {Handler | null | undefined} [unknownHandler]\n *   Handler for all unknown nodes (optional).\n *\n * @typedef State\n *   Info passed around.\n * @property {(node: MdastNodes) => Array<HastElementContent>} all\n *   Transform the children of an mdast parent to hast.\n * @property {<Type extends HastNodes>(from: MdastNodes, to: Type) => HastElement | Type} applyData\n *   Honor the `data` of `from`, and generate an element instead of `node`.\n * @property {Map<string, MdastDefinition>} definitionById\n *   Definitions by their identifier.\n * @property {Map<string, MdastFootnoteDefinition>} footnoteById\n *   Footnote definitions by their identifier.\n * @property {Map<string, number>} footnoteCounts\n *   Counts for how often the same footnote was called.\n * @property {Array<string>} footnoteOrder\n *   Identifiers of order when footnote calls first appear in tree order.\n * @property {Handlers} handlers\n *   Applied handlers.\n * @property {(node: MdastNodes, parent: MdastParents | undefined) => Array<HastElementContent> | HastElementContent | undefined} one\n *   Transform an mdast node to hast.\n * @property {Options} options\n *   Configuration.\n * @property {(from: MdastNodes, node: HastNodes) => undefined} patch\n *   Copy a node’s positional info.\n * @property {<Type extends HastRootContent>(nodes: Array<Type>, loose?: boolean | undefined) => Array<HastText | Type>} wrap\n *   Wrap `nodes` with line endings between each node, adds initial/final line endings when `loose`.\n */\n\nimport structuredClone from '@ungap/structured-clone'\nimport {visit} from 'unist-util-visit'\nimport {position} from 'unist-util-position'\nimport {handlers as defaultHandlers} from './handlers/index.js'\n\nconst own = {}.hasOwnProperty\n\n/** @type {Options} */\nconst emptyOptions = {}\n\n/**\n * Create `state` from an mdast tree.\n *\n * @param {MdastNodes} tree\n *   mdast node to transform.\n * @param {Options | null | undefined} [options]\n *   Configuration (optional).\n * @returns {State}\n *   `state` function.\n */\nexport function createState(tree, options) {\n  const settings = options || emptyOptions\n  /** @type {Map<string, MdastDefinition>} */\n  const definitionById = new Map()\n  /** @type {Map<string, MdastFootnoteDefinition>} */\n  const footnoteById = new Map()\n  /** @type {Map<string, number>} */\n  const footnoteCounts = new Map()\n  /** @type {Handlers} */\n  // @ts-expect-error: the root handler returns a root.\n  // Hard to type.\n  const handlers = {...defaultHandlers, ...settings.handlers}\n\n  /** @type {State} */\n  const state = {\n    all,\n    applyData,\n    definitionById,\n    footnoteById,\n    footnoteCounts,\n    footnoteOrder: [],\n    handlers,\n    one,\n    options: settings,\n    patch,\n    wrap\n  }\n\n  visit(tree, function (node) {\n    if (node.type === 'definition' || node.type === 'footnoteDefinition') {\n      const map = node.type === 'definition' ? definitionById : footnoteById\n      const id = String(node.identifier).toUpperCase()\n\n      // Mimick CM behavior of link definitions.\n      // See: <https://github.com/syntax-tree/mdast-util-definitions/blob/9032189/lib/index.js#L20-L21>.\n      if (!map.has(id)) {\n        // @ts-expect-error: node type matches map.\n        map.set(id, node)\n      }\n    }\n  })\n\n  return state\n\n  /**\n   * Transform an mdast node into a hast node.\n   *\n   * @param {MdastNodes} node\n   *   mdast node.\n   * @param {MdastParents | undefined} [parent]\n   *   Parent of `node`.\n   * @returns {Array<HastElementContent> | HastElementContent | undefined}\n   *   Resulting hast node.\n   */\n  function one(node, parent) {\n    const type = node.type\n    const handle = state.handlers[type]\n\n    if (own.call(state.handlers, type) && handle) {\n      return handle(state, node, parent)\n    }\n\n    if (state.options.passThrough && state.options.passThrough.includes(type)) {\n      if ('children' in node) {\n        const {children, ...shallow} = node\n        const result = structuredClone(shallow)\n        // @ts-expect-error: TS doesn’t understand…\n        result.children = state.all(node)\n        // @ts-expect-error: TS doesn’t understand…\n        return result\n      }\n\n      // @ts-expect-error: it’s custom.\n      return structuredClone(node)\n    }\n\n    const unknown = state.options.unknownHandler || defaultUnknownHandler\n\n    return unknown(state, node, parent)\n  }\n\n  /**\n   * Transform the children of an mdast node into hast nodes.\n   *\n   * @param {MdastNodes} parent\n   *   mdast node to compile\n   * @returns {Array<HastElementContent>}\n   *   Resulting hast nodes.\n   */\n  function all(parent) {\n    /** @type {Array<HastElementContent>} */\n    const values = []\n\n    if ('children' in parent) {\n      const nodes = parent.children\n      let index = -1\n      while (++index < nodes.length) {\n        const result = state.one(nodes[index], parent)\n\n        // To do: see if we van clean this? Can we merge texts?\n        if (result) {\n          if (index && nodes[index - 1].type === 'break') {\n            if (!Array.isArray(result) && result.type === 'text') {\n              result.value = trimMarkdownSpaceStart(result.value)\n            }\n\n            if (!Array.isArray(result) && result.type === 'element') {\n              const head = result.children[0]\n\n              if (head && head.type === 'text') {\n                head.value = trimMarkdownSpaceStart(head.value)\n              }\n            }\n          }\n\n          if (Array.isArray(result)) {\n            values.push(...result)\n          } else {\n            values.push(result)\n          }\n        }\n      }\n    }\n\n    return values\n  }\n}\n\n/**\n * Copy a node’s positional info.\n *\n * @param {MdastNodes} from\n *   mdast node to copy from.\n * @param {HastNodes} to\n *   hast node to copy into.\n * @returns {undefined}\n *   Nothing.\n */\nfunction patch(from, to) {\n  if (from.position) to.position = position(from)\n}\n\n/**\n * Honor the `data` of `from` and maybe generate an element instead of `to`.\n *\n * @template {HastNodes} Type\n *   Node type.\n * @param {MdastNodes} from\n *   mdast node to use data from.\n * @param {Type} to\n *   hast node to change.\n * @returns {HastElement | Type}\n *   Nothing.\n */\nfunction applyData(from, to) {\n  /** @type {HastElement | Type} */\n  let result = to\n\n  // Handle `data.hName`, `data.hProperties, `data.hChildren`.\n  if (from && from.data) {\n    const hName = from.data.hName\n    const hChildren = from.data.hChildren\n    const hProperties = from.data.hProperties\n\n    if (typeof hName === 'string') {\n      // Transforming the node resulted in an element with a different name\n      // than wanted:\n      if (result.type === 'element') {\n        result.tagName = hName\n      }\n      // Transforming the node resulted in a non-element, which happens for\n      // raw, text, and root nodes (unless custom handlers are passed).\n      // The intent of `hName` is to create an element, but likely also to keep\n      // the content around (otherwise: pass `hChildren`).\n      else {\n        /** @type {Array<HastElementContent>} */\n        // @ts-expect-error: assume no doctypes in `root`.\n        const children = 'children' in result ? result.children : [result]\n        result = {type: 'element', tagName: hName, properties: {}, children}\n      }\n    }\n\n    if (result.type === 'element' && hProperties) {\n      Object.assign(result.properties, structuredClone(hProperties))\n    }\n\n    if (\n      'children' in result &&\n      result.children &&\n      hChildren !== null &&\n      hChildren !== undefined\n    ) {\n      result.children = hChildren\n    }\n  }\n\n  return result\n}\n\n/**\n * Transform an unknown node.\n *\n * @param {State} state\n *   Info passed around.\n * @param {MdastNodes} node\n *   Unknown mdast node.\n * @returns {HastElement | HastText}\n *   Resulting hast node.\n */\nfunction defaultUnknownHandler(state, node) {\n  const data = node.data || {}\n  /** @type {HastElement | HastText} */\n  const result =\n    'value' in node &&\n    !(own.call(data, 'hProperties') || own.call(data, 'hChildren'))\n      ? {type: 'text', value: node.value}\n      : {\n          type: 'element',\n          tagName: 'div',\n          properties: {},\n          children: state.all(node)\n        }\n\n  state.patch(node, result)\n  return state.applyData(node, result)\n}\n\n/**\n * Wrap `nodes` with line endings between each node.\n *\n * @template {HastRootContent} Type\n *   Node type.\n * @param {Array<Type>} nodes\n *   List of nodes to wrap.\n * @param {boolean | undefined} [loose=false]\n *   Whether to add line endings at start and end (default: `false`).\n * @returns {Array<HastText | Type>}\n *   Wrapped nodes.\n */\nexport function wrap(nodes, loose) {\n  /** @type {Array<HastText | Type>} */\n  const result = []\n  let index = -1\n\n  if (loose) {\n    result.push({type: 'text', value: '\\n'})\n  }\n\n  while (++index < nodes.length) {\n    if (index) result.push({type: 'text', value: '\\n'})\n    result.push(nodes[index])\n  }\n\n  if (loose && nodes.length > 0) {\n    result.push({type: 'text', value: '\\n'})\n  }\n\n  return result\n}\n\n/**\n * Trim spaces and tabs at the start of `value`.\n *\n * @param {string} value\n *   Value to trim.\n * @returns {string}\n *   Result.\n */\nfunction trimMarkdownSpaceStart(value) {\n  let index = 0\n  let code = value.charCodeAt(index)\n\n  while (code === 9 || code === 32) {\n    index++\n    code = value.charCodeAt(index)\n  }\n\n  return value.slice(index)\n}\n","/**\n * @typedef {import('hast').Nodes} HastNodes\n * @typedef {import('mdast').Nodes} MdastNodes\n * @typedef {import('./state.js').Options} Options\n */\n\nimport {ok as assert} from 'devlop'\nimport {footer} from './footer.js'\nimport {createState} from './state.js'\n\n/**\n * Transform mdast to hast.\n *\n * ##### Notes\n *\n * ###### HTML\n *\n * Raw HTML is available in mdast as `html` nodes and can be embedded in hast\n * as semistandard `raw` nodes.\n * Most utilities ignore `raw` nodes but two notable ones don’t:\n *\n * *   `hast-util-to-html` also has an option `allowDangerousHtml` which will\n *     output the raw HTML.\n *     This is typically discouraged as noted by the option name but is useful\n *     if you completely trust authors\n * *   `hast-util-raw` can handle the raw embedded HTML strings by parsing them\n *     into standard hast nodes (`element`, `text`, etc).\n *     This is a heavy task as it needs a full HTML parser, but it is the only\n *     way to support untrusted content\n *\n * ###### Footnotes\n *\n * Many options supported here relate to footnotes.\n * Footnotes are not specified by CommonMark, which we follow by default.\n * They are supported by GitHub, so footnotes can be enabled in markdown with\n * `mdast-util-gfm`.\n *\n * The options `footnoteBackLabel` and `footnoteLabel` define natural language\n * that explains footnotes, which is hidden for sighted users but shown to\n * assistive technology.\n * When your page is not in English, you must define translated values.\n *\n * Back references use ARIA attributes, but the section label itself uses a\n * heading that is hidden with an `sr-only` class.\n * To show it to sighted users, define different attributes in\n * `footnoteLabelProperties`.\n *\n * ###### Clobbering\n *\n * Footnotes introduces a problem, as it links footnote calls to footnote\n * definitions on the page through `id` attributes generated from user content,\n * which results in DOM clobbering.\n *\n * DOM clobbering is this:\n *\n * ```html\n * <p id=x></p>\n * <script>alert(x) // `x` now refers to the DOM `p#x` element</script>\n * ```\n *\n * Elements by their ID are made available by browsers on the `window` object,\n * which is a security risk.\n * Using a prefix solves this problem.\n *\n * More information on how to handle clobbering and the prefix is explained in\n * Example: headings (DOM clobbering) in `rehype-sanitize`.\n *\n * ###### Unknown nodes\n *\n * Unknown nodes are nodes with a type that isn’t in `handlers` or `passThrough`.\n * The default behavior for unknown nodes is:\n *\n * *   when the node has a `value` (and doesn’t have `data.hName`,\n *     `data.hProperties`, or `data.hChildren`, see later), create a hast `text`\n *     node\n * *   otherwise, create a `<div>` element (which could be changed with\n *     `data.hName`), with its children mapped from mdast to hast as well\n *\n * This behavior can be changed by passing an `unknownHandler`.\n *\n * @param {MdastNodes} tree\n *   mdast tree.\n * @param {Options | null | undefined} [options]\n *   Configuration (optional).\n * @returns {HastNodes}\n *   hast tree.\n */\nexport function toHast(tree, options) {\n  const state = createState(tree, options)\n  const node = state.one(tree, undefined)\n  const foot = footer(state)\n  /** @type {HastNodes} */\n  const result = Array.isArray(node)\n    ? {type: 'root', children: node}\n    : node || {type: 'root', children: []}\n\n  if (foot) {\n    // If there’s a footer, there were definitions, meaning block\n    // content.\n    // So `result` is a parent node.\n    assert('children' in result)\n    result.children.push({type: 'text', value: '\\n'}, foot)\n  }\n\n  return result\n}\n","// Include `data` fields in mdast and `raw` nodes in hast.\n/// <reference types=\"mdast-util-to-hast\" />\n\n/**\n * @typedef {import('hast').Root} HastRoot\n * @typedef {import('mdast').Root} MdastRoot\n * @typedef {import('mdast-util-to-hast').Options} ToHastOptions\n * @typedef {import('unified').Processor} Processor\n * @typedef {import('vfile').VFile} VFile\n */\n\n/**\n * @typedef {Omit<ToHastOptions, 'file'>} Options\n *\n * @callback TransformBridge\n *   Bridge-mode.\n *\n *   Runs the destination with the new hast tree.\n *   Discards result.\n * @param {MdastRoot} tree\n *   Tree.\n * @param {VFile} file\n *   File.\n * @returns {Promise<undefined>}\n *   Nothing.\n *\n * @callback TransformMutate\n *  Mutate-mode.\n *\n *  Further transformers run on the hast tree.\n * @param {MdastRoot} tree\n *   Tree.\n * @param {VFile} file\n *   File.\n * @returns {HastRoot}\n *   Tree (hast).\n */\n\nimport {toHast} from 'mdast-util-to-hast'\n\n/**\n * Turn markdown into HTML.\n *\n * ##### Notes\n *\n * ###### Signature\n *\n * *   if a processor is given, runs the (rehype) plugins used on it with a\n *     hast tree, then discards the result (*bridge mode*)\n * *   otherwise, returns a hast tree, the plugins used after `remarkRehype`\n *     are rehype plugins (*mutate mode*)\n *\n * > 👉 **Note**: It’s highly unlikely that you want to pass a `processor`.\n *\n * ###### HTML\n *\n * Raw HTML is available in mdast as `html` nodes and can be embedded in hast\n * as semistandard `raw` nodes.\n * Most plugins ignore `raw` nodes but two notable ones don’t:\n *\n * *   `rehype-stringify` also has an option `allowDangerousHtml` which will\n *     output the raw HTML.\n *     This is typically discouraged as noted by the option name but is useful if\n *     you completely trust authors\n * *   `rehype-raw` can handle the raw embedded HTML strings by parsing them\n *     into standard hast nodes (`element`, `text`, etc).\n *     This is a heavy task as it needs a full HTML parser, but it is the only way\n *     to support untrusted content\n *\n * ###### Footnotes\n *\n * Many options supported here relate to footnotes.\n * Footnotes are not specified by CommonMark, which we follow by default.\n * They are supported by GitHub, so footnotes can be enabled in markdown with\n * `remark-gfm`.\n *\n * The options `footnoteBackLabel` and `footnoteLabel` define natural language\n * that explains footnotes, which is hidden for sighted users but shown to\n * assistive technology.\n * When your page is not in English, you must define translated values.\n *\n * Back references use ARIA attributes, but the section label itself uses a\n * heading that is hidden with an `sr-only` class.\n * To show it to sighted users, define different attributes in\n * `footnoteLabelProperties`.\n *\n * ###### Clobbering\n *\n * Footnotes introduces a problem, as it links footnote calls to footnote\n * definitions on the page through `id` attributes generated from user content,\n * which results in DOM clobbering.\n *\n * DOM clobbering is this:\n *\n * ```html\n * <p id=x></p>\n * <script>alert(x) // `x` now refers to the DOM `p#x` element</script>\n * ```\n *\n * Elements by their ID are made available by browsers on the `window` object,\n * which is a security risk.\n * Using a prefix solves this problem.\n *\n * More information on how to handle clobbering and the prefix is explained in\n * *Example: headings (DOM clobbering)* in `rehype-sanitize`.\n *\n * ###### Unknown nodes\n *\n * Unknown nodes are nodes with a type that isn’t in `handlers` or `passThrough`.\n * The default behavior for unknown nodes is:\n *\n * *   when the node has a `value` (and doesn’t have `data.hName`,\n *     `data.hProperties`, or `data.hChildren`, see later), create a hast `text`\n *     node\n * *   otherwise, create a `<div>` element (which could be changed with\n *     `data.hName`), with its children mapped from mdast to hast as well\n *\n * This behavior can be changed by passing an `unknownHandler`.\n *\n * @overload\n * @param {Processor} processor\n * @param {Readonly<Options> | null | undefined} [options]\n * @returns {TransformBridge}\n *\n * @overload\n * @param {Readonly<Options> | null | undefined} [options]\n * @returns {TransformMutate}\n *\n * @param {Readonly<Options> | Processor | null | undefined} [destination]\n *   Processor or configuration (optional).\n * @param {Readonly<Options> | null | undefined} [options]\n *   When a processor was given, configuration (optional).\n * @returns {TransformBridge | TransformMutate}\n *   Transform.\n */\nexport default function remarkRehype(destination, options) {\n  if (destination && 'run' in destination) {\n    /**\n     * @type {TransformBridge}\n     */\n    return async function (tree, file) {\n      // Cast because root in -> root out.\n      const hastTree = /** @type {HastRoot} */ (\n        toHast(tree, {file, ...options})\n      )\n      await destination.run(hastTree, file)\n    }\n  }\n\n  /**\n   * @type {TransformMutate}\n   */\n  return function (tree, file) {\n    // Cast because root in -> root out.\n    return /** @type {HastRoot} */ (\n      toHast(tree, {file, ...(options || destination)})\n    )\n  }\n}\n","/**\n * Throw a given error.\n *\n * @param {Error|null|undefined} [error]\n *   Maybe error.\n * @returns {asserts error is null|undefined}\n */\nexport function bail(error) {\n  if (error) {\n    throw error\n  }\n}\n","export default function isPlainObject(value) {\n\tif (typeof value !== 'object' || value === null) {\n\t\treturn false;\n\t}\n\n\tconst prototype = Object.getPrototypeOf(value);\n\treturn (prototype === null || prototype === Object.prototype || Object.getPrototypeOf(prototype) === null) && !(Symbol.toStringTag in value) && !(Symbol.iterator in value);\n}\n","// A derivative work based on:\n// <https://github.com/browserify/path-browserify>.\n// Which is licensed:\n//\n// MIT License\n//\n// Copyright (c) 2013 James Halliday\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy of\n// this software and associated documentation files (the \"Software\"), to deal in\n// the Software without restriction, including without limitation the rights to\n// use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\n// the Software, and to permit persons to whom the Software is furnished to do so,\n// subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\n// FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n// COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\n// IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n// CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n// A derivative work based on:\n//\n// Parts of that are extracted from Node’s internal `path` module:\n// <https://github.com/nodejs/node/blob/master/lib/path.js>.\n// Which is licensed:\n//\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nexport const minpath = {basename, dirname, extname, join, sep: '/'}\n\n/* eslint-disable max-depth, complexity */\n\n/**\n * Get the basename from a path.\n *\n * @param {string} path\n *   File path.\n * @param {string | null | undefined} [extname]\n *   Extension to strip.\n * @returns {string}\n *   Stem or basename.\n */\nfunction basename(path, extname) {\n  if (extname !== undefined && typeof extname !== 'string') {\n    throw new TypeError('\"ext\" argument must be a string')\n  }\n\n  assertPath(path)\n  let start = 0\n  let end = -1\n  let index = path.length\n  /** @type {boolean | undefined} */\n  let seenNonSlash\n\n  if (\n    extname === undefined ||\n    extname.length === 0 ||\n    extname.length > path.length\n  ) {\n    while (index--) {\n      if (path.codePointAt(index) === 47 /* `/` */) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now.\n        if (seenNonSlash) {\n          start = index + 1\n          break\n        }\n      } else if (end < 0) {\n        // We saw the first non-path separator, mark this as the end of our\n        // path component.\n        seenNonSlash = true\n        end = index + 1\n      }\n    }\n\n    return end < 0 ? '' : path.slice(start, end)\n  }\n\n  if (extname === path) {\n    return ''\n  }\n\n  let firstNonSlashEnd = -1\n  let extnameIndex = extname.length - 1\n\n  while (index--) {\n    if (path.codePointAt(index) === 47 /* `/` */) {\n      // If we reached a path separator that was not part of a set of path\n      // separators at the end of the string, stop now.\n      if (seenNonSlash) {\n        start = index + 1\n        break\n      }\n    } else {\n      if (firstNonSlashEnd < 0) {\n        // We saw the first non-path separator, remember this index in case\n        // we need it if the extension ends up not matching.\n        seenNonSlash = true\n        firstNonSlashEnd = index + 1\n      }\n\n      if (extnameIndex > -1) {\n        // Try to match the explicit extension.\n        if (path.codePointAt(index) === extname.codePointAt(extnameIndex--)) {\n          if (extnameIndex < 0) {\n            // We matched the extension, so mark this as the end of our path\n            // component\n            end = index\n          }\n        } else {\n          // Extension does not match, so our result is the entire path\n          // component\n          extnameIndex = -1\n          end = firstNonSlashEnd\n        }\n      }\n    }\n  }\n\n  if (start === end) {\n    end = firstNonSlashEnd\n  } else if (end < 0) {\n    end = path.length\n  }\n\n  return path.slice(start, end)\n}\n\n/**\n * Get the dirname from a path.\n *\n * @param {string} path\n *   File path.\n * @returns {string}\n *   File path.\n */\nfunction dirname(path) {\n  assertPath(path)\n\n  if (path.length === 0) {\n    return '.'\n  }\n\n  let end = -1\n  let index = path.length\n  /** @type {boolean | undefined} */\n  let unmatchedSlash\n\n  // Prefix `--` is important to not run on `0`.\n  while (--index) {\n    if (path.codePointAt(index) === 47 /* `/` */) {\n      if (unmatchedSlash) {\n        end = index\n        break\n      }\n    } else if (!unmatchedSlash) {\n      // We saw the first non-path separator\n      unmatchedSlash = true\n    }\n  }\n\n  return end < 0\n    ? path.codePointAt(0) === 47 /* `/` */\n      ? '/'\n      : '.'\n    : end === 1 && path.codePointAt(0) === 47 /* `/` */\n      ? '//'\n      : path.slice(0, end)\n}\n\n/**\n * Get an extname from a path.\n *\n * @param {string} path\n *   File path.\n * @returns {string}\n *   Extname.\n */\nfunction extname(path) {\n  assertPath(path)\n\n  let index = path.length\n\n  let end = -1\n  let startPart = 0\n  let startDot = -1\n  // Track the state of characters (if any) we see before our first dot and\n  // after any path separator we find.\n  let preDotState = 0\n  /** @type {boolean | undefined} */\n  let unmatchedSlash\n\n  while (index--) {\n    const code = path.codePointAt(index)\n\n    if (code === 47 /* `/` */) {\n      // If we reached a path separator that was not part of a set of path\n      // separators at the end of the string, stop now.\n      if (unmatchedSlash) {\n        startPart = index + 1\n        break\n      }\n\n      continue\n    }\n\n    if (end < 0) {\n      // We saw the first non-path separator, mark this as the end of our\n      // extension.\n      unmatchedSlash = true\n      end = index + 1\n    }\n\n    if (code === 46 /* `.` */) {\n      // If this is our first dot, mark it as the start of our extension.\n      if (startDot < 0) {\n        startDot = index\n      } else if (preDotState !== 1) {\n        preDotState = 1\n      }\n    } else if (startDot > -1) {\n      // We saw a non-dot and non-path separator before our dot, so we should\n      // have a good chance at having a non-empty extension.\n      preDotState = -1\n    }\n  }\n\n  if (\n    startDot < 0 ||\n    end < 0 ||\n    // We saw a non-dot character immediately before the dot.\n    preDotState === 0 ||\n    // The (right-most) trimmed path component is exactly `..`.\n    (preDotState === 1 && startDot === end - 1 && startDot === startPart + 1)\n  ) {\n    return ''\n  }\n\n  return path.slice(startDot, end)\n}\n\n/**\n * Join segments from a path.\n *\n * @param {Array<string>} segments\n *   Path segments.\n * @returns {string}\n *   File path.\n */\nfunction join(...segments) {\n  let index = -1\n  /** @type {string | undefined} */\n  let joined\n\n  while (++index < segments.length) {\n    assertPath(segments[index])\n\n    if (segments[index]) {\n      joined =\n        joined === undefined ? segments[index] : joined + '/' + segments[index]\n    }\n  }\n\n  return joined === undefined ? '.' : normalize(joined)\n}\n\n/**\n * Normalize a basic file path.\n *\n * @param {string} path\n *   File path.\n * @returns {string}\n *   File path.\n */\n// Note: `normalize` is not exposed as `path.normalize`, so some code is\n// manually removed from it.\nfunction normalize(path) {\n  assertPath(path)\n\n  const absolute = path.codePointAt(0) === 47 /* `/` */\n\n  // Normalize the path according to POSIX rules.\n  let value = normalizeString(path, !absolute)\n\n  if (value.length === 0 && !absolute) {\n    value = '.'\n  }\n\n  if (value.length > 0 && path.codePointAt(path.length - 1) === 47 /* / */) {\n    value += '/'\n  }\n\n  return absolute ? '/' + value : value\n}\n\n/**\n * Resolve `.` and `..` elements in a path with directory names.\n *\n * @param {string} path\n *   File path.\n * @param {boolean} allowAboveRoot\n *   Whether `..` can move above root.\n * @returns {string}\n *   File path.\n */\nfunction normalizeString(path, allowAboveRoot) {\n  let result = ''\n  let lastSegmentLength = 0\n  let lastSlash = -1\n  let dots = 0\n  let index = -1\n  /** @type {number | undefined} */\n  let code\n  /** @type {number} */\n  let lastSlashIndex\n\n  while (++index <= path.length) {\n    if (index < path.length) {\n      code = path.codePointAt(index)\n    } else if (code === 47 /* `/` */) {\n      break\n    } else {\n      code = 47 /* `/` */\n    }\n\n    if (code === 47 /* `/` */) {\n      if (lastSlash === index - 1 || dots === 1) {\n        // Empty.\n      } else if (lastSlash !== index - 1 && dots === 2) {\n        if (\n          result.length < 2 ||\n          lastSegmentLength !== 2 ||\n          result.codePointAt(result.length - 1) !== 46 /* `.` */ ||\n          result.codePointAt(result.length - 2) !== 46 /* `.` */\n        ) {\n          if (result.length > 2) {\n            lastSlashIndex = result.lastIndexOf('/')\n\n            if (lastSlashIndex !== result.length - 1) {\n              if (lastSlashIndex < 0) {\n                result = ''\n                lastSegmentLength = 0\n              } else {\n                result = result.slice(0, lastSlashIndex)\n                lastSegmentLength = result.length - 1 - result.lastIndexOf('/')\n              }\n\n              lastSlash = index\n              dots = 0\n              continue\n            }\n          } else if (result.length > 0) {\n            result = ''\n            lastSegmentLength = 0\n            lastSlash = index\n            dots = 0\n            continue\n          }\n        }\n\n        if (allowAboveRoot) {\n          result = result.length > 0 ? result + '/..' : '..'\n          lastSegmentLength = 2\n        }\n      } else {\n        if (result.length > 0) {\n          result += '/' + path.slice(lastSlash + 1, index)\n        } else {\n          result = path.slice(lastSlash + 1, index)\n        }\n\n        lastSegmentLength = index - lastSlash - 1\n      }\n\n      lastSlash = index\n      dots = 0\n    } else if (code === 46 /* `.` */ && dots > -1) {\n      dots++\n    } else {\n      dots = -1\n    }\n  }\n\n  return result\n}\n\n/**\n * Make sure `path` is a string.\n *\n * @param {string} path\n *   File path.\n * @returns {asserts path is string}\n *   Nothing.\n */\nfunction assertPath(path) {\n  if (typeof path !== 'string') {\n    throw new TypeError(\n      'Path must be a string. Received ' + JSON.stringify(path)\n    )\n  }\n}\n\n/* eslint-enable max-depth, complexity */\n","// Somewhat based on:\n// <https://github.com/defunctzombie/node-process/blob/master/browser.js>.\n// But I don’t think one tiny line of code can be copyrighted. 😅\nexport const minproc = {cwd}\n\nfunction cwd() {\n  return '/'\n}\n","/**\n * Checks if a value has the shape of a WHATWG URL object.\n *\n * Using a symbol or instanceof would not be able to recognize URL objects\n * coming from other implementations (e.g. in Electron), so instead we are\n * checking some well known properties for a lack of a better test.\n *\n * We use `href` and `protocol` as they are the only properties that are\n * easy to retrieve and calculate due to the lazy nature of the getters.\n *\n * We check for auth attribute to distinguish legacy url instance with\n * WHATWG URL instance.\n *\n * @param {unknown} fileUrlOrPath\n *   File path or URL.\n * @returns {fileUrlOrPath is URL}\n *   Whether it’s a URL.\n */\n// From: <https://github.com/nodejs/node/blob/6a3403c/lib/internal/url.js#L720>\nexport function isUrl(fileUrlOrPath) {\n  return Boolean(\n    fileUrlOrPath !== null &&\n      typeof fileUrlOrPath === 'object' &&\n      'href' in fileUrlOrPath &&\n      fileUrlOrPath.href &&\n      'protocol' in fileUrlOrPath &&\n      fileUrlOrPath.protocol &&\n      // @ts-expect-error: indexing is fine.\n      fileUrlOrPath.auth === undefined\n  )\n}\n","/**\n * @import {Node, Point, Position} from 'unist'\n * @import {Options as MessageOptions} from 'vfile-message'\n * @import {Compatible, Data, Map, Options, Value} from 'vfile'\n */\n\n/**\n * @typedef {object & {type: string, position?: Position | undefined}} NodeLike\n */\n\nimport {VFileMessage} from 'vfile-message'\nimport {minpath} from '#minpath'\nimport {minproc} from '#minproc'\nimport {urlToPath, isUrl} from '#minurl'\n\n/**\n * Order of setting (least specific to most), we need this because otherwise\n * `{stem: 'a', path: '~/b.js'}` would throw, as a path is needed before a\n * stem can be set.\n */\nconst order = /** @type {const} */ ([\n  'history',\n  'path',\n  'basename',\n  'stem',\n  'extname',\n  'dirname'\n])\n\nexport class VFile {\n  /**\n   * Create a new virtual file.\n   *\n   * `options` is treated as:\n   *\n   * *   `string` or `Uint8Array` — `{value: options}`\n   * *   `URL` — `{path: options}`\n   * *   `VFile` — shallow copies its data over to the new file\n   * *   `object` — all fields are shallow copied over to the new file\n   *\n   * Path related fields are set in the following order (least specific to\n   * most specific): `history`, `path`, `basename`, `stem`, `extname`,\n   * `dirname`.\n   *\n   * You cannot set `dirname` or `extname` without setting either `history`,\n   * `path`, `basename`, or `stem` too.\n   *\n   * @param {Compatible | null | undefined} [value]\n   *   File value.\n   * @returns\n   *   New instance.\n   */\n  constructor(value) {\n    /** @type {Options | VFile} */\n    let options\n\n    if (!value) {\n      options = {}\n    } else if (isUrl(value)) {\n      options = {path: value}\n    } else if (typeof value === 'string' || isUint8Array(value)) {\n      options = {value}\n    } else {\n      options = value\n    }\n\n    /* eslint-disable no-unused-expressions */\n\n    /**\n     * Base of `path` (default: `process.cwd()` or `'/'` in browsers).\n     *\n     * @type {string}\n     */\n    // Prevent calling `cwd` (which could be expensive) if it’s not needed;\n    // the empty string will be overridden in the next block.\n    this.cwd = 'cwd' in options ? '' : minproc.cwd()\n\n    /**\n     * Place to store custom info (default: `{}`).\n     *\n     * It’s OK to store custom data directly on the file but moving it to\n     * `data` is recommended.\n     *\n     * @type {Data}\n     */\n    this.data = {}\n\n    /**\n     * List of file paths the file moved between.\n     *\n     * The first is the original path and the last is the current path.\n     *\n     * @type {Array<string>}\n     */\n    this.history = []\n\n    /**\n     * List of messages associated with the file.\n     *\n     * @type {Array<VFileMessage>}\n     */\n    this.messages = []\n\n    /**\n     * Raw value.\n     *\n     * @type {Value}\n     */\n    this.value\n\n    // The below are non-standard, they are “well-known”.\n    // As in, used in several tools.\n    /**\n     * Source map.\n     *\n     * This type is equivalent to the `RawSourceMap` type from the `source-map`\n     * module.\n     *\n     * @type {Map | null | undefined}\n     */\n    this.map\n\n    /**\n     * Custom, non-string, compiled, representation.\n     *\n     * This is used by unified to store non-string results.\n     * One example is when turning markdown into React nodes.\n     *\n     * @type {unknown}\n     */\n    this.result\n\n    /**\n     * Whether a file was saved to disk.\n     *\n     * This is used by vfile reporters.\n     *\n     * @type {boolean}\n     */\n    this.stored\n    /* eslint-enable no-unused-expressions */\n\n    // Set path related properties in the correct order.\n    let index = -1\n\n    while (++index < order.length) {\n      const field = order[index]\n\n      // Note: we specifically use `in` instead of `hasOwnProperty` to accept\n      // `vfile`s too.\n      if (\n        field in options &&\n        options[field] !== undefined &&\n        options[field] !== null\n      ) {\n        // @ts-expect-error: TS doesn’t understand basic reality.\n        this[field] = field === 'history' ? [...options[field]] : options[field]\n      }\n    }\n\n    /** @type {string} */\n    let field\n\n    // Set non-path related properties.\n    for (field in options) {\n      // @ts-expect-error: fine to set other things.\n      if (!order.includes(field)) {\n        // @ts-expect-error: fine to set other things.\n        this[field] = options[field]\n      }\n    }\n  }\n\n  /**\n   * Get the basename (including extname) (example: `'index.min.js'`).\n   *\n   * @returns {string | undefined}\n   *   Basename.\n   */\n  get basename() {\n    return typeof this.path === 'string'\n      ? minpath.basename(this.path)\n      : undefined\n  }\n\n  /**\n   * Set basename (including extname) (`'index.min.js'`).\n   *\n   * Cannot contain path separators (`'/'` on unix, macOS, and browsers, `'\\'`\n   * on windows).\n   * Cannot be nullified (use `file.path = file.dirname` instead).\n   *\n   * @param {string} basename\n   *   Basename.\n   * @returns {undefined}\n   *   Nothing.\n   */\n  set basename(basename) {\n    assertNonEmpty(basename, 'basename')\n    assertPart(basename, 'basename')\n    this.path = minpath.join(this.dirname || '', basename)\n  }\n\n  /**\n   * Get the parent path (example: `'~'`).\n   *\n   * @returns {string | undefined}\n   *   Dirname.\n   */\n  get dirname() {\n    return typeof this.path === 'string'\n      ? minpath.dirname(this.path)\n      : undefined\n  }\n\n  /**\n   * Set the parent path (example: `'~'`).\n   *\n   * Cannot be set if there’s no `path` yet.\n   *\n   * @param {string | undefined} dirname\n   *   Dirname.\n   * @returns {undefined}\n   *   Nothing.\n   */\n  set dirname(dirname) {\n    assertPath(this.basename, 'dirname')\n    this.path = minpath.join(dirname || '', this.basename)\n  }\n\n  /**\n   * Get the extname (including dot) (example: `'.js'`).\n   *\n   * @returns {string | undefined}\n   *   Extname.\n   */\n  get extname() {\n    return typeof this.path === 'string'\n      ? minpath.extname(this.path)\n      : undefined\n  }\n\n  /**\n   * Set the extname (including dot) (example: `'.js'`).\n   *\n   * Cannot contain path separators (`'/'` on unix, macOS, and browsers, `'\\'`\n   * on windows).\n   * Cannot be set if there’s no `path` yet.\n   *\n   * @param {string | undefined} extname\n   *   Extname.\n   * @returns {undefined}\n   *   Nothing.\n   */\n  set extname(extname) {\n    assertPart(extname, 'extname')\n    assertPath(this.dirname, 'extname')\n\n    if (extname) {\n      if (extname.codePointAt(0) !== 46 /* `.` */) {\n        throw new Error('`extname` must start with `.`')\n      }\n\n      if (extname.includes('.', 1)) {\n        throw new Error('`extname` cannot contain multiple dots')\n      }\n    }\n\n    this.path = minpath.join(this.dirname, this.stem + (extname || ''))\n  }\n\n  /**\n   * Get the full path (example: `'~/index.min.js'`).\n   *\n   * @returns {string}\n   *   Path.\n   */\n  get path() {\n    return this.history[this.history.length - 1]\n  }\n\n  /**\n   * Set the full path (example: `'~/index.min.js'`).\n   *\n   * Cannot be nullified.\n   * You can set a file URL (a `URL` object with a `file:` protocol) which will\n   * be turned into a path with `url.fileURLToPath`.\n   *\n   * @param {URL | string} path\n   *   Path.\n   * @returns {undefined}\n   *   Nothing.\n   */\n  set path(path) {\n    if (isUrl(path)) {\n      path = urlToPath(path)\n    }\n\n    assertNonEmpty(path, 'path')\n\n    if (this.path !== path) {\n      this.history.push(path)\n    }\n  }\n\n  /**\n   * Get the stem (basename w/o extname) (example: `'index.min'`).\n   *\n   * @returns {string | undefined}\n   *   Stem.\n   */\n  get stem() {\n    return typeof this.path === 'string'\n      ? minpath.basename(this.path, this.extname)\n      : undefined\n  }\n\n  /**\n   * Set the stem (basename w/o extname) (example: `'index.min'`).\n   *\n   * Cannot contain path separators (`'/'` on unix, macOS, and browsers, `'\\'`\n   * on windows).\n   * Cannot be nullified (use `file.path = file.dirname` instead).\n   *\n   * @param {string} stem\n   *   Stem.\n   * @returns {undefined}\n   *   Nothing.\n   */\n  set stem(stem) {\n    assertNonEmpty(stem, 'stem')\n    assertPart(stem, 'stem')\n    this.path = minpath.join(this.dirname || '', stem + (this.extname || ''))\n  }\n\n  // Normal prototypal methods.\n  /**\n   * Create a fatal message for `reason` associated with the file.\n   *\n   * The `fatal` field of the message is set to `true` (error; file not usable)\n   * and the `file` field is set to the current file path.\n   * The message is added to the `messages` field on `file`.\n   *\n   * > 🪦 **Note**: also has obsolete signatures.\n   *\n   * @overload\n   * @param {string} reason\n   * @param {MessageOptions | null | undefined} [options]\n   * @returns {never}\n   *\n   * @overload\n   * @param {string} reason\n   * @param {Node | NodeLike | null | undefined} parent\n   * @param {string | null | undefined} [origin]\n   * @returns {never}\n   *\n   * @overload\n   * @param {string} reason\n   * @param {Point | Position | null | undefined} place\n   * @param {string | null | undefined} [origin]\n   * @returns {never}\n   *\n   * @overload\n   * @param {string} reason\n   * @param {string | null | undefined} [origin]\n   * @returns {never}\n   *\n   * @overload\n   * @param {Error | VFileMessage} cause\n   * @param {Node | NodeLike | null | undefined} parent\n   * @param {string | null | undefined} [origin]\n   * @returns {never}\n   *\n   * @overload\n   * @param {Error | VFileMessage} cause\n   * @param {Point | Position | null | undefined} place\n   * @param {string | null | undefined} [origin]\n   * @returns {never}\n   *\n   * @overload\n   * @param {Error | VFileMessage} cause\n   * @param {string | null | undefined} [origin]\n   * @returns {never}\n   *\n   * @param {Error | VFileMessage | string} causeOrReason\n   *   Reason for message, should use markdown.\n   * @param {Node | NodeLike | MessageOptions | Point | Position | string | null | undefined} [optionsOrParentOrPlace]\n   *   Configuration (optional).\n   * @param {string | null | undefined} [origin]\n   *   Place in code where the message originates (example:\n   *   `'my-package:my-rule'` or `'my-rule'`).\n   * @returns {never}\n   *   Never.\n   * @throws {VFileMessage}\n   *   Message.\n   */\n  fail(causeOrReason, optionsOrParentOrPlace, origin) {\n    // @ts-expect-error: the overloads are fine.\n    const message = this.message(causeOrReason, optionsOrParentOrPlace, origin)\n\n    message.fatal = true\n\n    throw message\n  }\n\n  /**\n   * Create an info message for `reason` associated with the file.\n   *\n   * The `fatal` field of the message is set to `undefined` (info; change\n   * likely not needed) and the `file` field is set to the current file path.\n   * The message is added to the `messages` field on `file`.\n   *\n   * > 🪦 **Note**: also has obsolete signatures.\n   *\n   * @overload\n   * @param {string} reason\n   * @param {MessageOptions | null | undefined} [options]\n   * @returns {VFileMessage}\n   *\n   * @overload\n   * @param {string} reason\n   * @param {Node | NodeLike | null | undefined} parent\n   * @param {string | null | undefined} [origin]\n   * @returns {VFileMessage}\n   *\n   * @overload\n   * @param {string} reason\n   * @param {Point | Position | null | undefined} place\n   * @param {string | null | undefined} [origin]\n   * @returns {VFileMessage}\n   *\n   * @overload\n   * @param {string} reason\n   * @param {string | null | undefined} [origin]\n   * @returns {VFileMessage}\n   *\n   * @overload\n   * @param {Error | VFileMessage} cause\n   * @param {Node | NodeLike | null | undefined} parent\n   * @param {string | null | undefined} [origin]\n   * @returns {VFileMessage}\n   *\n   * @overload\n   * @param {Error | VFileMessage} cause\n   * @param {Point | Position | null | undefined} place\n   * @param {string | null | undefined} [origin]\n   * @returns {VFileMessage}\n   *\n   * @overload\n   * @param {Error | VFileMessage} cause\n   * @param {string | null | undefined} [origin]\n   * @returns {VFileMessage}\n   *\n   * @param {Error | VFileMessage | string} causeOrReason\n   *   Reason for message, should use markdown.\n   * @param {Node | NodeLike | MessageOptions | Point | Position | string | null | undefined} [optionsOrParentOrPlace]\n   *   Configuration (optional).\n   * @param {string | null | undefined} [origin]\n   *   Place in code where the message originates (example:\n   *   `'my-package:my-rule'` or `'my-rule'`).\n   * @returns {VFileMessage}\n   *   Message.\n   */\n  info(causeOrReason, optionsOrParentOrPlace, origin) {\n    // @ts-expect-error: the overloads are fine.\n    const message = this.message(causeOrReason, optionsOrParentOrPlace, origin)\n\n    message.fatal = undefined\n\n    return message\n  }\n\n  /**\n   * Create a message for `reason` associated with the file.\n   *\n   * The `fatal` field of the message is set to `false` (warning; change may be\n   * needed) and the `file` field is set to the current file path.\n   * The message is added to the `messages` field on `file`.\n   *\n   * > 🪦 **Note**: also has obsolete signatures.\n   *\n   * @overload\n   * @param {string} reason\n   * @param {MessageOptions | null | undefined} [options]\n   * @returns {VFileMessage}\n   *\n   * @overload\n   * @param {string} reason\n   * @param {Node | NodeLike | null | undefined} parent\n   * @param {string | null | undefined} [origin]\n   * @returns {VFileMessage}\n   *\n   * @overload\n   * @param {string} reason\n   * @param {Point | Position | null | undefined} place\n   * @param {string | null | undefined} [origin]\n   * @returns {VFileMessage}\n   *\n   * @overload\n   * @param {string} reason\n   * @param {string | null | undefined} [origin]\n   * @returns {VFileMessage}\n   *\n   * @overload\n   * @param {Error | VFileMessage} cause\n   * @param {Node | NodeLike | null | undefined} parent\n   * @param {string | null | undefined} [origin]\n   * @returns {VFileMessage}\n   *\n   * @overload\n   * @param {Error | VFileMessage} cause\n   * @param {Point | Position | null | undefined} place\n   * @param {string | null | undefined} [origin]\n   * @returns {VFileMessage}\n   *\n   * @overload\n   * @param {Error | VFileMessage} cause\n   * @param {string | null | undefined} [origin]\n   * @returns {VFileMessage}\n   *\n   * @param {Error | VFileMessage | string} causeOrReason\n   *   Reason for message, should use markdown.\n   * @param {Node | NodeLike | MessageOptions | Point | Position | string | null | undefined} [optionsOrParentOrPlace]\n   *   Configuration (optional).\n   * @param {string | null | undefined} [origin]\n   *   Place in code where the message originates (example:\n   *   `'my-package:my-rule'` or `'my-rule'`).\n   * @returns {VFileMessage}\n   *   Message.\n   */\n  message(causeOrReason, optionsOrParentOrPlace, origin) {\n    const message = new VFileMessage(\n      // @ts-expect-error: the overloads are fine.\n      causeOrReason,\n      optionsOrParentOrPlace,\n      origin\n    )\n\n    if (this.path) {\n      message.name = this.path + ':' + message.name\n      message.file = this.path\n    }\n\n    message.fatal = false\n\n    this.messages.push(message)\n\n    return message\n  }\n\n  /**\n   * Serialize the file.\n   *\n   * > **Note**: which encodings are supported depends on the engine.\n   * > For info on Node.js, see:\n   * > <https://nodejs.org/api/util.html#whatwg-supported-encodings>.\n   *\n   * @param {string | null | undefined} [encoding='utf8']\n   *   Character encoding to understand `value` as when it’s a `Uint8Array`\n   *   (default: `'utf-8'`).\n   * @returns {string}\n   *   Serialized file.\n   */\n  toString(encoding) {\n    if (this.value === undefined) {\n      return ''\n    }\n\n    if (typeof this.value === 'string') {\n      return this.value\n    }\n\n    const decoder = new TextDecoder(encoding || undefined)\n    return decoder.decode(this.value)\n  }\n}\n\n/**\n * Assert that `part` is not a path (as in, does not contain `path.sep`).\n *\n * @param {string | null | undefined} part\n *   File path part.\n * @param {string} name\n *   Part name.\n * @returns {undefined}\n *   Nothing.\n */\nfunction assertPart(part, name) {\n  if (part && part.includes(minpath.sep)) {\n    throw new Error(\n      '`' + name + '` cannot be a path: did not expect `' + minpath.sep + '`'\n    )\n  }\n}\n\n/**\n * Assert that `part` is not empty.\n *\n * @param {string | undefined} part\n *   Thing.\n * @param {string} name\n *   Part name.\n * @returns {asserts part is string}\n *   Nothing.\n */\nfunction assertNonEmpty(part, name) {\n  if (!part) {\n    throw new Error('`' + name + '` cannot be empty')\n  }\n}\n\n/**\n * Assert `path` exists.\n *\n * @param {string | undefined} path\n *   Path.\n * @param {string} name\n *   Dependency name.\n * @returns {asserts path is string}\n *   Nothing.\n */\nfunction assertPath(path, name) {\n  if (!path) {\n    throw new Error('Setting `' + name + '` requires `path` to be set too')\n  }\n}\n\n/**\n * Assert `value` is an `Uint8Array`.\n *\n * @param {unknown} value\n *   thing.\n * @returns {value is Uint8Array}\n *   Whether `value` is an `Uint8Array`.\n */\nfunction isUint8Array(value) {\n  return Boolean(\n    value &&\n      typeof value === 'object' &&\n      'byteLength' in value &&\n      'byteOffset' in value\n  )\n}\n","import {isUrl} from './minurl.shared.js'\n\nexport {isUrl} from './minurl.shared.js'\n\n// See: <https://github.com/nodejs/node/blob/6a3403c/lib/internal/url.js>\n\n/**\n * @param {URL | string} path\n *   File URL.\n * @returns {string}\n *   File URL.\n */\nexport function urlToPath(path) {\n  if (typeof path === 'string') {\n    path = new URL(path)\n  } else if (!isUrl(path)) {\n    /** @type {NodeJS.ErrnoException} */\n    const error = new TypeError(\n      'The \"path\" argument must be of type string or an instance of URL. Received `' +\n        path +\n        '`'\n    )\n    error.code = 'ERR_INVALID_ARG_TYPE'\n    throw error\n  }\n\n  if (path.protocol !== 'file:') {\n    /** @type {NodeJS.ErrnoException} */\n    const error = new TypeError('The URL must be of scheme file')\n    error.code = 'ERR_INVALID_URL_SCHEME'\n    throw error\n  }\n\n  return getPathFromURLPosix(path)\n}\n\n/**\n * Get a path from a POSIX URL.\n *\n * @param {URL} url\n *   URL.\n * @returns {string}\n *   File path.\n */\nfunction getPathFromURLPosix(url) {\n  if (url.hostname !== '') {\n    /** @type {NodeJS.ErrnoException} */\n    const error = new TypeError(\n      'File URL host must be \"localhost\" or empty on darwin'\n    )\n    error.code = 'ERR_INVALID_FILE_URL_HOST'\n    throw error\n  }\n\n  const pathname = url.pathname\n  let index = -1\n\n  while (++index < pathname.length) {\n    if (\n      pathname.codePointAt(index) === 37 /* `%` */ &&\n      pathname.codePointAt(index + 1) === 50 /* `2` */\n    ) {\n      const third = pathname.codePointAt(index + 2)\n      if (third === 70 /* `F` */ || third === 102 /* `f` */) {\n        /** @type {NodeJS.ErrnoException} */\n        const error = new TypeError(\n          'File URL path must not include encoded / characters'\n        )\n        error.code = 'ERR_INVALID_FILE_URL_PATH'\n        throw error\n      }\n    }\n  }\n\n  return decodeURIComponent(pathname)\n}\n","export const CallableInstance =\n  /**\n   * @type {new <Parameters extends Array<unknown>, Result>(property: string | symbol) => (...parameters: Parameters) => Result}\n   */\n  (\n    /** @type {unknown} */\n    (\n      /**\n       * @this {Function}\n       * @param {string | symbol} property\n       * @returns {(...parameters: Array<unknown>) => unknown}\n       */\n      function (property) {\n        const self = this\n        const constr = self.constructor\n        const proto = /** @type {Record<string | symbol, Function>} */ (\n          // Prototypes do exist.\n          // type-coverage:ignore-next-line\n          constr.prototype\n        )\n        const value = proto[property]\n        /** @type {(...parameters: Array<unknown>) => unknown} */\n        const apply = function () {\n          return value.apply(apply, arguments)\n        }\n\n        Object.setPrototypeOf(apply, proto)\n\n        // Not needed for us in `unified`: we only call this on the `copy`\n        // function,\n        // and we don't need to add its fields (`length`, `name`)\n        // over.\n        // See also: GH-246.\n        // const names = Object.getOwnPropertyNames(value)\n        //\n        // for (const p of names) {\n        //   const descriptor = Object.getOwnPropertyDescriptor(value, p)\n        //   if (descriptor) Object.defineProperty(apply, p, descriptor)\n        // }\n\n        return apply\n      }\n    )\n  )\n","/**\n * @typedef {import('trough').Pipeline} Pipeline\n *\n * @typedef {import('unist').Node} Node\n *\n * @typedef {import('vfile').Compatible} Compatible\n * @typedef {import('vfile').Value} Value\n *\n * @typedef {import('../index.js').CompileResultMap} CompileResultMap\n * @typedef {import('../index.js').Data} Data\n * @typedef {import('../index.js').Settings} Settings\n */\n\n/**\n * @typedef {CompileResultMap[keyof CompileResultMap]} CompileResults\n *   Acceptable results from compilers.\n *\n *   To register custom results, add them to\n *   {@linkcode CompileResultMap}.\n */\n\n/**\n * @template {Node} [Tree=Node]\n *   The node that the compiler receives (default: `Node`).\n * @template {CompileResults} [Result=CompileResults]\n *   The thing that the compiler yields (default: `CompileResults`).\n * @callback Compiler\n *   A **compiler** handles the compiling of a syntax tree to something else\n *   (in most cases, text) (TypeScript type).\n *\n *   It is used in the stringify phase and called with a {@linkcode Node}\n *   and {@linkcode VFile} representation of the document to compile.\n *   It should return the textual representation of the given tree (typically\n *   `string`).\n *\n *   > **Note**: unified typically compiles by serializing: most compilers\n *   > return `string` (or `Uint8Array`).\n *   > Some compilers, such as the one configured with\n *   > [`rehype-react`][rehype-react], return other values (in this case, a\n *   > React tree).\n *   > If you’re using a compiler that doesn’t serialize, expect different\n *   > result values.\n *   >\n *   > To register custom results in TypeScript, add them to\n *   > {@linkcode CompileResultMap}.\n *\n *   [rehype-react]: https://github.com/rehypejs/rehype-react\n * @param {Tree} tree\n *   Tree to compile.\n * @param {VFile} file\n *   File associated with `tree`.\n * @returns {Result}\n *   New content: compiled text (`string` or `Uint8Array`, for `file.value`) or\n *   something else (for `file.result`).\n */\n\n/**\n * @template {Node} [Tree=Node]\n *   The node that the parser yields (default: `Node`)\n * @callback Parser\n *   A **parser** handles the parsing of text to a syntax tree.\n *\n *   It is used in the parse phase and is called with a `string` and\n *   {@linkcode VFile} of the document to parse.\n *   It must return the syntax tree representation of the given file\n *   ({@linkcode Node}).\n * @param {string} document\n *   Document to parse.\n * @param {VFile} file\n *   File associated with `document`.\n * @returns {Tree}\n *   Node representing the given file.\n */\n\n/**\n * @typedef {(\n *   Plugin<Array<any>, any, any> |\n *   PluginTuple<Array<any>, any, any> |\n *   Preset\n * )} Pluggable\n *   Union of the different ways to add plugins and settings.\n */\n\n/**\n * @typedef {Array<Pluggable>} PluggableList\n *   List of plugins and presets.\n */\n\n// Note: we can’t use `callback` yet as it messes up `this`:\n//  <https://github.com/microsoft/TypeScript/issues/55197>.\n/**\n * @template {Array<unknown>} [PluginParameters=[]]\n *   Arguments passed to the plugin (default: `[]`, the empty tuple).\n * @template {Node | string | undefined} [Input=Node]\n *   Value that is expected as input (default: `Node`).\n *\n *   *   If the plugin returns a {@linkcode Transformer}, this\n *       should be the node it expects.\n *   *   If the plugin sets a {@linkcode Parser}, this should be\n *       `string`.\n *   *   If the plugin sets a {@linkcode Compiler}, this should be the\n *       node it expects.\n * @template [Output=Input]\n *   Value that is yielded as output (default: `Input`).\n *\n *   *   If the plugin returns a {@linkcode Transformer}, this\n *       should be the node that that yields.\n *   *   If the plugin sets a {@linkcode Parser}, this should be the\n *       node that it yields.\n *   *   If the plugin sets a {@linkcode Compiler}, this should be\n *       result it yields.\n * @typedef {(\n *   (this: Processor, ...parameters: PluginParameters) =>\n *     Input extends string ? // Parser.\n *        Output extends Node | undefined ? undefined | void : never :\n *     Output extends CompileResults ? // Compiler.\n *        Input extends Node | undefined ? undefined | void : never :\n *     Transformer<\n *       Input extends Node ? Input : Node,\n *       Output extends Node ? Output : Node\n *     > | undefined | void\n * )} Plugin\n *   Single plugin.\n *\n *   Plugins configure the processors they are applied on in the following\n *   ways:\n *\n *   *   they change the processor, such as the parser, the compiler, or by\n *       configuring data\n *   *   they specify how to handle trees and files\n *\n *   In practice, they are functions that can receive options and configure the\n *   processor (`this`).\n *\n *   > **Note**: plugins are called when the processor is *frozen*, not when\n *   > they are applied.\n */\n\n/**\n * Tuple of a plugin and its configuration.\n *\n * The first item is a plugin, the rest are its parameters.\n *\n * @template {Array<unknown>} [TupleParameters=[]]\n *   Arguments passed to the plugin (default: `[]`, the empty tuple).\n * @template {Node | string | undefined} [Input=undefined]\n *   Value that is expected as input (optional).\n *\n *   *   If the plugin returns a {@linkcode Transformer}, this\n *       should be the node it expects.\n *   *   If the plugin sets a {@linkcode Parser}, this should be\n *       `string`.\n *   *   If the plugin sets a {@linkcode Compiler}, this should be the\n *       node it expects.\n * @template [Output=undefined] (optional).\n *   Value that is yielded as output.\n *\n *   *   If the plugin returns a {@linkcode Transformer}, this\n *       should be the node that that yields.\n *   *   If the plugin sets a {@linkcode Parser}, this should be the\n *       node that it yields.\n *   *   If the plugin sets a {@linkcode Compiler}, this should be\n *       result it yields.\n * @typedef {(\n *   [\n *     plugin: Plugin<TupleParameters, Input, Output>,\n *     ...parameters: TupleParameters\n *   ]\n * )} PluginTuple\n */\n\n/**\n * @typedef Preset\n *   Sharable configuration.\n *\n *   They can contain plugins and settings.\n * @property {PluggableList | undefined} [plugins]\n *   List of plugins and presets (optional).\n * @property {Settings | undefined} [settings]\n *   Shared settings for parsers and compilers (optional).\n */\n\n/**\n * @template {VFile} [File=VFile]\n *   The file that the callback receives (default: `VFile`).\n * @callback ProcessCallback\n *   Callback called when the process is done.\n *\n *   Called with either an error or a result.\n * @param {Error | undefined} [error]\n *   Fatal error (optional).\n * @param {File | undefined} [file]\n *   Processed file (optional).\n * @returns {undefined}\n *   Nothing.\n */\n\n/**\n * @template {Node} [Tree=Node]\n *   The tree that the callback receives (default: `Node`).\n * @callback RunCallback\n *   Callback called when transformers are done.\n *\n *   Called with either an error or results.\n * @param {Error | undefined} [error]\n *   Fatal error (optional).\n * @param {Tree | undefined} [tree]\n *   Transformed tree (optional).\n * @param {VFile | undefined} [file]\n *   File (optional).\n * @returns {undefined}\n *   Nothing.\n */\n\n/**\n * @template {Node} [Output=Node]\n *   Node type that the transformer yields (default: `Node`).\n * @callback TransformCallback\n *   Callback passed to transforms.\n *\n *   If the signature of a `transformer` accepts a third argument, the\n *   transformer may perform asynchronous operations, and must call it.\n * @param {Error | undefined} [error]\n *   Fatal error to stop the process (optional).\n * @param {Output | undefined} [tree]\n *   New, changed, tree (optional).\n * @param {VFile | undefined} [file]\n *   New, changed, file (optional).\n * @returns {undefined}\n *   Nothing.\n */\n\n/**\n * @template {Node} [Input=Node]\n *   Node type that the transformer expects (default: `Node`).\n * @template {Node} [Output=Input]\n *   Node type that the transformer yields (default: `Input`).\n * @callback Transformer\n *   Transformers handle syntax trees and files.\n *\n *   They are functions that are called each time a syntax tree and file are\n *   passed through the run phase.\n *   When an error occurs in them (either because it’s thrown, returned,\n *   rejected, or passed to `next`), the process stops.\n *\n *   The run phase is handled by [`trough`][trough], see its documentation for\n *   the exact semantics of these functions.\n *\n *   > **Note**: you should likely ignore `next`: don’t accept it.\n *   > it supports callback-style async work.\n *   > But promises are likely easier to reason about.\n *\n *   [trough]: https://github.com/wooorm/trough#function-fninput-next\n * @param {Input} tree\n *   Tree to handle.\n * @param {VFile} file\n *   File to handle.\n * @param {TransformCallback<Output>} next\n *   Callback.\n * @returns {(\n *   Promise<Output | undefined | void> |\n *   Promise<never> | // For some reason this is needed separately.\n *   Output |\n *   Error |\n *   undefined |\n *   void\n * )}\n *   If you accept `next`, nothing.\n *   Otherwise:\n *\n *   *   `Error` — fatal error to stop the process\n *   *   `Promise<undefined>` or `undefined` — the next transformer keeps using\n *       same tree\n *   *   `Promise<Node>` or `Node` — new, changed, tree\n */\n\n/**\n * @template {Node | undefined} ParseTree\n *   Output of `parse`.\n * @template {Node | undefined} HeadTree\n *   Input for `run`.\n * @template {Node | undefined} TailTree\n *   Output for `run`.\n * @template {Node | undefined} CompileTree\n *   Input of `stringify`.\n * @template {CompileResults | undefined} CompileResult\n *   Output of `stringify`.\n * @template {Node | string | undefined} Input\n *   Input of plugin.\n * @template Output\n *   Output of plugin (optional).\n * @typedef {(\n *   Input extends string\n *     ? Output extends Node | undefined\n *       ? // Parser.\n *         Processor<\n *           Output extends undefined ? ParseTree : Output,\n *           HeadTree,\n *           TailTree,\n *           CompileTree,\n *           CompileResult\n *         >\n *       : // Unknown.\n *         Processor<ParseTree, HeadTree, TailTree, CompileTree, CompileResult>\n *     : Output extends CompileResults\n *     ? Input extends Node | undefined\n *       ? // Compiler.\n *         Processor<\n *           ParseTree,\n *           HeadTree,\n *           TailTree,\n *           Input extends undefined ? CompileTree : Input,\n *           Output extends undefined ? CompileResult : Output\n *         >\n *       : // Unknown.\n *         Processor<ParseTree, HeadTree, TailTree, CompileTree, CompileResult>\n *     : Input extends Node | undefined\n *     ? Output extends Node | undefined\n *       ? // Transform.\n *         Processor<\n *           ParseTree,\n *           HeadTree extends undefined ? Input : HeadTree,\n *           Output extends undefined ? TailTree : Output,\n *           CompileTree,\n *           CompileResult\n *         >\n *       : // Unknown.\n *         Processor<ParseTree, HeadTree, TailTree, CompileTree, CompileResult>\n *     : // Unknown.\n *       Processor<ParseTree, HeadTree, TailTree, CompileTree, CompileResult>\n * )} UsePlugin\n *   Create a processor based on the input/output of a {@link Plugin plugin}.\n */\n\n/**\n * @template {CompileResults | undefined} Result\n *   Node type that the transformer yields.\n * @typedef {(\n *   Result extends Value | undefined ?\n *     VFile :\n *     VFile & {result: Result}\n *   )} VFileWithOutput\n *   Type to generate a {@linkcode VFile} corresponding to a compiler result.\n *\n *   If a result that is not acceptable on a `VFile` is used, that will\n *   be stored on the `result` field of {@linkcode VFile}.\n */\n\nimport {bail} from 'bail'\nimport extend from 'extend'\nimport {ok as assert} from 'devlop'\nimport isPlainObj from 'is-plain-obj'\nimport {trough} from 'trough'\nimport {VFile} from 'vfile'\nimport {CallableInstance} from './callable-instance.js'\n\n// To do: next major: drop `Compiler`, `Parser`: prefer lowercase.\n\n// To do: we could start yielding `never` in TS when a parser is missing and\n// `parse` is called.\n// Currently, we allow directly setting `processor.parser`, which is untyped.\n\nconst own = {}.hasOwnProperty\n\n/**\n * @template {Node | undefined} [ParseTree=undefined]\n *   Output of `parse` (optional).\n * @template {Node | undefined} [HeadTree=undefined]\n *   Input for `run` (optional).\n * @template {Node | undefined} [TailTree=undefined]\n *   Output for `run` (optional).\n * @template {Node | undefined} [CompileTree=undefined]\n *   Input of `stringify` (optional).\n * @template {CompileResults | undefined} [CompileResult=undefined]\n *   Output of `stringify` (optional).\n * @extends {CallableInstance<[], Processor<ParseTree, HeadTree, TailTree, CompileTree, CompileResult>>}\n */\nexport class Processor extends CallableInstance {\n  /**\n   * Create a processor.\n   */\n  constructor() {\n    // If `Processor()` is called (w/o new), `copy` is called instead.\n    super('copy')\n\n    /**\n     * Compiler to use (deprecated).\n     *\n     * @deprecated\n     *   Use `compiler` instead.\n     * @type {(\n     *   Compiler<\n     *     CompileTree extends undefined ? Node : CompileTree,\n     *     CompileResult extends undefined ? CompileResults : CompileResult\n     *   > |\n     *   undefined\n     * )}\n     */\n    this.Compiler = undefined\n\n    /**\n     * Parser to use (deprecated).\n     *\n     * @deprecated\n     *   Use `parser` instead.\n     * @type {(\n     *   Parser<ParseTree extends undefined ? Node : ParseTree> |\n     *   undefined\n     * )}\n     */\n    this.Parser = undefined\n\n    // Note: the following fields are considered private.\n    // However, they are needed for tests, and TSC generates an untyped\n    // `private freezeIndex` field for, which trips `type-coverage` up.\n    // Instead, we use `@deprecated` to visualize that they shouldn’t be used.\n    /**\n     * Internal list of configured plugins.\n     *\n     * @deprecated\n     *   This is a private internal property and should not be used.\n     * @type {Array<PluginTuple<Array<unknown>>>}\n     */\n    this.attachers = []\n\n    /**\n     * Compiler to use.\n     *\n     * @type {(\n     *   Compiler<\n     *     CompileTree extends undefined ? Node : CompileTree,\n     *     CompileResult extends undefined ? CompileResults : CompileResult\n     *   > |\n     *   undefined\n     * )}\n     */\n    this.compiler = undefined\n\n    /**\n     * Internal state to track where we are while freezing.\n     *\n     * @deprecated\n     *   This is a private internal property and should not be used.\n     * @type {number}\n     */\n    this.freezeIndex = -1\n\n    /**\n     * Internal state to track whether we’re frozen.\n     *\n     * @deprecated\n     *   This is a private internal property and should not be used.\n     * @type {boolean | undefined}\n     */\n    this.frozen = undefined\n\n    /**\n     * Internal state.\n     *\n     * @deprecated\n     *   This is a private internal property and should not be used.\n     * @type {Data}\n     */\n    this.namespace = {}\n\n    /**\n     * Parser to use.\n     *\n     * @type {(\n     *   Parser<ParseTree extends undefined ? Node : ParseTree> |\n     *   undefined\n     * )}\n     */\n    this.parser = undefined\n\n    /**\n     * Internal list of configured transformers.\n     *\n     * @deprecated\n     *   This is a private internal property and should not be used.\n     * @type {Pipeline}\n     */\n    this.transformers = trough()\n  }\n\n  /**\n   * Copy a processor.\n   *\n   * @deprecated\n   *   This is a private internal method and should not be used.\n   * @returns {Processor<ParseTree, HeadTree, TailTree, CompileTree, CompileResult>}\n   *   New *unfrozen* processor ({@linkcode Processor}) that is\n   *   configured to work the same as its ancestor.\n   *   When the descendant processor is configured in the future it does not\n   *   affect the ancestral processor.\n   */\n  copy() {\n    // Cast as the type parameters will be the same after attaching.\n    const destination =\n      /** @type {Processor<ParseTree, HeadTree, TailTree, CompileTree, CompileResult>} */ (\n        new Processor()\n      )\n    let index = -1\n\n    while (++index < this.attachers.length) {\n      const attacher = this.attachers[index]\n      destination.use(...attacher)\n    }\n\n    destination.data(extend(true, {}, this.namespace))\n\n    return destination\n  }\n\n  /**\n   * Configure the processor with info available to all plugins.\n   * Information is stored in an object.\n   *\n   * Typically, options can be given to a specific plugin, but sometimes it\n   * makes sense to have information shared with several plugins.\n   * For example, a list of HTML elements that are self-closing, which is\n   * needed during all phases.\n   *\n   * > **Note**: setting information cannot occur on *frozen* processors.\n   * > Call the processor first to create a new unfrozen processor.\n   *\n   * > **Note**: to register custom data in TypeScript, augment the\n   * > {@linkcode Data} interface.\n   *\n   * @example\n   *   This example show how to get and set info:\n   *\n   *   ```js\n   *   import {unified} from 'unified'\n   *\n   *   const processor = unified().data('alpha', 'bravo')\n   *\n   *   processor.data('alpha') // => 'bravo'\n   *\n   *   processor.data() // => {alpha: 'bravo'}\n   *\n   *   processor.data({charlie: 'delta'})\n   *\n   *   processor.data() // => {charlie: 'delta'}\n   *   ```\n   *\n   * @template {keyof Data} Key\n   *\n   * @overload\n   * @returns {Data}\n   *\n   * @overload\n   * @param {Data} dataset\n   * @returns {Processor<ParseTree, HeadTree, TailTree, CompileTree, CompileResult>}\n   *\n   * @overload\n   * @param {Key} key\n   * @returns {Data[Key]}\n   *\n   * @overload\n   * @param {Key} key\n   * @param {Data[Key]} value\n   * @returns {Processor<ParseTree, HeadTree, TailTree, CompileTree, CompileResult>}\n   *\n   * @param {Data | Key} [key]\n   *   Key to get or set, or entire dataset to set, or nothing to get the\n   *   entire dataset (optional).\n   * @param {Data[Key]} [value]\n   *   Value to set (optional).\n   * @returns {unknown}\n   *   The current processor when setting, the value at `key` when getting, or\n   *   the entire dataset when getting without key.\n   */\n  data(key, value) {\n    if (typeof key === 'string') {\n      // Set `key`.\n      if (arguments.length === 2) {\n        assertUnfrozen('data', this.frozen)\n        this.namespace[key] = value\n        return this\n      }\n\n      // Get `key`.\n      return (own.call(this.namespace, key) && this.namespace[key]) || undefined\n    }\n\n    // Set space.\n    if (key) {\n      assertUnfrozen('data', this.frozen)\n      this.namespace = key\n      return this\n    }\n\n    // Get space.\n    return this.namespace\n  }\n\n  /**\n   * Freeze a processor.\n   *\n   * Frozen processors are meant to be extended and not to be configured\n   * directly.\n   *\n   * When a processor is frozen it cannot be unfrozen.\n   * New processors working the same way can be created by calling the\n   * processor.\n   *\n   * It’s possible to freeze processors explicitly by calling `.freeze()`.\n   * Processors freeze automatically when `.parse()`, `.run()`, `.runSync()`,\n   * `.stringify()`, `.process()`, or `.processSync()` are called.\n   *\n   * @returns {Processor<ParseTree, HeadTree, TailTree, CompileTree, CompileResult>}\n   *   The current processor.\n   */\n  freeze() {\n    if (this.frozen) {\n      return this\n    }\n\n    // Cast so that we can type plugins easier.\n    // Plugins are supposed to be usable on different processors, not just on\n    // this exact processor.\n    const self = /** @type {Processor} */ (/** @type {unknown} */ (this))\n\n    while (++this.freezeIndex < this.attachers.length) {\n      const [attacher, ...options] = this.attachers[this.freezeIndex]\n\n      if (options[0] === false) {\n        continue\n      }\n\n      if (options[0] === true) {\n        options[0] = undefined\n      }\n\n      const transformer = attacher.call(self, ...options)\n\n      if (typeof transformer === 'function') {\n        this.transformers.use(transformer)\n      }\n    }\n\n    this.frozen = true\n    this.freezeIndex = Number.POSITIVE_INFINITY\n\n    return this\n  }\n\n  /**\n   * Parse text to a syntax tree.\n   *\n   * > **Note**: `parse` freezes the processor if not already *frozen*.\n   *\n   * > **Note**: `parse` performs the parse phase, not the run phase or other\n   * > phases.\n   *\n   * @param {Compatible | undefined} [file]\n   *   file to parse (optional); typically `string` or `VFile`; any value\n   *   accepted as `x` in `new VFile(x)`.\n   * @returns {ParseTree extends undefined ? Node : ParseTree}\n   *   Syntax tree representing `file`.\n   */\n  parse(file) {\n    this.freeze()\n    const realFile = vfile(file)\n    const parser = this.parser || this.Parser\n    assertParser('parse', parser)\n    return parser(String(realFile), realFile)\n  }\n\n  /**\n   * Process the given file as configured on the processor.\n   *\n   * > **Note**: `process` freezes the processor if not already *frozen*.\n   *\n   * > **Note**: `process` performs the parse, run, and stringify phases.\n   *\n   * @overload\n   * @param {Compatible | undefined} file\n   * @param {ProcessCallback<VFileWithOutput<CompileResult>>} done\n   * @returns {undefined}\n   *\n   * @overload\n   * @param {Compatible | undefined} [file]\n   * @returns {Promise<VFileWithOutput<CompileResult>>}\n   *\n   * @param {Compatible | undefined} [file]\n   *   File (optional); typically `string` or `VFile`]; any value accepted as\n   *   `x` in `new VFile(x)`.\n   * @param {ProcessCallback<VFileWithOutput<CompileResult>> | undefined} [done]\n   *   Callback (optional).\n   * @returns {Promise<VFile> | undefined}\n   *   Nothing if `done` is given.\n   *   Otherwise a promise, rejected with a fatal error or resolved with the\n   *   processed file.\n   *\n   *   The parsed, transformed, and compiled value is available at\n   *   `file.value` (see note).\n   *\n   *   > **Note**: unified typically compiles by serializing: most\n   *   > compilers return `string` (or `Uint8Array`).\n   *   > Some compilers, such as the one configured with\n   *   > [`rehype-react`][rehype-react], return other values (in this case, a\n   *   > React tree).\n   *   > If you’re using a compiler that doesn’t serialize, expect different\n   *   > result values.\n   *   >\n   *   > To register custom results in TypeScript, add them to\n   *   > {@linkcode CompileResultMap}.\n   *\n   *   [rehype-react]: https://github.com/rehypejs/rehype-react\n   */\n  process(file, done) {\n    const self = this\n\n    this.freeze()\n    assertParser('process', this.parser || this.Parser)\n    assertCompiler('process', this.compiler || this.Compiler)\n\n    return done ? executor(undefined, done) : new Promise(executor)\n\n    // Note: `void`s needed for TS.\n    /**\n     * @param {((file: VFileWithOutput<CompileResult>) => undefined | void) | undefined} resolve\n     * @param {(error: Error | undefined) => undefined | void} reject\n     * @returns {undefined}\n     */\n    function executor(resolve, reject) {\n      const realFile = vfile(file)\n      // Assume `ParseTree` (the result of the parser) matches `HeadTree` (the\n      // input of the first transform).\n      const parseTree =\n        /** @type {HeadTree extends undefined ? Node : HeadTree} */ (\n          /** @type {unknown} */ (self.parse(realFile))\n        )\n\n      self.run(parseTree, realFile, function (error, tree, file) {\n        if (error || !tree || !file) {\n          return realDone(error)\n        }\n\n        // Assume `TailTree` (the output of the last transform) matches\n        // `CompileTree` (the input of the compiler).\n        const compileTree =\n          /** @type {CompileTree extends undefined ? Node : CompileTree} */ (\n            /** @type {unknown} */ (tree)\n          )\n\n        const compileResult = self.stringify(compileTree, file)\n\n        if (looksLikeAValue(compileResult)) {\n          file.value = compileResult\n        } else {\n          file.result = compileResult\n        }\n\n        realDone(error, /** @type {VFileWithOutput<CompileResult>} */ (file))\n      })\n\n      /**\n       * @param {Error | undefined} error\n       * @param {VFileWithOutput<CompileResult> | undefined} [file]\n       * @returns {undefined}\n       */\n      function realDone(error, file) {\n        if (error || !file) {\n          reject(error)\n        } else if (resolve) {\n          resolve(file)\n        } else {\n          assert(done, '`done` is defined if `resolve` is not')\n          done(undefined, file)\n        }\n      }\n    }\n  }\n\n  /**\n   * Process the given file as configured on the processor.\n   *\n   * An error is thrown if asynchronous transforms are configured.\n   *\n   * > **Note**: `processSync` freezes the processor if not already *frozen*.\n   *\n   * > **Note**: `processSync` performs the parse, run, and stringify phases.\n   *\n   * @param {Compatible | undefined} [file]\n   *   File (optional); typically `string` or `VFile`; any value accepted as\n   *   `x` in `new VFile(x)`.\n   * @returns {VFileWithOutput<CompileResult>}\n   *   The processed file.\n   *\n   *   The parsed, transformed, and compiled value is available at\n   *   `file.value` (see note).\n   *\n   *   > **Note**: unified typically compiles by serializing: most\n   *   > compilers return `string` (or `Uint8Array`).\n   *   > Some compilers, such as the one configured with\n   *   > [`rehype-react`][rehype-react], return other values (in this case, a\n   *   > React tree).\n   *   > If you’re using a compiler that doesn’t serialize, expect different\n   *   > result values.\n   *   >\n   *   > To register custom results in TypeScript, add them to\n   *   > {@linkcode CompileResultMap}.\n   *\n   *   [rehype-react]: https://github.com/rehypejs/rehype-react\n   */\n  processSync(file) {\n    /** @type {boolean} */\n    let complete = false\n    /** @type {VFileWithOutput<CompileResult> | undefined} */\n    let result\n\n    this.freeze()\n    assertParser('processSync', this.parser || this.Parser)\n    assertCompiler('processSync', this.compiler || this.Compiler)\n\n    this.process(file, realDone)\n    assertDone('processSync', 'process', complete)\n    assert(result, 'we either bailed on an error or have a tree')\n\n    return result\n\n    /**\n     * @type {ProcessCallback<VFileWithOutput<CompileResult>>}\n     */\n    function realDone(error, file) {\n      complete = true\n      bail(error)\n      result = file\n    }\n  }\n\n  /**\n   * Run *transformers* on a syntax tree.\n   *\n   * > **Note**: `run` freezes the processor if not already *frozen*.\n   *\n   * > **Note**: `run` performs the run phase, not other phases.\n   *\n   * @overload\n   * @param {HeadTree extends undefined ? Node : HeadTree} tree\n   * @param {RunCallback<TailTree extends undefined ? Node : TailTree>} done\n   * @returns {undefined}\n   *\n   * @overload\n   * @param {HeadTree extends undefined ? Node : HeadTree} tree\n   * @param {Compatible | undefined} file\n   * @param {RunCallback<TailTree extends undefined ? Node : TailTree>} done\n   * @returns {undefined}\n   *\n   * @overload\n   * @param {HeadTree extends undefined ? Node : HeadTree} tree\n   * @param {Compatible | undefined} [file]\n   * @returns {Promise<TailTree extends undefined ? Node : TailTree>}\n   *\n   * @param {HeadTree extends undefined ? Node : HeadTree} tree\n   *   Tree to transform and inspect.\n   * @param {(\n   *   RunCallback<TailTree extends undefined ? Node : TailTree> |\n   *   Compatible\n   * )} [file]\n   *   File associated with `node` (optional); any value accepted as `x` in\n   *   `new VFile(x)`.\n   * @param {RunCallback<TailTree extends undefined ? Node : TailTree>} [done]\n   *   Callback (optional).\n   * @returns {Promise<TailTree extends undefined ? Node : TailTree> | undefined}\n   *   Nothing if `done` is given.\n   *   Otherwise, a promise rejected with a fatal error or resolved with the\n   *   transformed tree.\n   */\n  run(tree, file, done) {\n    assertNode(tree)\n    this.freeze()\n\n    const transformers = this.transformers\n\n    if (!done && typeof file === 'function') {\n      done = file\n      file = undefined\n    }\n\n    return done ? executor(undefined, done) : new Promise(executor)\n\n    // Note: `void`s needed for TS.\n    /**\n     * @param {(\n     *   ((tree: TailTree extends undefined ? Node : TailTree) => undefined | void) |\n     *   undefined\n     * )} resolve\n     * @param {(error: Error) => undefined | void} reject\n     * @returns {undefined}\n     */\n    function executor(resolve, reject) {\n      assert(\n        typeof file !== 'function',\n        '`file` can’t be a `done` anymore, we checked'\n      )\n      const realFile = vfile(file)\n      transformers.run(tree, realFile, realDone)\n\n      /**\n       * @param {Error | undefined} error\n       * @param {Node} outputTree\n       * @param {VFile} file\n       * @returns {undefined}\n       */\n      function realDone(error, outputTree, file) {\n        const resultingTree =\n          /** @type {TailTree extends undefined ? Node : TailTree} */ (\n            outputTree || tree\n          )\n\n        if (error) {\n          reject(error)\n        } else if (resolve) {\n          resolve(resultingTree)\n        } else {\n          assert(done, '`done` is defined if `resolve` is not')\n          done(undefined, resultingTree, file)\n        }\n      }\n    }\n  }\n\n  /**\n   * Run *transformers* on a syntax tree.\n   *\n   * An error is thrown if asynchronous transforms are configured.\n   *\n   * > **Note**: `runSync` freezes the processor if not already *frozen*.\n   *\n   * > **Note**: `runSync` performs the run phase, not other phases.\n   *\n   * @param {HeadTree extends undefined ? Node : HeadTree} tree\n   *   Tree to transform and inspect.\n   * @param {Compatible | undefined} [file]\n   *   File associated with `node` (optional); any value accepted as `x` in\n   *   `new VFile(x)`.\n   * @returns {TailTree extends undefined ? Node : TailTree}\n   *   Transformed tree.\n   */\n  runSync(tree, file) {\n    /** @type {boolean} */\n    let complete = false\n    /** @type {(TailTree extends undefined ? Node : TailTree) | undefined} */\n    let result\n\n    this.run(tree, file, realDone)\n\n    assertDone('runSync', 'run', complete)\n    assert(result, 'we either bailed on an error or have a tree')\n    return result\n\n    /**\n     * @type {RunCallback<TailTree extends undefined ? Node : TailTree>}\n     */\n    function realDone(error, tree) {\n      bail(error)\n      result = tree\n      complete = true\n    }\n  }\n\n  /**\n   * Compile a syntax tree.\n   *\n   * > **Note**: `stringify` freezes the processor if not already *frozen*.\n   *\n   * > **Note**: `stringify` performs the stringify phase, not the run phase\n   * > or other phases.\n   *\n   * @param {CompileTree extends undefined ? Node : CompileTree} tree\n   *   Tree to compile.\n   * @param {Compatible | undefined} [file]\n   *   File associated with `node` (optional); any value accepted as `x` in\n   *   `new VFile(x)`.\n   * @returns {CompileResult extends undefined ? Value : CompileResult}\n   *   Textual representation of the tree (see note).\n   *\n   *   > **Note**: unified typically compiles by serializing: most compilers\n   *   > return `string` (or `Uint8Array`).\n   *   > Some compilers, such as the one configured with\n   *   > [`rehype-react`][rehype-react], return other values (in this case, a\n   *   > React tree).\n   *   > If you’re using a compiler that doesn’t serialize, expect different\n   *   > result values.\n   *   >\n   *   > To register custom results in TypeScript, add them to\n   *   > {@linkcode CompileResultMap}.\n   *\n   *   [rehype-react]: https://github.com/rehypejs/rehype-react\n   */\n  stringify(tree, file) {\n    this.freeze()\n    const realFile = vfile(file)\n    const compiler = this.compiler || this.Compiler\n    assertCompiler('stringify', compiler)\n    assertNode(tree)\n\n    return compiler(tree, realFile)\n  }\n\n  /**\n   * Configure the processor to use a plugin, a list of usable values, or a\n   * preset.\n   *\n   * If the processor is already using a plugin, the previous plugin\n   * configuration is changed based on the options that are passed in.\n   * In other words, the plugin is not added a second time.\n   *\n   * > **Note**: `use` cannot be called on *frozen* processors.\n   * > Call the processor first to create a new unfrozen processor.\n   *\n   * @example\n   *   There are many ways to pass plugins to `.use()`.\n   *   This example gives an overview:\n   *\n   *   ```js\n   *   import {unified} from 'unified'\n   *\n   *   unified()\n   *     // Plugin with options:\n   *     .use(pluginA, {x: true, y: true})\n   *     // Passing the same plugin again merges configuration (to `{x: true, y: false, z: true}`):\n   *     .use(pluginA, {y: false, z: true})\n   *     // Plugins:\n   *     .use([pluginB, pluginC])\n   *     // Two plugins, the second with options:\n   *     .use([pluginD, [pluginE, {}]])\n   *     // Preset with plugins and settings:\n   *     .use({plugins: [pluginF, [pluginG, {}]], settings: {position: false}})\n   *     // Settings only:\n   *     .use({settings: {position: false}})\n   *   ```\n   *\n   * @template {Array<unknown>} [Parameters=[]]\n   * @template {Node | string | undefined} [Input=undefined]\n   * @template [Output=Input]\n   *\n   * @overload\n   * @param {Preset | null | undefined} [preset]\n   * @returns {Processor<ParseTree, HeadTree, TailTree, CompileTree, CompileResult>}\n   *\n   * @overload\n   * @param {PluggableList} list\n   * @returns {Processor<ParseTree, HeadTree, TailTree, CompileTree, CompileResult>}\n   *\n   * @overload\n   * @param {Plugin<Parameters, Input, Output>} plugin\n   * @param {...(Parameters | [boolean])} parameters\n   * @returns {UsePlugin<ParseTree, HeadTree, TailTree, CompileTree, CompileResult, Input, Output>}\n   *\n   * @param {PluggableList | Plugin | Preset | null | undefined} value\n   *   Usable value.\n   * @param {...unknown} parameters\n   *   Parameters, when a plugin is given as a usable value.\n   * @returns {Processor<ParseTree, HeadTree, TailTree, CompileTree, CompileResult>}\n   *   Current processor.\n   */\n  use(value, ...parameters) {\n    const attachers = this.attachers\n    const namespace = this.namespace\n\n    assertUnfrozen('use', this.frozen)\n\n    if (value === null || value === undefined) {\n      // Empty.\n    } else if (typeof value === 'function') {\n      addPlugin(value, parameters)\n    } else if (typeof value === 'object') {\n      if (Array.isArray(value)) {\n        addList(value)\n      } else {\n        addPreset(value)\n      }\n    } else {\n      throw new TypeError('Expected usable value, not `' + value + '`')\n    }\n\n    return this\n\n    /**\n     * @param {Pluggable} value\n     * @returns {undefined}\n     */\n    function add(value) {\n      if (typeof value === 'function') {\n        addPlugin(value, [])\n      } else if (typeof value === 'object') {\n        if (Array.isArray(value)) {\n          const [plugin, ...parameters] =\n            /** @type {PluginTuple<Array<unknown>>} */ (value)\n          addPlugin(plugin, parameters)\n        } else {\n          addPreset(value)\n        }\n      } else {\n        throw new TypeError('Expected usable value, not `' + value + '`')\n      }\n    }\n\n    /**\n     * @param {Preset} result\n     * @returns {undefined}\n     */\n    function addPreset(result) {\n      if (!('plugins' in result) && !('settings' in result)) {\n        throw new Error(\n          'Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither'\n        )\n      }\n\n      addList(result.plugins)\n\n      if (result.settings) {\n        namespace.settings = extend(true, namespace.settings, result.settings)\n      }\n    }\n\n    /**\n     * @param {PluggableList | null | undefined} plugins\n     * @returns {undefined}\n     */\n    function addList(plugins) {\n      let index = -1\n\n      if (plugins === null || plugins === undefined) {\n        // Empty.\n      } else if (Array.isArray(plugins)) {\n        while (++index < plugins.length) {\n          const thing = plugins[index]\n          add(thing)\n        }\n      } else {\n        throw new TypeError('Expected a list of plugins, not `' + plugins + '`')\n      }\n    }\n\n    /**\n     * @param {Plugin} plugin\n     * @param {Array<unknown>} parameters\n     * @returns {undefined}\n     */\n    function addPlugin(plugin, parameters) {\n      let index = -1\n      let entryIndex = -1\n\n      while (++index < attachers.length) {\n        if (attachers[index][0] === plugin) {\n          entryIndex = index\n          break\n        }\n      }\n\n      if (entryIndex === -1) {\n        attachers.push([plugin, ...parameters])\n      }\n      // Only set if there was at least a `primary` value, otherwise we’d change\n      // `arguments.length`.\n      else if (parameters.length > 0) {\n        let [primary, ...rest] = parameters\n        const currentPrimary = attachers[entryIndex][1]\n        if (isPlainObj(currentPrimary) && isPlainObj(primary)) {\n          primary = extend(true, currentPrimary, primary)\n        }\n\n        attachers[entryIndex] = [plugin, primary, ...rest]\n      }\n    }\n  }\n}\n\n// Note: this returns a *callable* instance.\n// That’s why it’s documented as a function.\n/**\n * Create a new processor.\n *\n * @example\n *   This example shows how a new processor can be created (from `remark`) and linked\n *   to **stdin**(4) and **stdout**(4).\n *\n *   ```js\n *   import process from 'node:process'\n *   import concatStream from 'concat-stream'\n *   import {remark} from 'remark'\n *\n *   process.stdin.pipe(\n *     concatStream(function (buf) {\n *       process.stdout.write(String(remark().processSync(buf)))\n *     })\n *   )\n *   ```\n *\n * @returns\n *   New *unfrozen* processor (`processor`).\n *\n *   This processor is configured to work the same as its ancestor.\n *   When the descendant processor is configured in the future it does not\n *   affect the ancestral processor.\n */\nexport const unified = new Processor().freeze()\n\n/**\n * Assert a parser is available.\n *\n * @param {string} name\n * @param {unknown} value\n * @returns {asserts value is Parser}\n */\nfunction assertParser(name, value) {\n  if (typeof value !== 'function') {\n    throw new TypeError('Cannot `' + name + '` without `parser`')\n  }\n}\n\n/**\n * Assert a compiler is available.\n *\n * @param {string} name\n * @param {unknown} value\n * @returns {asserts value is Compiler}\n */\nfunction assertCompiler(name, value) {\n  if (typeof value !== 'function') {\n    throw new TypeError('Cannot `' + name + '` without `compiler`')\n  }\n}\n\n/**\n * Assert the processor is not frozen.\n *\n * @param {string} name\n * @param {unknown} frozen\n * @returns {asserts frozen is false}\n */\nfunction assertUnfrozen(name, frozen) {\n  if (frozen) {\n    throw new Error(\n      'Cannot call `' +\n        name +\n        '` on a frozen processor.\\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.'\n    )\n  }\n}\n\n/**\n * Assert `node` is a unist node.\n *\n * @param {unknown} node\n * @returns {asserts node is Node}\n */\nfunction assertNode(node) {\n  // `isPlainObj` unfortunately uses `any` instead of `unknown`.\n  // type-coverage:ignore-next-line\n  if (!isPlainObj(node) || typeof node.type !== 'string') {\n    throw new TypeError('Expected node, got `' + node + '`')\n    // Fine.\n  }\n}\n\n/**\n * Assert that `complete` is `true`.\n *\n * @param {string} name\n * @param {string} asyncName\n * @param {unknown} complete\n * @returns {asserts complete is true}\n */\nfunction assertDone(name, asyncName, complete) {\n  if (!complete) {\n    throw new Error(\n      '`' + name + '` finished async. Use `' + asyncName + '` instead'\n    )\n  }\n}\n\n/**\n * @param {Compatible | undefined} [value]\n * @returns {VFile}\n */\nfunction vfile(value) {\n  return looksLikeAVFile(value) ? value : new VFile(value)\n}\n\n/**\n * @param {Compatible | undefined} [value]\n * @returns {value is VFile}\n */\nfunction looksLikeAVFile(value) {\n  return Boolean(\n    value &&\n      typeof value === 'object' &&\n      'message' in value &&\n      'messages' in value\n  )\n}\n\n/**\n * @param {unknown} [value]\n * @returns {value is Value}\n */\nfunction looksLikeAValue(value) {\n  return typeof value === 'string' || isUint8Array(value)\n}\n\n/**\n * Assert `value` is an `Uint8Array`.\n *\n * @param {unknown} value\n *   thing.\n * @returns {value is Uint8Array}\n *   Whether `value` is an `Uint8Array`.\n */\nfunction isUint8Array(value) {\n  return Boolean(\n    value &&\n      typeof value === 'object' &&\n      'byteLength' in value &&\n      'byteOffset' in value\n  )\n}\n","// To do: remove `void`s\n// To do: remove `null` from output of our APIs, allow it as user APIs.\n\n/**\n * @typedef {(error?: Error | null | undefined, ...output: Array<any>) => void} Callback\n *   Callback.\n *\n * @typedef {(...input: Array<any>) => any} Middleware\n *   Ware.\n *\n * @typedef Pipeline\n *   Pipeline.\n * @property {Run} run\n *   Run the pipeline.\n * @property {Use} use\n *   Add middleware.\n *\n * @typedef {(...input: Array<any>) => void} Run\n *   Call all middleware.\n *\n *   Calls `done` on completion with either an error or the output of the\n *   last middleware.\n *\n *   > 👉 **Note**: as the length of input defines whether async functions get a\n *   > `next` function,\n *   > it’s recommended to keep `input` at one value normally.\n\n *\n * @typedef {(fn: Middleware) => Pipeline} Use\n *   Add middleware.\n */\n\n/**\n * Create new middleware.\n *\n * @returns {Pipeline}\n *   Pipeline.\n */\nexport function trough() {\n  /** @type {Array<Middleware>} */\n  const fns = []\n  /** @type {Pipeline} */\n  const pipeline = {run, use}\n\n  return pipeline\n\n  /** @type {Run} */\n  function run(...values) {\n    let middlewareIndex = -1\n    /** @type {Callback} */\n    const callback = values.pop()\n\n    if (typeof callback !== 'function') {\n      throw new TypeError('Expected function as last argument, not ' + callback)\n    }\n\n    next(null, ...values)\n\n    /**\n     * Run the next `fn`, or we’re done.\n     *\n     * @param {Error | null | undefined} error\n     * @param {Array<any>} output\n     */\n    function next(error, ...output) {\n      const fn = fns[++middlewareIndex]\n      let index = -1\n\n      if (error) {\n        callback(error)\n        return\n      }\n\n      // Copy non-nullish input into values.\n      while (++index < values.length) {\n        if (output[index] === null || output[index] === undefined) {\n          output[index] = values[index]\n        }\n      }\n\n      // Save the newly created `output` for the next call.\n      values = output\n\n      // Next or done.\n      if (fn) {\n        wrap(fn, next)(...output)\n      } else {\n        callback(null, ...output)\n      }\n    }\n  }\n\n  /** @type {Use} */\n  function use(middelware) {\n    if (typeof middelware !== 'function') {\n      throw new TypeError(\n        'Expected `middelware` to be a function, not ' + middelware\n      )\n    }\n\n    fns.push(middelware)\n    return pipeline\n  }\n}\n\n/**\n * Wrap `middleware` into a uniform interface.\n *\n * You can pass all input to the resulting function.\n * `callback` is then called with the output of `middleware`.\n *\n * If `middleware` accepts more arguments than the later given in input,\n * an extra `done` function is passed to it after that input,\n * which must be called by `middleware`.\n *\n * The first value in `input` is the main input value.\n * All other input values are the rest input values.\n * The values given to `callback` are the input values,\n * merged with every non-nullish output value.\n *\n * * if `middleware` throws an error,\n *   returns a promise that is rejected,\n *   or calls the given `done` function with an error,\n *   `callback` is called with that error\n * * if `middleware` returns a value or returns a promise that is resolved,\n *   that value is the main output value\n * * if `middleware` calls `done`,\n *   all non-nullish values except for the first one (the error) overwrite the\n *   output values\n *\n * @param {Middleware} middleware\n *   Function to wrap.\n * @param {Callback} callback\n *   Callback called with the output of `middleware`.\n * @returns {Run}\n *   Wrapped middleware.\n */\nexport function wrap(middleware, callback) {\n  /** @type {boolean} */\n  let called\n\n  return wrapped\n\n  /**\n   * Call `middleware`.\n   * @this {any}\n   * @param {Array<any>} parameters\n   * @returns {void}\n   */\n  function wrapped(...parameters) {\n    const fnExpectsCallback = middleware.length > parameters.length\n    /** @type {any} */\n    let result\n\n    if (fnExpectsCallback) {\n      parameters.push(done)\n    }\n\n    try {\n      result = middleware.apply(this, parameters)\n    } catch (error) {\n      const exception = /** @type {Error} */ (error)\n\n      // Well, this is quite the pickle.\n      // `middleware` received a callback and called it synchronously, but that\n      // threw an error.\n      // The only thing left to do is to throw the thing instead.\n      if (fnExpectsCallback && called) {\n        throw exception\n      }\n\n      return done(exception)\n    }\n\n    if (!fnExpectsCallback) {\n      if (result && result.then && typeof result.then === 'function') {\n        result.then(then, done)\n      } else if (result instanceof Error) {\n        done(result)\n      } else {\n        then(result)\n      }\n    }\n  }\n\n  /**\n   * Call `callback`, only once.\n   *\n   * @type {Callback}\n   */\n  function done(error, ...output) {\n    if (!called) {\n      called = true\n      callback(error, ...output)\n    }\n  }\n\n  /**\n   * Call `done` with one value.\n   *\n   * @param {any} [value]\n   */\n  function then(value) {\n    done(null, value)\n  }\n}\n","// Register `Raw` in tree:\n/// <reference types=\"mdast-util-to-hast\" />\n\n/**\n * @typedef {import('hast').Element} Element\n * @typedef {import('hast').ElementContent} ElementContent\n * @typedef {import('hast').Nodes} Nodes\n * @typedef {import('hast').Parents} Parents\n * @typedef {import('hast').Root} Root\n * @typedef {import('hast-util-to-jsx-runtime').Components} JsxRuntimeComponents\n * @typedef {import('remark-rehype').Options} RemarkRehypeOptions\n * @typedef {import('unist-util-visit').BuildVisitor<Root>} Visitor\n * @typedef {import('unified').PluggableList} PluggableList\n */\n\n/**\n * @callback AllowElement\n *   Filter elements.\n * @param {Readonly<Element>} element\n *   Element to check.\n * @param {number} index\n *   Index of `element` in `parent`.\n * @param {Readonly<Parents> | undefined} parent\n *   Parent of `element`.\n * @returns {boolean | null | undefined}\n *   Whether to allow `element` (default: `false`).\n *\n * @typedef {Partial<JsxRuntimeComponents>} Components\n *   Map tag names to components.\n *\n * @typedef Deprecation\n *   Deprecation.\n * @property {string} from\n *   Old field.\n * @property {string} id\n *   ID in readme.\n * @property {keyof Options} [to]\n *   New field.\n *\n * @typedef Options\n *   Configuration.\n * @property {AllowElement | null | undefined} [allowElement]\n *   Filter elements (optional);\n *   `allowedElements` / `disallowedElements` is used first.\n * @property {ReadonlyArray<string> | null | undefined} [allowedElements]\n *   Tag names to allow (default: all tag names);\n *   cannot combine w/ `disallowedElements`.\n * @property {string | null | undefined} [children]\n *   Markdown.\n * @property {string | null | undefined} [className]\n *   Wrap in a `div` with this class name.\n * @property {Components | null | undefined} [components]\n *   Map tag names to components.\n * @property {ReadonlyArray<string> | null | undefined} [disallowedElements]\n *   Tag names to disallow (default: `[]`);\n *   cannot combine w/ `allowedElements`.\n * @property {PluggableList | null | undefined} [rehypePlugins]\n *   List of rehype plugins to use.\n * @property {PluggableList | null | undefined} [remarkPlugins]\n *   List of remark plugins to use.\n * @property {Readonly<RemarkRehypeOptions> | null | undefined} [remarkRehypeOptions]\n *   Options to pass through to `remark-rehype`.\n * @property {boolean | null | undefined} [skipHtml=false]\n *   Ignore HTML in markdown completely (default: `false`).\n * @property {boolean | null | undefined} [unwrapDisallowed=false]\n *   Extract (unwrap) what’s in disallowed elements (default: `false`);\n *   normally when say `strong` is not allowed, it and it’s children are dropped,\n *   with `unwrapDisallowed` the element itself is replaced by its children.\n * @property {UrlTransform | null | undefined} [urlTransform]\n *   Change URLs (default: `defaultUrlTransform`)\n *\n * @callback UrlTransform\n *   Transform all URLs.\n * @param {string} url\n *   URL.\n * @param {string} key\n *   Property name (example: `'href'`).\n * @param {Readonly<Element>} node\n *   Node.\n * @returns {string | null | undefined}\n *   Transformed URL (optional).\n */\n\nimport {unreachable} from 'devlop'\nimport {toJsxRuntime} from 'hast-util-to-jsx-runtime'\nimport {urlAttributes} from 'html-url-attributes'\n// @ts-expect-error: untyped.\nimport {Fragment, jsx, jsxs} from 'react/jsx-runtime'\nimport remarkParse from 'remark-parse'\nimport remarkRehype from 'remark-rehype'\nimport {unified} from 'unified'\nimport {visit} from 'unist-util-visit'\nimport {VFile} from 'vfile'\n\nconst changelog =\n  'https://github.com/remarkjs/react-markdown/blob/main/changelog.md'\n\n/** @type {PluggableList} */\nconst emptyPlugins = []\n/** @type {Readonly<RemarkRehypeOptions>} */\nconst emptyRemarkRehypeOptions = {allowDangerousHtml: true}\nconst safeProtocol = /^(https?|ircs?|mailto|xmpp)$/i\n\n// Mutable because we `delete` any time it’s used and a message is sent.\n/** @type {ReadonlyArray<Readonly<Deprecation>>} */\nconst deprecations = [\n  {from: 'astPlugins', id: 'remove-buggy-html-in-markdown-parser'},\n  {from: 'allowDangerousHtml', id: 'remove-buggy-html-in-markdown-parser'},\n  {\n    from: 'allowNode',\n    id: 'replace-allownode-allowedtypes-and-disallowedtypes',\n    to: 'allowElement'\n  },\n  {\n    from: 'allowedTypes',\n    id: 'replace-allownode-allowedtypes-and-disallowedtypes',\n    to: 'allowedElements'\n  },\n  {\n    from: 'disallowedTypes',\n    id: 'replace-allownode-allowedtypes-and-disallowedtypes',\n    to: 'disallowedElements'\n  },\n  {from: 'escapeHtml', id: 'remove-buggy-html-in-markdown-parser'},\n  {from: 'includeElementIndex', id: '#remove-includeelementindex'},\n  {\n    from: 'includeNodeIndex',\n    id: 'change-includenodeindex-to-includeelementindex'\n  },\n  {from: 'linkTarget', id: 'remove-linktarget'},\n  {from: 'plugins', id: 'change-plugins-to-remarkplugins', to: 'remarkPlugins'},\n  {from: 'rawSourcePos', id: '#remove-rawsourcepos'},\n  {from: 'renderers', id: 'change-renderers-to-components', to: 'components'},\n  {from: 'source', id: 'change-source-to-children', to: 'children'},\n  {from: 'sourcePos', id: '#remove-sourcepos'},\n  {from: 'transformImageUri', id: '#add-urltransform', to: 'urlTransform'},\n  {from: 'transformLinkUri', id: '#add-urltransform', to: 'urlTransform'}\n]\n\n/**\n * Component to render markdown.\n *\n * @param {Readonly<Options>} options\n *   Props.\n * @returns {JSX.Element}\n *   React element.\n */\nexport function Markdown(options) {\n  const allowedElements = options.allowedElements\n  const allowElement = options.allowElement\n  const children = options.children || ''\n  const className = options.className\n  const components = options.components\n  const disallowedElements = options.disallowedElements\n  const rehypePlugins = options.rehypePlugins || emptyPlugins\n  const remarkPlugins = options.remarkPlugins || emptyPlugins\n  const remarkRehypeOptions = options.remarkRehypeOptions\n    ? {...options.remarkRehypeOptions, ...emptyRemarkRehypeOptions}\n    : emptyRemarkRehypeOptions\n  const skipHtml = options.skipHtml\n  const unwrapDisallowed = options.unwrapDisallowed\n  const urlTransform = options.urlTransform || defaultUrlTransform\n\n  const processor = unified()\n    .use(remarkParse)\n    .use(remarkPlugins)\n    .use(remarkRehype, remarkRehypeOptions)\n    .use(rehypePlugins)\n\n  const file = new VFile()\n\n  if (typeof children === 'string') {\n    file.value = children\n  } else {\n    unreachable(\n      'Unexpected value `' +\n        children +\n        '` for `children` prop, expected `string`'\n    )\n  }\n\n  if (allowedElements && disallowedElements) {\n    unreachable(\n      'Unexpected combined `allowedElements` and `disallowedElements`, expected one or the other'\n    )\n  }\n\n  for (const deprecation of deprecations) {\n    if (Object.hasOwn(options, deprecation.from)) {\n      unreachable(\n        'Unexpected `' +\n          deprecation.from +\n          '` prop, ' +\n          (deprecation.to\n            ? 'use `' + deprecation.to + '` instead'\n            : 'remove it') +\n          ' (see <' +\n          changelog +\n          '#' +\n          deprecation.id +\n          '> for more info)'\n      )\n    }\n  }\n\n  const mdastTree = processor.parse(file)\n  /** @type {Nodes} */\n  let hastTree = processor.runSync(mdastTree, file)\n\n  // Wrap in `div` if there’s a class name.\n  if (className) {\n    hastTree = {\n      type: 'element',\n      tagName: 'div',\n      properties: {className},\n      // Assume no doctypes.\n      children: /** @type {Array<ElementContent>} */ (\n        hastTree.type === 'root' ? hastTree.children : [hastTree]\n      )\n    }\n  }\n\n  visit(hastTree, transform)\n\n  return toJsxRuntime(hastTree, {\n    Fragment,\n    components,\n    ignoreInvalidStyle: true,\n    jsx,\n    jsxs,\n    passKeys: true,\n    passNode: true\n  })\n\n  /** @type {Visitor} */\n  function transform(node, index, parent) {\n    if (node.type === 'raw' && parent && typeof index === 'number') {\n      if (skipHtml) {\n        parent.children.splice(index, 1)\n      } else {\n        parent.children[index] = {type: 'text', value: node.value}\n      }\n\n      return index\n    }\n\n    if (node.type === 'element') {\n      /** @type {string} */\n      let key\n\n      for (key in urlAttributes) {\n        if (\n          Object.hasOwn(urlAttributes, key) &&\n          Object.hasOwn(node.properties, key)\n        ) {\n          const value = node.properties[key]\n          const test = urlAttributes[key]\n          if (test === null || test.includes(node.tagName)) {\n            node.properties[key] = urlTransform(String(value || ''), key, node)\n          }\n        }\n      }\n    }\n\n    if (node.type === 'element') {\n      let remove = allowedElements\n        ? !allowedElements.includes(node.tagName)\n        : disallowedElements\n        ? disallowedElements.includes(node.tagName)\n        : false\n\n      if (!remove && allowElement && typeof index === 'number') {\n        remove = !allowElement(node, index, parent)\n      }\n\n      if (remove && parent && typeof index === 'number') {\n        if (unwrapDisallowed && node.children) {\n          parent.children.splice(index, 1, ...node.children)\n        } else {\n          parent.children.splice(index, 1)\n        }\n\n        return index\n      }\n    }\n  }\n}\n\n/**\n * Make a URL safe.\n *\n * @satisfies {UrlTransform}\n * @param {string} value\n *   URL.\n * @returns {string}\n *   Safe URL.\n */\nexport function defaultUrlTransform(value) {\n  // Same as:\n  // <https://github.com/micromark/micromark/blob/929275e/packages/micromark-util-sanitize-uri/dev/index.js#L34>\n  // But without the `encode` part.\n  const colon = value.indexOf(':')\n  const questionMark = value.indexOf('?')\n  const numberSign = value.indexOf('#')\n  const slash = value.indexOf('/')\n\n  if (\n    // If there is no protocol, it’s relative.\n    colon < 0 ||\n    // If the first colon is after a `?`, `#`, or `/`, it’s not a protocol.\n    (slash > -1 && colon > slash) ||\n    (questionMark > -1 && colon > questionMark) ||\n    (numberSign > -1 && colon > numberSign) ||\n    // It is a protocol, it should be allowed.\n    safeProtocol.test(value.slice(0, colon))\n  ) {\n    return value\n  }\n\n  return ''\n}\n","'use strict';\n\n/** @typedef {(...args: any[]) => *[]} GetDependants */\n\n/** @typedef {() => void} Clear */\n\n/**\n * @typedef {{\n *   getDependants: GetDependants,\n *   clear: Clear\n * }} EnhancedSelector\n */\n\n/**\n * Internal cache entry.\n *\n * @typedef CacheNode\n *\n * @property {?CacheNode|undefined} [prev] Previous node.\n * @property {?CacheNode|undefined} [next] Next node.\n * @property {*[]} args Function arguments for cache entry.\n * @property {*} val Function result.\n */\n\n/**\n * @typedef Cache\n *\n * @property {Clear} clear Function to clear cache.\n * @property {boolean} [isUniqueByDependants] Whether dependants are valid in\n * considering cache uniqueness. A cache is unique if dependents are all arrays\n * or objects.\n * @property {CacheNode?} [head] Cache head.\n * @property {*[]} [lastDependants] Dependants from previous invocation.\n */\n\n/**\n * Arbitrary value used as key for referencing cache object in WeakMap tree.\n *\n * @type {{}}\n */\nvar LEAF_KEY = {};\n\n/**\n * Returns the first argument as the sole entry in an array.\n *\n * @template T\n *\n * @param {T} value Value to return.\n *\n * @return {[T]} Value returned as entry in array.\n */\nfunction arrayOf(value) {\n\treturn [value];\n}\n\n/**\n * Returns true if the value passed is object-like, or false otherwise. A value\n * is object-like if it can support property assignment, e.g. object or array.\n *\n * @param {*} value Value to test.\n *\n * @return {boolean} Whether value is object-like.\n */\nfunction isObjectLike(value) {\n\treturn !!value && 'object' === typeof value;\n}\n\n/**\n * Creates and returns a new cache object.\n *\n * @return {Cache} Cache object.\n */\nfunction createCache() {\n\t/** @type {Cache} */\n\tvar cache = {\n\t\tclear: function () {\n\t\t\tcache.head = null;\n\t\t},\n\t};\n\n\treturn cache;\n}\n\n/**\n * Returns true if entries within the two arrays are strictly equal by\n * reference from a starting index.\n *\n * @param {*[]} a First array.\n * @param {*[]} b Second array.\n * @param {number} fromIndex Index from which to start comparison.\n *\n * @return {boolean} Whether arrays are shallowly equal.\n */\nfunction isShallowEqual(a, b, fromIndex) {\n\tvar i;\n\n\tif (a.length !== b.length) {\n\t\treturn false;\n\t}\n\n\tfor (i = fromIndex; i < a.length; i++) {\n\t\tif (a[i] !== b[i]) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\n/**\n * Returns a memoized selector function. The getDependants function argument is\n * called before the memoized selector and is expected to return an immutable\n * reference or array of references on which the selector depends for computing\n * its own return value. The memoize cache is preserved only as long as those\n * dependant references remain the same. If getDependants returns a different\n * reference(s), the cache is cleared and the selector value regenerated.\n *\n * @template {(...args: *[]) => *} S\n *\n * @param {S} selector Selector function.\n * @param {GetDependants=} getDependants Dependant getter returning an array of\n * references used in cache bust consideration.\n */\nexport default function (selector, getDependants) {\n\t/** @type {WeakMap<*,*>} */\n\tvar rootCache;\n\n\t/** @type {GetDependants} */\n\tvar normalizedGetDependants = getDependants ? getDependants : arrayOf;\n\n\t/**\n\t * Returns the cache for a given dependants array. When possible, a WeakMap\n\t * will be used to create a unique cache for each set of dependants. This\n\t * is feasible due to the nature of WeakMap in allowing garbage collection\n\t * to occur on entries where the key object is no longer referenced. Since\n\t * WeakMap requires the key to be an object, this is only possible when the\n\t * dependant is object-like. The root cache is created as a hierarchy where\n\t * each top-level key is the first entry in a dependants set, the value a\n\t * WeakMap where each key is the next dependant, and so on. This continues\n\t * so long as the dependants are object-like. If no dependants are object-\n\t * like, then the cache is shared across all invocations.\n\t *\n\t * @see isObjectLike\n\t *\n\t * @param {*[]} dependants Selector dependants.\n\t *\n\t * @return {Cache} Cache object.\n\t */\n\tfunction getCache(dependants) {\n\t\tvar caches = rootCache,\n\t\t\tisUniqueByDependants = true,\n\t\t\ti,\n\t\t\tdependant,\n\t\t\tmap,\n\t\t\tcache;\n\n\t\tfor (i = 0; i < dependants.length; i++) {\n\t\t\tdependant = dependants[i];\n\n\t\t\t// Can only compose WeakMap from object-like key.\n\t\t\tif (!isObjectLike(dependant)) {\n\t\t\t\tisUniqueByDependants = false;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// Does current segment of cache already have a WeakMap?\n\t\t\tif (caches.has(dependant)) {\n\t\t\t\t// Traverse into nested WeakMap.\n\t\t\t\tcaches = caches.get(dependant);\n\t\t\t} else {\n\t\t\t\t// Create, set, and traverse into a new one.\n\t\t\t\tmap = new WeakMap();\n\t\t\t\tcaches.set(dependant, map);\n\t\t\t\tcaches = map;\n\t\t\t}\n\t\t}\n\n\t\t// We use an arbitrary (but consistent) object as key for the last item\n\t\t// in the WeakMap to serve as our running cache.\n\t\tif (!caches.has(LEAF_KEY)) {\n\t\t\tcache = createCache();\n\t\t\tcache.isUniqueByDependants = isUniqueByDependants;\n\t\t\tcaches.set(LEAF_KEY, cache);\n\t\t}\n\n\t\treturn caches.get(LEAF_KEY);\n\t}\n\n\t/**\n\t * Resets root memoization cache.\n\t */\n\tfunction clear() {\n\t\trootCache = new WeakMap();\n\t}\n\n\t/* eslint-disable jsdoc/check-param-names */\n\t/**\n\t * The augmented selector call, considering first whether dependants have\n\t * changed before passing it to underlying memoize function.\n\t *\n\t * @param {*}    source    Source object for derivation.\n\t * @param {...*} extraArgs Additional arguments to pass to selector.\n\t *\n\t * @return {*} Selector result.\n\t */\n\t/* eslint-enable jsdoc/check-param-names */\n\tfunction callSelector(/* source, ...extraArgs */) {\n\t\tvar len = arguments.length,\n\t\t\tcache,\n\t\t\tnode,\n\t\t\ti,\n\t\t\targs,\n\t\t\tdependants;\n\n\t\t// Create copy of arguments (avoid leaking deoptimization).\n\t\targs = new Array(len);\n\t\tfor (i = 0; i < len; i++) {\n\t\t\targs[i] = arguments[i];\n\t\t}\n\n\t\tdependants = normalizedGetDependants.apply(null, args);\n\t\tcache = getCache(dependants);\n\n\t\t// If not guaranteed uniqueness by dependants (primitive type), shallow\n\t\t// compare against last dependants and, if references have changed,\n\t\t// destroy cache to recalculate result.\n\t\tif (!cache.isUniqueByDependants) {\n\t\t\tif (\n\t\t\t\tcache.lastDependants &&\n\t\t\t\t!isShallowEqual(dependants, cache.lastDependants, 0)\n\t\t\t) {\n\t\t\t\tcache.clear();\n\t\t\t}\n\n\t\t\tcache.lastDependants = dependants;\n\t\t}\n\n\t\tnode = cache.head;\n\t\twhile (node) {\n\t\t\t// Check whether node arguments match arguments\n\t\t\tif (!isShallowEqual(node.args, args, 1)) {\n\t\t\t\tnode = node.next;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// At this point we can assume we've found a match\n\n\t\t\t// Surface matched node to head if not already\n\t\t\tif (node !== cache.head) {\n\t\t\t\t// Adjust siblings to point to each other.\n\t\t\t\t/** @type {CacheNode} */ (node.prev).next = node.next;\n\t\t\t\tif (node.next) {\n\t\t\t\t\tnode.next.prev = node.prev;\n\t\t\t\t}\n\n\t\t\t\tnode.next = cache.head;\n\t\t\t\tnode.prev = null;\n\t\t\t\t/** @type {CacheNode} */ (cache.head).prev = node;\n\t\t\t\tcache.head = node;\n\t\t\t}\n\n\t\t\t// Return immediately\n\t\t\treturn node.val;\n\t\t}\n\n\t\t// No cached value found. Continue to insertion phase:\n\n\t\tnode = /** @type {CacheNode} */ ({\n\t\t\t// Generate the result from original function\n\t\t\tval: selector.apply(null, args),\n\t\t});\n\n\t\t// Avoid including the source object in the cache.\n\t\targs[0] = null;\n\t\tnode.args = args;\n\n\t\t// Don't need to check whether node is already head, since it would\n\t\t// have been returned above already if it was\n\n\t\t// Shift existing head down list\n\t\tif (cache.head) {\n\t\t\tcache.head.prev = node;\n\t\t\tnode.next = cache.head;\n\t\t}\n\n\t\tcache.head = node;\n\n\t\treturn node.val;\n\t}\n\n\tcallSelector.getDependants = normalizedGetDependants;\n\tcallSelector.clear = clear;\n\tclear();\n\n\treturn /** @type {S & EnhancedSelector} */ (callSelector);\n}\n","// Borrowed from https://github.com/Automattic/jetpack/blob/trunk/projects/js-packages/shared-extension-utils/src/site-type-utils.js\n\n/**\n * Get the site type from environment\n *\n * @return {(string|null)} Site type\n */\nfunction getSiteType() {\n\treturn 'object' === typeof window &&\n\t\ttypeof window._currentSiteType === 'string'\n\t\t? window._currentSiteType\n\t\t: null;\n}\n\n/**\n * Check if environment is Simple site.\n *\n * @return {boolean} True for Simple sites.\n */\nexport function isSimpleSite() {\n\treturn getSiteType() === 'simple';\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"apiFetch\"];","import debugFactory from 'debug';\n\nconst debug = debugFactory( 'dops:analytics' );\nlet _superProps, _user;\n\n// Load tracking scripts\nwindow._tkq = window._tkq || [];\nwindow.ga =\n\twindow.ga ||\n\tfunction () {\n\t\t( window.ga.q = window.ga.q || [] ).push( arguments );\n\t};\nwindow.ga.l = +new Date();\n\n// loadScript( '//stats.wp.com/w.js?48' );\n// loadScript( '//www.google-analytics.com/analytics.js' );\n\n/**\n * Build a query string\n *\n * @param {string} group - the group\n * @param {string} name - the name\n * @returns {string} - the uricomponent\n */\nfunction buildQuerystring( group, name ) {\n\tlet uriComponent = '';\n\n\tif ( 'object' === typeof group ) {\n\t\tfor ( const key in group ) {\n\t\t\turiComponent += '&x_' + encodeURIComponent( key ) + '=' + encodeURIComponent( group[ key ] );\n\t\t}\n\t\tdebug( 'Bumping stats %o', group );\n\t} else {\n\t\turiComponent = '&x_' + encodeURIComponent( group ) + '=' + encodeURIComponent( name );\n\t\tdebug( 'Bumping stat \"%s\" in group \"%s\"', name, group );\n\t}\n\n\treturn uriComponent;\n}\n\n/**\n * Build a query string with no prefix\n *\n * @param {string} group - the group\n * @param {string} name - the name\n * @returns {string} - the uricomponent\n */\nfunction buildQuerystringNoPrefix( group, name ) {\n\tlet uriComponent = '';\n\n\tif ( 'object' === typeof group ) {\n\t\tfor ( const key in group ) {\n\t\t\turiComponent += '&' + encodeURIComponent( key ) + '=' + encodeURIComponent( group[ key ] );\n\t\t}\n\t\tdebug( 'Built stats %o', group );\n\t} else {\n\t\turiComponent = '&' + encodeURIComponent( group ) + '=' + encodeURIComponent( name );\n\t\tdebug( 'Built stat \"%s\" in group \"%s\"', name, group );\n\t}\n\n\treturn uriComponent;\n}\n\nconst analytics = {\n\tinitialize: function ( userId, username, superProps ) {\n\t\tanalytics.setUser( userId, username );\n\t\tanalytics.setSuperProps( superProps );\n\t\tanalytics.identifyUser();\n\t},\n\n\tsetGoogleAnalyticsEnabled: function ( googleAnalyticsEnabled, googleAnalyticsKey = null ) {\n\t\tthis.googleAnalyticsEnabled = googleAnalyticsEnabled;\n\t\tthis.googleAnalyticsKey = googleAnalyticsKey;\n\t},\n\n\tsetMcAnalyticsEnabled: function ( mcAnalyticsEnabled ) {\n\t\tthis.mcAnalyticsEnabled = mcAnalyticsEnabled;\n\t},\n\n\tsetUser: function ( userId, username ) {\n\t\t_user = { ID: userId, username: username };\n\t},\n\n\tsetSuperProps: function ( superProps ) {\n\t\t_superProps = superProps;\n\t},\n\n\t/**\n\t * Add global properties to be applied to all \"tracks\" events.\n\t * This function will add the new properties, overwrite the existing one.\n\t * Unlike `setSuperProps()`, it will not replace the whole object.\n\t *\n\t * @param {object} props - Super props to add.\n\t */\n\tassignSuperProps: function ( props ) {\n\t\t_superProps = Object.assign( _superProps || {}, props );\n\t},\n\n\tmc: {\n\t\tbumpStat: function ( group, name ) {\n\t\t\tconst uriComponent = buildQuerystring( group, name ); // prints debug info\n\t\t\tif ( analytics.mcAnalyticsEnabled ) {\n\t\t\t\tnew Image().src =\n\t\t\t\t\tdocument.location.protocol +\n\t\t\t\t\t'//pixel.wp.com/g.gif?v=wpcom-no-pv' +\n\t\t\t\t\turiComponent +\n\t\t\t\t\t'&t=' +\n\t\t\t\t\tMath.random();\n\t\t\t}\n\t\t},\n\n\t\tbumpStatWithPageView: function ( group, name ) {\n\t\t\t// this function is fairly dangerous, as it bumps page views for wpcom and should only be called in very specific cases.\n\t\t\tconst uriComponent = buildQuerystringNoPrefix( group, name ); // prints debug info\n\t\t\tif ( analytics.mcAnalyticsEnabled ) {\n\t\t\t\tnew Image().src =\n\t\t\t\t\tdocument.location.protocol +\n\t\t\t\t\t'//pixel.wp.com/g.gif?v=wpcom' +\n\t\t\t\t\turiComponent +\n\t\t\t\t\t'&t=' +\n\t\t\t\t\tMath.random();\n\t\t\t}\n\t\t},\n\t},\n\n\t// pageView is a wrapper for pageview events across Tracks and GA\n\tpageView: {\n\t\trecord: function ( urlPath, pageTitle ) {\n\t\t\tanalytics.tracks.recordPageView( urlPath );\n\t\t\tanalytics.ga.recordPageView( urlPath, pageTitle );\n\t\t},\n\t},\n\n\tpurchase: {\n\t\trecord: function ( transactionId, itemName, itemId, revenue, price, qty, currency ) {\n\t\t\tanalytics.ga.recordPurchase( transactionId, itemName, itemId, revenue, price, qty, currency );\n\t\t},\n\t},\n\n\ttracks: {\n\t\trecordEvent: function ( eventName, eventProperties ) {\n\t\t\teventProperties = eventProperties || {};\n\n\t\t\tif ( eventName.indexOf( 'akismet_' ) !== 0 && eventName.indexOf( 'jetpack_' ) !== 0 ) {\n\t\t\t\tdebug( '- Event name must be prefixed by \"akismet_\" or \"jetpack_\"' );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( _superProps ) {\n\t\t\t\tdebug( '- Super Props: %o', _superProps );\n\t\t\t\teventProperties = Object.assign( eventProperties, _superProps );\n\t\t\t}\n\t\t\tdebug(\n\t\t\t\t'Record event \"%s\" called with props %s',\n\t\t\t\teventName,\n\t\t\t\tJSON.stringify( eventProperties )\n\t\t\t);\n\n\t\t\twindow._tkq.push( [ 'recordEvent', eventName, eventProperties ] );\n\t\t},\n\n\t\trecordJetpackClick: function ( target ) {\n\t\t\tconst props = 'object' === typeof target ? target : { target: target };\n\n\t\t\tanalytics.tracks.recordEvent( 'jetpack_wpa_click', props );\n\t\t},\n\n\t\trecordPageView: function ( urlPath ) {\n\t\t\tanalytics.tracks.recordEvent( 'akismet_page_view', {\n\t\t\t\tpath: urlPath,\n\t\t\t} );\n\t\t},\n\n\t\tsetOptOut: function ( isOptingOut ) {\n\t\t\tdebug( 'Pushing setOptOut: %o', isOptingOut );\n\t\t\twindow._tkq.push( [ 'setOptOut', isOptingOut ] );\n\t\t},\n\t},\n\n\t// Google Analytics usage and event stat tracking\n\tga: {\n\t\tinitialized: false,\n\n\t\tinitialize: function () {\n\t\t\tlet parameters = {};\n\t\t\tif ( ! analytics.ga.initialized ) {\n\t\t\t\tif ( _user ) {\n\t\t\t\t\tparameters = {\n\t\t\t\t\t\tuserId: 'u-' + _user.ID,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\twindow.ga( 'create', this.googleAnalyticsKey, 'auto', parameters );\n\t\t\t\tanalytics.ga.initialized = true;\n\t\t\t}\n\t\t},\n\n\t\trecordPageView: function ( urlPath, pageTitle ) {\n\t\t\tanalytics.ga.initialize();\n\n\t\t\tdebug( 'Recording Page View ~ [URL: ' + urlPath + '] [Title: ' + pageTitle + ']' );\n\n\t\t\tif ( this.googleAnalyticsEnabled ) {\n\t\t\t\t// Set the current page so all GA events are attached to it.\n\t\t\t\twindow.ga( 'set', 'page', urlPath );\n\n\t\t\t\twindow.ga( 'send', {\n\t\t\t\t\thitType: 'pageview',\n\t\t\t\t\tpage: urlPath,\n\t\t\t\t\ttitle: pageTitle,\n\t\t\t\t} );\n\t\t\t}\n\t\t},\n\n\t\trecordEvent: function ( category, action, label, value ) {\n\t\t\tanalytics.ga.initialize();\n\n\t\t\tlet debugText = 'Recording Event ~ [Category: ' + category + '] [Action: ' + action + ']';\n\n\t\t\tif ( 'undefined' !== typeof label ) {\n\t\t\t\tdebugText += ' [Option Label: ' + label + ']';\n\t\t\t}\n\n\t\t\tif ( 'undefined' !== typeof value ) {\n\t\t\t\tdebugText += ' [Option Value: ' + value + ']';\n\t\t\t}\n\n\t\t\tdebug( debugText );\n\n\t\t\tif ( this.googleAnalyticsEnabled ) {\n\t\t\t\twindow.ga( 'send', 'event', category, action, label, value );\n\t\t\t}\n\t\t},\n\n\t\trecordPurchase: function ( transactionId, itemName, itemId, revenue, price, qty, currency ) {\n\t\t\twindow.ga( 'require', 'ecommerce' );\n\t\t\twindow.ga( 'ecommerce:addTransaction', {\n\t\t\t\tid: transactionId, // Transaction ID. Required.\n\t\t\t\t// 'affiliation': 'Acme Clothing',   // Affiliation or store name.\n\t\t\t\trevenue: revenue, // Grand Total.\n\t\t\t\t// 'tax': '1.29',                     // Tax.\n\t\t\t\tcurrency: currency, // local currency code.\n\t\t\t} );\n\t\t\twindow.ga( 'ecommerce:addItem', {\n\t\t\t\tid: transactionId, // Transaction ID. Required.\n\t\t\t\tname: itemName, // Product name. Required.\n\t\t\t\tsku: itemId, // SKU/code.\n\t\t\t\t// 'category': 'Party Toys',         // Category or variation.\n\t\t\t\tprice: price, // Unit price.\n\t\t\t\tquantity: qty, // Quantity.\n\t\t\t} );\n\t\t\twindow.ga( 'ecommerce:send' );\n\t\t},\n\t},\n\n\tidentifyUser: function () {\n\t\t// Don't identify the user if we don't have one\n\t\tif ( _user ) {\n\t\t\twindow._tkq.push( [ 'identifyUser', _user.ID, _user.username ] );\n\t\t}\n\t},\n\n\tsetProperties: function ( properties ) {\n\t\twindow._tkq.push( [ 'setProperties', properties ] );\n\t},\n\n\tclearedIdentity: function () {\n\t\twindow._tkq.push( [ 'clearIdentity' ] );\n\t},\n};\n\nexport default analytics;\n","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"coreData\"];","/**\n * External dependencies\n */\nimport analytics from '@automattic/jetpack-analytics';\n\n/**\n * Internal dependencies\n */\nimport { store as aiStore } from '@store';\n\n/**\n * WordPress dependencies\n */\nimport { select } from '@wordpress/data';\nimport { store as editorStore } from '@wordpress/editor';\nimport { store as coreStore } from '@wordpress/core-data';\n\nconst tracks_prefix = 'jetpack_big_sky';\nconst validNameRegex = /^[a-z_][a-z0-9_]*$/;\n\n/**\n * Validates that a name matches the required pattern\n * @param {string} name - The name to validate\n * @param {string} type - The type of name being validated ('Event' or 'Property')\n */\nfunction validateName( name, type ) {\n\tif ( ! validNameRegex.test( name ) ) {\n\t\tconsole.error(\n\t\t\t`${ type } names must match pattern: ^[a-z_][a-z0-9_]*$`\n\t\t);\n\t}\n}\n\n/**\n * Validates that all property names match the required pattern\n * @param {Object} properties - The properties object to validate\n */\nfunction validateProperties( properties ) {\n\tObject.keys( properties ).forEach( ( key ) => {\n\t\tvalidateName( key, 'Property' );\n\t} );\n}\n\n/**\n * Get the current session ID from the Redux store.\n * We load this directly to avoid needing to pass it every time when recording an event.\n * Since we have a stable session ID per page load, we can just grab it from the store.\n * Additionally, there is no reactivity needed for this value in this context.\n */\nfunction getCurrentSessionId() {\n\tconst store = aiStore.instantiate().store;\n\tconst state = store.getState();\n\treturn state.sessionId;\n}\n\n/**\n * Get the current phase of Big Sky based on store state\n * @return {string} The current phase ('handoff', 'onboarding', or 'editor')\n */\nfunction getPhase() {\n\tconst state = select( aiStore );\n\n\tif ( state.getIsHandoff() ) {\n\t\treturn 'handoff';\n\t} else if ( ! state.getSiteMetadata()?.isOnboarded ) {\n\t\treturn 'onboarding';\n\t}\n\treturn 'editor';\n}\n\nexport function getIsDevMode() {\n\tconst aiState = select( aiStore );\n\treturn aiState?.getIsDevMode() || false;\n}\n\n/**\n * Record an action a user takes and send to Tracks.\n *\n * @param {string} action     - The action name to record via Tracks.\n * @param {Object} properties - Additional optional properties to send with the action.\n */\nexport function recordUserActionTracks( action, properties = {} ) {\n\tvalidateName( action, 'Action' );\n\n\tconst combinedProperties = {\n\t\t...properties,\n\t\taction,\n\t\tsessionid: getCurrentSessionId(),\n\t\tphase: getPhase(),\n\t\tis_test: getIsDevMode(),\n\t};\n\n\tvalidateProperties( properties );\n\n\tanalytics.tracks.recordEvent( `${ tracks_prefix }_action`, {\n\t\t...combinedProperties,\n\t} );\n}\n\n/**\n * Get current page properties\n */\nfunction getCurrentPageProperties() {\n\tconst homePageId = select( coreStore ).getEntityRecord(\n\t\t'root',\n\t\t'site'\n\t)?.page_on_front;\n\tconst currentPostId = select( editorStore ).getCurrentPostId();\n\tconst isHomePage = currentPostId === homePageId;\n\n\treturn {\n\t\tpost_id: currentPostId,\n\t\ttitle: select( editorStore ).getEditedPostAttribute( 'title' ),\n\t\tis_home_page: isHomePage,\n\t};\n}\n\n/**\n * Record a generic Big Sky Event and send to Tracks(funnel tracking, etc.)\n *\n * @param {*} event      - The event name to record via Tracks.\n * @param {*} properties - Additional optional properties to send with the event.\n */\nexport function recordTracksEvent( event, properties = {} ) {\n\tvalidateName( event, 'Event' );\n\n\tconst combinedProperties = {\n\t\t...properties,\n\t\t...getCurrentPageProperties(),\n\t\tsessionid: getCurrentSessionId(),\n\t\tphase: getPhase(),\n\t\tis_test: getIsDevMode(),\n\t};\n\n\tvalidateProperties( combinedProperties );\n\n\tanalytics.tracks.recordEvent( `${ tracks_prefix }_${ event }`, {\n\t\t...combinedProperties,\n\t} );\n}\n","/**\n * WordPress dependencies\n */\nimport apiFetch from '@wordpress/api-fetch';\n\n/**\n * Internal dependencies\n */\nimport log from '@utils/log-debug.js';\nimport { getIsDevMode } from '@utils/tracks.js';\n\nexport default async function logAction(\n\tsession_id,\n\tcontent,\n\tmessage_role = '',\n\tmessage_id = '',\n\tparent_message_id = '',\n\tattempt = 0\n) {\n\tif ( ! session_id ) {\n\t\treturn;\n\t}\n\n\tconst data = {\n\t\tcontent,\n\t\tmessage_type: message_role,\n\t\tmessage_id,\n\t\tparent_message_id,\n\t\tis_test: getIsDevMode(),\n\t};\n\n\ttry {\n\t\treturn await apiFetch( {\n\t\t\tpath:\n\t\t\t\t'/wpcom/v2/big-sky/v1/session/' +\n\t\t\t\tencodeURIComponent( session_id ) +\n\t\t\t\t'/action',\n\t\t\tmethod: 'POST',\n\t\t\tdata,\n\t\t} );\n\t} catch ( error ) {\n\t\tlog.errorBreakLoop( attempt, 'Error logging action: ', error );\n\t}\n}\n","/**\n * External dependencies\n */\nimport { select } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport logAction from '@utils/log-action';\nimport { store as aiStore } from '@store';\nimport { messageRoles } from '@utils/constants';\n\nconst showLogs =\n\t( typeof window !== 'undefined' &&\n\t\twindow?.bigSkyInitialState?.isDevMode ) ||\n\tfalse;\n\nfunction addToPayload( content, arg, separator = ' ' ) {\n\treturn content && content.length > 0 ? content + separator + arg : arg;\n}\n\nconst logger = {\n\tinfo: showLogs ? console.info.bind( window.console ) : () => {},\n\twarn: showLogs ? console.warn.bind( window.console ) : () => {},\n\t_actionFromError( ...args ) {\n\t\tconst sessionId = select( aiStore ).getSessionId();\n\t\tlet errorMessage;\n\t\tif ( sessionId ) {\n\t\t\terrorMessage = args.reduce(\n\t\t\t\t( payload, arg ) => {\n\t\t\t\t\tif ( typeof arg === 'string' ) {\n\t\t\t\t\t\tpayload.content = addToPayload( payload.content, arg );\n\t\t\t\t\t} else if ( arg instanceof Error ) {\n\t\t\t\t\t\tpayload.content = addToPayload(\n\t\t\t\t\t\t\tpayload.content,\n\t\t\t\t\t\t\t`${ arg?.name }: ${ arg?.message }`\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif ( arg?.stack ) {\n\t\t\t\t\t\t\tpayload.trace = addToPayload(\n\t\t\t\t\t\t\t\tpayload.trace,\n\t\t\t\t\t\t\t\targ?.stack\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if ( arg instanceof Response ) {\n\t\t\t\t\t\tpayload.content = addToPayload(\n\t\t\t\t\t\t\tpayload.content,\n\t\t\t\t\t\t\t`Response: ${ arg?.url } ${ arg?.status } ${ arg?.statusText }`,\n\t\t\t\t\t\t\t`\\n\\n`\n\t\t\t\t\t\t);\n\t\t\t\t\t} else if (\n\t\t\t\t\t\ttypeof arg === 'object' &&\n\t\t\t\t\t\t! Array.isArray( arg )\n\t\t\t\t\t) {\n\t\t\t\t\t\tObject.entries( arg ).forEach( ( [ key, value ] ) => {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tif ( typeof value !== 'string' ) {\n\t\t\t\t\t\t\t\t\tvalue = JSON.stringify( value );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tpayload[ key ] = value;\n\t\t\t\t\t\t\t} catch ( e ) {\n\t\t\t\t\t\t\t\t// Do nothing\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tpayload.extra = addToPayload(\n\t\t\t\t\t\t\t\tpayload.extra,\n\t\t\t\t\t\t\t\tJSON.stringify( arg )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} catch ( e ) {\n\t\t\t\t\t\t\t// Do nothing\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn payload;\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcontent: '',\n\t\t\t\t\ttrace: '',\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn [ sessionId, errorMessage ];\n\t},\n\terror( ...args ) {\n\t\tconst [ sessionId, errorMessage ] = logger._actionFromError( ...args );\n\t\tif ( errorMessage ) {\n\t\t\tlogAction( sessionId, errorMessage, messageRoles.ERROR );\n\t\t}\n\n\t\tconsole.error.call( window.console, ...args );\n\t},\n\t// attemptFailedNumber: which attempt just failed. 0-indexed.\n\terrorBreakLoop( attemptFailedNumber, ...args ) {\n\t\tif ( attemptFailedNumber > 1 ) {\n\t\t\t// This is the third try:\n\t\t\t// 0. from error()->logAction\n\t\t\t// 1. from this function's first call\n\t\t\t// 2. right now\n\t\t\tconsole.error.call( window.console, '[LOOP!]', ...args );\n\t\t\treturn;\n\t\t}\n\n\t\tconst [ sessionId, errorMessage ] = logger._actionFromError( ...args );\n\t\tif ( errorMessage ) {\n\t\t\tlogAction(\n\t\t\t\tsessionId,\n\t\t\t\terrorMessage,\n\t\t\t\tmessageRoles.ERROR,\n\t\t\t\t'',\n\t\t\t\t'',\n\t\t\t\tattemptFailedNumber + 1\n\t\t\t);\n\t\t}\n\n\t\tconsole.error.call( window.console, '[LOOP?]', ...args );\n\t},\n};\n\nexport default logger;\n","/**\n * Internal dependencies\n */\nimport { isSimpleSite } from './site-type';\n\n/**\n * WordPress dependencies\n */\nimport apiFetch from '@wordpress/api-fetch';\n\nimport log from '@utils/log-debug.js';\n\nexport const JWT_TOKEN_ID = 'jetpack-ai-jwt-token';\nexport const JWT_TOKEN_EXPIRATION_TIME = 30 * 60 * 1000;\n\ndeclare global {\n\tinterface Window {\n\t\tJP_CONNECTION_INITIAL_STATE: {\n\t\t\tapiNonce: string;\n\t\t\tsiteSuffix: string;\n\t\t\tconnectionStatus: { isActive: boolean };\n\t\t};\n\t\tJetpack_Editor_Initial_State: {\n\t\t\twpcomBlogId: string;\n\t\t};\n\t}\n}\n\nexport const fetchJetpackToken = async ( setApiKey, useCachedToken = true ) => {\n\tconst newTokenData = await requestJetpackToken( useCachedToken );\n\tif ( newTokenData && newTokenData.token ) {\n\t\tsetApiKey( newTokenData.token );\n\t}\n};\n\n/**\n * Request a token from the Jetpack site to use with the API\n *\n * This file is used to request a token from the Jetpack site to use with the API\n * This is a copy of https://github.com/woocommerce/woocommerce/blob/trunk/packages/js/ai/src/utils/requestJetpackToken.ts\n * Which is a copy of https://github.com/Automattic/jetpack/blob/2f10669cb673eb3e73b6f0001158e8ab62e4a6bc/projects/js-packages/ai-client/src/jwt/index.ts\n *\n * WooCommerce package cannot be used, because it was never published.\n * Jetpack package is published but its throwing errors if imported anywhere except in Jetpack.\n *\n * If you are going to copy this to your project, godspeed.\n *\n * @return {Promise<{token: string, blogId: string}>} The token and the blogId\n */\n\nexport async function requestJetpackToken( useCachedToken = true ) {\n\tconst token = localStorage.getItem( JWT_TOKEN_ID );\n\tlet tokenData;\n\n\tif ( token ) {\n\t\ttokenData = JSON.parse( token );\n\t}\n\n\tif (\n\t\ttokenData &&\n\t\ttokenData?.token &&\n\t\ttokenData?.expire &&\n\t\ttokenData?.expire > Date.now() &&\n\t\tuseCachedToken\n\t) {\n\t\t// log.info( 'Using cached token', useCachedToken );\n\t\treturn tokenData;\n\t}\n\n\tconst apiNonce = window.JP_CONNECTION_INITIAL_STATE?.apiNonce;\n\tconst siteId = window.Jetpack_Editor_Initial_State?.wpcomBlogId;\n\n\tlet data = {\n\t\ttoken: '',\n\t\tblog_id: '',\n\t};\n\n\ttry {\n\t\tif ( ! isSimpleSite() ) {\n\t\t\tdata = await apiFetch( {\n\t\t\t\tpath: '/jetpack/v4/jetpack-ai-jwt?_cacheBuster=' + Date.now(),\n\t\t\t\tcredentials: 'same-origin',\n\t\t\t\theaders: {\n\t\t\t\t\t'X-WP-Nonce': apiNonce,\n\t\t\t\t},\n\t\t\t\tmethod: 'POST',\n\t\t\t} );\n\t\t} else {\n\t\t\tdata = await apiFetch( {\n\t\t\t\tpath: '/wpcom/v2/sites/' + siteId + '/jetpack-openai-query/jwt',\n\t\t\t\tmethod: 'POST',\n\t\t\t} );\n\t\t}\n\t} catch ( error ) {\n\t\tlog.error( 'Failed to fetch Jetpack token:', error );\n\t}\n\n\tconst newTokenData = {\n\t\ttoken: data.token,\n\t\tblogId: data.blog_id,\n\n\t\t/**\n\t\t * Let's expire the token in 30 minutes\n\t\t */\n\t\texpire: Date.now() + JWT_TOKEN_EXPIRATION_TIME,\n\t};\n\n\tlog.info( 'Storing new token' );\n\tlocalStorage.setItem( JWT_TOKEN_ID, JSON.stringify( newTokenData ) );\n\n\treturn newTokenData;\n}\n","/**\n * External dependencies\n */\nimport {\n\tLocalGraphChatModel,\n\tWPCOMJetpackAIChatModel,\n} from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport { requestJetpackToken } from '@utils/request-jetpack-token.ts';\nimport log from '@utils/log-debug.js';\n\nlet currentChatMessageModel = null;\n\nexport const runChatCompletion =\n\t(\n\t\tmodel,\n\t\tmessages = [],\n\t\ttools,\n\t\ttemperature = 0.1,\n\t\tresponse_format = 'text',\n\t\tretry = false\n\t) =>\n\tasync ( { select, dispatch } ) => {\n\t\tconst jetpackToken = await requestJetpackToken( ! retry );\n\t\tif ( ! jetpackToken ) {\n\t\t\treturn;\n\t\t}\n\t\tconst params = {\n\t\t\tmodel,\n\t\t\tmessages,\n\t\t\tstream: false,\n\t\t\ttemperature,\n\t\t\tsession_id: select.getSessionId(),\n\t\t};\n\n\t\tif ( tools ) {\n\t\t\tparams.tools = tools;\n\t\t}\n\n\t\tif ( response_format ) {\n\t\t\tparams.response_format = response_format;\n\t\t}\n\n\t\tconst isLocalGraph = window.bigSkyInitialState?.isLocalGraph;\n\n\t\tconst ChatModelClass = isLocalGraph\n\t\t\t? LocalGraphChatModel\n\t\t\t: WPCOMJetpackAIChatModel;\n\t\tconst chatModel = new ChatModelClass( {\n\t\t\tapiKey: jetpackToken.token,\n\t\t\tfeature: 'big-sky',\n\t\t\tsessionId: select.getSessionId(),\n\t\t} );\n\n\t\tcurrentChatMessageModel = chatModel;\n\n\t\ttry {\n\t\t\tconst response = await chatModel.call( params );\n\t\t\tdispatch.logOpenAIUsage( model, response.usage );\n\n\t\t\treturn response;\n\t\t} catch ( e ) {\n\t\t\tif ( e.name === 'AbortError' ) {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t\t// retry once with a new token\n\t\t\tif ( ! retry ) {\n\t\t\t\treturn dispatch.runChatCompletion(\n\t\t\t\t\tmodel,\n\t\t\t\t\tmessages,\n\t\t\t\t\ttools,\n\t\t\t\t\ttemperature,\n\t\t\t\t\tresponse_format,\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tlog.error( 'OpenAI error', e );\n\t\t\treturn null;\n\t\t}\n\t};\n\nexport const generateImage =\n\t( {\n\t\tmodel,\n\t\tprompt,\n\t\tn = 1,\n\t\tsize,\n\t\tresponse_format = 'url',\n\t\timage_format = 'PNG',\n\t\tretry = false,\n\t} ) =>\n\tasync ( { select, dispatch } ) => {\n\t\ttry {\n\t\t\tconst jetpackToken = await requestJetpackToken( ! retry );\n\t\t\tif ( ! jetpackToken ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst imageGenerationUrl =\n\t\t\t\t'https://public-api.wordpress.com/wpcom/v2/jetpack-ai-image';\n\n\t\t\tconst params = {\n\t\t\t\tmodel,\n\t\t\t\tprompt,\n\t\t\t\tn,\n\t\t\t\tsize,\n\t\t\t\tresponse_format,\n\t\t\t\tremove_background: true,\n\t\t\t\timage_format,\n\t\t\t\tfeature: 'big-sky',\n\t\t\t\tsession_id: select.getSessionId(),\n\t\t\t};\n\t\t\tconst request = await fetch( imageGenerationUrl, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${ jetpackToken.token }`,\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify( params ),\n\t\t\t} );\n\n\t\t\tif ( request.status >= 300 ) {\n\t\t\t\t// retry once with a new token\n\t\t\t\tif ( ! retry ) {\n\t\t\t\t\treturn dispatch.generateImage( {\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\tprompt,\n\t\t\t\t\t\tn,\n\t\t\t\t\t\tsize,\n\t\t\t\t\t\tresponse_format,\n\t\t\t\t\t\timage_format,\n\t\t\t\t\t\tretry: true,\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\tlog.error( 'Error calling Image Generation API: ', response );\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tconst response = await request.json();\n\n\t\t\tdispatch.logOpenAIUsage( model, response.usage );\n\t\t\treturn response;\n\t\t} catch ( e ) {\n\t\t\t// retry once with a new token\n\t\t\tif ( ! retry ) {\n\t\t\t\treturn dispatch.generateImage( {\n\t\t\t\t\tmodel,\n\t\t\t\t\tprompt,\n\t\t\t\t\tn,\n\t\t\t\t\tsize,\n\t\t\t\t\tresponse_format,\n\t\t\t\t\timage_format,\n\t\t\t\t\tretry: true,\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tlog.error( 'OpenAI error', e );\n\t\t\treturn null;\n\t\t}\n\t};\n\nexport const getCurrentChatMessageModel = () => currentChatMessageModel;\n\nexport function logOpenAIUsage( model, usage ) {\n\treturn {\n\t\ttype: 'LOG_OPENAI_USAGE',\n\t\tpayload: {\n\t\t\tmodel,\n\t\t\tusage,\n\t\t},\n\t};\n}\n","const patterns = [\n\t{\n\t\ttitle: 'Headers',\n\t\tdescription:\n\t\t\t\"The header section is typically located at the top of a website and contains essential information such as the brand's name, logo, navigation menu, and sometimes search functionality.\",\n\t\tslug: 'header',\n\t},\n\t{\n\t\ttitle: 'Introduction',\n\t\tdescription:\n\t\t\t\"Introduction sections are large, prominent areas at the top of a website that showcase key messages, images, or videos. They are designed to capture visitors' attention and encourage them to explore further.\",\n\t\tslug: 'intro',\n\t},\n\t{\n\t\ttitle: 'About',\n\t\tdescription:\n\t\t\t'Informational sections provide details about a company, product, or service. They often mostly include text, to educate visitors and answer common questions.',\n\t\tslug: 'about',\n\t},\n\t{\n\t\ttitle: 'Testimonials',\n\t\tdescription:\n\t\t\t'Testimonials are statements from satisfied customers, clients, or users that highlight the benefits of a product or service.',\n\t\tslug: 'testimonials',\n\t},\n\t{\n\t\ttitle: 'Pricing Tiers',\n\t\tdescription:\n\t\t\t'Pricing tiers are used to display various pricing plans or options for products or services. They help customers compare features and costs, making it easier to choose the right plan for their needs.',\n\t\tslug: 'pricing',\n\t},\n\t{\n\t\ttitle: 'Services Offered',\n\t\tdescription:\n\t\t\t'Service offerings list the various services provided by a business, such as consulting, coaching, or training.',\n\t\tslug: 'services',\n\t},\n\t{\n\t\ttitle: 'Contact',\n\t\tdescription:\n\t\t\t'Contact sections allow visitors to see your location and get in touch with you.',\n\t\tslug: 'contact',\n\t},\n\t{\n\t\ttitle: 'Subscription Forms',\n\t\tdescription:\n\t\t\t'Subscription forms are used for recurring payments, memberships, or services. They require users to input their information and agree to terms and conditions before committing to a subscription.',\n\t\tslug: 'newsletter',\n\t},\n\t{\n\t\ttitle: 'Image Galleries',\n\t\tdescription:\n\t\t\t'Image galleries showcase collections of images that can be browsed, viewed, and sometimes downloaded or shared.',\n\t\tslug: 'gallery',\n\t},\n\t{\n\t\ttitle: 'Menu',\n\t\tdescription:\n\t\t\t'Menus showcase the food offerings available at a restaurant, cafe, or eatery. They often include categories, descriptions, and prices for each item.',\n\t\tslug: 'menu',\n\t},\n\t{\n\t\ttitle: 'Event Listings',\n\t\tdescription:\n\t\t\t'Event listings promote and provide details about upcoming events, conferences, meetings, or webinars.',\n\t\tslug: 'events',\n\t},\n\t{\n\t\ttitle: 'Blog Posts',\n\t\tdescription:\n\t\t\t\"Blog posts are articles or entries published on a website's blog, often featuring news, updates, insights, or educational content.\",\n\t\tslug: 'posts',\n\t},\n\t{\n\t\ttitle: 'Team',\n\t\tdescription:\n\t\t\t'Team sections showcase the people behind a business, including their names, roles, and sometimes images.',\n\t\tslug: 'team',\n\t},\n\t{\n\t\ttitle: 'Footers',\n\t\tdescription:\n\t\t\t'Footers are sections located at the bottom of a website, often containing important information such as copyright details, terms and conditions, and contact information.',\n\t\tslug: 'footer',\n\t},\n];\n\nexport const patternsBySlug = patterns.reduce( ( acc, pattern ) => {\n\tacc[ pattern.slug ] = pattern;\n\treturn acc;\n}, {} );\n\nexport default patterns;\n","import { urlAlphabet as scopedUrlAlphabet } from './url-alphabet/index.js'\nexport { urlAlphabet } from './url-alphabet/index.js'\nexport let random = bytes => crypto.getRandomValues(new Uint8Array(bytes))\nexport let customRandom = (alphabet, defaultSize, getRandom) => {\n  let mask = (2 << (Math.log(alphabet.length - 1) / Math.LN2)) - 1\n  let step = -~((1.6 * mask * defaultSize) / alphabet.length)\n  return (size = defaultSize) => {\n    let id = ''\n    while (true) {\n      let bytes = getRandom(step)\n      let j = step\n      while (j--) {\n        id += alphabet[bytes[j] & mask] || ''\n        if (id.length === size) return id\n      }\n    }\n  }\n}\nexport let customAlphabet = (alphabet, size = 21) =>\n  customRandom(alphabet, size, random)\nexport let nanoid = (size = 21) => {\n  let id = ''\n  let bytes = crypto.getRandomValues(new Uint8Array(size))\n  while (size--) {\n    id += scopedUrlAlphabet[bytes[size] & 63]\n  }\n  return id\n}\n","export const urlAlphabet =\n  'useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict'\n","/**\n * External dependencies\n */\nimport { nanoid } from 'nanoid';\n\nconst blockNameMap = {\n\tPRIMARY_HEADING: 'h1', // Not a real block type. Just a placeholder.\n\t'core/heading': 'h2',\n\t'core/paragraph': 'p',\n\t'core/site-title': 'st',\n\t'core/button': 'b',\n};\n\n/**\n * Retrieves the example content from pattern blocks recursively.\n *\n * @param {Array}  blocks          - The array of blocks to retrieve content from.\n * @param {string} patternCategory - The category for the pattern the block is in.\n * @return {Array} - The array of block content objects.\n */\nexport function getContentOfBlocks( blocks, patternCategory ) {\n\tconst content = [];\n\tblocks.forEach( ( block ) => {\n\t\tif ( block.innerBlocks?.length > 0 ) {\n\t\t\tcontent.push(\n\t\t\t\t...getContentOfBlocks(\n\t\t\t\t\tblock.innerBlocks,\n\t\t\t\t\tpatternCategory ||\n\t\t\t\t\t\tblock?.attributes?.metadata?.patternCategory\n\t\t\t\t)\n\t\t\t);\n\t\t} else if (\n\t\t\tblock.name === 'core/heading' ||\n\t\t\tblock.name === 'core/paragraph' ||\n\t\t\tblock.name === 'core/button'\n\t\t) {\n\t\t\tconst name =\n\t\t\t\tpatternCategory === 'intro' && block.name === 'core/heading'\n\t\t\t\t\t? 'PRIMARY_HEADING'\n\t\t\t\t\t: block.name;\n\n\t\t\tlet example;\n\t\t\tif ( block.name === 'core/button' ) {\n\t\t\t\texample =\n\t\t\t\t\ttypeof block.attributes.text === 'string'\n\t\t\t\t\t\t? block.attributes.text\n\t\t\t\t\t\t: 'Click here';\n\t\t\t} else {\n\t\t\t\texample =\n\t\t\t\t\ttypeof block.attributes.content === 'string'\n\t\t\t\t\t\t? block.attributes.content\n\t\t\t\t\t\t: block.attributes.content?.originalHTML;\n\t\t\t}\n\t\t\tcontent.push( {\n\t\t\t\tname,\n\t\t\t\tclientId: block.clientId,\n\t\t\t\texample,\n\t\t\t\tblock,\n\t\t\t} );\n\t\t}\n\t} );\n\n\treturn content;\n}\n\n/**\n * Generates the request data for content generation.\n *\n * @param {Array}   content          - The array of content blocks.\n * @param {boolean} isConceptSection - Is this content for a new concept section.\n * @param {string}  language         - The language of the content.\n * @return {Object} - The request data for content generation.\n */\nexport function getContentRequestData( content, isConceptSection, language ) {\n\t// Set some average content lengths for block types. Used when generating spare content for caching.\n\tconst blockLengths = {\n\t\t'core/heading': 30,\n\t\t'core/paragraph': 60,\n\t\t'core/button': 8,\n\t};\n\n\t// Count the number of blocks of each type to ensure we have enough spare content for caching.\n\tconst blockCounts = {\n\t\t'core/heading': 0,\n\t\t'core/paragraph': 0,\n\t\t'core/button': 0,\n\t};\n\n\t// If there is no content for this pattern, we need to generate some spare content for caching.\n\tif ( content.length === 0 && isConceptSection ) {\n\t\tconst contentForRequest = [];\n\t\tObject.keys( blockCounts ).forEach( ( key ) => {\n\t\t\twhile ( blockCounts[ key ] < 3 ) {\n\t\t\t\tblockCounts[ key ]++;\n\t\t\t\tcontentForRequest.push( {\n\t\t\t\t\tt: blockNameMap[ key ],\n\t\t\t\t\ti: 'SPARE',\n\t\t\t\t\tln: blockLengths[ key ],\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\t\treturn {\n\t\t\tcontentForRequest,\n\t\t\tclientIdMap: {},\n\t\t\tblockMap: null,\n\t\t};\n\t}\n\n\t// Map of clientIds to shorter 4 character ids for the request. This is used when content is returned\n\t// to make the content back to the original block.\n\tconst clientIdMap = {};\n\n\t// If we are dealing with in memory blocks, like layout concepts, they\n\t// can't be retrieved with `getBlock` as they are not in the block editor\n\t// store if not in the canvas, so we keep a map of these so we can manually\n\t// update them later.\n\tconst blockMap = {};\n\n\t// Map all the content to shorter ids and names.\n\tconst contentForRequest = content.map( ( block ) => {\n\t\tblockCounts[ block.name ]++;\n\t\tconst id = nanoid( 4 );\n\t\tclientIdMap[ id ] = block.clientId;\n\t\tif ( isConceptSection ) {\n\t\t\tblockMap[ block.clientId ] = block.block;\n\t\t}\n\t\tlet data;\n\t\tif ( ! isConceptSection ) {\n\t\t\tdata = {\n\t\t\t\tt: blockNameMap[ block.name ],\n\t\t\t\ti: id,\n\t\t\t\te: block.example,\n\t\t\t};\n\t\t} else {\n\t\t\tdata = {\n\t\t\t\tt: blockNameMap[ block.name ],\n\t\t\t\ti: id,\n\t\t\t\tln: block.example.length,\n\t\t\t};\n\t\t}\n\t\tif ( language ) {\n\t\t\tdata.l = language;\n\t\t}\n\t\treturn data;\n\t} );\n\n\t// If we are dealing with in memory blocks this is the initial concept so we need to add\n\t// some spare content to cover alternative concepts that may have more content.\n\tif ( isConceptSection ) {\n\t\tObject.keys( blockCounts ).forEach( ( key ) => {\n\t\t\twhile ( blockCounts[ key ] < 3 ) {\n\t\t\t\tblockCounts[ key ]++;\n\t\t\t\tcontentForRequest.push( {\n\t\t\t\t\tt: blockNameMap[ key ],\n\t\t\t\t\ti: 'SPARE',\n\t\t\t\t\tln: blockLengths[ key ],\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\t}\n\n\treturn {\n\t\tcontentForRequest,\n\t\tclientIdMap,\n\t\tblockMap: isConceptSection ? blockMap : null,\n\t};\n}\n\nexport function findFirstAvailableInnerBlockByClassName(\n\tparentBlock,\n\tclassName\n) {\n\tif ( parentBlock?.innerBlocks ) {\n\t\tconst matchingBlock = parentBlock.innerBlocks.find(\n\t\t\t( block ) => block.attributes.className === className\n\t\t);\n\n\t\tif ( matchingBlock ) {\n\t\t\treturn matchingBlock;\n\t\t}\n\n\t\tfor ( let i = 0; i < parentBlock.innerBlocks.length; i++ ) {\n\t\t\tconst matchingInnerBlock = findFirstAvailableInnerBlockByClassName(\n\t\t\t\tparentBlock.innerBlocks[ i ],\n\t\t\t\tclassName\n\t\t\t);\n\n\t\t\tif ( matchingInnerBlock ) {\n\t\t\t\treturn matchingInnerBlock;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn false;\n}\n\nexport function findLastAvailableInnerBlockByClassName(\n\tparentBlock,\n\tclassName\n) {\n\tif ( parentBlock?.innerBlocks ) {\n\t\t// Search innerBlocks in reverse order\n\t\tfor ( let i = parentBlock.innerBlocks.length - 1; i >= 0; i-- ) {\n\t\t\tconst block = parentBlock.innerBlocks[ i ];\n\n\t\t\tif ( block.attributes.className === className ) {\n\t\t\t\treturn block;\n\t\t\t}\n\n\t\t\tconst matchingInnerBlock = findLastAvailableInnerBlockByClassName(\n\t\t\t\tblock,\n\t\t\t\tclassName\n\t\t\t);\n\n\t\t\tif ( matchingInnerBlock ) {\n\t\t\t\treturn matchingInnerBlock;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn false;\n}\n\nexport function getNextAvailableContentValue( { data, type, offset } ) {\n\tlet contentValue = '';\n\n\t// handle case where offset is -1, which could happen if the current pattern doesn't have an items block\n\tif ( offset === -1 ) {\n\t\toffset = 0;\n\t}\n\toffset = offset % data.length;\n\n\tfor ( let i = offset; i < data.length; i++ ) {\n\t\tif ( data[ i ][ type ] ) {\n\t\t\tcontentValue = data[ i ][ type ];\n\n\t\t\treturn { data, contentValue };\n\t\t}\n\t}\n\n\treturn { data, contentValue };\n}\n\nexport function removeBlockFromHtml( html, blockName ) {\n\tlet pattern = `<!--\\\\s*wp:${ blockName }\\\\s*.*?-->.*?<!--\\\\s*/wp:${ blockName }\\\\s*-->`;\n\tif ( blockName === 'navigation' ) {\n\t\tpattern = `<!--\\\\s*wp:${ blockName }\\\\s*[^/]*?/-->`;\n\t}\n\n\t// Use the replace() method to remove the matched wp:buttons block\n\tconst result = html.replace( new RegExp( pattern, 'gs' ), '' );\n\n\treturn result;\n}\n","/**\n * External dependencies\n */\nimport { DotPromptTemplate } from '../big-sky-agents/index.js';\n\nconst userLanguage =\n\ttypeof window !== 'undefined' && window.bigSkyInitialState?.userLanguage\n\t\t? window.bigSkyInitialState.userLanguage\n\t\t: 'English (United States)';\n\nexport const systemPromptTemplate = DotPromptTemplate.fromString(\n\t`## {{= it.role }}\n\n{{? it.context }}\n\n## Context:\n{{= it.context }}\n{{?}}\n\n{{? it.examplesDescription }}\n## Examples:\n{{= it.examplesDescription }}\n\n{{~it.examples :value }}\n- {{= value }}\n{{~}}\n\n{{?}}\n\n{{? it.do && it.do.length }}\n## Things you should do:\n\n- Respond in ${ userLanguage } unless the user explicitly asks for a different language.\n{{~it.do :value }}\n- {{= value }}\n{{~}}\n\n{{?}}\n\n{{? it.dont && it.dont.length }}\n## Things you should NEVER do:\n\n{{~it.dont :value }}\n- {{= value }}\n{{~}}\n\n{{?}}\n{{? it.additionalInstructions }}\n## Additional instructions:\n{{= it.additionalInstructions }}\n{{?}}\n`,\n\t[\n\t\t'role',\n\t\t'context',\n\t\t'examplesDescription',\n\t\t'examples',\n\t\t'do',\n\t\t'dont',\n\t\t'additionalInstructions',\n\t]\n);\n","/**\n * Internal dependencies\n */\nimport { systemPromptTemplate } from '@ai/system-prompt-template.js';\nexport function getContactsContentSystemPrompt( siteLocationName ) {\n\treturn systemPromptTemplate.format( {\n\t\trole: 'You are an expert at generating realistic descriptions, address, phone, email and opening hours for contact us page that would be listed on a website when provided with a description of the website',\n\n\t\tcontext: `The address: ${\n\t\t\tsiteLocationName ? siteLocationName : 'unknown'\n\t\t}`,\n\n\t\tdo: [\n\t\t\t'If the site location name is provided you must always use it for the `address` property.',\n\t\t\t'Contact Us descriptions should always be two short sentences long, never longer. Never use quotes (\\' or \") in the description.',\n\t\t\t'Your response will always be in valid JSON and an array of objects with all the specified fields and no other content. All fields are required.',\n\t\t],\n\n\t\texamplesDescription: 'Here is an example response:',\n\t\texamples: [\n\t\t\t`[{'address: 123 Example Street\\nSan Franciso, CA 12345',\n\t\t\t'phone-email: (123) 456-7890\\nadmin@example.com',\n\t\t\t'address-phone: 123 Example Street,\\nSan Francisco, CA 12345\\n(123)-456-7890',\n\t\t\t'opening-hours: Monday—Friday\\n9am-5pm',\n\t\t\t'description: Contact us anytime for any questions or concerns.}]`,\n\t\t],\n\t} );\n}\n\nexport function getEventsContentSystemPrompt( dateFormatExample ) {\n\treturn systemPromptTemplate.format( {\n\t\trole: 'You are an expert at generating realistic names, descriptions, dates, times, and locations for events that would be listed on a website when provided with a description of the website',\n\n\t\tdo: [\n\t\t\t'ALWAYS return an array of JSON objects as in the example response.',\n\t\t\t'Events should be ordered by date, starting with the earliest.',\n\t\t\t'Event descriptions should always be two short sentences long, never longer. Never use quotes (\\' or \") in the description.',\n\t\t\t`Dates should always be after today's date which is: ${ new Date().toLocaleDateString() } and formatted in this style: ${ dateFormatExample }`,\n\t\t],\n\t\texamplesDescription: 'Here is an example response:',\n\t\texamples: [\n\t\t\t`{ events: [\n\t\t\t\t\t{\"name\": \"Event Name\", \"description\": \"Event Description\", \"date\": \"Event Date\", \"time\": \"Event Time\", \"location\": \"Event Location\"},\n\t\t\t\t\t{\"name\": \"Event Name\", \"description\": \"Event Description\", \"date\": \"Event Date\", \"time\": \"Event Time\", \"location\": \"Event Location\"}\n\t\t\t] }`,\n\t\t],\n\t} );\n}\n\nexport function getFooterContentSystemPrompt( siteLocationName ) {\n\treturn systemPromptTemplate.format( {\n\t\trole: 'You are an expert at generating realistic address, phone, email and opening hours for footer section of a page that would be listed on a website when provided with a description of the website.',\n\n\t\tcontext: `The address: ${\n\t\t\tsiteLocationName ? siteLocationName : 'unknown'\n\t\t}`,\n\n\t\texamplesDescription:\n\t\t\t'Here are examples for each part of the footer section:',\n\t\texamples: [\n\t\t\t'Address: 123 Example Street\\nSan Franciso, CA 12345',\n\t\t\t'Phone and email: (123) 456-7890\\nadmin@example.com',\n\t\t\t'Opening hours: Monday—Friday\\n9am-5pm',\n\t\t],\n\t\tdo: [\n\t\t\t'Use the email, address, phone information in the site description if provided. Otherwise make up a realistic one.',\n\t\t],\n\t\tadditionalInstructions: `Your response will only be in valid JSON with no other content. All fields are required. Return the result as an array of JSON objects in the following format:\n            { \"address\": \"Address in two lines\", \"phone-email\": \"Phone number and email address in two lines\",\n\t\t\t\"opening-hours\": \"Weekday from/to and time range for opening hours in two lines\"}`,\n\t} );\n}\n\nexport function getMenuContentSystemPrompt( siteLocationName ) {\n\treturn systemPromptTemplate.format( {\n\t\trole: 'An expert at generating realistic food menus for a website when provided with a description of the website.',\n\n\t\tdo: [\n\t\t\t'ALWAYS return an array of JSON objects as in the example response.',\n\t\t\t\"The sections and items in the menu should always pertain to food or drink and be relevant to the website's description.\",\n\t\t\t'The menus you generate will contain specific sections like \"Lunch\", \"Cakes\", \"Dinner\", \"Coffee\" and be tailored to the website\\'s description.',\n\t\t\t'Each section of the menu will contain menu items with a name, description, and realistic price in the local currency for the item.',\n\t\t\t`The currency should include only the symbol of the currency for the location of '${ siteLocationName }'. If you cannot determine the correct currency symbol, use '$'.`,\n\t\t\t'Item descriptions should always be one short sentence long, never longer.',\n\t\t],\n\t\tdont: [\n\t\t\t\"Use the word 'Menu' in the section names.\",\n\t\t\t'Use the same item in multiple sections.',\n\t\t\t'Use quotes (\\' or \") in the description.',\n\t\t\t'Use markdown or HTML in the JSON response.',\n\t\t],\n\t\texamplesDescription: 'Here is an example response:',\n\t\texamples: [\n\t\t\t`{ menu: [\n\t\t\t\t\t{\"name\": \"Menu Section Name\", \"items\": [{\"name\": \"Item Name\", \"description\": \"Item Description\", \"currency\": \"Currency Symbol\", \"price\": \"Item Price\"}]},\n\t\t\t\t\t{\"name\": \"Menu Section Name\", \"items\": [{\"name\": \"Item Name\", \"description\": \"Item Description\", \"currency\": \"Currency Symbol\", \"price\": \"Item Price\"}]}\n\t\t\t] }`,\n\t\t],\n\t} );\n}\n\nexport function getPricingContentSystemPrompt( siteLocationName ) {\n\treturn systemPromptTemplate.format( {\n\t\trole: 'You are an expert at generating pricing tiers for a website when provided with a description of the website.',\n\n\t\tdo: [\n\t\t\t'Generate a short title no more than 3 words, and a brief description as an overview of the pricing tiers.',\n\t\t\t\"The pricing tiers you generate will contain specific sections with varying levels of services tailored to the website's description.\",\n\t\t\t`Each pricing tier will contain a name, the price in the local currency for the location of '${ siteLocationName }', and a list of the services included.`,\n\t\t\t\"Make up prices for the tiers, but ensure they are realistic for the website's description and for the services provided.\",\n\t\t\t`The currency should include only the symbol of the currency for the location of '${ siteLocationName }'. If you cannot determine the correct currency symbol, use '$'.`,\n\t\t\t\"The list of services should be realistic and relevant to the website's description. Features for a preceding tier should be always be included in the next tier.\",\n\t\t],\n\t\tadditionalInstructions: `Your response will only be in valid JSON with no other content. You will return each pricing tier in a JSON array in the following format:\n\n\t\t{\n\t\t\t\"title\": \"Pricing Tier Section Title\",\n\t\t\t\"description\": \"Pricing Tier Section Description\",\n\t\t\t\"tiers\": [\n\t\t\t\t{\n\t\t\t\t\t\"name\": \"Basic\",\n\t\t\t\t\t\"price\": \"$50\",\n\t\t\t\t\t\"services\": [ \"Service 1\", \"Service 2\", \"Service 3\", \"Service 4\" ]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"name\": \"Standard\",\n\t\t\t\t\t\"price\": \"$100\",\n\t\t\t\t\t\"services\": [ \"Services from Basic Tier\", \"Service 5\", \"Service 6\", \"Service 7\" ]\n\t\t\t\t}\n\t\t\t]\n\t\t}`,\n\t} );\n}\n\nexport const getServicesContentSystemPrompt = systemPromptTemplate.format( {\n\trole: 'You are an expert at generating services offered when provided with a description of the website.',\n\n\tdo: [\n\t\t'ALWAYS return an array of JSON objects as in the example response.',\n\t\t'Each service has a short name, a brief description, and link text.',\n\t\t'The description should be one sentence long, never longer.',\n\t\t'The link text should be a short phrase or word used as a call to action.',\n\t],\n\texamplesDescription: 'Here is an example response:',\n\texamples: [\n\t\t`{ services: [\n\t\t\t\t{\"name\": \"Service Name\", \"description\": \"Service Description\", \"link\": \"Service Link\"},\n\t\t\t\t{\"name\": \"Service Name\", \"description\": \"Service Description\", \"link\": \"Service Link\"}\n\t\t] }`,\n\t],\n} );\n\nexport const getTestimonialsContentSystemPrompt = systemPromptTemplate.format( {\n\trole: 'You are an expert at generating realistic testimonials for a website when provided with a description of the website.',\n\n\tdo: [\n\t\t'ALWAYS return an array of JSON objects as in the example response.',\n\t\t'Assume all testimonials are for a positive 5-star rating.',\n\t\t`Each testimonial should contain the following information:\n            - name: The name of the person giving the testimonial, in the format of \"First Name\" \"Last Initial\", e.g. \"John D.\"\n            - handle: The social media handle of the person giving the testimonial, e.g. \"@john_doe\"\n             - review: The review given by the person, no more than 2 sentences long.`,\n\t],\n\texamplesDescription: 'Here is an example response:',\n\texamples: [\n\t\t`{ testimonials: [\n\t\t\t\t{\"name\": \"John D.\", \"handle\": \"@john_doe\", \"review\": \"This is a wonderful product that was received as advertised! I would buy it again!\"},\n\t\t\t\t{\"name\": \"John D.\", \"handle\": \"@john_doe\", \"review\": \"This is a wonderful product that was received as advertised! I would buy it again!\"}\n\t\t] }`,\n\t],\n} );\n","/**\n * Internal dependencies\n */\nimport {\n\tfindFirstAvailableInnerBlockByClassName,\n\tgetNextAvailableContentValue,\n} from '../utils.js';\nimport { getEventsContentSystemPrompt } from './system-prompt.js';\nimport { patternKeys } from '@utils/constants';\n\nfunction replaceContent( {\n\trootBlock,\n\tdata: eventsData,\n\tupdateBlockAttributes,\n\tstartIndex = -1,\n} ) {\n\tconst { ITEMS_KEY, ITEM_KEY } = patternKeys;\n\tif ( ! eventsData ) {\n\t\treturn;\n\t}\n\n\t// If this is the root pattern block, make a deep copy of the events data to avoid mutation for other patterns\n\tlet newEventsData = null;\n\tif ( rootBlock?.attributes?.metadata?.patternCategory ) {\n\t\tnewEventsData = JSON.parse( JSON.stringify( eventsData ) );\n\t} else {\n\t\tnewEventsData = eventsData;\n\t}\n\n\tlet newStartIndex = startIndex;\n\t// reset the start index if we're changing menu items\n\tif ( rootBlock?.attributes?.metadata?.name === ITEMS_KEY ) {\n\t\tnewStartIndex = startIndex;\n\t} else if ( rootBlock?.attributes?.metadata?.name === ITEM_KEY ) {\n\t\t// increment the start index if we're going to a new menu item\n\t\tnewStartIndex++;\n\t}\n\n\tconst validClassNames = [\n\t\t'is-event-date',\n\t\t'is-event-time',\n\t\t'is-event-name',\n\t\t'is-event-description',\n\t\t'is-event-location',\n\t];\n\n\tif ( rootBlock?.attributes?.className ) {\n\t\tconst rootBlockClassNames = rootBlock.attributes.className.split( ' ' );\n\n\t\tconst matchingClassName = rootBlockClassNames.find( ( className ) =>\n\t\t\tvalidClassNames.includes( className )\n\t\t);\n\n\t\tif ( matchingClassName ) {\n\t\t\tconst { updatedEventsData, contentValue } =\n\t\t\t\tgetNextAvailableContentValue( {\n\t\t\t\t\tdata: newEventsData,\n\t\t\t\t\ttype: matchingClassName.replace( 'is-event-', '' ),\n\t\t\t\t\toffset: newStartIndex,\n\t\t\t\t} );\n\t\t\tnewEventsData = updatedEventsData;\n\n\t\t\tif ( updateBlockAttributes ) {\n\t\t\t\tupdateBlockAttributes( rootBlock.clientId, {\n\t\t\t\t\tcontent: contentValue,\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\trootBlock.attributes.content = contentValue;\n\t\t\t}\n\t\t}\n\t}\n\n\trootBlock?.innerBlocks.forEach( ( block ) => {\n\t\tnewStartIndex = replaceContent( {\n\t\t\trootBlock: block,\n\t\t\tdata: newEventsData,\n\t\t\tupdateBlockAttributes,\n\t\t\tstartIndex: newStartIndex,\n\t\t} );\n\t} );\n\n\treturn newStartIndex;\n}\n\nfunction getPrompts( { conceptSection } ) {\n\tconst dateBlock = conceptSection?.length\n\t\t? findFirstAvailableInnerBlockByClassName(\n\t\t\t\tconceptSection[ 0 ],\n\t\t\t\t'is-event-date'\n\t\t  )\n\t\t: null;\n\n\tlet dateFormatExample = 'Jan 1, 2025';\n\tif ( dateBlock ) {\n\t\tdateFormatExample =\n\t\t\ttypeof dateBlock.attributes.content === 'string'\n\t\t\t\t? dateBlock.attributes.content\n\t\t\t\t: dateBlock.attributes.content?.originalHTML;\n\t}\n\n\tconst prompts = {\n\t\tsystem: getEventsContentSystemPrompt( dateFormatExample ),\n\t\tuser: 'Generate 10 event names, descriptions, dates, and locations for this website based on the description and reason the section exists.',\n\t};\n\treturn prompts;\n}\n\nexport default {\n\tname: 'events',\n\tgetPrompts,\n\treplaceContent,\n};\n","/**\n * Internal dependencies\n */\nimport { getNextAvailableContentValue, removeBlockFromHtml } from '../utils.js';\nimport { getFooterContentSystemPrompt } from './system-prompt.js';\nimport { patternKeys } from '@utils/constants';\n\nfunction preprocessSection( pattern ) {\n\tpattern.html = removeBlockFromHtml( pattern.html, 'navigation' );\n}\n\nfunction replaceContent( {\n\trootBlock,\n\tdata: footerData,\n\tupdateBlockAttributes,\n\tstartIndex = -1,\n} ) {\n\tconst { ITEMS_KEY, ITEM_KEY } = patternKeys;\n\tif ( ! footerData ) {\n\t\treturn;\n\t}\n\n\t// If this is the root pattern block, make a deep copy of the footer data to avoid mutation for other patterns\n\tlet newFooterData = null;\n\tif ( rootBlock?.attributes?.metadata?.patternCategory ) {\n\t\tnewFooterData = JSON.parse( JSON.stringify( footerData ) );\n\t} else {\n\t\tnewFooterData = footerData;\n\t}\n\n\tlet newStartIndex = startIndex;\n\t// reset the start index if we're changing menu items\n\tif ( rootBlock?.attributes?.metadata?.name === ITEMS_KEY ) {\n\t\tnewStartIndex = -1;\n\t} else if ( rootBlock?.attributes?.metadata?.name === ITEM_KEY ) {\n\t\t// increment the start index if we're going to a new menu item\n\t\tnewStartIndex++;\n\t}\n\n\tconst validClassNames = [\n\t\t// 123 Example Street\n\t\t// San Franciso, CA 12345\n\t\t'is-footer-address',\n\t\t// (123) 456-7890\n\t\t// hi@mygroovydomain.com\n\t\t'is-footer-phone-email',\n\t\t// Monday—Friday\n\t\t// 9am-5pm\n\t\t'is-footer-opening-hours',\n\t];\n\n\tif ( rootBlock?.attributes?.className ) {\n\t\tconst rootBlockClassNames = rootBlock.attributes.className.split( ' ' );\n\n\t\tconst matchingClassName = rootBlockClassNames.find( ( className ) =>\n\t\t\tvalidClassNames.includes( className )\n\t\t);\n\n\t\tif ( matchingClassName ) {\n\t\t\tconst { updatedFooterData, contentValue } =\n\t\t\t\tgetNextAvailableContentValue( {\n\t\t\t\t\tdata: newFooterData,\n\t\t\t\t\ttype: matchingClassName.replace( 'is-footer-', '' ),\n\t\t\t\t\toffset: newStartIndex,\n\t\t\t\t} );\n\t\t\tnewFooterData = updatedFooterData;\n\n\t\t\tif ( updateBlockAttributes ) {\n\t\t\t\tupdateBlockAttributes( rootBlock.clientId, {\n\t\t\t\t\tcontent: contentValue,\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\trootBlock.attributes.content = contentValue;\n\t\t\t}\n\t\t}\n\t}\n\n\trootBlock?.innerBlocks.forEach( ( block ) => {\n\t\tnewStartIndex = replaceContent( {\n\t\t\trootBlock: block,\n\t\t\tdata: newFooterData,\n\t\t\tupdateBlockAttributes,\n\t\t\tstartIndex: newStartIndex,\n\t\t} );\n\t} );\n\n\treturn newStartIndex;\n}\n\nfunction getPrompts( { siteLocation } ) {\n\tconst prompts = {\n\t\tsystem: getFooterContentSystemPrompt( siteLocation?.name ),\n\t\tuser: `Generate the footer information for this website based on the description and reason the section exists.`,\n\t};\n\treturn prompts;\n}\n\nexport default {\n\tname: 'footer',\n\tpreprocessSection,\n\tgetPrompts,\n\treplaceContent,\n};\n","/**\n * Internal dependencies\n */\nimport { getMenuContentSystemPrompt } from './system-prompt.js';\nimport { patternKeys } from '@utils/constants';\n\nlet menuDataIndex = false;\n\nfunction getNextAvailableMenuSectionContentValue( {\n\tdata,\n\ttype,\n\tsectionIndex,\n\tsectionHeading,\n\toffset = 0,\n} ) {\n\tlet index = sectionIndex || 0;\n\t// get index by name if sectionHeading is provided\n\tif ( sectionHeading ) {\n\t\tindex = Object.values( data ).findIndex(\n\t\t\t( section ) => section.name === sectionHeading\n\t\t);\n\t\tif ( index === -1 ) {\n\t\t\tindex = 0;\n\t\t}\n\t}\n\n\tconst section = data[ index ];\n\tlet contentValue = '';\n\n\tif ( type === 'section-name' ) {\n\t\tcontentValue = section.name;\n\t\treturn { data, contentValue };\n\t}\n\n\tconst newType = type.replace( 'item-', '' );\n\n\toffset = offset % section.items.length;\n\n\tfor ( let j = offset; j < section.items.length; j++ ) {\n\t\tif ( section.items[ j ][ newType ] ) {\n\t\t\tcontentValue = section.items[ j ][ newType ];\n\n\t\t\treturn { data, contentValue };\n\t\t}\n\t}\n\n\treturn { data, contentValue };\n}\n\nfunction replaceContent( {\n\trootBlock,\n\tdata: menuData,\n\tupdateBlockAttributes,\n\tsectionHeading,\n\treplaceHeading,\n\tstartIndex = -1,\n} ) {\n\tconst { ITEMS_KEY, ITEM_KEY } = patternKeys;\n\tlet newMenuData = null;\n\n\tif ( ! menuData ) {\n\t\treturn;\n\t}\n\n\tif ( rootBlock?.attributes?.metadata?.patternCategory ) {\n\t\t// If this is the root pattern block, make a deep copy of the menu item data to avoid mutation for other patterns\n\t\tnewMenuData = JSON.parse( JSON.stringify( menuData ) );\n\t\tmenuDataIndex = false;\n\t} else {\n\t\tnewMenuData = menuData;\n\t}\n\n\tlet newStartIndex = startIndex;\n\t// reset the start index if we're changing menu items\n\tif ( rootBlock?.attributes?.metadata?.name === ITEMS_KEY ) {\n\t\tnewStartIndex = startIndex;\n\t} else if ( rootBlock?.attributes?.metadata?.name === ITEM_KEY ) {\n\t\t// increment the start index if we're going to a new menu item\n\t\tnewStartIndex++;\n\t}\n\n\tconst validClassNames = [\n\t\t'is-menu-section-name',\n\t\t'is-menu-item-name',\n\t\t'is-menu-item-description',\n\t\t'is-menu-item-currency',\n\t\t'is-menu-item-price',\n\t];\n\n\tif ( rootBlock?.attributes?.className ) {\n\t\tconst rootBlockClassNames = rootBlock.attributes.className.split( ' ' );\n\n\t\tconst matchingClassName = rootBlockClassNames.find( ( className ) =>\n\t\t\tvalidClassNames.includes( className )\n\t\t);\n\n\t\tif ( matchingClassName ) {\n\t\t\tif ( matchingClassName === 'is-menu-section-name' ) {\n\t\t\t\tif ( ! replaceHeading ) return;\n\n\t\t\t\tif ( menuDataIndex === false ) {\n\t\t\t\t\tmenuDataIndex = 0;\n\t\t\t\t} else {\n\t\t\t\t\tmenuDataIndex = 1;\n\t\t\t\t}\n\t\t\t\tstartIndex++;\n\t\t\t}\n\n\t\t\tconst { data, contentValue } =\n\t\t\t\tgetNextAvailableMenuSectionContentValue( {\n\t\t\t\t\tdata: newMenuData,\n\t\t\t\t\ttype: matchingClassName.replace( 'is-menu-', '' ),\n\t\t\t\t\tsectionIndex: menuDataIndex,\n\t\t\t\t\tsectionHeading,\n\t\t\t\t\toffset: newStartIndex,\n\t\t\t\t} );\n\n\t\t\tnewMenuData = data;\n\t\t\tif ( updateBlockAttributes ) {\n\t\t\t\tupdateBlockAttributes( rootBlock.clientId, {\n\t\t\t\t\tcontent: contentValue,\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\trootBlock.attributes.content = contentValue;\n\t\t\t}\n\t\t}\n\t}\n\n\tfor ( const block of rootBlock.innerBlocks ) {\n\t\tnewStartIndex = replaceContent( {\n\t\t\trootBlock: block,\n\t\t\tdata: newMenuData,\n\t\t\tupdateBlockAttributes,\n\t\t\tsectionHeading,\n\t\t\treplaceHeading,\n\t\t\tstartIndex: newStartIndex,\n\t\t} );\n\t}\n\n\treturn newStartIndex;\n}\n\nfunction getPrompts( { siteLocation, numOfSections = 2 } ) {\n\tconst prompts = {\n\t\tsystem: getMenuContentSystemPrompt( siteLocation?.name ),\n\t\tuser: `Generate ${ numOfSections } menu sections, each with 8 menu items relevant for this website based on the description and reason the section exists.`,\n\t};\n\treturn prompts;\n}\n\nexport default {\n\tname: 'menu',\n\tgetPrompts,\n\treplaceContent,\n};\n","/**\n * Internal dependencies\n */\nimport { removeBlockFromHtml } from '../utils.js';\nimport { getPricingContentSystemPrompt } from './system-prompt.js';\nimport { patternKeys } from '@utils/constants';\n\nlet servicesDataIndex = -1;\n\nfunction getNextAvailablePricingTierSectionContentValue( {\n\tdata,\n\ttype,\n\ttierIndex,\n\tserviceIndex = 0,\n} ) {\n\tconst section = Array.isArray( data ) ? data[ 0 ] : data;\n\tlet contentValue = '';\n\n\tif ( [ 'title', 'description' ].includes( type ) ) {\n\t\tcontentValue = section[ type ];\n\t\treturn { data, contentValue };\n\t}\n\n\tconst newType = type.replace( 'tier-', '' );\n\tconst index =\n\t\t( tierIndex && tierIndex !== -1 ? tierIndex : 0 ) %\n\t\tsection.tiers.length;\n\n\tif ( [ 'name', 'price' ].includes( newType ) ) {\n\t\tcontentValue = section.tiers[ index ][ newType ];\n\t\treturn { data, contentValue };\n\t}\n\n\tconst services = section.tiers[ index ].services;\n\tif ( [ 'service' ].includes( newType ) ) {\n\t\tcontentValue = services[ serviceIndex ];\n\t\treturn { data, contentValue };\n\t}\n\tif ( [ 'service-checked' ].includes( newType ) ) {\n\t\tconst nextService = services[ serviceIndex ];\n\t\tcontentValue = `<b>✓</b> ${ nextService }`;\n\t\treturn { data, contentValue };\n\t}\n\n\treturn { data, contentValue };\n}\n\nfunction replaceContent( {\n\trootBlock,\n\tdata: pricingData,\n\tupdateBlockAttributes,\n\tstartIndex = -1,\n} ) {\n\tconst { ITEMS_KEY, ITEM_KEY } = patternKeys;\n\tlet newPricingData = null;\n\n\tif ( ! pricingData ) {\n\t\treturn;\n\t}\n\n\tif ( rootBlock?.attributes?.metadata?.patternCategory ) {\n\t\t// If this is the root pattern block, make a deep copy of the pricing item data to avoid mutation for other patterns\n\t\tnewPricingData = JSON.parse( JSON.stringify( pricingData ) );\n\t} else {\n\t\tnewPricingData = pricingData;\n\t}\n\n\tlet newStartIndex = startIndex;\n\t// reset the start index if we're changing pricing items (tiers)\n\tif ( rootBlock?.attributes?.metadata?.name === ITEMS_KEY ) {\n\t\tnewStartIndex = startIndex;\n\t} else if ( rootBlock?.attributes?.metadata?.name === ITEM_KEY ) {\n\t\t// increment the start index if we're going to a new tier item\n\t\tnewStartIndex++;\n\t}\n\n\tconst validClassNames = [\n\t\t'is-pricing-title',\n\t\t'is-pricing-description',\n\t\t'is-pricing-tier-name',\n\t\t'is-pricing-tier-price',\n\t\t'is-pricing-tier-service',\n\t\t'is-pricing-tier-service-checked',\n\t];\n\n\tif ( rootBlock?.attributes?.className ) {\n\t\tconst rootBlockClassNames = rootBlock.attributes.className.split( ' ' );\n\n\t\tconst matchingClassName = rootBlockClassNames.find( ( className ) =>\n\t\t\tvalidClassNames.includes( className )\n\t\t);\n\n\t\tif ( matchingClassName ) {\n\t\t\tif ( matchingClassName === 'is-pricing-tier-name' ) {\n\t\t\t\tstartIndex++;\n\t\t\t\tservicesDataIndex = -1;\n\t\t\t}\n\n\t\t\tif ( matchingClassName.startsWith( 'is-pricing-tier-service' ) ) {\n\t\t\t\tservicesDataIndex++;\n\t\t\t}\n\n\t\t\tconst { data, contentValue } =\n\t\t\t\tgetNextAvailablePricingTierSectionContentValue( {\n\t\t\t\t\tdata: newPricingData,\n\t\t\t\t\ttype: matchingClassName.replace( 'is-pricing-', '' ),\n\t\t\t\t\ttierIndex: newStartIndex,\n\t\t\t\t\tserviceIndex: servicesDataIndex,\n\t\t\t\t} );\n\n\t\t\tnewPricingData = data;\n\t\t\tif ( updateBlockAttributes ) {\n\t\t\t\tupdateBlockAttributes( rootBlock.clientId, {\n\t\t\t\t\tcontent: contentValue,\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\trootBlock.attributes.content = contentValue;\n\t\t\t}\n\t\t}\n\t}\n\n\tfor ( const block of rootBlock.innerBlocks ) {\n\t\tnewStartIndex = replaceContent( {\n\t\t\trootBlock: block,\n\t\t\tdata: newPricingData,\n\t\t\tupdateBlockAttributes,\n\t\t\tstartIndex: newStartIndex,\n\t\t} );\n\t}\n\n\treturn newStartIndex;\n}\n\nfunction preprocessSection( pattern ) {\n\tpattern.html = removeBlockFromHtml( pattern.html, 'buttons' );\n}\n\nfunction getPrompts( { siteLocation } ) {\n\tconst prompts = {\n\t\tsystem: getPricingContentSystemPrompt( siteLocation?.name ),\n\n\t\tuser: 'Generate 3 pricing tiers with 4 features in each tier. The first feature of the second tier should include all the features of the first tier, and so on.',\n\t};\n\n\treturn prompts;\n}\n\nfunction isCachedContentValid( cachedContent ) {\n\treturn cachedContent?.length > 0 && cachedContent[ 0 ]?.tiers;\n}\n\nexport default {\n\tname: 'pricing',\n\tgetPrompts,\n\treplaceContent,\n\tpreprocessSection,\n\tisCachedContentValid,\n};\n","/**\n * Internal dependencies\n */\nimport { getNextAvailableContentValue } from '../utils.js';\nimport { getServicesContentSystemPrompt } from './system-prompt.js';\nimport { patternKeys } from '@utils/constants';\n\nconst updateContent = (\n\trootBlock,\n\tcontentValue,\n\tupdateBlockAttributes = null\n) => {\n\tconst updates = {\n\t\t'core/button': { text: contentValue },\n\t\t'core/paragraph': rootBlock.attributes?.className?.includes(\n\t\t\t'is-service-link'\n\t\t)\n\t\t\t? { content: `<a href=\"#\">${ contentValue }</a>` }\n\t\t\t: { content: contentValue },\n\t\tdefault: { content: contentValue },\n\t};\n\n\tconst blockUpdates = updates[ rootBlock.name ] || updates.default;\n\n\tif ( updateBlockAttributes ) {\n\t\tupdateBlockAttributes( rootBlock.clientId, blockUpdates );\n\t} else {\n\t\tObject.assign( rootBlock.attributes, blockUpdates );\n\t}\n};\n\nfunction replaceContent( {\n\trootBlock,\n\tdata: servicesData,\n\tupdateBlockAttributes,\n\tstartIndex = -1,\n} ) {\n\tconst { ITEMS_KEY, ITEM_KEY } = patternKeys;\n\tif ( ! servicesData ) {\n\t\treturn;\n\t}\n\n\t// If this is the root pattern block, make a deep copy of the data to avoid mutation for other patterns\n\tlet newServicesData = null;\n\tif ( rootBlock?.attributes?.metadata?.patternCategory ) {\n\t\tnewServicesData = JSON.parse( JSON.stringify( servicesData ) );\n\t} else {\n\t\tnewServicesData = servicesData;\n\t}\n\n\tlet newStartIndex = startIndex;\n\t// reset the start index if we're changing menu items\n\tif ( rootBlock?.attributes?.metadata?.name === ITEMS_KEY ) {\n\t\tnewStartIndex = startIndex;\n\t} else if ( rootBlock?.attributes?.metadata?.name === ITEM_KEY ) {\n\t\t// increment the start index if we're going to a new menu item\n\t\tnewStartIndex++;\n\t}\n\n\tconst validClassNames = [\n\t\t'is-service-name',\n\t\t'is-service-description',\n\t\t'is-service-link',\n\t];\n\n\tif ( rootBlock?.attributes?.className ) {\n\t\tconst rootBlockClassNames = rootBlock.attributes.className.split( ' ' );\n\n\t\tconst matchingClassName = rootBlockClassNames.find( ( className ) =>\n\t\t\tvalidClassNames.includes( className )\n\t\t);\n\n\t\tif ( matchingClassName ) {\n\t\t\tconst { updatedServicesData, contentValue } =\n\t\t\t\tgetNextAvailableContentValue( {\n\t\t\t\t\tdata: newServicesData,\n\t\t\t\t\ttype: matchingClassName.replace( 'is-service-', '' ),\n\t\t\t\t\toffset: newStartIndex,\n\t\t\t\t} );\n\t\t\tnewServicesData = updatedServicesData;\n\n\t\t\tupdateContent( rootBlock, contentValue, updateBlockAttributes );\n\t\t}\n\t}\n\n\tfor ( const block of rootBlock.innerBlocks ) {\n\t\tnewStartIndex = replaceContent( {\n\t\t\trootBlock: block,\n\t\t\tdata: newServicesData,\n\t\t\tupdateBlockAttributes,\n\t\t\tstartIndex: newStartIndex,\n\t\t} );\n\t}\n\n\treturn newStartIndex;\n}\nfunction getPrompts() {\n\tconst prompts = {\n\t\tsystem: getServicesContentSystemPrompt,\n\t\tuser: 'Generate 6 services relevant for this website based on the description and reason the section exists.',\n\t};\n\n\treturn prompts;\n}\n\nexport default {\n\tname: 'services',\n\tgetPrompts,\n\treplaceContent,\n};\n","/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport { getNextAvailableContentValue } from '../utils.js';\nimport { getTestimonialsContentSystemPrompt } from './system-prompt.js';\nimport { patternKeys } from '@utils/constants';\n\nfunction replaceContent( {\n\trootBlock,\n\tdata: testimonialsData,\n\tupdateBlockAttributes,\n\tstartIndex = -1,\n} ) {\n\tconst { ITEMS_KEY, ITEM_KEY } = patternKeys;\n\tif ( ! testimonialsData ) {\n\t\treturn;\n\t}\n\n\t// If this is the root pattern block, make a deep copy of the data to avoid mutation for other patterns\n\tlet newTestimonialsData = null;\n\tif ( rootBlock?.attributes?.metadata?.patternCategory ) {\n\t\tnewTestimonialsData = JSON.parse( JSON.stringify( testimonialsData ) );\n\t} else {\n\t\tnewTestimonialsData = testimonialsData;\n\t}\n\n\tlet newStartIndex = startIndex;\n\t// reset the start index if we're changing menu items\n\tif ( rootBlock?.attributes?.metadata?.name === ITEMS_KEY ) {\n\t\tnewStartIndex = startIndex;\n\t} else if ( rootBlock?.attributes?.metadata?.name === ITEM_KEY ) {\n\t\t// increment the start index if we're going to a new menu item\n\t\tnewStartIndex++;\n\t}\n\n\tconst validClassNames = [\n\t\t'is-testimonial-name',\n\t\t'is-testimonial-handle',\n\t\t'is-testimonial-review',\n\t];\n\n\tif ( rootBlock?.attributes?.className ) {\n\t\tconst rootBlockClassNames = rootBlock.attributes.className.split( ' ' );\n\n\t\tconst matchingClassName = rootBlockClassNames.find( ( className ) =>\n\t\t\tvalidClassNames.includes( className )\n\t\t);\n\n\t\tif ( matchingClassName ) {\n\t\t\tconst { updatedTestimonialsData, contentValue } =\n\t\t\t\tgetNextAvailableContentValue( {\n\t\t\t\t\tdata: newTestimonialsData,\n\t\t\t\t\ttype: matchingClassName.replace( 'is-testimonial-', '' ),\n\t\t\t\t\toffset: newStartIndex,\n\t\t\t\t} );\n\t\t\tnewTestimonialsData = updatedTestimonialsData;\n\n\t\t\tlet testimonialContent = contentValue;\n\t\t\tif ( matchingClassName === 'is-testimonial-name' ) {\n\t\t\t\ttestimonialContent = __(\n\t\t\t\t\t'Testimonial generated by AI',\n\t\t\t\t\t'big-sky'\n\t\t\t\t);\n\t\t\t} else if ( matchingClassName === 'is-testimonial-handle' ) {\n\t\t\t\t// translators: @generatedbyai is a fake account name we use to make it clear that an AI generated testimonial is AI generated.\n\t\t\t\ttestimonialContent = __( '@generatedbyai', 'big-sky' );\n\t\t\t}\n\n\t\t\tif ( updateBlockAttributes ) {\n\t\t\t\tupdateBlockAttributes( rootBlock.clientId, {\n\t\t\t\t\tcontent: testimonialContent,\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\trootBlock.attributes.content = testimonialContent;\n\t\t\t}\n\t\t}\n\t}\n\n\trootBlock?.innerBlocks.forEach( ( block ) => {\n\t\tnewStartIndex = replaceContent( {\n\t\t\trootBlock: block,\n\t\t\tdata: newTestimonialsData,\n\t\t\tupdateBlockAttributes,\n\t\t\tstartIndex: newStartIndex,\n\t\t} );\n\t} );\n\n\treturn newStartIndex;\n}\n\nfunction getPrompts() {\n\tconst prompts = {\n\t\tsystem: getTestimonialsContentSystemPrompt,\n\t\tuser: 'Generate 4 testimonials for this website based on the description and reason the section exists.',\n\t};\n\treturn prompts;\n}\nexport default {\n\tname: 'testimonials',\n\tgetPrompts,\n\treplaceContent,\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"blocks\"];","/**\n * WordPress dependencies\n */\nimport { createBlock, parse, serialize } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport { getNextAvailableContentValue } from '../utils.js';\nimport { getContactsContentSystemPrompt } from './system-prompt.js';\nimport { patternKeys } from '@utils/constants';\n\n/**\n * Wrap all map blocks in a div with a min-height that matches the map's height\n * to avoid layout shifts. The map block only sets a height on the fully loaded\n * map. While it's loading, it may be a shorter size.\n *\n * @param {Object} block The block to recursively check.\n * @return {Object} The modified block.\n */\nfunction wrapMapBlock( block ) {\n\tif ( block.name === 'jetpack/map' ) {\n\t\treturn createBlock(\n\t\t\t'core/group',\n\t\t\t{\n\t\t\t\tstyle: {\n\t\t\t\t\tdimensions: {\n\t\t\t\t\t\tminHeight: block.attributes.mapHeight,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t[ block ]\n\t\t);\n\t}\n\n\tblock.innerBlocks = block.innerBlocks.map( ( innerBlock ) =>\n\t\twrapMapBlock( innerBlock )\n\t);\n\treturn block;\n}\n\nfunction preprocessSection( pattern ) {\n\tconst parsedPattern = parse( pattern.html );\n\tpattern.html = serialize(\n\t\tparsedPattern.map( ( patternBlock ) => wrapMapBlock( patternBlock ) )\n\t);\n}\n\nfunction replaceContent( {\n\trootBlock,\n\tdata: contactData,\n\tupdateBlockAttributes,\n\tstartIndex = -1,\n} ) {\n\tconst { ITEMS_KEY, ITEM_KEY } = patternKeys;\n\tif ( ! contactData ) {\n\t\treturn;\n\t}\n\n\t// If this is the root pattern block, make a deep copy of the contact data to avoid mutation for other patterns\n\tlet newContactData = null;\n\tif ( rootBlock?.attributes?.metadata?.patternCategory ) {\n\t\tnewContactData = JSON.parse( JSON.stringify( contactData ) );\n\t} else {\n\t\tnewContactData = contactData;\n\t}\n\n\tlet newStartIndex = startIndex;\n\t// reset the start index if we're changing menu items\n\tif ( rootBlock?.attributes?.metadata?.name === ITEMS_KEY ) {\n\t\tnewStartIndex = -1;\n\t} else if ( rootBlock?.attributes?.metadata?.name === ITEM_KEY ) {\n\t\t// increment the start index if we're going to a new menu item\n\t\tnewStartIndex++;\n\t}\n\n\tconst validClassNames = [\n\t\t'is-contact-description',\n\t\t// 123 Example Street\n\t\t// San Franciso, CA 12345\n\t\t'is-contact-address',\n\t\t// (123) 456-7890\n\t\t// hi@mygroovydomain.com\n\t\t'is-contact-phone-email',\n\t\t// 123 Example Street,\n\t\t// San Francisco, CA 12345\n\t\t// (123)-456-7890\n\t\t'is-contact-address-phone',\n\t\t// Monday—Friday\n\t\t// 9am-5pm\n\t\t'is-contact-opening-hours',\n\t];\n\n\tif ( rootBlock?.attributes?.className ) {\n\t\tconst rootBlockClassNames = rootBlock.attributes.className.split( ' ' );\n\n\t\tconst matchingClassName = rootBlockClassNames.find( ( className ) =>\n\t\t\tvalidClassNames.includes( className )\n\t\t);\n\n\t\tif ( matchingClassName ) {\n\t\t\tconst { updatedContactData, contentValue } =\n\t\t\t\tgetNextAvailableContentValue( {\n\t\t\t\t\tdata: newContactData,\n\t\t\t\t\ttype: matchingClassName.replace( 'is-contact-', '' ),\n\t\t\t\t\toffset: newStartIndex,\n\t\t\t\t} );\n\t\t\tnewContactData = updatedContactData;\n\n\t\t\tif ( updateBlockAttributes ) {\n\t\t\t\tupdateBlockAttributes( rootBlock.clientId, {\n\t\t\t\t\tcontent: contentValue,\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\trootBlock.attributes.content = contentValue;\n\t\t\t}\n\t\t}\n\t}\n\n\trootBlock?.innerBlocks.forEach( ( block ) => {\n\t\tnewStartIndex = replaceContent( {\n\t\t\trootBlock: block,\n\t\t\tdata: newContactData,\n\t\t\tupdateBlockAttributes,\n\t\t\tstartIndex: newStartIndex,\n\t\t} );\n\t} );\n\n\treturn newStartIndex;\n}\n\nfunction getPrompts( { siteLocation } ) {\n\tconst prompts = {\n\t\tsystem: getContactsContentSystemPrompt( siteLocation?.name ),\n\t\tuser: `Generate the contact information for this website based on the description and reason the section exists.`,\n\t};\n\treturn prompts;\n}\nexport default {\n\tname: 'contact',\n\tgetPrompts,\n\treplaceContent,\n\tpreprocessSection,\n};\n","import events from './events.js';\nimport footer from './footer.js';\nimport menu from './menus.js';\nimport pricing from './pricing.js';\nimport services from './services.js';\nimport testimonials from './testimonials.js';\nimport contact from './contact.js';\nimport team from './team.js';\n\n// the name here matches the category name in dotcom patterns.\nconst preprocessSectionTypes = {\n\tpricing,\n\tfooter,\n\tcontact,\n};\n\nconst customSectionTypes = {\n\tevents,\n\tmenu,\n\tpricing,\n\tservices,\n\ttestimonials,\n\tcontact,\n\tteam,\n\tfooter,\n};\nconst customSectionNames = Object.keys( customSectionTypes );\nconst preprocessSectionNames = Object.keys( preprocessSectionTypes );\n\nfunction sectionCachedContentIsValid( sectionCachedContent ) {\n\treturn sectionCachedContent?.length > 0;\n}\n\nexport {\n\tcustomSectionNames,\n\tcustomSectionTypes,\n\tpreprocessSectionNames,\n\tpreprocessSectionTypes,\n\tsectionCachedContentIsValid,\n};\n","export default {\n\tname: 'team',\n};\n","/**\n * Internal dependencies\n */\nimport uuidv4 from '@utils/uuid';\nimport patternCategories from '@data/pattern-categories.js';\nimport { customSectionNames } from '@ai/tasks/replace-content/section-types';\nimport { defaultSiteMetadata, dockViews } from '@utils/constants';\n\nconst OPENAI_PRICING = {\n\t'gpt-3.5-turbo-0125': {\n\t\tinputCost: 0.0005, // per 1000/tok\n\t\toutputCost: 0.0015, // per 1000/tok\n\t},\n\t'gpt-4o': {\n\t\tinputCost: 0.005, // per 1000/tok\n\t\toutputCost: 0.015, // per 1000/tok\n\t},\n\t'gpt-4-turbo': {\n\t\tinputCost: 0.01, // per 1000/tok\n\t\toutputCost: 0.03, // per 1000/tok\n\t},\n\t'gpt-4o-mini': {\n\t\tinputCost: 0.00015, // per 1000/tok\n\t\toutputCost: 0.0006, // per 1000/tok\n\t},\n\t'dall-e-3': {\n\t\timageCost: 0.04, // standard quality, 1024x1024\n\t},\n};\n\nconst ANTHROPIC_PRICING = {\n\t'claude-3-5-sonnet-20241022': {\n\t\tinputCost: 0.003, // $3.00 per million tokens\n\t\toutputCost: 0.015, // $15.00 per million tokens\n\t},\n};\n\nconst getPatternCategories = () => {\n\tif ( ! patternCategories ) {\n\t\treturn [];\n\t}\n\n\tconst categories = {};\n\tpatternCategories.forEach( ( category ) => {\n\t\tif ( ! categories[ category.slug ] ) {\n\t\t\tcategories[ category.slug ] = {\n\t\t\t\tdescription: category.description,\n\t\t\t\ttitle: category.title,\n\t\t\t};\n\t\t}\n\t} );\n\n\treturn categories;\n};\n\nexport const initialState = {\n\tbigSkyInitialState: window?.bigSkyInitialState, // Initial state passed from localized_script\n\n\t// chat completion\n\tapiKey: '',\n\tcurrentUserMessage: '',\n\tpendingToolCallbacks: 0,\n\tcurrentToolCall: '',\n\thasRetriedChatRequest: false,\n\tassistant: '',\n\n\t// chat model\n\tadvancedChatModel: 'gpt-4o',\n\tbasicChatModel: 'gpt-4o-mini',\n\timageGenModel: 'dall-e-3',\n\topenAIUsage: {},\n\tanthropicUsage: {},\n\n\t// command palette\n\tcommands: {},\n\n\t// content\n\tstock_photos: {},\n\tselectedSectionContent: {},\n\tcachedContent: {},\n\tpatternCategories: getPatternCategories(),\n\tremotePatterns: [],\n\tgeneratedPatterns: [],\n\tcurrentPageMetadata: {},\n\tnewPageId: false, // the new page id we are creating, otherwise 0.\n\n\t// delay settings\n\tdelaySettings: {\n\t\tonboarding: {\n\t\t\tafterBlockProcessed: 1000,\n\t\t\tafterScrollToBlock: 1500,\n\t\t},\n\t},\n\n\t// dock state\n\tisAssistantButtonVisible: false, // used to override the visibility of the assistant button in handoff dock view\n\tisToolContainerVisible: false, // used to determine if the tool container (sub menu) is visible in the dock\n\ttoolComponent: null,\n\tshowThread: false,\n\tchatComponents: [],\n\tdockView: dockViews.MENUS,\n\tonSelectedBlockAction: {},\n\tinputtedFiles: [],\n\tonInputtedFilesAction: {},\n\tshowChatContinueButton: false,\n\tchatContinueButtonOnClick: () => {},\n\tshowEditorWelcome: false,\n\n\t// editor state\n\tisEditorReady: false, // used to determine if the editor is loaded and contains blocks\n\tisEditorIframeLoaded: false, // used to determine if the editor iframe DOM elements are loaded\n\tisTemplatePartContentReady: false, // used to determine if the template part content is loaded\n\tlastSelectedBlock: null,\n\tlastCancelableAction: {},\n\tblockBeforeChanges: null, // used to cleanly undo a change to a block\n\n\t// handoff\n\thandoffStep: 0,\n\n\t// session logging\n\tlogSessions: true,\n\tsessionId: uuidv4(),\n\n\t// site design\n\t// TODO: update the defaults\n\tchosenCategories: [],\n\tchosenColors: [],\n\tchosenCustomColors: null,\n\tgeneratedVariations: [],\n\tchosenFonts: [],\n\tisBuildingSite: false,\n\tcurrentHandoffArea: 'welcome',\n\tuserStyleWithSettings: {},\n\tcurrentColor: '',\n\tcurrentFont: '',\n\timageStyle: '',\n\tisTyping: false,\n\tsiteMetadata:\n\t\twindow?.bigSkyInitialState?.siteMetadata ?? defaultSiteMetadata,\n\tisMaximized: false,\n\tinitializedCustomScheme: false,\n\thideInput: false,\n\tcustomVariationTemplates: [],\n\tcurrentPaletteColors: [],\n\n\t// Generated Pattern State\n\tgeneratedPatternChunksAsJSON: [],\n\tgeneratedPatternAsBlocks: [],\n\tgeneratedPatternAsString: '',\n\tgeneratedPatternDummySectionClientId: null,\n\tgeneratedRootPatternClientId: null,\n};\n\nexport function getOpenAICost( model, prompt, completion ) {\n\tif ( OPENAI_PRICING[ model ] ) {\n\t\tconst { inputCost, outputCost } = OPENAI_PRICING[ model ];\n\t\tconst inputTokensCost = ( prompt / 1000 ) * inputCost;\n\t\tconst outputTokensCost = ( completion / 1000 ) * outputCost;\n\t\treturn inputTokensCost + outputTokensCost;\n\t}\n\treturn ( ( prompt + completion ) / 1000 ) * 0.03;\n}\n\nexport function getAnthropicCost( model, input, output ) {\n\tif ( ANTHROPIC_PRICING[ model ] ) {\n\t\tconst { inputCost, outputCost } = ANTHROPIC_PRICING[ model ];\n\t\tconst inputTokensCost = ( input / 1000 ) * inputCost;\n\t\tconst outputTokensCost = ( output / 1000 ) * outputCost;\n\t\treturn inputTokensCost + outputTokensCost;\n\t}\n\treturn 0;\n}\n\nexport function reducer( state = initialState, action ) {\n\tconst cachedContentKey = `bigSkyCachedContent${ window.Jetpack_Editor_Initial_State?.wpcomBlogId }`;\n\tswitch ( action.type ) {\n\t\tcase 'SET_LAST_SELECTED_BLOCK':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tlastSelectedBlock: action.payload,\n\t\t\t};\n\t\tcase 'SET_IS_ASSISTANT_BUTTON_VISIBLE':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisAssistantButtonVisible: action.payload,\n\t\t\t};\n\t\tcase 'SET_IS_TOOL_CONTAINER_VISIBLE':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisToolContainerVisible: action.payload,\n\t\t\t};\n\t\tcase 'SET_TOOL_COMPONENT':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttoolComponent: action.payload,\n\t\t\t};\n\t\tcase 'SET_CURRENT_USER_MESSAGE':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcurrentUserMessage: action.payload,\n\t\t\t};\n\t\tcase 'LOG_OPENAI_USAGE':\n\t\t\tconst { model, usage = {} } = action.payload;\n\t\t\tconst newUsage = {\n\t\t\t\tcompletionTokens: 0,\n\t\t\t\tpromptTokens: 0,\n\t\t\t\ttotalTokens: 0,\n\t\t\t\ttotalRequests: 0,\n\t\t\t\testimatedCost: 0,\n\t\t\t\t...state.openAIUsage[ model ],\n\t\t\t};\n\n\t\t\tnewUsage.completionTokens += usage.completion_tokens;\n\t\t\tnewUsage.promptTokens += usage.prompt_tokens;\n\t\t\tnewUsage.totalTokens += usage.total_tokens;\n\t\t\tnewUsage.totalRequests += 1;\n\n\t\t\tconst estimatedCost = getOpenAICost(\n\t\t\t\tmodel,\n\t\t\t\tusage.prompt_tokens,\n\t\t\t\tusage.completion_tokens\n\t\t\t);\n\n\t\t\tnewUsage.estimatedCost += estimatedCost;\n\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\topenAIUsage: {\n\t\t\t\t\t...state.openAIUsage,\n\t\t\t\t\t[ model ]: newUsage,\n\t\t\t\t},\n\t\t\t};\n\t\tcase 'LOG_ANTHROPIC_USAGE':\n\t\t\tconst { model: anthropicModel, usage: anthropicUsage = {} } =\n\t\t\t\taction.payload;\n\t\t\tconst newAnthropicUsage = {\n\t\t\t\tinputTokens: 0,\n\t\t\t\toutputTokens: 0,\n\t\t\t\ttotalTokens: 0,\n\t\t\t\ttotalRequests: 0,\n\t\t\t\testimatedCost: 0,\n\t\t\t\t...state.anthropicUsage[ anthropicModel ],\n\t\t\t};\n\n\t\t\tnewAnthropicUsage.inputTokens += anthropicUsage.input_tokens || 0;\n\t\t\tnewAnthropicUsage.outputTokens += anthropicUsage.output_tokens || 0;\n\t\t\tnewAnthropicUsage.totalTokens =\n\t\t\t\tnewAnthropicUsage.inputTokens + newAnthropicUsage.outputTokens;\n\t\t\tnewAnthropicUsage.totalRequests += 1;\n\n\t\t\tconst estimatedAnthropicCost = getAnthropicCost(\n\t\t\t\tanthropicModel,\n\t\t\t\tanthropicUsage.input_tokens || 0,\n\t\t\t\tanthropicUsage.output_tokens || 0\n\t\t\t);\n\n\t\t\tnewAnthropicUsage.estimatedCost += estimatedAnthropicCost;\n\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tanthropicUsage: {\n\t\t\t\t\t...state.anthropicUsage,\n\t\t\t\t\t[ anthropicModel ]: newAnthropicUsage,\n\t\t\t\t},\n\t\t\t};\n\t\tcase 'SET_LOG_SESSIONS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tlogSessions: action.payload,\n\t\t\t};\n\t\tcase 'SET_SESSION_ID':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tsessionId: action.payload,\n\t\t\t};\n\t\tcase 'SET_SESSION_LOGGED':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tsessionLogged: action.payload,\n\t\t\t};\n\t\tcase 'SET_STOCK_PHOTOS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstock_photos: {\n\t\t\t\t\t...state.stock_photos,\n\t\t\t\t\t[ action.topic ]: action.payload,\n\t\t\t\t},\n\t\t\t};\n\t\tcase 'SET_PATTERN_SHUFFLING_CONTENT':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tselectedSectionContent: {\n\t\t\t\t\t...state.selectedSectionContent,\n\t\t\t\t\t...action.payload,\n\t\t\t\t},\n\t\t\t};\n\t\tcase 'CLEAR_PATTERN_SHUFFLING_CONTENT':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tselectedSectionContent: {},\n\t\t\t};\n\t\tcase 'SET_IS_EDITOR_READY':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisEditorReady: action.payload,\n\t\t\t};\n\t\tcase 'SET_IS_EDITOR_IFRAME_LOADED':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisEditorIframeLoaded: action.payload,\n\t\t\t};\n\t\tcase 'ADD_CACHED_CONTENT':\n\t\t\tconst blockTypes = {\n\t\t\t\tp: 'paragraph',\n\t\t\t\th2: 'heading',\n\t\t\t\tb: 'button',\n\t\t\t};\n\t\t\tconst blockType = blockTypes[ action.payload.type ];\n\t\t\tconst category = action.payload.category;\n\t\t\tconst append = !! action.payload.append;\n\t\t\tlet cachedContent;\n\t\t\tif ( customSectionNames.includes( category ) ) {\n\t\t\t\tconst content = Array.isArray( action.payload.content )\n\t\t\t\t\t? action.payload.content\n\t\t\t\t\t: [ action.payload.content ];\n\t\t\t\tcachedContent = {\n\t\t\t\t\t...state.cachedContent,\n\t\t\t\t};\n\n\t\t\t\tif ( ! cachedContent[ category ] || action.payload.clear ) {\n\t\t\t\t\tcachedContent[ category ] = [];\n\t\t\t\t}\n\n\t\t\t\tconst nameKey = category === 'pricing' ? 'title' : 'name';\n\t\t\t\tcontent.forEach( ( item ) => {\n\t\t\t\t\tconst existingItemIndex = cachedContent[\n\t\t\t\t\t\tcategory\n\t\t\t\t\t].findIndex(\n\t\t\t\t\t\t( cachedItem ) =>\n\t\t\t\t\t\t\tcachedItem[ nameKey ] === item[ nameKey ]\n\t\t\t\t\t);\n\n\t\t\t\t\tif ( existingItemIndex === -1 ) {\n\t\t\t\t\t\tcachedContent[ category ].push( item );\n\t\t\t\t\t} else if ( append ) {\n\t\t\t\t\t\tif ( category === 'menu' || category === 'pricing' ) {\n\t\t\t\t\t\t\tconst subKey =\n\t\t\t\t\t\t\t\tcategory === 'menu' ? 'items' : 'tiers';\n\t\t\t\t\t\t\tcachedContent[ category ][ existingItemIndex ][\n\t\t\t\t\t\t\t\tsubKey\n\t\t\t\t\t\t\t].push( ...item[ subKey ] );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcachedContent[ category ].push( item );\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcachedContent[ category ][ existingItemIndex ] = item;\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tconst cachekey = `${ category }-${ blockType }`;\n\t\t\t\tcachedContent = {\n\t\t\t\t\t...state.cachedContent,\n\t\t\t\t\t[ cachekey ]: [\n\t\t\t\t\t\t...( state.cachedContent[ cachekey ]\n\t\t\t\t\t\t\t? state.cachedContent[ cachekey ]\n\t\t\t\t\t\t\t: [] ),\n\t\t\t\t\t\taction.payload.content,\n\t\t\t\t\t],\n\t\t\t\t};\n\t\t\t}\n\t\t\t// eslint-disable-next-line no-undef\n\t\t\tlocalStorage.setItem(\n\t\t\t\tcachedContentKey,\n\t\t\t\tJSON.stringify( { ...cachedContent, lastUpdated: Date.now() } )\n\t\t\t);\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcachedContent,\n\t\t\t};\n\t\tcase 'SET_CACHED_CONTENT':\n\t\t\t// eslint-disable-next-line no-undef\n\t\t\tlocalStorage.setItem(\n\t\t\t\tcachedContentKey,\n\t\t\t\tJSON.stringify( { ...action.payload, lastUpdated: Date.now() } )\n\t\t\t);\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcachedContent: action.payload,\n\t\t\t};\n\t\tcase 'ADD_CACHED_IMAGE':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcachedContent: {\n\t\t\t\t\t...state.cachedContent,\n\t\t\t\t\timages: [\n\t\t\t\t\t\t...( state.cachedContent.images\n\t\t\t\t\t\t\t? state.cachedContent.images\n\t\t\t\t\t\t\t: [] ),\n\t\t\t\t\t\taction.payload,\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t};\n\t\tcase 'ADD_COMMAND':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcommands: { ...state.commands, ...action.payload },\n\t\t\t};\n\t\tcase 'SET_REMOTE_PATTERNS':\n\t\t\tconst [ remotePatterns, locale ] = action.payload;\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tremotePatterns: {\n\t\t\t\t\t...state.remotePatterns,\n\t\t\t\t\t[ locale ]: remotePatterns,\n\t\t\t\t},\n\t\t\t};\n\t\tcase 'SET_GENERATED_PATTERNS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tgeneratedPatterns: action.payload,\n\t\t\t};\n\t\tcase 'SET_IS_EDITING_PAGE_LAYOUT':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisEditingPageLayout: action.payload,\n\t\t\t};\n\t\tcase 'SET_CURRENT_PAGE_METADATA':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcurrentPageMetadata: action.payload,\n\t\t\t};\n\t\tcase 'SET_IS_BUILDING_SITE':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisBuildingSite: action.payload,\n\t\t\t};\n\t\tcase 'SET_IS_HANDOFF':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisHandoff: action.payload,\n\t\t\t};\n\t\tcase 'SET_CURRENT_HANDOFF_AREA':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcurrentHandoffArea: action.payload,\n\t\t\t};\n\t\tcase 'SET_CHAT_COMPONENTS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tchatComponents: action.payload,\n\t\t\t};\n\t\tcase 'SET_SHOW_THREAD':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tshowThread: action.payload,\n\t\t\t};\n\t\tcase 'SET_CURRENT_TOOL_CALL':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcurrentToolCall: action.payload,\n\t\t\t};\n\t\tcase 'INCREMENT_PENDING_TOOL_CALLBACKS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpendingToolCallbacks: state.pendingToolCallbacks + 1,\n\t\t\t};\n\t\tcase 'DECREMENT_PENDING_TOOL_CALLBACKS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpendingToolCallbacks: state.pendingToolCallbacks - 1,\n\t\t\t};\n\t\tcase 'SET_DOCK_VIEW':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tdockView: action.payload,\n\t\t\t};\n\t\tcase 'SET_LAST_CANCELABLE_ACTION':\n\t\t\tif ( action.payload === null ) {\n\t\t\t\treturn {\n\t\t\t\t\t...state,\n\t\t\t\t\tlastCancelableAction: {},\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tlastCancelableAction: {\n\t\t\t\t\t...state.lastCancelableAction,\n\t\t\t\t\t...action.payload,\n\t\t\t\t},\n\t\t\t};\n\t\tcase 'SET_CHOSEN_CATEGORIES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tchosenCategories: action.payload,\n\t\t\t};\n\t\tcase 'SET_CHOSEN_COLORS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tchosenColors: action.payload,\n\t\t\t};\n\t\tcase 'SET_CHOSEN_CUSTOM_COLORS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tchosenCustomColors: action.payload,\n\t\t\t};\n\t\tcase 'SET_INITIALIZED_CUSTOM_SCHEME':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tinitializedCustomScheme: action.payload,\n\t\t\t};\n\t\tcase 'PUSH_GENERATED_VARIATIONS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tgeneratedVariations: [\n\t\t\t\t\t...action.payload,\n\t\t\t\t\t...state.generatedVariations,\n\t\t\t\t],\n\t\t\t};\n\t\tcase 'SET_CHOSEN_FONTS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tchosenFonts: action.payload,\n\t\t\t};\n\t\tcase 'SET_IMAGE_STYLE':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\timageStyle: action.payload,\n\t\t\t};\n\t\tcase 'SET_BLOCK_BEFORE_CHANGES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tblockBeforeChanges: action.payload,\n\t\t\t};\n\t\tcase 'SET_ON_SELECTED_BLOCK_ACTION':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tonSelectedBlockAction: action.payload,\n\t\t\t};\n\t\tcase 'SET_IS_TEMPLATE_PART_CONTENT_READY':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisTemplatePartContentReady: action.payload,\n\t\t\t};\n\t\tcase 'SET_USER_STYLE_WITH_SETTINGS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tuserStyleWithSettings: action.payload,\n\t\t\t};\n\t\tcase 'SET_INPUTTED_FILES':\n\t\t\tconst current = state.inputtedFiles ?? [];\n\t\t\tconst next = action.payload ?? [];\n\n\t\t\tfor ( const currentFile of current ) {\n\t\t\t\tif (\n\t\t\t\t\tnext.some(\n\t\t\t\t\t\t( nextFile ) => nextFile.url === currentFile.url\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tURL.revokeObjectURL( currentFile.url );\n\t\t\t}\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tinputtedFiles: next,\n\t\t\t};\n\t\tcase 'SET_ON_INPUTTED_FILES_ACTION':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tonInputtedFilesAction: action.payload,\n\t\t\t};\n\t\tcase 'SET_SHOW_CHAT_CONTINUE_BUTTON':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tshowChatContinueButton: action.payload,\n\t\t\t};\n\t\tcase 'SET_CHAT_CONTINUE_BUTTON_ON_CLICK':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tchatContinueButtonOnClick: action.payload,\n\t\t\t};\n\t\tcase 'SET_CURRENT_COLOR':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcurrentColor: action.payload,\n\t\t\t};\n\t\tcase 'SET_CURRENT_FONT':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcurrentFont: action.payload,\n\t\t\t};\n\t\tcase 'SET_IS_TYPING':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisTyping: action.payload,\n\t\t\t};\n\t\tcase 'SET_API_KEY':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tapiKey: action.payload,\n\t\t\t};\n\t\tcase 'SET_HAS_RETRIED_CHAT_REQUEST':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\thasRetriedChatRequest: action.payload,\n\t\t\t};\n\t\tcase 'SET_SITE_METADATA':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tsiteMetadata: {\n\t\t\t\t\t...state.siteMetadata,\n\t\t\t\t\t...action.payload,\n\t\t\t\t},\n\t\t\t};\n\t\tcase 'SET_HANDOFF_STEP':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\thandoffStep: action.payload,\n\t\t\t};\n\t\tcase 'RESET_STORE':\n\t\t\t// this gets called in the error boundary\n\t\t\treturn {\n\t\t\t\t...initialState,\n\t\t\t\t// we need to keep some values from the current state\n\t\t\t\tapiKey: state.apiKey,\n\t\t\t\tstock_photos: state.stock_photos,\n\t\t\t\tcachedContent: state.cachedContent,\n\t\t\t\tpatternCategories: state.patternCategories,\n\t\t\t\tremotePatterns: state.remotePatterns,\n\t\t\t\tcurrentPageMetadata: state.currentPageMetadata,\n\t\t\t\tsiteMetadata: state.siteMetadata,\n\t\t\t};\n\t\tcase 'SET_IS_MAXIMIZED':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisMaximized: action.payload,\n\t\t\t};\n\t\tcase 'SET_HIDE_INPUT':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\thideInput: action.payload,\n\t\t\t};\n\t\tcase 'SET_SHOW_EDITOR_WELCOME':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tshowEditorWelcome: action.payload,\n\t\t\t};\n\t\tcase 'SET_ASSISTANT':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tassistant: action.payload,\n\t\t\t};\n\t\tcase 'SET_CUSTOM_VARIATION_TEMPLATES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcustomVariationTemplates: action.payload,\n\t\t\t};\n\t\tcase 'SET_GENERATED_PATTERN_CHUNKS_AS_JSON':\n\t\t\tif (\n\t\t\t\tArray.isArray( action.payload ) &&\n\t\t\t\taction.payload.length === 0\n\t\t\t) {\n\t\t\t\treturn {\n\t\t\t\t\t...state,\n\t\t\t\t\tgeneratedPatternChunksAsJSON: [],\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tgeneratedPatternChunksAsJSON: [\n\t\t\t\t\t...state.generatedPatternChunksAsJSON,\n\t\t\t\t\t...( Array.isArray( action.payload )\n\t\t\t\t\t\t? action.payload\n\t\t\t\t\t\t: [ action.payload ] ),\n\t\t\t\t],\n\t\t\t};\n\t\tcase 'SET_GENERATED_PATTERN_AS_BLOCKS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tgeneratedPatternAsBlocks: action.payload,\n\t\t\t};\n\t\tcase 'SET_GENERATED_PATTERN_AS_STRING':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tgeneratedPatternAsString: action.payload,\n\t\t\t};\n\t\tcase 'SET_GENERATED_PATTERN_DUMMY_SECTION_CLIENT_ID':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tgeneratedPatternDummySectionClientId: action.payload,\n\t\t\t};\n\t\tcase 'SET_GENERATED_ROOT_PATTERN_CLIENT_ID':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tgeneratedRootPatternClientId: action.payload,\n\t\t\t};\n\t\tcase 'SET_CURRENT_PALETTE_COLORS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcurrentPaletteColors: action.payload,\n\t\t\t};\n\t\tcase 'SET_NEW_PAGE_ID':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tnewPageId: action.payload,\n\t\t\t};\n\t\tdefault:\n\t\t\treturn state;\n\t}\n}\n","export default async function ( delay, callback = false ) {\n\treturn new Promise( ( resolve ) => setTimeout( resolve, delay ) ).then(\n\t\tcallback\n\t);\n}\n","/**\n * External dependencies\n */\nimport createSelector from 'rememo';\n/**\n * WordPress dependencies\n */\nimport { createReduxStore, register } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport {\n\tgenerateImage,\n\tlogOpenAIUsage,\n\trunChatCompletion,\n} from './actions/openai.js';\nimport { reducer } from './reducer.js';\nimport { requestJetpackToken } from '@utils/request-jetpack-token.ts';\nimport debugLog from '@utils/log-debug';\nimport {\n\tpreprocessSectionNames,\n\tpreprocessSectionTypes,\n} from '@ai/tasks/replace-content/section-types/index.js';\nimport patternCategories from '@data/pattern-categories.js';\nimport log from '@utils/log-debug.js';\nimport setDelay from '@utils/set-delay';\nimport apiFetch from '@wordpress/api-fetch';\n\nconst fallbackPhoto = {\n\tID: 1,\n\tURL: 'https://dotcompatterns.wordpress.com/wp-content/uploads/2024/01/paint-wide-3.jpg',\n};\nconst actions = {\n\trunChatCompletion,\n\tgenerateImage,\n\tlogOpenAIUsage,\n\tnextStockPhoto( topic, numImages ) {\n\t\t// we use a redux thunk so we can log the message to the server\n\t\treturn async ( { dispatch, resolveSelect } ) => {\n\t\t\tconst photos = await resolveSelect.getPhotosFromPexels(\n\t\t\t\ttopic,\n\t\t\t\tnumImages\n\t\t\t);\n\n\t\t\tif ( ! photos?.photos || photos?.photos.length === 0 ) {\n\t\t\t\tdebugLog.error( 'Photos not set - falling back to default' );\n\t\t\t\tphotos.photos = [ fallbackPhoto ];\n\t\t\t}\n\n\t\t\t// Remove duplicate photos from the array based on photo.ID\n\t\t\tphotos.photos = photos.photos.filter(\n\t\t\t\t( photo, index, self ) =>\n\t\t\t\t\tindex === self.findIndex( ( t ) => t.ID === photo.ID )\n\t\t\t);\n\n\t\t\t// Shuffle the photos array so we get different combinations in the future\n\t\t\t// eslint-disable-next-line no-restricted-syntax\n\t\t\tphotos.photos.sort( () => 0.5 - Math.random() ); // Shuffle the array\n\n\t\t\tlet photo;\n\t\t\tif ( photos.photos.length === 1 ) {\n\t\t\t\t// We have run out of photos. We will have duplicates, but its better than having no photos.\n\t\t\t\tphoto = photos.photos[ 0 ];\n\t\t\t} else {\n\t\t\t\t// remove and return the first photo\n\t\t\t\tphoto = photos.photos.shift();\n\t\t\t}\n\n\t\t\tdispatch( {\n\t\t\t\ttype: 'SET_STOCK_PHOTOS',\n\t\t\t\tpayload: photos,\n\t\t\t\ttopic,\n\t\t\t} );\n\n\t\t\treturn photo;\n\t\t};\n\t},\n\tremoveOldestMessage() {\n\t\treturn {\n\t\t\ttype: 'SHIFT_MESSAGE',\n\t\t};\n\t},\n\tsetLastSelectedBlock( block ) {\n\t\treturn {\n\t\t\ttype: 'SET_LAST_SELECTED_BLOCK',\n\t\t\tpayload: block,\n\t\t};\n\t},\n\tsetIsAssistantButtonVisible( isAssistantButtonVisible ) {\n\t\treturn {\n\t\t\ttype: 'SET_IS_ASSISTANT_BUTTON_VISIBLE',\n\t\t\tpayload: isAssistantButtonVisible,\n\t\t};\n\t},\n\tsetIsToolContainerVisible( isToolContainerVisible ) {\n\t\treturn {\n\t\t\ttype: 'SET_IS_TOOL_CONTAINER_VISIBLE',\n\t\t\tpayload: isToolContainerVisible,\n\t\t};\n\t},\n\tsetToolComponent( toolComponent ) {\n\t\treturn {\n\t\t\ttype: 'SET_TOOL_COMPONENT',\n\t\t\tpayload: toolComponent,\n\t\t};\n\t},\n\tsetCurrentUserMessage( message ) {\n\t\treturn {\n\t\t\ttype: 'SET_CURRENT_USER_MESSAGE',\n\t\t\tpayload: message,\n\t\t};\n\t},\n\tarchiveMessages() {\n\t\treturn {\n\t\t\ttype: 'ARCHIVE_MESSAGES',\n\t\t};\n\t},\n\tarchiveMessage( id ) {\n\t\treturn {\n\t\t\ttype: 'ARCHIVE_MESSAGE',\n\t\t\tpayload: id,\n\t\t};\n\t},\n\tsetLogSessions( logSessions ) {\n\t\treturn {\n\t\t\ttype: 'SET_LOG_SESSIONS',\n\t\t\tpayload: logSessions,\n\t\t};\n\t},\n\tsetSessionLogged( isLogged ) {\n\t\treturn {\n\t\t\ttype: 'SET_SESSION_LOGGED',\n\t\t\tpayload: isLogged,\n\t\t};\n\t},\n\tdeleteMessage( id ) {\n\t\treturn {\n\t\t\ttype: 'DELETE_MESSAGE',\n\t\t\tpayload: id,\n\t\t};\n\t},\n\tsetSelectedSectionContent( selectedSectionContent ) {\n\t\treturn {\n\t\t\ttype: 'SET_PATTERN_SHUFFLING_CONTENT',\n\t\t\tpayload: selectedSectionContent,\n\t\t};\n\t},\n\tclearSelectedSectionContent() {\n\t\treturn {\n\t\t\ttype: 'CLEAR_PATTERN_SHUFFLING_CONTENT',\n\t\t};\n\t},\n\tsetIsEditorReady( isEditorReady ) {\n\t\treturn {\n\t\t\ttype: 'SET_IS_EDITOR_READY',\n\t\t\tpayload: isEditorReady,\n\t\t};\n\t},\n\tsetIsEditorIframeLoaded( isEditorIframeLoaded ) {\n\t\treturn {\n\t\t\ttype: 'SET_IS_EDITOR_IFRAME_LOADED',\n\t\t\tpayload: isEditorIframeLoaded,\n\t\t};\n\t},\n\taddCachedContent( content ) {\n\t\treturn {\n\t\t\ttype: 'ADD_CACHED_CONTENT',\n\t\t\tpayload: content,\n\t\t};\n\t},\n\taddCachedImage( image ) {\n\t\treturn {\n\t\t\ttype: 'ADD_CACHED_IMAGE',\n\t\t\tpayload: image,\n\t\t};\n\t},\n\taddCommand( command ) {\n\t\treturn {\n\t\t\ttype: 'ADD_COMMAND',\n\t\t\tpayload: command,\n\t\t};\n\t},\n\tresetCachedContent() {\n\t\t// eslint-disable-next-line no-undef\n\t\tlocalStorage.removeItem(\n\t\t\t`bigSkyCachedContent${ window.Jetpack_Editor_Initial_State?.wpcomBlogId }`\n\t\t);\n\t\treturn {\n\t\t\ttype: 'SET_CACHED_CONTENT',\n\t\t\tpayload: {},\n\t\t};\n\t},\n\tsetRemotePatterns( remotePatterns, locale ) {\n\t\treturn {\n\t\t\ttype: 'SET_REMOTE_PATTERNS',\n\t\t\tpayload: [ remotePatterns, locale ],\n\t\t};\n\t},\n\tsetGeneratedPatterns( generatedPatterns ) {\n\t\treturn {\n\t\t\ttype: 'SET_GENERATED_PATTERNS',\n\t\t\tpayload: generatedPatterns,\n\t\t};\n\t},\n\tsetIsEditingPageLayout( isEditingPageLayout ) {\n\t\treturn {\n\t\t\ttype: 'SET_IS_EDITING_PAGE_LAYOUT',\n\t\t\tpayload: isEditingPageLayout,\n\t\t};\n\t},\n\tsetCurrentPageMetadata( currentPageMetadata ) {\n\t\treturn {\n\t\t\ttype: 'SET_CURRENT_PAGE_METADATA',\n\t\t\tpayload: currentPageMetadata,\n\t\t};\n\t},\n\tsetIsBuildingSite( isBuildingSite ) {\n\t\treturn {\n\t\t\ttype: 'SET_IS_BUILDING_SITE',\n\t\t\tpayload: isBuildingSite,\n\t\t};\n\t},\n\tsetIsHandoff( isHandoff ) {\n\t\treturn {\n\t\t\ttype: 'SET_IS_HANDOFF',\n\t\t\tpayload: isHandoff,\n\t\t};\n\t},\n\tsetCurrentHandoffArea( currentHandoffArea ) {\n\t\treturn {\n\t\t\ttype: 'SET_CURRENT_HANDOFF_AREA',\n\t\t\tpayload: currentHandoffArea,\n\t\t};\n\t},\n\tsetChatComponents( chatComponents ) {\n\t\treturn {\n\t\t\ttype: 'SET_CHAT_COMPONENTS',\n\t\t\tpayload: chatComponents,\n\t\t};\n\t},\n\tsetShowThread( showThread ) {\n\t\treturn {\n\t\t\ttype: 'SET_SHOW_THREAD',\n\t\t\tpayload: showThread,\n\t\t};\n\t},\n\tsetCurrentToolCall( currentToolCall ) {\n\t\treturn {\n\t\t\ttype: 'SET_CURRENT_TOOL_CALL',\n\t\t\tpayload: currentToolCall,\n\t\t};\n\t},\n\tincrementPendingToolCallbacks() {\n\t\treturn {\n\t\t\ttype: 'INCREMENT_PENDING_TOOL_CALLBACKS',\n\t\t};\n\t},\n\tdecrementPendingToolCallbacks() {\n\t\treturn {\n\t\t\ttype: 'DECREMENT_PENDING_TOOL_CALLBACKS',\n\t\t};\n\t},\n\tsetDockView( dockView ) {\n\t\treturn {\n\t\t\ttype: 'SET_DOCK_VIEW',\n\t\t\tpayload: dockView,\n\t\t};\n\t},\n\tsetLastCancelableAction( lastCancelableAction ) {\n\t\treturn {\n\t\t\ttype: 'SET_LAST_CANCELABLE_ACTION',\n\t\t\tpayload: lastCancelableAction,\n\t\t};\n\t},\n\tsetChosenCategories( chosenCategories ) {\n\t\treturn {\n\t\t\ttype: 'SET_CHOSEN_CATEGORIES',\n\t\t\tpayload: chosenCategories,\n\t\t};\n\t},\n\tsetChosenColors( chosenColors ) {\n\t\treturn {\n\t\t\ttype: 'SET_CHOSEN_COLORS',\n\t\t\tpayload: chosenColors,\n\t\t};\n\t},\n\tsetChosenCustomColors( chosenCustomColors ) {\n\t\treturn {\n\t\t\ttype: 'SET_CHOSEN_CUSTOM_COLORS',\n\t\t\tpayload: chosenCustomColors,\n\t\t};\n\t},\n\tsetChosenFonts( chosenFonts ) {\n\t\treturn {\n\t\t\ttype: 'SET_CHOSEN_FONTS',\n\t\t\tpayload: chosenFonts,\n\t\t};\n\t},\n\tsetBlockBeforeChanges( blockBeforeChanges ) {\n\t\treturn {\n\t\t\ttype: 'SET_BLOCK_BEFORE_CHANGES',\n\t\t\tpayload: blockBeforeChanges,\n\t\t};\n\t},\n\tsetOnSelectedBlockAction( onSelectedBlockAction ) {\n\t\treturn {\n\t\t\ttype: 'SET_ON_SELECTED_BLOCK_ACTION',\n\t\t\tpayload: onSelectedBlockAction,\n\t\t};\n\t},\n\tsetIsTemplatePartContentReady( isTemplatePartContentReady ) {\n\t\treturn {\n\t\t\ttype: 'SET_IS_TEMPLATE_PART_CONTENT_READY',\n\t\t\tpayload: isTemplatePartContentReady,\n\t\t};\n\t},\n\tsetUserStyleWithSettings( userStyleWithSettings ) {\n\t\treturn {\n\t\t\ttype: 'SET_USER_STYLE_WITH_SETTINGS',\n\t\t\tpayload: userStyleWithSettings,\n\t\t};\n\t},\n\tsetInputtedFiles( inputtedFiles ) {\n\t\treturn {\n\t\t\ttype: 'SET_INPUTTED_FILES',\n\t\t\tpayload: inputtedFiles,\n\t\t};\n\t},\n\tsetOnInputtedFilesAction( onInputtedFilesAction ) {\n\t\treturn {\n\t\t\ttype: 'SET_ON_INPUTTED_FILES_ACTION',\n\t\t\tpayload: onInputtedFilesAction,\n\t\t};\n\t},\n\tsetShowChatContinueButton( showChatContinueButton ) {\n\t\treturn {\n\t\t\ttype: 'SET_SHOW_CHAT_CONTINUE_BUTTON',\n\t\t\tpayload: showChatContinueButton,\n\t\t};\n\t},\n\tsetChatContinueButtonOnClick( chatContinueButtonOnClick ) {\n\t\treturn {\n\t\t\ttype: 'SET_CHAT_CONTINUE_BUTTON_ON_CLICK',\n\t\t\tpayload: chatContinueButtonOnClick,\n\t\t};\n\t},\n\tsetCurrentColor( currentColor ) {\n\t\treturn {\n\t\t\ttype: 'SET_CURRENT_COLOR',\n\t\t\tpayload: currentColor,\n\t\t};\n\t},\n\tsetInitializedCustomScheme( initializedCustomScheme ) {\n\t\treturn {\n\t\t\ttype: 'SET_INITIALIZED_CUSTOM_SCHEME',\n\t\t\tpayload: initializedCustomScheme,\n\t\t};\n\t},\n\tpushGeneratedVariations( generatedVariations ) {\n\t\treturn {\n\t\t\ttype: 'PUSH_GENERATED_VARIATIONS',\n\t\t\tpayload: generatedVariations,\n\t\t};\n\t},\n\tsetCurrentFont( currentFont ) {\n\t\treturn {\n\t\t\ttype: 'SET_CURRENT_FONT',\n\t\t\tpayload: currentFont,\n\t\t};\n\t},\n\tsetImageStyle( imageStyle ) {\n\t\treturn {\n\t\t\ttype: 'SET_IMAGE_STYLE',\n\t\t\tpayload: imageStyle,\n\t\t};\n\t},\n\tsetIsTyping( isTyping ) {\n\t\treturn {\n\t\t\ttype: 'SET_IS_TYPING',\n\t\t\tpayload: isTyping,\n\t\t};\n\t},\n\tsetApiKey( apiKey ) {\n\t\treturn {\n\t\t\ttype: 'SET_API_KEY',\n\t\t\tpayload: apiKey,\n\t\t};\n\t},\n\tsetHasRetriedChatRequest( hasRetriedChatRequest ) {\n\t\treturn {\n\t\t\ttype: 'SET_HAS_RETRIED_CHAT_REQUEST',\n\t\t\tpayload: hasRetriedChatRequest,\n\t\t};\n\t},\n\tsetSiteMetadata( siteMetadata ) {\n\t\treturn {\n\t\t\ttype: 'SET_SITE_METADATA',\n\t\t\tpayload: siteMetadata,\n\t\t};\n\t},\n\tsetHandoffStep( handoffStep ) {\n\t\treturn {\n\t\t\ttype: 'SET_HANDOFF_STEP',\n\t\t\tpayload: handoffStep,\n\t\t};\n\t},\n\tresetStore() {\n\t\treturn {\n\t\t\ttype: 'RESET_STORE',\n\t\t};\n\t},\n\tsetIsMaximized( isMaximized ) {\n\t\treturn {\n\t\t\ttype: 'SET_IS_MAXIMIZED',\n\t\t\tpayload: isMaximized,\n\t\t};\n\t},\n\tsetHideInput( isHidden ) {\n\t\treturn {\n\t\t\ttype: 'SET_HIDE_INPUT',\n\t\t\tpayload: isHidden,\n\t\t};\n\t},\n\tsetShowEditorWelcome( showEditorWelcome ) {\n\t\treturn {\n\t\t\ttype: 'SET_SHOW_EDITOR_WELCOME',\n\t\t\tpayload: showEditorWelcome,\n\t\t};\n\t},\n\tsetAssistant( assistant ) {\n\t\treturn {\n\t\t\ttype: 'SET_ASSISTANT',\n\t\t\tpayload: assistant,\n\t\t};\n\t},\n\tsetGeneratedPatternAsString( generatedPatternAsString ) {\n\t\treturn {\n\t\t\ttype: 'SET_GENERATED_PATTERN_AS_STRING',\n\t\t\tpayload: generatedPatternAsString,\n\t\t};\n\t},\n\tsetGeneratedPatternChunksAsJSON( generatedPatternChunksAsJSON ) {\n\t\treturn {\n\t\t\ttype: 'SET_GENERATED_PATTERN_CHUNKS_AS_JSON',\n\t\t\tpayload: generatedPatternChunksAsJSON,\n\t\t};\n\t},\n\tsetGeneratedPatternAsBlocks( generatedPatternAsBlocks ) {\n\t\treturn {\n\t\t\ttype: 'SET_GENERATED_PATTERN_AS_BLOCKS',\n\t\t\tpayload: generatedPatternAsBlocks,\n\t\t};\n\t},\n\tsetGeneratedPatternDummySectionClientId(\n\t\tgeneratedPatternDummySectionClientId\n\t) {\n\t\treturn {\n\t\t\ttype: 'SET_GENERATED_PATTERN_DUMMY_SECTION_CLIENT_ID',\n\t\t\tpayload: generatedPatternDummySectionClientId,\n\t\t};\n\t},\n\tsetGeneratedRootPatternClientId( generatedRootPatternClientId ) {\n\t\treturn {\n\t\t\ttype: 'SET_GENERATED_ROOT_PATTERN_CLIENT_ID',\n\t\t\tpayload: generatedRootPatternClientId,\n\t\t};\n\t},\n\tlogAnthropicUsage( model, usage ) {\n\t\treturn {\n\t\t\ttype: 'LOG_ANTHROPIC_USAGE',\n\t\t\tpayload: {\n\t\t\t\tmodel,\n\t\t\t\tusage,\n\t\t\t},\n\t\t};\n\t},\n\tsetCurrentPaletteColors( currentPaletteColors ) {\n\t\treturn {\n\t\t\ttype: 'SET_CURRENT_PALETTE_COLORS',\n\t\t\tpayload: currentPaletteColors,\n\t\t};\n\t},\n\tsetNewPageId( newPageId ) {\n\t\treturn {\n\t\t\ttype: 'SET_NEW_PAGE_ID',\n\t\t\tpayload: newPageId,\n\t\t};\n\t},\n};\n\nconst getCurrentMessages = createSelector(\n\t( state ) => {\n\t\tconst currentMessages = state.messages.filter(\n\t\t\t( message ) => ! message.archived\n\t\t);\n\n\t\treturn currentMessages;\n\t},\n\t( state ) => [ state.messages ]\n);\n\nconst getAdditionalContext = createSelector(\n\t( state ) => {\n\t\tconst additionalContext = {};\n\t\tif ( state.bigSkyInitialState?.siteIntent ) {\n\t\t\tadditionalContext.siteIntent = state.bigSkyInitialState.siteIntent;\n\t\t}\n\t\tif (\n\t\t\tstate.bigSkyInitialState?.siteGoals &&\n\t\t\tstate.bigSkyInitialState.siteGoals.length > 0\n\t\t) {\n\t\t\tadditionalContext.siteGoals = state.bigSkyInitialState.siteGoals;\n\t\t}\n\t\treturn additionalContext;\n\t},\n\t( state ) => [ state.bigSkyInitialState ]\n);\n\nconst store = createReduxStore( 'ai-assembler', {\n\treducer,\n\n\tactions,\n\n\tselectors: {\n\t\tgetAdditionalContext,\n\t\tgetCurrentMessages,\n\t\tgetCustomVariationTemplates( state ) {\n\t\t\treturn state.customVariationTemplates;\n\t\t},\n\t\tgetAllMessages( state ) {\n\t\t\treturn state.messages;\n\t\t},\n\t\tcurrentUserMessage( state ) {\n\t\t\treturn state.currentUserMessage;\n\t\t},\n\t\tgetLastSelectedBlock( state ) {\n\t\t\treturn state.lastSelectedBlock;\n\t\t},\n\t\tgetIsAssistantButtonVisible( state ) {\n\t\t\treturn state.isAssistantButtonVisible;\n\t\t},\n\t\tisToolContainerVisible( state ) {\n\t\t\treturn state.isToolContainerVisible;\n\t\t},\n\t\tgetToolComponent( state ) {\n\t\t\treturn state.toolComponent;\n\t\t},\n\t\tgetOpenAIChatUsage( state ) {\n\t\t\treturn state.openAIUsage[ state.advancedChatModel ];\n\t\t},\n\t\tgetOpenAIChat35Usage( state ) {\n\t\t\treturn state.openAIUsage[ 'gpt-3.5-turbo-0125' ];\n\t\t},\n\t\tgetOpenAIImageGenUsage( state ) {\n\t\t\treturn state.openAIUsage[ state.imageGenModel ];\n\t\t},\n\t\tgetAnthropicUsage( state ) {\n\t\t\treturn state.anthropicUsage[ 'claude-3-5-sonnet-20241022' ];\n\t\t},\n\t\tgetAdvancedChatModel( state ) {\n\t\t\treturn state.advancedChatModel;\n\t\t},\n\t\tgetBasicChatModel( state ) {\n\t\t\treturn state.basicChatModel;\n\t\t},\n\t\tgetImageGenModel( state ) {\n\t\t\treturn state.imageGenModel;\n\t\t},\n\t\tshouldLogSessions( state ) {\n\t\t\treturn state.logSessions;\n\t\t},\n\t\tgetSessionId( state ) {\n\t\t\treturn state.sessionId;\n\t\t},\n\t\tisSessionLogged( state ) {\n\t\t\treturn state.sessionLogged;\n\t\t},\n\t\tgetDelaySettings( state ) {\n\t\t\treturn state.delaySettings;\n\t\t},\n\t\tgetPhotosFromPexels( state, topic ) {\n\t\t\treturn state.stock_photos[ topic ] || {};\n\t\t},\n\t\tgetSelectedSectionContent( state ) {\n\t\t\treturn state.selectedSectionContent;\n\t\t},\n\t\tgetIsEditorReady( state ) {\n\t\t\treturn state.isEditorReady;\n\t\t},\n\t\tgetIsEditorIframeLoaded( state ) {\n\t\t\treturn state.isEditorIframeLoaded;\n\t\t},\n\t\tgetCachedContent( state ) {\n\t\t\treturn state.cachedContent;\n\t\t},\n\t\tgetCommands( state ) {\n\t\t\treturn state.commands;\n\t\t},\n\t\tgetPatternCategories( state ) {\n\t\t\treturn state.patternCategories;\n\t\t},\n\t\tgetIsComingSoon( state ) {\n\t\t\treturn state.bigSkyInitialState?.isComingSoon || false;\n\t\t},\n\t\tgetIsBlogPrivate( state ) {\n\t\t\treturn state.bigSkyInitialState?.isBlogPrivate || false;\n\t\t},\n\t\tgetIsDevMode( state ) {\n\t\t\treturn !! state.bigSkyInitialState?.isDevMode;\n\t\t},\n\t\tgetSiteLaunchStatus( state ) {\n\t\t\treturn state.bigSkyInitialState?.launchStatus || '';\n\t\t},\n\t\tgetUserLocale( state ) {\n\t\t\treturn state.bigSkyInitialState?.userLocale || 'en_US';\n\t\t},\n\t\tgetUserLanguage( state ) {\n\t\t\treturn (\n\t\t\t\tstate.bigSkyInitialState?.userLanguage ||\n\t\t\t\t'English (United States)'\n\t\t\t);\n\t\t},\n\t\tgetRemotePatterns( state, locale ) {\n\t\t\treturn state.remotePatterns[ locale ];\n\t\t},\n\t\tgetGeneratedPatterns( state ) {\n\t\t\treturn state.generatedPatterns;\n\t\t},\n\t\tgetIsEditingPageLayout( state ) {\n\t\t\treturn state.isEditingPageLayout;\n\t\t},\n\t\tgetCurrentPageMetadata( state ) {\n\t\t\treturn state.currentPageMetadata;\n\t\t},\n\t\tgetIsBuildingSite( state ) {\n\t\t\treturn state.isBuildingSite;\n\t\t},\n\t\tgetIsHandoff( state ) {\n\t\t\treturn state.isHandoff;\n\t\t},\n\t\tgetCurrentHandoffArea( state ) {\n\t\t\treturn state.currentHandoffArea;\n\t\t},\n\t\tgetChatComponents( state ) {\n\t\t\treturn state.chatComponents;\n\t\t},\n\t\tgetShowThread( state ) {\n\t\t\treturn state.showThread;\n\t\t},\n\t\tgetCurrentToolCall( state ) {\n\t\t\treturn state.currentToolCall;\n\t\t},\n\t\tgetPendingToolCallbacks( state ) {\n\t\t\treturn state.pendingToolCallbacks;\n\t\t},\n\t\tgetDockView( state ) {\n\t\t\treturn state.dockView;\n\t\t},\n\t\tgetLastCancelableAction( state ) {\n\t\t\treturn state.lastCancelableAction;\n\t\t},\n\t\tgetChosenCategories( state ) {\n\t\t\treturn state.chosenCategories;\n\t\t},\n\t\tgetChosenColors( state ) {\n\t\t\treturn state.chosenColors;\n\t\t},\n\t\tgetChosenCustomColors( state ) {\n\t\t\treturn state.chosenCustomColors;\n\t\t},\n\t\tgetInitializedCustomScheme( state ) {\n\t\t\treturn state.initializedCustomScheme;\n\t\t},\n\t\tgetGeneratedVariations( state ) {\n\t\t\treturn state.generatedVariations;\n\t\t},\n\t\tgetChosenFonts( state ) {\n\t\t\treturn state.chosenFonts;\n\t\t},\n\t\tgetBlockBeforeChanges( state ) {\n\t\t\treturn state.blockBeforeChanges;\n\t\t},\n\t\tgetOnSelectedBlockAction( state ) {\n\t\t\treturn state.onSelectedBlockAction;\n\t\t},\n\t\tgetIsTemplatePartContentReady( state ) {\n\t\t\treturn state.isTemplatePartContentReady;\n\t\t},\n\t\tgetUserStyleWithSettings( state ) {\n\t\t\treturn state.userStyleWithSettings;\n\t\t},\n\t\tgetInputtedFiles( state ) {\n\t\t\treturn state.inputtedFiles;\n\t\t},\n\t\tgetOnInputtedFilesAction( state ) {\n\t\t\treturn state.onInputtedFilesAction;\n\t\t},\n\t\tgetShowChatContinueButton( state ) {\n\t\t\treturn state.showChatContinueButton;\n\t\t},\n\t\tgetChatContinueButtonOnClick( state ) {\n\t\t\treturn state.chatContinueButtonOnClick;\n\t\t},\n\t\tgetCurrentColor( state ) {\n\t\t\treturn state.currentColor;\n\t\t},\n\t\tgetCurrentFont( state ) {\n\t\t\treturn state.currentFont;\n\t\t},\n\t\tgetImageStyle( state ) {\n\t\t\treturn state.imageStyle;\n\t\t},\n\t\tgetIsTyping( state ) {\n\t\t\treturn state.isTyping;\n\t\t},\n\t\tgetApiKey( state ) {\n\t\t\treturn state.apiKey;\n\t\t},\n\t\tgetHasRetriedChatRequest( state ) {\n\t\t\treturn state.hasRetriedChatRequest;\n\t\t},\n\t\tgetSiteMetadata( state ) {\n\t\t\treturn state.siteMetadata;\n\t\t},\n\t\tgetHandoffStep( state ) {\n\t\t\treturn state.handoffStep;\n\t\t},\n\t\tgetIsMaximized( state ) {\n\t\t\treturn state.isMaximized;\n\t\t},\n\t\tgetHideInput( state ) {\n\t\t\treturn state.hideInput;\n\t\t},\n\t\tgetShowEditorWelcome( state ) {\n\t\t\treturn state.showEditorWelcome;\n\t\t},\n\t\tgetAssistant( state ) {\n\t\t\treturn state.assistant;\n\t\t},\n\t\tgetGeneratedPatternChunksAsJSON( state ) {\n\t\t\treturn state.generatedPatternChunksAsJSON;\n\t\t},\n\t\tgetGeneratedPatternAsBlocks( state ) {\n\t\t\treturn state.generatedPatternAsBlocks;\n\t\t},\n\t\tgetGeneratedPatternAsString( state ) {\n\t\t\treturn state.generatedPatternAsString;\n\t\t},\n\t\tgetGeneratedPatternDummySectionClientId( state ) {\n\t\t\treturn state.generatedPatternDummySectionClientId;\n\t\t},\n\t\tgetGeneratedRootPatternClientId( state ) {\n\t\t\treturn state.generatedRootPatternClientId;\n\t\t},\n\t\tgetCurrentPaletteColors( state ) {\n\t\t\treturn state.currentPaletteColors;\n\t\t},\n\t\tgetNewPageId( state ) {\n\t\t\treturn state.newPageId;\n\t\t},\n\t},\n\n\tresolvers: {\n\t\t// This is implemented as a resolver now, so that it's fairly easy in the future to make this async and API-driven.\n\t\t// Theoretically this could also be read while initializing state.\n\t\tgetCachedContent:\n\t\t\t() =>\n\t\t\t( { dispatch } ) => {\n\t\t\t\tlet payload = {};\n\t\t\t\t// eslint-disable-next-line no-undef\n\t\t\t\tconst content = localStorage.getItem(\n\t\t\t\t\t`bigSkyCachedContent${ window.Jetpack_Editor_Initial_State?.wpcomBlogId }`\n\t\t\t\t);\n\t\t\t\tif ( content ) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tpayload = JSON.parse( content );\n\t\t\t\t\t} catch ( e ) {\n\t\t\t\t\t\tdebugLog.error( 'Failed to parse cached content', e );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdispatch( {\n\t\t\t\t\ttype: 'SET_CACHED_CONTENT',\n\t\t\t\t\tpayload,\n\t\t\t\t} );\n\t\t\t},\n\t\tgetPhotosFromPexels: ( search, numImages ) => {\n\t\t\tconst siteTypeFallbacks = {\n\t\t\t\tfoodAndBeverage: 'food and drink',\n\t\t\t\tbusiness: 'business people',\n\t\t\t\tblog: 'writing',\n\t\t\t\tportfolio: 'art',\n\t\t\t\tpersonal: 'writing',\n\t\t\t};\n\t\t\treturn async ( { dispatch, select } ) => {\n\t\t\t\tconst fetchWithRetry = async (\n\t\t\t\t\tsearchTerm,\n\t\t\t\t\tcount,\n\t\t\t\t\tretries = 3\n\t\t\t\t) => {\n\t\t\t\t\tfor ( let attempt = 1; attempt <= retries; attempt++ ) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst jetpackToken = await requestJetpackToken(\n\t\t\t\t\t\t\t\tattempt === 1\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif ( ! jetpackToken ) {\n\t\t\t\t\t\t\t\tthrow new Error( `No Jetpack token` );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst request = await fetch(\n\t\t\t\t\t\t\t\t`https://public-api.wordpress.com/wpcom/v2/meta/external-media/pexels?number=${ count }&path=recent&search=` +\n\t\t\t\t\t\t\t\t\tencodeURIComponent( searchTerm ),\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\t\tAuthorization: `X_JETPACK_JWT ${ jetpackToken.token }`,\n\t\t\t\t\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif ( ! request.ok ) {\n\t\t\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t\t\t`HTTP error! status: ${ request.status }`\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst results = await request.json();\n\t\t\t\t\t\t\treturn results?.media || [];\n\t\t\t\t\t\t} catch ( error ) {\n\t\t\t\t\t\t\tif ( attempt >= retries ) {\n\t\t\t\t\t\t\t\tthrow error;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Wait before retrying, with exponential backoff\n\t\t\t\t\t\t\tconst delay = Math.min(\n\t\t\t\t\t\t\t\t1000 * Math.pow( 2, attempt - 1 ),\n\t\t\t\t\t\t\t\t5000\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tawait setDelay( delay );\n\n\t\t\t\t\t\t\tlog.info(\n\t\t\t\t\t\t\t\t`Attempt ${ attempt } failed, retrying after ${ delay }ms delay...`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn [];\n\t\t\t\t};\n\n\t\t\t\ttry {\n\t\t\t\t\t// First API call with the original search term\n\t\t\t\t\tconst firstResults = await fetchWithRetry(\n\t\t\t\t\t\tsearch,\n\t\t\t\t\t\tnumImages\n\t\t\t\t\t);\n\n\t\t\t\t\tlet allPhotos = [ ...firstResults ];\n\n\t\t\t\t\t// If we got fewer than the number of images we requested make a second call with a more generic fallback topic.\n\t\t\t\t\tif ( firstResults.length < numImages ) {\n\t\t\t\t\t\tconst genericTopic =\n\t\t\t\t\t\t\tsiteTypeFallbacks[\n\t\t\t\t\t\t\t\tselect.getSiteMetadata()?.siteType\n\t\t\t\t\t\t\t] || 'people or places';\n\n\t\t\t\t\t\tconst remainingCount = numImages - firstResults.length;\n\t\t\t\t\t\tconst secondResults = await fetchWithRetry(\n\t\t\t\t\t\t\tgenericTopic,\n\t\t\t\t\t\t\tremainingCount\n\t\t\t\t\t\t);\n\t\t\t\t\t\tallPhotos = [ ...allPhotos, ...secondResults ];\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( allPhotos.length === 0 ) {\n\t\t\t\t\t\tallPhotos = [ fallbackPhoto ];\n\t\t\t\t\t}\n\n\t\t\t\t\tdispatch( {\n\t\t\t\t\t\ttype: 'SET_STOCK_PHOTOS',\n\t\t\t\t\t\tpayload: {\n\t\t\t\t\t\t\tindex: 0,\n\t\t\t\t\t\t\tphotos: allPhotos,\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttopic: search,\n\t\t\t\t\t} );\n\t\t\t\t} catch ( error ) {\n\t\t\t\t\tlog.error(\n\t\t\t\t\t\t'Failed to fetch stock photos from Pexels after retry',\n\t\t\t\t\t\terror\n\t\t\t\t\t);\n\t\t\t\t\t// Use fallback photo after all retries fail\n\t\t\t\t\tdispatch( {\n\t\t\t\t\t\ttype: 'SET_STOCK_PHOTOS',\n\t\t\t\t\t\tpayload: {\n\t\t\t\t\t\t\tindex: 0,\n\t\t\t\t\t\t\tphotos: [ fallbackPhoto ],\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttopic: search,\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tgetRemotePatterns: ( locale ) => {\n\t\t\treturn async ( { dispatch } ) => {\n\t\t\t\tconst categoriesToAllowAll = [\n\t\t\t\t\t'header',\n\t\t\t\t\t'menu',\n\t\t\t\t\t'intro',\n\t\t\t\t\t'link-in-bio',\n\t\t\t\t\t'team',\n\t\t\t\t\t'posts',\n\t\t\t\t\t'events',\n\t\t\t\t\t'about',\n\t\t\t\t\t'services',\n\t\t\t\t];\n\n\t\t\t\tconst filterRemotePatterns = ( remotePatterns ) => {\n\t\t\t\t\t// Filter only the patterns we want to include in Big Sky\n\t\t\t\t\treturn remotePatterns.filter( ( pattern ) => {\n\t\t\t\t\t\t// Check if pattern has any category from categoriesToAllowAll\n\t\t\t\t\t\tconst hasAllowedCategory = categoriesToAllowAll.some(\n\t\t\t\t\t\t\t( category ) => pattern.categories?.[ category ]\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif ( hasAllowedCategory ) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Check for is_included_in_big_sky for all other categories:\n\t\t\t\t\t\treturn pattern.is_included_in_big_sky;\n\t\t\t\t\t} );\n\t\t\t\t};\n\n\t\t\t\tconst fetchWithRetry = async ( retries = 3 ) => {\n\t\t\t\t\tfor ( let attempt = 1; attempt <= retries; attempt++ ) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst request = await fetch(\n\t\t\t\t\t\t\t\t`https://public-api.wordpress.com/rest/v1.1/ptk/patterns/${ encodeURIComponent(\n\t\t\t\t\t\t\t\t\tlocale\n\t\t\t\t\t\t\t\t) }?post_type=wp_block&per_page=10000`\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif ( ! request.ok ) {\n\t\t\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t\t\t`HTTP error! status: ${ request.status }`\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst results = await request.json();\n\n\t\t\t\t\t\t\tif ( results ) {\n\t\t\t\t\t\t\t\tconst filteredPatterns =\n\t\t\t\t\t\t\t\t\tfilterRemotePatterns( results );\n\t\t\t\t\t\t\t\t// get unique slugs from patternCategories\n\t\t\t\t\t\t\t\tconst patternCategoryNames = [\n\t\t\t\t\t\t\t\t\t...new Set(\n\t\t\t\t\t\t\t\t\t\tpatternCategories.map(\n\t\t\t\t\t\t\t\t\t\t\t( category ) => category.slug\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t];\n\n\t\t\t\t\t\t\t\t// add category prop to be the first category slug\n\t\t\t\t\t\t\t\tfilteredPatterns.forEach( ( pattern ) => {\n\t\t\t\t\t\t\t\t\tconst categories = pattern.categories;\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tObject.keys( categories ).length === 0\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// find the first category that is within patternCategoryNames\n\t\t\t\t\t\t\t\t\tfor ( const key in categories ) {\n\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\tpatternCategoryNames.includes( key )\n\t\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t\tpattern.category = key;\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// apply any Big Sky specific HTML transformations\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tpreprocessSectionNames.includes(\n\t\t\t\t\t\t\t\t\t\t\tpattern.category\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\tpreprocessSectionTypes[\n\t\t\t\t\t\t\t\t\t\t\tpattern.category\n\t\t\t\t\t\t\t\t\t\t].preprocessSection( pattern );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\t\tdispatch( {\n\t\t\t\t\t\t\t\t\ttype: 'SET_REMOTE_PATTERNS',\n\t\t\t\t\t\t\t\t\tpayload: [ filteredPatterns, locale ],\n\t\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch ( error ) {\n\t\t\t\t\t\t\tif ( attempt >= retries ) {\n\t\t\t\t\t\t\t\tlog.error(\n\t\t\t\t\t\t\t\t\t`Failed to fetch remote patterns after ${ retries } attempts`,\n\t\t\t\t\t\t\t\t\terror\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tthrow error;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Wait before retrying, with exponential backoff\n\t\t\t\t\t\t\tconst delay = Math.min(\n\t\t\t\t\t\t\t\t1000 * Math.pow( 2, attempt - 1 ),\n\t\t\t\t\t\t\t\t5000\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tawait setDelay( delay );\n\n\t\t\t\t\t\t\tlog.info(\n\t\t\t\t\t\t\t\t`Attempt ${ attempt } failed, retrying after ${ delay }ms delay...`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\ttry {\n\t\t\t\t\tawait fetchWithRetry();\n\t\t\t\t} catch ( error ) {\n\t\t\t\t\t// Final error handling after all retries have failed\n\t\t\t\t\tlog.error(\n\t\t\t\t\t\t'All retry attempts failed to fetch remote patterns',\n\t\t\t\t\t\terror\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tgetCustomVariationTemplates: () => {\n\t\t\treturn async ( { dispatch } ) => {\n\t\t\t\tconst request = await apiFetch( {\n\t\t\t\t\tpath: '/wpcom/v2/big-sky/v1/variation-templates/colors',\n\t\t\t\t} );\n\t\t\t\tdispatch( {\n\t\t\t\t\ttype: 'SET_CUSTOM_VARIATION_TEMPLATES',\n\t\t\t\t\tpayload: request,\n\t\t\t\t} );\n\t\t\t};\n\t\t},\n\t},\n} );\n\nregister( store );\nexport { store };\n","/**\n * WordPress dependencies\n */\nimport { useDispatch } from '@wordpress/data';\nimport { useEffect } from '@wordpress/element';\nimport Markdown from 'react-markdown';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\nimport { store as aiStore } from '@store';\n\nexport default function Notice( { notice, type = 'info', delay = 3000 } ) {\n\tconst { setIsToolContainerVisible, setToolComponent } =\n\t\tuseDispatch( aiStore );\n\n\t// fade out the notice after 3 seconds\n\tuseEffect( () => {\n\t\tlet removeTimeout;\n\t\tif ( delay > 0 ) {\n\t\t\tremoveTimeout = setTimeout( () => {\n\t\t\t\tsetIsToolContainerVisible( false );\n\t\t\t\tsetToolComponent( null );\n\t\t\t}, delay );\n\t\t}\n\n\t\treturn () => {\n\t\t\tif ( removeTimeout ) {\n\t\t\t\tclearTimeout( removeTimeout );\n\t\t\t}\n\t\t};\n\t}, [ delay, setIsToolContainerVisible, setToolComponent ] );\n\n\treturn (\n\t\t<div\n\t\t\tclassName={ `big-sky__dock__notice big-sky__dock__notice-${ type }` }\n\t\t>\n\t\t\t<Markdown>{ notice }</Markdown>\n\t\t</div>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport Notice from '@components/dock/notice';\nimport { store as aiStore } from '@store';\n\nexport const useHandleReset = () => {\n\tconst { resetStore, setToolComponent, setIsToolContainerVisible } =\n\t\tuseDispatch( aiStore );\n\n\treturn () => {\n\t\tresetStore();\n\t\tsetToolComponent(\n\t\t\t<Notice\n\t\t\t\tnotice={ __(\n\t\t\t\t\t\"We couldn't complete that request. Please try again.\",\n\t\t\t\t\t'big-sky'\n\t\t\t\t) }\n\t\t\t\ttype=\"error\"\n\t\t\t/>\n\t\t);\n\t\tsetIsToolContainerVisible( true );\n\t};\n};\n\nexport default useHandleReset;\n","/**\n * WordPress dependencies\n */\nimport { useDispatch } from '@wordpress/data';\nimport { useCallback } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\n\nimport useHandleReset from '@hooks/use-handle-reset.js';\nimport { store as aiStore } from '@store';\nimport setDelay from '@utils/set-delay';\nimport log from '@utils/log-debug';\n\nconst useCreateToolCallback = () => {\n\tconst handleReset = useHandleReset();\n\n\tconst {\n\t\tdecrementPendingToolCallbacks,\n\t\tincrementPendingToolCallbacks,\n\t\tsetCurrentToolCall,\n\t} = useDispatch( aiStore );\n\n\tconst withPendingToolCallback = useCallback(\n\t\t( callback ) => async ( args ) => {\n\t\t\tincrementPendingToolCallbacks();\n\t\t\t// Because replaceContentAgent is sync a delay is needed here for the pending increment to be registered by the dock component.\n\t\t\tawait setDelay( 200 );\n\t\t\tawait callback( args );\n\t\t\tdecrementPendingToolCallbacks();\n\t\t},\n\t\t[ decrementPendingToolCallbacks, incrementPendingToolCallbacks ]\n\t);\n\n\tconst createToolCallback =\n\t\t( {\n\t\t\tname,\n\t\t\taction,\n\t\t\tcloseChatWhenDone = () => true, // Set to false to keep the chat open after the tool runs.\n\t\t\tvalidator = null,\n\t\t\tfailValidatorAction = null,\n\t\t} ) =>\n\t\tasync ( args ) => {\n\t\t\tsetCurrentToolCall( name );\n\n\t\t\tif ( validator ) {\n\t\t\t\ttry {\n\t\t\t\t\tconst isValid = await validator( args );\n\t\t\t\t\tif ( ! isValid ) {\n\t\t\t\t\t\tif ( typeof failValidatorAction === 'function' ) {\n\t\t\t\t\t\t\tawait failValidatorAction( args, {\n\t\t\t\t\t\t\t\tmessage: 'Failed to validate arguments',\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} catch ( error ) {\n\t\t\t\t\tif ( typeof failValidatorAction === 'function' ) {\n\t\t\t\t\t\tawait failValidatorAction( args, error );\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst executeAction = async ( _args ) => {\n\t\t\t\ttry {\n\t\t\t\t\tawait action( _args );\n\t\t\t\t} catch ( error ) {\n\t\t\t\t\tlog.error( 'Tool error:', error );\n\t\t\t\t\thandleReset();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Some tools keep the chat open, some close afterward.\n\t\t\t// closeChatWhenDone() is a function because it needs to be called when the callback runs, not when the tool is created.\n\t\t\t// Otherwise, getIsHandoff() will not return the updated value.\n\t\t\tif ( closeChatWhenDone() ) {\n\t\t\t\twithPendingToolCallback( executeAction )( args );\n\t\t\t} else {\n\t\t\t\tawait executeAction( args );\n\t\t\t}\n\t\t};\n\n\treturn {\n\t\twithPendingToolCallback,\n\t\tcreateToolCallback,\n\t};\n};\n\nexport default useCreateToolCallback;\n","// Initialize empty registries\nconst assistantsRegistry = new Map();\nconst assistantsList = [];\n\n/**\n * Registers an assistant in the registry\n * @param {Object} assistant The assistant to register\n */\nexport function registerAssistant( assistant ) {\n\tassistantsRegistry.set( assistant.id, assistant );\n\tassistantsList.push( assistant );\n}\n\n/**\n * Gets an assistant by ID\n * @param {string} id The assistant ID\n * @return {Object|undefined} The assistant object or undefined\n */\nexport function getAssistantById( id ) {\n\treturn assistantsRegistry.get( id );\n}\n\n/**\n * Gets all registered assistants\n * @return {Array} Array of assistant objects\n */\nexport function getAssistants() {\n\treturn assistantsList;\n}\n\n/**\n * Gets the toolkit name for an assistant\n * @param {string} assistantId The assistant ID\n * @return {string|undefined} The toolkit name or undefined\n */\nexport function getAssistantToolkitName( assistantId ) {\n\tconst assistant = getAssistantById( assistantId );\n\treturn assistant?.toolkits?.[ 0 ]?.name;\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\nimport { useRef } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { useChat, useToolkits } from '@automattic/big-sky-agents';\nimport log from '@utils/log-debug';\nimport { store as aiStore } from '@store/index';\nimport { ASSISTANTS } from '@ai/assistants/constants.js';\nimport { messageRoles } from '@utils/constants';\nimport { getAssistantToolkitName } from '@ai/assistants/assistant-registry.js';\n\nexport default function useChangeAssistantTool() {\n\tconst MAX_CONSECUTIVE_CHANGES = 3;\n\tconst MAX_HISTORY_LENGTH = 4; // Track last 4 changes to detect loops\n\tconst { setAssistant } = useDispatch( aiStore );\n\tconst {\n\t\tagentSay,\n\t\tuserSayRepeat,\n\t\tgetChangeAgentCount,\n\t\tincrementChangeAgentCount,\n\t\tresetChangeAgentCount,\n\t\tclearMessages,\n\t} = useChat();\n\tconst { setContext } = useToolkits();\n\n\t// Track history of changes\n\tconst changesHistory = useRef( [] );\n\n\tconst changeAssistant = ( parameters ) => {\n\t\tif (\n\t\t\thasReachedMaxChanges( parameters.userRequest ) ||\n\t\t\tisLoopDetected( parameters )\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tlog.info(\n\t\t\t`🔔 Changing the assistant:\n\t-- To: ${ parameters.toAssistantId }\n\t-- From: ${ parameters.fromAssistantId }\n\t-- Reason: ${ parameters.reason }`\n\t\t);\n\n\t\t// Add this change to history\n\t\tchangesHistory.current = [\n\t\t\t{\n\t\t\t\ttoAssistantId: parameters.toAssistantId,\n\t\t\t\tfromAssistantId: parameters.fromAssistantId,\n\t\t\t},\n\t\t\t...changesHistory.current,\n\t\t].slice( 0, MAX_HISTORY_LENGTH );\n\n\t\tsetAssistant( parameters.toAssistantId );\n\t\tincrementChangeAgentCount();\n\t\tclearMessages( messageRoles.TOOL );\n\t\tclearMessages( messageRoles.SYSTEM );\n\n\t\tif (\n\t\t\tparameters.fromAssistantId === ASSISTANTS.ROUTER &&\n\t\t\tparameters.toAssistantId !== ASSISTANTS.HELP\n\t\t) {\n\t\t\tconst toolkitName = getAssistantToolkitName(\n\t\t\t\tparameters.toAssistantId\n\t\t\t);\n\t\t\tif ( toolkitName ) {\n\t\t\t\tsetContext( toolkitName, {\n\t\t\t\t\tfromAssistantId: parameters.fromAssistantId,\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\n\t\tif ( parameters.toAssistantId === ASSISTANTS.HELP ) {\n\t\t\tconst toolkitName = getAssistantToolkitName(\n\t\t\t\tparameters.toAssistantId\n\t\t\t);\n\t\t\tif ( toolkitName ) {\n\t\t\t\tsetContext( toolkitName, {\n\t\t\t\t\tfromAssistantId: parameters.fromAssistantId,\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\n\t\tuserSayRepeat();\n\n\t\treturn 'Assistant changed';\n\t};\n\n\tconst hasReachedMaxChanges = ( userRequest ) => {\n\t\tconst changeAgentCount = getChangeAgentCount();\n\n\t\tif ( changeAgentCount > MAX_CONSECUTIVE_CHANGES ) {\n\t\t\tlogRoutingError( 'maxRetriesReached', userRequest );\n\t\t\tresetChangeAgentCount();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\n\tconst isLoopDetected = ( parameters ) => {\n\t\tif ( changesHistory.current.length < 2 ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Check for immediate back-and-forth\n\t\tconst isImmediateLoop =\n\t\t\tchangesHistory.current[ 0 ]?.toAssistantId ===\n\t\t\t\tparameters.fromAssistantId &&\n\t\t\tchangesHistory.current[ 0 ]?.fromAssistantId ===\n\t\t\t\tparameters.toAssistantId;\n\n\t\t// Check for pattern of repeated switching (e.g. router->color->router->color)\n\t\tconst isPatternLoop =\n\t\t\tchangesHistory.current.length >= 3 &&\n\t\t\tchangesHistory.current[ 2 ]?.toAssistantId ===\n\t\t\t\tparameters.toAssistantId &&\n\t\t\tchangesHistory.current[ 2 ]?.fromAssistantId ===\n\t\t\t\tparameters.fromAssistantId &&\n\t\t\tchangesHistory.current[ 1 ]?.toAssistantId ===\n\t\t\t\tchangesHistory.current[ 0 ]?.fromAssistantId &&\n\t\t\tchangesHistory.current[ 1 ]?.fromAssistantId ===\n\t\t\t\tchangesHistory.current[ 0 ]?.toAssistantId;\n\n\t\tif ( isImmediateLoop || isPatternLoop ) {\n\t\t\tlogRoutingError( 'loopDetected', parameters.userRequest );\n\t\t\tresetChangeAgentCount();\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tconst logRoutingError = ( error, userRequest ) => {\n\t\tlog.error( 'Router error:', error, userRequest );\n\t\tagentSay(\n\t\t\t__(\n\t\t\t\t'I am sorry, I had trouble processing that request. Please try again.',\n\t\t\t\t'big-sky'\n\t\t\t)\n\t\t);\n\t};\n\n\treturn {\n\t\tchangeAssistant,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { useEffect } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * External dependencies\n */\nimport { useToolkits } from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport useCreateToolCallback from '../shared/use-create-tool-callback.js';\nimport useChangeAssistantTool from '@ai/assistants/shared/change-assistant/use-change-assistant-tool.js';\nimport routerToolkit from './toolkit.js';\n\nconst useRouterToolkit = () => {\n\tconst { createToolCallback } = useCreateToolCallback();\n\tconst { changeAssistant } = useChangeAssistantTool();\n\tconst { setCallbacks, setContext } = useToolkits();\n\n\tconst { selectedBlock } = useSelect( ( select ) => {\n\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\n\t\treturn {\n\t\t\tselectedBlock: getSelectedBlock(),\n\t\t};\n\t} );\n\tuseEffect( () => {\n\t\tsetCallbacks( routerToolkit.name, {\n\t\t\tchange_assistant: createToolCallback( {\n\t\t\t\tname: 'change_assistant',\n\t\t\t\taction: ( _args ) => {\n\t\t\t\t\tchangeAssistant( _args );\n\t\t\t\t},\n\t\t\t\tcloseChatWhenDone: () => false,\n\t\t\t} ),\n\t\t} );\n\t\tsetContext( routerToolkit.name, { selectedBlock } );\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ setCallbacks ] );\n\n\tuseEffect( () => {\n\t\tsetContext( routerToolkit.name, { selectedBlock } );\n\t}, [ selectedBlock, setContext ] );\n};\n\nexport default useRouterToolkit;\n","import routerAssistantPrompt from './prompt.js';\nimport routerToolkit from './toolkit.js';\nimport { ASSISTANTS } from '../constants.js';\nimport useRouterToolkit from './use-router-toolkit.js';\n\nconst routerAssistant = {\n\tid: ASSISTANTS.ROUTER,\n\tdescription:\n\t\t'An assistant that analyzes user requests and routes them to the most appropriate specialized assistant.',\n\tinstructions: ( context ) => {\n\t\treturn routerAssistantPrompt( context );\n\t},\n\ttags: [ ASSISTANTS.ROUTER ],\n\ttoolkits: [ routerToolkit ],\n\ttoolkitHook: useRouterToolkit,\n\tonStart: ( invoke, clearMessages = () => {}, agentMessage = null ) => {\n\t\tif ( agentMessage ) {\n\t\t\tclearMessages();\n\t\t\tinvoke.agentSay( agentMessage );\n\t\t}\n\t},\n};\n\nexport default routerAssistant;\n","import { ASSISTANTS } from '../constants.js';\nimport {\n\tanalysisPrompt,\n\tgetSelectedBlockContextPrompt,\n\thelpActionPrompt,\n\tinvalidRequestPrompt,\n\tlanguagePrompt,\n} from '../shared/prompts.js';\n\nexport default function routerAssistantPrompt( context ) {\n\tconst prompt = `\nYou are a router system for a website builder platform. Your role is to analyze user requests and route them to the appropriate assistant by calling the 'change_assistant' tool with the correct assistant ID.\n\nHere is the current context, use this to inform your responses:\n\n<selected_block_context>\n${ getSelectedBlockContextPrompt( context, [ 'clientId', 'type' ] ) }\n</selected_block_context>\n\nHere is the language you should use for responses unless explicitly instructed otherwise:\n\n<language>\n${ languagePrompt }\n</language>\n\nHere are the available assistants and their tools:\n\n<color_assistant>\nColor Assistant (ID: ${ ASSISTANTS.COLOR })\n\nDescription:\n   - An assistant specializing in color palette creation, selection, and assisting users with website color modifications.\n\nTools:\n   - color_palette_generator: Generates color palettes\n   - update_component_color: Updates colors of specific components\n</color_assistant>\n\n<content_assistant>\nContent Assistant (ID: ${ ASSISTANTS.CONTENT })\n\nDescription:\n   - An expert content writer and editor assistant, specializing in website content creation and editing. The primary goal is to help users improve their website content and editing content within existing patterns/sections.\n\nTools:\n   - rewrite_content: Rewrites text content in blocks to change the tone or spelling.\n   - make_text_bold_italic: Formats text content, only supports making it bold or italic\n   - update_button_link: Updates button links to a new URL\n   - upsert_social_link: Adds/updates social media links in the social links block\n   - update_address: Updates address information within an already existing contact form section/pattern\n   - add_container_to_events_section: Adds an events container to an existing events section/pattern\n   - add_item_to_events_container: Adds an events item to an existing events container\n   - add_container_to_menu_section: Adds a menu container to an existing menu section/pattern\n   - add_item_to_menu_container: Adds a menu item to an existing menu container\n   - modify_contact_form_fields: Adds and removes fields from an existing contact form section/pattern\n   - add_container_to_services_section: Adds a services container to an existing services section/pattern\n   - add_item_to_testimonials_section: Adds a testimonials item to an existing testimonials section/pattern\n   - add_container_to_pricing_section: Adds a pricing container to an existing pricing section/pattern\n   - add_container_to_team_section: Adds a team container to an existing team section/pattern\n   - add_member_to_team_container: Adds a team member to an existing team section/pattern\n   - make_suggestion: Makes content suggestions\n   - start_over: Resets content changes\n\nNote:\n   - Does not support adding entirely new sections/patterns.\n</content_assistant>\n\n<font_assistant>\nFont Assistant (ID: ${ ASSISTANTS.FONT })\n\nDescription:\n   - An assistant specializing in font selection and helping users modify their website fonts.\n\nTools:\n   - show_font_picker: Shows font selection interface\n</font_assistant>\n\n<help_assistant>\nHelp Assistant (ID: ${ ASSISTANTS.HELP })\n\nDescription:\n   - An assistant specializing in answering questions about WordPress, website building, and technical guidance.\n\nTools:\n   - ask_wordpress_expert: Asks WordPress expert for help\n</help_assistant>\n\n<image_assistant>\nImage Assistant (ID: ${ ASSISTANTS.IMAGE })\n\nDescription:\n   - An assistant specializing in the generation and fetching of images and site logos.\n\nTools:\n   - generate_image: Generates AI images\n   - get_stock_image: Retrieves stock images\n   - generate_site_logo: Generates site logos with AI\n   - upload_site_logo: Handles site logo uploads\n\nNote:\n  - Does not support modifying images in any other way.\n</image_assistant>\n\n<layout_assistant>\nLayout Assistant (ID: ${ ASSISTANTS.LAYOUT })\n\nDescription:\n   - An assistant specializing in full page layouts to allow users to modify the layout for their entire website page.\n\nTools:\n   - show_layout_picker: Shows the user the full page layout options to select from\n\nNote:\n   - Does not support changing padding, margins, or other layout settings.\n</layout_assistant>\n\n<page_assistant>\nPage Assistant (ID: ${ ASSISTANTS.PAGE })\n\nDescription:\n   - An assistant specializing in creating new pages and navigating between pages.\n\nTools:\n   - add_page: Adds new pages\n   - navigate_to_page: Navigates between pages\n\nNote:\n   - Does not support deleting pages.\n</page_assistant>\n\n<pattern_assistant>\nPattern Assistant (ID: ${ ASSISTANTS.PATTERN })\n\nDescription:\n   - An assistant specializing in adding and replacing full page patterns and sections.\n\nTools:\n   - add_pattern: Adds new patterns/sections to pages\n   - remove_block: Removes blocks from pages\n   - replace_pattern: Replaces existing patterns/sections on pages\n\nNote:\n   - Does not support editing content within patterns/sections.\n   - Does not support pattern/section ordering changes.\n</pattern_assistant>\n\nRouting Instructions:\n\n1. Quickly analyze the user's request.\n2. ${ invalidRequestPrompt }\n3. If the request is valid, identify which assistant would be most appropriate to handle it based on the available tools.\n4. Call the 'change_assistant' function to route the request to the chosen assistant.\n\n\nBefore routing:\n\n1. Request Analysis:\n   ${ analysisPrompt }\n   - Clearly state the main intent of the user's request.\n   - List all relevant information from the user's request.\n   - Identify any potential edge cases or ambiguities in the request.\n   - Evaluate the complexity of the request, considering if it might require multiple assistants.\n\n2. Assistant Evaluation:\n   - List all potentially relevant assistants and their tools that could address this request.\n   - For each potential assistant, consider the pros and cons of routing to them.\n\n3. Decision Making:\n   - Determine which assistant is most appropriate based on the primary action the user wants to take.\n   - Check if the chosen assistant has a specific tool to address the user's request.\n   - If no assistant has a specific tool for the request, or if the request requires functionality not covered by the matching assistant's tools: ${ helpActionPrompt }.\n   - Clearly state your final choice and provide detailed reasoning for your decision.\n\nImportant to remember:\n   - Prioritize speed in your analysis and decision-making. The user is waiting for a response.\n   - Never attempt to answer user questions or complete tasks yourself. Always route to the appropriate assistant.\n   - Never route to an assistant when a tool does not exist to perform the action they are asking for, even if the assistant is the best match.\n   - After your analysis, call the 'change_assistant' function with 'toAssistantId' as the selected assistant ID and a 'reason' that sums up your decision.\n   - If no assistant has a specific tool for the request, or if the request requires functionality not covered by the matching assistant's tools: ${ helpActionPrompt }.\n`;\n\n\treturn prompt;\n}\n","/**\n * Internal dependencies\n */\nimport { systemPromptTemplate } from '../../system-prompt-template.js';\n\nconst getExampleBusinessDescription = () => {\n\treturn `\n\t- Peak Performance Consulting: Strategic advisory and leadership development for executives, enhancing business growth and efficiency.\n\t- FitLife Tracker: A mobile app offering personalized workouts, nutrition tracking, and progress monitoring for fitness enthusiasts.\n\t- Brew Haven Café: A cozy coffee shop with artisanal blends, fresh pastries, and a welcoming atmosphere for relaxation and socializing.\n\t`;\n};\n\nconst getExampleBlogDescription = () => {\n\treturn `\n\t- The Tech Innovator: For tech enthusiasts and professionals, offering in-depth articles and news on emerging technologies and trends.\n\t- Healthy Living Daily: For health-conscious individuals, providing tips, recipes, and stories to inspire a balanced, healthy lifestyle.\n\t`;\n};\n\nconst getExamplePortfolioDescription = () => {\n\treturn `\n\t- Alex Parker Design: Showcasing innovative graphic design projects, including branding and web design, highlighting creative expertise and visual storytelling.\n\t- Emma Stone Photography: Featuring a curated collection of stunning portraits, landscapes, and editorial photography, demonstrating technical skill and artistic vision.\n\t`;\n};\n\nconst getExamplePersonalDescription = () => {\n\treturn `\n\t- Jim Smithers: Providing a biography and work history along with a list of side projects.\n\t- SciFi Memorabilia: Showcasing my personal sci-fi memorabilia collection for other sci-fi fans to enjoy.\n\t`;\n};\n\nconst siteSpecPrompt = systemPromptTemplate.format( {\n\trole: 'You are a website design analyst at Automattic, the company behind WordPress.com, and an expert at using tools to obtain the required specifications for a new website design.',\n\n\tcontext:\n\t\t'The required specifications to build a site are: siteType, topic, siteDescription, and siteTitle.',\n\n\texamplesDescription:\n\t\t'Guide the user to provide a site description that is suitable for the type of site they need',\n\n\texamples: [\n\t\t`- Business site: ${ getExampleBusinessDescription() }`,\n\t\t`- Blogs: ${ getExampleBlogDescription() }`,\n\t\t`- Portfolios: ${ getExamplePortfolioDescription() }`,\n\t\t`- Personal: ${ getExamplePersonalDescription() }`,\n\t],\n\n\tdo: [\n\t\t`Use the make_suggestions tool when:\n\t\t\t\t- the user is explicitly asking for suggestions.\n\t\t\t\t- the user cannot or is not sure how to answer a question about a specification.\n\t\t\t\t- the site specs are complete and the user is asking for suggestions to change a specification.`,\n\t\t`Use the confirm_site_specs tool when:\n\t\t\t\t- you have all the required specifications.\n\t\t\t\t- the user has asked for changes to the specifications.`,\n\t\t`Check the results of the confirm_site_specs tool carefully. Some responses may seem like a confirmation to continue, but they may actually be asking for changes, for example:\n\t\t\t\t- \"make my site interesting\" could be take to indicate \"go ahead make my site, and make it interesting\" but this includes extra details that are not part of the required specifications, so you should ask for clarification.`,\n\t\t`Use the buildSite tool when:\n\t\t\t\t- the user has confirmed the specifications.`,\n\t\t`Ask for a physical location if the user has not provided one and it seems relevant to the site they are building, for example:\n\t\t\t\t- If the user is building a site for a local business, like a butcher, baker, restaurant, cafe, or gym, etc.\n\t\tIf user asks for a suggestion with location, call make_suggestions with the biggest city shopping district relevant to the language they are using.`,\n\t\t`Check each of the user's responses carefully for information that can be used to fill in these specifications. A response may contain multiple pieces of information that can be used to fill in multiple specifications.`,\n\t\t`Fill in the siteLocationName specification if a response contains partial location information`,\n\t\t`Use only the information provided by the user to complete the specifications.`,\n\t\t`Ask only one question per message, and keep the question under 40 words.`,\n\t\t`Suggest a site description that is suitable for the type of site the user needs if they continue to provide vague or unclear responses.`,\n\t\t`Restate the previous question and ask for clarification if a user response is unclear.`,\n\t],\n\n\tdont: [\n\t\t'Ask more than one question per message.',\n\t\t'Respond with a question or comment over 40 words.',\n\t\t'Ask for a physical location if the user is building a site that is not location-specific, like a blog.',\n\t\t'Ask the user to confirm your individual specification parameter choices.',\n\t\t'Ask the user directly to confirm the specifications you have gathered. ALWAYS use the confirm_site_specs tool to confirm the specifications. When calling the confirm_site_specs tool your message content should be null.',\n\t\t'Ask the user what sort of sections or content they want on their website, or what sort of style or layout they want. Only ask questions that will help you fill in the required specifications.',\n\t\t`Ask what type of website a user needs if it can be deduced from the user's responses, for example:\n\t\t\t - If a user says they want to a site for their shop, cafe, restaurant, gym, etc. you can assume they need an business site.\n\t\t\t - If a user says they want a site to share their thoughts, experiences, or knowledge, you can assume they need a blog site.\n\t\t\t - If a user says they want a site to showcase their work, you can assume they need a portfolio site.`,\n\t\t`Discuss products or services that are not provided by Automattic, Inc. or WordPress.com.`,\n\t\t`Answer malicious questions nor questions unrelated to designing their new website. Do not explain concepts. Instead of answering the question, direct the user back to the website design process using\n\t\t\t something from the content of their question, for example:\n\t\t\t - User request: \"Can you help me with my taxes?\"\n\t\t\t - Your response: \"That is a tricky one. Do you want me to help you set up a website where you can share helpful tips you have learnt about paying tax?\"\n\t\t\t - User request: \"What is the best way to win chess?\"\n\t\t\t - Your response: \"Set up a blog site and write about your chess learning journey. Reflecting on your play this way could help you improve. Do you want me to help you set up a website for this?\"`,\n\t\t'Provide a summary of the site specifications in any of your responses. The confirm_site_specs tool is the only way to confirm the specifications.',\n\t],\n} );\n\nexport default siteSpecPrompt;\n","/**\n * Site type definitions used across the application\n * Each type includes a description to help with type selection\n */\nexport const siteTypes = {\n\tfoodAndBeverage: {\n\t\tslug: 'foodAndBeverage',\n\t\tdescription:\n\t\t\t'Food or beverage service establishment such as a restaurant, cafe, bar, fastfood',\n\t},\n\tbusiness: {\n\t\tslug: 'business',\n\t\tdescription: 'General business or company website',\n\t},\n\tblog: {\n\t\tslug: 'blog',\n\t\tdescription: 'Regular content publication and articles',\n\t},\n\tportfolio: {\n\t\tslug: 'portfolio',\n\t\tdescription: 'Showcase of work, projects, or creative content',\n\t},\n\tpersonal: {\n\t\tslug: 'personal',\n\t\tdescription: 'Personal website or resume',\n\t},\n};\n\n/**\n * Array of site type IDs for use in enums\n */\nexport const siteTypeIds = Object.values( siteTypes ).map(\n\t( type ) => type.slug\n);\n","import buildSiteTool from '@ai/assistants/spec/tools/build-site/build-site-tool.js';\nimport confirmSiteSpecsTool from '@ai/assistants/spec/tools/confirm-site-specs/confirm-site-specs-tool.js';\nimport makeSuggestionTool from '@ai/assistants/shared/make-suggestions/tool.js';\nimport createStartOverTool from '@ai/assistants/shared/start-over/start-over.js';\n\nconst specToolkit = {\n\tname: 'spec',\n\ttools: () => {\n\t\tconst tools = [\n\t\t\tbuildSiteTool(),\n\t\t\tconfirmSiteSpecsTool(),\n\t\t\tmakeSuggestionTool(),\n\t\t\tcreateStartOverTool(),\n\t\t];\n\n\t\treturn tools;\n\t},\n};\n\nexport default specToolkit;\n","export default function buildSiteTool() {\n\treturn {\n\t\tname: 'build_site',\n\t\tdescription:\n\t\t\t'Called once the site specifications have been confirmed. This method should always be called by itself. Do not call in parallel with other functions.',\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tsiteType: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t},\n\t\t\t\ttopic: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t},\n\t\t\t\tsiteDescription: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t},\n\t\t\t\tsiteTitle: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t},\n\t\t\t\tsiteLocationName: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t},\n\t\t\t\timageStyle: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The style of image to use, based on the site title and description. Use photographic if there is no image style that matches the site.',\n\t\t\t\t\tenum: [\n\t\t\t\t\t\t'3d-model',\n\t\t\t\t\t\t'analog-film',\n\t\t\t\t\t\t'anime',\n\t\t\t\t\t\t'cinematic',\n\t\t\t\t\t\t'comicbook',\n\t\t\t\t\t\t'craft-clay',\n\t\t\t\t\t\t'digital-art',\n\t\t\t\t\t\t'enhance',\n\t\t\t\t\t\t'fantasy-art',\n\t\t\t\t\t\t'isometric',\n\t\t\t\t\t\t'line-art',\n\t\t\t\t\t\t'lowpoly',\n\t\t\t\t\t\t'neonpunk',\n\t\t\t\t\t\t'origami',\n\t\t\t\t\t\t'photographic',\n\t\t\t\t\t\t'pixel-art',\n\t\t\t\t\t\t'texture',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tcolorRequest: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The color request for the site. This should be a single string that describes the color request for the site, as user has described it. For example, \"I want a site with a blue and white color scheme\". Leave null if the user has not provided a color request.',\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [\n\t\t\t\t'siteType',\n\t\t\t\t'topic',\n\t\t\t\t'siteDescription',\n\t\t\t\t'siteTitle',\n\t\t\t\t'siteLocationName',\n\t\t\t\t'imageStyle',\n\t\t\t\t'colorRequest',\n\t\t\t],\n\t\t},\n\t\tstrict: true,\n\t};\n}\n","/**\n * Internal dependencies\n */\nimport { siteTypeIds } from '@data/site-categories';\n\nexport default function confirmSiteSpecsTool() {\n\treturn {\n\t\tname: 'confirm_site_specs',\n\t\tdescription:\n\t\t\t'Confirms that the gathered specifications are correct. The required specifications to build a site are: siteType, topic, siteDescription, and siteTitle. The content of your message should ALWAYS be null.',\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tsiteType: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t\"The type of site being created. Prefer making assumptions about the siteType based on information the user provides rather than asking the user direct. For example a site that sounds like a business, eg. for a consultancy, gymn, florist, or plumber assume the siteType is 'business'. For a site that sounds like a food and beverage establishment, eg. a restaurant, cafe, bar, fastfood, assume the siteType is 'foodAndBeverage'. For a site like a photography portfolio assume the siteType is 'portfolio'. For a site like a daily journal about travel assume the siteType is 'blog'. Only ask the user for clarification as a last resort if you really can't determine the siteType from the information provided. If you do ask the user for clarification, provide a list of options from the available site types.\",\n\t\t\t\t\tenum: siteTypeIds,\n\t\t\t\t},\n\t\t\t\ttopic: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t\"Your task is to determine the main topic of the site using no more than two words. It should not be something generic like ecommerce, and should not be the site name. Avoid using ambiguous terms that have multiple meanings. For businesses and professional sites always use the primary business type as the topic, for example with 'a law firm specializing in divorce' set topic as 'law firm' not 'divorce', or for 'a doctor who treats drug addiction' use 'doctor' not 'drug addiction'\",\n\t\t\t\t},\n\t\t\t\tsiteDescription: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t\"Never ask for this. It is a summary of the sites specifications gathered so far e.g. 'A technical bookshop called TechReads, specialising in machine learning books'. If the user has not provided enough information for you to create a useful description ask follow up questions to flesh it out. Do not include the location in the description. Use the user's language.\",\n\t\t\t\t},\n\t\t\t\tsiteTitle: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t\"The title of the site. Look for obvious titles in the information provided, for example: If a business name is provided this should be used. eg. for 'I want a site for my coffee shop Java Jivin' the siteTitle should be 'Java Jivin'. If an explicit title is provided, use that. eg. for 'I want a site for my photography portfolio called My Photos' the siteTitle should be 'My Photos'. If there is an obvious title just use it and don't ask for confirmation. If you can't determine the title, ask the user to provide one.\",\n\t\t\t\t},\n\t\t\t\tsiteLocationName: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t\"The physical location of the business or person as a single string. Ask for this if the user has not provided one and it seems like something that should have a location, eg. a bar, a coffee shop, a restaurant, a gym, etc. This should only be a location on a map in a readable form. e.g. 123 Main Street, Los Angeles, CA, USA. Use the post code if provided but do not ask for it. If you cannot determine the location, do not include this. Ask for an actual street address if it seems like a something that should have one and it hasn't been provided already. If the type of site doesn't seem like it should have a location, don't ask for this.\",\n\t\t\t\t},\n\t\t\t\tinputPlaceholder: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t\"The placeholder text for the input field. The value should be something like, 'Click below to make changes…'.\",\n\t\t\t\t},\n\t\t\t\tactions: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t\"You must provide one action for the user to confirm the specifications. [ { 'actionName': 'Looks good', 'description': 'Build $siteTitle' } ].\",\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'object',\n\t\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t\t\trequired: [ 'actionName', 'description' ],\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tactionName: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdescription: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [\n\t\t\t\t'siteType',\n\t\t\t\t'topic',\n\t\t\t\t'siteDescription',\n\t\t\t\t'siteTitle',\n\t\t\t\t'siteLocationName',\n\t\t\t\t'inputPlaceholder',\n\t\t\t\t'actions',\n\t\t\t],\n\t\t},\n\t\tstrict: true,\n\t};\n}\n","const makeSuggestionTool = () => {\n\treturn {\n\t\tname: 'make_suggestions',\n\t\tdescription: 'Makes suggestions for a particular request.',\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tmessage: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t\"The message to display to the user. This will be phrased in terms of a suggestion relevant to the context, eg. 'Here are some suggestions for a site title…'.\",\n\t\t\t\t},\n\t\t\t\tinputPlaceholder: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t\"The placeholder text for the input field. For example, if providing suggestions for a business name, the inputPlaceholder could be 'Enter a different business name…'. Do not include any comment about selecting from the provided actions.\",\n\t\t\t\t},\n\t\t\t\tactions: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t\"Provides a few options for the user to choose from. For example, if a user is asking for business name suggestions for their coffee shop, the actions could be [ 'Java Jivin', 'Java Jive', 'Java Jive Cafe' ]. If they are wanting to know what you can help with for site design the acitons might be ['Change colors', 'Change fonts', 'Add a new page']Keep your suggestions to a maximum of 2 and under 20 characters\",\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'object',\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tactionName: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The title of the action. Keep it very short.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdescription: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The description of the suggestion. Briefly describe the suggestion in context for the user.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [\n\t\t\t\t'message',\n\t\t\t\t'inputPlaceholder',\n\t\t\t\t'actions',\n\t\t\t\t'description',\n\t\t\t],\n\t\t},\n\t};\n};\n\nexport default makeSuggestionTool;\n","const createStartOverTool = () => {\n\treturn {\n\t\tname: 'start_over',\n\t\tdescription: `Always call this if the user wants to start over from scratch or change what their site is about.\n\t\tExamples of when to call this:\n\t\t- \"Start over\"\n\t\t- \"I want to start fresh\"\n\t\t- \"Can I change what my site is about?\"\n\t\t- \"Let's start from the beginning\"\n\t\t- \"Reset everything\"\n\t\tAlways call this tool directly when the user expresses a desire to start over.\n\t\tNever try to reset the site yourself, or reply with a message to say you have done so.\n\t\tDo not ask follow-up questions, just call this tool directly when the user expresses a desire to start over.`,\n\t\tstrict: true,\n\t};\n};\n\nexport default createStartOverTool;\n","import { DotPromptTemplate } from '@automattic/big-sky-agents';\n\nconst specContext = new DotPromptTemplate( {\n\ttemplate: `{{? it.additionalContext }}\n{{\n\tconst {\n\t\tsiteGoals,\n\t\tsiteType,\n\t\ttopic,\n\t\tsiteDescription,\n\t\tsiteTitle,\n\t\tsiteLocation,\n\t\tcolorRequest\n\t} = it.additionalContext;\n}}\n{{? siteGoals }}The user has indicated that their goals with the site are to {{~siteGoals :item}}{{=item}}, {{~}}{{?}}\n{{? siteType }}The site type is {{=siteType}}.{{?}}\n{{? topic }}The site's topic is {{=topic}}.{{?}}\n{{? siteDescription }}The site's description is: {{=siteDescription}}{{?}}\n{{? siteTitle }}The site's title is \"{{=siteTitle}}\".{{?}}\n{{? siteLocation?.name }}The site's location is {{=siteLocation.name}}.{{?}}\n{{? colorRequest }}The user has requested the following color scheme: {{=colorRequest}}{{?}}\n{{?}}`,\n\tinputVariables: [ 'additionalContext' ],\n} );\n\nexport default specContext;\n","/**\n * WordPress dependencies\n */\nimport apiFetch from '@wordpress/api-fetch';\n\n/**\n * Internal dependencies\n */\nimport log from '@utils/log-debug.js';\nimport { getIsDevMode } from '@utils/tracks.js';\n\nexport default async function logSession(\n\tsessionId,\n\tname = 'Big Sky Session'\n) {\n\ttry {\n\t\treturn await apiFetch( {\n\t\t\tpath:\n\t\t\t\t'/wpcom/v2/big-sky/v1/session/' +\n\t\t\t\tencodeURIComponent( sessionId ),\n\t\t\tmethod: 'POST',\n\t\t\tdata: {\n\t\t\t\tname,\n\t\t\t\tis_test: getIsDevMode(),\n\t\t\t},\n\t\t} );\n\t} catch ( error ) {\n\t\tlog.error( 'Error logging session: ', error );\n\t}\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { store as editorStore } from '@wordpress/editor';\n\n/**\n * Internal dependencies\n */\nimport logSession from '@utils/log-session';\nimport logSiteMetadata from '@utils/log-metadata';\nimport { store as aiStore } from '@store';\nimport uuidv4 from '@utils/uuid';\nimport logAction from '@utils/log-action';\nimport { messageRoles } from '@utils/constants';\n\n// a delta object to store changes to metadata to avoid racing condition\nlet deltaMetadata = {};\nexport default function useSiteMetadata() {\n\tconst { shouldLogSessions, sessionId, getSiteMetadata } = useSelect(\n\t\t( select ) => ( {\n\t\t\tgetSiteMetadata: select( aiStore ).getSiteMetadata,\n\t\t\tsessionId: select( aiStore ).getSessionId(),\n\t\t\tshouldLogSessions: select( aiStore ).shouldLogSessions(),\n\t\t} )\n\t);\n\tconst { currentPostId } = useSelect( ( select ) => ( {\n\t\tcurrentPostId: select( editorStore ).getCurrentPostId(),\n\t} ) );\n\tconst { setSiteMetadata: setSiteMetadataState } = useDispatch( aiStore );\n\n\tconst { saveEditedEntityRecord, editEntityRecord } =\n\t\tuseDispatch( coreStore );\n\n\tconst isOnboarded = ( metadata ) => {\n\t\treturn (\n\t\t\t!! metadata.siteTitle &&\n\t\t\t!! metadata.siteDescription &&\n\t\t\t!! metadata.topic\n\t\t);\n\t};\n\n\tconst setSiteMetadata = async (\n\t\tpayload,\n\t\tpersist = false,\n\t\tconfirmingSpecs = false\n\t) => {\n\t\tconst siteMetadata = getSiteMetadata();\n\t\tdeltaMetadata = { ...deltaMetadata, ...payload };\n\t\tconst newSiteMetadata = { ...siteMetadata, ...deltaMetadata };\n\t\t// remove the mode property from the metadata\n\t\tdelete newSiteMetadata.mode;\n\n\t\tif ( ! confirmingSpecs ) {\n\t\t\tnewSiteMetadata.isOnboarded = isOnboarded( newSiteMetadata );\n\t\t} else {\n\t\t\tnewSiteMetadata.isOnboarded = false;\n\t\t}\n\t\tconst newSiteMetadataJson = JSON.stringify( newSiteMetadata );\n\t\t// log any changes to the site metadata\n\t\tif (\n\t\t\tisOnboarded( newSiteMetadata ) &&\n\t\t\tnewSiteMetadataJson !== JSON.stringify( siteMetadata )\n\t\t) {\n\t\t\tlogSiteMetadata( sessionId, newSiteMetadata );\n\t\t}\n\t\t// update the state\n\t\tsetSiteMetadataState( newSiteMetadata );\n\n\t\teditEntityRecord(\n\t\t\t'root',\n\t\t\t'site',\n\t\t\tundefined,\n\t\t\t{\n\t\t\t\tbig_sky_site_metadata: newSiteMetadataJson,\n\t\t\t},\n\t\t\t{ undoIgnore: true }\n\t\t);\n\n\t\tif ( persist ) {\n\t\t\tawait saveEditedEntityRecord( 'root', 'site', undefined, {\n\t\t\t\tbig_sky_site_metadata: newSiteMetadataJson,\n\t\t\t} );\n\t\t}\n\n\t\t// now log the message if necessary\n\t\tif ( payload.siteTitle && shouldLogSessions ) {\n\t\t\tlogSession( sessionId, payload.siteTitle );\n\t\t}\n\t};\n\n\tconst setCurrentColor = ( currentColor ) => {\n\t\tif ( shouldLogSessions ) {\n\t\t\tlogAction(\n\t\t\t\tsessionId,\n\t\t\t\tcurrentColor,\n\t\t\t\tmessageRoles.SET_COLOR,\n\t\t\t\tuuidv4()\n\t\t\t);\n\t\t}\n\t\treturn setSiteMetadata( { currentColor } );\n\t};\n\tconst setCurrentFont = ( currentFont ) => {\n\t\tif ( shouldLogSessions ) {\n\t\t\tlogAction(\n\t\t\t\tsessionId,\n\t\t\t\tcurrentFont,\n\t\t\t\tmessageRoles.SET_FONT,\n\t\t\t\tuuidv4()\n\t\t\t);\n\t\t}\n\t\treturn setSiteMetadata( { currentFont } );\n\t};\n\tconst setTopic = ( topic ) => {\n\t\tif ( shouldLogSessions ) {\n\t\t\tlogAction( sessionId, topic, messageRoles.SET_TOPIC, uuidv4() );\n\t\t}\n\t\treturn setSiteMetadata( { topic } );\n\t};\n\tconst setSiteDescription = ( siteDescription ) => {\n\t\tif ( shouldLogSessions ) {\n\t\t\tlogAction(\n\t\t\t\tsessionId,\n\t\t\t\tsiteDescription,\n\t\t\t\tmessageRoles.SET_SITE_DESCRIPTION,\n\t\t\t\tuuidv4()\n\t\t\t);\n\t\t}\n\t\treturn setSiteMetadata( { siteDescription } );\n\t};\n\tconst setSiteLocation = ( siteLocation ) => {\n\t\tif ( shouldLogSessions ) {\n\t\t\tlogAction(\n\t\t\t\tsessionId,\n\t\t\t\tsiteLocation,\n\t\t\t\tmessageRoles.SET_SITE_LOCATION,\n\t\t\t\tuuidv4()\n\t\t\t);\n\t\t}\n\t\treturn setSiteMetadata( { siteLocation } );\n\t};\n\tconst setSiteTitle = ( siteTitle ) => {\n\t\tif ( shouldLogSessions ) {\n\t\t\tlogAction(\n\t\t\t\tsessionId,\n\t\t\t\tsiteTitle,\n\t\t\t\tmessageRoles.SET_SITE_TITLE,\n\t\t\t\tuuidv4()\n\t\t\t);\n\t\t}\n\t\treturn setSiteMetadata( { siteTitle } );\n\t};\n\n\tconst getPagePatterns = ( pageId = null ) => {\n\t\tconst patterns = getSiteMetadata().patterns;\n\t\tif ( pageId ) {\n\t\t\treturn patterns[ pageId ];\n\t\t}\n\t\treturn patterns[ currentPostId ];\n\t};\n\n\treturn {\n\t\tgetPagePatterns,\n\t\tgetSiteMetadata,\n\t\tsetCurrentColor,\n\t\tsetCurrentFont,\n\t\tsetTopic,\n\t\tsetSiteDescription,\n\t\tsetSiteLocation,\n\t\tsetSiteTitle,\n\t\tsetSiteMetadata,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport apiFetch from '@wordpress/api-fetch';\n\n/**\n * Internal dependencies\n */\nimport log from '@utils/log-debug.js';\n\nexport default async function logSiteMetadata( sessionId, data ) {\n\ttry {\n\t\treturn await apiFetch( {\n\t\t\tpath:\n\t\t\t\t'/wpcom/v2/big-sky/v1/session/' +\n\t\t\t\tencodeURIComponent( sessionId ) +\n\t\t\t\t'/metadata',\n\t\t\tmethod: 'POST',\n\t\t\tdata,\n\t\t} );\n\t} catch ( error ) {\n\t\tlog.error( 'Error logging site metadata: ', error );\n\t}\n}\n","export const getCanvasIframeElements = () => {\n\tconst canvasiFrame = document.querySelector( '[name=\"editor-canvas\"]' );\n\tconst canvasiFrameDocument = canvasiFrame?.contentDocument ?? null;\n\tconst canvasiFrameRoot = canvasiFrameDocument?.documentElement ?? null;\n\tconst canvasiFrameWindow = canvasiFrame?.contentWindow ?? null;\n\tconst canvasiFrameBody = canvasiFrameDocument?.body ?? null;\n\treturn {\n\t\tcanvasiFrame,\n\t\tcanvasiFrameRoot,\n\t\tcanvasiFrameDocument,\n\t\tcanvasiFrameWindow,\n\t\tcanvasiFrameBody,\n\t};\n};\n","/**\n * WordPress dependencies\n */\nimport { createBlock } from '@wordpress/blocks';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { useCallback } from '@wordpress/element';\nimport { store as editorStore } from '@wordpress/editor';\n\n/**\n * Internal dependencies\n */\nimport { getCanvasIframeElements } from '@utils/canvas-iframe-elements';\n\nexport default function useBlocks() {\n\tconst {\n\t\tgetBlockHierarchyRootClientId,\n\t\tgetBlock,\n\t\tgetBlocksByName,\n\t\tgetClientIdsOfDescendants,\n\t\tgetBlockParentsByBlockName,\n\t\tgetBlocks,\n\t} = useSelect( blockEditorStore );\n\tconst { selectBlock, updateBlockAttributes } =\n\t\tuseDispatch( blockEditorStore );\n\tconst { replaceBlock } = useDispatch( editorStore );\n\n\tconst settings = useSelect( ( select ) => {\n\t\tconst _settings = select( coreStore ).getEntityRecord( 'root', 'site' );\n\t\treturn {\n\t\t\tsiteTitle: _settings?.title ?? '',\n\t\t};\n\t} );\n\n\tconst getContentOfBlocks = ( blocks ) => {\n\t\tconst content = [];\n\t\tblocks.forEach( ( block ) => {\n\t\t\tif ( block.innerBlocks?.length > 0 ) {\n\t\t\t\tcontent.push( ...getContentOfBlocks( block.innerBlocks ) );\n\t\t\t} else if (\n\t\t\t\tblock.name === 'core/heading' ||\n\t\t\t\tblock.name === 'core/paragraph' ||\n\t\t\t\tblock.name === 'core/site-title' ||\n\t\t\t\tblock.name === 'core/image' ||\n\t\t\t\tblock.name === 'core/button'\n\t\t\t) {\n\t\t\t\tlet example;\n\t\t\t\tif ( block.name === 'core/button' ) {\n\t\t\t\t\texample = block.attributes.text || 'Button';\n\t\t\t\t} else if ( block.name === 'core/site-title' ) {\n\t\t\t\t\texample = 'Acme Inc';\n\t\t\t\t} else {\n\t\t\t\t\texample = block.attributes.content;\n\t\t\t\t}\n\t\t\t\tcontent.push( {\n\t\t\t\t\tname: block.name,\n\t\t\t\t\tclientId: block.clientId,\n\t\t\t\t\texample,\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\n\t\treturn content;\n\t};\n\n\tconst getSurroundingContentOfBlock = ( block ) => {\n\t\tconst rootParentBlockClientID = getBlockHierarchyRootClientId(\n\t\t\tblock?.clientId\n\t\t);\n\t\tconst rootParentBlock = getBlock( rootParentBlockClientID );\n\t\tconst allChildBlocksClientIDs = getClientIdsOfDescendants(\n\t\t\trootParentBlock?.clientId\n\t\t);\n\n\t\tlet surroundingContent = '';\n\t\tallChildBlocksClientIDs.forEach( ( clientID ) => {\n\t\t\tconst childBlock = getBlock( clientID );\n\t\t\tif (\n\t\t\t\tchildBlock.name === 'core/heading' ||\n\t\t\t\tchildBlock.name === 'core/paragraph'\n\t\t\t) {\n\t\t\t\tsurroundingContent += ' ' + childBlock.attributes.content;\n\t\t\t}\n\t\t} );\n\n\t\treturn surroundingContent;\n\t};\n\n\tconst getBlockElement = ( block ) => {\n\t\tconst { canvasiFrameWindow } = getCanvasIframeElements();\n\t\tif (\n\t\t\tcanvasiFrameWindow &&\n\t\t\tcanvasiFrameWindow.document.readyState === 'complete'\n\t\t) {\n\t\t\treturn canvasiFrameWindow.document.getElementById(\n\t\t\t\t`block-${ block.clientId }`\n\t\t\t);\n\t\t}\n\n\t\treturn null;\n\t};\n\n\tconst setBlockIsProcessing = ( block, isProcessing ) => {\n\t\tconst blockElement = getBlockElement( block );\n\t\tif ( blockElement ) {\n\t\t\tblockElement.classList.remove( 'big-sky__is-processing' );\n\t\t\tblockElement.classList.remove( 'big-sky__has-processed' );\n\t\t\tblockElement.classList.add(\n\t\t\t\tisProcessing\n\t\t\t\t\t? 'big-sky__is-processing'\n\t\t\t\t\t: 'big-sky__has-processed'\n\t\t\t);\n\t\t}\n\t};\n\n\tconst getContentBlockClientID = () => {\n\t\treturn getBlocksByName( 'core/post-content' )[ 0 ];\n\t};\n\n\tconst getTemplatePartClientID = ( name ) => {\n\t\tconst templatePartClientIds = getBlocksByName( 'core/template-part' );\n\n\t\tif ( ! templatePartClientIds ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst slug = name === 'header' ? 'header' : 'footer';\n\n\t\treturn templatePartClientIds.find( ( clientId ) => {\n\t\t\tconst block = getBlock( clientId );\n\t\t\treturn block.attributes.slug === slug;\n\t\t} );\n\t};\n\n\tconst setMapLocationInBlocks = ( blocks, location ) => {\n\t\tif ( ! location || ! location.coordinates ) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor ( const block of blocks ) {\n\t\t\tif ( block.name === 'jetpack/map' ) {\n\t\t\t\tconst lat = location.coordinates[ 0 ];\n\t\t\t\tconst lng = location.coordinates[ 1 ];\n\n\t\t\t\tblock.attributes.mapCenter = {\n\t\t\t\t\tlat,\n\t\t\t\t\tlng,\n\t\t\t\t};\n\n\t\t\t\tblock.attributes.points = [\n\t\t\t\t\t{\n\t\t\t\t\t\tplaceTitle: location.name,\n\t\t\t\t\t\ttitle: settings.siteTitle || location.name,\n\t\t\t\t\t\tcaption: '',\n\t\t\t\t\t\t/* eslint-disable-next-line no-restricted-syntax */\n\t\t\t\t\t\tid: 'place.' + Math.random(),\n\t\t\t\t\t\tcoordinates: {\n\t\t\t\t\t\t\tlatitude: lat,\n\t\t\t\t\t\t\tlongitude: lng,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t];\n\n\t\t\t\tupdateBlockAttributes( block?.clientId, {\n\t\t\t\t\tmapCenter: {\n\t\t\t\t\t\tlat,\n\t\t\t\t\t\tlng,\n\t\t\t\t\t},\n\t\t\t\t\tpoints: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tplaceTitle: location.name,\n\t\t\t\t\t\t\ttitle: settings.siteTitle || location.name,\n\t\t\t\t\t\t\tcaption: '',\n\t\t\t\t\t\t\t/* eslint-disable-next-line no-restricted-syntax */\n\t\t\t\t\t\t\tid: 'place.' + Math.random(),\n\t\t\t\t\t\t\tcoordinates: {\n\t\t\t\t\t\t\t\tlatitude: lat,\n\t\t\t\t\t\t\t\tlongitude: lng,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tif ( block.innerBlocks?.length > 0 ) {\n\t\t\t\tsetMapLocationInBlocks( block.innerBlocks, location );\n\t\t\t}\n\t\t}\n\t};\n\n\tconst selectBlockInViewport = (\n\t\tiframeElement,\n\t\tcanvasContentWindow,\n\t\tblockClientId\n\t) => {\n\t\tconst boundingRect = iframeElement.getBoundingClientRect();\n\t\tlet top = boundingRect.top;\n\t\tlet bottom = boundingRect.bottom;\n\t\tif ( boundingRect.height > canvasContentWindow.innerHeight ) {\n\t\t\ttop =\n\t\t\t\tboundingRect.top +\n\t\t\t\t( boundingRect.height - canvasContentWindow.innerHeight );\n\t\t\tbottom =\n\t\t\t\tboundingRect.bottom -\n\t\t\t\t( boundingRect.height - canvasContentWindow.innerHeight );\n\t\t}\n\t\tif ( top >= 0 && bottom <= canvasContentWindow.innerHeight ) {\n\t\t\tselectBlock( blockClientId );\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tconst scrollToBlock = async (\n\t\tblockClientId,\n\t\tposition = 'start',\n\t\tselectBlockAfterScroll = false\n\t) => {\n\t\tif ( blockClientId ) {\n\t\t\tconst { canvasiFrameWindow } = getCanvasIframeElements();\n\t\t\tif (\n\t\t\t\tcanvasiFrameWindow &&\n\t\t\t\tcanvasiFrameWindow.document.readyState === 'complete'\n\t\t\t) {\n\t\t\t\t// Access the element within the iframe content\n\t\t\t\tconst iframeElement =\n\t\t\t\t\tcanvasiFrameWindow.document.getElementById(\n\t\t\t\t\t\t`block-${ blockClientId }`\n\t\t\t\t\t);\n\n\t\t\t\t// Scroll to the element within the iframe content\n\t\t\t\tif ( iframeElement ) {\n\t\t\t\t\tiframeElement.scrollIntoView( {\n\t\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t\t\tblock: position,\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\tif ( selectBlockAfterScroll ) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tselectBlockInViewport(\n\t\t\t\t\t\t\tiframeElement,\n\t\t\t\t\t\t\tcanvasiFrameWindow,\n\t\t\t\t\t\t\tblockClientId\n\t\t\t\t\t\t)\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst handleScroll = ( clientId ) => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tselectBlockInViewport(\n\t\t\t\t\t\t\t\tiframeElement,\n\t\t\t\t\t\t\t\tcanvasiFrameWindow,\n\t\t\t\t\t\t\t\tclientId\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tcanvasiFrameWindow.document.removeEventListener(\n\t\t\t\t\t\t\t\t'scroll',\n\t\t\t\t\t\t\t\tscrollHandlerFn\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tconst scrollHandlerFn = () => handleScroll( blockClientId );\n\t\t\t\t\tcanvasiFrameWindow.document.addEventListener(\n\t\t\t\t\t\t'scroll',\n\t\t\t\t\t\tscrollHandlerFn\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tconst scrollToFirstBlockByName = (\n\t\tblockName,\n\t\tposition = 'start',\n\t\tselect = false\n\t) => {\n\t\tconst blocks = getBlocksByName( blockName );\n\t\tif ( blocks.length > 0 ) {\n\t\t\tscrollToBlock( blocks[ 0 ], position, select );\n\t\t}\n\t};\n\n\tconst getParentRootPatternBlock = ( clientId ) => {\n\t\tconst block = getBlock( clientId );\n\t\tif ( ! block ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( block.attributes?.metadata?.patternCategory ) {\n\t\t\treturn block;\n\t\t}\n\n\t\tconst parentGroupClientIds = getBlockParentsByBlockName(\n\t\t\tclientId,\n\t\t\t'core/group'\n\t\t);\n\n\t\tif ( ! parentGroupClientIds ) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet parentRootPatternBlock = null;\n\n\t\tparentGroupClientIds.forEach( ( groupClientId ) => {\n\t\t\tconst groupBlock = getBlock( groupClientId );\n\n\t\t\tif ( groupBlock?.attributes?.metadata?.patternCategory ) {\n\t\t\t\tparentRootPatternBlock = groupBlock;\n\t\t\t}\n\t\t} );\n\n\t\treturn parentRootPatternBlock;\n\t};\n\n\tconst getFirstChildBlockByName = useCallback( ( block, searchName ) => {\n\t\tif ( block.name === searchName ) {\n\t\t\treturn block;\n\t\t}\n\n\t\tif ( block.innerBlocks?.length ) {\n\t\t\tfor ( const innerBlock of block.innerBlocks ) {\n\t\t\t\tconst _block = getFirstChildBlockByName(\n\t\t\t\t\tinnerBlock,\n\t\t\t\t\tsearchName\n\t\t\t\t);\n\n\t\t\t\tif ( _block ) {\n\t\t\t\t\treturn _block;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}, [] );\n\n\tconst getParentRootTemplatePartBlock = ( clientId ) => {\n\t\tconst block = getBlock( clientId );\n\t\tif ( block.name === 'core/template-part' ) {\n\t\t\treturn block;\n\t\t}\n\n\t\tconst parentGroupClientIds = getBlockParentsByBlockName(\n\t\t\tclientId,\n\t\t\t'core/template-part'\n\t\t);\n\t\tif ( ! parentGroupClientIds ) {\n\t\t\treturn;\n\t\t}\n\t\treturn getBlock( parentGroupClientIds[ 0 ] );\n\t};\n\n\tconst isTemplatePart = ( clientId ) => {\n\t\tconst rootTemplatePartBlock =\n\t\t\tgetParentRootTemplatePartBlock( clientId );\n\t\tif ( ! rootTemplatePartBlock ) {\n\t\t\treturn getBlock( clientId ).name === 'core/template-part';\n\t\t}\n\t\treturn rootTemplatePartBlock.name === 'core/template-part';\n\t};\n\n\t// Function to recursively copy a block and its inner blocks\n\tconst copyBlockWithInnerBlocks = ( block ) => {\n\t\t// Create a copy of the current block\n\t\tconst newBlock = createBlock( block.name, block.attributes );\n\n\t\t// If the block has inner blocks, copy them recursively\n\t\tif ( block.innerBlocks && block.innerBlocks.length ) {\n\t\t\tnewBlock.innerBlocks = block.innerBlocks.map( ( innerBlock ) =>\n\t\t\t\tcopyBlockWithInnerBlocks( innerBlock )\n\t\t\t);\n\t\t}\n\n\t\treturn newBlock;\n\t};\n\n\tconst getFirstChildBlockByClientIdDOMElement = ( clientId ) => {\n\t\tconst { canvasiFrameWindow } = getCanvasIframeElements();\n\t\tconst domElement = canvasiFrameWindow.document.getElementById(\n\t\t\t`block-${ clientId }`\n\t\t);\n\t\treturn getBlock(\n\t\t\tdomElement\n\t\t\t\t.querySelector( 'div[data-type=\"core/group\"]' )\n\t\t\t\t.getAttribute( 'data-block' )\n\t\t);\n\t};\n\n\tconst blockHasContent = ( block ) => {\n\t\t// There is no content if there is no block.\n\t\tif ( ! block ) {\n\t\t\treturn false;\n\t\t}\n\t\tswitch ( block.name ) {\n\t\t\tcase 'core/paragraph':\n\t\t\t\treturn block.attributes?.content?.length > 0;\n\t\t\tcase 'core/image':\n\t\t\t\treturn block.attributes?.url?.length > 0;\n\t\t\tcase 'core/quote':\n\t\t\t\treturn block.attributes?.value?.length > 0;\n\t\t\tdefault:\n\t\t\t\treturn true;\n\t\t}\n\t};\n\n\tconst fixInvalidBlock = ( block ) => {\n\t\tconst { clientId, name, attributes, innerBlocks } = block;\n\t\tconst replacement = createBlock( name, attributes, innerBlocks );\n\t\tif ( blockHasContent( replacement ) ) {\n\t\t\treplaceBlock( clientId, replacement );\n\t\t}\n\n\t\t// traverse all of the inner blocks and fix them\n\t\tblock?.innerBlocks?.forEach( ( innerBlock ) => {\n\t\t\tfixInvalidBlock( innerBlock );\n\t\t} );\n\n\t\treturn block;\n\t};\n\n\tconst findSiteLogoBlock = () => {\n\t\tconst headerClientId = getTemplatePartClientID( 'header' );\n\t\tconst headerContentBlocks = getBlocks( headerClientId );\n\t\tconst footerClientId = getTemplatePartClientID( 'footer' );\n\t\tconst footerContentBlocks = getBlocks( footerClientId );\n\n\t\tconst searchForSiteLogoBlock = ( blocks ) => {\n\t\t\tfor ( const block of blocks ) {\n\t\t\t\tif ( block.name === 'core/site-logo' ) {\n\t\t\t\t\treturn block;\n\t\t\t\t}\n\n\t\t\t\tif ( block.innerBlocks && block.innerBlocks.length > 0 ) {\n\t\t\t\t\tconst found = searchForSiteLogoBlock( block.innerBlocks );\n\t\t\t\t\tif ( found ) {\n\t\t\t\t\t\treturn found;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn searchForSiteLogoBlock( [\n\t\t\t...headerContentBlocks,\n\t\t\t...footerContentBlocks,\n\t\t] );\n\t};\n\n\treturn {\n\t\tgetSurroundingContentOfBlock,\n\t\tgetContentOfBlocks,\n\t\tgetContentBlockClientID,\n\t\tgetTemplatePartClientID,\n\t\tsetBlockIsProcessing,\n\t\tsetMapLocationInBlocks,\n\t\tscrollToBlock,\n\t\tscrollToFirstBlockByName,\n\t\tgetFirstChildBlockByName,\n\t\tgetParentRootPatternBlock,\n\t\tgetParentRootTemplatePartBlock,\n\t\tisTemplatePart,\n\t\tcopyBlockWithInnerBlocks,\n\t\tgetFirstChildBlockByClientIdDOMElement,\n\t\tfixInvalidBlock,\n\t\tfindSiteLogoBlock,\n\t};\n}\n","var r={grad:.9,turn:360,rad:360/(2*Math.PI)},t=function(r){return\"string\"==typeof r?r.length>0:\"number\"==typeof r},n=function(r,t,n){return void 0===t&&(t=0),void 0===n&&(n=Math.pow(10,t)),Math.round(n*r)/n+0},e=function(r,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),r>n?n:r>t?r:t},u=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},a=function(r){return{r:e(r.r,0,255),g:e(r.g,0,255),b:e(r.b,0,255),a:e(r.a)}},o=function(r){return{r:n(r.r),g:n(r.g),b:n(r.b),a:n(r.a,3)}},i=/^#([0-9a-f]{3,8})$/i,s=function(r){var t=r.toString(16);return t.length<2?\"0\"+t:t},h=function(r){var t=r.r,n=r.g,e=r.b,u=r.a,a=Math.max(t,n,e),o=a-Math.min(t,n,e),i=o?a===t?(n-e)/o:a===n?2+(e-t)/o:4+(t-n)/o:0;return{h:60*(i<0?i+6:i),s:a?o/a*100:0,v:a/255*100,a:u}},b=function(r){var t=r.h,n=r.s,e=r.v,u=r.a;t=t/360*6,n/=100,e/=100;var a=Math.floor(t),o=e*(1-n),i=e*(1-(t-a)*n),s=e*(1-(1-t+a)*n),h=a%6;return{r:255*[e,i,o,o,s,e][h],g:255*[s,e,e,i,o,o][h],b:255*[o,o,s,e,e,i][h],a:u}},g=function(r){return{h:u(r.h),s:e(r.s,0,100),l:e(r.l,0,100),a:e(r.a)}},d=function(r){return{h:n(r.h),s:n(r.s),l:n(r.l),a:n(r.a,3)}},f=function(r){return b((n=(t=r).s,{h:t.h,s:(n*=((e=t.l)<50?e:100-e)/100)>0?2*n/(e+n)*100:0,v:e+n,a:t.a}));var t,n,e},c=function(r){return{h:(t=h(r)).h,s:(u=(200-(n=t.s))*(e=t.v)/100)>0&&u<200?n*e/100/(u<=100?u:200-u)*100:0,l:u/2,a:t.a};var t,n,e,u},l=/^hsla?\\(\\s*([+-]?\\d*\\.?\\d+)(deg|rad|grad|turn)?\\s*,\\s*([+-]?\\d*\\.?\\d+)%\\s*,\\s*([+-]?\\d*\\.?\\d+)%\\s*(?:,\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*)?\\)$/i,p=/^hsla?\\(\\s*([+-]?\\d*\\.?\\d+)(deg|rad|grad|turn)?\\s+([+-]?\\d*\\.?\\d+)%\\s+([+-]?\\d*\\.?\\d+)%\\s*(?:\\/\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*)?\\)$/i,v=/^rgba?\\(\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*,\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*,\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*(?:,\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*)?\\)$/i,m=/^rgba?\\(\\s*([+-]?\\d*\\.?\\d+)(%)?\\s+([+-]?\\d*\\.?\\d+)(%)?\\s+([+-]?\\d*\\.?\\d+)(%)?\\s*(?:\\/\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*)?\\)$/i,y={string:[[function(r){var t=i.exec(r);return t?(r=t[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:4===r.length?n(parseInt(r[3]+r[3],16)/255,2):1}:6===r.length||8===r.length?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:8===r.length?n(parseInt(r.substr(6,2),16)/255,2):1}:null:null},\"hex\"],[function(r){var t=v.exec(r)||m.exec(r);return t?t[2]!==t[4]||t[4]!==t[6]?null:a({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:void 0===t[7]?1:Number(t[7])/(t[8]?100:1)}):null},\"rgb\"],[function(t){var n=l.exec(t)||p.exec(t);if(!n)return null;var e,u,a=g({h:(e=n[1],u=n[2],void 0===u&&(u=\"deg\"),Number(e)*(r[u]||1)),s:Number(n[3]),l:Number(n[4]),a:void 0===n[5]?1:Number(n[5])/(n[6]?100:1)});return f(a)},\"hsl\"]],object:[[function(r){var n=r.r,e=r.g,u=r.b,o=r.a,i=void 0===o?1:o;return t(n)&&t(e)&&t(u)?a({r:Number(n),g:Number(e),b:Number(u),a:Number(i)}):null},\"rgb\"],[function(r){var n=r.h,e=r.s,u=r.l,a=r.a,o=void 0===a?1:a;if(!t(n)||!t(e)||!t(u))return null;var i=g({h:Number(n),s:Number(e),l:Number(u),a:Number(o)});return f(i)},\"hsl\"],[function(r){var n=r.h,a=r.s,o=r.v,i=r.a,s=void 0===i?1:i;if(!t(n)||!t(a)||!t(o))return null;var h=function(r){return{h:u(r.h),s:e(r.s,0,100),v:e(r.v,0,100),a:e(r.a)}}({h:Number(n),s:Number(a),v:Number(o),a:Number(s)});return b(h)},\"hsv\"]]},N=function(r,t){for(var n=0;n<t.length;n++){var e=t[n][0](r);if(e)return[e,t[n][1]]}return[null,void 0]},x=function(r){return\"string\"==typeof r?N(r.trim(),y.string):\"object\"==typeof r&&null!==r?N(r,y.object):[null,void 0]},I=function(r){return x(r)[1]},M=function(r,t){var n=c(r);return{h:n.h,s:e(n.s+100*t,0,100),l:n.l,a:n.a}},H=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},$=function(r,t){var n=c(r);return{h:n.h,s:n.s,l:e(n.l+100*t,0,100),a:n.a}},j=function(){function r(r){this.parsed=x(r)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return null!==this.parsed},r.prototype.brightness=function(){return n(H(this.rgba),2)},r.prototype.isDark=function(){return H(this.rgba)<.5},r.prototype.isLight=function(){return H(this.rgba)>=.5},r.prototype.toHex=function(){return r=o(this.rgba),t=r.r,e=r.g,u=r.b,i=(a=r.a)<1?s(n(255*a)):\"\",\"#\"+s(t)+s(e)+s(u)+i;var r,t,e,u,a,i},r.prototype.toRgb=function(){return o(this.rgba)},r.prototype.toRgbString=function(){return r=o(this.rgba),t=r.r,n=r.g,e=r.b,(u=r.a)<1?\"rgba(\"+t+\", \"+n+\", \"+e+\", \"+u+\")\":\"rgb(\"+t+\", \"+n+\", \"+e+\")\";var r,t,n,e,u},r.prototype.toHsl=function(){return d(c(this.rgba))},r.prototype.toHslString=function(){return r=d(c(this.rgba)),t=r.h,n=r.s,e=r.l,(u=r.a)<1?\"hsla(\"+t+\", \"+n+\"%, \"+e+\"%, \"+u+\")\":\"hsl(\"+t+\", \"+n+\"%, \"+e+\"%)\";var r,t,n,e,u},r.prototype.toHsv=function(){return r=h(this.rgba),{h:n(r.h),s:n(r.s),v:n(r.v),a:n(r.a,3)};var r},r.prototype.invert=function(){return w({r:255-(r=this.rgba).r,g:255-r.g,b:255-r.b,a:r.a});var r},r.prototype.saturate=function(r){return void 0===r&&(r=.1),w(M(this.rgba,r))},r.prototype.desaturate=function(r){return void 0===r&&(r=.1),w(M(this.rgba,-r))},r.prototype.grayscale=function(){return w(M(this.rgba,-1))},r.prototype.lighten=function(r){return void 0===r&&(r=.1),w($(this.rgba,r))},r.prototype.darken=function(r){return void 0===r&&(r=.1),w($(this.rgba,-r))},r.prototype.rotate=function(r){return void 0===r&&(r=15),this.hue(this.hue()+r)},r.prototype.alpha=function(r){return\"number\"==typeof r?w({r:(t=this.rgba).r,g:t.g,b:t.b,a:r}):n(this.rgba.a,3);var t},r.prototype.hue=function(r){var t=c(this.rgba);return\"number\"==typeof r?w({h:r,s:t.s,l:t.l,a:t.a}):n(t.h)},r.prototype.isEqual=function(r){return this.toHex()===w(r).toHex()},r}(),w=function(r){return r instanceof j?r:new j(r)},S=[],k=function(r){r.forEach(function(r){S.indexOf(r)<0&&(r(j,y),S.push(r))})},E=function(){return new j({r:255*Math.random(),g:255*Math.random(),b:255*Math.random()})};export{j as Colord,w as colord,k as extend,I as getFormat,E as random};\n","var o=function(o){var t=o/255;return t<.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},t=function(t){return.2126*o(t.r)+.7152*o(t.g)+.0722*o(t.b)};export default function(o){o.prototype.luminance=function(){return o=t(this.rgba),void 0===(r=2)&&(r=0),void 0===n&&(n=Math.pow(10,r)),Math.round(n*o)/n+0;var o,r,n},o.prototype.contrast=function(r){void 0===r&&(r=\"#FFF\");var n,a,i,e,v,u,d,c=r instanceof o?r:new o(r);return e=this.rgba,v=c.toRgb(),u=t(e),d=t(v),n=u>d?(u+.05)/(d+.05):(d+.05)/(u+.05),void 0===(a=2)&&(a=0),void 0===i&&(i=Math.pow(10,a)),Math.floor(i*n)/i+0},o.prototype.isReadable=function(o,t){return void 0===o&&(o=\"#FFF\"),void 0===t&&(t={}),this.contrast(o)>=(e=void 0===(i=(r=t).size)?\"normal\":i,\"AAA\"===(a=void 0===(n=r.level)?\"AA\":n)&&\"normal\"===e?7:\"AA\"===a&&\"large\"===e?3:4.5);var r,n,a,i,e}}\n","/**\n * WordPress dependencies\n */\nimport { store as blocksStore } from '@wordpress/blocks';\nimport { useSelect } from '@wordpress/data';\nimport { useCallback } from '@wordpress/element';\nimport { store as coreStore } from '@wordpress/core-data';\n\n/**\n * External dependencies\n */\nimport { extend } from 'colord';\nimport a11yPlugin from 'colord/plugins/a11y';\nimport { store as aiStore } from '@store';\nextend( [ a11yPlugin ] );\n\nexport default function useVariations() {\n\tconst MAX_VARIATIONS_SHOWN = 10;\n\n\tconst { getBlockVariations } = useSelect( blocksStore );\n\n\tconst { __experimentalGetCurrentThemeGlobalStylesVariations } =\n\t\tuseSelect( coreStore );\n\n\tconst { getGeneratedVariations } = useSelect( aiStore );\n\n\tconst getColorVariations = useCallback( () => {\n\t\tconst variations =\n\t\t\t__experimentalGetCurrentThemeGlobalStylesVariations();\n\n\t\tconst colorVariations = variations?.filter( ( v ) =>\n\t\t\tisColorVariation( v )\n\t\t);\n\n\t\t// Inject custom-generated variation so that it's available to the color picker.\n\t\tif ( getGeneratedVariations && getGeneratedVariations()?.length > 0 ) {\n\t\t\treturn [ ...getGeneratedVariations(), ...colorVariations ];\n\t\t}\n\t\treturn colorVariations;\n\t}, [\n\t\t__experimentalGetCurrentThemeGlobalStylesVariations,\n\t\tgetGeneratedVariations,\n\t] );\n\n\tconst getFontVariations = useCallback( () => {\n\t\tconst variations =\n\t\t\t__experimentalGetCurrentThemeGlobalStylesVariations();\n\n\t\tconst fontVariations = variations?.filter( ( v ) =>\n\t\t\tisFontVariation( v )\n\t\t);\n\n\t\treturn fontVariations;\n\t}, [ __experimentalGetCurrentThemeGlobalStylesVariations ] );\n\n\tconst getColorVariationByTitle = useCallback(\n\t\t( title ) => {\n\t\t\tconst colors = getColorVariations();\n\t\t\treturn colors?.find( ( v ) => v.title === title );\n\t\t},\n\t\t[ getColorVariations ]\n\t);\n\n\tconst getFontVariationByTitle = ( title ) => {\n\t\tconst fonts = getFontVariations();\n\t\treturn fonts?.find( ( v ) => v.title === title );\n\t};\n\n\tconst getHexColorFromThemeVar = useCallback(\n\t\t( colorTitle, themeVar ) => {\n\t\t\t// themeVar can now be a hex color, if so just return it\n\t\t\tif ( themeVar.startsWith( '#' ) ) {\n\t\t\t\treturn themeVar;\n\t\t\t}\n\n\t\t\tconst variation = getColorVariationByTitle( colorTitle );\n\t\t\tconst varIndex = themeVar?.match( /\\d+/ )[ 0 ];\n\t\t\treturn variation?.settings?.color?.palette?.theme?.find(\n\t\t\t\t( color ) => {\n\t\t\t\t\treturn varIndex === color.slug.match( /\\d+/ )[ 0 ];\n\t\t\t\t}\n\t\t\t)?.color;\n\t\t},\n\t\t[ getColorVariationByTitle ]\n\t);\n\n\tconst getSectionVariationBackgroundColor = useCallback(\n\t\t( sectionVariationName, colorTitle ) => {\n\t\t\tconst variation = getColorVariationByTitle( colorTitle );\n\n\t\t\tlet themeVar = false;\n\t\t\tif ( sectionVariationName.includes( 'default' ) ) {\n\t\t\t\tthemeVar = variation?.styles?.color?.background || false;\n\t\t\t} else {\n\t\t\t\tthemeVar =\n\t\t\t\t\tvariation?.styles?.blocks?.[ 'core/group' ]?.variations?.[\n\t\t\t\t\t\tsectionVariationName\n\t\t\t\t\t]?.color?.background || false;\n\t\t\t}\n\n\t\t\tif ( ! themeVar ) return false;\n\n\t\t\tconst hex = getHexColorFromThemeVar( colorTitle, themeVar );\n\n\t\t\tif ( ! hex ) return false;\n\n\t\t\treturn {\n\t\t\t\tthemeVar,\n\t\t\t\thex,\n\t\t\t};\n\t\t},\n\t\t[ getColorVariationByTitle, getHexColorFromThemeVar ]\n\t);\n\n\tconst getSectionVariationTextColor = useCallback(\n\t\t( sectionVariationName, colorTitle ) => {\n\t\t\tconst variation = getColorVariationByTitle( colorTitle );\n\n\t\t\tlet themeVar = false;\n\t\t\tif ( sectionVariationName.includes( 'default' ) ) {\n\t\t\t\tthemeVar = variation?.styles?.color?.text || false;\n\t\t\t} else {\n\t\t\t\tthemeVar =\n\t\t\t\t\tvariation?.styles?.blocks?.[ 'core/group' ]?.variations?.[\n\t\t\t\t\t\tsectionVariationName\n\t\t\t\t\t]?.color?.text || false;\n\t\t\t}\n\n\t\t\tif ( ! themeVar ) return false;\n\n\t\t\tconst hex = getHexColorFromThemeVar( colorTitle, themeVar );\n\n\t\t\tif ( ! hex ) return false;\n\n\t\t\treturn {\n\t\t\t\tthemeVar,\n\t\t\t\thex,\n\t\t\t};\n\t\t},\n\t\t[ getColorVariationByTitle, getHexColorFromThemeVar ]\n\t);\n\n\tconst isColorVariation = ( variation ) => {\n\t\treturn variation?.settings?.color && ! variation?.settings?.typography;\n\t};\n\n\tconst isFontVariation = ( variation ) => {\n\t\treturn variation?.settings?.typography && ! variation?.settings?.color;\n\t};\n\n\tconst getVariationKeywords = ( type ) => {\n\t\tlet variations;\n\t\tswitch ( type ) {\n\t\t\tcase 'color':\n\t\t\t\tvariations = getColorVariations();\n\t\t\t\tbreak;\n\t\t\tcase 'font':\n\t\t\t\tvariations = getFontVariations();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error( 'Invalid variation type' );\n\t\t}\n\n\t\tconst allKeywords = variations.reduce( ( acc, variation ) => {\n\t\t\tconst keywords = variation?.[ 'x-big-sky-meta' ]?.keywords;\n\t\t\tif ( keywords ) {\n\t\t\t\tkeywords.forEach( ( category ) => {\n\t\t\t\t\tif ( ! acc.includes( category ) ) {\n\t\t\t\t\t\tacc.push( category );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t\treturn acc;\n\t\t}, [] );\n\t\treturn allKeywords;\n\t};\n\n\tconst getSocialLinkVariations = useCallback( () => {\n\t\tconst variations = getBlockVariations( 'core/social-link' );\n\t\treturn variations;\n\t}, [ getBlockVariations ] );\n\n\treturn {\n\t\tMAX_VARIATIONS_SHOWN,\n\t\tgetColorVariations,\n\t\tgetFontVariations,\n\t\tgetColorVariationByTitle,\n\t\tgetFontVariationByTitle,\n\t\tgetHexColorFromThemeVar,\n\t\tgetSectionVariationBackgroundColor,\n\t\tgetSectionVariationTextColor,\n\t\tisColorVariation,\n\t\tisFontVariation,\n\t\tgetVariationKeywords,\n\t\tgetSocialLinkVariations,\n\t};\n}\n","export const BIG_SKY_CUSTOM_THEME_PREFIX = 'Big Sky Custom';\nexport const BIG_SKY_CUSTOM_COLOR_PREFIX = 'Custom Color';\n","import { colord } from 'colord';\nimport { BIG_SKY_CUSTOM_COLOR_PREFIX } from './custom-color-variations/constants.js';\n\n/**\n * Gets the lightest color from an array of colors\n * @param {Array} colors The array of colors to compare\n * @return {Object} The lightest color\n */\nexport const getLightestColor = ( colors ) => {\n\treturn Object.values( colors ).reduce( ( lightest, current ) =>\n\t\tcolord( current.color ).brightness() >\n\t\tcolord( lightest.color ).brightness()\n\t\t\t? current\n\t\t\t: lightest\n\t);\n};\n\n/**\n * Gets the darkest color from an array of colors\n * @param {Array} colors The array of colors to compare\n * @return {Object} The darkest color\n */\nexport const getDarkestColor = ( colors ) => {\n\treturn Object.values( colors ).reduce( ( darkest, current ) =>\n\t\tcolord( current.color ).brightness() <\n\t\tcolord( darkest.color ).brightness()\n\t\t\t? current\n\t\t\t: darkest\n\t);\n};\n\n/**\n * Gets the best contrasting color for a given color from the theme colors\n * @param {string} color       The color to contrast\n * @param {Array}  themeColors The available theme colors\n * @return {Object} The contrasting color\n */\nexport const getContrastingThemeColor = ( color, themeColors ) => {\n\tconst isLightColor = colord( color ).isLight();\n\tlet contrastingColor;\n\tif ( isLightColor ) {\n\t\t// get the darkest theme color\n\t\tcontrastingColor = getDarkestColor( themeColors );\n\t} else {\n\t\t// get the lightest theme color\n\t\tcontrastingColor = getLightestColor( themeColors );\n\t}\n\n\treturn contrastingColor;\n};\n\n/**\n * Creates a hash from custom colors object for identification\n * @param {Object} colors Object containing color values\n * @return {string} Hash string representing the color combination\n */\nexport const createColorHash = ( colors ) => {\n\tif ( ! colors ) return '';\n\n\t// Sort the colors to ensure consistent hashing regardless of object key order\n\tconst sortedColors = Object.values( colors ).sort();\n\t// Join colors and create a simple hash\n\treturn sortedColors.join( '-' ).replace( /#/g, '' ).toUpperCase();\n};\n\n/*\ntheme.settings.color.palette.theme has a schema like this:\n[\n    {\n        \"color\": \"#333333\",\n        \"name\": \"Custom Color 1\",\n        \"slug\": \"theme-1\"\n    },\n    {\n        \"color\": \"#FFFFFF\",\n        \"name\": \"Custom Color 2\",\n        \"slug\": \"theme-2\"\n    },\n    {\n        \"color\": \"#FF5722\",\n        \"name\": \"Custom Color 3\",\n        \"slug\": \"theme-3\"\n    },\n    {\n        \"color\": \"#F5F5F5\",\n        \"name\": \"Custom Color 4\",\n        \"slug\": \"theme-4\"\n    }\n]\n*/\nexport const addColorToTheme = ( { theme, color } ) => {\n\tif ( ! theme?.settings?.color ) theme.settings.color = {};\n\tif ( ! theme?.settings?.color?.palette ) theme.settings.color.palette = {};\n\tif ( ! theme?.settings?.color?.palette?.theme )\n\t\ttheme.settings.color.palette.theme = [];\n\n\t// check if the color already exists in the theme\n\tconst existingColor = theme.settings.color.palette.theme.find(\n\t\t( c ) => c.color === color\n\t);\n\tif ( existingColor ) {\n\t\treturn existingColor;\n\t}\n\n\t// get the next available slug by checking the highest slug and adding 1\n\tconst nextIndex =\n\t\tMath.max(\n\t\t\t...theme.settings.color.palette.theme.map( ( c ) =>\n\t\t\t\tparseInt( c.slug.split( '-' )[ 1 ] )\n\t\t\t)\n\t\t) + 1;\n\tconst newColor = {\n\t\tcolor,\n\t\tname: `${ BIG_SKY_CUSTOM_COLOR_PREFIX } ${ nextIndex }`,\n\t\tslug: `theme-${ nextIndex }`,\n\t};\n\ttheme.settings.color.palette.theme.push( newColor );\n\n\treturn newColor;\n};\n\n/* eslint-disable jsdoc/require-param, jsdoc/check-param-names */\n/**\n * Applies theme adjustments to ensure all sections are legible\n * @param {Object} styles                        The theme styles\n * @param {Array}  palette                       The palette of colors\n * @param {Array}  path                          The path of the theme object\n * @param {string} currentVariationBackgroundVar The current variation background variable\n * @param {string} currentVariationTextVar       The current variation text variable\n */\n/* eslint-enable jsdoc/require-param, jsdoc/check-param-names */\nconst applyThemeAdjustments = ( {\n\tstyles,\n\tpalette,\n\tpath = [],\n\tcurrentVariationBackgroundVar = '',\n\tcurrentVariationTextVar = '',\n} ) => {\n\tif ( path.includes( 'elements' ) && path.includes( 'button' ) ) {\n\t\t// ensure the button background contrasts with the variation background\n\t\tif ( styles?.color?.background ) {\n\t\t\tconst backgroundColor = palette.find( ( color ) =>\n\t\t\t\tstyles.color.background.includes( color.slug )\n\t\t\t).color;\n\t\t\tconst currentVariationBackgroundColor = palette.find( ( color ) =>\n\t\t\t\tcurrentVariationBackgroundVar.includes( color.slug )\n\t\t\t).color;\n\t\t\tif (\n\t\t\t\tcolord( backgroundColor ).contrast(\n\t\t\t\t\tcolord( currentVariationBackgroundColor )\n\t\t\t\t) < 4.5\n\t\t\t) {\n\t\t\t\t// try to pick a contrasting color from one of the other palette colors\n\t\t\t\tconst contrastingColor = getContrastingThemeColor(\n\t\t\t\t\tcurrentVariationBackgroundColor,\n\t\t\t\t\tpalette\n\t\t\t\t);\n\t\t\t\tstyles.color.background = `var(--wp--preset--color--${ contrastingColor.slug })`;\n\t\t\t\tif ( styles?.[ ':hover' ]?.color?.background ) {\n\t\t\t\t\t// check if the contrasting color is light or dark and adjust the hover color accordingly\n\t\t\t\t\tconst isLightContrastingColor = colord(\n\t\t\t\t\t\tcontrastingColor.color\n\t\t\t\t\t).isLight();\n\t\t\t\t\tif ( isLightContrastingColor ) {\n\t\t\t\t\t\tstyles[\n\t\t\t\t\t\t\t':hover'\n\t\t\t\t\t\t].color.background = `color-mix(in srgb, var(--wp--preset--color--${ contrastingColor.slug }) 85%, #000)`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstyles[\n\t\t\t\t\t\t\t':hover'\n\t\t\t\t\t\t].color.background = `color-mix(in srgb, var(--wp--preset--color--${ contrastingColor.slug }) 90%, transparent)`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// ensure the button text contrasts with the button background\n\t\tif ( styles?.color?.text ) {\n\t\t\tconst backgroundColor = palette.find( ( color ) =>\n\t\t\t\tstyles.color.background.includes( color.slug )\n\t\t\t).color;\n\t\t\tconst textColor = palette.find( ( color ) =>\n\t\t\t\tstyles.color.text.includes( color.slug )\n\t\t\t).color;\n\t\t\tif (\n\t\t\t\tcolord( backgroundColor ).contrast( colord( textColor ) ) < 4.5\n\t\t\t) {\n\t\t\t\t// try to pick a contrasting color from one of the other palette colors\n\t\t\t\tconst contrastingColor = getContrastingThemeColor(\n\t\t\t\t\tbackgroundColor,\n\t\t\t\t\tpalette\n\t\t\t\t);\n\t\t\t\tstyles.color.text = `var(--wp--preset--color--${ contrastingColor.slug })`;\n\t\t\t\tif ( styles?.[ ':hover' ]?.color?.text ) {\n\t\t\t\t\tstyles[\n\t\t\t\t\t\t':hover'\n\t\t\t\t\t].color.text = `var(--wp--preset--color--${ contrastingColor.slug })`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn;\n\t}\n\n\t// ensure the variation background and text contrast with each other\n\tif ( styles?.color?.background && styles?.color?.text ) {\n\t\tcurrentVariationBackgroundVar = styles.color.background;\n\t\tcurrentVariationTextVar = styles.color.text;\n\t\t// get hex value of themeStyles.color.background and themeStyles.color.text from the palette\n\t\tconst backgroundColor = palette.find( ( color ) =>\n\t\t\tstyles.color.background.includes( color.slug )\n\t\t).color;\n\t\tconst textColor = palette.find( ( color ) =>\n\t\t\tstyles.color.text.includes( color.slug )\n\t\t).color;\n\t\tif ( colord( backgroundColor ).contrast( colord( textColor ) ) < 4.5 ) {\n\t\t\t// try to pick a contrasting color from one of the other palette colors\n\t\t\tconst contrastingColor = getContrastingThemeColor(\n\t\t\t\tbackgroundColor,\n\t\t\t\tpalette\n\t\t\t);\n\t\t\tstyles.color.text = `var(--wp--preset--color--${ contrastingColor.slug })`;\n\t\t}\n\t}\n\n\t// Recursively check all object properties\n\tif ( typeof styles === 'object' && styles !== null ) {\n\t\tfor ( const [ key, value ] of Object.entries( styles ) ) {\n\t\t\tapplyThemeAdjustments( {\n\t\t\t\tstyles: value,\n\t\t\t\tpalette,\n\t\t\t\tpath: [ ...path, key ],\n\t\t\t\tcurrentVariationBackgroundVar,\n\t\t\t\tcurrentVariationTextVar,\n\t\t\t} );\n\t\t}\n\t}\n};\n\n/* eslint-disable jsdoc/require-param, jsdoc/check-param-names */\n/**\n * Updates the theme palette and makes sure the variations are legible\n * @param {Object} theme  The theme\n * @param {Object} colors The colors in this format: { color1: '#000000', color2: '#000000', color3: '#000000', color4: '#000000', color5: '#000000' }\n */\n/* eslint-enable jsdoc/require-param, jsdoc/check-param-names */\nexport const updateThemePalette = ( { theme, colors } ) => {\n\ttheme.settings.color.palette.theme.forEach( ( color, index ) => {\n\t\tif ( colors[ `color${ index + 1 }` ] ) {\n\t\t\tcolor.color = colors[ `color${ index + 1 }` ];\n\t\t\tcolor.name = `${ BIG_SKY_CUSTOM_COLOR_PREFIX } ${ index + 1 }`;\n\t\t}\n\t} );\n\n\t// apply any theme adjustments here to ensure the palette and variations are legible\n\tapplyThemeAdjustments( {\n\t\tstyles: theme.styles,\n\t\tpalette: theme?.settings?.color?.palette?.theme,\n\t} );\n};\n\n// Helper to ensure a color meets saturation and hue rules\nconst adjustToNeutralBase = ( color ) => {\n\tconst { s, l } = colord( color ).toHsl();\n\treturn colord( { h: 0, s: Math.min( s, 20 ), l } ).toHex();\n};\n\n// Helper to ensure contrast ratio between two colors\nconst adjustContrast = ( color1, targetContrast, referenceColor ) => {\n\tconst refColor = colord( referenceColor );\n\tconst isRefLight = refColor.isLight(); // Determine if reference color is light\n\tlet attempts = 0;\n\tconst maxAttempts = 50;\n\tlet adjustedColor = color1;\n\n\twhile (\n\t\tattempts < maxAttempts &&\n\t\tcolord( adjustedColor ).contrast( refColor ) < targetContrast\n\t) {\n\t\tconst { h, s, l } = colord( adjustedColor ).toHsl();\n\t\tconst adjustment = isRefLight ? -5 : 5; // Darken if reference is light, lighten if dark\n\t\tconst newL = Math.min( Math.max( l + adjustment, 0 ), 100 ); // Clamp lightness to [0, 100]\n\t\tadjustedColor = colord( { h, s, l: newL } ).toHex();\n\t\tattempts++;\n\t}\n\n\treturn adjustedColor;\n};\n\n// Generate a tonal variation of a base color\nconst generateTonalVariation = ( baseColor ) => {\n\tconst { h, s, l } = colord( baseColor ).toHsl();\n\t/* eslint-disable no-restricted-syntax */\n\tconst newL = Math.max( 0, Math.min( 100, l + ( Math.random() * 10 - 5 ) ) ); // ±5%\n\tconst newS = Math.max( 0, Math.min( 100, s + ( Math.random() * 10 - 5 ) ) ); // ±5%\n\t/* eslint-enable no-restricted-syntax */\n\treturn colord( { h, s: newS, l: newL } ).toHex();\n};\n\n// Adjust tonal variation to meet rules\nconst adjustTonalVariation = ( color, baseColor ) => {\n\tconst { h, s, l } = colord( baseColor ).toHsl();\n\tconst { s: cS, l: cL } = colord( color ).toHsl();\n\n\tconst adjustedS = Math.max( 0, Math.min( 100, s + ( cS - s ) ) ); // ±5% saturation\n\tconst adjustedL = Math.max( 0, Math.min( 100, l + ( cL - l ) ) ); // ±5% lightness\n\n\treturn colord( { h, s: adjustedS, l: adjustedL } ).toHex();\n};\n\n// Generate or adjust palette\nexport const generateHslPalette = ( colors ) => {\n\tlet [ color1, color2, color3, color4 ] = colors;\n\n\t// Step 1: Adjust or generate color1\n\tif ( ! color1 ) {\n\t\tcolor1 = adjustToNeutralBase( '#000000' ); // Default to black as base\n\t} else {\n\t\tcolor1 = colord( color1 ).toHex();\n\t}\n\n\t// Step 2: Adjust or generate color2\n\tif ( ! color2 ) {\n\t\tcolor2 = adjustContrast( '#808080', 4.5, color1 ); // Start with gray\n\t} else {\n\t\tcolor2 = colord( color2 ).toHex();\n\t}\n\n\t// Step 3: Adjust or generate color3\n\tif ( ! color3 ) {\n\t\tcolor3 = generateTonalVariation( color1 ); // Generate a tonal variation\n\t\tif ( ! colord( color3 ).contrast( colord( color1 ) ) <= 2 ) {\n\t\t\tcolor3 = adjustTonalVariation( color3, color1 ); // Adjust tonal variation\n\t\t}\n\t} else {\n\t\tcolor3 = colord( color3 ).toHex();\n\t}\n\n\t// Step 4: Adjust or generate color4\n\tif ( ! color4 ) {\n\t\tcolor4 = adjustContrast( '#c0c0c0', 4.5, color1 ); // Start with light gray\n\t} else {\n\t\tcolor4 = colord( color4 ).toHex();\n\t}\n\n\treturn [ color1, color2, color3, color4 ];\n};\n","import { createColorHash, updateThemePalette } from '../colors.js';\nimport { BIG_SKY_CUSTOM_THEME_PREFIX } from './constants.js';\nimport { colord } from 'colord';\n\n// This custom scheme is applied to the template theme\n// It sorts the custom colors by brightness (lightest to darkest) and updates the color palette\nconst lightTheme = ( { templateTheme, colors } ) => {\n\t// Create array of color entries to sort\n\tconst colorEntries = Object.entries( colors ).map( ( [ key, value ] ) => [\n\t\tkey,\n\t\tvalue.color,\n\t] );\n\n\t// Sort colors by brightness (lightest to darkest)\n\tconst sortedColors = colorEntries.sort(\n\t\t( a, b ) =>\n\t\t\tcolord( b[ 1 ] ).brightness() - colord( a[ 1 ] ).brightness()\n\t);\n\n\t// Create new colors object with desired order\n\tconst reorderedColors = {\n\t\tcolor1: sortedColors[ 0 ][ 1 ], // Lightest color\n\t\tcolor2: sortedColors[ 3 ][ 1 ], // Darkest color\n\t\tcolor3: sortedColors[ 1 ][ 1 ], // Second lightest\n\t\tcolor4: sortedColors[ 2 ][ 1 ], // Second darkest\n\t};\n\n\t// Apply the reordered colors to the theme\n\tupdateThemePalette( {\n\t\ttheme: templateTheme,\n\t\tcolors: reorderedColors,\n\t} );\n\n\ttemplateTheme.title = `${ BIG_SKY_CUSTOM_THEME_PREFIX } Light Theme - ${ createColorHash(\n\t\tObject.fromEntries(\n\t\t\tObject.entries( colors ).map( ( [ key, value ] ) => [\n\t\t\t\tkey,\n\t\t\t\tvalue.color,\n\t\t\t] )\n\t\t)\n\t) }`;\n\n\treturn templateTheme;\n};\n\nexport default lightTheme;\n","import { createColorHash, updateThemePalette } from '../colors.js';\nimport { BIG_SKY_CUSTOM_THEME_PREFIX } from './constants.js';\nimport { colord } from 'colord';\n\n// This custom scheme is applied to the template theme\n// It sorts the custom colors by brightness (darkest to lightest) and updates the color palette\nconst darkTheme = ( { templateTheme, colors } ) => {\n\t// Create array of color entries to sort\n\tconst colorEntries = Object.entries( colors ).map( ( [ key, value ] ) => [\n\t\tkey,\n\t\tvalue.color,\n\t] );\n\n\t// Sort colors by brightness (darkest to lightest)\n\tconst sortedColors = colorEntries.sort(\n\t\t( a, b ) =>\n\t\t\tcolord( a[ 1 ] ).brightness() - colord( b[ 1 ] ).brightness()\n\t);\n\n\t// Create new colors object with desired order\n\tconst reorderedColors = {\n\t\tcolor1: sortedColors[ 0 ][ 1 ], // Darkest color\n\t\tcolor2: sortedColors[ 3 ][ 1 ], // Lightest color\n\t\tcolor3: sortedColors[ 1 ][ 1 ], // Second darkest\n\t\tcolor4: sortedColors[ 2 ][ 1 ], // Second lightest\n\t};\n\n\t// Apply the reordered colors to the theme\n\tupdateThemePalette( {\n\t\ttheme: templateTheme,\n\t\tcolors: reorderedColors,\n\t} );\n\n\ttemplateTheme.title = `${ BIG_SKY_CUSTOM_THEME_PREFIX } Dark Theme - ${ createColorHash(\n\t\tObject.fromEntries(\n\t\t\tObject.entries( colors ).map( ( [ key, value ] ) => [\n\t\t\t\tkey,\n\t\t\t\tvalue.color,\n\t\t\t] )\n\t\t)\n\t) }`;\n\n\treturn templateTheme;\n};\n\nexport default darkTheme;\n","import {\n\tcreateColorHash,\n\tgenerateHslPalette,\n\tupdateThemePalette,\n} from '../colors.js';\nimport { BIG_SKY_CUSTOM_THEME_PREFIX } from './constants.js';\n\n// This custom scheme is applied to the template theme\n// Creates a random HSL palette from the user_requested colors and updates the color palette\nconst hslTheme = ( { templateTheme, colors } ) => {\n\t// Build an array of colors\n\t// For colors that the user did not request, create an empty string\n\tconst colorsArray = Object.values( colors ).map( ( color ) =>\n\t\tcolor.user_requested ? color.color : ''\n\t);\n\n\t// check if the colorsArray has all empty strings, if so, return null\n\tconst allEmpty = colorsArray.every( ( color ) => color === '' );\n\tif ( allEmpty ) {\n\t\treturn null;\n\t}\n\n\t// if all colors are already set, return null\n\tconst allSet = colorsArray.every( ( color ) => color !== '' );\n\tif ( allSet ) {\n\t\treturn null;\n\t}\n\n\tconst hslPalette = generateHslPalette( colorsArray );\n\n\t// convert randomHSLPalette to an object like this: { color1: '#000000', color2: '#000000', color3: '#000000', color4: '#000000', color5: '#000000' }\n\tconst newColors = hslPalette.reduce( ( acc, color, index ) => {\n\t\tacc[ `color${ index + 1 }` ] = color;\n\t\treturn acc;\n\t}, {} );\n\n\tupdateThemePalette( {\n\t\ttheme: templateTheme,\n\t\tcolors: newColors,\n\t} );\n\n\ttemplateTheme.title = `${ BIG_SKY_CUSTOM_THEME_PREFIX } HSL Theme - ${ createColorHash(\n\t\tnewColors\n\t) }`;\n\n\treturn templateTheme;\n};\n\nexport default hslTheme;\n","import lightTheme from './light-theme.js';\nimport darkTheme from './dark-theme.js';\nimport hslTheme from './hsl-theme.js';\n\n// return color palette variations\nconst getVariations = () => {\n\treturn [ lightTheme, darkTheme, hslTheme ];\n};\n\nexport default getVariations;\n","/**\n * External dependencies\n */\nimport deepmerge from 'deepmerge';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tuseCallback,\n\tuseContext,\n\tuseEffect,\n\tuseMemo,\n} from '@wordpress/element';\nimport {\n\tprivateApis as blockEditorPrivateApis,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { useDispatch, useRegistry, useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\n\nimport { unlock } from '@utils/lock-unlock';\nimport useBlocks from '@hooks/use-blocks';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport useVariations from '@hooks/use-variations';\nimport { store as aiStore } from '@store';\nimport getVariations from '@utils/custom-color-variations';\nimport { BIG_SKY_CUSTOM_THEME_PREFIX } from '@utils/custom-color-variations/constants';\nconst { GlobalStylesContext } = unlock( blockEditorPrivateApis );\nconst { useGlobalSetting, useGlobalStyle, useGlobalStylesReset } = unlock(\n\tblockEditorPrivateApis\n);\n\nfunction resolveColor( color, variation ) {\n\tconst normalized = color?.replace( /\\s/g, '' );\n\tif ( 'var(--wp--preset--color--' !== normalized?.slice( 0, 25 ) ) {\n\t\treturn color;\n\t}\n\n\tconst slug = normalized.slice( 25, -1 );\n\n\treturn variation.settings.color.palette.theme.find(\n\t\t( c ) => c.slug === slug\n\t).color;\n}\n\nexport default function useStyles() {\n\tconst { getTemplatePartClientID } = useBlocks();\n\tconst { currentColor, currentFont, isOnboarded } =\n\t\tuseSiteMetadata().getSiteMetadata();\n\tconst {\n\t\tsetInitializedCustomScheme,\n\t\tpushGeneratedVariations,\n\t\tsetCurrentColor: setCurrentColorState,\n\t\tsetCurrentFont: setCurrentFontState,\n\t\tsetUserStyleWithSettings,\n\t\tsetCurrentPaletteColors,\n\t} = useDispatch( aiStore );\n\tconst [ canReset, reset ] = useGlobalStylesReset();\n\tconst { getBlocks, getBlockAttributes, getBlocksByName } =\n\t\tuseSelect( blockEditorStore );\n\tconst { updateBlockAttributes } = useDispatch( blockEditorStore );\n\tconst { editEntityRecord, saveEditedEntityRecord } =\n\t\tuseDispatch( coreStore );\n\tconst { setCurrentColor, setCurrentFont } = useSiteMetadata();\n\tconst { setUserConfig } = useContext( GlobalStylesContext );\n\tconst { globalStylesId, getEntityRecord, getEditedEntityRecord } =\n\t\tuseSelect( ( select ) => ( {\n\t\t\tglobalStylesId:\n\t\t\t\tselect( coreStore ).__experimentalGetCurrentGlobalStylesId(),\n\t\t\tgetEntityRecord: select( coreStore ).getEntityRecord,\n\t\t\tgetEditedEntityRecord: select( coreStore ).getEditedEntityRecord,\n\t\t} ) );\n\tconst registry = useRegistry();\n\tconst { getColorVariations, getFontVariations, getColorVariationByTitle } =\n\t\tuseVariations();\n\tconst variations = useSelect( ( select ) => {\n\t\treturn select(\n\t\t\tcoreStore\n\t\t).__experimentalGetCurrentThemeGlobalStylesVariations();\n\t}, [] );\n\tconst {\n\t\tgetCurrentColor,\n\t\tgetCurrentFont,\n\t\tgetInitializedCustomScheme,\n\t\tgetUserStyleWithSettings,\n\t\tgetCustomVariationTemplates,\n\t\tisEditorIframeLoaded,\n\t} = useSelect( ( select ) => {\n\t\tconst ai = select( aiStore );\n\t\treturn {\n\t\t\tcurrentPaletteColors: ai.getCurrentPaletteColors(),\n\t\t\tgetCurrentColor: ai.getCurrentColor,\n\t\t\tgetCurrentFont: ai.getCurrentFont,\n\t\t\tgetInitializedCustomScheme: ai.getInitializedCustomScheme,\n\t\t\tgetUserStyleWithSettings: ai.getUserStyleWithSettings,\n\t\t\tgetCustomVariationTemplates: ai.getCustomVariationTemplates,\n\t\t\tisEditorIframeLoaded: ai.getIsEditorIframeLoaded(),\n\t\t};\n\t} );\n\tconst [ coreColors ] = useGlobalSetting( 'color.palette.core' );\n\tconst [ themeColors ] = useGlobalSetting( 'color.palette.theme' );\n\tconst [ customColors ] = useGlobalSetting( 'color.palette.custom' );\n\n\tconst paletteColors = useMemo(\n\t\t() => [\n\t\t\t...( customColors || [] ),\n\t\t\t...( themeColors || [] ),\n\t\t\t...( coreColors || [] ),\n\t\t],\n\t\t[ customColors, themeColors, coreColors ]\n\t);\n\n\tconst [ userStyle ] = useGlobalStyle( '', undefined, 'user', {\n\t\tshouldDecodeEncode: false,\n\t} );\n\tconst [ customCss, setCustomCss ] = useGlobalStyle( '', undefined, 'all', {\n\t\tshouldDecodeEncode: false,\n\t} );\n\n\tuseEffect( () => {\n\t\t// check if userStyle has settings\n\t\tif (\n\t\t\t[ 'blocks', 'color', 'elements', 'typography' ].every( ( key ) =>\n\t\t\t\tuserStyle.hasOwnProperty( key )\n\t\t\t)\n\t\t) {\n\t\t\tsetUserStyleWithSettings( userStyle );\n\t\t}\n\t}, [ userStyle, setUserStyleWithSettings ] );\n\n\tconst useCustomCss = useCallback(\n\t\t() => [\n\t\t\tcustomCss.css,\n\t\t\t( css ) =>\n\t\t\t\tsetCustomCss( {\n\t\t\t\t\t...getUserStyleWithSettings(),\n\t\t\t\t\tcss,\n\t\t\t\t} ),\n\t\t],\n\t\t[ customCss.css, getUserStyleWithSettings, setCustomCss ]\n\t);\n\n\tconst resetStyles = () => {\n\t\tif ( canReset ) {\n\t\t\treset();\n\t\t\teditEntityRecord( 'root', 'globalStyles', globalStylesId, {\n\t\t\t\tid: globalStylesId,\n\t\t\t\tsettings: {},\n\t\t\t\tstyles: {},\n\t\t\t} );\n\t\t\tsaveEditedEntityRecord( 'root', 'globalStyles', globalStylesId );\n\t\t}\n\t};\n\n\tconst currentTheme = useMemo( () => {\n\t\tconst globalStyles = getEditedEntityRecord(\n\t\t\t'root',\n\t\t\t'globalStyles',\n\t\t\tglobalStylesId\n\t\t);\n\t\treturn globalStyles;\n\t}, [ getEditedEntityRecord, globalStylesId ] );\n\n\tconst getCurrentTheme = useCallback( () => {\n\t\tconst globalStyles = getEditedEntityRecord(\n\t\t\t'root',\n\t\t\t'globalStyles',\n\t\t\tglobalStylesId\n\t\t);\n\t\treturn globalStyles;\n\t}, [ getEditedEntityRecord, globalStylesId ] );\n\n\tconst getVariationSectionValues = useCallback(\n\t\t( colorTitle ) => {\n\t\t\tconst variation = getColorVariationByTitle( colorTitle );\n\t\t\tconst sectionColors = Object.entries(\n\t\t\t\tvariation?.styles?.blocks?.[ 'core/group' ]?.variations ?? {}\n\t\t\t).map( ( [ name, sectionColor ] ) => ( {\n\t\t\t\tname,\n\t\t\t\tbackground: sectionColor?.color?.background,\n\t\t\t\ttext: sectionColor?.color?.text,\n\t\t\t\telements: sectionColor?.elements,\n\t\t\t} ) );\n\n\t\t\tif (\n\t\t\t\t! sectionColors.find(\n\t\t\t\t\t( sectionColor ) => sectionColor.name === 'default'\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tsectionColors.unshift( {\n\t\t\t\t\tname: 'section-default',\n\t\t\t\t\tbackground: variation?.styles?.color?.background,\n\t\t\t\t\ttext: variation?.styles?.color?.text,\n\t\t\t\t\telements: variation?.styles?.elements,\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\treturn sectionColors;\n\t\t},\n\t\t[ getColorVariationByTitle ]\n\t);\n\n\tconst updateRootBlocksStyles = useCallback(\n\t\t( {\n\t\t\trootBlocks,\n\t\t\tbackground_color,\n\t\t\ttext_color,\n\t\t\tbutton_color,\n\t\t\tbutton_text_color,\n\t\t\tsection_to_update = '',\n\t\t} ) => {\n\t\t\t// if colors is an object, get the slug\n\t\t\t// if colors are in the format var(--wp--preset--color--theme-n)\n\t\t\t// extract the \"theme-n\"\n\t\t\tbackground_color =\n\t\t\t\tbackground_color?.slug ||\n\t\t\t\tbackground_color?.match(\n\t\t\t\t\t/var\\(--wp--preset--color--(theme-\\d+)\\)/\n\t\t\t\t)?.[ 1 ] ||\n\t\t\t\tbackground_color;\n\t\t\ttext_color =\n\t\t\t\ttext_color?.slug ||\n\t\t\t\ttext_color?.match(\n\t\t\t\t\t/var\\(--wp--preset--color--(theme-\\d+)\\)/\n\t\t\t\t)?.[ 1 ] ||\n\t\t\t\ttext_color;\n\t\t\tbutton_color =\n\t\t\t\tbutton_color?.slug ||\n\t\t\t\tbutton_color?.match(\n\t\t\t\t\t/var\\(--wp--preset--color--(theme-\\d+)\\)/\n\t\t\t\t)?.[ 1 ] ||\n\t\t\t\tbutton_color;\n\t\t\tbutton_text_color =\n\t\t\t\tbutton_text_color?.slug ||\n\t\t\t\tbutton_text_color?.match(\n\t\t\t\t\t/var\\(--wp--preset--color--(theme-\\d+)\\)/\n\t\t\t\t)?.[ 1 ] ||\n\t\t\t\tbutton_text_color;\n\n\t\t\t// Collect all updates first\n\t\t\tconst allUpdates = [];\n\n\t\t\t// Helper to collect button updates recursively\n\t\t\tconst collectChildUpdates = ( block ) => {\n\t\t\t\tconst updates = [];\n\t\t\t\tconst attributes = getBlockAttributes( block.clientId );\n\t\t\t\tconst updatedAttributes = { ...attributes };\n\n\t\t\t\tswitch ( block.name ) {\n\t\t\t\t\tcase 'core/button':\n\t\t\t\t\tcase 'jetpack/button':\n\t\t\t\t\t\tif ( button_text_color ) {\n\t\t\t\t\t\t\tupdatedAttributes.textColor = button_text_color;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( button_color ) {\n\t\t\t\t\t\t\tupdatedAttributes.backgroundColor = button_color;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( button_color || button_text_color ) {\n\t\t\t\t\t\t\tupdates.push( {\n\t\t\t\t\t\t\t\tclientId: block.clientId,\n\t\t\t\t\t\t\t\tattributes: updatedAttributes,\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'core/heading':\n\t\t\t\t\tcase 'core/paragraph':\n\t\t\t\t\tcase 'core/site-title':\n\t\t\t\t\tcase 'core/post-title':\n\t\t\t\t\t\tif ( text_color ) {\n\t\t\t\t\t\t\tupdatedAttributes.textColor = text_color;\n\t\t\t\t\t\t\tupdates.push( {\n\t\t\t\t\t\t\t\tclientId: block.clientId,\n\t\t\t\t\t\t\t\tattributes: updatedAttributes,\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'jetpack/subscriptions':\n\t\t\t\t\t\tif ( button_text_color ) {\n\t\t\t\t\t\t\tupdatedAttributes.textColor = button_text_color;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( button_color ) {\n\t\t\t\t\t\t\tupdatedAttributes.buttonBackgroundColor =\n\t\t\t\t\t\t\t\tbutton_color;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( button_color || button_text_color ) {\n\t\t\t\t\t\t\tupdates.push( {\n\t\t\t\t\t\t\t\tclientId: block.clientId,\n\t\t\t\t\t\t\t\tattributes: updatedAttributes,\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tblock.innerBlocks.forEach( ( innerBlock ) => {\n\t\t\t\t\tupdates.push( ...collectChildUpdates( innerBlock ) );\n\t\t\t\t} );\n\n\t\t\t\treturn updates;\n\t\t\t};\n\n\t\t\t// Collect root block updates and their button updates\n\t\t\trootBlocks.forEach( ( rootBlock ) => {\n\t\t\t\tconst attributes = getBlockAttributes( rootBlock.clientId );\n\n\t\t\t\t// if we're updating a section, check if the block has a className with is-style-\n\t\t\t\tif ( section_to_update ) {\n\t\t\t\t\tconst matches =\n\t\t\t\t\t\tattributes.className?.match( /is-style-(\\S+)\\b/ );\n\t\t\t\t\tif ( matches ) {\n\t\t\t\t\t\tconst sectionName = matches[ 1 ];\n\t\t\t\t\t\tif ( sectionName !== section_to_update ) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst updatedAttributes = { ...attributes };\n\n\t\t\t\tif ( background_color ) {\n\t\t\t\t\tupdatedAttributes.backgroundColor = background_color;\n\t\t\t\t}\n\t\t\t\tif ( text_color ) {\n\t\t\t\t\tupdatedAttributes.textColor = text_color;\n\t\t\t\t}\n\n\t\t\t\tif ( background_color || text_color ) {\n\t\t\t\t\tallUpdates.push( {\n\t\t\t\t\t\tclientId: rootBlock.clientId,\n\t\t\t\t\t\tattributes: updatedAttributes,\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\t// Collect button updates for this root block\n\t\t\t\tallUpdates.push( ...collectChildUpdates( rootBlock ) );\n\t\t\t} );\n\n\t\t\t// Apply all updates\n\t\t\tallUpdates.forEach( ( update ) => {\n\t\t\t\tupdateBlockAttributes( update.clientId, update.attributes );\n\t\t\t} );\n\t\t},\n\t\t[ getBlockAttributes, updateBlockAttributes ]\n\t);\n\n\tconst getRootBlocks = useCallback( () => {\n\t\tconst postContentBlockId = getBlocksByName( 'core/post-content' )[ 0 ];\n\t\tconst rootContentBlocks = getBlocks( postContentBlockId );\n\t\tconst header = getBlocks( getTemplatePartClientID( 'header' ) );\n\t\tconst footer = getBlocks( getTemplatePartClientID( 'footer' ) );\n\t\treturn [ ...rootContentBlocks, ...header, ...footer ];\n\t}, [ getBlocksByName, getBlocks, getTemplatePartClientID ] );\n\n\tconst setStyles = useCallback(\n\t\t( parameters ) => {\n\t\t\tconst {\n\t\t\t\tcolor,\n\t\t\t\tfont,\n\t\t\t\tundoIgnore = false,\n\t\t\t\tupdateBlocks = true,\n\t\t\t} = parameters;\n\n\t\t\tlet selectedColorTitle = color || getCurrentColor() || currentColor;\n\t\t\tlet selectedFontTitle = font || getCurrentFont() || currentFont;\n\n\t\t\tconst colors = getColorVariations();\n\t\t\t// Check to make sure both the font and color are valid\n\t\t\t// If either are not valid, set them to a random color or font title\n\t\t\tif ( ! colors?.find( ( c ) => c.title === selectedColorTitle ) ) {\n\t\t\t\tselectedColorTitle =\n\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\tcolors[ Math.floor( Math.random() * colors.length ) ]\n\t\t\t\t\t\t?.title;\n\t\t\t}\n\n\t\t\t// I would love to get rid of the `variations` here, but if we do that, we\n\t\t\t// have few renders where colors/fonts is undefined at the start of the app.\n\t\t\t// This causes the reducer down in `getVariationKeywords` to fail horribly.\n\t\t\t// This is probably something to streamline.\n\t\t\tconst colorVariation = ( colors ?? variations )?.find(\n\t\t\t\t( v ) => v.title === selectedColorTitle\n\t\t\t);\n\t\t\tif ( color ) {\n\t\t\t\tsetCurrentColor( selectedColorTitle );\n\t\t\t\tsetCurrentColorState( selectedColorTitle );\n\n\t\t\t\tconst colorPalette =\n\t\t\t\t\tcolorVariation?.settings?.color?.palette?.theme;\n\t\t\t\tsetCurrentPaletteColors( colorPalette );\n\n\t\t\t\t// set block attributes styles to match the current variation\n\t\t\t\tif ( updateBlocks ) {\n\t\t\t\t\tregistry.batch( () => {\n\t\t\t\t\t\tconst sectionValues =\n\t\t\t\t\t\t\tgetVariationSectionValues( selectedColorTitle );\n\t\t\t\t\t\tsectionValues.forEach( ( sectionValue ) => {\n\t\t\t\t\t\t\tupdateRootBlocksStyles( {\n\t\t\t\t\t\t\t\trootBlocks: getRootBlocks(),\n\t\t\t\t\t\t\t\tbackground_color: sectionValue.background,\n\t\t\t\t\t\t\t\ttext_color: sectionValue.text,\n\t\t\t\t\t\t\t\tbutton_color:\n\t\t\t\t\t\t\t\t\tsectionValue.elements?.button?.color\n\t\t\t\t\t\t\t\t\t\t?.background,\n\t\t\t\t\t\t\t\tbutton_text_color:\n\t\t\t\t\t\t\t\t\tsectionValue.elements?.button?.color?.text,\n\t\t\t\t\t\t\t\tsection_to_update: sectionValue.name,\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst fonts = getFontVariations();\n\t\t\tif ( ! fonts?.find( ( f ) => f.title === selectedFontTitle ) ) {\n\t\t\t\tselectedFontTitle =\n\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\tfonts[ Math.floor( Math.random() * fonts.length ) ]?.title;\n\t\t\t}\n\t\t\tconst fontVariation = ( fonts ?? variations )?.find(\n\t\t\t\t( v ) => v.title === selectedFontTitle\n\t\t\t);\n\t\t\tif ( font ) {\n\t\t\t\tsetCurrentFont( selectedFontTitle );\n\t\t\t\tsetCurrentFontState( selectedFontTitle );\n\t\t\t}\n\n\t\t\tsetUserConfig(\n\t\t\t\t( currentConfig ) => {\n\t\t\t\t\t// Custom merge options to handle arrays properly\n\t\t\t\t\tconst mergeOptions = {\n\t\t\t\t\t\tarrayMerge: ( destinationArray, sourceArray ) =>\n\t\t\t\t\t\t\tsourceArray,\n\t\t\t\t\t};\n\n\t\t\t\t\t// Custom merge function to ensure only all keys from the target are included, except for typography\n\t\t\t\t\tconst customMerge = ( target = {}, source = {} ) => {\n\t\t\t\t\t\tconst result = { ...target };\n\n\t\t\t\t\t\tfor ( const key in source ) {\n\t\t\t\t\t\t\tif ( source.hasOwnProperty( key ) ) {\n\t\t\t\t\t\t\t\tif ( key === 'typography' ) {\n\t\t\t\t\t\t\t\t\t// Only include typography from source\n\t\t\t\t\t\t\t\t\tresult[ key ] = source[ key ];\n\t\t\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t\t\ttypeof source[ key ] === 'object' &&\n\t\t\t\t\t\t\t\t\t! Array.isArray( source[ key ] )\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\tresult[ key ] = customMerge(\n\t\t\t\t\t\t\t\t\t\ttarget[ key ] || {},\n\t\t\t\t\t\t\t\t\t\tsource[ key ]\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tresult[ key ] = source[ key ];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t};\n\n\t\t\t\t\tconst newConfig = {\n\t\t\t\t\t\tsettings: [\n\t\t\t\t\t\t\tcolorVariation?.settings,\n\t\t\t\t\t\t\tfontVariation?.settings,\n\t\t\t\t\t\t]\n\t\t\t\t\t\t\t.filter( Boolean )\n\t\t\t\t\t\t\t.reduce(\n\t\t\t\t\t\t\t\t( acc, curr ) =>\n\t\t\t\t\t\t\t\t\tdeepmerge( acc, curr, mergeOptions ),\n\t\t\t\t\t\t\t\t{}\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\tstyles: [\n\t\t\t\t\t\t\tcolorVariation?.styles,\n\t\t\t\t\t\t\tfontVariation?.styles,\n\t\t\t\t\t\t]\n\t\t\t\t\t\t\t.filter( Boolean )\n\t\t\t\t\t\t\t.reduce(\n\t\t\t\t\t\t\t\t( acc, curr ) =>\n\t\t\t\t\t\t\t\t\tdeepmerge( acc, curr, mergeOptions ),\n\t\t\t\t\t\t\t\t{}\n\t\t\t\t\t\t\t),\n\t\t\t\t\t};\n\n\t\t\t\t\treturn customMerge( currentConfig, newConfig );\n\t\t\t\t},\n\t\t\t\t{ undoIgnore }\n\t\t\t);\n\n\t\t\t// Update the title of the global styles entity\n\t\t\teditEntityRecord(\n\t\t\t\t'root',\n\t\t\t\t'globalStyles',\n\t\t\t\tglobalStylesId,\n\t\t\t\t{\n\t\t\t\t\ttitle: selectedColorTitle,\n\t\t\t\t},\n\t\t\t\t{ undoIgnore: true }\n\t\t\t);\n\n\t\t\treturn {\n\t\t\t\tselectedColorVariation: selectedColorTitle,\n\t\t\t\tselectedFontVariation: selectedFontTitle,\n\t\t\t};\n\t\t},\n\t\t[\n\t\t\tcurrentColor,\n\t\t\tcurrentFont,\n\t\t\teditEntityRecord,\n\t\t\tgetColorVariations,\n\t\t\tgetCurrentColor,\n\t\t\tgetCurrentFont,\n\t\t\tgetFontVariations,\n\t\t\tgetRootBlocks,\n\t\t\tgetVariationSectionValues,\n\t\t\tglobalStylesId,\n\t\t\tregistry,\n\t\t\tsetCurrentColor,\n\t\t\tsetCurrentColorState,\n\t\t\tsetCurrentFont,\n\t\t\tsetCurrentFontState,\n\t\t\tsetCurrentPaletteColors,\n\t\t\tsetUserConfig,\n\t\t\tupdateRootBlocksStyles,\n\t\t\tvariations,\n\t\t]\n\t);\n\n\tconst saveStylesEntityRecord = async () => {\n\t\tawait saveEditedEntityRecord( 'root', 'globalStyles', globalStylesId );\n\t};\n\n\tconst getCustomVariationTemplateCopy = () => {\n\t\treturn JSON.parse(\n\t\t\tJSON.stringify( getCustomVariationTemplates()[ 0 ] )\n\t\t);\n\t};\n\n\tconst getThemeColors = () => {\n\t\treturn themeColors;\n\t};\n\n\tconst hexToRgb = ( hex ) => {\n\t\tlet r = 0,\n\t\t\tg = 0,\n\t\t\tb = 0;\n\n\t\t// 3 digits\n\t\tif ( hex.length === 4 ) {\n\t\t\tr = '0x' + hex[ 1 ] + hex[ 1 ];\n\t\t\tg = '0x' + hex[ 2 ] + hex[ 2 ];\n\t\t\tb = '0x' + hex[ 3 ] + hex[ 3 ];\n\n\t\t\t// 6 digits\n\t\t} else if ( hex.length === 7 ) {\n\t\t\tr = '0x' + hex[ 1 ] + hex[ 2 ];\n\t\t\tg = '0x' + hex[ 3 ] + hex[ 4 ];\n\t\t\tb = '0x' + hex[ 5 ] + hex[ 6 ];\n\t\t}\n\n\t\treturn [ +r, +g, +b ].join( ',' );\n\t};\n\n\tconst getVariationBackgroundColor = useCallback(\n\t\t( colorTitle ) => {\n\t\t\tconst variation = getColorVariationByTitle( colorTitle );\n\t\t\treturn variation?.styles?.color?.background;\n\t\t},\n\t\t[ getColorVariationByTitle ]\n\t);\n\n\tconst getVariationTextColor = useCallback(\n\t\t( colorTitle ) => {\n\t\t\tconst variation = getColorVariationByTitle( colorTitle );\n\t\t\treturn variation?.styles?.color?.text;\n\t\t},\n\t\t[ getColorVariationByTitle ]\n\t);\n\n\tconst getVariationSectionColors = useCallback(\n\t\t( colorTitle ) => {\n\t\t\tconst variation = getColorVariationByTitle( colorTitle );\n\t\t\tconst sectionColors = Object.entries(\n\t\t\t\tvariation?.styles?.blocks?.[ 'core/group' ]?.variations ?? {}\n\t\t\t).map( ( [ name, sectionColor ] ) => ( {\n\t\t\t\tname,\n\t\t\t\tlabel: name,\n\t\t\t\tbackground: resolveColor(\n\t\t\t\t\tsectionColor?.color?.background,\n\t\t\t\t\tvariation\n\t\t\t\t),\n\t\t\t\ttext: resolveColor( sectionColor?.color?.text, variation ),\n\t\t\t} ) );\n\n\t\t\tif (\n\t\t\t\t! sectionColors.find(\n\t\t\t\t\t( sectionColor ) => sectionColor.name === 'default'\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tsectionColors.unshift( {\n\t\t\t\t\tname: 'default',\n\t\t\t\t\tlabel: 'Default',\n\t\t\t\t\tbackground: resolveColor(\n\t\t\t\t\t\tvariation?.styles?.color?.background,\n\t\t\t\t\t\tvariation\n\t\t\t\t\t),\n\t\t\t\t\ttext: resolveColor(\n\t\t\t\t\t\tvariation?.styles?.color?.text,\n\t\t\t\t\t\tvariation\n\t\t\t\t\t),\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\treturn sectionColors;\n\t\t},\n\t\t[ getColorVariationByTitle ]\n\t);\n\n\tconst resetBlockTextColor = ( block ) => {\n\t\tupdateBlockAttributes( block.clientId, {\n\t\t\tstyle: {\n\t\t\t\t...block.attributes.style,\n\t\t\t\tcolor: {\n\t\t\t\t\ttext: undefined,\n\t\t\t\t},\n\t\t\t},\n\t\t} );\n\t};\n\n\t/**\n\t * Combines custom colors with predefined templates to create color scheme variations.\n\t *\n\t * This approach uses static templates rather than AI generation for several reasons:\n\t * 1. Templates ensure consistent array length since AI generation cannot guarantee exact element counts\n\t * 2. Templates allow precise element descriptions and metadata that would be difficult to maintain with AI\n\t * 3. Templates preserve critical slug mappings needed for Gutenberg block integration\n\t * 4. Templates enable flexible color reordering while maintaining the same color set\n\t *\n\t * @param {Object} paletteColorsObject - Object containing color values {color1: '#000000', color2: '#000000', color3: '#000000', color4: '#000000'}\n\t *\n\t * @return {Array} Array of color scheme variations\n\t *\n\t * @see createCustomSchemeVariations\n\t * @see customSchemeTemplate1\n\t * @see customSchemeTemplate2\n\t */\n\tconst createCustomSchemeVariations = useCallback(\n\t\t( { custom_colors } ) => {\n\t\t\tconst customVariationTemplates = getCustomVariationTemplates();\n\t\t\tconst generatedVariations = [];\n\t\t\tconst customColorVariations = getVariations();\n\t\t\tfor ( const customColorVariation of customColorVariations ) {\n\t\t\t\t// make deep copies of the customVariationTemplate\n\t\t\t\tconst templateTheme = JSON.parse(\n\t\t\t\t\tJSON.stringify( customVariationTemplates[ 0 ] )\n\t\t\t\t);\n\t\t\t\tgeneratedVariations.push(\n\t\t\t\t\tcustomColorVariation( {\n\t\t\t\t\t\ttemplateTheme,\n\t\t\t\t\t\tcolors: custom_colors,\n\t\t\t\t\t} )\n\t\t\t\t);\n\t\t\t}\n\t\t\t// filter out any null values from the generatedVariations array\n\t\t\tconst filteredVariations = generatedVariations.filter(\n\t\t\t\t( variation ) => variation !== null\n\t\t\t);\n\n\t\t\tpushGeneratedVariations( filteredVariations );\n\t\t\treturn filteredVariations;\n\t\t},\n\t\t[ getCustomVariationTemplates, pushGeneratedVariations ]\n\t);\n\n\t// Push the existing palette colors to the generated variations on initialization\n\t// This ensures we always have a Custom Scheme in the palette\n\tuseEffect( () => {\n\t\tif (\n\t\t\t! getCustomVariationTemplates().length ||\n\t\t\tgetInitializedCustomScheme() ||\n\t\t\t! isOnboarded ||\n\t\t\t! isEditorIframeLoaded\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\t// always create a variation for a custom theme\n\t\tconst currentThemeCopy = JSON.parse( JSON.stringify( currentTheme ) );\n\t\tcurrentThemeCopy.title = currentColor?.startsWith(\n\t\t\tBIG_SKY_CUSTOM_THEME_PREFIX\n\t\t)\n\t\t\t? currentColor\n\t\t\t: BIG_SKY_CUSTOM_THEME_PREFIX;\n\t\tpushGeneratedVariations( [ currentThemeCopy ] );\n\t\tsetCurrentPaletteColors( paletteColors );\n\t\tsetInitializedCustomScheme( true );\n\t}, [\n\t\tcurrentColor,\n\t\tpaletteColors,\n\t\tgetCustomVariationTemplates,\n\t\tgetEntityRecord,\n\t\tgetInitializedCustomScheme,\n\t\tglobalStylesId,\n\t\tisOnboarded,\n\t\tpushGeneratedVariations,\n\t\tsetInitializedCustomScheme,\n\t\tsetCurrentPaletteColors,\n\t\tcurrentTheme,\n\t\tsetStyles,\n\t\tisEditorIframeLoaded,\n\t\tgetRootBlocks,\n\t] );\n\n\treturn {\n\t\tcurrentTheme,\n\t\tgetCurrentTheme,\n\t\tresetStyles,\n\t\tsetStyles,\n\t\tsaveStylesEntityRecord,\n\t\tthemeColors,\n\t\tpaletteColors,\n\t\thexToRgb,\n\t\tgetVariationBackgroundColor,\n\t\tgetVariationTextColor,\n\t\tgetVariationSectionColors,\n\t\tuseCustomCss,\n\t\tgetThemeColors,\n\t\tresetBlockTextColor,\n\t\tcreateCustomSchemeVariations,\n\t\tgetCustomVariationTemplateCopy,\n\t\tupdateRootBlocksStyles,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport apiFetch from '@wordpress/api-fetch';\n\n/**\n * Internal dependencies\n */\nimport log from '@utils/log-debug.js';\n\nexport async function getDummyPosts( tagId ) {\n\ttry {\n\t\treturn await apiFetch( {\n\t\t\tpath: `/wp/v2/posts?tags=${ tagId }&status=private`,\n\t\t\tmethod: 'GET',\n\t\t} );\n\t} catch ( error ) {\n\t\tlog.error( 'Error fetching dummy posts: ', error );\n\t}\n}\n\nexport async function createDummyPosts( posts ) {\n\tif ( ! posts ) {\n\t\treturn;\n\t}\n\n\tconst data = {\n\t\tposts,\n\t};\n\n\ttry {\n\t\treturn await apiFetch( {\n\t\t\tpath: '/wpcom/v2/big-sky/v1/dummy-posts',\n\t\t\tmethod: 'POST',\n\t\t\tdata,\n\t\t} );\n\t} catch ( error ) {\n\t\tlog.error( 'Error creating dummy posts: ', error );\n\t\treturn false;\n\t}\n}\n\nexport async function deleteDummyPosts() {\n\ttry {\n\t\treturn await apiFetch( {\n\t\t\tpath: '/wpcom/v2/big-sky/v1/dummy-posts',\n\t\t\tmethod: 'DELETE',\n\t\t} );\n\t} catch ( error ) {\n\t\tlog.error( 'Error deleting dummy posts: ', error );\n\t\treturn false;\n\t}\n}\n\nexport async function getDummyPostTag() {\n\ttry {\n\t\treturn await apiFetch( {\n\t\t\tpath: '/wp/v2/tags?search=dummy-post',\n\t\t\tmethod: 'GET',\n\t\t} );\n\t} catch ( error ) {\n\t\tlog.error( 'Error fetching dummy post tag: ', error );\n\t}\n}\n\nexport async function createDummyPostTag() {\n\ttry {\n\t\treturn await apiFetch( {\n\t\t\tpath: '/wp/v2/tags?name=dummy-post',\n\t\t\tmethod: 'POST',\n\t\t} );\n\t} catch ( error ) {\n\t\tlog.error( 'Error creating dummy post tag: ', error );\n\t}\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"router\"];","/**\n * WordPress dependencies\n */\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { createBlock } from '@wordpress/blocks';\nimport { subscribe, useDispatch, useSelect } from '@wordpress/data';\nimport { useCallback } from '@wordpress/element';\nimport { privateApis as routerPrivateApis } from '@wordpress/router';\n\n/**\n * Internal dependencies\n */\nimport useBlocks from '@hooks/use-blocks';\nimport { unlock } from '@utils/lock-unlock';\nimport { store as aiStore } from '@store';\nimport setDelay from '@utils/set-delay';\nimport { getCanvasIframeElements } from '@utils/canvas-iframe-elements';\n\nexport default function useCanvas() {\n\tconst DUMMY_SECTION_CLASSNAMES = 'big-sky__dummy-section alignfull';\n\n\tconst { getBlocks, getBlocksByName } = useSelect( blockEditorStore );\n\tconst { setZoomLevel, resetZoomLevel } = unlock(\n\t\tuseDispatch( blockEditorStore )\n\t);\n\n\tconst {\n\t\t__unstableSetEditorMode,\n\t\treplaceInnerBlocks,\n\t\tupdateBlockAttributes,\n\t\treplaceBlock,\n\t\t__unstableMarkNextChangeAsNotPersistent,\n\t} = useDispatch( blockEditorStore );\n\n\tconst { delaySettings, isEditorIframeLoaded } = useSelect( ( select ) => ( {\n\t\tdelaySettings: select( aiStore ).getDelaySettings(),\n\t\tisEditorIframeLoaded: select( aiStore ).getIsEditorIframeLoaded(),\n\t} ) );\n\n\tconst { getTemplatePartClientID, getContentBlockClientID, scrollToBlock } =\n\t\tuseBlocks();\n\n\tconst { useLocation } = unlock( routerPrivateApis );\n\tconst { params, query } = useLocation();\n\tlet canvas = 'view';\n\tif ( query?.canvas ) {\n\t\tcanvas = query.canvas;\n\t} else if ( params?.canvas ) {\n\t\tcanvas = params.canvas;\n\t}\n\n\tconst addPatternsToCanvas = async (\n\t\tpatterns,\n\t\treplaceTemplateParts = true,\n\t\tisQuickOnboarding = false\n\t) => {\n\t\t// Adjust the number of dummy sections to match the number of patterns incoming.\n\t\tawait insertDummySections( {\n\t\t\tcount: patterns.length,\n\t\t\treplaceTemplateParts,\n\t\t} );\n\t\tconst { headerPattern, bodyPatterns, footerPattern } =\n\t\t\tsplitPatterns( patterns );\n\n\t\t// Wait on each pattern resolver in order, then display the\n\t\t// final patterns one by on as the resolve.\n\t\tawait setDelay( delaySettings.onboarding.afterBlockProcessed );\n\n\t\t// Use each of the dummy sections on the canvas as a base for creating\n\t\t// a 'skeleton' of the incoming pattern. The skeleton is the structure\n\t\t// of the pattern minus images/colors and readable text.\n\t\tif ( headerPattern ) addPatternSkeleton( headerPattern.pattern, 0 );\n\t\tif ( footerPattern ) addPatternSkeleton( footerPattern.pattern, 0 );\n\n\t\tfor ( let i = 0; i < bodyPatterns.length; i++ ) {\n\t\t\taddPatternSkeleton( bodyPatterns[ i ].pattern, i );\n\t\t}\n\n\t\tif ( headerPattern ) {\n\t\t\tawait headerPattern.resolver;\n\t\t\tawait addPatternToCanvas(\n\t\t\t\theaderPattern.pattern,\n\t\t\t\t0,\n\t\t\t\tisQuickOnboarding\n\t\t\t);\n\t\t}\n\n\t\tfor ( let i = 0; i < bodyPatterns.length; i++ ) {\n\t\t\tconst { pattern, resolver } = bodyPatterns[ i ];\n\n\t\t\tawait resolver;\n\n\t\t\t// This delay is here to make sure there is always space\n\t\t\t// between each section sliding in. We don't want more than\n\t\t\t// one section sliding in at a time.\n\t\t\tif ( ! isQuickOnboarding ) {\n\t\t\t\tawait setDelay( delaySettings.onboarding.afterBlockProcessed );\n\t\t\t}\n\n\t\t\tawait addPatternToCanvas( pattern, i, isQuickOnboarding );\n\t\t}\n\n\t\tif ( footerPattern ) {\n\t\t\tawait footerPattern.resolver;\n\n\t\t\tif ( ! isQuickOnboarding ) {\n\t\t\t\tawait setDelay( delaySettings.onboarding.afterBlockProcessed );\n\t\t\t}\n\n\t\t\tawait addPatternToCanvas(\n\t\t\t\tfooterPattern.pattern,\n\t\t\t\t0,\n\t\t\t\tisQuickOnboarding\n\t\t\t);\n\t\t}\n\n\t\tawait setDelay( delaySettings.onboarding.afterBlockProcessed );\n\t\tscrollToTop();\n\t};\n\n\tconst splitPatterns = ( patterns ) => {\n\t\tconst headerPattern = patterns.find(\n\t\t\t( p ) => p.pattern.category === 'header'\n\t\t);\n\t\tconst footerPattern = patterns.find(\n\t\t\t( p ) => p.pattern.category === 'footer'\n\t\t);\n\t\tconst bodyPatterns = patterns.filter(\n\t\t\t( p ) =>\n\t\t\t\tp.pattern.category !== 'header' &&\n\t\t\t\tp.pattern.category !== 'footer'\n\t\t);\n\n\t\treturn { headerPattern, bodyPatterns, footerPattern };\n\t};\n\n\tconst addPatternSkeleton = ( pattern, index ) => {\n\t\tconst rootPatternBlock = pattern.blocks[ 0 ];\n\t\tconst containerClientID = getContainerClientID( pattern );\n\n\t\tconst dummySectionClientIds = getBlocks( containerClientID ).map(\n\t\t\t( block ) => block.clientId\n\t\t);\n\n\t\tif ( dummySectionClientIds[ index ] ) {\n\t\t\taddBlocksToDummySection(\n\t\t\t\trootPatternBlock,\n\t\t\t\tdummySectionClientIds[ index ]\n\t\t\t);\n\t\t}\n\t};\n\n\tconst addPatternToCanvas = async ( pattern, index, isQuickOnboarding ) => {\n\t\tconst rootPatternBlock = pattern.blocks[ 0 ];\n\t\tconst containerClientID = getContainerClientID( pattern );\n\n\t\tconst dummySectionClientIds = getBlocks( containerClientID ).map(\n\t\t\t( block ) => block.clientId\n\t\t);\n\n\t\t// Update classname and support for background color.\n\t\trootPatternBlock.attributes.className += ' big-sky__slide-in';\n\t\trootPatternBlock.supports = {\n\t\t\tcolor: { background: true },\n\t\t\t...rootPatternBlock.supports,\n\t\t};\n\n\t\tif ( ! isQuickOnboarding ) {\n\t\t\t// Start scrolling to the right location before we insert the block\n\t\t\tscrollToBlock( dummySectionClientIds[ index ], 'center' );\n\n\t\t\t// Let the scroll get there before inserting.\n\t\t\tawait setDelay( 500 );\n\t\t}\n\n\t\t// Replace the dummy pattern with the final pattern\n\t\tif ( pattern.category === 'header' || pattern.category === 'footer' ) {\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\treplaceInnerBlocks( containerClientID, [ rootPatternBlock ] );\n\t\t} else {\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\treplaceBlock( dummySectionClientIds[ index ], rootPatternBlock );\n\t\t}\n\n\t\tif ( ! isQuickOnboarding ) {\n\t\t\tawait setDelay( 750 );\n\t\t}\n\n\t\tupdateBlockAttributes( rootPatternBlock.clientId, {\n\t\t\tclassName: rootPatternBlock.attributes.className.replace(\n\t\t\t\t' big-sky__slide-in',\n\t\t\t\t''\n\t\t\t),\n\t\t} );\n\t};\n\n\tconst setIframeScale = useCallback( () => {\n\t\tif ( ! isEditorIframeLoaded || canvas === 'view' ) return;\n\n\t\tconst { canvasiFrameRoot } = getCanvasIframeElements();\n\t\tlet windowWidth = window.innerWidth;\n\n\t\tif ( windowWidth > 1850 ) {\n\t\t\twindowWidth = 1850;\n\t\t} else if ( windowWidth < 980 ) {\n\t\t\twindowWidth = 980;\n\t\t}\n\n\t\t// set css vars needed\n\t\tif ( canvasiFrameRoot ) {\n\t\t\tconst selectedBlockScale = -0.00001 * windowWidth + 1.035;\n\t\t\tcanvasiFrameRoot.style.setProperty(\n\t\t\t\t'--block-editor-selected-block-scale',\n\t\t\t\tselectedBlockScale\n\t\t\t);\n\t\t}\n\t}, [ canvas, isEditorIframeLoaded ] );\n\n\tconst clearBlocks = () => {\n\t\treturn new Promise( ( resolve ) => {\n\t\t\tlet unsubscribe = () => {}; // Initialize with a no-op function\n\t\t\tconst checkAndClearBlocks = () => {\n\t\t\t\tconst contentBlocks = getBlocks( getContentBlockClientID() );\n\t\t\t\tif ( contentBlocks.length > 0 ) {\n\t\t\t\t\tunsubscribe(); // Now safe to call\n\t\t\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\t\t\treplaceInnerBlocks( getContentBlockClientID(), [\n\t\t\t\t\t\tcreateBlock( 'core/paragraph', {\n\t\t\t\t\t\t\tplaceholder: ' ',\n\t\t\t\t\t\t} ),\n\t\t\t\t\t] );\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t};\n\t\t\tunsubscribe = subscribe( checkAndClearBlocks );\n\t\t\tcheckAndClearBlocks(); // Check immediately in case blocks already exist\n\t\t} );\n\t};\n\n\tconst clearTemplateParts = () => {\n\t\treturn new Promise( ( resolve ) => {\n\t\t\tlet unsubscribe = () => {}; // Initialize with a no-op function\n\t\t\tconst checkAndClearTemplateParts = () => {\n\t\t\t\tconst templatePartClientIds =\n\t\t\t\t\tgetBlocksByName( 'core/template-part' );\n\t\t\t\tif ( templatePartClientIds.length > 0 ) {\n\t\t\t\t\tunsubscribe(); // Now safe to call\n\t\t\t\t\tfor ( const clientId of templatePartClientIds ) {\n\t\t\t\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\t\t\t\treplaceInnerBlocks( clientId, [\n\t\t\t\t\t\t\tcreateBlock( 'core/paragraph', {\n\t\t\t\t\t\t\t\tplaceholder: ' ',\n\t\t\t\t\t\t\t} ),\n\t\t\t\t\t\t] );\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t};\n\t\t\tunsubscribe = subscribe( checkAndClearTemplateParts );\n\t\t\tcheckAndClearTemplateParts(); // Check immediately in case blocks already exist\n\t\t} );\n\t};\n\n\tconst createDummySection = ( { isEmpty = true, className = '' } = {} ) => {\n\t\treturn createBlock(\n\t\t\t'core/group',\n\t\t\t{\n\t\t\t\tclassName: `${ DUMMY_SECTION_CLASSNAMES } ${\n\t\t\t\t\tisEmpty ? 'big-sky__is-empty-dummy' : ''\n\t\t\t\t} ${ className }`,\n\t\t\t},\n\t\t\t[\n\t\t\t\tcreateBlock( 'core/paragraph', {\n\t\t\t\t\tplaceholder: ' ',\n\t\t\t\t} ),\n\t\t\t]\n\t\t);\n\t};\n\n\tconst insertDummySections = async ( {\n\t\tcount,\n\t\treplaceTemplateParts = true,\n\t} ) => {\n\t\tif ( count === 0 ) return;\n\n\t\t// Create dummy sections based on the wireframe section count\n\t\tconst dummySections = Array.from( {\n\t\t\tlength: count,\n\t\t} ).map( createDummySection );\n\n\t\tconst contentBlockClientID = getContentBlockClientID();\n\t\tconst headerTemplatePartClientID = getTemplatePartClientID( 'header' );\n\t\tconst footerTemplatePartClientID = getTemplatePartClientID( 'footer' );\n\n\t\tif ( replaceTemplateParts && headerTemplatePartClientID ) {\n\t\t\tconst currentHeaderBlocks = getBlocks( headerTemplatePartClientID );\n\t\t\tif (\n\t\t\t\t! currentHeaderBlocks?.[ 0 ]?.innerBlocks?.[ 0 ]?.attributes\n\t\t\t\t\t?.metadata?.remotePatternId\n\t\t\t) {\n\t\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\t\treplaceInnerBlocks( headerTemplatePartClientID, [\n\t\t\t\t\tdummySections.shift(),\n\t\t\t\t] );\n\t\t\t}\n\t\t}\n\n\t\tif ( replaceTemplateParts && footerTemplatePartClientID ) {\n\t\t\tconst currentFooterBlocks = getBlocks( footerTemplatePartClientID );\n\t\t\tif (\n\t\t\t\t! currentFooterBlocks?.[ 0 ]?.innerBlocks?.[ 0 ]?.attributes\n\t\t\t\t\t?.metadata?.remotePatternId\n\t\t\t) {\n\t\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\t\treplaceInnerBlocks( footerTemplatePartClientID, [\n\t\t\t\t\tdummySections.shift(),\n\t\t\t\t] );\n\t\t\t}\n\t\t}\n\n\t\tconst currentContentBlocks = getBlocks( contentBlockClientID );\n\t\tif (\n\t\t\t! currentContentBlocks?.[ 0 ]?.innerBlocks?.[ 0 ]?.attributes\n\t\t\t\t?.metadata?.remotePatternId\n\t\t) {\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\treplaceInnerBlocks( contentBlockClientID, dummySections );\n\t\t}\n\t};\n\n\tconst addBlocksToDummySection = (\n\t\trootPatternBlock,\n\t\tdummySectionClientId\n\t) => {\n\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\treplaceInnerBlocks( dummySectionClientId, [ rootPatternBlock ] );\n\n\t\t// Remove the background color style form the rootPattern block in the skeleton\n\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\tupdateBlockAttributes( rootPatternBlock.clientId, {\n\t\t\tstyle: {\n\t\t\t\t...rootPatternBlock.attributes.style,\n\t\t\t\tcolor: {\n\t\t\t\t\tbackground: undefined,\n\t\t\t\t},\n\t\t\t},\n\t\t} );\n\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\tupdateBlockAttributes( dummySectionClientId, {\n\t\t\tclassName: `${ DUMMY_SECTION_CLASSNAMES } big-sky__has-dummy-blocks `,\n\t\t} );\n\t};\n\n\tconst getContainerClientID = ( pattern ) => {\n\t\tif ( pattern?.category === 'header' ) {\n\t\t\treturn getTemplatePartClientID( 'header' );\n\t\t}\n\n\t\tif ( pattern?.category === 'footer' ) {\n\t\t\treturn getTemplatePartClientID( 'footer' );\n\t\t}\n\n\t\treturn getContentBlockClientID();\n\t};\n\n\tconst scrollToTop = () => {\n\t\tconst { canvasiFrameWindow } = getCanvasIframeElements();\n\t\tcanvasiFrameWindow?.scrollTo( { top: 0, behavior: 'smooth' } );\n\t};\n\n\tconst setStyleProperties = useCallback( ( properties ) => {\n\t\tconst { canvasiFrameRoot } = getCanvasIframeElements();\n\t\tif ( canvasiFrameRoot ) {\n\t\t\tfor ( const [ name, value ] of Object.entries( properties ) ) {\n\t\t\t\tcanvasiFrameRoot.style.setProperty( name, value );\n\t\t\t}\n\t\t}\n\t}, [] );\n\n\tconst blockDblclick = ( e ) => {\n\t\te.preventDefault();\n\t\te.stopImmediatePropagation();\n\t};\n\n\tconst zoomOut = async () => {\n\t\tconst { canvasiFrameRoot } = getCanvasIframeElements();\n\t\tif ( setZoomLevel ) setZoomLevel( 0.5 );\n\t\t__unstableSetEditorMode( 'zoom-out' );\n\n\t\t// Add double-click event listener to prevent default behavior\n\t\tconst { canvasiFrameBody } = getCanvasIframeElements();\n\t\tif ( canvasiFrameBody ) {\n\t\t\tcanvasiFrameBody.addEventListener(\n\t\t\t\t'dblclick',\n\t\t\t\tblockDblclick,\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\n\t\t// Wait for the next microtask to ensure the animations are registered\n\t\tawait Promise.resolve();\n\n\t\tif ( canvasiFrameRoot ) {\n\t\t\tawait Promise.all(\n\t\t\t\tcanvasiFrameRoot\n\t\t\t\t\t.getAnimations()\n\t\t\t\t\t.map( ( animation ) => animation.finished )\n\t\t\t);\n\t\t}\n\n\t\twindow.dispatchEvent( new Event( 'resize' ) );\n\t\t// Wait for the next event loop to make sure the `.zoom-out-animation` class is removed\n\t\t// (That Gutenberg class prevents us from scrolling to the new block)\n\t\treturn await setDelay( 0 );\n\t};\n\tconst zoomIn = async () => {\n\t\tconst { canvasiFrameRoot } = getCanvasIframeElements();\n\t\tif ( resetZoomLevel ) resetZoomLevel();\n\t\t__unstableSetEditorMode( 'edit' );\n\n\t\tawait Promise.resolve();\n\n\t\tif ( canvasiFrameRoot ) {\n\t\t\tawait Promise.all(\n\t\t\t\tcanvasiFrameRoot\n\t\t\t\t\t.getAnimations()\n\t\t\t\t\t.map( ( animation ) => animation.finished )\n\t\t\t);\n\t\t}\n\n\t\twindow.dispatchEvent( new Event( 'resize' ) );\n\t\t// Remove double-click event listener\n\t\tconst { canvasiFrameBody } = getCanvasIframeElements();\n\t\tif ( canvasiFrameBody ) {\n\t\t\tcanvasiFrameBody.removeEventListener( 'dblclick', blockDblclick );\n\t\t}\n\t\treturn await setDelay( 0 );\n\t};\n\treturn {\n\t\tcanvasMode: canvas,\n\t\taddPatternsToCanvas,\n\t\tsetStyleProperties,\n\t\tclearTemplateParts,\n\t\tclearBlocks,\n\t\tcreateDummySection,\n\t\tinsertDummySections,\n\t\tsetIframeScale,\n\t\tzoomOut,\n\t\tzoomIn,\n\t};\n}\n","import { store as editorStore } from '@wordpress/editor';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { useEffect, useRef, useState } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\nimport { recordTracksEvent } from '@utils/tracks';\n/**\n * Returns `true` if the post is done saving, `false` otherwise.\n *\n * @return {boolean} Whether the post is done saving.\n */\nexport default () => {\n\tconst [ isPostSaved, setIsPostSaved ] = useState( false );\n\tconst isPostSavingInProgress = useRef( false );\n\tconst { postType, postId } = useSelect( ( select ) => ( {\n\t\tpostType: select( editorStore ).getCurrentPostType(),\n\t\tpostId: select( editorStore ).getCurrentPostId(),\n\t} ) );\n\tconst { isSavingPost } = useSelect( ( select ) => {\n\t\treturn {\n\t\t\tisSavingPost: select( coreStore ).isSavingEntityRecord(\n\t\t\t\t'postType',\n\t\t\t\tpostType,\n\t\t\t\tpostId\n\t\t\t),\n\t\t};\n\t} );\n\n\tuseEffect( () => {\n\t\tif ( isSavingPost && ! isPostSavingInProgress.current ) {\n\t\t\tsetIsPostSaved( false );\n\t\t\tisPostSavingInProgress.current = true;\n\t\t}\n\t\tif ( ! isSavingPost && isPostSavingInProgress.current ) {\n\t\t\t// Code to run after post is done saving.\n\t\t\tsetIsPostSaved( true );\n\t\t\trecordTracksEvent( 'post_saved' );\n\t\t\tisPostSavingInProgress.current = false;\n\t\t}\n\t}, [ isSavingPost ] );\n\n\treturn isPostSaved;\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"mediaUtils\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"hooks\"];","/*! Fast Average Color | © 2023 Denis Seleznev | MIT License | https://github.com/fast-average-color/fast-average-color */\nfunction toHex(num) {\n    var str = num.toString(16);\n    return str.length === 1 ? '0' + str : str;\n}\nfunction arrayToHex(arr) {\n    return '#' + arr.map(toHex).join('');\n}\nfunction isDark(color) {\n    // http://www.w3.org/TR/AERT#color-contrast\n    var result = (color[0] * 299 + color[1] * 587 + color[2] * 114) / 1000;\n    return result < 128;\n}\nfunction prepareIgnoredColor(color) {\n    if (!color) {\n        return [];\n    }\n    return isRGBArray(color) ? color : [color];\n}\nfunction isRGBArray(value) {\n    return Array.isArray(value[0]);\n}\nfunction isIgnoredColor(data, index, ignoredColor) {\n    for (var i = 0; i < ignoredColor.length; i++) {\n        if (isIgnoredColorAsNumbers(data, index, ignoredColor[i])) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction isIgnoredColorAsNumbers(data, index, ignoredColor) {\n    switch (ignoredColor.length) {\n        case 3:\n            // [red, green, blue]\n            if (isIgnoredRGBColor(data, index, ignoredColor)) {\n                return true;\n            }\n            break;\n        case 4:\n            // [red, green, blue, alpha]\n            if (isIgnoredRGBAColor(data, index, ignoredColor)) {\n                return true;\n            }\n            break;\n        case 5:\n            // [red, green, blue, alpha, threshold]\n            if (isIgnoredRGBAColorWithThreshold(data, index, ignoredColor)) {\n                return true;\n            }\n            break;\n        default:\n            return false;\n    }\n}\nfunction isIgnoredRGBColor(data, index, ignoredColor) {\n    // Ignore if the pixel are transparent.\n    if (data[index + 3] !== 255) {\n        return true;\n    }\n    if (data[index] === ignoredColor[0] &&\n        data[index + 1] === ignoredColor[1] &&\n        data[index + 2] === ignoredColor[2]) {\n        return true;\n    }\n    return false;\n}\nfunction isIgnoredRGBAColor(data, index, ignoredColor) {\n    if (data[index + 3] && ignoredColor[3]) {\n        return data[index] === ignoredColor[0] &&\n            data[index + 1] === ignoredColor[1] &&\n            data[index + 2] === ignoredColor[2] &&\n            data[index + 3] === ignoredColor[3];\n    }\n    // Ignore rgb components if the pixel are fully transparent.\n    return data[index + 3] === ignoredColor[3];\n}\nfunction inRange(colorComponent, ignoredColorComponent, value) {\n    return colorComponent >= (ignoredColorComponent - value) &&\n        colorComponent <= (ignoredColorComponent + value);\n}\nfunction isIgnoredRGBAColorWithThreshold(data, index, ignoredColor) {\n    var redIgnored = ignoredColor[0];\n    var greenIgnored = ignoredColor[1];\n    var blueIgnored = ignoredColor[2];\n    var alphaIgnored = ignoredColor[3];\n    var threshold = ignoredColor[4];\n    var alphaData = data[index + 3];\n    var alphaInRange = inRange(alphaData, alphaIgnored, threshold);\n    if (!alphaIgnored) {\n        return alphaInRange;\n    }\n    if (!alphaData && alphaInRange) {\n        return true;\n    }\n    if (inRange(data[index], redIgnored, threshold) &&\n        inRange(data[index + 1], greenIgnored, threshold) &&\n        inRange(data[index + 2], blueIgnored, threshold) &&\n        alphaInRange) {\n        return true;\n    }\n    return false;\n}\n\nvar DEFAULT_DOMINANT_DIVIDER = 24;\nfunction dominantAlgorithm(arr, len, options) {\n    var colorHash = {};\n    var divider = options.dominantDivider || DEFAULT_DOMINANT_DIVIDER;\n    var ignoredColor = options.ignoredColor;\n    var step = options.step;\n    var max = [0, 0, 0, 0, 0];\n    for (var i = 0; i < len; i += step) {\n        var red = arr[i];\n        var green = arr[i + 1];\n        var blue = arr[i + 2];\n        var alpha = arr[i + 3];\n        if (ignoredColor && isIgnoredColor(arr, i, ignoredColor)) {\n            continue;\n        }\n        var key = Math.round(red / divider) + ',' +\n            Math.round(green / divider) + ',' +\n            Math.round(blue / divider);\n        if (colorHash[key]) {\n            colorHash[key] = [\n                colorHash[key][0] + red * alpha,\n                colorHash[key][1] + green * alpha,\n                colorHash[key][2] + blue * alpha,\n                colorHash[key][3] + alpha,\n                colorHash[key][4] + 1\n            ];\n        }\n        else {\n            colorHash[key] = [red * alpha, green * alpha, blue * alpha, alpha, 1];\n        }\n        if (max[4] < colorHash[key][4]) {\n            max = colorHash[key];\n        }\n    }\n    var redTotal = max[0];\n    var greenTotal = max[1];\n    var blueTotal = max[2];\n    var alphaTotal = max[3];\n    var count = max[4];\n    return alphaTotal ? [\n        Math.round(redTotal / alphaTotal),\n        Math.round(greenTotal / alphaTotal),\n        Math.round(blueTotal / alphaTotal),\n        Math.round(alphaTotal / count)\n    ] : options.defaultColor;\n}\n\nfunction simpleAlgorithm(arr, len, options) {\n    var redTotal = 0;\n    var greenTotal = 0;\n    var blueTotal = 0;\n    var alphaTotal = 0;\n    var count = 0;\n    var ignoredColor = options.ignoredColor;\n    var step = options.step;\n    for (var i = 0; i < len; i += step) {\n        var alpha = arr[i + 3];\n        var red = arr[i] * alpha;\n        var green = arr[i + 1] * alpha;\n        var blue = arr[i + 2] * alpha;\n        if (ignoredColor && isIgnoredColor(arr, i, ignoredColor)) {\n            continue;\n        }\n        redTotal += red;\n        greenTotal += green;\n        blueTotal += blue;\n        alphaTotal += alpha;\n        count++;\n    }\n    return alphaTotal ? [\n        Math.round(redTotal / alphaTotal),\n        Math.round(greenTotal / alphaTotal),\n        Math.round(blueTotal / alphaTotal),\n        Math.round(alphaTotal / count)\n    ] : options.defaultColor;\n}\n\nfunction sqrtAlgorithm(arr, len, options) {\n    var redTotal = 0;\n    var greenTotal = 0;\n    var blueTotal = 0;\n    var alphaTotal = 0;\n    var count = 0;\n    var ignoredColor = options.ignoredColor;\n    var step = options.step;\n    for (var i = 0; i < len; i += step) {\n        var red = arr[i];\n        var green = arr[i + 1];\n        var blue = arr[i + 2];\n        var alpha = arr[i + 3];\n        if (ignoredColor && isIgnoredColor(arr, i, ignoredColor)) {\n            continue;\n        }\n        redTotal += red * red * alpha;\n        greenTotal += green * green * alpha;\n        blueTotal += blue * blue * alpha;\n        alphaTotal += alpha;\n        count++;\n    }\n    return alphaTotal ? [\n        Math.round(Math.sqrt(redTotal / alphaTotal)),\n        Math.round(Math.sqrt(greenTotal / alphaTotal)),\n        Math.round(Math.sqrt(blueTotal / alphaTotal)),\n        Math.round(alphaTotal / count)\n    ] : options.defaultColor;\n}\n\nfunction getDefaultColor(options) {\n    return getOption(options, 'defaultColor', [0, 0, 0, 0]);\n}\nfunction getOption(options, name, defaultValue) {\n    return (options[name] === undefined ? defaultValue : options[name]);\n}\n\nvar MIN_SIZE = 10;\nvar MAX_SIZE = 100;\nfunction isSvg(filename) {\n    return filename.search(/\\.svg(\\?|$)/i) !== -1;\n}\nfunction getOriginalSize(resource) {\n    if (isInstanceOfHTMLImageElement(resource)) {\n        var width = resource.naturalWidth;\n        var height = resource.naturalHeight;\n        // For SVG images with only viewBox attribute\n        if (!resource.naturalWidth && isSvg(resource.src)) {\n            width = height = MAX_SIZE;\n        }\n        return {\n            width: width,\n            height: height,\n        };\n    }\n    if (isInstanceOfHTMLVideoElement(resource)) {\n        return {\n            width: resource.videoWidth,\n            height: resource.videoHeight\n        };\n    }\n    return {\n        width: resource.width,\n        height: resource.height\n    };\n}\nfunction getSrc(resource) {\n    if (isInstanceOfHTMLCanvasElement(resource)) {\n        return 'canvas';\n    }\n    if (isInstanceOfOffscreenCanvas(resource)) {\n        return 'offscreencanvas';\n    }\n    if (isInstanceOfImageBitmap(resource)) {\n        return 'imagebitmap';\n    }\n    return resource.src;\n}\nfunction isInstanceOfHTMLImageElement(resource) {\n    return typeof HTMLImageElement !== 'undefined' && resource instanceof HTMLImageElement;\n}\nvar hasOffscreenCanvas = typeof OffscreenCanvas !== 'undefined';\nfunction isInstanceOfOffscreenCanvas(resource) {\n    return hasOffscreenCanvas && resource instanceof OffscreenCanvas;\n}\nfunction isInstanceOfHTMLVideoElement(resource) {\n    return typeof HTMLVideoElement !== 'undefined' && resource instanceof HTMLVideoElement;\n}\nfunction isInstanceOfHTMLCanvasElement(resource) {\n    return typeof HTMLCanvasElement !== 'undefined' && resource instanceof HTMLCanvasElement;\n}\nfunction isInstanceOfImageBitmap(resource) {\n    return typeof ImageBitmap !== 'undefined' && resource instanceof ImageBitmap;\n}\nfunction prepareSizeAndPosition(originalSize, options) {\n    var srcLeft = getOption(options, 'left', 0);\n    var srcTop = getOption(options, 'top', 0);\n    var srcWidth = getOption(options, 'width', originalSize.width);\n    var srcHeight = getOption(options, 'height', originalSize.height);\n    var destWidth = srcWidth;\n    var destHeight = srcHeight;\n    if (options.mode === 'precision') {\n        return {\n            srcLeft: srcLeft,\n            srcTop: srcTop,\n            srcWidth: srcWidth,\n            srcHeight: srcHeight,\n            destWidth: destWidth,\n            destHeight: destHeight\n        };\n    }\n    var factor;\n    if (srcWidth > srcHeight) {\n        factor = srcWidth / srcHeight;\n        destWidth = MAX_SIZE;\n        destHeight = Math.round(destWidth / factor);\n    }\n    else {\n        factor = srcHeight / srcWidth;\n        destHeight = MAX_SIZE;\n        destWidth = Math.round(destHeight / factor);\n    }\n    if (destWidth > srcWidth || destHeight > srcHeight ||\n        destWidth < MIN_SIZE || destHeight < MIN_SIZE) {\n        destWidth = srcWidth;\n        destHeight = srcHeight;\n    }\n    return {\n        srcLeft: srcLeft,\n        srcTop: srcTop,\n        srcWidth: srcWidth,\n        srcHeight: srcHeight,\n        destWidth: destWidth,\n        destHeight: destHeight\n    };\n}\nvar isWebWorkers = typeof window === 'undefined';\nfunction makeCanvas() {\n    if (isWebWorkers) {\n        return hasOffscreenCanvas ? new OffscreenCanvas(1, 1) : null;\n    }\n    return document.createElement('canvas');\n}\n\nvar ERROR_PREFIX = 'FastAverageColor: ';\nfunction getError(message) {\n    return Error(ERROR_PREFIX + message);\n}\nfunction outputError(error, silent) {\n    if (!silent) {\n        console.error(error);\n    }\n}\n\nvar FastAverageColor = /** @class */ (function () {\n    function FastAverageColor() {\n        this.canvas = null;\n        this.ctx = null;\n    }\n    FastAverageColor.prototype.getColorAsync = function (resource, options) {\n        if (!resource) {\n            return Promise.reject(getError('call .getColorAsync() without resource'));\n        }\n        if (typeof resource === 'string') {\n            // Web workers\n            if (typeof Image === 'undefined') {\n                return Promise.reject(getError('resource as string is not supported in this environment'));\n            }\n            var img = new Image();\n            img.crossOrigin = options && options.crossOrigin || '';\n            img.src = resource;\n            return this.bindImageEvents(img, options);\n        }\n        else if (isInstanceOfHTMLImageElement(resource) && !resource.complete) {\n            return this.bindImageEvents(resource, options);\n        }\n        else {\n            var result = this.getColor(resource, options);\n            return result.error ? Promise.reject(result.error) : Promise.resolve(result);\n        }\n    };\n    /**\n     * Get the average color from images, videos and canvas.\n     */\n    FastAverageColor.prototype.getColor = function (resource, options) {\n        options = options || {};\n        var defaultColor = getDefaultColor(options);\n        if (!resource) {\n            var error = getError('call .getColor() without resource');\n            outputError(error, options.silent);\n            return this.prepareResult(defaultColor, error);\n        }\n        var originalSize = getOriginalSize(resource);\n        var size = prepareSizeAndPosition(originalSize, options);\n        if (!size.srcWidth || !size.srcHeight || !size.destWidth || !size.destHeight) {\n            var error = getError(\"incorrect sizes for resource \\\"\".concat(getSrc(resource), \"\\\"\"));\n            outputError(error, options.silent);\n            return this.prepareResult(defaultColor, error);\n        }\n        if (!this.canvas) {\n            this.canvas = makeCanvas();\n            if (!this.canvas) {\n                var error = getError('OffscreenCanvas is not supported in this browser');\n                outputError(error, options.silent);\n                return this.prepareResult(defaultColor, error);\n            }\n        }\n        if (!this.ctx) {\n            this.ctx = this.canvas.getContext('2d', { willReadFrequently: true });\n            if (!this.ctx) {\n                var error = getError('Canvas Context 2D is not supported in this browser');\n                outputError(error, options.silent);\n                return this.prepareResult(defaultColor);\n            }\n            this.ctx.imageSmoothingEnabled = false;\n        }\n        this.canvas.width = size.destWidth;\n        this.canvas.height = size.destHeight;\n        try {\n            this.ctx.clearRect(0, 0, size.destWidth, size.destHeight);\n            this.ctx.drawImage(resource, size.srcLeft, size.srcTop, size.srcWidth, size.srcHeight, 0, 0, size.destWidth, size.destHeight);\n            var bitmapData = this.ctx.getImageData(0, 0, size.destWidth, size.destHeight).data;\n            return this.prepareResult(this.getColorFromArray4(bitmapData, options));\n        }\n        catch (originalError) {\n            var error = getError(\"security error (CORS) for resource \".concat(getSrc(resource), \".\\nDetails: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image\"));\n            outputError(error, options.silent);\n            !options.silent && console.error(originalError);\n            return this.prepareResult(defaultColor, error);\n        }\n    };\n    /**\n     * Get the average color from a array when 1 pixel is 4 bytes.\n     */\n    FastAverageColor.prototype.getColorFromArray4 = function (arr, options) {\n        options = options || {};\n        var bytesPerPixel = 4;\n        var arrLength = arr.length;\n        var defaultColor = getDefaultColor(options);\n        if (arrLength < bytesPerPixel) {\n            return defaultColor;\n        }\n        var len = arrLength - arrLength % bytesPerPixel;\n        var step = (options.step || 1) * bytesPerPixel;\n        var algorithm;\n        switch (options.algorithm || 'sqrt') {\n            case 'simple':\n                algorithm = simpleAlgorithm;\n                break;\n            case 'sqrt':\n                algorithm = sqrtAlgorithm;\n                break;\n            case 'dominant':\n                algorithm = dominantAlgorithm;\n                break;\n            default:\n                throw getError(\"\".concat(options.algorithm, \" is unknown algorithm\"));\n        }\n        return algorithm(arr, len, {\n            defaultColor: defaultColor,\n            ignoredColor: prepareIgnoredColor(options.ignoredColor),\n            step: step,\n            dominantDivider: options.dominantDivider,\n        });\n    };\n    /**\n     * Get color data from value ([r, g, b, a]).\n     */\n    FastAverageColor.prototype.prepareResult = function (value, error) {\n        var rgb = value.slice(0, 3);\n        var rgba = [value[0], value[1], value[2], value[3] / 255];\n        var isDarkColor = isDark(value);\n        return {\n            value: [value[0], value[1], value[2], value[3]],\n            rgb: 'rgb(' + rgb.join(',') + ')',\n            rgba: 'rgba(' + rgba.join(',') + ')',\n            hex: arrayToHex(rgb),\n            hexa: arrayToHex(value),\n            isDark: isDarkColor,\n            isLight: !isDarkColor,\n            error: error,\n        };\n    };\n    /**\n     * Destroy the instance.\n     */\n    FastAverageColor.prototype.destroy = function () {\n        if (this.canvas) {\n            this.canvas.width = 1;\n            this.canvas.height = 1;\n            this.canvas = null;\n        }\n        this.ctx = null;\n    };\n    FastAverageColor.prototype.bindImageEvents = function (resource, options) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            var onload = function () {\n                unbindEvents();\n                var result = _this.getColor(resource, options);\n                if (result.error) {\n                    reject(result.error);\n                }\n                else {\n                    resolve(result);\n                }\n            };\n            var onerror = function () {\n                unbindEvents();\n                reject(getError(\"Error loading image \\\"\".concat(resource.src, \"\\\"\")));\n            };\n            var onabort = function () {\n                unbindEvents();\n                reject(getError(\"Image \\\"\".concat(resource.src, \"\\\" loading aborted\")));\n            };\n            var unbindEvents = function () {\n                resource.removeEventListener('load', onload);\n                resource.removeEventListener('error', onerror);\n                resource.removeEventListener('abort', onabort);\n            };\n            resource.addEventListener('load', onload);\n            resource.addEventListener('error', onerror);\n            resource.addEventListener('abort', onabort);\n        });\n    };\n    return FastAverageColor;\n}());\n\nexport { FastAverageColor };\n","/**\n * WordPress dependencies\n */\nimport { applyFilters } from '@wordpress/hooks';\n\n/**\n * External dependencies\n */\nimport { colord } from 'colord';\nimport { FastAverageColor } from 'fast-average-color';\n\nasync function imgFromBlob( blob, width = 1024, height = 1024 ) {\n\tconst img = document.createElement( 'img' );\n\timg.width = width / 2;\n\timg.height = height / 2;\n\n\tconst src = window.URL.createObjectURL( blob );\n\tconst loaded = new Promise( ( resolve ) => {\n\t\tconst onload = () => {\n\t\t\twindow.URL.revokeObjectURL( src );\n\t\t\timg.removeEventListener( 'load', onload );\n\t\t\tresolve();\n\t\t};\n\t\timg.addEventListener( 'load', onload );\n\t} );\n\timg.src = src;\n\tawait loaded;\n\n\treturn img;\n}\n\nfunction getCanvasElement( width = 1024, height = 1024 ) {\n\tconst canvas = document.createElement( 'canvas' );\n\tcanvas.width = width;\n\tcanvas.height = height;\n\n\treturn canvas;\n}\n\nexport function blobFromBase64( base64Data, mimeType ) {\n\tconst binaryData = atob( base64Data );\n\tconst byteArray = new Uint8Array( binaryData.length );\n\tfor ( let i = 0; i < binaryData.length; i++ ) {\n\t\tbyteArray[ i ] = binaryData.charCodeAt( i );\n\t}\n\n\treturn new Blob( [ byteArray ], { type: mimeType } );\n}\n\nexport async function transparentFromGrayscale( blob, contrastFactor = 1.5 ) {\n\tconst img = await imgFromBlob( blob );\n\tconst canvas = getCanvasElement();\n\n\tconst ctx = canvas.getContext( '2d' );\n\tctx.drawImage( img, 0, 0, canvas.width, canvas.height );\n\n\tconst imageData = ctx.getImageData( 0, 0, canvas.width, canvas.height );\n\tconst { data } = imageData;\n\n\tfor ( let i = 0; i < data.length; i += 4 ) {\n\t\tconst grayscaleRaw = data[ i ]; // R = G = B in grayscale\n\t\t// Make whites whiter and blacks blacker. Avoids pale-but-not-quite-white pixels that look weird when we\n\t\t// convert white to alpha.\n\t\tconst grayscaleValue =\n\t\t\twindow.Math.round( ( grayscaleRaw - 128 ) * contrastFactor ) + 128;\n\t\tconst grayscaleClamped = window.Math.max(\n\t\t\twindow.Math.min( grayscaleValue, 255 ),\n\t\t\t0\n\t\t);\n\t\tdata[ i + 3 ] = 255 - grayscaleClamped; // Set alpha to grayscale value (0 = transparent, 255 = opaque)\n\t\t// Make RGB black\n\t\tdata[ i ] = 0;\n\t\tdata[ i + 1 ] = 0;\n\t\tdata[ i + 2 ] = 0;\n\t}\n\n\tctx.putImageData( imageData, 0, 0 );\n\n\treturn await new Promise( ( resolve ) => canvas.toBlob( resolve ) );\n}\n\nexport async function cropTransparentBlob( blob ) {\n\tconst img = await imgFromBlob( blob );\n\tconst canvas = getCanvasElement();\n\n\tconst ctx = canvas.getContext( '2d' );\n\tctx.drawImage( img, 0, 0, canvas.width, canvas.height );\n\n\tconst imageData = ctx.getImageData( 0, 0, canvas.width, canvas.height );\n\tconst { data } = imageData;\n\n\tlet firstX = Infinity;\n\tlet lastX = -Infinity;\n\tlet firstY = Infinity;\n\tlet lastY = -Infinity;\n\tfor ( let x = 0; x < canvas.width; x++ ) {\n\t\tfor ( let y = 0; y < canvas.height; y++ ) {\n\t\t\tconst offset = y * canvas.width + x;\n\t\t\tconst alpha = data[ offset * 4 + 3 ];\n\t\t\tif ( ! alpha ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( x < firstX ) {\n\t\t\t\tfirstX = x;\n\t\t\t}\n\t\t\tif ( x > lastX ) {\n\t\t\t\tlastX = x;\n\t\t\t}\n\t\t\tif ( y < firstY ) {\n\t\t\t\tfirstY = y;\n\t\t\t}\n\t\t\tif ( y > lastY ) {\n\t\t\t\tlastY = y;\n\t\t\t}\n\t\t}\n\t}\n\n\tlet width = 1 + lastX - firstX;\n\tlet height = 1 + lastY - firstY;\n\n\t// Keep it square.\n\tif ( width < height ) {\n\t\tconst delta = ( height - width ) / 2;\n\t\twidth = height;\n\t\tfirstX -= Math.floor( delta );\n\t} else if ( height < width ) {\n\t\tconst delta = ( width - height ) / 2;\n\t\theight = width;\n\t\tfirstY -= Math.floor( delta );\n\t}\n\n\t// Setting the canvas's width/height resets the canvas (even if the width/height have not changed),\n\t// which is what we want. We want to clear the canvas and draw our new, cropped image.\n\tcanvas.setAttribute( 'width', width );\n\tcanvas.setAttribute( 'height', height );\n\n\tctx.putImageData(\n\t\timageData,\n\t\t-firstX, // `.putImageData()`'s parameters are weird. This is correct.\n\t\t-firstY, // ^^^\n\t\tfirstX,\n\t\tfirstY,\n\t\twidth,\n\t\theight\n\t);\n\n\treturn await new Promise( ( resolve ) => canvas.toBlob( resolve ) );\n}\n\nexport async function colorize( blob, color ) {\n\tconst img = await imgFromBlob( blob );\n\tconst canvas = getCanvasElement();\n\n\tconst ctx = canvas.getContext( '2d' );\n\tctx.fillStyle = color;\n\tctx.fillRect( 0, 0, canvas.width, canvas.height );\n\n\tctx.globalCompositeOperation = 'destination-atop';\n\tctx.drawImage( img, 0, 0, canvas.width, canvas.height );\n\n\treturn await new Promise( ( resolve ) => canvas.toBlob( resolve ) );\n}\n\nexport function setCustomLogoCss( customCss, setCustomCss, siteLogoUrl ) {\n\tconst siteLogoPath = new window.URL( siteLogoUrl ).pathname;\n\n\t// Ensure we have the correct CSS Masking rules in our site's Custom CSS.\n\t// NOTE: Has to use sub-properties for mask to avoid being filtered out.\n\t// NOTE: Whitespace and quoting is importent. Matches the value as normalized by WP.com.\n\tconst logoCSS = `/* START Big Sky */\n.wp-block-site-logo .custom-logo[src*=\"${ siteLogoPath }\"] {\n\tbackground-color: currentcolor;\n\t-webkit-mask-image: url('${ siteLogoUrl }');\n\t-webkit-mask-position: center center;\n\t-webkit-mask-size: cover;\n\t-webkit-mask-repeat: no-repeat;\n\tmask-image: url('${ siteLogoUrl }');\n\tmask-position: center center;\n\tmask-size: cover;\n\tmask-repeat: no-repeat;\n\tobject-position: -1024px -1024px;\n}\n\n/* END Big Sky */`;\n\n\tif ( customCss.includes( logoCSS ) ) {\n\t\treturn;\n\t}\n\n\t// Replace any existing Big Sky rules with the fresh ones.\n\tconst newCss = customCss\n\t\t.replace( /\\/\\* START Big Sky \\*\\/.*\\/\\* END Big Sky \\*\\//s, '' )\n\t\t.trim();\n\n\tsetCustomCss( newCss + `\\n\\n${ logoCSS }` );\n}\n\nexport function removeCustomLogoCss( customCss, setCustomCss ) {\n\tif ( ! customCss.includes( '/* START Big Sky */' ) ) {\n\t\treturn;\n\t}\n\n\t// Remove Big Sky rules.\n\tconst newCss = customCss\n\t\t.replace( /\\/\\* START Big Sky \\*\\/.*\\/\\* END Big Sky \\*\\//s, '' )\n\t\t.trim();\n\n\tsetCustomCss( newCss );\n}\n\n/**\n * Retrieves the FastAverageColor singleton.\n *\n * @return {FastAverageColor} The FastAverageColor singleton.\n */\nexport function retrieveFastAverageColor() {\n\tif ( ! retrieveFastAverageColor.fastAverageColor ) {\n\t\tretrieveFastAverageColor.fastAverageColor = new FastAverageColor();\n\t}\n\treturn retrieveFastAverageColor.fastAverageColor;\n}\n\n/**\n * Computes the average color of an image.\n *\n * @param {string} url The url of the image.\n *\n * @return {Promise<string>} Promise of an average color as a hex string.\n */\nconst DEFAULT_BACKGROUND_COLOR = '#ffffff';\nexport const getMediaColor = async ( url ) => {\n\tif ( ! url ) {\n\t\treturn DEFAULT_BACKGROUND_COLOR;\n\t}\n\n\t// making the default color rgb for compat with FAC\n\tconst { r, g, b, a } = colord( DEFAULT_BACKGROUND_COLOR ).toRgb();\n\n\ttry {\n\t\tconst imgCrossOrigin = applyFilters(\n\t\t\t'media.crossOrigin',\n\t\t\tundefined,\n\t\t\turl\n\t\t);\n\t\tconst color = await retrieveFastAverageColor().getColorAsync( url, {\n\t\t\t// The default color is white, which is the color\n\t\t\t// that is returned if there's an error.\n\t\t\t// colord returns alpga 0-1, FAC needs 0-255\n\t\t\tdefaultColor: [ r, g, b, a * 255 ],\n\t\t\t// Errors that come up don't reject the promise,\n\t\t\t// so error logging has to be silenced\n\t\t\t// with this option.\n\t\t\tsilent: process.env.NODE_ENV === 'production',\n\t\t\tcrossOrigin: imgCrossOrigin,\n\t\t} );\n\t\treturn color.hex;\n\t} catch ( error ) {\n\t\t// If there's an error return the fallback color.\n\t\treturn DEFAULT_BACKGROUND_COLOR;\n\t}\n};\n\nexport const ALLOWED_IMAGE_FILE_TYPES = [ 'jpeg', 'jpg', 'png', 'gif', 'svg' ];\nexport const isAllowedImageFile = ( fileName ) => {\n\tconst regex = new RegExp(\n\t\t`\\\\.(${ ALLOWED_IMAGE_FILE_TYPES.join( '|' ) })$`,\n\t\t'i'\n\t);\n\treturn regex.test( fileName );\n};\n","/**\n * WordPress dependencies\n */\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { dispatch, useDispatch, useRegistry, useSelect } from '@wordpress/data';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { uploadMedia } from '@wordpress/media-utils';\n\n/**\n * Internal dependencies\n */\nimport useBlocks from '@hooks/use-blocks';\nimport useStyles from '@hooks/use-styles';\nimport { store as aiStore } from '@store';\nimport { requestJetpackToken } from '@utils/request-jetpack-token.ts';\nimport log from '@utils/log-debug';\nimport { getCanvasIframeElements } from '@utils/canvas-iframe-elements';\nimport {\n\tblobFromBase64,\n\tcropTransparentBlob,\n\tsetCustomLogoCss,\n\ttransparentFromGrayscale,\n} from '@utils/images';\n\nexport default function useImages() {\n\tconst { getImageStyle } = useSelect( ( select ) => {\n\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\t\treturn {\n\t\t\tgetBlock: select( blockEditorStore ).getBlock,\n\t\t\tgetBlocksByName: select( blockEditorStore ).getBlocksByName,\n\t\t\tselectedBlock: getSelectedBlock(),\n\t\t\tisEditorIframeLoaded: select( aiStore ).getIsEditorIframeLoaded(),\n\t\t\tisHandoff: select( aiStore ).getIsHandoff(),\n\t\t\tgetImageStyle: select( aiStore ).getImageStyle,\n\t\t};\n\t} );\n\n\tconst registry = useRegistry();\n\tconst { editEntityRecord } = useDispatch( coreStore );\n\tconst { updateBlockAttributes } = useDispatch( blockEditorStore );\n\tconst { setBlockIsProcessing } = useBlocks();\n\tconst { generateImage, addCachedImage } = useDispatch( aiStore );\n\tconst { getSurroundingContentOfBlock } = useBlocks();\n\tconst { getThemeColors } = useStyles();\n\n\tconst { useCustomCss } = useStyles();\n\tconst [ customCss, setCustomCss ] = useCustomCss();\n\n\tconst setImages = () => {};\n\n\t/**\n\t * Sets images in blocks.\n\t * @param {Array}   blocks\n\t * @param {string}  topic\n\t * @param {boolean} isConceptSection\n\t * @param {Object}  blocksToUpdate\n\t * @param {boolean} newPage          // If true, we don't generate cover images.\n\t * @return {Promise<void>}\n\t */\n\tconst setImagesInBlocks = async (\n\t\tblocks,\n\t\ttopic,\n\t\tisConceptSection = true,\n\t\tblocksToUpdate = {},\n\t\tnewPage = false\n\t) => {\n\t\t// So the user can undo the image replacements in one step we need to get\n\t\t// all the async image urls first and then replace them using a batch update.\n\t\tconst newImages = [];\n\t\tlet imageIndex = 0;\n\t\tconst getNewImages = async ( blocksArray ) => {\n\t\t\tfor ( const block of blocksArray ) {\n\t\t\t\tif ( canGenerateImage( block ) ) {\n\t\t\t\t\tif ( block.name === 'core/cover' && ! newPage ) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst coverImageUrl = generateCoverImageWithAI( {\n\t\t\t\t\t\t\t\tblock,\n\t\t\t\t\t\t\t\ttopic,\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\tnewImages.push( coverImageUrl );\n\t\t\t\t\t\t} catch ( error ) {\n\t\t\t\t\t\t\tlog.error(\n\t\t\t\t\t\t\t\t'Error generating cover image: ',\n\t\t\t\t\t\t\t\terror\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tnewImages.push( getStockImageURL( topic ) );\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewImages.push( getStockImageURL( topic ) );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( block.innerBlocks?.length > 0 ) {\n\t\t\t\t\tgetNewImages( block.innerBlocks );\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst applyNewImages = ( blocksArray, images ) => {\n\t\t\tfor ( const block of blocksArray ) {\n\t\t\t\tif ( canGenerateImage( block ) ) {\n\t\t\t\t\tconst attrToUpdate = buildAttrToUpdateImage(\n\t\t\t\t\t\tblock,\n\t\t\t\t\t\timages[ imageIndex ],\n\t\t\t\t\t\ttopic\n\t\t\t\t\t);\n\t\t\t\t\timageIndex++;\n\t\t\t\t\tif ( isConceptSection ) {\n\t\t\t\t\t\t// We must manually set block attributes here that are and are not on the canvas.\n\t\t\t\t\t\tblock.attributes = {\n\t\t\t\t\t\t\t...block.attributes,\n\t\t\t\t\t\t\t...attrToUpdate,\n\t\t\t\t\t\t};\n\t\t\t\t\t\t// Don't update the blocks on the canvas yet, just store the updates.\n\t\t\t\t\t\tblocksToUpdate[ block.clientId ] = attrToUpdate;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tupdateBlockAttributes( block.clientId, attrToUpdate );\n\t\t\t\t\t\tsetBlockIsProcessing( block, false );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( block.innerBlocks?.length > 0 ) {\n\t\t\t\t\tapplyNewImages( block.innerBlocks, images, imageIndex );\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tgetNewImages( blocks );\n\t\tconst resolvedImages = await Promise.all( newImages );\n\n\t\tregistry.batch( () => {\n\t\t\tapplyNewImages( blocks, resolvedImages );\n\t\t} );\n\n\t\tif ( isConceptSection ) {\n\t\t\t// This is the initial concept so fetch some extra images to cache to make rotation of site designs more interesting.\n\t\t\tfor ( let i = 0; i < 2; i++ ) {\n\t\t\t\tgetStockImageURL( topic );\n\t\t\t}\n\t\t}\n\t};\n\n\tconst updateImagesInBlocks = async ( blocks, updates ) => {\n\t\tfor ( const block of blocks ) {\n\t\t\tif ( canGenerateImage( block ) ) {\n\t\t\t\tconst clientId = block.clientId;\n\t\t\t\tupdateBlockAttributes( clientId, updates[ clientId ] );\n\t\t\t\tsetBlockIsProcessing( block, false );\n\t\t\t}\n\n\t\t\tif ( block.innerBlocks?.length > 0 ) {\n\t\t\t\tawait updateImagesInBlocks( block.innerBlocks, updates );\n\t\t\t}\n\t\t}\n\t};\n\n\tconst getStockImageURL = async ( topic, numImages = 100 ) => {\n\t\tconst image = await dispatch( aiStore ).nextStockPhoto(\n\t\t\ttopic,\n\t\t\tnumImages\n\t\t);\n\t\tif ( image?.URL ) {\n\t\t\taddCachedImage( image?.URL );\n\t\t}\n\t\treturn image?.URL;\n\t};\n\n\t/**\n\t * Generates a new image with dall-e 3.\n\t * @param {string} topic\n\t */\n\tconst generateLogoWithAI = async ( { block, description } ) => {\n\t\tconst inputPrompt = `You are an expert at creating line drawing logos for business websites.\n\n\t\tAll of the logos you create follow these rules:\n\n\t\t- The logo must show a single person, place, or object that represents the following description: ${\n\t\t\tdescription.description ?? description\n\t\t}\n\t\t- The logo must always be a simple, black vector line drawing. Never use color.\n\t\t- The logo should NEVER contain text, words, letters, or numbers.`;\n\n\t\t// Use square size for logo\n\t\tconst size = { width: 1024, height: 1024 };\n\n\t\tconst response = await generateImage( {\n\t\t\tprompt: inputPrompt,\n\t\t\tsize: `${ size.width }x${ size.height }`,\n\t\t\tresponse_format: 'b64_json',\n\t\t\timage_format: 'PNG',\n\t\t} );\n\n\t\tconst base64Image = response?.data?.[ 0 ]?.b64_json;\n\t\tif ( base64Image ) {\n\t\t\ttry {\n\t\t\t\tconst grayscalePngBlob = blobFromBase64(\n\t\t\t\t\tbase64Image,\n\t\t\t\t\t'image/png'\n\t\t\t\t);\n\t\t\t\tconst transparentPngBlob =\n\t\t\t\t\tawait transparentFromGrayscale( grayscalePngBlob );\n\t\t\t\tconst croppedPngBlob =\n\t\t\t\t\tawait cropTransparentBlob( transparentPngBlob );\n\n\t\t\t\t// upload to media library\n\t\t\t\tawait uploadMedia( {\n\t\t\t\t\tfilesList: [\n\t\t\t\t\t\tnew File( [ croppedPngBlob ], 'site_logo.png', {\n\t\t\t\t\t\t\ttype: 'image/png',\n\t\t\t\t\t\t} ),\n\t\t\t\t\t],\n\t\t\t\t\t// The image is marked as generated by Big Sky by setting `big_sky_generated_logo` to `-1`\n\t\t\t\t\t// for future compatibily. This lets us set the meta value of any child images to the post\n\t\t\t\t\t// ID of their parent (a positive integer).\n\t\t\t\t\tadditionalData: { 'meta[big_sky_generated_logo]': -1 },\n\t\t\t\t\t// maxUploadFileSize,\n\t\t\t\t\tonError: ( { message } ) => log.error( message ),\n\t\t\t\t\tonFileChange: ( [ fileObj ] ) => {\n\t\t\t\t\t\tif ( fileObj?.id ) {\n\t\t\t\t\t\t\t// Batching these state changes doesn't affect the undo stack, but may\n\t\t\t\t\t\t\t// potentially prevent future async wonkiness.\n\t\t\t\t\t\t\tregistry.batch( () => {\n\t\t\t\t\t\t\t\t// Set custom CSS first...\n\t\t\t\t\t\t\t\tsetCustomLogoCss(\n\t\t\t\t\t\t\t\t\tcustomCss,\n\t\t\t\t\t\t\t\t\tsetCustomCss,\n\t\t\t\t\t\t\t\t\tfileObj.url\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t// ...and logo image second so that a single undo will undo the image change.\n\t\t\t\t\t\t\t\t// `useColorizedLogo()` will pick up on that change and recalculate the required\n\t\t\t\t\t\t\t\t// custom CSS.\n\t\t\t\t\t\t\t\teditEntityRecord( 'root', 'site', undefined, {\n\t\t\t\t\t\t\t\t\tsite_logo: fileObj.id,\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\tconst { canvasiFrameRoot } =\n\t\t\t\t\t\t\t\tgetCanvasIframeElements();\n\t\t\t\t\t\t\tcanvasiFrameRoot?.style?.setProperty(\n\t\t\t\t\t\t\t\t'--site-logo-url',\n\t\t\t\t\t\t\t\t`url(${ fileObj.url })`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif ( block ) setBlockIsProcessing( block, false );\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t} );\n\n\t\t\t\treturn sprintf(\n\t\t\t\t\t// Translators: Placeholder represents the description of the image requested by the user.\n\t\t\t\t\t__( 'I have generated a new logo of: %s', 'big-sky' ),\n\t\t\t\t\tdescription\n\t\t\t\t);\n\t\t\t} catch ( error ) {\n\t\t\t\tlog.error( 'Error:', error );\n\t\t\t\treturn __(\n\t\t\t\t\t'I encountered an error while processing your request. Please try again.',\n\t\t\t\t\t'big-sky'\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst generateCoverImageWithAI = async ( { block, topic } ) => {\n\t\tconst themeColors = getThemeColors();\n\t\tconst colorHexes = themeColors.map( ( color ) => color.color );\n\t\tconst inputPrompt = `Create a minimalistic background image to fit a versatile ${ topic } theme, and match the following color palette: ${ colorHexes.join(\n\t\t\t', '\n\t\t) }.\n\t\tThe center of the image should be mostly empty for content placement, while the edges feature abstract, subtle design elements that evoke a sense of simplicity.\n\t\tAvoid using specific objects or textures to ensure the theme can be interpreted broadly. The image should be without any text or prominent focal points.`;\n\n\t\tconst coverImageUrl = generateImageWithAI( {\n\t\t\tblock,\n\t\t\tdescription: topic,\n\t\t\tcustomPrompt: inputPrompt,\n\t\t\tstyle: getImageStyle() || 'photographic',\n\t\t\tsize: 'landscape',\n\t\t} );\n\t\treturn coverImageUrl;\n\t};\n\n\t/**\n\t * Generates a new image with AI\n\t * @param {string} input             The prompt to generate the image.\n\t * @param {string} input.description\n\t */\n\tconst generateImageWithAI = async ( {\n\t\tblock,\n\t\tdescription,\n\t\tstyle,\n\t\tsize = false,\n\t\tcustomPrompt = false,\n\t\tretry = false,\n\t} ) => {\n\t\tif ( ! block || ! canGenerateImage( block ) ) {\n\t\t\treturn __(\n\t\t\t\t'I cannot generate an image for the currently selected block.',\n\t\t\t\t'big-sky'\n\t\t\t);\n\t\t}\n\t\tconst jetpackToken = await requestJetpackToken( ! retry );\n\t\tif ( ! jetpackToken ) {\n\t\t\treturn __( 'I am unable to perform your request.', 'big-sky' );\n\t\t}\n\n\t\tconst surroundingContentOfBlock = block?.clientId\n\t\t\t? getSurroundingContentOfBlock( block )\n\t\t\t: '';\n\t\tlet inputPrompt;\n\t\tif ( customPrompt ) {\n\t\t\tinputPrompt = customPrompt;\n\t\t} else {\n\t\t\tinputPrompt = `Please create an image based on this content: ${\n\t\t\t\tdescription ? description : surroundingContentOfBlock\n\t\t\t}.`;\n\t\t\tinputPrompt += ' The image should not contain any text.';\n\t\t}\n\n\t\tconst aspectRatio = block.attributes.aspectRatio;\n\t\tlet widthRatio, heightRatio, selectedSize;\n\n\t\t// Predefined sizes by our API. We need to pick the closest one to the calculated aspect ratio.\n\t\tconst sizes = {\n\t\t\tsquare: { width: 1024, height: 1024 },\n\t\t\tportrait: { width: 768, height: 1024 },\n\t\t\tlandscape: { width: 1024, height: 768 },\n\t\t};\n\n\t\tif ( size ) {\n\t\t\tselectedSize = sizes[ size ];\n\t\t} else if ( aspectRatio === '1' || ! aspectRatio ) {\n\t\t\tselectedSize = sizes.square;\n\t\t} else {\n\t\t\t[ widthRatio, heightRatio ] = aspectRatio\n\t\t\t\t.split( '/' )\n\t\t\t\t.map( Number );\n\n\t\t\tconst calculatedAspectRatio = widthRatio / heightRatio;\n\t\t\tif ( calculatedAspectRatio > 1 ) {\n\t\t\t\tselectedSize = sizes.landscape;\n\t\t\t} else {\n\t\t\t\tselectedSize = sizes.portrait;\n\t\t\t}\n\t\t}\n\t\tconst endpointArgs = {\n\t\t\tprompt: inputPrompt,\n\t\t\tstyle,\n\t\t\tmodel: 'flux',\n\t\t\ttoken: jetpackToken.token,\n\t\t};\n\n\t\tlet isError = false;\n\t\tlet response;\n\t\ttry {\n\t\t\tresponse = await fetch(\n\t\t\t\t`https://public-api.wordpress.com/wpcom/v2/sites/${ jetpackToken.blogId }/ai-image`,\n\t\t\t\t{\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t},\n\t\t\t\t\tbody: JSON.stringify( {\n\t\t\t\t\t\t...endpointArgs,\n\t\t\t\t\t\t...selectedSize,\n\t\t\t\t\t} ),\n\t\t\t\t}\n\t\t\t);\n\t\t\tif ( response.status >= 300 ) {\n\t\t\t\t// retry once with a new token\n\t\t\t\tif ( ! retry ) {\n\t\t\t\t\treturn generateImageWithAI( {\n\t\t\t\t\t\tblock,\n\t\t\t\t\t\tdescription,\n\t\t\t\t\t\tstyle,\n\t\t\t\t\t\tsize,\n\t\t\t\t\t\tcustomPrompt,\n\t\t\t\t\t\tretry: true,\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\tlog.error( 'Error calling Image Generation API: ', response );\n\t\t\t\tisError = true;\n\t\t\t}\n\t\t} catch ( error ) {\n\t\t\t// retry once with a new token\n\t\t\tif ( ! retry ) {\n\t\t\t\treturn generateImageWithAI( {\n\t\t\t\t\tblock,\n\t\t\t\t\tdescription,\n\t\t\t\t\tstyle,\n\t\t\t\t\tsize,\n\t\t\t\t\tcustomPrompt,\n\t\t\t\t\tretry: true,\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tlog.error( error );\n\t\t\tisError = true;\n\t\t}\n\t\tif ( isError ) {\n\t\t\tsetBlockIsProcessing( block, false );\n\n\t\t\treturn __(\n\t\t\t\t'I encountered an error while processing your request. Please try again.',\n\t\t\t\t'big-sky'\n\t\t\t);\n\t\t}\n\t\tconst blob = await response.blob();\n\n\t\tlet uploadedImageUrl = null;\n\n\t\tawait uploadMedia( {\n\t\t\tfilesList: [\n\t\t\t\tnew File( [ blob ], `${ description || 'untitled' }.png`, {\n\t\t\t\t\ttype: 'image/png',\n\t\t\t\t} ),\n\t\t\t],\n\t\t\t// maxUploadFileSize,\n\t\t\tonError: ( { message } ) => log.error( message ),\n\t\t\tonFileChange: ( [ fileObj ] ) => {\n\t\t\t\tif ( fileObj.id ) {\n\t\t\t\t\t// eslint-disable-next-line no-undef\n\t\t\t\t\tconst img = new Image();\n\t\t\t\t\timg.src = fileObj.url;\n\t\t\t\t\timg.addEventListener( 'load', () => {\n\t\t\t\t\t\tconst attrToUpdate = buildAttrToUpdateImage(\n\t\t\t\t\t\t\tblock,\n\t\t\t\t\t\t\tfileObj.url,\n\t\t\t\t\t\t\tdescription\n\t\t\t\t\t\t);\n\t\t\t\t\t\tupdateBlockAttributes( block.clientId, attrToUpdate );\n\n\t\t\t\t\t\tsetBlockIsProcessing( block, false );\n\t\t\t\t\t\tuploadedImageUrl = fileObj.url;\n\t\t\t\t\t} );\n\t\t\t\t\timg.addEventListener( 'error', () => {\n\t\t\t\t\t\tsetBlockIsProcessing( block, false );\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t},\n\t\t} );\n\n\t\t// Wait for the image to be uploaded and processed\n\t\twhile ( ! uploadedImageUrl ) {\n\t\t\tawait new Promise( ( resolve ) => setTimeout( resolve, 100 ) );\n\t\t}\n\n\t\treturn uploadedImageUrl;\n\t};\n\n\t/**\n\t * Checks if the block can have an image generated for it.\n\t * @param {any} block\n\t * @return {boolean} Whether the block can have an image generated for it.\n\t */\n\tconst canGenerateImage = ( block ) => {\n\t\tconst imageReplaceableBlocks = [\n\t\t\t'core/image',\n\t\t\t'core/cover',\n\t\t\t'core/group',\n\t\t\t'core/site-logo',\n\t\t];\n\n\t\tif ( ! block || ! imageReplaceableBlocks.includes( block.name ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// we don't want to include groups with no background image, return false\n\t\tif (\n\t\t\tblock.name === 'core/group' &&\n\t\t\t! block.attributes.style?.background?.backgroundImage?.url\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst buildAttrToUpdateImage = ( block, imageUrl, description ) => {\n\t\tconst attrToUpdate = {};\n\t\tswitch ( block.name ) {\n\t\t\tcase 'core/image':\n\t\t\t\tattrToUpdate.url = imageUrl;\n\t\t\t\tattrToUpdate.alt = description;\n\t\t\t\tbreak;\n\t\t\tcase 'core/cover':\n\t\t\t\tattrToUpdate.url = imageUrl;\n\t\t\t\tattrToUpdate.alt = description;\n\t\t\t\tif ( block.attributes.dimRatio === 100 ) {\n\t\t\t\t\t// if dimRatio is default 100, set it to 50, otherwise the bg image will not be visible\n\t\t\t\t\tattrToUpdate.dimRatio = 50;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'core/group':\n\t\t\t\tattrToUpdate.style = {\n\t\t\t\t\tbackground: {\n\t\t\t\t\t\tbackgroundImage: {\n\t\t\t\t\t\t\tsource: `file`,\n\t\t\t\t\t\t\turl: decodeURIComponent( imageUrl ),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t}\n\t\treturn attrToUpdate;\n\t};\n\n\tconst getNewStockImage = async ( { block, topic } ) => {\n\t\tif ( ! canGenerateImage( block ) ) {\n\t\t\treturn __(\n\t\t\t\t'I cannot generate an image for the currently selected block.',\n\t\t\t\t'big-sky'\n\t\t\t);\n\t\t}\n\n\t\tconst image = await getStockImageURL( topic );\n\n\t\tif ( ! image ) {\n\t\t\tsetBlockIsProcessing( block, false );\n\t\t\treturn __(\n\t\t\t\t'I could not retrieve a new stock image. Please try again.',\n\t\t\t\t'big-sky'\n\t\t\t);\n\t\t}\n\t\tconst attrToUpdate = buildAttrToUpdateImage( block, image, topic );\n\n\t\tupdateBlockAttributes( block.clientId, attrToUpdate );\n\n\t\tsetBlockIsProcessing( block, false );\n\n\t\treturn sprintf(\n\t\t\t// Translators: Placeholder represents the topic of the image requested by the user.\n\t\t\t__( 'I have inserted a new stock image of: %s', 'big-sky' ),\n\t\t\ttopic\n\t\t);\n\t};\n\n\treturn {\n\t\tsetImagesInBlocks,\n\t\tgetStockImageURL,\n\t\tsetImages,\n\t\tgenerateLogoWithAI,\n\t\tgenerateImageWithAI,\n\t\tgetNewStockImage,\n\t\tcanGenerateImage,\n\t\tupdateImagesInBlocks,\n\t\tbuildAttrToUpdateImage,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport { store as aiStore } from '@store';\nimport useImages from '@hooks/use-images';\nimport {\n\tcustomSectionNames,\n\tcustomSectionTypes,\n} from '@ai/tasks/replace-content/section-types';\n\nexport default function usePatternContent() {\n\tconst { getCachedContent } = useSelect( ( select ) => {\n\t\t// need to do this to initialize the cached content in state\n\t\tconst { getCachedContent: _getCachedContent } = select( aiStore );\n\t\t_getCachedContent();\n\t\treturn {\n\t\t\tgetCachedContent: _getCachedContent,\n\t\t};\n\t}, [] );\n\tconst { canGenerateImage, buildAttrToUpdateImage } = useImages();\n\tconst { updateBlockAttributes } = useDispatch( blockEditorStore );\n\n\tconst updateSectionContent = (\n\t\tblock,\n\t\tsectionData,\n\t\tcacheIndexes = {\n\t\t\t'core/heading': 0,\n\t\t\t'core/paragraph': 0,\n\t\t\t'core/button': 0,\n\t\t}\n\t) => {\n\t\tconst cachedContent = getCachedContent();\n\n\t\tconst sectionCategory = sectionData.sectionCategory;\n\t\tif ( customSectionNames.includes( sectionCategory ) ) {\n\t\t\treturn customSectionTypes[ sectionCategory ].replaceContent(\n\t\t\t\tblock,\n\t\t\t\tcachedContent?.[ sectionCategory ]\n\t\t\t);\n\t\t}\n\n\t\tif ( block.innerBlocks?.length > 0 ) {\n\t\t\tblock.innerBlocks.forEach( ( innerBlock ) =>\n\t\t\t\tupdateSectionContent( innerBlock, sectionData, cacheIndexes )\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\tif (\n\t\t\tblock.name !== 'core/heading' &&\n\t\t\tblock.name !== 'core/paragraph' &&\n\t\t\tblock.name !== 'core/button'\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t\tconst cacheKey = `${ sectionCategory }-${ block.name.replace(\n\t\t\t'core/',\n\t\t\t''\n\t\t) }`;\n\n\t\tconst cached = cachedContent[ cacheKey ]\n\t\t\t? cachedContent[ cacheKey ]\n\t\t\t: [];\n\n\t\tconst selectedSectionContent =\n\t\t\tsectionData.selectedSectionContent[ cacheKey ];\n\n\t\tlet newContent;\n\t\t// First we see if there is fresh content from a selected section so any user changes are not lost.\n\t\t// If all the content from the selected section has been used already fall back to the general cached\n\t\t// content. We only maintain a single cache index as `about-paragraph[0]` in section cache will most\n\t\t// likely have the same content as `about-paragraph[0]` in the general cache, so when switching to the\n\t\t// general cache we want to continue from where we left off in the section cache.\n\t\tif (\n\t\t\tselectedSectionContent?.length > 0 &&\n\t\t\tselectedSectionContent?.length - 1 >= cacheIndexes[ block.name ]\n\t\t) {\n\t\t\tnewContent = selectedSectionContent[ cacheIndexes[ block.name ] ];\n\n\t\t\tcacheIndexes[ block.name ]++;\n\t\t} else {\n\t\t\tnewContent = cached[ cacheIndexes[ block.name ] ];\n\t\t\tcacheIndexes[ block.name ]++;\n\t\t}\n\n\t\tif (\n\t\t\tblock.name === 'core/heading' ||\n\t\t\tblock.name === 'core/paragraph'\n\t\t) {\n\t\t\tif ( ! sectionData.conceptSection ) {\n\t\t\t\tupdateBlockAttributes( block.clientId, {\n\t\t\t\t\tcontent: newContent,\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tblock.attributes.content = newContent;\n\t\t\t}\n\t\t}\n\n\t\tif ( block.name === 'core/button' ) {\n\t\t\tif ( ! sectionData.conceptSection ) {\n\t\t\t\tupdateBlockAttributes( block.clientId, {\n\t\t\t\t\ttext: newContent,\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tblock.attributes.text = newContent;\n\t\t\t}\n\t\t}\n\n\t\tif ( cached?.length - 1 === cacheIndexes[ block.name ] ) {\n\t\t\tcacheIndexes[ block.name ] = 0;\n\t\t}\n\t};\n\n\tconst getPatternContent = ( block, patternCategory, content ) => {\n\t\tif ( customSectionNames.includes( patternCategory ) ) {\n\t\t\treturn [];\n\t\t}\n\n\t\tswitch ( block.name ) {\n\t\t\tcase 'core/heading':\n\t\t\t\tif ( block.attributes.content ) {\n\t\t\t\t\tconst cacheKey = `${ patternCategory }-heading`;\n\t\t\t\t\tcontent[ cacheKey ] = [\n\t\t\t\t\t\t...( content[ cacheKey ] ? content[ cacheKey ] : [] ),\n\t\t\t\t\t\ttypeof block.attributes.content === 'string'\n\t\t\t\t\t\t\t? block.attributes.content\n\t\t\t\t\t\t\t: block.attributes.content?.text,\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'core/paragraph':\n\t\t\t\tif ( block.attributes.content ) {\n\t\t\t\t\tconst cacheKey = `${ patternCategory }-paragraph`;\n\t\t\t\t\tcontent[ cacheKey ] = [\n\t\t\t\t\t\t...( content[ cacheKey ] ? content[ cacheKey ] : [] ),\n\t\t\t\t\t\ttypeof block.attributes.content === 'string'\n\t\t\t\t\t\t\t? block.attributes.content\n\t\t\t\t\t\t\t: block.attributes.content?.text,\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'core/button':\n\t\t\t\tif ( block.attributes.text ) {\n\t\t\t\t\tconst cacheKey = `${ patternCategory }-button`;\n\t\t\t\t\tcontent[ cacheKey ] = [\n\t\t\t\t\t\t...( content[ cacheKey ] ? content[ cacheKey ] : [] ),\n\t\t\t\t\t\ttypeof block.attributes.text === 'string'\n\t\t\t\t\t\t\t? block.attributes.text\n\t\t\t\t\t\t\t: block.attributes.text?.originalHTML,\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t\tif ( block.innerBlocks?.length > 0 ) {\n\t\t\tblock.innerBlocks.forEach( ( innerBlock ) =>\n\t\t\t\tgetPatternContent( innerBlock, patternCategory, content )\n\t\t\t);\n\t\t}\n\t\treturn content;\n\t};\n\n\tconst updatePatternImages = (\n\t\tblock,\n\t\timageData,\n\t\tusedImages = { index: 0, urls: [] }\n\t) => {\n\t\tconst cachedContent = getCachedContent();\n\t\tlet cachedImages = cachedContent.images ? cachedContent.images : [];\n\t\tconst selectedSectionImages = imageData?.selectedSectionImages || [];\n\n\t\t// Extract Pexels IDs from selectedSectionImages URLs\n\t\tconst selectedPexelsIds = selectedSectionImages\n\t\t\t.map( ( url ) => {\n\t\t\t\tconst match = url.match( /image-pexels-(\\d+)/ );\n\t\t\t\treturn match ? match[ 1 ] : null;\n\t\t\t} )\n\t\t\t.filter( Boolean );\n\n\t\t// Filter cachedImages to remove ones with matching Pexels IDs\n\t\tcachedImages = [\n\t\t\t...selectedSectionImages,\n\t\t\t...cachedImages.filter( ( url ) => {\n\t\t\t\tconst match = url.match( /photos\\/(\\d+)\\/pexels-photo/ );\n\t\t\t\treturn match\n\t\t\t\t\t? ! selectedPexelsIds.includes( match[ 1 ] )\n\t\t\t\t\t: true;\n\t\t\t} ),\n\t\t];\n\n\t\tif ( canGenerateImage( block ) ) {\n\t\t\tconst index = usedImages.index;\n\t\t\tusedImages.index = ( usedImages.index + 1 ) % cachedImages.length;\n\t\t\tconst imageUrl = cachedImages[ index ];\n\t\t\tconst attrToUpdate = buildAttrToUpdateImage( block, imageUrl );\n\t\t\tif ( ! imageData.conceptSection ) {\n\t\t\t\tupdateBlockAttributes( block.clientId, attrToUpdate );\n\t\t\t} else {\n\t\t\t\tblock.attributes = {\n\t\t\t\t\t...block.attributes,\n\t\t\t\t\t...attrToUpdate,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif ( block.innerBlocks?.length > 0 ) {\n\t\t\tblock.innerBlocks.forEach( ( innerBlock ) =>\n\t\t\t\tupdatePatternImages( innerBlock, imageData, usedImages )\n\t\t\t);\n\t\t}\n\t};\n\n\tconst getPatternImages = ( block, images ) => {\n\t\tswitch ( block.name ) {\n\t\t\tcase 'core/image':\n\t\t\tcase 'core/cover':\n\t\t\t\tif ( block.attributes.url ) {\n\t\t\t\t\timages.push( block.attributes.url );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'core/group':\n\t\t\t\tif (\n\t\t\t\t\tblock.attributes.style?.background?.backgroundImage?.url\n\t\t\t\t) {\n\t\t\t\t\timages.push(\n\t\t\t\t\t\tblock.attributes.style?.background?.backgroundImage?.url\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t\tif ( block.innerBlocks?.length > 0 ) {\n\t\t\tblock.innerBlocks.forEach( ( innerBlock ) =>\n\t\t\t\tgetPatternImages( innerBlock, images )\n\t\t\t);\n\t\t}\n\t\treturn images;\n\t};\n\n\treturn {\n\t\tupdateSectionContent,\n\t\tgetPatternContent,\n\t\tupdatePatternImages,\n\t\tgetPatternImages,\n\t};\n}\n","/**\n * External dependencies\n */\nimport { systemPromptTemplate } from '@ai/system-prompt-template.js';\nexport default systemPromptTemplate.format( {\n\trole: 'You are a website copy editor and can produce relevant content for a website based on a site description that will be provided as a string description. Avoid overly flowery language and meaningless buzz words/phrases.',\n\n\tcontext: `The content to update will be provided as an array of JSON objects in the following format:\n\t\t{\n\t\t\t\"t\":\"the type of content\"\n\t\t\t\"i\": \"a unique identifier for the content\"\n\t\t\t\"ln\":\"number of characters to limit the content to\"\n\t\t\t\"l\":\"the language of the content\"\n\t\t}`,\n\texamplesDescription:\n\t\t\"The new copy you write is mapped to the same id from the 'i' property as in the original array of objects. For example, for a site description of 'An organic produce delivery service based in New York City':\",\n\texamples: [\n\t\t`Content before:\n\t\t\t{ \"content\":\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\t\"i\": \"123\",\n\t\t\t\t\t\t\"t\": \"h2\",\n\t\t\t\t\t\t\"ln\": \"35\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"i\": \"456\",\n\t\t\t\t\t\t\"t\": \"p\",\n\t\t\t\t\t\t\"ln\": \"80\"\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}`,\n\t\t`Content after:\n\t\t\t{ \"content\":\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\t\"i\": \"123\",\n\t\t\t\t\t\t\"t\": \"h2\",\n\t\t\t\t\t\t\"e\": \"Fred's Farm's promise to you\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"i\": \"456\",\n\t\t\t\t\t\t\"t\": \"p\",\n\t\t\t\t\t\t\"e\": \"Our mission is to provide the freshest organic produce to our customers.\"\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}`,\n\t],\n\tdo: [\n\t\t'If the \"l\" property is specified, translate the example text to the same language as the \"l\" property. PLEASE DO NOT generate new copy.',\n\t\t'Otherwise, generate new copy according to the following guidelines:',\n\t\t'You love being succinct and so you take the ln value of each entry very seriously. You write a string as close to this number of characters as possible. Being under this length is better than going over it.',\n\t\t'If the \"t\" property is \"h1\" this is a main heading: the main heading should be written in title case and have a length less than 40 characters.',\n\t\t'If the \"t\" property is \"h2\" this is a secondary heading: secondary headings should be written in sentence case (not title case) and have a length less than 40 characters.',\n\t\t'If the \"t\" property is \"p\" this is a paragraph its content should relate to the nearest \"t\" content proceeding it.',\n\t\t'If the \"t\" property is \"b\" this is a button so the text must be a maximum length of 15 characters.',\n\t\t'You will write this new copy entirely by yourself using your own knowledge. You do not need to call any external tools or functions to do this.',\n\t\t'Only ever call replace_content.',\n\t\t'Leave the content of your response as null.',\n\t\t'Return the updated array of objects as a JSON object.',\n\t],\n\n\tdont: [\n\t\t'Explain your choices to the user.',\n\t\t'Ask the user to confirm your choices',\n\t],\n} );\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useRegistry, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport {\n\tfindLastAvailableInnerBlockByClassName,\n\tgetContentOfBlocks,\n\tgetContentRequestData,\n} from './utils.js';\nimport templating from '@config/templating.json';\nimport { store as aiStore } from '@store';\nimport useBlocks from '@hooks/use-blocks';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport usePatternContent from '@hooks/use-pattern-content';\nimport {\n\tcustomSectionNames,\n\tcustomSectionTypes,\n\tsectionCachedContentIsValid,\n} from './section-types/index.js';\nimport log from '@utils/log-debug.js';\nimport contentSystemPrompt from './system-prompt.js';\n\nexport default function useReplaceContent() {\n\tconst registry = useRegistry();\n\tconst { getBlock } = useSelect( blockEditorStore );\n\tconst { siteDescription } = useSiteMetadata().getSiteMetadata();\n\tconst { getCachedContent } = useSelect( aiStore );\n\n\tconst { basicChatModel } = useSelect( ( select ) => ( {\n\t\tbasicChatModel: select( aiStore ).getBasicChatModel(),\n\t} ) );\n\n\tconst { runChatCompletion, addCachedContent } = useDispatch( aiStore );\n\tconst { updateBlockAttributes } = useDispatch( blockEditorStore );\n\tconst { setBlockIsProcessing } = useBlocks();\n\tconst { getPatternContent, updateSectionContent } = usePatternContent();\n\n\tconst replace_content = (\n\t\tcontent,\n\t\tchunk,\n\t\tisConceptSection,\n\t\tpatternCategory\n\t) => {\n\t\tcontent\n\t\t\t.filter( ( cnt ) => cnt.i === 'SPARE' )\n\t\t\t.forEach( ( cnt ) =>\n\t\t\t\taddCachedContent( {\n\t\t\t\t\tcategory: patternCategory,\n\t\t\t\t\ttype: cnt.t,\n\t\t\t\t\tcontent: cnt.e,\n\t\t\t\t} )\n\t\t\t);\n\n\t\tconst remappedContent = content\n\t\t\t.filter( ( cnt ) => cnt.i !== 'SPARE' )\n\t\t\t.map( ( block ) => ( {\n\t\t\t\tclientId: chunk.clientIdMap[ block.i ],\n\t\t\t\ttext: block.e,\n\t\t\t\ttype: block.t,\n\t\t\t} ) );\n\n\t\tregistry.batch( () => {\n\t\t\tremappedContent?.forEach( ( newContent ) => {\n\t\t\t\tconst attributes = {};\n\t\t\t\tif ( patternCategory ) {\n\t\t\t\t\taddCachedContent( {\n\t\t\t\t\t\tcategory: patternCategory,\n\t\t\t\t\t\ttype: newContent.type,\n\t\t\t\t\t\tcontent: newContent.text,\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\tconst block = getBlock( newContent.clientId );\n\t\t\t\tif ( block ) {\n\t\t\t\t\tsetBlockIsProcessing( block, true );\n\t\t\t\t\tif (\n\t\t\t\t\t\tblock.name === 'core/heading' ||\n\t\t\t\t\t\tblock.name === 'core/paragraph'\n\t\t\t\t\t) {\n\t\t\t\t\t\tattributes.content = newContent.text;\n\t\t\t\t\t} else if ( block.name === 'core/site-title' ) {\n\t\t\t\t\t} else if ( block.name === 'core/button' ) {\n\t\t\t\t\t\tattributes.text = newContent.text;\n\t\t\t\t\t}\n\n\t\t\t\t\tupdateBlockAttributes( newContent.clientId, {\n\t\t\t\t\t\t...attributes,\n\t\t\t\t\t} );\n\n\t\t\t\t\tsetBlockIsProcessing( block, false );\n\t\t\t\t}\n\n\t\t\t\tif ( isConceptSection ) {\n\t\t\t\t\tconst inMemoryBlock = chunk.blockMap[ newContent.clientId ];\n\t\t\t\t\tif ( inMemoryBlock ) {\n\t\t\t\t\t\tif ( inMemoryBlock.name === 'core/button' ) {\n\t\t\t\t\t\t\tinMemoryBlock.attributes.text = newContent.text;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinMemoryBlock.attributes.content = newContent.text;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t\t} );\n\n\t\treturn __( 'I have replaced the content.', 'big-sky' );\n\t};\n\n\tconst getContent = async ( {\n\t\tblockClientId,\n\t\tconceptSection,\n\t\tlanguage,\n\t} ) => {\n\t\tconst isConceptSection = !! conceptSection;\n\n\t\tlet blocks = [];\n\t\tlet sectionData;\n\t\tif ( conceptSection ) {\n\t\t\tconst parentBlock = conceptSection[ 0 ];\n\t\t\tblocks = conceptSection;\n\t\t\tsectionData = {\n\t\t\t\tname: parentBlock.attributes?.metadata?.name,\n\t\t\t\tpatternCategory:\n\t\t\t\t\tparentBlock.attributes?.metadata?.patternCategory,\n\t\t\t};\n\t\t} else {\n\t\t\tconst block = getBlock( blockClientId );\n\t\t\tblocks = [ block ];\n\t\t}\n\n\t\tconst content = getContentOfBlocks( blocks ).filter(\n\t\t\t( block ) =>\n\t\t\t\t! templating.contentToIgnore.some( ( ignoreContent ) =>\n\t\t\t\t\tblock.example?.includes( ignoreContent )\n\t\t\t\t)\n\t\t);\n\n\t\tif ( ! isConceptSection ) {\n\t\t\tcontent.forEach( ( contentBlock ) => {\n\t\t\t\tsetBlockIsProcessing( contentBlock, true );\n\t\t\t} );\n\t\t}\n\n\t\treturn {\n\t\t\tcontent: getContentRequestData(\n\t\t\t\tcontent,\n\t\t\t\tisConceptSection,\n\t\t\t\tlanguage\n\t\t\t),\n\t\t\tsectionData,\n\t\t};\n\t};\n\n\tasync function replaceContent( {\n\t\tblockClientId,\n\t\tconceptSection,\n\t\tsiteDescription: customDescription,\n\t\tsiteLocation,\n\t\treasonForSection,\n\t\ttopic,\n\t\tpageTitle,\n\t\tsectionCategory,\n\t\trequestedSubject,\n\t\tlanguage,\n\t\tselectedConcept,\n\t\tnewPage,\n\t\tnumOfSections,\n\t\tnoCache = false,\n\t\tinMemory = true,\n\t\tstartIndex = -1,\n\t\tsectionHeading,\n\t\treplaceHeading = true,\n\t\tpageDescription,\n\t} = {} ) {\n\t\t// Don't replace content for the team section.\n\t\tif ( [ 'team' ].includes( sectionCategory ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isConceptSection = !! conceptSection;\n\t\tconst cachedContent = getCachedContent();\n\n\t\t// Check first if this is a specific section category that requires special content replacement. If it is\n\t\t// we can get specific content for those categories and bypass getContent().\n\t\tif (\n\t\t\tcustomSectionNames.includes( sectionCategory ) &&\n\t\t\tisConceptSection\n\t\t) {\n\t\t\tconst isCachedContentValid =\n\t\t\t\tcustomSectionTypes[ sectionCategory ].isCachedContentValid ||\n\t\t\t\tsectionCachedContentIsValid;\n\t\t\tif (\n\t\t\t\tcachedContent?.[ sectionCategory ] &&\n\t\t\t\tisCachedContentValid( cachedContent[ sectionCategory ] ) &&\n\t\t\t\t! newPage &&\n\t\t\t\t! noCache\n\t\t\t) {\n\t\t\t\treturn customSectionTypes[ sectionCategory ].replaceContent( {\n\t\t\t\t\trootBlock: conceptSection[ 0 ],\n\t\t\t\t\tdata: cachedContent[ sectionCategory ],\n\t\t\t\t\tupdateBlockAttributes: inMemory\n\t\t\t\t\t\t? null\n\t\t\t\t\t\t: updateBlockAttributes,\n\t\t\t\t\tsectionHeading,\n\t\t\t\t\treplaceHeading,\n\t\t\t\t\tstartIndex,\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t// If the cached content is not valid wipe the existing cached content for that section category.\n\t\t\tif (\n\t\t\t\tcachedContent?.[ sectionCategory ] &&\n\t\t\t\t! isCachedContentValid( cachedContent[ sectionCategory ] )\n\t\t\t) {\n\t\t\t\tawait addCachedContent( {\n\t\t\t\t\tcategory: sectionCategory,\n\t\t\t\t\tcontent: [],\n\t\t\t\t\tclear: true,\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tconst patternContent = await getPatternTypeContent( {\n\t\t\t\tpatternType: sectionCategory,\n\t\t\t\tsiteDescription: customDescription,\n\t\t\t\tpageDescription,\n\t\t\t\tsiteLocation,\n\t\t\t\tconceptSection,\n\t\t\t\treasonForSection,\n\t\t\t\tnumOfSections,\n\t\t\t\ttopic,\n\t\t\t} );\n\t\t\treturn customSectionTypes[ sectionCategory ].replaceContent( {\n\t\t\t\trootBlock: conceptSection[ 0 ],\n\t\t\t\tdata: patternContent,\n\t\t\t\tupdateBlockAttributes: inMemory ? null : updateBlockAttributes,\n\t\t\t\treplaceHeading,\n\t\t\t\tsectionHeading,\n\t\t\t\tstartIndex,\n\t\t\t} );\n\t\t} else if ( cachedContent?.[ sectionCategory ] && ! newPage ) {\n\t\t\treturn updateSectionContent( conceptSection[ 0 ], {\n\t\t\t\tsectionCategory,\n\t\t\t\tselectedSectionContent: cachedContent[ sectionCategory ],\n\t\t\t\tconceptSection: true,\n\t\t\t} );\n\t\t} else if (\n\t\t\tObject.keys( cachedContent ).find( ( key ) =>\n\t\t\t\tkey.includes( sectionCategory )\n\t\t\t) &&\n\t\t\t! newPage\n\t\t) {\n\t\t\tlet selectedSectionContent = {};\n\n\t\t\t// If there is a selected section, get the content from the section. This way we can populate alterative sections with the same\n\t\t\t// content and any user edits to the content will be saved.\n\t\t\tconst selectedSection = selectedConcept\n\t\t\t\t? selectedConcept.patterns.find(\n\t\t\t\t\t\t( pattern ) => pattern.category === sectionCategory\n\t\t\t\t  )\n\t\t\t\t: null;\n\n\t\t\tif ( selectedSection ) {\n\t\t\t\tselectedSectionContent = selectedSection.blocks[ 0 ]\n\t\t\t\t\t? getPatternContent(\n\t\t\t\t\t\t\tselectedSection.blocks[ 0 ],\n\t\t\t\t\t\t\tsectionCategory,\n\t\t\t\t\t\t\t{}\n\t\t\t\t\t  )\n\t\t\t\t\t: {};\n\t\t\t}\n\n\t\t\treturn updateSectionContent( conceptSection[ 0 ], {\n\t\t\t\tsectionCategory,\n\t\t\t\tselectedSectionContent,\n\t\t\t\tconceptSection: true,\n\t\t\t} );\n\t\t}\n\n\t\tconst { content, sectionData } = await getContent( {\n\t\t\tblockClientId,\n\t\t\tconceptSection,\n\t\t\tlanguage,\n\t\t} );\n\n\t\tlet contentCall;\n\t\tif ( isConceptSection || ! blockClientId ) {\n\t\t\tcontentCall = getReplacementContent( {\n\t\t\t\tchunk: content,\n\t\t\t\tsectionInfo: sectionData,\n\t\t\t\tcustomSubject: topic || requestedSubject,\n\t\t\t\treason: reasonForSection,\n\t\t\t\t_pageTitle: pageTitle,\n\t\t\t\tpageDescription,\n\t\t\t} );\n\t\t} else {\n\t\t\tcontentCall = getReplacementContent( {\n\t\t\t\tchunk: content,\n\t\t\t\tcustomSubject: requestedSubject,\n\t\t\t\tpageDescription,\n\t\t\t} );\n\t\t}\n\n\t\treturn await contentCall;\n\n\t\tasync function getReplacementContent( {\n\t\t\tchunk,\n\t\t\tsectionInfo,\n\t\t\tcustomSubject,\n\t\t\treason,\n\t\t\t_pageTitle,\n\t\t\t_pageDescription,\n\t\t\tretry = false,\n\t\t} ) {\n\t\t\tconst description = siteDescription || customDescription;\n\t\t\tconst contentChunk = { content: chunk.contentForRequest };\n\n\t\t\tlet messageContent = `The site description is: ${ description }\\n\\n`;\n\n\t\t\tif ( sectionInfo?.name ) {\n\t\t\t\tmessageContent += `The section name is: ${ sectionInfo.name }\\n\\n`;\n\t\t\t}\n\n\t\t\tif ( reason ) {\n\t\t\t\tmessageContent += `The reason this section has been chosen: ${ reason }\\n\\n`;\n\t\t\t}\n\n\t\t\tif ( _pageTitle ) {\n\t\t\t\tmessageContent += `The page title is: ${ _pageTitle }\\n\\n`;\n\t\t\t}\n\n\t\t\tif ( _pageDescription ) {\n\t\t\t\tmessageContent += `The description of the page is: ${ _pageDescription }, so content should be relevant to this.\\n\\n`;\n\t\t\t}\n\n\t\t\tmessageContent +=\n\t\t\t\t'The content you choose should always be relevant to the section information provided above.';\n\n\t\t\tif ( customSubject ) {\n\t\t\t\tmessageContent += `\\nThe subject requested by the user: ${ customSubject }\\n\\n`;\n\t\t\t}\n\n\t\t\tmessageContent += `The content to update is: ${ JSON.stringify(\n\t\t\t\tcontentChunk\n\t\t\t) }`;\n\n\t\t\tconst messages = [\n\t\t\t\t{\n\t\t\t\t\trole: 'system',\n\t\t\t\t\tcontent: contentSystemPrompt,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\trole: 'user',\n\t\t\t\t\tcontent: messageContent,\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tconst response = await runChatCompletion(\n\t\t\t\tbasicChatModel,\n\t\t\t\tmessages,\n\t\t\t\tnull,\n\t\t\t\t0.2,\n\t\t\t\t'json_object'\n\t\t\t);\n\n\t\t\tconst newContent = response?.choices?.[ 0 ]?.message?.content;\n\n\t\t\tif ( newContent ) {\n\t\t\t\ttry {\n\t\t\t\t\tconst parsedArgs = JSON.parse( newContent );\n\n\t\t\t\t\tif ( ! parsedArgs.content ) {\n\t\t\t\t\t\tif ( ! retry ) {\n\t\t\t\t\t\t\tlog.info(\n\t\t\t\t\t\t\t\t'CONTENT TOOL: content missing in response, retrying with chunk of content.'\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\treturn getReplacementContent( {\n\t\t\t\t\t\t\t\tchunk,\n\t\t\t\t\t\t\t\tsectionInfo: sectionData,\n\t\t\t\t\t\t\t\tretry: true,\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlog.info(\n\t\t\t\t\t\t\t'CONTENT TOOL: content missing in response, some content may not be updated.'\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn __(\n\t\t\t\t\t\t\t'I encountered an error while processing your request. Please try again.',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn replace_content(\n\t\t\t\t\t\tparsedArgs.content,\n\t\t\t\t\t\tchunk,\n\t\t\t\t\t\tisConceptSection,\n\t\t\t\t\t\tsectionData?.patternCategory\n\t\t\t\t\t);\n\t\t\t\t} catch ( e ) {\n\t\t\t\t\tif ( ! retry ) {\n\t\t\t\t\t\treturn getReplacementContent( {\n\t\t\t\t\t\t\tchunk,\n\t\t\t\t\t\t\tsectionInfo: sectionData,\n\t\t\t\t\t\t\tretry: true,\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log( e );\n\t\t\t\t\tlog.info(\n\t\t\t\t\t\t'CONTENT TOOL: JSON parsing error some content may be missing'\n\t\t\t\t\t);\n\t\t\t\t\treturn __(\n\t\t\t\t\t\t'I encountered an error while processing your request. Please try again.',\n\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tasync function getPatternTypeContent( {\n\t\tpatternType,\n\t\tsiteDescription: description,\n\t\tsiteLocation,\n\t\tpageDescription,\n\t\ttopic,\n\t\tconceptSection,\n\t\treasonForSection,\n\t\tnumOfSections,\n\t\thasRetried = false,\n\t} ) {\n\t\tconst name = customSectionTypes[ patternType ].name;\n\t\tconst prompts = customSectionTypes[ patternType ].getPrompts( {\n\t\t\tconceptSection,\n\t\t\tsiteLocation,\n\t\t\tsiteDescription,\n\t\t\tpageDescription,\n\t\t\tnumOfSections,\n\t\t\ttopic,\n\t\t} );\n\t\tlet reasoning = '';\n\t\tif ( reasonForSection ) {\n\t\t\treasoning = `The reason for this section is: ${ reasonForSection }, on the topic of ${ topic }.`;\n\t\t}\n\t\tlet pageReasoning = '';\n\t\tif ( pageDescription ) {\n\t\t\tpageReasoning = `The description of the page that this section appears in is: ${ pageDescription }, so the content should be relevant to this.`;\n\t\t}\n\n\t\tconst messages = [\n\t\t\t{\n\t\t\t\trole: 'system',\n\t\t\t\tcontent: prompts.system,\n\t\t\t},\n\t\t\t{\n\t\t\t\trole: 'user',\n\t\t\t\tcontent: `The site description is: ${ description }.\n\n\t\t\t\t\t${ reasoning }.\n\n\t\t\t\t\t${ pageReasoning }\n\n\t\t\t\t\t${ prompts.user }`,\n\t\t\t},\n\t\t];\n\n\t\tconst response = await runChatCompletion(\n\t\t\tbasicChatModel,\n\t\t\tmessages,\n\t\t\tnull,\n\t\t\t0.2,\n\t\t\t'json_object'\n\t\t);\n\n\t\ttry {\n\t\t\tlet content = JSON.parse(\n\t\t\t\tresponse?.choices?.[ 0 ]?.message?.content\n\t\t\t);\n\n\t\t\t// need to handle certain pattern type responses differently\n\t\t\tif (\n\t\t\t\t[\n\t\t\t\t\t'menu',\n\t\t\t\t\t'events',\n\t\t\t\t\t'services',\n\t\t\t\t\t'testimonials',\n\t\t\t\t\t'contact',\n\t\t\t\t\t'footer',\n\t\t\t\t].includes( patternType )\n\t\t\t) {\n\t\t\t\t// if content data is an object, get the first value\n\t\t\t\tif ( typeof content === 'object' ) {\n\t\t\t\t\tcontent = Object.values( content )[ 0 ];\n\t\t\t\t}\n\t\t\t\t// if content data is not an array, make it an array\n\t\t\t\tif ( ! Array.isArray( content ) ) {\n\t\t\t\t\tcontent = [ content ];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! content ) {\n\t\t\t\tif ( ! hasRetried ) {\n\t\t\t\t\tlog.info(\n\t\t\t\t\t\t`CONTENT TOOL: ${ name } data invalid, retrying.`\n\t\t\t\t\t);\n\n\t\t\t\t\tgetPatternTypeContent( {\n\t\t\t\t\t\tpatternType,\n\t\t\t\t\t\tsiteDescription: description,\n\t\t\t\t\t\tsiteLocation,\n\t\t\t\t\t\tconceptSection,\n\t\t\t\t\t\treasonForSection,\n\t\t\t\t\t\tnumOfSections,\n\t\t\t\t\t\thasRetried: true,\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\tlog.error(\n\t\t\t\t\t`CONTENT TOOL: ${ name } data missing in response after retry, events may not be updated.`\n\t\t\t\t);\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\taddCachedContent( {\n\t\t\t\tcategory: name,\n\t\t\t\tcontent,\n\t\t\t} );\n\n\t\t\treturn content;\n\t\t} catch ( e ) {\n\t\t\tif ( ! hasRetried ) {\n\t\t\t\treturn getPatternTypeContent( {\n\t\t\t\t\tpatternType,\n\t\t\t\t\tsiteDescription: description,\n\t\t\t\t\tsiteLocation,\n\t\t\t\t\tconceptSection,\n\t\t\t\t\treasonForSection,\n\t\t\t\t\tnumOfSections,\n\t\t\t\t\thasRetried: true,\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tlog.error(\n\t\t\t\t`CONTENT TOOL: JSON parsing error for ${ name } data, content may be missing.`\n\t\t\t);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tasync function generateDummyPostContent( {\n\t\tsiteDescription: description,\n\t} ) {\n\t\tconst numPosts = 6;\n\t\tconst messages = [\n\t\t\t{\n\t\t\t\trole: 'system',\n\t\t\t\tcontent: `You are an expert at generating blog posts based on a description of the website.\n\t\t\t\t\tThe post title should be no longer than five words.\n\t\t\t\t\tThe post content should be a paragraph of at least three sentences, but no more than five sentences. Use long descriptive sentences, as if you are writing a blog post.\n\t\t\t\t\tThe post category should be no longer than two words.\n\t\t\t\t\tThe image_search should be a short description of the image you would use for the post, no longer than three words.\n\t\t\t\t\tYou return the data as an array of JSON objects in the following format:\n\t\t\t\t\t{ \"title\": \"Post Title\", \"content\": \"Post Content\", \"category\": \"Post Category\", \"image_search\": \"Image Descriptor\" }`,\n\t\t\t},\n\t\t\t{\n\t\t\t\trole: 'user',\n\t\t\t\tcontent: `The site description is: ${ description }.\n\t\t\t\t\tGenerate ${ numPosts } blog posts for this website based on the description.`,\n\t\t\t},\n\t\t];\n\n\t\tconst response = await runChatCompletion(\n\t\t\tbasicChatModel,\n\t\t\tmessages,\n\t\t\tnull,\n\t\t\t0.2,\n\t\t\t'json_object'\n\t\t);\n\n\t\tlet posts = response?.choices?.[ 0 ]?.message?.content;\n\n\t\tif ( posts ) {\n\t\t\tposts = JSON.parse( posts );\n\t\t\t// if content data is an object, get the first value\n\t\t\t// the first value should be the array of posts, like { posts: [ ... ] }\n\t\t\tif ( typeof posts === 'object' && ! Array.isArray( posts ) ) {\n\t\t\t\tposts = Object.values( posts )[ 0 ];\n\t\t\t}\n\t\t\t// if content data is not an array, make it an array\n\t\t\tif ( ! Array.isArray( posts ) ) {\n\t\t\t\tposts = [ posts ];\n\t\t\t}\n\n\t\t\treturn posts;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tfunction getLastAvailableContentByClassName( block, className ) {\n\t\tconst foundBlock = findLastAvailableInnerBlockByClassName(\n\t\t\tblock,\n\t\t\tclassName\n\t\t);\n\n\t\tif ( foundBlock ) {\n\t\t\treturn typeof foundBlock.attributes.content === 'string'\n\t\t\t\t? foundBlock.attributes.content\n\t\t\t\t: foundBlock.attributes.content?.originalHTML;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\treturn {\n\t\tgenerateDummyPostContent,\n\t\treplaceContent,\n\t\tgetPatternTypeContent,\n\t\tgetLastAvailableContentByClassName,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useDispatch, useRegistry, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { store as editorStore } from '@wordpress/editor';\nimport { createBlock, rawHandler, serialize } from '@wordpress/blocks';\nimport { useCallback, useEffect } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport useAfterSave from '@hooks/use-after-save';\nimport useImages from '@hooks/use-images.js';\nimport useBlocks from '@hooks/use-blocks';\nimport useIsHomePage from '@hooks/use-is-home-page';\nimport useSiteMetadata from '@hooks/use-site-metadata.js';\nimport useStyles from '@hooks/use-styles';\nimport { store as aiStore } from '@store';\nimport useReplaceContent from '@ai/tasks/replace-content/use-replace-content.js';\nimport { unlock } from '@utils/lock-unlock';\nimport uuidv4 from '@utils/uuid';\nimport {\n\tcreateDummyPosts,\n\tcreateDummyPostTag,\n\tgetDummyPosts,\n\tgetDummyPostTag,\n} from '@utils/dummy-posts';\nimport patternCategories from '@data/pattern-categories.js';\nimport styleVariations from '@data/section-style-variations';\nimport usePatternContent from './use-pattern-content.js';\nimport { getMediaColor } from '@utils/images';\nimport log from '@utils/log-debug.js';\nimport { patternKeys, sectionStyleRegex } from '@utils/constants';\nimport { getContrastingThemeColor } from '@utils/colors';\n\nconst DEFAULT_NUM_CONCEPTS = 6;\n\nfunction getImageBlocksWithIds( blocks ) {\n\tconst result = [];\n\n\tblocks.forEach( ( block ) => {\n\t\tif (\n\t\t\tblock.name === 'core/image' &&\n\t\t\tblock.attributes.url &&\n\t\t\tblock.attributes.id\n\t\t) {\n\t\t\tresult.push( block );\n\t\t}\n\t\tresult.push( ...getImageBlocksWithIds( block.innerBlocks ) );\n\t} );\n\n\treturn result;\n}\n\nexport default function usePatterns() {\n\tconst { ITEMS_KEY, ITEM_KEY, SECTIONS_KEY, SECTION_KEY } = patternKeys;\n\tconst {\n\t\tinsertBlock,\n\t\treplaceBlock,\n\t\tremoveBlocks,\n\t\tupdateBlockAttributes,\n\t\tsetBlockEditingMode,\n\t\tupdateBlockListSettings,\n\t} = useDispatch( blockEditorStore );\n\tconst { editEntityRecord } = useDispatch( coreStore );\n\tconst { setBlockRemovalRules } = unlock( useDispatch( blockEditorStore ) );\n\tconst {\n\t\tgetBlocks,\n\t\tgetBlockIndex,\n\t\tgetBlocksByName,\n\t\tgetBlockAttributes,\n\t\tgetBlock,\n\t\tgetSelectedBlockClientId,\n\t\tgetBlockListSettings,\n\t} = useSelect( blockEditorStore );\n\tconst {\n\t\tgetFirstChildBlockByName,\n\t\tgetParentRootPatternBlock,\n\t\tgetTemplatePartClientID,\n\t\tsetMapLocationInBlocks,\n\t\tfixInvalidBlock,\n\t} = useBlocks();\n\tconst { getBlockRemovalRules } = unlock( useSelect( blockEditorStore ) );\n\tconst { generateLogoWithAI, getStockImageURL, setImagesInBlocks } =\n\t\tuseImages();\n\tconst { getRemotePatterns, userLocale } = useSelect( ( select ) => {\n\t\tconst store = select( aiStore );\n\t\tconst theUserLocale = store.getUserLocale();\n\n\t\t// NOTE: this is a workaround to get the remote patterns from the store\n\t\tstore.getRemotePatterns( theUserLocale );\n\t\treturn {\n\t\t\tgetRemotePatterns: store.getRemotePatterns,\n\t\t\tuserLocale: theUserLocale,\n\t\t};\n\t} );\n\tconst { getCurrentTheme } = useSelect( coreStore );\n\n\tconst isAfterSave = useAfterSave();\n\tconst isHomePage = useIsHomePage();\n\tconst registry = useRegistry();\n\tconst { generateDummyPostContent, replaceContent } = useReplaceContent();\n\tconst { updatePatternImages, getPatternImages } = usePatternContent();\n\tconst { getSiteMetadata, setSiteMetadata } = useSiteMetadata();\n\tconst { themeColors } = useStyles();\n\tconst { currentPostId } = useSelect( ( select ) => ( {\n\t\tcurrentPostId: select( editorStore ).getCurrentPostId(),\n\t} ) );\n\n\tconst selectedStyleVariationSet =\n\t\tstyleVariations[\n\t\t\t// eslint-disable-next-line no-restricted-syntax\n\t\t\tMath.floor( Math.random() * styleVariations.length )\n\t\t];\n\n\tconst getRootBlocksOfPostContent = useCallback( () => {\n\t\tconst postContentBlockId = getBlocksByName( 'core/post-content' )[ 0 ];\n\t\t// get the current top blocks underneath it\n\t\treturn getBlocks( postContentBlockId );\n\t}, [ getBlocksByName, getBlocks ] );\n\n\tconst getPatternById = ( patternId ) => {\n\t\tconst _patterns = getRemotePatterns( userLocale );\n\t\treturn _patterns.find( ( pattern ) => pattern.ID === patternId );\n\t};\n\n\tconst setDefaultEditMode = useCallback(\n\t\t( blocks ) => {\n\t\t\tregistry.batch( () => {\n\t\t\t\tblocks.forEach( ( block ) => {\n\t\t\t\t\tsetBlockEditingMode( block.clientId, 'default' );\n\t\t\t\t\tif ( block.attributes?.metadata?.remotePatternId ) {\n\t\t\t\t\t\t// Turn off templateLock for top-level pattern blocks.\n\t\t\t\t\t\tconst blockListSettings = getBlockListSettings(\n\t\t\t\t\t\t\tblock.clientId\n\t\t\t\t\t\t);\n\t\t\t\t\t\tupdateBlockListSettings( block.clientId, {\n\t\t\t\t\t\t\t...blockListSettings,\n\t\t\t\t\t\t\ttemplateLock: false,\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t\tif ( block.innerBlocks?.length > 0 ) {\n\t\t\t\t\t\tsetDefaultEditMode( block.innerBlocks );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\t\t},\n\t\t[\n\t\t\tgetBlockListSettings,\n\t\t\tregistry,\n\t\t\tsetBlockEditingMode,\n\t\t\tupdateBlockListSettings,\n\t\t]\n\t);\n\n\tconst syncSiteMetadataPatterns = useCallback(\n\t\t( params = {} ) => {\n\t\t\t// parallel arrays of postIds and blocks\n\t\t\tconst postIds = params.ids || [ currentPostId ];\n\t\t\tconst blockArrays = params.blocks || [\n\t\t\t\tgetRootBlocksOfPostContent(),\n\t\t\t];\n\t\t\tconst persist = params.persist || false;\n\n\t\t\t// filter out empty block arrays\n\t\t\tconst filteredBlockArrays = blockArrays.filter(\n\t\t\t\t( blocks ) => blocks.length > 0\n\t\t\t);\n\t\t\t// if all block arrays are empty, bail\n\t\t\t// this can happen before navigating to a new page\n\t\t\tif ( filteredBlockArrays.length === 0 ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Create patterns object to store patterns for all posts\n\t\t\tconst newPatternsForPosts = {};\n\t\t\tconst currentHeaderBlocks = getBlocks(\n\t\t\t\tgetTemplatePartClientID( 'header' )\n\t\t\t);\n\t\t\tconst currentHeaderPattern = currentHeaderBlocks?.[ 0 ];\n\t\t\tconst currentFooterBlocks = getBlocks(\n\t\t\t\tgetTemplatePartClientID( 'footer' )\n\t\t\t);\n\t\t\tconst currentFooterPattern = currentFooterBlocks?.[ 0 ];\n\n\t\t\tpostIds.forEach( ( postId, index ) => {\n\t\t\t\tconst blocks = blockArrays[ index ] || [];\n\n\t\t\t\tconst rootBlocks = [\n\t\t\t\t\tcurrentHeaderPattern,\n\t\t\t\t\t...blocks,\n\t\t\t\t\tcurrentFooterPattern,\n\t\t\t\t];\n\n\t\t\t\t// Create new patterns data for current post\n\t\t\t\tconst newPatterns = rootBlocks\n\t\t\t\t\t.filter( ( block ) => block?.attributes?.metadata )\n\t\t\t\t\t.map( ( block ) => ( {\n\t\t\t\t\t\tid: block.attributes?.metadata?.remotePatternId || '',\n\t\t\t\t\t\t// category and slug are the same, different codes use different names\n\t\t\t\t\t\tcategory:\n\t\t\t\t\t\t\tblock.attributes?.metadata?.patternCategory || '',\n\t\t\t\t\t\tslug: block.attributes?.metadata?.patternCategory || '',\n\t\t\t\t\t\treason: block.attributes?.metadata?.reason || '',\n\t\t\t\t\t} ) );\n\n\t\t\t\t// Add patterns for this post to the patterns object\n\t\t\t\tnewPatternsForPosts[ postId ] = newPatterns;\n\t\t\t} );\n\n\t\t\t// Check if existingPatterns is an object, if not then create an empty object\n\t\t\tconst { patterns: savedPatterns } = getSiteMetadata();\n\t\t\tconst patternsObject =\n\t\t\t\ttypeof savedPatterns === 'object' &&\n\t\t\t\t! Array.isArray( savedPatterns )\n\t\t\t\t\t? savedPatterns\n\t\t\t\t\t: {};\n\n\t\t\t// Merge patterns, preserving existing reasons if not overwritten\n\t\t\tObject.keys( newPatternsForPosts ).forEach( ( postId ) => {\n\t\t\t\tconst existingPatterns = patternsObject[ postId ] || [];\n\t\t\t\tconst newPatterns = newPatternsForPosts[ postId ];\n\n\t\t\t\tnewPatternsForPosts[ postId ] = newPatterns.map(\n\t\t\t\t\t( newPattern ) => {\n\t\t\t\t\t\tconst existingPattern = existingPatterns.find(\n\t\t\t\t\t\t\t( pattern ) => pattern.id === newPattern.id\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\t// Keep existing reason if new pattern doesn't have one\n\t\t\t\t\t\tif ( existingPattern?.reason && ! newPattern.reason ) {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t...newPattern,\n\t\t\t\t\t\t\t\treason: existingPattern.reason,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn newPattern;\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} );\n\t\t\tsetSiteMetadata(\n\t\t\t\t{\n\t\t\t\t\tpatterns: {\n\t\t\t\t\t\t...patternsObject,\n\t\t\t\t\t\t...newPatternsForPosts,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tpersist\n\t\t\t);\n\t\t},\n\t\t[\n\t\t\tcurrentPostId,\n\t\t\tgetBlocks,\n\t\t\tgetRootBlocksOfPostContent,\n\t\t\tgetSiteMetadata,\n\t\t\tgetTemplatePartClientID,\n\t\t\tsetSiteMetadata,\n\t\t]\n\t);\n\n\tconst insertPattern = useCallback(\n\t\t( pattern, index, rootClientId = null, updateSelection = true ) => {\n\t\t\treturn insertBlock( pattern, index, rootClientId, updateSelection );\n\t\t},\n\t\t[ insertBlock ]\n\t);\n\n\tconst buildTemplatePartId = useCallback(\n\t\t( templatePartName ) => {\n\t\t\treturn `${ getCurrentTheme().stylesheet }//${ templatePartName }`;\n\t\t},\n\t\t[ getCurrentTheme ]\n\t);\n\n\tconst editTemplatePart = useCallback(\n\t\tasync ( templatePartId, blocks ) => {\n\t\t\tawait editEntityRecord(\n\t\t\t\t'postType',\n\t\t\t\t'wp_template_part',\n\t\t\t\ttemplatePartId,\n\t\t\t\t{ blocks, content: serialize( blocks ) }\n\t\t\t);\n\t\t\tsyncSiteMetadataPatterns();\n\t\t},\n\t\t[ editEntityRecord, syncSiteMetadataPatterns ]\n\t);\n\n\tconst replacePattern = useCallback(\n\t\tasync ( clientId, pattern ) => {\n\t\t\t// if the pattern is a header or footer, replace the entity record instead of the block\n\t\t\tconst patternCategory =\n\t\t\t\tpattern.attributes?.metadata?.patternCategory;\n\t\t\tif ( [ 'header', 'footer' ].includes( patternCategory ) ) {\n\t\t\t\tconst blocks = [ pattern ];\n\t\t\t\tawait editTemplatePart(\n\t\t\t\t\tbuildTemplatePartId( patternCategory ),\n\t\t\t\t\tblocks\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\treplaceBlock( clientId, pattern );\n\t\t\t\tsyncSiteMetadataPatterns();\n\t\t\t}\n\t\t},\n\t\t[\n\t\t\tbuildTemplatePartId,\n\t\t\teditTemplatePart,\n\t\t\treplaceBlock,\n\t\t\tsyncSiteMetadataPatterns,\n\t\t]\n\t);\n\n\tconst replaceTemplatePart = async ( templatePartName, blocks ) => {\n\t\tconst templatePartId = buildTemplatePartId( templatePartName );\n\t\tawait editTemplatePart( templatePartId, blocks );\n\t};\n\n\tconst insertPatterns = useCallback(\n\t\t( patternList, clientId, direction, updateSelection = true ) => {\n\t\t\t// Temporarily disable block removal rules to prevent modal from showing when switching layout\n\t\t\tconst blockRemovalRules = getBlockRemovalRules();\n\t\t\tsetBlockRemovalRules( [] );\n\n\t\t\tconst clientIds = [];\n\t\t\tconst insertionId = getBlocksByName( 'core/post-content' );\n\t\t\tconst insertionBlockId = insertionId[ 0 ];\n\t\t\tlet firstPattern = null;\n\n\t\t\tconst shouldReplace = direction === 'replace';\n\n\t\t\tif ( shouldReplace && ! clientId ) {\n\t\t\t\tconst blocksToReplace = getBlocks( insertionBlockId ).map(\n\t\t\t\t\t( b ) => b.clientId\n\t\t\t\t);\n\t\t\t\tremoveBlocks( blocksToReplace, updateSelection );\n\t\t\t}\n\n\t\t\tpatternList.forEach( ( pattern, patternIndex ) => {\n\t\t\t\tconst patternRootBlock = pattern.blocks[ 0 ];\n\n\t\t\t\tif ( ! firstPattern ) {\n\t\t\t\t\tfirstPattern = patternRootBlock;\n\t\t\t\t}\n\n\t\t\t\tif ( shouldReplace && clientId ) {\n\t\t\t\t\treplacePattern( clientId, patternRootBlock );\n\t\t\t\t} else if ( insertionBlockId ) {\n\t\t\t\t\tif ( clientId && direction === 'before' ) {\n\t\t\t\t\t\tinsertPattern(\n\t\t\t\t\t\t\tpatternRootBlock,\n\t\t\t\t\t\t\tgetBlockIndex( clientId ),\n\t\t\t\t\t\t\tinsertionBlockId,\n\t\t\t\t\t\t\tupdateSelection\n\t\t\t\t\t\t);\n\t\t\t\t\t} else if ( clientId ) {\n\t\t\t\t\t\tinsertPattern(\n\t\t\t\t\t\t\tpatternRootBlock,\n\t\t\t\t\t\t\tgetBlockIndex( clientId ) + patternIndex + 1,\n\t\t\t\t\t\t\tinsertionBlockId,\n\t\t\t\t\t\t\tupdateSelection\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinsertPattern(\n\t\t\t\t\t\t\tpatternRootBlock,\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tinsertionBlockId,\n\t\t\t\t\t\t\tupdateSelection\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tinsertPattern(\n\t\t\t\t\t\tpatternRootBlock,\n\t\t\t\t\t\tpatternIndex,\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tupdateSelection\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tclientIds.push( patternRootBlock.clientId );\n\t\t\t} );\n\n\t\t\t// Save the current pattern selection to the site metadata\n\t\t\tsyncSiteMetadataPatterns();\n\n\t\t\t// Restore block removal rules\n\t\t\tsetBlockRemovalRules( blockRemovalRules );\n\n\t\t\treturn clientIds;\n\t\t},\n\t\t[\n\t\t\tgetBlockIndex,\n\t\t\tgetBlockRemovalRules,\n\t\t\tgetBlocks,\n\t\t\tgetBlocksByName,\n\t\t\tinsertPattern,\n\t\t\tremoveBlocks,\n\t\t\treplacePattern,\n\t\t\tsetBlockRemovalRules,\n\t\t\tsyncSiteMetadataPatterns,\n\t\t]\n\t);\n\n\tconst filterByCategory = ( {\n\t\tavailablePatterns,\n\t\tcategory,\n\t\tsiteLocation,\n\t\tisAskingForMap = false,\n\t\tpageSlug,\n\t} ) => {\n\t\tconst patternsInCategory = availablePatterns?.filter( ( p ) => {\n\t\t\treturn p.category === category;\n\t\t} );\n\n\t\tlet _patterns = patternsInCategory;\n\n\t\t// Special cases for contact and footer patterns\n\t\tswitch ( category ) {\n\t\t\tcase 'contact':\n\t\t\t\t// If the page is contact and the site has a location make sure the pattern has map and address.\n\t\t\t\tif ( pageSlug === 'contact' && siteLocation?.coordinates ) {\n\t\t\t\t\treturn _patterns.filter( ( p ) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tp.html.toLowerCase().includes( 'wp:jetpack/map' ) &&\n\t\t\t\t\t\t\tp.html\n\t\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t\t.match( /is-contact-address(?!-)/ )\n\t\t\t\t\t\t);\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\t// Only return maps if that's what we're looking for\n\t\t\t\tif ( isAskingForMap ) {\n\t\t\t\t\treturn _patterns.filter( ( p ) => {\n\t\t\t\t\t\treturn p.html\n\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t.includes( 'wp:jetpack/map' );\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\t// Exclude patterns with an address if the site has none.\n\t\t\t\tif ( ! siteLocation?.name ) {\n\t\t\t\t\t_patterns = _patterns.filter( ( p ) => {\n\t\t\t\t\t\treturn ! p.html\n\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t.match( /is-contact-address(?!-)/ );\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\t// Exclude patterns with a map if the site location coordinates are not set.\n\t\t\t\tif ( ! siteLocation?.coordinates ) {\n\t\t\t\t\t_patterns = _patterns.filter( ( p ) => {\n\t\t\t\t\t\treturn ! p.html\n\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t.includes( 'wp:jetpack/map' );\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'footer':\n\t\t\t\t// Exclude patterns with an address if the site has none.\n\t\t\t\tif ( ! siteLocation?.name ) {\n\t\t\t\t\t_patterns = _patterns.filter( ( p ) => {\n\t\t\t\t\t\treturn ! p.html\n\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t.includes( 'is-footer-address' );\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// If we're on the home page, don't show patterns with 'page' category\n\t\tif ( isHomePage && pageSlug !== 'about' ) {\n\t\t\t_patterns = _patterns.filter( ( p ) => {\n\t\t\t\treturn ! Object.keys( p.categories ).includes( 'page' );\n\t\t\t} );\n\t\t}\n\t\t// Using special case for about page as the page pattern is better in this context than other about patterns.\n\t\t// Will extend to other pages later.\n\t\tif ( pageSlug === 'about' ) {\n\t\t\t_patterns = _patterns.filter( ( p ) => {\n\t\t\t\treturn (\n\t\t\t\t\tObject.keys( p.categories ).includes( 'page' ) &&\n\t\t\t\t\tObject.keys( p.categories ).includes( 'about' )\n\t\t\t\t);\n\t\t\t} );\n\t\t}\n\t\treturn _patterns.length ? _patterns : patternsInCategory; // This shouldn't happen. If it does, fallback to all category patterns.\n\t};\n\n\tconst convertToBlocks = ( html ) => {\n\t\treturn rawHandler( { HTML: html } );\n\t};\n\n\tconst composePatterns = ( {\n\t\ttitle,\n\t\tcategories,\n\t\ttopic,\n\t\tsiteDescription,\n\t\tsiteLocation,\n\t\tpageDescription,\n\t\tnumberOfConcepts = DEFAULT_NUM_CONCEPTS,\n\t\tselectedConcept,\n\t\tnewPage = false,\n\t\tnoCache = false,\n\t\tisAskingForMap = false,\n\t\tchosenPatterns = [],\n\t\tpages = [],\n\t\tpageSlug,\n\t} ) => {\n\t\tconst concepts = [];\n\n\t\t// if categories is empty or undefined, bail\n\t\tif ( ! categories || categories.length === 0 ) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst { siteLocation: savedSiteLocation } = getSiteMetadata();\n\t\tconst chosenPatternIDs =\n\t\t\tselectedConcept?.patterns.map( ( p ) => p.ID ) || [];\n\n\t\tconst patterns = getRemotePatterns( userLocale );\n\n\t\tfor ( let i = 0; i < numberOfConcepts; i++ ) {\n\t\t\tconcepts[ i ] = [];\n\n\t\t\tconst canRepeatPattern = categories.length > 1 ? true : false;\n\t\t\tlet styleVariationIndex = 0;\n\n\t\t\tcategories.forEach( ( category ) => {\n\t\t\t\t// if the category is in the chosenPatterns array, use the provided pattern\n\t\t\t\tconst chosenPatternId = chosenPatterns.find(\n\t\t\t\t\t( p ) => p.category === category.slug\n\t\t\t\t)?.id;\n\t\t\t\tconst chosenPattern = chosenPatternId\n\t\t\t\t\t? patterns.find( ( p ) => p.ID === chosenPatternId )\n\t\t\t\t\t: choosePattern(\n\t\t\t\t\t\t\tfilterByCategory( {\n\t\t\t\t\t\t\t\tavailablePatterns: patterns,\n\t\t\t\t\t\t\t\tcategory: category.slug,\n\t\t\t\t\t\t\t\tsiteLocation: siteLocation || savedSiteLocation,\n\t\t\t\t\t\t\t\tisAskingForMap,\n\t\t\t\t\t\t\t\tpageSlug,\n\t\t\t\t\t\t\t} ),\n\t\t\t\t\t\t\tchosenPatternIDs,\n\t\t\t\t\t\t\tcanRepeatPattern\n\t\t\t\t\t  );\n\n\t\t\t\tif ( chosenPattern !== undefined ) {\n\t\t\t\t\tstyleVariationIndex =\n\t\t\t\t\t\tstyleVariationIndex >=\n\t\t\t\t\t\tselectedStyleVariationSet?.body.length\n\t\t\t\t\t\t\t? 0\n\t\t\t\t\t\t\t: styleVariationIndex;\n\n\t\t\t\t\tconst patternStyleVariation =\n\t\t\t\t\t\tselectedStyleVariationSet?.body[ styleVariationIndex ];\n\n\t\t\t\t\tconst parsedPattern = initializePattern(\n\t\t\t\t\t\tchosenPattern,\n\t\t\t\t\t\tcategory.slug,\n\t\t\t\t\t\tpatternStyleVariation\n\t\t\t\t\t);\n\n\t\t\t\t\tconcepts[ i ].push( {\n\t\t\t\t\t\tID: chosenPattern.ID,\n\t\t\t\t\t\tcategory: category.slug,\n\t\t\t\t\t\treason: category.reason,\n\t\t\t\t\t\ttitle: chosenPattern.title,\n\t\t\t\t\t\tblocks: parsedPattern,\n\t\t\t\t\t} );\n\n\t\t\t\t\tchosenPatternIDs.push( chosenPattern.ID );\n\t\t\t\t\tstyleVariationIndex++;\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\treturn concepts.map( ( concept ) => {\n\t\t\tconst resolvers = [];\n\t\t\tfor ( const section of concept ) {\n\t\t\t\tresolvers.push( {\n\t\t\t\t\tsection,\n\t\t\t\t\tresolver: processSection( {\n\t\t\t\t\t\tpageTitle: title,\n\t\t\t\t\t\tpageDescription,\n\t\t\t\t\t\tselectedConcept,\n\t\t\t\t\t\tsection,\n\t\t\t\t\t\tsiteDescription,\n\t\t\t\t\t\ttopic,\n\t\t\t\t\t\tsiteLocation,\n\t\t\t\t\t\tconcept,\n\t\t\t\t\t\tcategories,\n\t\t\t\t\t\tnewPage,\n\t\t\t\t\t\tnoCache,\n\t\t\t\t\t\tpages,\n\t\t\t\t\t} ),\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tid: uuidv4(),\n\t\t\t\tpatterns: concept,\n\t\t\t\tresolvers,\n\t\t\t};\n\t\t} );\n\t};\n\n\tconst generateDummyPosts = async ( { blocks, siteDescription, topic } ) => {\n\t\tfor ( const block of blocks ) {\n\t\t\tif ( block.name === 'core/query' ) {\n\t\t\t\t// check if there's an existing post tag 'dummy-post'\n\t\t\t\tlet tagId = null;\n\t\t\t\tlet tag = await getDummyPostTag();\n\t\t\t\tif ( ! tag?.length ) {\n\t\t\t\t\t// if not, create a dummy post tag\n\t\t\t\t\ttag = await createDummyPostTag();\n\t\t\t\t\ttagId = tag?.id;\n\t\t\t\t} else {\n\t\t\t\t\ttagId = tag?.[ 0 ]?.id;\n\t\t\t\t}\n\n\t\t\t\tif ( ! tagId ) {\n\t\t\t\t\tlog.error( 'No Dummy Post Tag' );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// create dummy posts if there are none\n\t\t\t\tconst posts = await getDummyPosts( tagId );\n\t\t\t\tif ( ! posts?.length ) {\n\t\t\t\t\tconst dummyPostContent = await generateDummyPostContent( {\n\t\t\t\t\t\tsiteDescription,\n\t\t\t\t\t} );\n\t\t\t\t\t// add stock image to the dummy post content\n\t\t\t\t\tconst promises = dummyPostContent.map( async ( post ) => {\n\t\t\t\t\t\tpost.featured_image = await getStockImageURL(\n\t\t\t\t\t\t\tpost.image_search,\n\t\t\t\t\t\t\t1\n\t\t\t\t\t\t);\n\t\t\t\t\t} );\n\t\t\t\t\tawait Promise.all( promises );\n\t\t\t\t\tawait createDummyPosts( dummyPostContent );\n\t\t\t\t}\n\n\t\t\t\t// force a refresh of the query block\n\t\t\t\tconst random = Math.floor( 100000 + Math.random() * 400000 ); // eslint-disable-line no-restricted-syntax\n\t\t\t\tblock.attributes.query.exclude = [ random ];\n\t\t\t\tupdateBlockAttributes( block.clientId, {\n\t\t\t\t\tquery: {\n\t\t\t\t\t\t...block.attributes.query,\n\t\t\t\t\t\texclude: [ random ],\n\t\t\t\t\t},\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tgenerateDummyPosts( {\n\t\t\t\tblocks: block.innerBlocks,\n\t\t\t\tsiteDescription,\n\t\t\t\ttopic,\n\t\t\t} );\n\t\t}\n\t};\n\n\tconst processSection = async ( {\n\t\tpageTitle,\n\t\tsection,\n\t\tsiteDescription,\n\t\tpageDescription,\n\t\ttopic,\n\t\tsiteLocation,\n\t\tselectedConcept,\n\t\tcategories,\n\t\tnewPage = false,\n\t\tnoCache = false,\n\t\tpages = [],\n\t} ) => {\n\t\treturn Promise.all( [\n\t\t\treplaceContent( {\n\t\t\t\tconceptSection: section.blocks,\n\t\t\t\tsectionCategory: section.category,\n\t\t\t\treasonForSection: section.reason,\n\t\t\t\tsiteDescription,\n\t\t\t\tsiteLocation,\n\t\t\t\tselectedConcept,\n\t\t\t\ttopic,\n\t\t\t\tpageTitle,\n\t\t\t\tpageDescription,\n\t\t\t\tnewPage,\n\t\t\t\tnoCache,\n\t\t\t} ),\n\t\t\tgenerateDummyPosts( {\n\t\t\t\tblocks: section.blocks,\n\t\t\t\tsiteDescription,\n\t\t\t\ttopic,\n\t\t\t} ),\n\t\t\tsetImagesInSection( section, topic, selectedConcept, newPage ),\n\t\t] ).then( () => {\n\t\t\tsetCTAInSection( section, categories, pages );\n\t\t\tsetSectionInternalAnchor( section );\n\t\t\tsetMapsInSection( section, siteLocation );\n\t\t\tapplyCoverBlockOverlayStyles( section );\n\t\t} );\n\t};\n\n\tconst choosePattern = (\n\t\tavailablePatterns,\n\t\talreadyChosenPatternIDs = [],\n\t\tcanRepeatPattern = true\n\t) => {\n\t\tif ( ! availablePatterns?.length ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// choose a random pattern, but not one that has already been chosen\n\t\tlet availablePatternsNotChosen = availablePatterns.filter(\n\t\t\t( pattern ) => {\n\t\t\t\treturn ! alreadyChosenPatternIDs.includes( pattern.ID );\n\t\t\t}\n\t\t);\n\t\tlet patternsToChooseFrom;\n\t\tif ( alreadyChosenPatternIDs?.length ) {\n\t\t\t// exclude those patterns that's not allowed to show up after the last chosen pattern\n\t\t\t// todo not sure if this is 100% correct, revisit once we have more patterns disallowed.\n\t\t\tconst lastPatternId =\n\t\t\t\talreadyChosenPatternIDs[ alreadyChosenPatternIDs.length - 1 ];\n\t\t\tavailablePatternsNotChosen = availablePatternsNotChosen.filter(\n\t\t\t\t( pattern ) => {\n\t\t\t\t\treturn ! pattern.disallow_after.includes( lastPatternId );\n\t\t\t\t}\n\t\t\t);\n\t\t\tpatternsToChooseFrom = availablePatterns.filter( ( pattern ) => {\n\t\t\t\treturn ! pattern.disallow_after.includes( lastPatternId );\n\t\t\t} );\n\t\t}\n\n\t\t// if there is no patterns to choose from and we can't repeat patterns, bail\n\t\tif ( availablePatternsNotChosen.length === 0 && ! canRepeatPattern ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// if there is patterns not used yet, use those to avoid repeat, otherwise choose from all patterns\n\t\t// so we at least still have a pattern to show\n\t\tpatternsToChooseFrom = availablePatternsNotChosen.length\n\t\t\t? availablePatternsNotChosen\n\t\t\t: patternsToChooseFrom;\n\n\t\tconst chosenPattern =\n\t\t\tpatternsToChooseFrom[\n\t\t\t\tMath.floor( Math.random() * patternsToChooseFrom.length ) // eslint-disable-line no-restricted-syntax\n\t\t\t];\n\n\t\treturn chosenPattern;\n\t};\n\n\tconst applyCoverBlockOverlayStyles = async ( section ) => {\n\t\tconst coverBlock = getFirstChildBlockByName(\n\t\t\tsection.blocks[ 0 ],\n\t\t\t'core/cover'\n\t\t);\n\t\tif ( ! coverBlock ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst mediaColor = await getMediaColor( coverBlock.attributes.url );\n\t\tconst textColor = getContrastingThemeColor( mediaColor, themeColors );\n\t\tcoverBlock.attributes.customOverlayColor = mediaColor;\n\t\tcoverBlock.attributes.isUserOverlayColor = false;\n\t\tcoverBlock.attributes.overlayColor = undefined;\n\t\tcoverBlock.attributes.style = {\n\t\t\t...coverBlock.attributes.style,\n\t\t\tcolor: {\n\t\t\t\ttext: textColor?.color,\n\t\t\t},\n\t\t};\n\t};\n\n\tconst initializePattern = ( pattern, patternCategory, styleVariation ) => {\n\t\tlet parsedPattern = convertToBlocks( pattern.html );\n\n\t\t// reset external media IDs so images get saved\n\t\tgetImageBlocksWithIds( parsedPattern ).forEach( ( block ) => {\n\t\t\tblock.attributes.id = null;\n\t\t} );\n\n\t\tif (\n\t\t\tparsedPattern.length > 1 ||\n\t\t\tparsedPattern[ 0 ]?.name !== 'core/group'\n\t\t) {\n\t\t\t// If the pattern does not have a core/group top level wrapper, then add it.\n\t\t\tparsedPattern = [\n\t\t\t\tcreateBlock(\n\t\t\t\t\t'core/group',\n\t\t\t\t\t{\n\t\t\t\t\t\talign: 'full',\n\t\t\t\t\t},\n\t\t\t\t\tparsedPattern\n\t\t\t\t),\n\t\t\t];\n\t\t}\n\n\t\t// explicitly set top and bottom margin to 0 if not already set\n\t\tif ( ! parsedPattern[ 0 ]?.attributes?.style?.spacing ) {\n\t\t\tparsedPattern[ 0 ].attributes.style = {\n\t\t\t\t...parsedPattern[ 0 ].attributes?.style,\n\t\t\t\tspacing: {\n\t\t\t\t\tmargin: {\n\t\t\t\t\t\ttop: '0',\n\t\t\t\t\t\tbottom: '0',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tparsedPattern[ 0 ].attributes.metadata = {\n\t\t\t...parsedPattern[ 0 ].attributes?.metadata,\n\t\t\tname: patternCategories.find(\n\t\t\t\t( category ) => category.slug === patternCategory\n\t\t\t)?.title,\n\t\t\tpatternCategory,\n\t\t\tremotePatternId: pattern.ID,\n\t\t};\n\n\t\t// No section style support cover blocks (intro), this will change as the feature develops.\n\t\tif (\n\t\t\t'intro' === patternCategory &&\n\t\t\tgetFirstChildBlockByName( parsedPattern[ 0 ], 'core/cover' )\n\t\t) {\n\t\t\treturn parsedPattern;\n\t\t}\n\n\t\tlet className = parsedPattern[ 0 ].attributes.className || '';\n\t\t// Remove any hardcoded section style classes.\n\t\tclassName = className.replaceAll( sectionStyleRegex, '' ).trim();\n\n\t\tif ( className ) {\n\t\t\tparsedPattern[ 0 ].attributes.className =\n\t\t\t\tclassName + ` is-style-${ styleVariation }`;\n\t\t} else {\n\t\t\tparsedPattern[ 0 ].attributes.className = `is-style-${ styleVariation }`;\n\t\t}\n\n\t\treturn parsedPattern;\n\t};\n\n\tconst getPatternCategory = ( patternRootBlockClientId ) => {\n\t\tconst attrs = getBlockAttributes( patternRootBlockClientId );\n\n\t\treturn attrs?.metadata?.patternCategory || attrs?.slug;\n\t};\n\n\tconst getParentPatternCategory = ( block ) => {\n\t\tconst parentRootPatternBlock = getParentRootPatternBlock(\n\t\t\tblock.clientId\n\t\t);\n\t\tconst patternCategory = getPatternCategory(\n\t\t\tparentRootPatternBlock\n\t\t\t\t? parentRootPatternBlock.clientId\n\t\t\t\t: block.clientId\n\t\t);\n\n\t\treturn patternCategory;\n\t};\n\n\tconst getOtherPatternsInCategory = ( patternRootBlockClientId ) => {\n\t\tconst attrs = getBlockAttributes( patternRootBlockClientId );\n\n\t\tif ( ! attrs?.metadata ) {\n\t\t\treturn [];\n\t\t}\n\n\t\tif ( ! attrs?.metadata?.patternCategory ) {\n\t\t\treturn [];\n\t\t}\n\n\t\t// find the patterns that have a matching categoryName in the\n\t\t// patterns array categories object keys\n\t\tconst patterns = getRemotePatterns( userLocale );\n\t\treturn patterns.filter(\n\t\t\t( pattern ) => pattern.category === attrs?.metadata?.patternCategory\n\t\t);\n\t};\n\n\tconst setImagesInConcept = async ( concept, topic ) => {\n\t\tconst deferredUpdates = {};\n\t\tfor ( const pattern of concept ) {\n\t\t\tawait setImagesInBlocks(\n\t\t\t\tpattern.blocks,\n\t\t\t\ttopic,\n\t\t\t\ttrue,\n\t\t\t\tdeferredUpdates\n\t\t\t);\n\t\t}\n\n\t\treturn deferredUpdates;\n\t};\n\n\tconst setImagesInSection = async (\n\t\tsection,\n\t\ttopic,\n\t\tselectedConcept,\n\t\tnewPage = false\n\t) => {\n\t\t// Don't set images for the team section.\n\t\tif ( [ 'team' ].includes( section.category ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( selectedConcept ) {\n\t\t\tconst selectedBlockClientId = getSelectedBlockClientId();\n\n\t\t\t// when there are multiple patterns with same category, select the one that contains the selected block id, if any\n\t\t\tconst currentPattern =\n\t\t\t\tselectedConcept.patterns.find(\n\t\t\t\t\t( pattern ) =>\n\t\t\t\t\t\tpattern.category === section.category &&\n\t\t\t\t\t\tpattern.blocks[ 0 ].clientId === selectedBlockClientId\n\t\t\t\t) ??\n\t\t\t\tselectedConcept.patterns.find(\n\t\t\t\t\t( pattern ) => pattern.category === section.category\n\t\t\t\t) ??\n\t\t\t\tsection;\n\t\t\tconst selectedSectionImages = getPatternImages(\n\t\t\t\tcurrentPattern.blocks[ 0 ],\n\t\t\t\t[]\n\t\t\t);\n\t\t\treturn updatePatternImages( section.blocks[ 0 ], {\n\t\t\t\tselectedSectionImages,\n\t\t\t\tconceptSection: true,\n\t\t\t} );\n\t\t}\n\t\tconst deferredUpdates = {};\n\n\t\tawait setImagesInBlocks(\n\t\t\tsection.blocks,\n\t\t\ttopic,\n\t\t\ttrue,\n\t\t\tdeferredUpdates,\n\t\t\tnewPage\n\t\t);\n\n\t\treturn deferredUpdates;\n\t};\n\n\tconst setMapsInSection = ( section, siteLocation ) => {\n\t\tsetMapLocationInBlocks( section.blocks, siteLocation );\n\t};\n\n\tconst setCTAInSection = async ( section, categories, pages ) => {\n\t\tif (\n\t\t\tsection?.category !== 'intro' &&\n\t\t\tsection?.category !== 'about' &&\n\t\t\tsection?.category !== 'header'\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst findButtonBlock = ( block ) => {\n\t\t\tif ( block.name === 'core/button' ) {\n\t\t\t\treturn block;\n\t\t\t}\n\n\t\t\tif ( block.innerBlocks?.length ) {\n\t\t\t\tfor ( const innerBlock of block.innerBlocks ) {\n\t\t\t\t\tconst buttonBlock = findButtonBlock( innerBlock );\n\n\t\t\t\t\tif ( buttonBlock ) {\n\t\t\t\t\t\treturn buttonBlock;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\tconst firstButtonBlock = findButtonBlock( section.blocks[ 0 ] );\n\n\t\tif ( ! firstButtonBlock ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( section?.category === 'header' ) {\n\t\t\tfirstButtonBlock.attributes.url = '/about';\n\t\t\tfirstButtonBlock.attributes.text = __( 'Learn more', 'big-sky' );\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tpages.find( ( page ) => page.slug === 'menu' ) &&\n\t\t\tsection?.category === 'intro'\n\t\t) {\n\t\t\tfirstButtonBlock.attributes.url = '/menu';\n\t\t\tfirstButtonBlock.attributes.text = __( 'View Menu', 'big-sky' );\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tpages.find( ( page ) => page.slug === 'about' ) &&\n\t\t\tsection?.category === 'about'\n\t\t) {\n\t\t\tfirstButtonBlock.attributes.url = '/about';\n\t\t\tfirstButtonBlock.attributes.text = __( 'Find out more', 'big-sky' );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( categories.find( ( cat ) => cat.slug === 'events' ) ) {\n\t\t\tfirstButtonBlock.attributes.url = '#events-section';\n\t\t\tfirstButtonBlock.attributes.text = __(\n\t\t\t\t'Upcoming Events',\n\t\t\t\t'big-sky'\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tif ( categories.find( ( cat ) => cat.slug === 'services' ) ) {\n\t\t\tfirstButtonBlock.attributes.url = '#services-section';\n\t\t\tfirstButtonBlock.attributes.text = __( 'Our Services', 'big-sky' );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( categories.find( ( cat ) => cat.slug === 'pricing' ) ) {\n\t\t\tfirstButtonBlock.attributes.url = '#pricing-section';\n\t\t\tfirstButtonBlock.attributes.text = __( 'Pricing', 'big-sky' );\n\t\t}\n\n\t\tif ( categories.find( ( cat ) => cat.slug === 'posts' ) ) {\n\t\t\tfirstButtonBlock.attributes.url = '#posts-section';\n\t\t\tfirstButtonBlock.attributes.text = __( 'Read more', 'big-sky' );\n\t\t}\n\t};\n\n\tconst setSectionInternalAnchor = ( section ) => {\n\t\tsection.blocks[ 0 ].attributes.anchor = section.category + '-section';\n\t};\n\n\tconst processTemplatePart = async ( {\n\t\ttemplatePart,\n\t\tsiteDescription,\n\t\tsiteLocation,\n\t\ttopic,\n\t\ttemplatePartBlocks,\n\t\tisQuickOnboarding,\n\t} ) => {\n\t\tif ( process.env.REPLACE_CONTENT !== 'false' ) {\n\t\t\treturn Promise.all( [\n\t\t\t\treplaceContent( {\n\t\t\t\t\tconceptSection: templatePartBlocks,\n\t\t\t\t\tsiteDescription,\n\t\t\t\t\tsectionCategory: templatePart,\n\t\t\t\t\tsiteLocation,\n\t\t\t\t} ),\n\t\t\t\ttemplatePart === 'header' &&\n\t\t\t\t\t! isQuickOnboarding &&\n\t\t\t\t\tgenerateLogoWithAI( { description: topic } ),\n\t\t\t] ).then( () => {\n\t\t\t\tsetCTAInSection( {\n\t\t\t\t\tcategory: templatePart,\n\t\t\t\t\tblocks: templatePartBlocks,\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\t};\n\n\t/**\n\t * Gets all available pattern categories.\n\t *\n\t * @return {string[]} Array of unique pattern categories.\n\t */\n\tconst getAvailablePatternCategories = () => {\n\t\tconst patterns = getRemotePatterns( userLocale );\n\t\tconst categories = new Set();\n\t\tpatterns.forEach( ( pattern ) => {\n\t\t\tcategories.add( pattern.category );\n\t\t} );\n\t\t// filter out undefined categories\n\t\treturn Array.from( categories ).filter( ( category ) => category );\n\t};\n\n\tconst composeTemplatePartPattern = ( {\n\t\ttemplatePart,\n\t\tsiteDescription,\n\t\tsiteLocation,\n\t\ttopic,\n\t\tpattern = null,\n\t\tisQuickOnboarding = false,\n\t} ) => {\n\t\tconst templatePartClientIds = getBlocksByName( 'core/template-part' );\n\n\t\tif ( ! templatePartClientIds ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst slug = templatePart === 'header' ? 'header' : 'footer';\n\n\t\tconst patterns = getRemotePatterns( userLocale );\n\t\t// if pattern is a number id, find the pattern by id\n\t\tif ( typeof pattern === 'number' ) {\n\t\t\tpattern = patterns.find( ( p ) => p.ID === pattern );\n\t\t}\n\t\tconst selectedPattern =\n\t\t\tpattern ||\n\t\t\tchoosePattern(\n\t\t\t\tfilterByCategory( {\n\t\t\t\t\tavailablePatterns: patterns,\n\t\t\t\t\tcategory: slug,\n\t\t\t\t} )\n\t\t\t);\n\n\t\tif ( selectedPattern ) {\n\t\t\tconst blocks = convertToBlocks( selectedPattern.html );\n\n\t\t\tblocks[ 0 ].attributes.metadata = {\n\t\t\t\t...blocks[ 0 ].attributes?.metadata,\n\t\t\t\tname: patternCategories.find(\n\t\t\t\t\t( category ) => category.slug === slug\n\t\t\t\t)?.title,\n\t\t\t\tpatternCategory: slug,\n\t\t\t\tremotePatternId: selectedPattern.ID,\n\t\t\t};\n\n\t\t\tconst templatePartStyleVariation =\n\t\t\t\tselectedStyleVariationSet[ slug ];\n\n\t\t\tlet className = blocks[ 0 ].attributes.className || '';\n\t\t\t// Remove any hardcoded section style classes.\n\t\t\tclassName = className.replaceAll( sectionStyleRegex, '' ).trim();\n\n\t\t\tif ( className ) {\n\t\t\t\tblocks[ 0 ].attributes.className =\n\t\t\t\t\tclassName + ` is-style-${ templatePartStyleVariation }`;\n\t\t\t} else {\n\t\t\t\tblocks[ 0 ].attributes.className = `is-style-${ templatePartStyleVariation }`;\n\t\t\t}\n\n\t\t\tconst templatePartPattern = {\n\t\t\t\tID: selectedPattern.ID,\n\t\t\t\tblocks,\n\t\t\t\tcategory: slug,\n\t\t\t\ttitle:\n\t\t\t\t\tselectedPattern.title.replace(\n\t\t\t\t\t\tnew RegExp( slug + ':', 'i' ),\n\t\t\t\t\t\t''\n\t\t\t\t\t) +\n\t\t\t\t\t' (' +\n\t\t\t\t\tselectedPattern.ID +\n\t\t\t\t\t')',\n\t\t\t};\n\n\t\t\treturn {\n\t\t\t\tpattern: templatePartPattern,\n\t\t\t\tresolver: processTemplatePart( {\n\t\t\t\t\ttemplatePart,\n\t\t\t\t\tsiteDescription,\n\t\t\t\t\tsiteLocation,\n\t\t\t\t\ttopic,\n\t\t\t\t\ttemplatePartBlocks: blocks,\n\t\t\t\t\tisQuickOnboarding,\n\t\t\t\t} ),\n\t\t\t};\n\t\t}\n\t};\n\n\tconst createConceptFromCurrentCanvas = () => {\n\t\tconst blocks = getRootBlocksOfPostContent();\n\n\t\tconst _patterns = blocks.map( ( block ) => {\n\t\t\tconst patternCategory = getPatternCategory( block.clientId );\n\t\t\tconst pattern = getPatternById(\n\t\t\t\tblock.attributes?.metadata?.remotePatternId\n\t\t\t);\n\n\t\t\treturn {\n\t\t\t\tID: pattern?.ID,\n\t\t\t\tcategory: patternCategory,\n\t\t\t\ttitle: pattern?.title,\n\t\t\t\tblocks: [ block ],\n\t\t\t};\n\t\t} );\n\n\t\treturn {\n\t\t\tid: uuidv4(),\n\t\t\tpatterns: _patterns,\n\t\t\tresolvers: [],\n\t\t};\n\t};\n\n\tconst createConceptFromSelectedBlock = ( clientId ) => {\n\t\tconst selectedBlockClientId = clientId || getSelectedBlockClientId();\n\n\t\tconst block = getBlock( selectedBlockClientId );\n\t\tconst patternCategory = getParentPatternCategory( block );\n\t\tconst pattern = getPatternById(\n\t\t\tgetBlock( block.clientId ).attributes?.metadata.remotePatternId\n\t\t);\n\n\t\tconst patternData = {\n\t\t\tID: pattern.ID,\n\t\t\tcategory: patternCategory,\n\t\t\ttitle: pattern.title,\n\t\t\tblocks: [ block ],\n\t\t};\n\n\t\treturn {\n\t\t\tid: uuidv4(),\n\t\t\tpatterns: [ patternData ],\n\t\t\tresolvers: [],\n\t\t};\n\t};\n\n\tconst createConceptFromHTML = ( html, patternCategory ) => {\n\t\tconst blocks = convertToBlocks( html );\n\t\tconst validatedPattern = fixInvalidBlock( blocks[ 0 ] );\n\n\t\tconst patternData = {\n\t\t\tID: uuidv4(),\n\t\t\tcategory: patternCategory,\n\t\t\ttitle: __( 'Generated Pattern', 'big-sky' ),\n\t\t\tblocks: [ validatedPattern ],\n\t\t};\n\n\t\treturn {\n\t\t\tid: uuidv4(),\n\t\t\tpatterns: [ patternData ],\n\t\t\tresolvers: [],\n\t\t};\n\t};\n\n\tconst getPattern = ( category ) => {\n\t\tif ( [ 'header', 'footer' ].includes( category ) ) {\n\t\t\treturn getBlock( getTemplatePartClientID( category ) );\n\t\t}\n\n\t\tconst rootBlocks = getRootBlocksOfPostContent();\n\t\treturn rootBlocks.find(\n\t\t\t( block ) => getPatternCategory( block.clientId ) === category\n\t\t);\n\t};\n\n\tconst getComponent = ( key, category, startBlock = null ) => {\n\t\tconst findBlock = ( block ) => {\n\t\t\tif ( ! block ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif ( block.attributes?.metadata?.name === key ) {\n\t\t\t\treturn block;\n\t\t\t}\n\n\t\t\tfor ( const innerBlock of block.innerBlocks ) {\n\t\t\t\tconst result = findBlock( innerBlock );\n\t\t\t\tif ( result ) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t};\n\n\t\treturn findBlock( startBlock || getPattern( category ) );\n\t};\n\n\tconst getSections = ( category, block ) =>\n\t\tgetComponent( SECTIONS_KEY, category, block );\n\tconst getSection = ( category, block ) =>\n\t\tgetComponent( SECTION_KEY, category, block || getSections( category ) );\n\tconst getItems = ( category, block ) =>\n\t\tgetComponent( ITEMS_KEY, category, block || getSection( category ) );\n\tconst getItem = ( category, block ) =>\n\t\tgetComponent( ITEM_KEY, category, block || getItems( category ) );\n\n\tuseEffect( () => {\n\t\tif ( isAfterSave ) {\n\t\t\tsyncSiteMetadataPatterns( { persist: true } );\n\t\t}\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ isAfterSave ] );\n\n\treturn {\n\t\tDEFAULT_NUM_CONCEPTS,\n\t\tITEM_KEY,\n\t\tITEMS_KEY,\n\t\tSECTION_KEY,\n\t\tSECTIONS_KEY,\n\t\tinsertPattern,\n\t\tinsertPatterns,\n\t\treplacePattern,\n\t\tfilterByCategory,\n\t\tconvertToBlocks,\n\t\tcomposePatterns,\n\t\tcomposeTemplatePartPattern,\n\t\tsetImagesInConcept,\n\t\tsetImagesInSection,\n\t\tgetRootBlocksOfPostContent,\n\t\tinitializePattern,\n\t\tgetOtherPatternsInCategory,\n\t\tgetPatternCategory,\n\t\tgetParentPatternCategory,\n\t\tgetPatternById,\n\t\tcreateConceptFromCurrentCanvas,\n\t\tcreateConceptFromSelectedBlock,\n\t\tcreateConceptFromHTML,\n\t\tsetDefaultEditMode,\n\t\tgetAvailablePatternCategories,\n\t\tgetPattern,\n\t\tgetSections,\n\t\tgetSection,\n\t\tgetItems,\n\t\tgetItem,\n\t\treplaceTemplatePart,\n\t\tsyncSiteMetadataPatterns,\n\t\tsetCTAInSection,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { store as editorStore } from '@wordpress/editor';\nimport { useMemo } from '@wordpress/element';\nimport { store as coreStore } from '@wordpress/core-data';\n\nexport default function useIsHomePage() {\n\tconst { homePageId } = useSelect(\n\t\t( select ) => ( {\n\t\t\thomePageId: select( coreStore ).getEntityRecord( 'root', 'site' )\n\t\t\t\t?.page_on_front,\n\t\t} ),\n\t\t[]\n\t);\n\n\tconst { currentPostId } = useSelect( ( select ) => ( {\n\t\tcurrentPostId: select( editorStore ).getCurrentPostId(),\n\t} ) );\n\n\tconst isHomePage = useMemo( () => {\n\t\treturn currentPostId === homePageId;\n\t}, [ currentPostId, homePageId ] );\n\n\treturn isHomePage;\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as editorStore } from '@wordpress/editor';\nimport { useCallback } from '@wordpress/element';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { privateApis as routerPrivateApis } from '@wordpress/router';\nimport { serialize } from '@wordpress/blocks';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport useCanvas from '@hooks/use-canvas';\nimport usePatterns from '@hooks/use-patterns';\nimport { getCanvasIframeElements } from '@utils/canvas-iframe-elements';\nimport { unlock } from '@utils/lock-unlock';\nimport setDelay from '@utils/set-delay';\nimport log from '@utils/log-debug.js';\nimport { store as aiStore } from '@store';\n\nconst { useHistory } = unlock( routerPrivateApis );\nconst emptyArray = [];\nexport default function usePages() {\n\tconst { pages, homePageId, getEntityRecords } = useSelect(\n\t\t( select ) => ( {\n\t\t\tpages:\n\t\t\t\tselect( coreStore ).getEntityRecords( 'postType', 'page', {\n\t\t\t\t\tper_page: -1,\n\t\t\t\t\tstatus: 'publish,future,draft,pending,private',\n\t\t\t\t} ) || emptyArray,\n\t\t\thomePageId: select( coreStore ).getEntityRecord( 'root', 'site' )\n\t\t\t\t?.page_on_front,\n\t\t\tgetEntityRecords: select( coreStore ).getEntityRecords,\n\t\t} ),\n\t\t[]\n\t);\n\n\tconst { saveEntityRecord, deleteEntityRecord } = useDispatch( coreStore );\n\n\tconst deleteAllPagesExceptHome = useCallback( async () => {\n\t\tconst allPages = getEntityRecords( 'postType', 'page', {\n\t\t\tper_page: -1,\n\t\t\tstatus: 'publish,future,draft,pending,private',\n\t\t} );\n\n\t\tif ( ! allPages ) return;\n\n\t\tconst deletePromises = allPages\n\t\t\t.filter( ( page ) => page.id !== homePageId ) // Exclude home page\n\t\t\t.map( ( page ) =>\n\t\t\t\tdeleteEntityRecord( 'postType', 'page', page.id, {\n\t\t\t\t\tforce: true,\n\t\t\t\t} )\n\t\t\t);\n\n\t\tawait Promise.all( deletePromises );\n\t}, [ homePageId, deleteEntityRecord, getEntityRecords ] );\n\n\tconst { currentPostId, getCurrentPostId } = useSelect( ( select ) => ( {\n\t\tcurrentPostId: select( editorStore ).getCurrentPostId(),\n\t\tgetCurrentPostId: select( editorStore ).getCurrentPostId,\n\t} ) );\n\n\tconst { isComingSoon, isBlogPrivate } = useSelect( ( select ) => ( {\n\t\tisComingSoon: select( aiStore ).getIsComingSoon(),\n\t\tisBlogPrivate: select( aiStore ).getIsBlogPrivate(),\n\t} ) );\n\n\tconst isSitePublished = ! isComingSoon && ! isBlogPrivate;\n\n\tconst history = useHistory();\n\tconst { addPatternsToCanvas } = useCanvas();\n\tconst { composePatterns, syncSiteMetadataPatterns } = usePatterns();\n\n\tconst { savePost } = useDispatch( editorStore );\n\n\tconst goToPage = ( { postId, postType } = {} ) => {\n\t\tif ( ! postId ) {\n\t\t\t// redirect to homepage\n\t\t\tif ( history.navigate ) {\n\t\t\t\thistory.navigate( `/wp-admin/site-editor.php?p=/&canvas=edit` );\n\t\t\t} else {\n\t\t\t\thistory.push( {\n\t\t\t\t\tcanvas: 'edit',\n\t\t\t\t} );\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif ( history.navigate ) {\n\t\t\thistory.navigate(\n\t\t\t\t`/wp-admin/site-editor.php?p=/page/${ postId }&canvas=edit`\n\t\t\t);\n\t\t} else {\n\t\t\thistory.push( {\n\t\t\t\tpostId,\n\t\t\t\tpostType,\n\t\t\t\tcanvas: 'edit',\n\t\t\t} );\n\t\t}\n\t};\n\tconst isPagePublished = () => {\n\t\t// check if this is a development environment\n\t\tif ( process.env.NODE_ENV === 'development' ) {\n\t\t\treturn 'publish';\n\t\t}\n\t\treturn isSitePublished ? 'draft' : 'publish';\n\t};\n\n\tconst createPage = async (\n\t\ttitle,\n\t\tcategories,\n\t\ttopic,\n\t\tsiteDescription,\n\t\tsiteLocation,\n\t\tloadInEditor = false,\n\t\tmenuOrder = 1, // increment this for each new page, 0 is the homepage by default\n\t\texistingPageId = null, // New parameter to handle updating existing pages\n\t\tpageDescription = null,\n\t\tslug = null\n\t) => {\n\t\ttry {\n\t\t\tif ( loadInEditor ) {\n\t\t\t\tconst { canvasiFrameBody } = getCanvasIframeElements();\n\t\t\t\tcanvasiFrameBody.classList.add( 'big-sky__is-creating-page' );\n\n\t\t\t\tconst newPage = await saveEntityRecord(\n\t\t\t\t\t'postType',\n\t\t\t\t\t'page',\n\t\t\t\t\t{\n\t\t\t\t\t\tstatus: isPagePublished(),\n\t\t\t\t\t\ttitle,\n\t\t\t\t\t\tslug: slug || title || __( 'No title', 'big-sky' ),\n\t\t\t\t\t},\n\t\t\t\t\t{ throwOnError: true }\n\t\t\t\t);\n\n\t\t\t\tgoToPage( { postId: newPage.id, postType: newPage.type } );\n\t\t\t\tawait setDelay( 3000 );\n\n\t\t\t\tconst concepts = composePatterns( {\n\t\t\t\t\ttitle,\n\t\t\t\t\tcategories,\n\t\t\t\t\ttopic,\n\t\t\t\t\tsiteDescription,\n\t\t\t\t\tsiteLocation,\n\t\t\t\t\tnumberOfConcepts: 1,\n\t\t\t\t\tnewPage: true,\n\t\t\t\t\tnoCache: true,\n\t\t\t\t\tpageSlug: slug,\n\t\t\t\t} );\n\n\t\t\t\tconst conceptPatternsAndResolvers = concepts[ 0 ].patterns.map(\n\t\t\t\t\t( pattern, i ) => ( {\n\t\t\t\t\t\tpattern,\n\t\t\t\t\t\tresolver: concepts[ 0 ].resolvers[ i ].resolver,\n\t\t\t\t\t} )\n\t\t\t\t);\n\t\t\t\tcanvasiFrameBody.classList.remove(\n\t\t\t\t\t'big-sky__is-creating-page'\n\t\t\t\t);\n\t\t\t\tawait addPatternsToCanvas( conceptPatternsAndResolvers, false );\n\t\t\t\treturn newPage;\n\t\t\t}\n\n\t\t\tconst concepts = composePatterns( {\n\t\t\t\ttitle,\n\t\t\t\tcategories,\n\t\t\t\ttopic,\n\t\t\t\tsiteDescription,\n\t\t\t\tsiteLocation,\n\t\t\t\tnumberOfConcepts: 1,\n\t\t\t\tnewPage: true,\n\t\t\t\tnoCache: true,\n\t\t\t\tpageDescription,\n\t\t\t\tpageSlug: slug,\n\t\t\t} );\n\t\t\tconst resolvers = concepts[ 0 ].resolvers\n\t\t\t\t.map( ( resolver ) => resolver.resolver )\n\t\t\t\t.flat();\n\n\t\t\tawait Promise.all( resolvers );\n\t\t\tconst rootBlocks = concepts[ 0 ].patterns\n\t\t\t\t.map( ( pattern ) => pattern.blocks )\n\t\t\t\t.flat();\n\t\t\tconst pageContent = serialize( rootBlocks );\n\n\t\t\tconst pageData = {\n\t\t\t\tstatus: isPagePublished(),\n\t\t\t\ttitle,\n\t\t\t\tcontent: pageContent,\n\t\t\t\tslug: slug || title || __( 'No title', 'big-sky' ),\n\t\t\t\tmenu_order: menuOrder,\n\t\t\t};\n\n\t\t\t// If we have an existing page ID, update it instead of creating a new one\n\t\t\tconst newPage = await saveEntityRecord(\n\t\t\t\t'postType',\n\t\t\t\t'page',\n\t\t\t\texistingPageId ? { ...pageData, id: existingPageId } : pageData,\n\t\t\t\t{ throwOnError: true }\n\t\t\t);\n\t\t\treturn { newPage, rootBlocks };\n\t\t} catch ( error ) {\n\t\t\tlog.error( error );\n\t\t}\n\t};\n\n\tconst saveAndGoToPage = async ( pageId, goHome ) => {\n\t\tsyncSiteMetadataPatterns( {\n\t\t\tids: [ getCurrentPostId() ],\n\t\t\tpersist: true,\n\t\t} );\n\t\tawait savePost( getCurrentPostId() );\n\t\tif ( goHome ) {\n\t\t\tgoToPage( { postId: null, postType: null } );\n\t\t\treturn;\n\t\t}\n\n\t\tgoToPage( { postId: pageId, postType: 'page' } );\n\t};\n\n\tconst getPages = useCallback( () => {\n\t\treturn ( pages || [] )\n\t\t\t.filter( ( page ) => page.title.rendered.trim() !== '' )\n\t\t\t.map( ( page ) => ( {\n\t\t\t\tid: page.id,\n\t\t\t\tslug: page.slug,\n\t\t\t\ttitle: page.title.rendered,\n\t\t\t\tstatus: page.status,\n\t\t\t\tisHomePage: page.id === homePageId,\n\t\t\t\tisCurrentPage: page.id === currentPostId,\n\t\t\t} ) );\n\t}, [ pages, homePageId, currentPostId ] );\n\n\tconst deletePage = useCallback(\n\t\tasync ( pageId ) => {\n\t\t\ttry {\n\t\t\t\tawait deleteEntityRecord( 'postType', 'page', pageId, {\n\t\t\t\t\tforce: true,\n\t\t\t\t} );\n\t\t\t\treturn true;\n\t\t\t} catch ( error ) {\n\t\t\t\tlog.error( error );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\t[ deleteEntityRecord ]\n\t);\n\t// go back to the previous page\n\tconst goBackPage = useCallback( () => {\n\t\thistory.back();\n\t}, [ history ] );\n\n\treturn {\n\t\tcreatePage,\n\t\tdeletePage,\n\t\tdeleteAllPagesExceptHome,\n\t\tgetPages,\n\t\tgoToPage,\n\t\tsaveAndGoToPage,\n\t\tgoBackPage,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { store as editorStore } from '@wordpress/editor';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport { store as aiStore } from '@store';\nimport useStyles from '@hooks/use-styles';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport { deleteDummyPosts } from '@utils/dummy-posts';\nimport { defaultSiteMetadata } from '@utils/constants';\nimport usePages from '@hooks/use-pages';\nimport useCanvas from '@hooks/use-canvas';\nimport { useChat } from '@automattic/big-sky-agents';\nimport { ASSISTANTS } from '@ai/assistants/constants';\n\nexport default function useResetSite() {\n\tconst { getCurrentPostId } = useSelect( editorStore );\n\tconst { savePost } = useDispatch( editorStore );\n\tconst { saveEntityRecord } = useDispatch( coreStore );\n\tconst { resetStyles } = useStyles();\n\tconst { setSiteMetadata } = useSiteMetadata();\n\tconst { homePageId, deleteAllPagesExceptHome } = usePages();\n\tconst { clearBlocks } = useCanvas();\n\tconst { clearMessages, agentSay } = useChat();\n\tconst {\n\t\tclearSelectedSectionContent,\n\t\tresetCachedContent,\n\t\tsetShowThread,\n\t\tsetIsHandoff,\n\t\tsetAssistant,\n\t\tsetHandoffStep,\n\t} = useDispatch( aiStore );\n\n\tconst resetSite = async () => {\n\t\tconst currentPostId = getCurrentPostId();\n\n\t\tdeleteDummyPosts();\n\t\tdeleteAllPagesExceptHome();\n\t\tresetStyles();\n\t\tsetSiteMetadata( { ...defaultSiteMetadata }, true );\n\t\tresetCachedContent();\n\t\tclearSelectedSectionContent();\n\t\tsetIsHandoff( false );\n\t\tsetHandoffStep( 0 );\n\t\t// also clear siteMeta and buildDesigns from local storage\n\t\t// eslint-disable-next-line no-undef\n\t\tlocalStorage.removeItem( 'siteMeta' );\n\t\t// eslint-disable-next-line no-undef\n\t\tlocalStorage.removeItem( 'buildDesigns' );\n\t\tclearMessages();\n\t\tif ( homePageId !== currentPostId ) {\n\t\t\tawait savePost(); //save the current post to prevent user getting a second confirmation.\n\t\t\t// If not on the front page, clear the content of the front page.\n\t\t\tsaveEntityRecord( 'postType', 'page', {\n\t\t\t\tid: homePageId,\n\t\t\t\tcontent: '',\n\t\t\t} );\n\n\t\t\twindow.location.href = `/wp-admin/site-editor.php?canvas=edit`;\n\t\t\treturn;\n\t\t}\n\t\tawait clearBlocks(); //saveEntityRecord doen't seem to work if on the current page so clear the blocks instead.\n\t\tawait savePost();\n\t};\n\n\tconst buildNewSite = () => {\n\t\tclearMessages();\n\t\tsetIsHandoff( false );\n\t\tsetShowThread( true );\n\t\tsetAssistant( ASSISTANTS.SPEC );\n\t\tagentSay(\n\t\t\t__(\n\t\t\t\t'Here are your current site specifications. Would you like to modify them or start over?',\n\t\t\t\t'big-sky'\n\t\t\t)\n\t\t);\n\t};\n\n\treturn {\n\t\tresetSite,\n\t\tbuildNewSite,\n\t};\n}\n","import { useCallback } from '@wordpress/element';\nimport log from '@utils/log-debug';\nimport apiFetch from '@wordpress/api-fetch';\n\nconst cachedCoordinates = {};\nexport default function useGeocoder() {\n\tconst getCoordinates = useCallback( async ( locationName ) => {\n\t\tif ( ! cachedCoordinates[ locationName ] ) {\n\t\t\tlet data;\n\t\t\ttry {\n\t\t\t\tdata = await apiFetch( {\n\t\t\t\t\tpath:\n\t\t\t\t\t\t'/wpcom/v2/big-sky/v1/geo-coordinates?address=' +\n\t\t\t\t\t\tencodeURIComponent( locationName ),\n\t\t\t\t\tmethod: 'GET',\n\t\t\t\t} );\n\t\t\t\tlog.info( 'Geocode Response', data );\n\t\t\t} catch ( e ) {\n\t\t\t\tlog.error( 'Geocode Error', e );\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst coordinates = data?.features?.[ 0 ]?.geometry?.coordinates;\n\t\t\t// Mapbox returns coordinates in [longitude, latitude] format\n\t\t\t// but we need it in [latitude, longitude] format\n\t\t\tcachedCoordinates[ locationName ] = coordinates\n\t\t\t\t? coordinates.reverse()\n\t\t\t\t: coordinates;\n\t\t}\n\n\t\treturn cachedCoordinates[ locationName ];\n\t}, [] );\n\n\treturn {\n\t\tgetCoordinates,\n\t};\n}\n","/**\n * External dependencies\n */\nimport { systemPromptTemplate } from '@ai/system-prompt-template.js';\n\nexport default function getSiteDesignSystemPrompt(\n\tsiteMeta,\n\tcolorsString,\n\tfontsString\n) {\n\tconst {\n\t\tsiteType,\n\t\ttopic,\n\t\tsiteDescription,\n\t\tsiteTitle,\n\t\tsiteLocation,\n\t\tcolorRequest,\n\t} = siteMeta;\n\treturn systemPromptTemplate.format( {\n\t\trole: 'You are a website designer and an expert at taking site specifications and choosing suitable colors and fonts that align with industry standards and brand identity.',\n\n\t\tcontext: ` Current site specifications:\n${ JSON.stringify( {\n\tsiteType,\n\ttopic,\n\tsiteDescription,\n\tsiteTitle,\n\tsiteLocation,\n\tuserColorRequest: colorRequest,\n} ) }\nAvailable built-in colors:\n${ colorsString }\nAvailable fonts:\n${ fontsString } `,\n\n\t\tdo: [\n\t\t\t'Choose the best colors and fonts for the website based on the website specifications and the available options.',\n\t\t\t'Consider industry standards, brand identity, and user experience when selecting colors and fonts.',\n\t\t\t'Always use your best guess to choose the right colors and fonts for the website based on the website description. Do not ask the user questions or for more information.',\n\t\t\t'Always choose a MINIMUM of six color palettes.',\n\t\t\t'Always choose a MINIMUM of three font typesets.',\n\t\t\t'Always sort the chosen color palettes starting from best match and put all chosen colors in the colors array.',\n\t\t\t'Always sort the chosen font typesets starting from best match and put all chosen fonts in the fonts array.',\n\t\t\t'Always call the getBuildDesigns tool. The content of your message should be null.',\n\t\t],\n\n\t\tdont: [\n\t\t\t'Explain your choices to the user.',\n\t\t\t'Ask the user to confirm your choices',\n\t\t],\n\t} );\n}\n","const createGetBuildDesignsTool = (\n\tcolors,\n\tfonts,\n\tadditionalProperties = {}\n) => {\n\treturn {\n\t\tname: 'getBuildDesigns',\n\t\tdescription: 'Sets site color palettes and font typeset.',\n\t\tstrict: true,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\t...{\n\t\t\t\t\t// We want to inject enums for colors and fonts to make sure they are not hallucinated.\n\t\t\t\t\tcolors: {\n\t\t\t\t\t\ttype: 'array',\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t'The list of color palette names that best match the site',\n\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\tenum: colors,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tfonts: {\n\t\t\t\t\t\ttype: 'array',\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t'The list of font typeset names that best match the site',\n\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\tenum: fonts,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t...additionalProperties,\n\t\t\t},\n\t\t\trequired: [\n\t\t\t\t'colors',\n\t\t\t\t'fonts',\n\t\t\t\t...Object.keys( additionalProperties ),\n\t\t\t],\n\t\t\tadditionalProperties: false,\n\t\t},\n\t};\n};\n\nexport default createGetBuildDesignsTool;\n","const createColorPaletteGeneratorTool = ( keywords = [] ) => {\n\treturn {\n\t\tname: 'color_palette_generator',\n\t\tdescription: `If one or more specific colors (names or hex values) are provided, these must be represented in the 'custom_colors' property.\n\t\tDo not ask the user to specify a specfic shade of the color requested, just return the color(s) as is.\n\t\tIf a keyword is provided that matches, or is a synonym of, one of the keywords in the 'keywords' enum return the enum keyword in the 'keyword' property.`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tcolors: {\n\t\t\t\t\ttype: [ 'array', 'null' ],\n\t\t\t\t\tdescription: 'The requested color(s).',\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t'A color name. Default to null if not supplied in the user request.',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tkeyword: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription: `The requested category of the color palette. Default to null if not supplied in the user request.`,\n\t\t\t\t\tenum: keywords,\n\t\t\t\t},\n\t\t\t\tcustom_colors: {\n\t\t\t\t\ttype: [ 'object' ],\n\t\t\t\t\tdescription: `An object containing a custom color palette of 4 colors, expressed as color1.color through color4.color.\n\t\t\t\t\t\tAlways provide custom colors, matching the user query as best as you can.\n\t\t\t\t\t\tUse colors that are modern/trending colors for web design.\n\t\t\t\t\t\tEach color property must be unique and contain a hex color value.\n\t\t\t\t\t`,\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tcolor1: {\n\t\t\t\t\t\t\ttype: [ 'object' ],\n\t\t\t\t\t\t\tdescription: `\n\t\t\t\t\t\t\t\t- the main color used for backgrounds\n\t\t\t\t\t\t\t\t- if possible, make a choice from the colors provided\n\t\t\t\t\t\t\t\t- if there are no more colors to choose from, generate a new color\n\t\t\t\t\t\t\t\t- must never be the same as color4\n\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tcolor: {\n\t\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\t\tdescription: 'The hex color value.',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuser_requested: {\n\t\t\t\t\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t'Whether the user requested this color.',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [ 'color', 'user_requested' ],\n\t\t\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcolor2: {\n\t\t\t\t\t\t\ttype: [ 'object' ],\n\t\t\t\t\t\t\tdescription: `\n\t\t\t\t\t\t\t\t- the main color used for text\n\t\t\t\t\t\t\t\t- must contrast at a minimum ratio of 4.5:1 with color1\n\t\t\t\t\t\t\t\t- if possible, make a choice from the colors provided\n\t\t\t\t\t\t\t\t- if there are no more colors to choose from, generate a new color\n\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tcolor: {\n\t\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\t\tdescription: 'The hex color value.',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuser_requested: {\n\t\t\t\t\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t'Whether the user requested this color.',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [ 'color', 'user_requested' ],\n\t\t\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcolor3: {\n\t\t\t\t\t\t\ttype: [ 'object' ],\n\t\t\t\t\t\t\tdescription: `\n\t\t\t\t\t\t\t\t- the main color used for buttons\n\t\t\t\t\t\t\t\t- if possible, make a choice from the colors provided\n\t\t\t\t\t\t\t\t- if there are no more remaining colors, generate a new color\n\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tcolor: {\n\t\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\t\tdescription: 'The hex color value.',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuser_requested: {\n\t\t\t\t\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t'Whether the user requested this color.',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [ 'color', 'user_requested' ],\n\t\t\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcolor4: {\n\t\t\t\t\t\t\ttype: [ 'object' ],\n\t\t\t\t\t\t\tdescription: `\n\t\t\t\t\t\t\t\t- the main color used for button text\n\t\t\t\t\t\t\t\t- if possible, make a choice from the colors provided\n\t\t\t\t\t\t\t\t- if there are no more colors to choose from, generate a new color\n\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tcolor: {\n\t\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\t\tdescription: 'The hex color value.',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuser_requested: {\n\t\t\t\t\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t'Whether the user requested this color.',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trequired: [ 'color', 'user_requested' ],\n\t\t\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\trequired: [ 'color1', 'color2', 'color3', 'color4' ],\n\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'colors', 'keyword', 'custom_colors' ],\n\t\t\tadditionalProperties: false,\n\t\t},\n\t\tstrict: true,\n\t};\n};\n\nexport default createColorPaletteGeneratorTool;\n","/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\n\n// Initially just starting with about, contact for most sites and also menu for food and beverage sites.\n// This will be expanded on over time as we get a better understanding of user needs.\nexport const pageNames = {\n\tabout: __( 'About', 'big-sky' ),\n\tcontact: __( 'Contact', 'big-sky' ),\n\tmenu: __( 'Menu', 'big-sky' ),\n};\n\nexport const pageDefinitions = {\n\tabout: {\n\t\tslug: 'about',\n\t\tpageName: pageNames.about,\n\t\tsections: [\n\t\t\t{\n\t\t\t\tslug: 'about',\n\t\t\t\treason: 'General information about the site owner or business. Main heading should be same as page title.',\n\t\t\t},\n\t\t],\n\t},\n\tcontact: {\n\t\tslug: 'contact',\n\t\tpageName: pageNames.contact,\n\t\tsections: [\n\t\t\t{\n\t\t\t\tslug: 'contact',\n\t\t\t\treason: 'Contact form and contact information.',\n\t\t\t},\n\t\t],\n\t},\n\tmenu: {\n\t\tslug: 'menu',\n\t\tpageName: pageNames.menu,\n\t\tsections: [\n\t\t\t{\n\t\t\t\tslug: 'menu',\n\t\t\t\treason: 'Full menu listing.',\n\t\t\t},\n\t\t],\n\t},\n};\n\nexport const pagesBySlug = Object.keys( pageDefinitions ).reduce(\n\t( acc, key ) => {\n\t\tacc[ pageDefinitions[ key ].slug ] = pageDefinitions[ key ];\n\t\treturn acc;\n\t},\n\t{}\n);\n","/**\n * Internal dependencies\n */\nimport { patternsBySlug } from './pattern-categories.js';\nimport { pagesBySlug } from './page-definitions.js';\n\nexport const blog = {\n\thomepageSections: {\n\t\trequired: [\n\t\t\tpatternsBySlug.intro,\n\t\t\tpatternsBySlug.posts,\n\t\t\tpatternsBySlug.newsletter,\n\t\t],\n\t\toptional: [],\n\t},\n\tsubPages: {\n\t\trequired: [ pagesBySlug.about, pagesBySlug.contact ],\n\t\toptional: [],\n\t},\n};\n\nexport const business = {\n\thomepageSections: {\n\t\trequired: [ patternsBySlug.intro, patternsBySlug.about ],\n\t\toptional: [\n\t\t\tpatternsBySlug.services,\n\t\t\tpatternsBySlug.pricing,\n\t\t\tpatternsBySlug.events,\n\t\t\tpatternsBySlug.testimonials,\n\t\t\tpatternsBySlug.gallery,\n\t\t],\n\t},\n\tsubPages: {\n\t\trequired: [ pagesBySlug.about, pagesBySlug.contact ],\n\t\toptional: [],\n\t},\n};\n\nexport const foodAndBeverage = {\n\thomepageSections: {\n\t\trequired: [ patternsBySlug.intro, pagesBySlug.about ],\n\t\toptional: [ patternsBySlug.gallery, patternsBySlug.testimonials ],\n\t},\n\tsubPages: {\n\t\trequired: [ pagesBySlug.about, pagesBySlug.menu, pagesBySlug.contact ],\n\t\toptional: [],\n\t},\n};\n\nexport const personal = {\n\thomepageSections: {\n\t\trequired: [\n\t\t\tpatternsBySlug.intro,\n\t\t\tpatternsBySlug.about,\n\t\t\tpatternsBySlug.gallery,\n\t\t],\n\t\toptional: [],\n\t},\n\tsubPages: {\n\t\trequired: [ pagesBySlug.about, pagesBySlug.contact ],\n\t\toptional: [],\n\t},\n};\n\nexport const portfolio = {\n\thomepageSections: {\n\t\trequired: [\n\t\t\tpatternsBySlug.intro,\n\t\t\tpatternsBySlug.about,\n\t\t\tpatternsBySlug.gallery,\n\t\t],\n\t\toptional: [ patternsBySlug.testimonials ],\n\t},\n\tsubPages: {\n\t\trequired: [ pagesBySlug.about, pagesBySlug.contact ],\n\t\toptional: [],\n\t},\n};\n\nconst templates = {\n\tbusiness,\n\tfoodAndBeverage,\n\tportfolio,\n\tblog,\n\tpersonal,\n};\n\nexport const getBaseTemplate = ( siteType, siteGoals = [] ) => {\n\tconst template = templates[ siteType ] || templates.business;\n\t// force a newsletter pattern if the site goals include newsletter\n\tif (\n\t\tArray.isArray( siteGoals ) &&\n\t\tsiteGoals.includes( 'newsletter' ) &&\n\t\t! template.homepageSections.required.includes(\n\t\t\tpatternsBySlug.newsletter\n\t\t)\n\t) {\n\t\ttemplate.homepageSections.required.push( patternsBySlug.newsletter );\n\t}\n\n\treturn template;\n};\n","/**\n * External dependencies\n */\nimport { systemPromptTemplate } from '@ai/system-prompt-template.js';\nimport { getBaseTemplate } from '@data/site-structure-templates.js';\n\nconst getModelPageData = ( siteTemplate ) => {\n\tconst { required = [], optional = [] } = siteTemplate.subPages;\n\n\treturn {\n\t\trequired: required.map( ( page ) => ( {\n\t\t\tslug: page.slug,\n\t\t\tname: page.pageName,\n\t\t} ) ),\n\t\toptional: optional.map( ( page ) => ( {\n\t\t\tslug: page.slug,\n\t\t\tname: page.pageName,\n\t\t} ) ),\n\t};\n};\n\nexport default function getSiteStructureSystemPrompt( siteMeta, siteGoals ) {\n\tconst { siteType, topic, siteDescription, siteTitle, siteLocation } =\n\t\tsiteMeta;\n\n\tconst baseTemplate = getBaseTemplate( siteType, siteGoals );\n\tconst requiredSections = baseTemplate.homepageSections.required.map(\n\t\t( s ) => ( {\n\t\t\tslug: s.slug,\n\t\t\ttitle: s.title,\n\t\t\tdescription: s.description,\n\t\t} )\n\t);\n\tconst optionalSections = baseTemplate.homepageSections.optional.map(\n\t\t( s ) => ( {\n\t\t\tslug: s.slug,\n\t\t\ttitle: s.title,\n\t\t\tdescription: s.description,\n\t\t} )\n\t);\n\tconst pageData = getModelPageData( baseTemplate );\n\n\treturn systemPromptTemplate.format( {\n\t\trole: 'You are a website architecture expert who specializes in determining which website sections and pages would benefit specific site types and crafting compelling reasons for section inclusion based on the site context.',\n\n\t\tcontext: `Current site specifications:\n${ JSON.stringify( {\n\tsiteType,\n\ttopic,\n\tsiteDescription,\n\tsiteTitle,\n\tsiteLocation,\n} ) }\n\nRequired homepage sections (must be included in your response):\n${ JSON.stringify( requiredSections, null, 2 ) }\n\nAvailable optional sections (include only those that would benefit this site):\n${ JSON.stringify( optionalSections, null, 2 ) }\n\nPages information:\n${ JSON.stringify( pageData, null, 2 ) }`,\n\n\t\tdo: [\n\t\t\t'Return an array of sections that includes ALL required sections plus any beneficial optional sections.',\n\t\t\t'For each section, provide a specific reason for including it that relates to the site specifications.',\n\t\t\t'Think about how sections work together to create a cohesive user experience.',\n\t\t\t'Consider industry standards and user expectations.',\n\t\t\t'Return an array of pages that includes ALL required pages with potentially customized names, and a description of the page content.',\n\t\t\t'Include any optional pages that would benefit this site also with potentially customized names, and a description of the page content.',\n\t\t\t'Customize a page name if you think there is a more relevant name in this sites context that still maintains the core purpose indicated by the original page name.',\n\t\t\t'Keep any customized page names concise and under 15 characters.',\n\t\t\t'Always call getSiteStructure, and leave your message as null.',\n\t\t],\n\n\t\tdont: [\n\t\t\t'Skip any required sections or pages.',\n\t\t\t'Include sections not listed in required or optional lists.',\n\t\t\t'Include pages not listed in required or optional lists.',\n\t\t\t'Make assumptions about site specifications not provided.',\n\t\t\t'Ask questions or request more information.',\n\t\t\t'Add any additional fields or explanations to the response.',\n\t\t],\n\t} );\n}\n","/**\n * Internal dependencies\n */\nimport { getBaseTemplate } from '@data/site-structure-templates.js';\n\nconst createGetSiteStructureTool = ( siteType, siteGoals ) => {\n\t// Get the business template as default to determine available sections and pages\n\tconst baseTemplate = getBaseTemplate( siteType, siteGoals );\n\n\t// Build the parameters object\n\tconst parameters = {\n\t\ttype: 'object',\n\t\tproperties: {\n\t\t\tsections: {\n\t\t\t\ttype: 'array',\n\t\t\t\tdescription:\n\t\t\t\t\t'Array of sections to include in the homepage, with reasons for their inclusion',\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'object',\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tslug: {\n\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\tdescription: 'The slug of the section',\n\t\t\t\t\t\t},\n\t\t\t\t\t\treason: {\n\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t'The reason for including this section based on the site specifications',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\trequired: [ 'slug', 'reason' ],\n\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t},\n\t\t\t\tminItems: baseTemplate.homepageSections.required.length,\n\t\t\t},\n\t\t\tpages: {\n\t\t\t\ttype: 'array',\n\t\t\t\tdescription:\n\t\t\t\t\t'Array of pages to include in the site, with customized names',\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'object',\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tslug: {\n\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\tdescription: 'The slug of the page',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\tdescription: 'The customized name for the page',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdescription: {\n\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t'briefly describe the sort of content that will be on this page, no more than 30 words',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\trequired: [ 'slug', 'name' ],\n\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t},\n\t\t\t\tminItems: baseTemplate.subPages.required.length,\n\t\t\t},\n\t\t},\n\t\trequired: [ 'sections', 'pages' ],\n\t\tadditionalProperties: false,\n\t};\n\n\treturn {\n\t\tname: 'getSiteStructure',\n\t\tdescription:\n\t\t\t'Determines which sections to include on the homepage (must include all required sections) and which pages to include with their customized names',\n\t\tparameters,\n\t};\n};\n\nexport default createGetSiteStructureTool;\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { store as aiStore } from '@store';\nimport { recordTracksEvent } from '@utils/tracks';\nimport log from '@utils/log-debug.js';\nimport getSystemPrompt from './system-prompt.js';\nimport createGetSiteStructureTool from './tool.js';\nimport { getBaseTemplate } from '@data/site-structure-templates.js';\n\nfunction validateModelSections( modelSections, siteTemplate ) {\n\tconst homepageSections = [];\n\n\t// First process required sections in template order\n\tsiteTemplate.homepageSections.required.forEach( ( templateSection ) => {\n\t\tconst modelSection = modelSections.find(\n\t\t\t( section ) => section.slug === templateSection.slug\n\t\t);\n\n\t\t// If model provided this required section, use its reason, otherwise fallback to description\n\t\thomepageSections.push( {\n\t\t\t...templateSection,\n\t\t\treason: modelSection?.reason || templateSection.description,\n\t\t} );\n\t} );\n\n\t// Then process optional sections in template order, only including those the model selected\n\tsiteTemplate.homepageSections.optional.forEach( ( templateSection ) => {\n\t\tconst modelSection = modelSections.find(\n\t\t\t( section ) => section.slug === templateSection.slug\n\t\t);\n\t\tif ( modelSection ) {\n\t\t\thomepageSections.push( {\n\t\t\t\t...templateSection,\n\t\t\t\treason: modelSection.reason,\n\t\t\t} );\n\t\t}\n\t} );\n\n\treturn homepageSections;\n}\n\nfunction validateModelPages( modelPages, siteTemplate ) {\n\tconst { required = [], optional = [] } = siteTemplate.subPages;\n\tconst validatedPages = [];\n\n\t// Process required pages first\n\trequired.forEach( ( templatePage ) => {\n\t\tconst modelPage = modelPages.find(\n\t\t\t( page ) => page.slug === templatePage.slug\n\t\t);\n\t\tif ( modelPage ) {\n\t\t\t// Use model's page with potentially customized name\n\t\t\tvalidatedPages.push( {\n\t\t\t\t...templatePage,\n\t\t\t\tpageName: modelPage.name,\n\t\t\t\tdescription: modelPage.description,\n\t\t\t} );\n\t\t} else {\n\t\t\t// Fall back to template definition\n\t\t\tvalidatedPages.push( templatePage );\n\t\t}\n\t} );\n\n\t// Add optional pages that were selected by the model\n\toptional.forEach( ( templatePage ) => {\n\t\tconst modelPage = modelPages.find(\n\t\t\t( page ) => page.slug === templatePage.slug\n\t\t);\n\t\tif ( modelPage ) {\n\t\t\tvalidatedPages.push( {\n\t\t\t\t...templatePage,\n\t\t\t\tpageName: modelPage.name,\n\t\t\t\tdescription: modelPage.description,\n\t\t\t} );\n\t\t}\n\t} );\n\n\treturn validatedPages;\n}\n\nconst constructSiteStructure = ( baseTemplate, response ) => {\n\tconst homepageSections = validateModelSections(\n\t\tresponse.sections,\n\t\tbaseTemplate\n\t);\n\tconst subPages = validateModelPages( response.pages, baseTemplate );\n\n\treturn {\n\t\thomepageSections,\n\t\tsubPages,\n\t};\n};\n\nexport default function useGetSiteStructure() {\n\tconst { runChatCompletion, setChosenCategories } = useDispatch( aiStore );\n\tconst { chatModel } = useSelect( ( select ) => ( {\n\t\tchatModel: select( aiStore ).getAdvancedChatModel(),\n\t} ) );\n\n\tconst getSiteStructure = async ( siteMeta, siteGoals ) => {\n\t\trecordTracksEvent( 'get_site_structure_started' );\n\n\t\tconst messages = [\n\t\t\t{\n\t\t\t\trole: 'system',\n\t\t\t\tcontent: getSystemPrompt( siteMeta, siteGoals ),\n\t\t\t},\n\t\t];\n\n\t\tconst siteStructureTools = [\n\t\t\t{\n\t\t\t\ttype: 'function',\n\t\t\t\tfunction: createGetSiteStructureTool(\n\t\t\t\t\tsiteMeta.siteType,\n\t\t\t\t\tsiteGoals\n\t\t\t\t),\n\t\t\t},\n\t\t];\n\n\t\tconst response = await runChatCompletion(\n\t\t\tchatModel,\n\t\t\tmessages,\n\t\t\tsiteStructureTools\n\t\t);\n\n\t\tconst toolCalls = response?.choices?.[ 0 ]?.message?.tool_calls;\n\t\tif (\n\t\t\t! toolCalls ||\n\t\t\ttoolCalls.length === 0 ||\n\t\t\ttoolCalls[ 0 ].function.name !== 'getSiteStructure'\n\t\t) {\n\t\t\tlog.error(\n\t\t\t\t'getSiteStructure tool call missing in model response.'\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst structureResponse = JSON.parse(\n\t\t\t\ttoolCalls[ 0 ].function.arguments\n\t\t\t);\n\n\t\t\tif ( ! structureResponse || ! structureResponse.sections ) {\n\t\t\t\tlog.error( 'Invalid structure response format' );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst baseTemplate = getBaseTemplate(\n\t\t\t\tsiteMeta.siteType,\n\t\t\t\tsiteGoals\n\t\t\t);\n\t\t\tconst siteStructure = constructSiteStructure(\n\t\t\t\tbaseTemplate,\n\t\t\t\tstructureResponse\n\t\t\t);\n\n\t\t\tconst savedCategories = siteStructure?.homepageSections?.map(\n\t\t\t\t( section ) => ( {\n\t\t\t\t\tslug: section.slug,\n\t\t\t\t\treason: section.reason,\n\t\t\t\t} )\n\t\t\t);\n\n\t\t\tsetChosenCategories( savedCategories );\n\n\t\t\treturn siteStructure;\n\t\t} catch ( e ) {\n\t\t\tlog.error( 'get_site_structure JSON parsing error:', e.message );\n\t\t}\n\t};\n\n\treturn {\n\t\tgetSiteStructure,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { useCallback, useEffect, useState } from '@wordpress/element';\nimport { useDispatch } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport { store as aiStore } from '@store';\nimport { dockViews } from '@utils/constants.js';\nimport useCanvas from '@hooks/use-canvas';\nimport routerAssistant from '@ai/assistants/router/index.js';\n\nexport function useRouting( { runUrlChangeHandling } = {} ) {\n\tconst { siteTitle, isOnboarded } = useSiteMetadata().getSiteMetadata();\n\tconst [ userNavigating, setUserNavigating ] = useState( false );\n\tconst [ showOnboardingDialog, setShowOnboardingDialog ] = useState( false );\n\tconst [ { currentStep, previousStep }, setSteps ] = useState( () => ( {\n\t\tcurrentStep: new URL( window.location.href ).searchParams.get(\n\t\t\t'ai-step'\n\t\t),\n\t\tpreviousStep: null,\n\t} ) );\n\n\tconst {\n\t\tsetAssistant,\n\t\tsetDockView,\n\t\tsetHandoffStep,\n\t\tsetChatComponents,\n\t\tsetCurrentUserMessage,\n\t\tsetIsHandoff,\n\t} = useDispatch( aiStore );\n\tconst { setSiteMetadata } = useSiteMetadata();\n\tconst { zoomOut } = useCanvas();\n\n\tconst getAiStep = () => {\n\t\treturn currentStep;\n\t};\n\n\tconst setAiStep = useCallback(\n\t\t( newStep, forceToHistory = false ) => {\n\t\t\tif ( currentStep !== newStep || forceToHistory ) {\n\t\t\t\tsetSteps( ( state ) => ( {\n\t\t\t\t\tpreviousStep: state.currentStep,\n\t\t\t\t\tcurrentStep: newStep,\n\t\t\t\t} ) );\n\t\t\t\tconst url = new URL( window.location.href );\n\t\t\t\turl.searchParams.set( 'ai-step', newStep );\n\t\t\t\twindow.history.pushState( { aiStep: newStep }, '', url );\n\t\t\t}\n\t\t},\n\t\t[ currentStep, setSteps ]\n\t);\n\n\tconst getPreviousAiStep = () => {\n\t\treturn previousStep || currentStep;\n\t};\n\n\tconst handleAiStepChange = useCallback(\n\t\t( aiStep ) => {\n\t\t\tif ( aiStep === 'handoff' ) {\n\t\t\t\tzoomOut();\n\t\t\t\tsetIsHandoff( true );\n\t\t\t\tsetHandoffStep( 0 );\n\t\t\t\tsetDockView( dockViews.HANDOFF );\n\t\t\t\tif ( ! isOnboarded ) {\n\t\t\t\t\tsetSiteMetadata( { isOnboarded: true }, true );\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( aiStep === 'edit' ) {\n\t\t\t\tsetAssistant( routerAssistant.id );\n\t\t\t\tsetCurrentUserMessage( '' );\n\t\t\t\tif ( userNavigating ) {\n\t\t\t\t\tsetChatComponents( [] );\n\t\t\t\t\tsetDockView( dockViews.MENUS );\n\t\t\t\t}\n\n\t\t\t\tif ( ! isOnboarded ) {\n\t\t\t\t\tsetSiteMetadata( { isOnboarded: true }, true );\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (\n\t\t\t\taiStep === 'onboarding' &&\n\t\t\t\tpreviousStep !== 'onboarding' &&\n\t\t\t\tisOnboarded\n\t\t\t) {\n\t\t\t\tsetShowOnboardingDialog( true );\n\t\t\t}\n\t\t},\n\t\t[\n\t\t\tpreviousStep,\n\t\t\tisOnboarded,\n\t\t\tzoomOut,\n\t\t\tsetIsHandoff,\n\t\t\tsetHandoffStep,\n\t\t\tsetDockView,\n\t\t\tsetSiteMetadata,\n\t\t\tsetAssistant,\n\t\t\tsetCurrentUserMessage,\n\t\t\tuserNavigating,\n\t\t\tsetChatComponents,\n\t\t]\n\t);\n\n\tconst handleUrlChange = useCallback( () => {\n\t\tconst aiStep = new URL( window.location.href ).searchParams.get(\n\t\t\t'ai-step'\n\t\t);\n\n\t\t// We need to track if user starts navigating with back button as we handle returning to edit mode\n\t\t// differently from this point.\n\t\tif ( aiStep === 'handoff' && previousStep === 'edit' ) {\n\t\t\tsetUserNavigating( true );\n\t\t}\n\n\t\t// If the return toonboarding dialog is open, we don't want to change the step\n\t\tif ( aiStep === 'handoff' && showOnboardingDialog ) {\n\t\t\tsetAiStep( 'onboarding', true );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ( aiStep === 'handoff' || aiStep === 'edit' ) && ! siteTitle ) {\n\t\t\tsetAiStep( 'onboarding', true );\n\t\t\treturn;\n\t\t}\n\t\tif ( ! ( previousStep === currentStep && currentStep === aiStep ) ) {\n\t\t\tsetSteps( ( state ) => ( {\n\t\t\t\tpreviousStep: state.currentStep,\n\t\t\t\tcurrentStep: aiStep,\n\t\t\t} ) );\n\t\t\thandleAiStepChange( aiStep, previousStep );\n\t\t}\n\t}, [\n\t\tpreviousStep,\n\t\tshowOnboardingDialog,\n\t\tsiteTitle,\n\t\tcurrentStep,\n\t\tsetAiStep,\n\t\tsetUserNavigating,\n\t\tsetSteps,\n\t\thandleAiStepChange,\n\t] );\n\n\tuseEffect( () => {\n\t\tif ( ! runUrlChangeHandling ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Initial check\n\t\thandleUrlChange();\n\n\t\t// Listen for history changes\n\t\twindow.addEventListener( 'popstate', handleUrlChange );\n\n\t\treturn () => {\n\t\t\twindow.removeEventListener( 'popstate', handleUrlChange );\n\t\t};\n\t}, [ runUrlChangeHandling, handleUrlChange ] );\n\n\treturn {\n\t\tsetAiStep,\n\t\tgetAiStep,\n\t\tgetPreviousAiStep,\n\t\tshowOnboardingDialog,\n\t\tsetShowOnboardingDialog,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport useGeocoder from '@hooks/use-geocoder.js';\nimport useBuildSite from '@hooks/use-build-site.js';\nimport useSiteMetadata from '@hooks/use-site-metadata';\n\nexport default function useBuildSiteTool() {\n\tconst { getCoordinates } = useGeocoder();\n\tconst { setSiteMetadata } = useSiteMetadata();\n\tconst { buildSite } = useBuildSite();\n\n\tconst buildSiteTask = async ( parameters, isQuickOnboarding = false ) => {\n\t\tconst siteMetadataToUpdate = {\n\t\t\tsiteType: parameters.siteType,\n\t\t\ttopic: parameters.topic,\n\t\t\tsiteTitle: parameters.siteTitle,\n\t\t\tsiteDescription: parameters.siteDescription,\n\t\t\tdefaultImageStyle:\n\t\t\t\tparameters.imageStyle || parameters.defaultImageStyle,\n\t\t\tsiteLocation: {\n\t\t\t\tname:\n\t\t\t\t\tparameters.siteLocationName ||\n\t\t\t\t\tparameters.siteLocation?.name,\n\t\t\t},\n\t\t};\n\t\tif ( parameters.colorRequest ) {\n\t\t\tsiteMetadataToUpdate.colorRequest = parameters.colorRequest;\n\t\t}\n\t\tif ( siteMetadataToUpdate.siteLocation.name ) {\n\t\t\tsiteMetadataToUpdate.siteLocation.coordinates =\n\t\t\t\tawait getCoordinates( siteMetadataToUpdate.siteLocation.name );\n\t\t}\n\t\tsetSiteMetadata( siteMetadataToUpdate );\n\n\t\tbuildSite( siteMetadataToUpdate, isQuickOnboarding );\n\t\treturn __( 'Designing your site now…', 'big-sky' );\n\t};\n\n\treturn {\n\t\tbuildSiteTask,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { store as editorStore } from '@wordpress/editor';\n\n/**\n * Internal dependencies\n */\nimport { store as aiStore } from '@store';\nimport { recordTracksEvent } from '@utils/tracks';\nimport useGetBuildDesigns from '@ai/tasks/get-build-designs/use-get-build-designs';\nimport useGetSiteStructure from '@ai/tasks/get-site-structure/use-get-site-structure';\nimport usePatterns from '@hooks/use-patterns';\nimport useCanvas from '@hooks/use-canvas';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport useStyles from '@hooks/use-styles';\nimport usePages from '@hooks/use-pages';\nimport setDelay from '@utils/set-delay';\nimport { useRouting } from '@hooks/use-routing';\nimport { BIG_SKY_CUSTOM_THEME_PREFIX } from '@utils/custom-color-variations/constants';\n\nexport default function useBuildSite() {\n\tconst { getBuildDesigns } = useGetBuildDesigns();\n\tconst { getSiteStructure } = useGetSiteStructure();\n\tconst { setAiStep } = useRouting();\n\tconst { patternCategories, additionalContext } = useSelect(\n\t\t( select ) => ( {\n\t\t\tchatModel: select( aiStore ).getAdvancedChatModel(),\n\t\t\tpatternCategories: select( aiStore ).getPatternCategories(),\n\t\t\tadditionalContext: select( aiStore ).getAdditionalContext(),\n\t\t} )\n\t);\n\n\tconst {\n\t\tcomposePatterns,\n\t\tcomposeTemplatePartPattern,\n\t\tsyncSiteMetadataPatterns,\n\t} = usePatterns();\n\tdelete patternCategories.header;\n\tdelete patternCategories.footer;\n\tconst { currentPostId } = useSelect( ( select ) => ( {\n\t\tcurrentPostId: select( editorStore ).getCurrentPostId(),\n\t} ) );\n\tconst { setSiteMetadata } = useSiteMetadata();\n\tconst { savePost } = useDispatch( editorStore );\n\tconst { setImageStyle } = useDispatch( aiStore );\n\tconst { editEntityRecord } = useDispatch( coreStore );\n\tconst { __unstableSetEditorMode } = useDispatch( blockEditorStore );\n\n\tconst { addPatternsToCanvas } = useCanvas();\n\n\tconst { getBlocksByName, getBlocks } = useSelect( blockEditorStore );\n\tconst { pushGeneratedVariations, setIsHandoff } = useDispatch( aiStore );\n\n\tconst { getCurrentTheme, saveStylesEntityRecord, setStyles } = useStyles();\n\tconst { createPage } = usePages();\n\n\tconst buildSite = async ( siteMeta, isQuickOnboarding = false ) => {\n\t\tconst designElementsPromise = getBuildDesigns(\n\t\t\tsiteMeta,\n\t\t\tisQuickOnboarding\n\t\t);\n\n\t\tconst siteStructurePromise = getSiteStructure(\n\t\t\tsiteMeta,\n\t\t\tadditionalContext.siteGoals\n\t\t);\n\t\tconst [ designElements, siteStructure ] = await Promise.all( [\n\t\t\tdesignElementsPromise,\n\t\t\tsiteStructurePromise,\n\t\t] );\n\n\t\tconst {\n\t\t\ttopic,\n\t\t\tsiteTitle,\n\t\t\tsiteDescription,\n\t\t\tsiteLocation,\n\t\t\tcolor,\n\t\t\tfont,\n\t\t\tpatterns,\n\t\t} = designElements;\n\n\t\tsetImageStyle( siteMeta.defaultImageStyle );\n\t\teditEntityRecord( 'root', 'site', undefined, {\n\t\t\ttitle: siteTitle,\n\t\t} );\n\n\t\tsetStyles( { color, font, updateBlocks: false } );\n\n\t\t// Adding the pages but not awaiting them so as not to block the home page build.\n\t\t// Awaiting them after patterns added to canvas, by which time they have mostly\n\t\t// completed. We may need to revist this if we start adding more pages.\n\t\tconst addSubPages = Promise.all(\n\t\t\tsiteStructure.subPages.map( async ( page, index ) => {\n\t\t\t\treturn await createPage(\n\t\t\t\t\tpage.pageName,\n\t\t\t\t\tpage.sections,\n\t\t\t\t\ttopic,\n\t\t\t\t\tsiteDescription,\n\t\t\t\t\tsiteLocation,\n\t\t\t\t\tfalse,\n\t\t\t\t\tindex + 1,\n\t\t\t\t\tnull,\n\t\t\t\t\tpage.description,\n\t\t\t\t\tpage.slug\n\t\t\t\t);\n\t\t\t} )\n\t\t);\n\n\t\tconst header = composeTemplatePartPattern( {\n\t\t\ttemplatePart: 'header',\n\t\t\tsiteDescription,\n\t\t\tsiteLocation,\n\t\t\ttopic,\n\t\t\tisQuickOnboarding,\n\t\t\tpattern: patterns?.find(\n\t\t\t\t( pattern ) => pattern.category === 'header'\n\t\t\t)?.id,\n\t\t} );\n\n\t\tconst footer = composeTemplatePartPattern( {\n\t\t\ttemplatePart: 'footer',\n\t\t\tsiteDescription,\n\t\t\tsiteLocation,\n\t\t\ttopic,\n\t\t\tpattern: patterns?.find(\n\t\t\t\t( pattern ) => pattern.category === 'footer'\n\t\t\t)?.id,\n\t\t} );\n\n\t\t// set patterns\n\t\tconst concepts = composePatterns( {\n\t\t\tcategories: siteStructure.homepageSections,\n\t\t\ttopic,\n\t\t\tsiteDescription,\n\t\t\tsiteLocation,\n\t\t\tnumberOfConcepts: 1,\n\t\t\tchosenPatterns: patterns?.filter(\n\t\t\t\t( pattern ) =>\n\t\t\t\t\tpattern.category !== 'header' &&\n\t\t\t\t\tpattern.category !== 'footer'\n\t\t\t),\n\t\t\tpages: siteStructure.subPages,\n\t\t} );\n\n\t\tconst firstConceptPatternsAndResolvers = concepts[ 0 ].patterns.map(\n\t\t\t( pattern, index ) => ( {\n\t\t\t\tpattern,\n\t\t\t\tresolver: concepts[ 0 ].resolvers[ index ].resolver,\n\t\t\t} )\n\t\t);\n\n\t\tawait addPatternsToCanvas(\n\t\t\t[ header, ...firstConceptPatternsAndResolvers, footer ],\n\t\t\ttrue,\n\t\t\tisQuickOnboarding\n\t\t);\n\n\t\t// homepage patterns\n\t\tconst homePageBlocks = getBlocks(\n\t\t\tgetBlocksByName( 'core/post-content' )\n\t\t);\n\n\t\tconst createPageResponses = await addSubPages;\n\t\t// need to sync both homepage and subpages patterns\n\t\tcreatePageResponses.push( {\n\t\t\trootBlocks: homePageBlocks,\n\t\t\tnewPage: { id: currentPostId },\n\t\t} );\n\t\tcreatePageResponses.map( ( response ) =>\n\t\t\tresponse.rootBlocks.map( ( block ) => {\n\t\t\t\tconst slug = block.attributes?.metadata?.patternCategory;\n\t\t\t\tconst pageSection = siteStructure.homepageSections.find(\n\t\t\t\t\t( section ) => section.slug === slug\n\t\t\t\t);\n\t\t\t\tblock.attributes.metadata.reason = pageSection?.reason;\n\t\t\t\t// block.attributes?.metadata?.description = pageSection.description;\n\t\t\t\treturn block;\n\t\t\t} )\n\t\t);\n\t\tsyncSiteMetadataPatterns( {\n\t\t\tids: createPageResponses.map( ( response ) => response.newPage.id ),\n\t\t\tblocks: createPageResponses.map(\n\t\t\t\t( response ) => response.rootBlocks\n\t\t\t),\n\t\t\tpersist: true,\n\t\t} );\n\n\t\tif ( ! concepts?.[ 0 ]?.patterns.length ) {\n\t\t\t// set editor mode back to edit\n\t\t\t__unstableSetEditorMode( 'edit' );\n\t\t\treturn;\n\t\t}\n\n\t\tawait saveStylesEntityRecord();\n\t\tawait savePost( currentPostId );\n\n\t\t// Add the current theme as a custom variation\n\t\tconst themeCopy = JSON.parse( JSON.stringify( getCurrentTheme() ) );\n\t\tthemeCopy.title = BIG_SKY_CUSTOM_THEME_PREFIX;\n\t\tpushGeneratedVariations( [ themeCopy ] );\n\t\t// Set styles here again to ensure the theme is applied\n\t\tsetStyles( { color, font } );\n\n\t\tsetSiteMetadata( { isOnboarded: true }, true );\n\t\trecordTracksEvent( 'building_site_finished' );\n\n\t\tawait setDelay( 1000 );\n\t\tsetAiStep( 'handoff' );\n\n\t\t// start handoff\n\t\tsetIsHandoff( true );\n\t};\n\n\treturn {\n\t\tbuildSite,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { store as aiStore } from '@store';\nimport { recordTracksEvent } from '@utils/tracks';\nimport useVariations from '@hooks/use-variations';\nimport log from '@utils/log-debug.js';\nimport getSystemPrompt from './system-prompt.js';\nimport createGetBuildDesignsTool from './tool.js';\nimport { dockViews } from '@utils/constants.js';\nimport createColorPaletteGeneratorTool from '../../assistants/color/tools/color-palette-generator.js';\n\nexport default function useGetBuildDesigns() {\n\tconst { runChatCompletion } = useDispatch( aiStore );\n\n\tconst { chatModel } = useSelect( ( select ) => ( {\n\t\tchatModel: select( aiStore ).getAdvancedChatModel(),\n\t} ) );\n\n\tconst {\n\t\tsetIsBuildingSite,\n\t\tresetCachedContent,\n\t\tsetChosenColors,\n\t\tsetChosenCustomColors,\n\t\tsetChosenFonts,\n\t\tsetDockView,\n\t\tsetShowThread,\n\t} = useDispatch( aiStore );\n\n\tconst { getColorVariations, getFontVariations } = useVariations();\n\n\tconst getBuildDesigns = async ( siteMeta, isQuickOnboarding ) => {\n\t\tsetIsBuildingSite( true );\n\t\tsetDockView( dockViews.MENUS );\n\t\tsetShowThread( false );\n\n\t\trecordTracksEvent( 'designing_build_started' );\n\n\t\tif ( process.env.NODE_ENV === 'development' ) {\n\t\t\t// eslint-disable-next-line no-undef\n\t\t\tconst buildDesigns = localStorage.getItem( 'buildDesigns' );\n\t\t\tif ( buildDesigns ) {\n\t\t\t\tconst { colors: chosenColors, fonts: chosenFonts } =\n\t\t\t\t\tJSON.parse( buildDesigns );\n\t\t\t\tsetChosenColors( chosenColors );\n\t\t\t\tsetChosenFonts( chosenFonts );\n\n\t\t\t\treturn {\n\t\t\t\t\t...siteMeta,\n\t\t\t\t\tcolor: chosenColors[ 0 ],\n\t\t\t\t\tfont: chosenFonts[ 0 ],\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// reset cached content\n\t\tresetCachedContent();\n\n\t\t// generate color string from variations\n\t\tconst colorVariations = getColorVariations();\n\t\tconst colorVariationData = colorVariations.map( ( variation ) => {\n\t\t\treturn {\n\t\t\t\tname: variation.title,\n\t\t\t\tkeywords: variation[ 'x-big-sky-meta' ]?.keywords || [],\n\t\t\t};\n\t\t} );\n\n\t\t// generate font string from variations\n\t\tconst fontVariations = getFontVariations();\n\t\tconst fontVariationData = fontVariations.map( ( variation ) => {\n\t\t\treturn {\n\t\t\t\tname: variation.name,\n\t\t\t\tkeywords: variation[ 'x-big-sky-meta' ]?.keywords || [],\n\t\t\t};\n\t\t} );\n\n\t\tconst messages = [\n\t\t\t{\n\t\t\t\trole: 'system',\n\t\t\t\tcontent: getSystemPrompt(\n\t\t\t\t\tsiteMeta,\n\t\t\t\t\tJSON.stringify( colorVariationData ),\n\t\t\t\t\tJSON.stringify( fontVariationData )\n\t\t\t\t),\n\t\t\t},\n\t\t];\n\n\t\tconst colorVariationNames = colorVariations.map(\n\t\t\t( variation ) => variation.title\n\t\t);\n\t\tconst fontVariationNames = fontVariations.map(\n\t\t\t( variation ) => variation.title\n\t\t);\n\n\t\tconst additionalProperties = {};\n\t\tif ( siteMeta.colorRequest && siteMeta.colorRequest.length > 0 ) {\n\t\t\t// If and only if user has requested custom colors during handoff, we inject the custom_colors property to the the build designs tool.\n\t\t\tadditionalProperties.custom_colors =\n\t\t\t\tcreateColorPaletteGeneratorTool(\n\t\t\t\t\t[]\n\t\t\t\t).parameters.properties.custom_colors;\n\t\t}\n\n\t\tconst buildSiteTools = [\n\t\t\t{\n\t\t\t\ttype: 'function',\n\t\t\t\tfunction: createGetBuildDesignsTool(\n\t\t\t\t\tcolorVariationNames,\n\t\t\t\t\tfontVariationNames,\n\t\t\t\t\tadditionalProperties\n\t\t\t\t),\n\t\t\t},\n\t\t];\n\n\t\tconst response = await runChatCompletion(\n\t\t\tchatModel,\n\t\t\tmessages,\n\t\t\tbuildSiteTools\n\t\t);\n\n\t\tconst toolCalls = response?.choices?.[ 0 ]?.message?.tool_calls;\n\t\tif (\n\t\t\t! toolCalls ||\n\t\t\ttoolCalls.length === 0 ||\n\t\t\ttoolCalls[ 0 ].function.name !== 'getBuildDesigns'\n\t\t) {\n\t\t\tlog.error( 'getBuildDesigns tool call missing in model response.' );\n\t\t\treturn;\n\t\t}\n\n\t\tconst args = toolCalls[ 0 ].function.arguments;\n\n\t\ttry {\n\t\t\tconst parsedArgs = JSON.parse( args );\n\t\t\t// Choose the first (best) color palette from parsedArgs.colors(an array).\n\t\t\t// Save the rest of the chosen colors in the ai store for later use.\n\n\t\t\tconst {\n\t\t\t\tcategories,\n\t\t\t\tcolors: chosenColors,\n\t\t\t\tfonts: chosenFonts,\n\t\t\t\tcustom_colors: chosenCustomColors,\n\t\t\t} = parsedArgs;\n\t\t\tsetChosenColors( chosenColors );\n\t\t\tsetChosenFonts( chosenFonts );\n\t\t\tif ( chosenCustomColors ) {\n\t\t\t\tsetChosenCustomColors( chosenCustomColors );\n\t\t\t}\n\n\t\t\tif ( isQuickOnboarding ) {\n\t\t\t\t// eslint-disable-next-line no-undef\n\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t'buildDesigns',\n\t\t\t\t\tJSON.stringify( {\n\t\t\t\t\t\tcategories,\n\t\t\t\t\t\tcolors: chosenColors,\n\t\t\t\t\t\tfonts: chosenFonts,\n\t\t\t\t\t\tcustom_colors: chosenCustomColors,\n\t\t\t\t\t} )\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t...siteMeta,\n\t\t\t\tcolor: chosenColors[ 0 ],\n\t\t\t\tfont: chosenFonts[ 0 ],\n\t\t\t\tcategories,\n\t\t\t};\n\t\t} catch ( e ) {\n\t\t\tlog.error(\n\t\t\t\t'getBuildDesigns JSON parsing error, some content may be missing'\n\t\t\t);\n\t\t}\n\t};\n\n\treturn {\n\t\tgetBuildDesigns,\n\t};\n}\n","import specAssistantPrompt from './prompt.js';\nimport specToolkit from './toolkit.js';\nimport specContext from './context.js';\nimport { ASSISTANTS } from '../constants.js';\nimport useSpecToolkit from './use-spec-toolkit.js';\n\nconst specAssistant = {\n\tid: ASSISTANTS.SPEC,\n\tdescription:\n\t\t'An assistant that gathers and confirms information about the site specs.',\n\tinstructions: specAssistantPrompt,\n\ttags: [ ASSISTANTS.SPEC ],\n\tadditionalInstructions: ( context ) => {\n\t\treturn specContext.format( context );\n\t},\n\ttoolkits: [ specToolkit ],\n\ttoolkitHook: useSpecToolkit,\n\tonStart: ( invoke, clearMessages = () => {}, agentMessage = null ) => {\n\t\tif ( agentMessage ) {\n\t\t\tclearMessages();\n\t\t\tinvoke.agentSay( agentMessage );\n\t\t}\n\t},\n\tonToolResult: ( _, value, invoke ) => {\n\t\tinvoke.userSay( value );\n\t},\n};\n\nexport default specAssistant;\n","/**\n * WordPress dependencies\n */\nimport { useEffect } from '@wordpress/element';\nimport { useDispatch, useSelect } from '@wordpress/data';\n\n/**\n * External dependencies\n */\nimport { useToolkits } from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport siteSpecToolkit from './toolkit.js';\nimport { store as aiStore } from '@store';\nimport useCreateToolCallback from '@ai/assistants/shared/use-create-tool-callback.js';\nimport useResetSite from '@hooks/use-reset-site.js';\nimport useBuildSiteTool from './tools/build-site/use-build-site-tool.js';\n\nexport default function useSiteSpecToolkit() {\n\tconst { setChatComponents } = useDispatch( aiStore );\n\tconst { getSiteMetadata } = useSiteMetadata();\n\tconst { setCallbacks, setContext } = useToolkits();\n\tconst additionalContext = useSelect( ( select ) =>\n\t\tselect( aiStore ).getAdditionalContext()\n\t);\n\tconst { resetSite } = useResetSite();\n\tconst { createToolCallback } = useCreateToolCallback();\n\tconst siteMetadata = getSiteMetadata();\n\tconst { buildSiteTask } = useBuildSiteTool();\n\n\tuseEffect( () => {\n\t\tsetCallbacks( siteSpecToolkit.name, {\n\t\t\tbuild_site: async ( args ) => {\n\t\t\t\tawait buildSiteTask( args );\n\t\t\t},\n\t\t\tstart_over: createToolCallback( {\n\t\t\t\tname: 'start_over',\n\t\t\t\taction: async () => {\n\t\t\t\t\tresetSite();\n\t\t\t\t\tsetChatComponents( [] );\n\t\t\t\t},\n\t\t\t} ),\n\t\t} );\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ setCallbacks ] );\n\n\tuseEffect( () => {\n\t\t// If user has returned to onboarding via backbutton we need to add the site metadata to the additional context\n\t\t// as there is no site data in the chat thread in this case.\n\t\tif ( setContext && ( additionalContext || siteMetadata.siteTitle ) ) {\n\t\t\tsetContext( siteSpecToolkit.name, {\n\t\t\t\tadditionalContext: {\n\t\t\t\t\t...additionalContext,\n\t\t\t\t\t...siteMetadata,\n\t\t\t\t},\n\t\t\t} );\n\t\t}\n\t}, [ additionalContext, setContext, siteMetadata ] );\n}\n","export const createToolShowFontPicker = ( keywords = [] ) => {\n\treturn {\n\t\tname: 'show_font_picker',\n\t\tdescription:\n\t\t\t'Call this if the user asks for anything to do with site fonts. If font keywords are provided, use it as is. If a user requests all fonts, do not return keywords or fonts.',\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tfonts: {\n\t\t\t\t\ttype: [ 'array', 'null' ],\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The requested font(s). Default to null if not supplied in the user request.',\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\tdescription: 'A font name.',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tkeywords: {\n\t\t\t\t\ttype: [ 'array', 'null' ],\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The requested keywords of the font. Default to null if not supplied in the user request. The more keywords, the more specific the font. If none of the keyword match user request, try to pick a combination that represents the intent.',\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\tenum: keywords,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'fonts', 'keywords' ],\n\t\t},\n\t\tstrict: true,\n\t};\n};\n\nexport default createToolShowFontPicker;\n","const createUpsertSocialLinkTool = ( services = [] ) => {\n\treturn {\n\t\tname: 'upsert_social_link',\n\t\tdescription: `Call this if the user asks to add or update a social link. The url must be provided by the user. The service must be in the provided list of supported services.`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tservice: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: `The requested service of the social link.`,\n\t\t\t\t\tenum: services,\n\t\t\t\t},\n\t\t\t\turl: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: `The URL of the social link.`,\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'service', 'url' ],\n\t\t},\n\t\tstrict: true,\n\t};\n};\n\nexport default createUpsertSocialLinkTool;\n","export const availableContactFormFields = [\n\t'button',\n\t'checkbox',\n\t'checkbox-multiple',\n\t'consent',\n\t'date',\n\t'email',\n\t'name',\n\t'radio',\n\t'select',\n\t'telephone',\n\t'text',\n\t'textarea',\n\t'url',\n];\n","const addItemToEventsContainerTool = ( {\n\tdescription,\n\tdateFormatExample,\n\ttimeFormatExample,\n} ) => {\n\treturn {\n\t\tname: 'add_item_to_events_container',\n\t\tdescription: `Adds new events items. The description of the site is: ${ description }.\n\t\tThe event dates should be later than and in the same format as ${ dateFormatExample }.\n\t\tThe event times should be in the same format as ${ timeFormatExample }.\n\t\tIf not specified in the user request, make up the events according to the description of the site.\n\t\tNEVER ask any follow up questions.`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tclientId: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The clientId of the selected block. DOES NOT have to be an events block.',\n\t\t\t\t},\n\t\t\t\tcount: {\n\t\t\t\t\ttype: 'number',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The number of events items to add. Default to 1.',\n\t\t\t\t},\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\tdescription: 'The events items to add.',\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'object',\n\t\t\t\t\t\tdescription: 'The events item to add.',\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tdate: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription: 'The date of the event.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttime: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription: 'The time of the event.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription: 'The name of the event.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdescription: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The description of the menu item. If not provided, make something up.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tlocation: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The location of the event. If not provided, make something up.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t'date',\n\t\t\t\t\t\t\t'time',\n\t\t\t\t\t\t\t'name',\n\t\t\t\t\t\t\t'description',\n\t\t\t\t\t\t\t'location',\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'clientId', 'count', 'items' ],\n\t\t},\n\t\tstrict: true,\n\t};\n};\n\nexport default addItemToEventsContainerTool;\n","const addItemToMenuContainerTool = ( description ) => {\n\treturn {\n\t\tname: 'add_item_to_menu_container',\n\t\tdescription: `Adds new menu items.\n\t\tThe description of the site is: ${ description }.\n\t\tIf the menu items are not specified in the user request, make them up according to the description of the site.\n\t\tNEVER ask any follow up questions.`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tclientId: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The clientId of the selected block. DOES NOT have to be a menu block.',\n\t\t\t\t},\n\t\t\t\tcount: {\n\t\t\t\t\ttype: 'number',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The number of menu items to add. Default to 1.',\n\t\t\t\t},\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\tdescription: 'The menu items to add.',\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'object',\n\t\t\t\t\t\tdescription: 'The menu item to add.',\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription: 'The name of the menu item.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdescription: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The description of the menu item. If not provided, make something up.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tprice: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The price of the menu item. If not provided, make something up.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcurrency: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The currency of the menu item. If not provided, default to \"$\".',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t'name',\n\t\t\t\t\t\t\t'description',\n\t\t\t\t\t\t\t'price',\n\t\t\t\t\t\t\t'currency',\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'clientId', 'count', 'items' ],\n\t\t},\n\t\tstrict: true,\n\t};\n};\n\nexport default addItemToMenuContainerTool;\n","import createColorPaletteGeneratorTool from '@ai/assistants/color/tools/color-palette-generator.js';\nimport createShowFontPickerTool from '@ai/assistants/font/tools/show-font-picker.js';\nimport rewriteContentTool from '@ai/assistants/content/tools/content/rewrite-content.js';\nimport createUpdateButtonLinkTool from '@ai/assistants/content/tools/button/update-button-link.js';\nimport createUpsertSocialLinkTool from '@ai/assistants/content/tools/button/upsert-social-link.js';\nimport createUpdateAddressTool from '@ai/assistants/content/tools/address/update-address.js';\nimport makeTextBoldItalicTool from '@ai/assistants/content/tools/make-text-bold-italic/make-text-bold-italic-tool.js';\nimport modifyContactFormFieldsTool from '@ai/assistants/content/tools/contact-form/modify-contact-form-fields-tool.js';\nimport addContainerToEventsSectionTool from '@ai/assistants/content/tools/content/events/add-container-to-events-section-tool.js';\nimport addItemToEventsContainerTool from '@ai/assistants/content/tools/content/events/add-item-to-events-container-tool.js';\nimport addContainerToMenuSectionTool from '@ai/assistants/content/tools/content/menu/add-container-to-menu-section-tool.js';\nimport addItemToMenuContainerTool from '@ai/assistants/content/tools/content/menu/add-item-to-menu-container-tool.js';\nimport addContainerToServicesSectionTool from '@ai/assistants/content/tools/content/services/add-container-to-services-section-tool.js';\nimport addItemToTestimonialsSectionTool from '@ai/assistants/content/tools/content/testimonials/add-item-to-testimonials-section-tool.js';\nimport addContainerToPricingSectionTool from '@ai/assistants/content/tools/content/pricing/add-container-to-pricing-section-tool.js';\nimport addContainerToTeamSectionTool from '@ai/assistants/content/tools/content/team/add-container-to-team-section-tool.js';\nimport addMemberToTeamContainerTool from '@ai/assistants/content/tools/content/team/add-member-to-team-container-tool.js';\nimport makeSuggestionTool from '@ai/assistants/shared/make-suggestions/tool.js';\nimport createStartOverTool from '@ai/assistants/shared/start-over/start-over.js';\nimport changeAssistantTool from '@ai/assistants/shared/change-assistant/change-assistant-tool.js';\nimport { ASSISTANTS } from '@ai/assistants/constants.js';\nimport { isForwardedByRouter } from '@ai/assistants/shared/prompts.js';\n\nconst contentToolkit = {\n\tname: 'content',\n\ttools: ( context ) => {\n\t\tconst trimmedDescription =\n\t\t\tcontext.site?.description?.substring( 0, 300 ) || '';\n\n\t\t// Restrict tools based on the current handoff area\n\t\tif ( context.currentHandoffArea ) {\n\t\t\tswitch ( context.currentHandoffArea ) {\n\t\t\t\tcase 'colors':\n\t\t\t\t\treturn [\n\t\t\t\t\t\tcreateColorPaletteGeneratorTool(\n\t\t\t\t\t\t\tcontext.colors?.colorVariationCategories\n\t\t\t\t\t\t),\n\t\t\t\t\t];\n\t\t\t\tcase 'fonts':\n\t\t\t\t\treturn [\n\t\t\t\t\t\tcreateShowFontPickerTool(\n\t\t\t\t\t\t\tcontext.fonts?.fontCategories\n\t\t\t\t\t\t),\n\t\t\t\t\t];\n\t\t\t\tdefault:\n\t\t\t\t\treturn [];\n\t\t\t}\n\t\t}\n\n\t\t// These tools don't require a selected block\n\t\tconst tools = [\n\t\t\tmakeSuggestionTool(),\n\t\t\tcreateUpsertSocialLinkTool( context.socialLinks?.services ),\n\t\t\tcreateUpdateAddressTool(),\n\t\t\tmakeTextBoldItalicTool(),\n\t\t\tcreateStartOverTool(),\n\t\t];\n\n\t\tif ( ! isForwardedByRouter( context ) ) {\n\t\t\ttools.push( changeAssistantTool( ASSISTANTS.CONTENT ) );\n\t\t}\n\n\t\t// load pattern-specific tools\n\t\tif ( context.events?.pattern ) {\n\t\t\tif ( context.events?.sections ) {\n\t\t\t\ttools.push(\n\t\t\t\t\taddContainerToEventsSectionTool( {\n\t\t\t\t\t\tdescription: trimmedDescription,\n\t\t\t\t\t\titemCount: context.events?.itemCount,\n\t\t\t\t\t\tdateFormatExample: context.events?.dateFormatExample,\n\t\t\t\t\t\ttimeFormatExample: context.events?.timeFormatExample,\n\t\t\t\t\t} )\n\t\t\t\t);\n\t\t\t} else if ( context.events?.items ) {\n\t\t\t\ttools.push(\n\t\t\t\t\taddItemToEventsContainerTool( {\n\t\t\t\t\t\tdescription: trimmedDescription,\n\t\t\t\t\t\tdateFormatExample: context.events?.dateFormatExample,\n\t\t\t\t\t\ttimeFormatExample: context.events?.timeFormatExample,\n\t\t\t\t\t} )\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tif ( context.menu?.pattern ) {\n\t\t\tif ( context.menu?.sections ) {\n\t\t\t\ttools.push(\n\t\t\t\t\taddContainerToMenuSectionTool( {\n\t\t\t\t\t\tdescription: trimmedDescription,\n\t\t\t\t\t\titemCount: context.menu?.itemCount,\n\t\t\t\t\t} )\n\t\t\t\t);\n\t\t\t} else if ( context.menu?.items ) {\n\t\t\t\ttools.push( addItemToMenuContainerTool( trimmedDescription ) );\n\t\t\t}\n\t\t}\n\t\tif ( context.services?.sections ) {\n\t\t\ttools.push(\n\t\t\t\taddContainerToServicesSectionTool( {\n\t\t\t\t\tdescription: trimmedDescription,\n\t\t\t\t\titemCount: context.services?.itemCount,\n\t\t\t\t} )\n\t\t\t);\n\t\t}\n\t\tif ( context.testimonials?.sections ) {\n\t\t\ttools.push(\n\t\t\t\taddItemToTestimonialsSectionTool( {\n\t\t\t\t\tdescription: trimmedDescription,\n\t\t\t\t\titemCount: context.testimonials?.itemCount,\n\t\t\t\t} )\n\t\t\t);\n\t\t}\n\t\tif ( context.pricing?.sections ) {\n\t\t\ttools.push(\n\t\t\t\taddContainerToPricingSectionTool( {\n\t\t\t\t\tdescription: trimmedDescription,\n\t\t\t\t\titemCount: context.pricing?.itemCount,\n\t\t\t\t\ttiers: context.pricing?.tiers,\n\t\t\t\t} )\n\t\t\t);\n\t\t}\n\t\tif ( context.team?.pattern ) {\n\t\t\tif ( context.team?.sections ) {\n\t\t\t\ttools.push( addContainerToTeamSectionTool() );\n\t\t\t} else if ( context.team?.items ) {\n\t\t\t\ttools.push( addMemberToTeamContainerTool() );\n\t\t\t}\n\t\t}\n\n\t\tif ( context?.contactForm?.isOnPage ) {\n\t\t\ttools.push( modifyContactFormFieldsTool() );\n\t\t}\n\n\t\tif ( ! context.selectedBlock ) {\n\t\t\treturn tools;\n\t\t}\n\n\t\t// load Big Sky pattern tools depending on existing patterns\n\t\tif ( context.menu?.pattern && context.menu?.sections ) {\n\t\t\ttools.push( addItemToMenuContainerTool( trimmedDescription ) );\n\t\t}\n\t\tif ( context.events?.pattern && context.events?.sections ) {\n\t\t\ttools.push(\n\t\t\t\taddItemToEventsContainerTool( {\n\t\t\t\t\tdescription: trimmedDescription,\n\t\t\t\t\tdateFormatExample: context.events?.dateFormatExample,\n\t\t\t\t\ttimeFormatExample: context.events?.timeFormatExample,\n\t\t\t\t} )\n\t\t\t);\n\t\t}\n\t\tif ( context.team?.pattern && context.team?.sections ) {\n\t\t\ttools.push( addMemberToTeamContainerTool() );\n\t\t}\n\n\t\t// Add tools that require a specific selected block type\n\t\tswitch ( context.selectedBlock.type ) {\n\t\t\tcase 'core/button':\n\t\t\t\ttools.push( createUpdateButtonLinkTool() );\n\t\t\t\tbreak;\n\t\t\tcase 'core/paragraph':\n\t\t\tcase 'core/heading':\n\t\t\t\ttools.push( rewriteContentTool() );\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn tools;\n\t},\n};\n\nexport default contentToolkit;\n","const createUpdateAddressTool = () => {\n\treturn {\n\t\tname: 'update_address',\n\t\tdescription: 'Update the contact address for the website/business',\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\taddress: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: 'The address to update.',\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'address' ],\n\t\t},\n\t\tstrict: false,\n\t};\n};\n\nexport default createUpdateAddressTool;\n","const makeTextBoldItalicTool = () => {\n\treturn {\n\t\tname: 'make_text_bold_italic',\n\t\tdescription: `Use if the user asks for selected text, or substring of selected text, to be made bold or italic, or both. Never format the text yourself with markdown, use this tool instead.\n\t\t\tIf you don't know the content of the selected block, or the user has selected a block without content, still call this tool but return text parameter as 'no text selected'.`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\ttext: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: 'The text to format',\n\t\t\t\t},\n\t\t\t\tsubstring: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'Any substring of \"text\" to be formatted. If not provided the entire text will be formatted.',\n\t\t\t\t},\n\t\t\t\tformats: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The formats the user wants to apply. Emphasise should map to italic.',\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\tdescription: 'A slug of format to apply.',\n\t\t\t\t\t\tenum: [ 'bold', 'italic' ],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'text', 'formats' ],\n\t\t},\n\t\tstrict: false,\n\t};\n};\n\nexport default makeTextBoldItalicTool;\n","const addContainerToEventsSectionTool = ( {\n\tdescription,\n\titemCount = 5,\n\tdateFormatExample,\n\ttimeFormatExample,\n} ) => {\n\treturn {\n\t\tname: 'add_container_to_events_section',\n\t\tdescription: `Adds a new events container (group/row of event items) to the events pattern.\n\t\tThe description of the site is: ${ description }.\n\t\tIf not specified in the user request, make up ${ itemCount } events items according to the description of the site.\n\t\tThe event dates should be later than and in the same format as ${ dateFormatExample }.\n\t\tThe event times should be in the same format as ${ timeFormatExample }.\n\t\t`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'A list of events items to add to the events section',\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'object',\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t'The events item to add to the events section.',\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tdate: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription: 'The date of the event.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttime: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription: 'The time of the event.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription: 'The name of the event.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdescription: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The description of the menu item. If not provided, make something up.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tlocation: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The location of the event. If not provided, make something up.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t'date',\n\t\t\t\t\t\t\t'time',\n\t\t\t\t\t\t\t'name',\n\t\t\t\t\t\t\t'description',\n\t\t\t\t\t\t\t'location',\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'items' ],\n\t\t},\n\t\tstrict: true,\n\t};\n};\n\nexport default addContainerToEventsSectionTool;\n","const addContainerToMenuSectionTool = ( { description, itemCount = 5 } ) => {\n\treturn {\n\t\tname: 'add_container_to_menu_section',\n\t\tdescription: `Adds a new menu container (group of menu items) to the menu section.\n\t\tThe description of the site is: ${ description }.\n\t\tIf not specified in the user request, make up ${ itemCount } menu items according to the description of the site.\n\t\tNEVER ask any follow up questions.\n\t\t`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\ttitle: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: 'The title of the menu section to add.',\n\t\t\t\t},\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'A list of menu items to add to the menu section',\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'object',\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t'The menu item to add to the menu section.',\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription: 'The name of the menu item.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdescription: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The description of the menu item. If not provided, make something up.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tprice: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The price of the menu item. If not provided, make something up.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcurrency: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The currency of the menu item. If not provided, default to \"$\".',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t'name',\n\t\t\t\t\t\t\t'description',\n\t\t\t\t\t\t\t'price',\n\t\t\t\t\t\t\t'currency',\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'title', 'items' ],\n\t\t},\n\t\tstrict: true,\n\t};\n};\n\nexport default addContainerToMenuSectionTool;\n","const addContainerToServicesSectionTool = ( {\n\tdescription,\n\titemCount = 3,\n} ) => {\n\treturn {\n\t\tname: 'add_container_to_services_section_tool',\n\t\tdescription: `Adds a new services container (group of service items) to the services pattern.\n\t\t\tThe description of the site is: ${ description }.\n\t\t\tGenerate ${ itemCount } service items according to the description of the site.\n\t\t\tNEVER ask any follow up questions.\n\t\t`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\tdescription: `A list of service items to add to the services section.`,\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'object',\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t'The service item to add to the services section.',\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription: 'The name of the service item.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdescription: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The description of the service item. If not provided, make something up.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tlink: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The link text for the service item. If not provided, make something up.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequired: [ 'name', 'description', 'link' ],\n\t\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'items' ],\n\t\t},\n\t\tstrict: true,\n\t};\n};\n\nexport default addContainerToServicesSectionTool;\n","const addItemToTestimonialsSectionTool = ( { description, itemCount = 3 } ) => {\n\treturn {\n\t\tname: 'add_item_to_testimonials_section',\n\t\tdescription: `Adds a new testimonials section to the testimonials pattern.\n\t\t\tThe description of the site is: ${ description }.\n\t\t\tGenerate ${ itemCount } testimonial items according to the description of the site.\n\t\t\tNEVER ask any follow up questions.\n\t\t`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\tdescription: `A list of testimonial items to add to the testimonials section.`,\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'object',\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t'The testimonial item to add to the testimonials section.',\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The name of the person giving the testimonial, in the format of \"First Name\" \"Last Initial\", e.g. \"John D.\"',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\thandle: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The social media handle of the person giving the testimonial, e.g. \"@john_doe\"',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\treview: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The review given by the person, no more than 2 sentences long.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t\t\trequired: [ 'name', 'handle', 'review' ],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'items' ],\n\t\t},\n\t\tstrict: true,\n\t};\n};\n\nexport default addItemToTestimonialsSectionTool;\n","const addContainerToPricingSectionTool = ( {\n\tdescription,\n\titemCount = 5,\n\ttiers = [],\n} ) => {\n\treturn {\n\t\tname: 'add_container_to_pricing_section',\n\t\tdescription: `Adds a new pricing container (group of pricing tiers) to the pricing pattern.\n\t\tThe description of the site is: ${ description }.\n\t\tThe current tiers on the site are: ${ tiers.join( ', ' ) }.\n\t\tGenerate ${ itemCount } pricing tiers according to the description of the site and the current tiers on the site.\n\t\tNEVER ask any follow up questions.\n\t\t`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'A list of pricing tiers to add to the pricing section',\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'object',\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t'The pricing tier to add to the pricing section.',\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription: 'The name of the pricing tier.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tprice: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The price of the pricing tier. If not provided, make something up.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tservices: {\n\t\t\t\t\t\t\t\ttype: 'array',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The services of the pricing tier. If not provided, make up four services.',\n\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t'A short description of the service.',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t\t\trequired: [ 'name', 'price', 'services' ],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'items' ],\n\t\t},\n\t\tstrict: true,\n\t};\n};\n\nexport default addContainerToPricingSectionTool;\n","const addContainerToTeamSectionTool = () => {\n\treturn {\n\t\tname: 'add_container_to_team_section',\n\t\tdescription: `Adds a new container (group of team members) to the team pattern.\n\t\tNEVER ask any follow up questions.\n\t\t`,\n\t};\n};\n\nexport default addContainerToTeamSectionTool;\n","const addMemberToTeamContainerTool = () => {\n\treturn {\n\t\tname: 'add_member_to_team_container',\n\t\tdescription: `Adds a new team member.\n\t\tNEVER ask any follow up questions.`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tclientId: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The clientId of the selected block. DOES NOT have to be a team block.',\n\t\t\t\t},\n\t\t\t\tcount: {\n\t\t\t\t\ttype: 'number',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The number of team members to add. Default to 1.',\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'clientId', 'count' ],\n\t\t},\n\t\tstrict: true,\n\t};\n};\n\nexport default addMemberToTeamContainerTool;\n","import { availableContactFormFields } from './constants.js';\n\nconst modifyContactFormFieldsTool = () => {\n\treturn {\n\t\tname: 'modify_contact_form_fields',\n\t\tdescription:\n\t\t\t'Call this if the user asks to modify the contact form fields, such as adding or removing fields.',\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\taction: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tenum: [ 'insert', 'update', 'delete' ],\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The operation to perform on the contact form fields(add, modify, remove).',\n\t\t\t\t},\n\t\t\t\tfields: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\tdescription: 'The contact form fields to operate on.',\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'object',\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tlabel: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The label of the contact form field.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttype: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The type of the contact form field.',\n\t\t\t\t\t\t\t\tenum: availableContactFormFields,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tblockAttributes: {\n\t\t\t\t\t\t\t\ttype: 'object',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'Additional attributes to update for the field.',\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\trequired: {\n\t\t\t\t\t\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t'Whether the form field is required when submitting the form.',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tnewLabel: {\n\t\t\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t'The new label of the contact form field when updating.',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequired: [ 'label', 'type' ],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'action', 'fields' ],\n\t\t},\n\t\tstrict: false,\n\t};\n};\n\nexport default modifyContactFormFieldsTool;\n","const createUpdateButtonLinkTool = () => {\n\treturn {\n\t\tname: 'update_button_link',\n\t\tdescription:\n\t\t\t'Update a button link for the selected block. This is not used for updating social links.',\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tclientId: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: 'The clientId of the current selected block.',\n\t\t\t\t},\n\t\t\t\turl: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: 'The URL of the button link.',\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'clientId', 'url' ],\n\t\t},\n\t\tstrict: true,\n\t};\n};\n\nexport default createUpdateButtonLinkTool;\n","const rewriteContentTool = () => {\n\treturn {\n\t\tname: 'rewrite_content',\n\t\tdescription: `Rewrite the content from the selected block context to match a user request.\n\t\t\tIf a user requests a change in tone but doesn't provide a specific tone, ask for clarification.\n\t\t\tIf a user requests to translate the content but doesn't provide a language, ask for clarification.\n\t\t\tDo not return any content in your response.`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tcontent: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The list of components with the site specific content to be replaced',\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'object',\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\ti: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The clientId of the content to be replace as provided in the request',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\te: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The content that will replace the selected block content with a similar number of words',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequired: [ 'i', 'e' ],\n\t\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmessage: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'A message to the user summarizing the changes you have made.',\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'content', 'message' ],\n\t\t},\n\t\tstrict: true,\n\t};\n};\n\nexport default rewriteContentTool;\n","/**\n * WordPress dependencies\n */\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useSelect } from '@wordpress/data';\n\nfunction useValidation() {\n\tconst { getBlock } = useSelect( blockEditorStore );\n\n\tconst blockExists = ( clientId ) => {\n\t\treturn !! getBlock( clientId );\n\t};\n\n\tconst isValidClientId = ( clientId ) => {\n\t\tif ( ! clientId ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst regex =\n\t\t\t/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n\t\treturn regex.test( clientId );\n\t};\n\n\treturn {\n\t\tblockExists,\n\t\tisValidClientId,\n\t};\n}\n\nexport default useValidation;\n","/**\n * WordPress dependencies\n */\nimport { createBlock } from '@wordpress/blocks';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { __, sprintf } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport useBlocks from '@hooks/use-blocks';\nimport useVariations from '@hooks/use-variations';\nimport useValidation from '@hooks/use-validation';\nimport { store as aiStore } from '@store';\n\nfunction useButtonToolFunctions() {\n\tconst { getBlock, getBlocksByName } = useSelect( blockEditorStore );\n\tconst { insertBlock, updateBlockAttributes } =\n\t\tuseDispatch( blockEditorStore );\n\tconst { setLastCancelableAction } = useDispatch( aiStore );\n\n\tconst { scrollToBlock } = useBlocks();\n\tconst { getSocialLinkVariations } = useVariations();\n\tconst { isValidClientId, blockExists } = useValidation();\n\n\tconst validateButtonArgs = ( args ) => {\n\t\tif ( ! args ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { clientId } = args;\n\n\t\t// check if client ID is null or invalid and that we have a valid block.\n\t\tif ( ! isValidClientId( clientId ) || ! blockExists( clientId ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst updateButtonLink = async ( parameters ) => {\n\t\tconst { clientId, url } = parameters;\n\n\t\t// If the button is a social link, update other social link buttons using the same service\n\t\tconst block = getBlock( clientId );\n\t\tupdateBlockAttributes( clientId, {\n\t\t\turl,\n\t\t} );\n\n\t\t// Set the last cancelable action to allow the user to undo\n\t\tsetLastCancelableAction( {\n\t\t\taction: 'update_button_link',\n\t\t\tclientId,\n\t\t\toriginalUrl: block.attributes.url,\n\t\t} );\n\n\t\treturn __( 'The link has been updated.', 'big-sky' );\n\t};\n\n\tconst cancelUpdateButtonLink = ( { clientId, originalUrl } ) => {\n\t\tupdateBlockAttributes( clientId, {\n\t\t\turl: originalUrl,\n\t\t} );\n\t};\n\n\tconst validateSocialLinkArgs = ( args ) => {\n\t\tif ( ! args ) {\n\t\t\tthrow new Error(\n\t\t\t\t__(\n\t\t\t\t\t\"Sorry, I can't perform this action at this time.\",\n\t\t\t\t\t'big-sky'\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tconst { service } = args;\n\t\tconst variations = getSocialLinkVariations();\n\t\tconst variation = variations.find( ( v ) => v.name === service );\n\t\tif ( ! variation ) {\n\t\t\tthrow new Error(\n\t\t\t\t__(\n\t\t\t\t\t'Sorry, the provided social media service is not supported.',\n\t\t\t\t\t'big-sky'\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst upsertSocialLink = ( { service, url } ) => {\n\t\t// Get all social-links blocks\n\t\tconst socialLinksBlocks = getBlocksByName( 'core/social-links' );\n\t\tlet action = '';\n\t\tsocialLinksBlocks.forEach( ( id, index ) => {\n\t\t\tconst socialLinksBlock = getBlock( id );\n\t\t\t// Check if the block already has a social link for the service\n\t\t\tconst socialLinkBlock = socialLinksBlock.innerBlocks.find(\n\t\t\t\t( block ) =>\n\t\t\t\t\tblock.name === 'core/social-link' &&\n\t\t\t\t\tblock.attributes.service === service\n\t\t\t);\n\t\t\tif ( ! socialLinkBlock ) {\n\t\t\t\tconst newSocialLinkBlock = createBlock( 'core/social-link', {\n\t\t\t\t\turl,\n\t\t\t\t\tservice,\n\t\t\t\t} );\n\n\t\t\t\tinsertBlock(\n\t\t\t\t\tnewSocialLinkBlock,\n\t\t\t\t\tsocialLinksBlock.innerBlocks.length,\n\t\t\t\t\tid,\n\t\t\t\t\tindex === 0\n\t\t\t\t);\n\t\t\t\taction = 'added';\n\t\t\t} else {\n\t\t\t\t// Update the existing block\n\t\t\t\tupdateBlockAttributes( socialLinkBlock.clientId, {\n\t\t\t\t\turl,\n\t\t\t\t} );\n\t\t\t\taction = 'updated';\n\t\t\t\tif ( index === 0 ) {\n\t\t\t\t\tscrollToBlock( socialLinkBlock.clientId, 'center', true );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\n\t\treturn sprintf(\n\t\t\t// Translators: %1$s is the social link service, %2$s is the action (added/updated).\n\t\t\t__( 'The social link button for %1$s has been %2$s.', 'big-sky' ),\n\t\t\tservice,\n\t\t\taction\n\t\t);\n\t};\n\n\treturn {\n\t\tupdateButtonLink,\n\t\tvalidateButtonArgs,\n\t\tcancelUpdateButtonLink,\n\t\tupsertSocialLink,\n\t\tvalidateSocialLinkArgs,\n\t};\n}\n\nexport default useButtonToolFunctions;\n","/**\n * WordPress dependencies\n */\nimport { createBlock } from '@wordpress/blocks';\nimport { __ } from '@wordpress/i18n';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport useBlocks from '@hooks/use-blocks';\nimport { store as aiStore } from '@store';\nimport setDelay from '@utils/set-delay';\nimport { animationTiming } from '@utils/constants';\nimport { availableContactFormFields } from './constants.js';\n\nconst useContactFormToolFunctions = () => {\n\tconst { canRemoveBlock, getBlock, getBlocksByName } =\n\t\tuseSelect( blockEditorStore );\n\tconst {\n\t\tinsertBlock,\n\t\tremoveBlock,\n\t\treplaceInnerBlocks,\n\t\tupdateBlockAttributes,\n\t} = useDispatch( blockEditorStore );\n\tconst { setBlockBeforeChanges } = useDispatch( aiStore );\n\tconst { setBlockIsProcessing } = useBlocks();\n\n\tconst modifyContactForm = async ( { action, fields } ) => {\n\t\tconst contactFormBlock = getContactFormBlock();\n\n\t\tconst mapActionsToCallbackFunctions = {\n\t\t\tinsert: addContactFormFields,\n\t\t\tupdate: updateContactFormFields,\n\t\t\tdelete: deleteContactFormFields,\n\t\t};\n\n\t\tif ( ! mapActionsToCallbackFunctions[ action ] ) {\n\t\t\tthrow new Error( __( 'Invalid action specified.', 'big-sky' ) );\n\t\t}\n\n\t\tsetBlockBeforeChanges( contactFormBlock );\n\t\tsetBlockIsProcessing( contactFormBlock, true );\n\t\tawait setDelay( animationTiming.visualAdjustmentWaitTime );\n\t\tconst result = await mapActionsToCallbackFunctions[ action ](\n\t\t\tfields,\n\t\t\tcontactFormBlock\n\t\t);\n\t\tsetBlockIsProcessing( contactFormBlock, false );\n\n\t\treturn result;\n\t};\n\n\tconst isAJetpackFormField = ( block ) => {\n\t\treturn (\n\t\t\tblock.name.startsWith( 'jetpack/field-' ) ||\n\t\t\tblock.name === 'jetpack/button'\n\t\t);\n\t};\n\n\tconst getContactFormBlock = () => {\n\t\tconst clientIds = getBlocksByName( 'jetpack/contact-form' );\n\t\treturn clientIds.length ? getBlock( clientIds[ 0 ] ) : null;\n\t};\n\n\tconst getContactFormFields = ( contactFormBlock ) => {\n\t\treturn contactFormBlock.innerBlocks.filter( ( block ) =>\n\t\t\tisAJetpackFormField( block )\n\t\t);\n\t};\n\tconst isContactFormOnPage = () => !! getContactFormBlock();\n\n\tconst addContactFormFields = ( fields, contactFormBlock ) => {\n\t\tconst validFields = fields\n\t\t\t.filter( ( field ) =>\n\t\t\t\tavailableContactFormFields.includes( field.type )\n\t\t\t)\n\t\t\t.map( ( field ) => ( {\n\t\t\t\t...field,\n\t\t\t\ttype: field.type.startsWith( 'jetpack/field-' )\n\t\t\t\t\t? field.type\n\t\t\t\t\t: `jetpack/field-${ field.type }`,\n\t\t\t} ) );\n\n\t\tvalidFields.forEach( ( field ) => {\n\t\t\tconst blockAttributes =\n\t\t\t\tfield.label && field.label.trim() !== ''\n\t\t\t\t\t? { label: field.label }\n\t\t\t\t\t: {};\n\t\t\tconst newBlock = createBlock( field.type, blockAttributes );\n\t\t\tinsertBlock(\n\t\t\t\tnewBlock,\n\t\t\t\tMath.max( contactFormBlock.innerBlocks.length - 1, 0 ),\n\t\t\t\tcontactFormBlock.clientId,\n\t\t\t\tfalse\n\t\t\t);\n\t\t} );\n\n\t\treturn __(\n\t\t\t'I have added the requested fields to the contact form.',\n\t\t\t'big-sky'\n\t\t);\n\t};\n\n\tconst updateContactFormFields = async ( fields, contactFormBlock ) => {\n\t\tconst updatedFields = [];\n\t\tconst notUpdatedFields = [];\n\n\t\t// Get all form field blocks\n\t\tconst formFieldBlocks = getContactFormFields( contactFormBlock );\n\n\t\tfields.forEach( ( field ) => {\n\t\t\t// Find blocks matching the field type\n\t\t\tconst matchingTypeBlocks = formFieldBlocks.filter(\n\t\t\t\t( block ) =>\n\t\t\t\t\tblock.name === `jetpack/field-${ field.type }` ||\n\t\t\t\t\t( block.name === 'jetpack/button' &&\n\t\t\t\t\t\tfield.type === 'button' )\n\t\t\t);\n\n\t\t\tlet blockToUpdate;\n\t\t\tconst fieldLabelKey = field.type === 'button' ? 'text' : 'label';\n\n\t\t\tif ( matchingTypeBlocks.length === 1 ) {\n\t\t\t\t// If there's only one block of this type, update it regardless of label\n\t\t\t\tblockToUpdate = matchingTypeBlocks[ 0 ];\n\t\t\t} else if ( matchingTypeBlocks.length > 1 ) {\n\t\t\t\t// If there are multiple blocks of this type, try to match by label\n\t\t\t\tblockToUpdate = matchingTypeBlocks.find(\n\t\t\t\t\t( block ) =>\n\t\t\t\t\t\tblock.attributes[ fieldLabelKey ]?.toLowerCase() ===\n\t\t\t\t\t\tfield.label.toLowerCase()\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t// The LLM might hallucinate the type but not the label. If there are no blocks of this type, try to match by label.\n\t\t\t\tblockToUpdate = formFieldBlocks.find(\n\t\t\t\t\t( block ) =>\n\t\t\t\t\t\tblock.attributes[ fieldLabelKey ]?.toLowerCase() ===\n\t\t\t\t\t\tfield.label.toLowerCase()\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif ( blockToUpdate ) {\n\t\t\t\tconst updates = {};\n\t\t\t\tif ( field.blockAttributes.required !== undefined ) {\n\t\t\t\t\tupdates.required = field.blockAttributes.required;\n\t\t\t\t}\n\t\t\t\tif ( field.blockAttributes.newLabel ) {\n\t\t\t\t\tif ( field.type === 'button' ) {\n\t\t\t\t\t\tupdates.text = field.blockAttributes.newLabel;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tupdates.label = field.blockAttributes.newLabel;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tupdateBlockAttributes( blockToUpdate.clientId, updates );\n\t\t\t\tupdatedFields.push( field.type );\n\n\t\t\t\t// Remove the block from our local array to avoid double-updating\n\t\t\t\tconst index = formFieldBlocks.findIndex(\n\t\t\t\t\t( b ) => b.clientId === blockToUpdate.clientId\n\t\t\t\t);\n\t\t\t\tif ( index > -1 ) formFieldBlocks.splice( index, 1 );\n\t\t\t} else {\n\t\t\t\tnotUpdatedFields.push( field.type );\n\t\t\t}\n\t\t} );\n\n\t\tlet message = '';\n\n\t\tif ( updatedFields.length > 0 ) {\n\t\t\tmessage +=\n\t\t\t\tupdatedFields.length === 1\n\t\t\t\t\t? __( \"I've updated a field for you.\", 'big-sky' )\n\t\t\t\t\t: __( \"I've updated some fields for you.\", 'big-sky' );\n\t\t} else {\n\t\t\tmessage += __( 'I was not able to update any fields.', 'big-sky' );\n\t\t}\n\n\t\tif ( notUpdatedFields.length > 0 ) {\n\t\t\tmessage +=\n\t\t\t\t'\\n' +\n\t\t\t\t__( 'I could not update the following fields:', 'big-sky' ) +\n\t\t\t\t'\\n';\n\t\t\tmessage += notUpdatedFields.join( '\\n' );\n\t\t}\n\t\treturn message.trim();\n\t};\n\n\tconst deleteContactFormFields = async ( fields, contactFormBlock ) => {\n\t\tconst deletedFields = [];\n\t\tconst notDeletedFields = [];\n\n\t\t// Get all form field blocks\n\t\tconst formFieldBlocks = getContactFormFields( contactFormBlock );\n\n\t\tfields.forEach( ( field ) => {\n\t\t\t// Find blocks matching the field type\n\t\t\tconst matchingTypeBlocks = formFieldBlocks.filter(\n\t\t\t\t( block ) => block.name === `jetpack/field-${ field.type }`\n\t\t\t);\n\n\t\t\tlet blockToRemove;\n\n\t\t\tif ( matchingTypeBlocks.length === 1 ) {\n\t\t\t\t// If there's only one block of this type, remove it regardless of label\n\t\t\t\tblockToRemove = matchingTypeBlocks[ 0 ];\n\t\t\t} else if ( matchingTypeBlocks.length > 1 ) {\n\t\t\t\t// If there are multiple blocks of this type, try to match by label\n\t\t\t\tblockToRemove = matchingTypeBlocks.find(\n\t\t\t\t\t( block ) =>\n\t\t\t\t\t\tblock.attributes.label.toLowerCase() ===\n\t\t\t\t\t\tfield.label.toLowerCase()\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t// The LLM might hallucinate the type but not the label. If there are no blocks of this type, try to match by label.\n\t\t\t\tblockToRemove = formFieldBlocks.find(\n\t\t\t\t\t( block ) =>\n\t\t\t\t\t\tblock.attributes.label.toLowerCase() ===\n\t\t\t\t\t\tfield.label.toLowerCase()\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif ( blockToRemove && canRemoveBlock( blockToRemove.clientId ) ) {\n\t\t\t\tremoveBlock( blockToRemove.clientId, false );\n\t\t\t\tdeletedFields.push( {\n\t\t\t\t\ttype: field.type,\n\t\t\t\t\tlabel: blockToRemove.attributes.label,\n\t\t\t\t} );\n\t\t\t\t// Remove the block from our local array to avoid double-deletion\n\t\t\t\tconst index = formFieldBlocks.findIndex(\n\t\t\t\t\t( b ) => b.clientId === blockToRemove.clientId\n\t\t\t\t);\n\t\t\t\tif ( index > -1 ) formFieldBlocks.splice( index, 1 );\n\t\t\t} else {\n\t\t\t\tnotDeletedFields.push( field );\n\t\t\t}\n\t\t} );\n\n\t\tlet message = '';\n\n\t\tif ( deletedFields.length > 0 ) {\n\t\t\tmessage +=\n\t\t\t\tdeletedFields.length === 1\n\t\t\t\t\t? __( 'I deleted a field for you.', 'big-sky' )\n\t\t\t\t\t: __( 'I deleted some fields for you.', 'big-sky' );\n\t\t}\n\n\t\tif ( notDeletedFields.length > 0 ) {\n\t\t\tmessage +=\n\t\t\t\t'\\n' +\n\t\t\t\t__( 'I could not delete the following fields:', 'big-sky' ) +\n\t\t\t\t'\\n' +\n\t\t\t\tnotDeletedFields.map( ( f ) => `${ f.label }` ).join( '\\n' ) +\n\t\t\t\t'. ';\n\t\t}\n\n\t\tif ( deletedFields.length === 0 && notDeletedFields.length === 0 ) {\n\t\t\tmessage = __( 'No fields were deleted.', 'big-sky' );\n\t\t}\n\n\t\treturn message.trim();\n\t};\n\n\tconst validateContactFormArgs = ( { action, fields } ) => {\n\t\tif ( ! getContactFormBlock() ) {\n\t\t\tthrow new Error(\n\t\t\t\t__(\n\t\t\t\t\t'No contact form block found on this page. Have you added one yet?',\n\t\t\t\t\t'big-sky'\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t\tif ( ! Array.isArray( fields ) ) {\n\t\t\tthrow new Error(\n\t\t\t\t__(\n\t\t\t\t\t'Please specify the field(s) to modify in the contact form.',\n\t\t\t\t\t'big-sky'\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t\tif (\n\t\t\tfields.some( ( field ) => field.type === 'button' ) &&\n\t\t\taction === 'delete'\n\t\t) {\n\t\t\tthrow new Error(\n\t\t\t\t__(\n\t\t\t\t\t'I cannot delete the button field, as it is required to submit the form. Instead, I can change the label for you.',\n\t\t\t\t\t'big-sky'\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t\tif (\n\t\t\tfields.some( ( field ) => field.type === 'button' ) &&\n\t\t\taction === 'insert'\n\t\t) {\n\t\t\tthrow new Error(\n\t\t\t\t__(\n\t\t\t\t\t\"The contact form can only have one button. I can change the button's label for you, if you like.\",\n\t\t\t\t\t'big-sky'\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t\tif (\n\t\t\t! fields.some( ( field ) =>\n\t\t\t\tavailableContactFormFields.includes( field.type )\n\t\t\t)\n\t\t) {\n\t\t\tthrow new Error(\n\t\t\t\t__(\n\t\t\t\t\t'It seems that a field type you specified is not valid. Please specify a valid field type in the contact form.',\n\t\t\t\t\t'big-sky'\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t\tif ( ! [ 'insert', 'update', 'delete' ].includes( action ) ) {\n\t\t\tthrow new Error(\n\t\t\t\t__(\n\t\t\t\t\t'Something went wrong when trying to modify the contact form. Please try again.',\n\t\t\t\t\t'big-sky'\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t\treturn true;\n\t};\n\n\tconst cancelModifyContactForm = ( clientId, originalInnerBlocks ) => {\n\t\treplaceInnerBlocks( clientId, originalInnerBlocks, false );\n\t};\n\n\treturn {\n\t\tcancelModifyContactForm,\n\t\tisContactFormOnPage,\n\t\tmodifyContactForm,\n\t\tvalidateContactFormArgs,\n\t};\n};\n\nexport default useContactFormToolFunctions;\n","/**\n * WordPress dependencies\n */\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { store as coreStore } from '@wordpress/core-data';\n\n/**\n * Internal dependencies\n */\nimport useBlocks from '@hooks/use-blocks';\nimport { store as aiStore } from '@store';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport useGeocoder from '@hooks/use-geocoder';\nimport { dockViews } from '@utils/constants';\n\nfunction useAddressToolFunctions() {\n\tconst { getBlock, getBlocks, getBlocksByName } = useSelect(\n\t\t( select ) => ( {\n\t\t\tgetBlock: select( blockEditorStore ).getBlock,\n\t\t\tgetBlocks: select( blockEditorStore ).getBlocks,\n\t\t\tgetBlocksByName: select( blockEditorStore ).getBlocksByName,\n\t\t} )\n\t);\n\n\tconst { updateBlockAttributes } = useDispatch( blockEditorStore );\n\tconst { setLastCancelableAction } = useDispatch( aiStore );\n\tconst { getSiteMetadata, setSiteMetadata } = useSiteMetadata();\n\tconst { getTemplatePartClientID, getContentBlockClientID } = useBlocks();\n\tconst { getCoordinates } = useGeocoder();\n\tconst { setDockView } = useDispatch( aiStore );\n\n\tconst settings = useSelect( ( select ) => {\n\t\tconst _settings = select( coreStore ).getEntityRecord( 'root', 'site' );\n\t\treturn { siteTitle: _settings?.title ?? '' };\n\t} );\n\n\tconst validateAddressArgs = ( args ) => !! ( args && args.address );\n\n\tconst updateAddress = async ( parameters ) => {\n\t\ttry {\n\t\t\tconst newAddress = await updateAddressOnPage( parameters );\n\t\t\tconst newCoordinates = await updateMapMarker( parameters );\n\n\t\t\tconst { siteLocation } = getSiteMetadata();\n\t\t\tconst oldAddress = siteLocation?.name;\n\n\t\t\tsetLastCancelableAction( {\n\t\t\t\taction: 'update_address',\n\t\t\t\taddress: oldAddress,\n\t\t\t\tcoordinates: siteLocation?.coordinates,\n\t\t\t} );\n\n\t\t\tsetSiteMetadata(\n\t\t\t\t{\n\t\t\t\t\tsiteLocation: {\n\t\t\t\t\t\tname: newAddress,\n\t\t\t\t\t\tcoordinates: newCoordinates,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\treturn sprintf(\n\t\t\t\t// Translators: %s is the new address.\n\t\t\t\t__( 'Your address has been updated to \"%s\".', 'big-sky' ),\n\t\t\t\tnewAddress\n\t\t\t);\n\t\t} catch ( error ) {\n\t\t\tconsole.error( 'Error updating address:', error );\n\t\t\treturn false;\n\t\t}\n\t};\n\n\tconst cancelUpdateAddress = async ( parameters ) => {\n\t\ttry {\n\t\t\tawait updateAddressOnPage( { ...parameters, isUndo: true } );\n\t\t\tawait updateMapMarker( { ...parameters, isUndo: true } );\n\n\t\t\tsetSiteMetadata(\n\t\t\t\t{\n\t\t\t\t\tsiteLocation: {\n\t\t\t\t\t\tname: parameters.address,\n\t\t\t\t\t\tcoordinates: parameters.coordinates,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\tsetDockView( dockViews.MENUS );\n\n\t\t\treturn true;\n\t\t} catch ( error ) {\n\t\t\tconsole.error( 'Error canceling address update:', error );\n\t\t\treturn false;\n\t\t}\n\t};\n\n\tconst updateAddressOnPage = async ( parameters ) => {\n\t\tconst { address: newAddress } = parameters;\n\t\tconst { siteLocation } = getSiteMetadata();\n\t\tconst oldAddress = siteLocation?.name;\n\t\tif ( ! oldAddress ) {\n\t\t\t// There's nothing to update on the page.\n\t\t\treturn newAddress;\n\t\t}\n\n\t\tconst headerBlocks = getBlocks( getTemplatePartClientID( 'header' ) );\n\t\tconst footerBlocks = getBlocks( getTemplatePartClientID( 'footer' ) );\n\t\tconst contentBlocks = getBlocks( getContentBlockClientID() );\n\n\t\tconst blocks = [ ...headerBlocks, ...footerBlocks, ...contentBlocks ];\n\n\t\tblocks.forEach( ( block ) =>\n\t\t\tfindAndUpdateAddress( block, oldAddress, newAddress )\n\t\t);\n\n\t\treturn newAddress;\n\t};\n\n\tconst findAndUpdateAddress = ( block, oldAddress, newAddress ) => {\n\t\tif (\n\t\t\tblock.name === 'core/heading' ||\n\t\t\tblock.name === 'core/paragraph'\n\t\t) {\n\t\t\tconst content = block.attributes.content || '';\n\t\t\tconst normalizedContent = normalizeAddress(\n\t\t\t\tcontent?.text || content\n\t\t\t);\n\t\t\tconst normalizedOldAddress = normalizeAddress(\n\t\t\t\toldAddress?.name || oldAddress\n\t\t\t);\n\n\t\t\tif ( ! normalizedContent.includes( normalizedOldAddress ) )\n\t\t\t\treturn false;\n\n\t\t\tconst regex = new RegExp(\n\t\t\t\tescapeRegExp( oldAddress ).replace( /[\\s,]+/g, '[\\\\s,]*' ),\n\t\t\t\t'gi'\n\t\t\t);\n\t\t\tconst newContent = content.replace( regex, newAddress ?? '' );\n\t\t\tupdateBlockAttributes( block.clientId, { content: newContent } );\n\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( block.innerBlocks && block.innerBlocks.length > 0 ) {\n\t\t\treturn block.innerBlocks.forEach( ( innerBlock ) =>\n\t\t\t\tfindAndUpdateAddress( innerBlock, oldAddress, newAddress )\n\t\t\t);\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tconst updateMapMarker = async ( parameters ) => {\n\t\tconst { address: newAddress, coordinates, isUndo } = parameters;\n\n\t\tconst newCoordinates = isUndo\n\t\t\t? coordinates\n\t\t\t: await getCoordinates( newAddress );\n\t\tif ( ! newCoordinates && ! isUndo ) return;\n\n\t\tconst mapBlocks = getBlocksByName( 'jetpack/map' );\n\n\t\tmapBlocks.forEach( ( mapBlockClientId ) => {\n\t\t\tconst mapBlock = getBlock( mapBlockClientId );\n\t\t\tconst updatedPoints = newCoordinates\n\t\t\t\t? [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tplaceTitle: newAddress ?? '',\n\t\t\t\t\t\t\ttitle: settings.siteTitle || ( newAddress ?? '' ),\n\t\t\t\t\t\t\tcaption: '',\n\t\t\t\t\t\t\t/* eslint-disable-next-line no-restricted-syntax */\n\t\t\t\t\t\t\tid: `place.${ Math.random() }`,\n\t\t\t\t\t\t\tcoordinates: {\n\t\t\t\t\t\t\t\tlatitude: newCoordinates[ 0 ],\n\t\t\t\t\t\t\t\tlongitude: newCoordinates[ 1 ],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t  ]\n\t\t\t\t: [];\n\n\t\t\tupdateBlockAttributes( mapBlock.clientId, {\n\t\t\t\tmapCenter: {\n\t\t\t\t\tlat: newCoordinates?.[ 0 ] ?? 0,\n\t\t\t\t\tlng: newCoordinates?.[ 1 ] ?? 0,\n\t\t\t\t},\n\t\t\t\tpoints: updatedPoints,\n\t\t\t} );\n\t\t} );\n\n\t\treturn newCoordinates;\n\t};\n\n\tconst normalizeAddress = ( address ) =>\n\t\taddress.replace( /[\\s,]+/g, '' ).toLowerCase();\n\tconst escapeRegExp = ( string ) =>\n\t\tstring.replace( /[.*+?^${}()|[\\]\\\\]/g, '\\\\$&' );\n\n\treturn {\n\t\tupdateAddress,\n\t\tvalidateAddressArgs,\n\t\tcancelUpdateAddress,\n\t};\n}\n\nexport default useAddressToolFunctions;\n","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"richText\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"components\"];","/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __unstableMotion as motion } from '@wordpress/components';\nimport { useRef } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { recordTracksEvent } from '@utils/tracks';\nimport './style.scss';\n\nconst ActionCarousel = ( { actions, animationVariants = {} } ) => {\n\tconst sliderRef = useRef();\n\tlet isDown = false;\n\tlet startX;\n\tlet scrollLeft;\n\n\tconst isConfirmationActions = actions.some(\n\t\t( action ) =>\n\t\t\ttypeof action?.type === 'string' &&\n\t\t\taction.type?.startsWith( 'confirmation' )\n\t);\n\n\tconst handlePointerDown = ( e ) => {\n\t\tisDown = true;\n\t\tsliderRef.current.classList.add( 'active' );\n\t\tstartX = e.pageX - sliderRef.current.offsetLeft;\n\t\tscrollLeft = sliderRef.current.scrollLeft;\n\t};\n\n\tconst handlePointerLeave = () => {\n\t\tisDown = false;\n\t\tsliderRef.current.classList.remove( 'active' );\n\t};\n\n\tconst handlePointerUp = () => {\n\t\tisDown = false;\n\t\tsliderRef.current.classList.remove( 'active' );\n\t};\n\n\tconst handlePointerMove = ( e ) => {\n\t\tif ( ! isDown ) return;\n\t\te.preventDefault();\n\t\tconst x = e.pageX - sliderRef.current.offsetLeft;\n\t\tconst walk = ( x - startX ) * 2;\n\t\tsliderRef.current.scrollLeft = scrollLeft - walk;\n\t};\n\n\treturn (\n\t\t<div\n\t\t\tclassName={ classnames( 'big-sky__chat-actions', {\n\t\t\t\t'has-confirmation-actions': isConfirmationActions,\n\t\t\t} ) }\n\t\t>\n\t\t\t<div\n\t\t\t\tclassName={ classnames( 'big-sky__chat-actions__carousel', {\n\t\t\t\t\tdraggable: actions.length > 1,\n\t\t\t\t} ) }\n\t\t\t\tref={ sliderRef }\n\t\t\t\trole=\"region\"\n\t\t\t\ttabIndex={ 0 }\n\t\t\t\t{ ...( actions.length > 1 && {\n\t\t\t\t\t// Conditionally apply event handlers\n\t\t\t\t\tonPointerDown: handlePointerDown,\n\t\t\t\t\tonPointerLeave: handlePointerLeave,\n\t\t\t\t\tonPointerUp: handlePointerUp,\n\t\t\t\t\tonPointerMove: handlePointerMove,\n\t\t\t\t} ) }\n\t\t\t>\n\t\t\t\t{ actions.map( ( action, index ) => (\n\t\t\t\t\t<motion.button\n\t\t\t\t\t\tinitial={ animationVariants.initial || {} }\n\t\t\t\t\t\tanimate={ animationVariants.animate || {} }\n\t\t\t\t\t\texit={ animationVariants.exit || {} }\n\t\t\t\t\t\ttransition={ {\n\t\t\t\t\t\t\t...( animationVariants.transition || {} ),\n\t\t\t\t\t\t\tdelay:\n\t\t\t\t\t\t\t\tindex *\n\t\t\t\t\t\t\t\t( animationVariants.transition?.delay || 0 ),\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tkey={ action.key }\n\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\tif ( action.action_type === 'suggested' ) {\n\t\t\t\t\t\t\t\trecordTracksEvent( 'chat_suggestion_click', {\n\t\t\t\t\t\t\t\t\taction_key: action.key,\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trecordTracksEvent( 'chat_action_click', {\n\t\t\t\t\t\t\t\t\taction_key: action.key,\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\taction.onClick();\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\t'big-sky__chat-actions__carousel__item',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t'confirmation-action':\n\t\t\t\t\t\t\t\t\taction.type === 'confirmation',\n\t\t\t\t\t\t\t\t'confirmation-action-destructive':\n\t\t\t\t\t\t\t\t\taction.type === 'confirmationDestructive',\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t) }\n\t\t\t\t\t\ttitle={ action.description }\n\t\t\t\t\t>\n\t\t\t\t\t\t<h5>{ action.actionName }</h5>\n\t\t\t\t\t\t{ action.description && <p>{ action.description }</p> }\n\t\t\t\t\t</motion.button>\n\t\t\t\t) ) }\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\nexport default ActionCarousel;\n","/**\n * WordPress dependencies\n */\nimport { uploadMedia } from '@wordpress/media-utils';\n/**\n * External dependencies\n */\nimport { checkIfBrowserSupported, takeScreenshot } from '@xata.io/screenshot';\n/**\n * Internal dependencies\n */\nimport logAction from './log-action.js';\nimport { messageRoles } from './constants.js';\nimport log from './log-debug.js';\n\nfunction base64ToFile( base64String, filename ) {\n\t// Decode base64\n\tconst arr = base64String.split( ',' );\n\tconst mime = arr[ 0 ].match( /:(.*?);/ )[ 1 ];\n\tconst bstr = atob( arr[ 1 ] );\n\tlet n = bstr.length;\n\tconst u8arr = new Uint8Array( n );\n\n\twhile ( n-- ) {\n\t\tu8arr[ n ] = bstr.charCodeAt( n );\n\t}\n\n\t// Return a new File() object\n\treturn new File( [ u8arr ], filename, { type: mime } );\n}\n\nconst logScreenshot = async ( sessionId ) => {\n\t/**\n\t * Only do this if your browser supports it.\n\t * To check, visit https://caniuse.com/mdn-api_mediadevices_getdisplaymedia\n\t */\n\tif ( checkIfBrowserSupported() ) {\n\t\tconst screenshot = await takeScreenshot();\n\n\t\t/**\n\t\t * This is a base64-encoded string representing the screenshot.\n\t\t * It can go directly into an <img>'s `src` attribute, or be sent to a server to store.\n\t\t */\n\t\tconst imageFile = base64ToFile( screenshot, 'screenshot.jpg' );\n\n\t\tconst handleFileChange = ( files ) => {\n\t\t\tconst fileUrl = files[ 0 ].url;\n\t\t\t// if it's a string, upload as a comment - if it's a blob, it's not uploaded yet\n\t\t\tif ( typeof fileUrl === 'string' && fileUrl.startsWith( 'http' ) ) {\n\t\t\t\tlogAction(\n\t\t\t\t\tsessionId,\n\t\t\t\t\t`<img style=\"max-width: 100%\" src=\"${ fileUrl }\" />`,\n\t\t\t\t\tmessageRoles.SCREENSHOT\n\t\t\t\t);\n\t\t\t}\n\t\t};\n\n\t\tconst handleFileError = ( error ) => {\n\t\t\tlog.error( 'file error', error );\n\t\t};\n\n\t\tawait uploadMedia( {\n\t\t\tfilesList: [ imageFile ],\n\t\t\tonFileChange: handleFileChange,\n\t\t\tonError: handleFileError,\n\t\t} );\n\t}\n};\n\nexport default logScreenshot;\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport doLogSession from '@utils/log-session';\nimport logScreenshotForSession from '@utils/log-screenshot';\nimport realLogMessage from '@utils/log-message';\nimport realLogAction from '@utils/log-action';\nimport { store as aiStore } from '@store';\nimport { messageRoles } from '@utils/constants';\n\nexport default function useLog() {\n\tconst { isSessionLogged, shouldLogSessions, sessionId } = useSelect(\n\t\t( select ) => ( {\n\t\t\tsessionId: select( aiStore ).getSessionId(),\n\t\t\tshouldLogSessions: select( aiStore ).shouldLogSessions(),\n\t\t\tisSessionLogged: select( aiStore ).isSessionLogged(),\n\t\t} )\n\t);\n\n\tconst setSessionSessionLogged = useDispatch( aiStore ).setSessionLogged;\n\n\tasync function logMessage( message ) {\n\t\tif ( await maybeLogSession() ) {\n\t\t\treturn await realLogMessage( sessionId, message );\n\t\t}\n\t}\n\n\tasync function logAction(\n\t\tcontent,\n\t\tmessageRole = '',\n\t\tmessageId = '',\n\t\tparentMessageId = ''\n\t) {\n\t\tif ( await maybeLogSession() ) {\n\t\t\treturn await realLogAction(\n\t\t\t\tsessionId,\n\t\t\t\tcontent,\n\t\t\t\tmessageRole,\n\t\t\t\tmessageId,\n\t\t\t\tparentMessageId\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Logs a tool call.\n\t *\n\t * @param {*} content\n\t * @param {*} messageId\n\t */\n\tasync function logToolCall( content, messageId = '' ) {\n\t\treturn await logAction( content, messageRoles.TOOL_CALL, messageId );\n\t}\n\n\t/**\n\t * Logs an assistant message.\n\t *\n\t * @param {*} content\n\t * @param {*} messageId\n\t */\n\tasync function logAssistantMessage( content, messageId = '' ) {\n\t\treturn await logAction( content, messageRoles.ASSISTANT, messageId );\n\t}\n\n\t/**\n\t * Logs a user message typed in the chat input.\n\t *\n\t * @param {*} content\n\t * @param {*} messageId\n\t * @param {*} parentMessageId\n\t */\n\tasync function logUserMessage( content, messageId, parentMessageId ) {\n\t\treturn await logAction(\n\t\t\tcontent,\n\t\t\tmessageRoles.USER,\n\t\t\tmessageId,\n\t\t\tparentMessageId\n\t\t);\n\t}\n\n\t/**\n\t * Logs a user choice of a suggestion.\n\t *\n\t * @param {*} content\n\t * @param {*} messageId\n\t * @param {*} parentMessageId\n\t */\n\tasync function logUserChoice( content, messageId, parentMessageId ) {\n\t\treturn await logAction(\n\t\t\tcontent,\n\t\t\tmessageRoles.USER_CHOICE,\n\t\t\tmessageId,\n\t\t\tparentMessageId\n\t\t);\n\t}\n\n\tasync function maybeLogSession() {\n\t\tif ( isSessionLogged ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( ! shouldLogSessions ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tawait doLogSession( sessionId );\n\t\tsetSessionSessionLogged( true );\n\t\treturn true;\n\t}\n\n\tasync function logError( error ) {\n\t\tif ( typeof error === 'object' ) {\n\t\t\terror = JSON.stringify( error );\n\t\t}\n\t\treturn await logAction( error, messageRoles.ERROR );\n\t}\n\n\tasync function logScreenshot() {\n\t\tif ( await maybeLogSession() ) {\n\t\t\treturn await logScreenshotForSession( sessionId );\n\t\t}\n\t}\n\n\treturn {\n\t\tlogSession: maybeLogSession,\n\t\tlogScreenshot,\n\t\tlogMessage,\n\t\tlogAction,\n\t\tlogError,\n\t\tlogUserChoice,\n\t\tlogUserMessage,\n\t\tlogToolCall,\n\t\tlogAssistantMessage,\n\t};\n}\n","/**\n * Internal dependencies\n */\nimport logAction from './log-action.js';\nimport { messageRoles } from './constants.js';\n\nexport default async function logMessage( sessionId, message ) {\n\tif ( ! sessionId ) {\n\t\treturn;\n\t}\n\n\tlet content = message.content;\n\n\t// if the content is a react component,\n\n\tif ( message.role === messageRoles.COMPONENT ) {\n\t\tconst componentTitle = content.type.name;\n\t\tcontent = `Component: &lt;${ componentTitle }/&gt;`;\n\t} else if ( typeof content !== 'string' ) {\n\t\tcontent = JSON.stringify( content );\n\t}\n\n\treturn await logAction(\n\t\tsessionId,\n\t\tcontent,\n\t\tmessage.role,\n\t\tmessage.id,\n\t\tmessage.parentId\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useCallback, useEffect, useState } from '@wordpress/element';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useToolkits } from '@automattic/big-sky-agents';\nimport { store as aiStore } from '@store';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\nimport { customSectionNames } from '@ai/tasks/replace-content/section-types';\nimport usePatterns from '@hooks/use-patterns';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport ActionCarousel from './action-carousel.js';\nimport useLog from '@hooks/use-log';\nimport { getAssistantById } from '@ai/assistants/assistant-registry';\nimport { ASSISTANTS } from '@ai/assistants/constants.js';\n\nexport default function ChatActions( {\n\tuseBlockContext = true,\n\tonActionClick,\n\tactions: propActions = [],\n\tanimationVariants = {},\n} ) {\n\tconst [ actions, setActions ] = useState( [] );\n\tconst { getParentPatternCategory, getItems, getSections } = usePatterns();\n\tconst { isOnboarded } = useSiteMetadata().getSiteMetadata();\n\tconst { selectedBlock } = useSelect( ( select ) => {\n\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\t\treturn {\n\t\t\tselectedBlock: getSelectedBlock(),\n\t\t};\n\t} );\n\tconst { callbacks } = useToolkits();\n\tconst { setCurrentUserMessage, setShowThread } = useDispatch( aiStore );\n\tconst { logUserChoice } = useLog();\n\n\tconst assistant = getAssistantById( ASSISTANTS.CONTENT );\n\tconst toolkitHook = assistant?.toolkitHook;\n\tconst { callbacks: contentCallbacks } = toolkitHook ? toolkitHook() : {};\n\n\tconst handleActionClick = useCallback(\n\t\t( message ) => {\n\t\t\tsetShowThread( true );\n\t\t\tlogUserChoice( message );\n\t\t\tsetCurrentUserMessage( message );\n\t\t\tonActionClick( message );\n\t\t},\n\t\t[ logUserChoice, onActionClick, setCurrentUserMessage, setShowThread ] // Ensure the callback is updated when callbacks change\n\t);\n\n\tconst getEventsActions = useCallback( () => {\n\t\tconst eventsActions = [];\n\t\tconst eventsItems = getItems( 'events' );\n\t\tif ( eventsItems ) {\n\t\t\teventsActions.push( {\n\t\t\t\tkey: 'events-add-item',\n\t\t\t\tactionName: __( 'Add a new item', 'big-sky' ),\n\t\t\t\tdescription: __( 'to the events', 'big-sky' ),\n\t\t\t\tonClick: () => {\n\t\t\t\t\tif ( contentCallbacks?.add_item_to_events_container ) {\n\t\t\t\t\t\tcontentCallbacks.add_item_to_events_container( {\n\t\t\t\t\t\t\tclientId: selectedBlock.clientId,\n\t\t\t\t\t\t\tcount: 1,\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t\t__( 'Add a new item to the events.', 'big-sky' )\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t} );\n\t\t}\n\t\tconst eventsSections = getSections( 'events' );\n\t\tif ( eventsSections ) {\n\t\t\teventsActions.unshift( {\n\t\t\t\tkey: 'events-add-section',\n\t\t\t\tactionName: __( 'Add a new row', 'big-sky' ),\n\t\t\t\tdescription: __( 'to the events', 'big-sky' ),\n\t\t\t\tonClick: () => {\n\t\t\t\t\tif ( contentCallbacks?.add_container_to_events_section ) {\n\t\t\t\t\t\tcontentCallbacks.add_container_to_events_section();\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t\t__( 'Add a new row to the events.', 'big-sky' )\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t} );\n\t\t}\n\t\treturn eventsActions;\n\t}, [\n\t\tcontentCallbacks,\n\t\tgetItems,\n\t\tgetSections,\n\t\thandleActionClick,\n\t\tselectedBlock,\n\t] );\n\n\tconst getMenuActions = useCallback( () => {\n\t\tconst menuActions = [\n\t\t\t{\n\t\t\t\tkey: 'menu-add-item',\n\t\t\t\tactionName: __( 'Add a new item', 'big-sky' ),\n\t\t\t\tdescription: __( 'to the menu', 'big-sky' ),\n\t\t\t\tonClick: () => {\n\t\t\t\t\tif ( contentCallbacks?.add_item_to_menu_container ) {\n\t\t\t\t\t\tcontentCallbacks.add_item_to_menu_container( {\n\t\t\t\t\t\t\tclientId: selectedBlock.clientId,\n\t\t\t\t\t\t\tcount: 1,\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t\t__( 'Add a new item to the menu.', 'big-sky' )\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\t\tconst menuSections = getSections( 'menu' );\n\t\tif ( menuSections ) {\n\t\t\tmenuActions.unshift( {\n\t\t\t\tkey: 'menu-add-section',\n\t\t\t\tactionName: __( 'Add a new section', 'big-sky' ),\n\t\t\t\tdescription: __( 'to the menu', 'big-sky' ),\n\t\t\t\tonClick: () => {\n\t\t\t\t\tif ( contentCallbacks?.add_container_to_menu_section ) {\n\t\t\t\t\t\tcontentCallbacks.add_container_to_menu_section( {\n\t\t\t\t\t\t\ttitle: 'New Section',\n\t\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: 'New Item',\n\t\t\t\t\t\t\t\t\tdescription: 'New Item Description',\n\t\t\t\t\t\t\t\t\tprice: '10',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t\t__( 'Add a new section to the menu.', 'big-sky' )\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t} );\n\t\t}\n\t\treturn menuActions;\n\t}, [ contentCallbacks, getSections, handleActionClick, selectedBlock ] );\n\n\tconst getPricingActions = useCallback( () => {\n\t\treturn [\n\t\t\t{\n\t\t\t\tkey: 'pricing-add-section',\n\t\t\t\tactionName: __( 'Add a row', 'big-sky' ),\n\t\t\t\tdescription: __( 'to the pricing section', 'big-sky' ),\n\t\t\t\tonClick: () => {\n\t\t\t\t\tif ( contentCallbacks?.add_container_to_pricing_section ) {\n\t\t\t\t\t\tcontentCallbacks.add_container_to_pricing_section( {\n\t\t\t\t\t\t\titems: [],\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t'Add a new row to the pricing section.',\n\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\t}, [ contentCallbacks, handleActionClick ] );\n\n\tconst getServicesActions = useCallback( () => {\n\t\tconst servicesSections = getSections( 'services' );\n\t\tif ( servicesSections ) {\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tkey: 'services-add-service',\n\t\t\t\t\tactionName: __( 'Add a row', 'big-sky' ),\n\t\t\t\t\tdescription: __( 'to the services', 'big-sky' ),\n\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tcontentCallbacks?.add_container_to_services_section\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tcontentCallbacks.add_container_to_services_section();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t'Add a new row to the services.',\n\t\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\t\treturn [];\n\t}, [ getSections, contentCallbacks, handleActionClick ] );\n\n\tconst getTestimonialsActions = useCallback( () => {\n\t\treturn [\n\t\t\t{\n\t\t\t\tkey: 'testimonials-add-testimonial',\n\t\t\t\tactionName: __( 'Add a row', 'big-sky' ),\n\t\t\t\tdescription: __( 'to the testimonials', 'big-sky' ),\n\t\t\t\tonClick: () => {\n\t\t\t\t\tif ( contentCallbacks?.add_item_to_testimonials_section ) {\n\t\t\t\t\t\tcontentCallbacks.add_item_to_testimonials_section();\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t'Add a new row to the testimonials.',\n\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\t}, [ contentCallbacks, handleActionClick ] );\n\n\tconst getTeamActions = useCallback( () => {\n\t\tconst teamActions = [];\n\t\tconst teamItems = getItems( 'team' );\n\t\tif ( teamItems ) {\n\t\t\tteamActions.push( {\n\t\t\t\tkey: 'team-add-member',\n\t\t\t\tactionName: __( 'Add a new member', 'big-sky' ),\n\t\t\t\tdescription: __( 'to the team', 'big-sky' ),\n\t\t\t\tonClick: () => {\n\t\t\t\t\tif ( contentCallbacks?.add_member_to_team_container ) {\n\t\t\t\t\t\tcontentCallbacks.add_member_to_team_container( {\n\t\t\t\t\t\t\tclientId: selectedBlock.clientId,\n\t\t\t\t\t\t\tcount: 1,\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t\t__( 'Add a new member to the team.', 'big-sky' )\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t} );\n\t\t}\n\t\tconst teamSections = getSections( 'team' );\n\t\tif ( teamSections ) {\n\t\t\tteamActions.unshift( {\n\t\t\t\tkey: 'team-add-section',\n\t\t\t\tactionName: __( 'Add a new section', 'big-sky' ),\n\t\t\t\tdescription: __( 'to the team', 'big-sky' ),\n\t\t\t\tonClick: () => {\n\t\t\t\t\tif ( contentCallbacks?.add_container_to_team_section ) {\n\t\t\t\t\t\tcontentCallbacks.add_container_to_team_section();\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t\t__( 'Add a new section to the team.', 'big-sky' )\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t} );\n\t\t}\n\t\treturn teamActions;\n\t}, [\n\t\tcontentCallbacks,\n\t\tgetItems,\n\t\tgetSections,\n\t\thandleActionClick,\n\t\tselectedBlock,\n\t] );\n\n\tconst getBigSkyPatternActions = useCallback(\n\t\t( category ) => {\n\t\t\tswitch ( category ) {\n\t\t\t\tcase 'events':\n\t\t\t\t\treturn getEventsActions();\n\t\t\t\tcase 'menu':\n\t\t\t\t\treturn getMenuActions();\n\t\t\t\tcase 'pricing':\n\t\t\t\t\treturn getPricingActions();\n\t\t\t\tcase 'services':\n\t\t\t\t\treturn getServicesActions();\n\t\t\t\tcase 'testimonials':\n\t\t\t\t\treturn getTestimonialsActions();\n\t\t\t\tcase 'team':\n\t\t\t\t\treturn getTeamActions();\n\t\t\t\tdefault:\n\t\t\t\t\treturn [];\n\t\t\t}\n\t\t},\n\t\t[\n\t\t\tgetEventsActions,\n\t\t\tgetMenuActions,\n\t\t\tgetPricingActions,\n\t\t\tgetServicesActions,\n\t\t\tgetTestimonialsActions,\n\t\t\tgetTeamActions,\n\t\t]\n\t);\n\n\tconst getBaseActions = useCallback( () => {\n\t\tconst bigSkyPatternActions = [];\n\t\t// check if the selected block is a custom section type\n\t\tif ( selectedBlock ) {\n\t\t\tconst parentPatternCategory =\n\t\t\t\tgetParentPatternCategory( selectedBlock );\n\t\t\tif ( customSectionNames.includes( parentPatternCategory ) ) {\n\t\t\t\tbigSkyPatternActions.push(\n\t\t\t\t\t...getBigSkyPatternActions( parentPatternCategory )\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tconst siteActions = [\n\t\t\t{\n\t\t\t\tkey: 'site-add-page',\n\t\t\t\tactionName: __( 'Add a page', 'big-sky' ),\n\t\t\t\tdescription: __( 'to my website', 'big-sky' ),\n\t\t\t\tonClick: () => {\n\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t__( 'Add a new page to my website.', 'big-sky' )\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: 'site-change-colors',\n\t\t\t\tactionName: __( 'Change the colors', 'big-sky' ),\n\t\t\t\tdescription: __( 'of my website', 'big-sky' ),\n\t\t\t\tonClick: () => {\n\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t__( 'Change the colors of my website.', 'big-sky' )\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: 'site-change-fonts',\n\t\t\t\tactionName: __( 'Change the fonts', 'big-sky' ),\n\t\t\t\tdescription: __( 'of my website', 'big-sky' ),\n\t\t\t\tonClick: () => {\n\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t__( 'Change the fonts of my website.', 'big-sky' )\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: 'site-change-layout',\n\t\t\t\tactionName: __( 'Change layout', 'big-sky' ),\n\t\t\t\tdescription: __( 'try a different layout', 'big-sky' ),\n\t\t\t\tonClick: () => {\n\t\t\t\t\t// Only the site-design agent has the show_layout_picker tool, need a user message to trigger the layout if on another agent.\n\t\t\t\t\tif ( callbacks?.show_layout_picker ) {\n\t\t\t\t\t\tcallbacks.show_layout_picker();\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t\t__( 'Change the layout of my website.', 'big-sky' )\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\n\t\treturn [ ...bigSkyPatternActions, ...siteActions ];\n\t}, [\n\t\tcallbacks,\n\t\tgetBigSkyPatternActions,\n\t\tgetParentPatternCategory,\n\t\thandleActionClick,\n\t\tselectedBlock,\n\t] );\n\n\tconst getImageActions = useCallback( () => {\n\t\treturn [\n\t\t\t{\n\t\t\t\tkey: 'image-ai-image',\n\t\t\t\tactionName: __( 'Generate an image', 'big-sky' ),\n\t\t\t\tdescription: __( 'using AI', 'big-sky' ),\n\t\t\t\tonClick: () =>\n\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'Make a new AI image to replace the one I have selected.',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: 'image-find-stock',\n\t\t\t\tactionName: __( 'Find an image', 'big-sky' ),\n\t\t\t\tdescription: __( 'from stock', 'big-sky' ),\n\t\t\t\tonClick: () =>\n\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'Find me a new stock image to replace the one I have selected.',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t},\n\t\t];\n\t}, [ handleActionClick ] );\n\n\tconst getLogoActions = useCallback( () => {\n\t\treturn [\n\t\t\t{\n\t\t\t\tkey: 'logo-ai-image',\n\t\t\t\tactionName: __( 'Make a logo', 'big-sky' ),\n\t\t\t\tdescription: __( 'using AI', 'big-sky' ),\n\t\t\t\tonClick: () =>\n\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'Make a new logo to replace the one I have selected.',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t},\n\t\t];\n\t}, [ handleActionClick ] );\n\n\tconst getTextActions = useCallback( () => {\n\t\treturn [\n\t\t\t{\n\t\t\t\tkey: 'text-change-tone',\n\t\t\t\tactionName: __( 'Change tone', 'big-sky' ),\n\t\t\t\tdescription: __( 'to something different', 'big-sky' ),\n\t\t\t\tonClick: () =>\n\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'Change the tone of the text I have selected.',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: 'text-fix-spelling-grammar',\n\t\t\t\tactionName: __( 'Fix spelling and grammar', 'big-sky' ),\n\t\t\t\tdescription: __( 'of this text', 'big-sky' ),\n\t\t\t\tonClick: () =>\n\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'Fix the spelling and grammar of the text I have selected.',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: 'text-make-shorter',\n\t\t\t\tactionName: __( 'Reduce length', 'big-sky' ),\n\t\t\t\tdescription: __( 'of this text', 'big-sky' ),\n\t\t\t\tonClick: () =>\n\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'Make the text I have selected, shorter.',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t},\n\t\t];\n\t}, [ handleActionClick ] );\n\n\tconst getButtonActions = useCallback( () => {\n\t\treturn [\n\t\t\t{\n\t\t\t\tkey: 'button-update-link',\n\t\t\t\tactionName: __( 'Update link', 'big-sky' ),\n\t\t\t\tdescription: __( 'to something else', 'big-sky' ),\n\t\t\t\tonClick: () =>\n\t\t\t\t\thandleActionClick(\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'Update the button link to something else.',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t},\n\t\t];\n\t}, [ handleActionClick ] );\n\n\tconst getActions = useCallback( () => {\n\t\tconst currentActionType = actions[ 0 ]?.key;\n\n\t\t// These are passed in from the parent component.\n\t\tif ( propActions.length > 0 ) {\n\t\t\treturn propActions.map( ( action ) => ( {\n\t\t\t\t...action,\n\t\t\t\taction_type: 'suggested',\n\t\t\t} ) );\n\t\t}\n\n\t\t// If the user has clicked on the Assistant icon while a block is selected\n\t\t// we should show the site context actions, not the block context actions.\n\t\t// This is what the useBlockContext prop is for.\n\t\tif ( ( ! selectedBlock || ! useBlockContext ) && isOnboarded ) {\n\t\t\treturn getBaseActions();\n\t\t}\n\n\t\tconst blockName = selectedBlock?.name;\n\n\t\tswitch ( blockName ) {\n\t\t\tcase 'core/paragraph':\n\t\t\tcase 'core/heading':\n\t\t\t\treturn getTextActions();\n\t\t\tcase 'core/image':\n\t\t\tcase 'core/cover':\n\t\t\t\treturn getImageActions();\n\t\t\tcase 'core/site-logo':\n\t\t\t\treturn getLogoActions();\n\t\t\tcase 'core/button':\n\t\t\tcase 'core/social-link':\n\t\t\t\treturn getButtonActions();\n\t\t\tcase 'core/group':\n\t\t\tdefault:\n\t\t\t\tif (\n\t\t\t\t\tuseBlockContext &&\n\t\t\t\t\t! currentActionType?.includes( 'site-' ) &&\n\t\t\t\t\tisOnboarded\n\t\t\t\t) {\n\t\t\t\t\treturn getBaseActions();\n\t\t\t\t}\n\t\t}\n\t}, [\n\t\tactions,\n\t\tgetImageActions,\n\t\tgetLogoActions,\n\t\tgetBaseActions,\n\t\tgetTextActions,\n\t\tgetButtonActions,\n\t\tisOnboarded,\n\t\tselectedBlock,\n\t\tuseBlockContext,\n\t\tpropActions,\n\t] );\n\n\tuseEffect( () => {\n\t\tsetActions( getActions() );\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ selectedBlock ] );\n\n\treturn actions?.length > 0 ? (\n\t\t<ActionCarousel\n\t\t\tkey={ actions[ 0 ]?.key }\n\t\t\tactions={ actions }\n\t\t\tanimationVariants={ animationVariants }\n\t\t/>\n\t) : null;\n}\n","/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { useChat } from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport { store as aiStore } from '@store';\n\nexport default function useIsThinking() {\n\tconst { pendingToolCallbacks } = useSelect( ( select ) => ( {\n\t\tpendingToolCallbacks: select( aiStore ).getPendingToolCallbacks(),\n\t} ) );\n\n\tconst { running, isAwaitingUserInput } = useChat();\n\n\treturn {\n\t\tisThinking:\n\t\t\tisAwaitingUserInput === false ||\n\t\t\tpendingToolCallbacks > 0 ||\n\t\t\trunning,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch } from '@wordpress/data';\nimport { useEffect } from '@wordpress/element';\nimport { useChat, withToolCall } from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport ChatActions from '@components/chat/actions';\nimport useLog from '@hooks/use-log';\nimport { store as aiStore } from '@store';\nimport useIsThinking from '@hooks/use-is-thinking';\n\nexport function ChatSuggestions( { args, respond } ) {\n\tconst { agentSay, isRunning } = useChat();\n\tconst { message, actions } = args || {};\n\tconst { logUserChoice } = useLog();\n\tconst { setHasRetriedChatRequest } = useDispatch( aiStore );\n\tconst { isThinking = false } = useIsThinking() || {};\n\n\tuseEffect( () => {\n\t\tif ( message ) {\n\t\t\tagentSay( message );\n\t\t}\n\t}, [ agentSay, message ] );\n\n\tlet actionsToUse = [];\n\n\tif ( isThinking || isRunning ) {\n\t\treturn null;\n\t} else if ( actions && actions.length > 0 ) {\n\t\tactionsToUse = actions.map( ( action ) => {\n\t\t\treturn {\n\t\t\t\tkey: action.key || action.actionName || action,\n\t\t\t\tactionName: action.actionName || action,\n\t\t\t\tdescription: action.description || '',\n\t\t\t\ttype: action.type,\n\t\t\t\tonClick: () => {\n\t\t\t\t\tconst responseMessage = () => {\n\t\t\t\t\t\tif ( action?.message ) {\n\t\t\t\t\t\t\treturn action.message;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn action.actionName && action.description\n\t\t\t\t\t\t\t? `${ action.actionName } - ${ action.description }`\n\t\t\t\t\t\t\t: action.description || action.actionName || action;\n\t\t\t\t\t};\n\n\t\t\t\t\tlogUserChoice( responseMessage() );\n\t\t\t\t\tsetHasRetriedChatRequest( false );\n\t\t\t\t\trespond( responseMessage() );\n\t\t\t\t},\n\t\t\t};\n\t\t} );\n\t} else {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<ChatActions\n\t\t\tkey={ actionsToUse.map( ( action ) => action.key ).join( '-' ) }\n\t\t\tactions={ actionsToUse }\n\t\t\tanimationVariants={ {\n\t\t\t\tinitial: { opacity: 0, y: 10 },\n\t\t\t\tanimate: { opacity: 1, y: 0 },\n\t\t\t\texit: { opacity: 0, y: 10 },\n\t\t\t\ttransition: {\n\t\t\t\t\tease: [ 0.42, 0.24, 0.02, 1 ],\n\t\t\t\t\tduration: 0.2,\n\t\t\t\t\tdelay: 0.05,\n\t\t\t\t},\n\t\t\t} }\n\t\t/>\n\t);\n}\n\nexport default withToolCall( 'make_suggestions', ChatSuggestions );\n","import contentAssistantPrompt from './prompt.js';\nimport contentToolkit from '@ai/assistants/content/toolkit.js';\nimport { ASSISTANTS } from '@ai/assistants/constants.js';\nimport useContentToolkit from './use-content-toolkit.js';\n\nexport const agentDetails = {};\n\nconst contentAssistant = {\n\tid: ASSISTANTS.CONTENT,\n\tdescription: 'An assistant that handles content generation and editing.',\n\tinstructions: ( context ) => {\n\t\treturn contentAssistantPrompt( context );\n\t},\n\ttags: [ ASSISTANTS.CONTENT ],\n\ttoolkits: [ contentToolkit ],\n\ttoolkitHook: useContentToolkit,\n\tonToolResult: ( _, value, invoke ) => {\n\t\tinvoke.userSay( value );\n\t},\n\tonStart: ( invoke, clearMessages = () => {}, agentMessage = null ) => {\n\t\tif ( agentMessage ) {\n\t\t\tclearMessages();\n\t\t\tinvoke.agentSay( agentMessage );\n\t\t}\n\t},\n};\n\nexport default contentAssistant;\n","import {\n\tanalysisPrompt,\n\tgetReturnToRouterPrompt,\n\tgetSelectedBlockContextPrompt,\n\tgetSiteContextPrompt,\n\thelpActionPrompt,\n\thelpAssistantPrompt,\n\tisForwardedByRouter,\n\tlanguagePrompt,\n\trouterActionPrompt,\n} from '../shared/prompts.js';\n\nexport default function contentAssistantPrompt( context ) {\n\tconst routerExamples = ! isForwardedByRouter( context )\n\t\t? `User: \"Add a gallery section\"\n         Analysis: The request is about adding a new section\n         Action: ${ routerActionPrompt }\n\n         User: \"Remove the team section\"\n         Analysis: The request is about remving an existing section\n         Action: ${ routerActionPrompt }\n\n         User: \"Install WooCommerce plugin\"\n         Analysis: The request is not a question, and is not related to content edits\n         Action: ${ routerActionPrompt }`\n\t\t: '';\n\tconst prompt = `\nYou are an expert content writer and editor at Automattic, specializing in website content creation, editing, and content management. Your primary goal is to help users improve their website content and manage various content sections.\n\nHere is the current context, use this to inform your responses:\n\n<site_context>\n${ getSiteContextPrompt( context, [\n\t'siteTitle',\n\t'siteDescription',\n\t'siteLocation',\n\t'topic',\n] ) }\n</site_context>\n\n<selected_block_context>\n${ getSelectedBlockContextPrompt( context, [ 'clientId', 'type', 'content' ] ) }\n</selected_block_context>\n\nHere is the language you should use for responses unless explicitly instructed otherwise:\n\n<language>\n${ languagePrompt }\n</language>\n\n1. Analyze the user's request:\n   ${ analysisPrompt }\n   a) Determine if the request is content-related. This includes:\n      - Modifying text (tone, formatting, but NOT color, font, or position)\n      - Updating contact or business information\n      - Making contact form field modifications\n      - Modifying content INSIDE a menu, events, testimonials, services, pricing, or team section\n      - Adding a container or item to an existing section\n   b) Check if the request is about adding or removing an ENTIRE section\n   c) Identify if the request is a question, a non-content related task, or if the selected block is not content related (e.g., core/image)\n   d) List potential tools that might be relevant to the request\n   e) For each potential tool, list its required parameters and whether they are present in the user's request\n   f) If the request involves content changes, briefly outline what those changes might entail\n\n2. Determine the appropriate action based on your analysis:\n   a) For content-related requests:\n      - Identify the required tools and parameters\n      - Check if block selection is needed\n      - Specify the content requirements\n   b) For questions:\n      - ${ helpAssistantPrompt }\n   c For resetting the entire site:\n      - Use the 'start_over' tool\n   d) For other non-content requests:\n      - ${ getReturnToRouterPrompt( context ) }\n\n3. Use the appropriate tools for content management:\n   - Block Content:\n     * Content changes: rewrite_content tool (requires selected block)\n     * Text formatting: make_text_bold_italic tool\n     * Button links: update_button_link tool (requires clientId)\n   - Contact Information:\n     * Address updates: update_address tool\n     * Contact form modifications: modify_contact_form_fields tool\n     * Social links: upsert_social_link tool\n   - Menu Management:\n     * Add Menu items: add_item_to_menu_container tool\n     * New Menu container: add_container_to_menu_section tool\n   - Events Management:\n     * Add Events items: add_item_to_events_container tool\n     * New Events container: add_container_to_events_section tool\n   - Business Features:\n     * New Services container: add_container_to_services_section tool\n     * New Pricing container: add_container_to_pricing_section tool\n     * New Team members: add_member_to_team_container tool\n     * New Team container: add_container_to_team_section tool\n     * New Testimonials: add_item_to_testimonials_section tool\n\n4. Special cases:\n   - If the request is content-related but there's no specific tool to handle it, ${ helpActionPrompt }\n\n5. Important requirements:\n   - If a selected block is required, ask the user to select the block\n   - Follow date/time formats for events\n   - Use site description for generated content\n   - Maintain currency and pricing conventions\n\n6. Examples:\n\nUser: \"Add a new menu section for desserts\"\nAnalysis: The request is related to editing an existing menu section\nAction:\n   - If a selected block is required, ask the user to select the menu section block\n   - If it is selected, call add_container_to_menu_section tool\n\nUser: \"Add three team members\"\nAnalysis: The request is related to editing an existing team section\nAction:\n   - If a selected block is required, ask the user to select the team section block\n   - If it is selected, call add_member_to_team_container tool with count: 3\n\nUser: \"Make this heading bold\"\nAnalysis: The request is related to text formatting\nAction: Call make_text_bold_italic tool with 'bold' format\n\nUser: \"add a phone field\"\nAnalysis: The request is related to contact form field modifications\nAction:\n   - If a selected block is required, ask the user to select the contact form block\n   - If it is selected, call modify_contact_form_fields tool with 'phone' field\n\nUser: \"I don't like the site, please reset it.\"\nAnalysis: The request is related to resetting the entire site\nAction: Call start_over tool\n\n${ routerExamples }\nUser: \"How do I update my plugins?\"\nAnalysis: The request is a question, and is not related to content edits\nAction: ${ helpActionPrompt }\n\n7. Restrictions:\n   - Only discuss Automattic/WordPress.com products\n   - Never suggest plugin installations\n   - Don't proceed without selected block when required\n   - Don't mention clientId in responses\n\nImportant:\n   - Strictly differentiate between adding/removing an entire section and editing content in an existing section.\n   - For adding or removing entire sections, ${ routerActionPrompt }\n\nRemember to use appropriate tools immediately based on analysis.\n`;\n\n\treturn prompt;\n}\n","/**\n * WordPress dependencies\n */\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { useEffect } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * External dependencies\n */\nimport { useChat, useToolkits } from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport contentToolkit from './toolkit.js';\nimport useButtonToolFunctions from '@ai/assistants/content/tools/button/use-tool-functions.js';\nimport useContentToolFunctions from '@ai/assistants/content/tools/content/use-tool-functions.js';\nimport useContactFormToolFunctions from '@ai/assistants/content/tools/contact-form/use-tool-functions.js';\nimport useAddressToolFunctions from '@ai/assistants/content/tools/address/use-tool-functions.js';\nimport useFormatContentToolFunctions from '@ai/assistants/content/tools/make-text-bold-italic/use-tool-functions.js';\nimport useStartOverToolFunctions from '@ai/assistants/shared/start-over/use-tool-functions.js';\nimport useChangeAssistantTool from '@ai/assistants/shared/change-assistant/use-change-assistant-tool.js';\nimport { ChatSuggestions } from '@ai/assistants/shared/make-suggestions/index.js';\nimport patternCategories from '@data/pattern-categories.js';\nimport imageStyles from '@data/image-styles.json' assert { type: 'json' };\nimport usePatterns from '@hooks/use-patterns';\nimport useReplaceContent from '@ai/tasks/replace-content/use-replace-content.js';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport useVariations from '@hooks/use-variations';\nimport { store as aiStore } from '@store';\nimport { dockViews } from '@utils/constants';\nimport useCreateToolCallback from '@ai/assistants/shared/use-create-tool-callback.js';\n\nconst useContentToolkit = () => {\n\tconst { createToolCallback, withPendingToolCallback } =\n\t\tuseCreateToolCallback();\n\tconst { agentSay } = useChat();\n\tconst { setCallbacks, setContext } = useToolkits();\n\tconst { isContactFormOnPage, modifyContactForm, validateContactFormArgs } =\n\t\tuseContactFormToolFunctions();\n\tconst {\n\t\treplaceContentAgent,\n\t\taddSection,\n\t\tgetItemsCount,\n\t\tvalidateAddContentSectionArgs,\n\t\taddItems,\n\t\tvalidateAddItemsArgs,\n\t\tgetCurrentPricingContent,\n\t} = useContentToolFunctions();\n\tconst { changeAssistant } = useChangeAssistantTool();\n\tconst { updateButtonLink, upsertSocialLink, validateSocialLinkArgs } =\n\t\tuseButtonToolFunctions();\n\tconst { updateAddress } = useAddressToolFunctions();\n\tconst { formatContent, validateFormatContentArgs } =\n\t\tuseFormatContentToolFunctions();\n\tconst { startOver, startOverActions } = useStartOverToolFunctions();\n\tconst { getParentPatternCategory, getPattern, getSections, getItems } =\n\t\tusePatterns();\n\tconst { getLastAvailableContentByClassName } = useReplaceContent();\n\tconst {\n\t\ttopic,\n\t\tsiteTitle,\n\t\tsiteDescription,\n\t\tsiteLocation,\n\t\tdefaultImageStyle,\n\t} = useSiteMetadata().getSiteMetadata();\n\tconst { getVariationKeywords, getSocialLinkVariations } = useVariations();\n\n\tconst { selectedBlock, getIsHandoff, currentHandoffArea } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\t\t\tconst {\n\t\t\t\tgetOnSelectedBlockAction: _getOnSelectedBlockAction,\n\t\t\t\tgetIsHandoff: _getIsHandoff,\n\t\t\t\tgetCurrentHandoffArea,\n\t\t\t} = select( aiStore );\n\t\t\treturn {\n\t\t\t\tselectedBlock: getSelectedBlock(),\n\t\t\t\tgetIsHandoff: _getIsHandoff,\n\t\t\t\tcurrentHandoffArea: getCurrentHandoffArea(),\n\t\t\t\tgetOnSelectedBlockAction: _getOnSelectedBlockAction,\n\t\t\t};\n\t\t}\n\t);\n\tconst { setChatComponents, setDockView, setShowThread, setHideInput } =\n\t\tuseDispatch( aiStore );\n\n\tconst callbacks = {\n\t\tadd_item_to_events_container: createToolCallback( {\n\t\t\tname: 'add_item_to_events_container',\n\t\t\taction: async ( args ) => {\n\t\t\t\tagentSay(\n\t\t\t\t\tawait addItems( {\n\t\t\t\t\t\t...args,\n\t\t\t\t\t\tcategory: 'events',\n\t\t\t\t\t} )\n\t\t\t\t);\n\t\t\t},\n\t\t\tvalidator: ( args ) =>\n\t\t\t\tvalidateAddItemsArgs( { ...args, category: 'events' } ),\n\t\t\tfailValidatorAction: ( _, error ) => {\n\t\t\t\tsetShowThread( true );\n\t\t\t\tagentSay( error.message );\n\t\t\t},\n\t\t} ),\n\t\tadd_container_to_events_section: createToolCallback( {\n\t\t\tname: 'add_container_to_events_section',\n\t\t\taction: async ( args ) => {\n\t\t\t\tagentSay(\n\t\t\t\t\tawait addSection( {\n\t\t\t\t\t\t...args,\n\t\t\t\t\t\tcategory: 'events',\n\t\t\t\t\t} )\n\t\t\t\t);\n\t\t\t},\n\t\t\tvalidator: ( args ) =>\n\t\t\t\tvalidateAddContentSectionArgs( {\n\t\t\t\t\t...args,\n\t\t\t\t\tcategory: 'events',\n\t\t\t\t} ),\n\t\t\tfailValidatorAction: ( _, error ) => {\n\t\t\t\tsetShowThread( true );\n\t\t\t\tagentSay( error.message );\n\t\t\t},\n\t\t} ),\n\t\tadd_item_to_menu_container: createToolCallback( {\n\t\t\tname: 'add_item_to_menu_container',\n\t\t\taction: async ( args ) => {\n\t\t\t\tagentSay(\n\t\t\t\t\tawait addItems( {\n\t\t\t\t\t\t...args,\n\t\t\t\t\t\tcategory: 'menu',\n\t\t\t\t\t\tuseCacheKey: true,\n\t\t\t\t\t} )\n\t\t\t\t);\n\t\t\t},\n\t\t\tvalidator: ( args ) =>\n\t\t\t\tvalidateAddItemsArgs( { ...args, category: 'menu' } ),\n\t\t\tfailValidatorAction: ( _, error ) => {\n\t\t\t\tsetShowThread( true );\n\t\t\t\tconsole.warn( 'Failed to add menu items', error );\n\t\t\t\tagentSay( error.message );\n\t\t\t},\n\t\t} ),\n\t\tadd_container_to_menu_section: createToolCallback( {\n\t\t\tname: 'add_container_to_menu_section',\n\t\t\taction: async ( args ) => {\n\t\t\t\tagentSay(\n\t\t\t\t\tawait addSection( {\n\t\t\t\t\t\t...args,\n\t\t\t\t\t\tcategory: 'menu',\n\t\t\t\t\t\tuseCacheKey: true,\n\t\t\t\t\t} )\n\t\t\t\t);\n\t\t\t},\n\t\t\tvalidator: ( args ) =>\n\t\t\t\tvalidateAddContentSectionArgs( {\n\t\t\t\t\t...args,\n\t\t\t\t\tcategory: 'menu',\n\t\t\t\t} ),\n\t\t\tfailValidatorAction: ( _, error ) => {\n\t\t\t\tsetShowThread( true );\n\t\t\t\tconsole.warn( 'Failed to add menu section', error );\n\t\t\t\tagentSay( error.message );\n\t\t\t},\n\t\t} ),\n\n\t\tadd_container_to_pricing_section: createToolCallback( {\n\t\t\tname: 'add_container_to_pricing_section',\n\t\t\taction: async ( args ) => {\n\t\t\t\tconst { title, description } = getCurrentPricingContent();\n\t\t\t\t// restructure the arg items, converting it to tiers with a title and description\n\t\t\t\targs.items = [\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle,\n\t\t\t\t\t\tdescription,\n\t\t\t\t\t\ttiers: args.items,\n\t\t\t\t\t},\n\t\t\t\t];\n\t\t\t\tagentSay(\n\t\t\t\t\tawait addSection( { ...args, category: 'pricing' } )\n\t\t\t\t);\n\t\t\t},\n\t\t\tvalidator: ( args ) =>\n\t\t\t\tvalidateAddContentSectionArgs( {\n\t\t\t\t\t...args,\n\t\t\t\t\tcategory: 'pricing',\n\t\t\t\t} ),\n\t\t\tfailValidatorAction: ( _, error ) => {\n\t\t\t\tsetShowThread( true );\n\t\t\t\tagentSay( error.message );\n\t\t\t},\n\t\t} ),\n\t\tadd_container_to_services_section: createToolCallback( {\n\t\t\tname: 'add_container_to_services_section',\n\t\t\taction: async ( args ) => {\n\t\t\t\tagentSay(\n\t\t\t\t\tawait addSection( { ...args, category: 'services' } )\n\t\t\t\t);\n\t\t\t},\n\t\t\tvalidator: ( args ) =>\n\t\t\t\tvalidateAddContentSectionArgs( {\n\t\t\t\t\t...args,\n\t\t\t\t\tcategory: 'services',\n\t\t\t\t} ),\n\t\t\tfailValidatorAction: ( _, error ) => {\n\t\t\t\tsetShowThread( true );\n\t\t\t\tagentSay( error.message );\n\t\t\t},\n\t\t} ),\n\t\tadd_member_to_team_container: createToolCallback( {\n\t\t\tname: 'add_member_to_team_container',\n\t\t\taction: async ( args ) => {\n\t\t\t\tagentSay(\n\t\t\t\t\tawait addItems( {\n\t\t\t\t\t\t...args,\n\t\t\t\t\t\tcategory: 'team',\n\t\t\t\t\t} )\n\t\t\t\t);\n\t\t\t},\n\t\t} ),\n\t\tadd_container_to_team_section: createToolCallback( {\n\t\t\tname: 'add_container_to_team_section',\n\t\t\taction: async ( args ) => {\n\t\t\t\tagentSay(\n\t\t\t\t\tawait addSection( {\n\t\t\t\t\t\t...args,\n\t\t\t\t\t\tcategory: 'team',\n\t\t\t\t\t} )\n\t\t\t\t);\n\t\t\t},\n\t\t} ),\n\t\tadd_item_to_testimonials_section: createToolCallback( {\n\t\t\tname: 'add_item_to_testimonials_section',\n\t\t\taction: async ( args ) => {\n\t\t\t\tagentSay(\n\t\t\t\t\tawait addSection( {\n\t\t\t\t\t\t...args,\n\t\t\t\t\t\tcategory: 'testimonials',\n\t\t\t\t\t} )\n\t\t\t\t);\n\t\t\t},\n\t\t\tvalidator: ( args ) =>\n\t\t\t\tvalidateAddContentSectionArgs( {\n\t\t\t\t\t...args,\n\t\t\t\t\tcategory: 'testimonials',\n\t\t\t\t} ),\n\t\t\tfailValidatorAction: ( _, error ) => {\n\t\t\t\tsetShowThread( true );\n\t\t\t\tagentSay( error.message );\n\t\t\t},\n\t\t} ),\n\t\tmodify_contact_form_fields: createToolCallback( {\n\t\t\tname: 'modify_contact_form_fields',\n\t\t\taction: async ( args ) => {\n\t\t\t\tagentSay( await modifyContactForm( args ) );\n\t\t\t},\n\t\t\tvalidator: ( args ) => validateContactFormArgs( args ),\n\t\t\tfailValidatorAction: ( _, error ) => {\n\t\t\t\tagentSay( error.message );\n\t\t\t},\n\t\t} ),\n\t\trewrite_content: createToolCallback( {\n\t\t\tname: 'rewrite_content',\n\t\t\taction: async ( _args ) => {\n\t\t\t\tagentSay( replaceContentAgent( _args ) );\n\t\t\t},\n\t\t} ),\n\t\tupdate_button_link: createToolCallback( {\n\t\t\tname: 'update_button_link',\n\t\t\taction: async ( _args ) => {\n\t\t\t\tagentSay( await updateButtonLink( _args ) );\n\t\t\t},\n\t\t} ),\n\t\tupsert_social_link: createToolCallback( {\n\t\t\tname: 'upsert_social_link',\n\t\t\taction: ( _args ) => {\n\t\t\t\tagentSay( upsertSocialLink( _args ) );\n\t\t\t},\n\t\t\tvalidator: ( _args ) => validateSocialLinkArgs( _args ),\n\t\t\tfailValidatorAction: ( _, error ) => {\n\t\t\t\tsetShowThread( true );\n\t\t\t\tconsole.warn( 'Failed to upsert social link', error );\n\t\t\t\tagentSay( error.message );\n\t\t\t},\n\t\t} ),\n\t\tupdate_address: createToolCallback( {\n\t\t\tname: 'update_address',\n\t\t\taction: async ( _args ) => {\n\t\t\t\tagentSay( await updateAddress( _args ) );\n\t\t\t},\n\t\t} ),\n\t\tmake_text_bold_italic: createToolCallback( {\n\t\t\tname: 'make_text_bold_italic',\n\t\t\tfailValidatorAction: ( _, error ) => {\n\t\t\t\tsetShowThread( true );\n\t\t\t\tagentSay( error.message );\n\t\t\t},\n\t\t\tvalidator: ( _args ) => validateFormatContentArgs( _args ),\n\t\t\taction: async ( _args ) => {\n\t\t\t\tagentSay( await formatContent( _args ) );\n\t\t\t},\n\t\t} ),\n\t\tstart_over: createToolCallback( {\n\t\t\tname: 'start_over',\n\t\t\taction: async () => {\n\t\t\t\tsetShowThread( true );\n\t\t\t\tsetHideInput( true );\n\t\t\t\tconst args = {\n\t\t\t\t\tactions: startOverActions,\n\t\t\t\t};\n\t\t\t\tagentSay(\n\t\t\t\t\t__(\n\t\t\t\t\t\t'All customizations and pages on your site will be permanently reset. Are you sure you want to start over?',\n\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\tsetChatComponents( [\n\t\t\t\t\t<ChatSuggestions\n\t\t\t\t\t\tkey=\"suggestions\"\n\t\t\t\t\t\targs={ args }\n\t\t\t\t\t\trespond={ async ( _args ) => {\n\t\t\t\t\t\t\tstartOver( _args );\n\t\t\t\t\t\t\tsetDockView( dockViews.MENUS );\n\t\t\t\t\t\t\tsetChatComponents( [] );\n\t\t\t\t\t\t\tsetHideInput( false );\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>,\n\t\t\t\t] );\n\t\t\t},\n\t\t\tcloseChatWhenDone: () => false,\n\t\t} ),\n\t\tchange_assistant: createToolCallback( {\n\t\t\tname: 'change_assistant',\n\t\t\taction: ( _args ) => {\n\t\t\t\tsetShowThread( true );\n\t\t\t\tchangeAssistant( _args );\n\t\t\t},\n\t\t\tcloseChatWhenDone: () => false,\n\t\t} ),\n\t};\n\n\tuseEffect( () => {\n\t\tsetCallbacks( contentToolkit.name, callbacks );\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ setCallbacks ] );\n\n\tconst availableCategories = patternCategories.map(\n\t\t( category ) => category.slug\n\t);\n\n\tuseEffect( () => {\n\t\tconst blockVariations = getSocialLinkVariations();\n\t\tconst context = {\n\t\t\tpatterns: {\n\t\t\t\tpatternCategories: availableCategories,\n\t\t\t},\n\t\t\tsite: {\n\t\t\t\tsiteTitle,\n\t\t\t\tsiteDescription,\n\t\t\t\tsiteLocation,\n\t\t\t\ttopic,\n\t\t\t},\n\t\t\tcolors: {\n\t\t\t\tcolorVariationCategories: getVariationKeywords( 'color' ),\n\t\t\t},\n\t\t\tfonts: {\n\t\t\t\tfontCategories: getVariationKeywords( 'font' ),\n\t\t\t},\n\t\t\tsocialLinks: {\n\t\t\t\tservices: blockVariations.map(\n\t\t\t\t\t( variation ) => variation.name\n\t\t\t\t),\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tpattern: getPattern( 'events' ),\n\t\t\t\tsections: getSections( 'events' ),\n\t\t\t\titems: getItems( 'events', getPattern( 'events' ) ),\n\t\t\t\titemCount: getItemsCount( 'events' ),\n\t\t\t\tdateFormatExample: getLastAvailableContentByClassName(\n\t\t\t\t\tgetPattern( 'events' ),\n\t\t\t\t\t'is-event-date'\n\t\t\t\t),\n\t\t\t\ttimeFormatExample: getLastAvailableContentByClassName(\n\t\t\t\t\tgetPattern( 'events' ),\n\t\t\t\t\t'is-event-time'\n\t\t\t\t),\n\t\t\t},\n\t\t\tmenu: {\n\t\t\t\tpattern: getPattern( 'menu' ),\n\t\t\t\tsections: getSections( 'menu' ),\n\t\t\t\titems: getItems( 'menu', getPattern( 'menu' ) ),\n\t\t\t\titemCount: getItemsCount( 'menu' ),\n\t\t\t},\n\t\t\tservices: {\n\t\t\t\tpattern: getPattern( 'services' ),\n\t\t\t\tsections: getSections( 'services' ),\n\t\t\t\titemCount: getItemsCount( 'services' ),\n\t\t\t},\n\t\t\ttestimonials: {\n\t\t\t\tpattern: getPattern( 'testimonials' ),\n\t\t\t\tsections: getSections( 'testimonials' ),\n\t\t\t\titemCount: getItemsCount( 'testimonials' ),\n\t\t\t},\n\t\t\tpricing: {\n\t\t\t\ttiers: getCurrentPricingContent().tiers,\n\t\t\t\tpattern: getPattern( 'pricing' ),\n\t\t\t\tsections: getSections( 'pricing' ),\n\t\t\t\titemCount: getItemsCount( 'pricing' ),\n\t\t\t},\n\t\t\tteam: {\n\t\t\t\tpattern: getPattern( 'team' ),\n\t\t\t\tsections: getSections( 'team' ),\n\t\t\t\titems: getItems( 'team', getPattern( 'team' ) ),\n\t\t\t\titemCount: getItemsCount( 'team' ),\n\t\t\t},\n\t\t};\n\n\t\tif ( isContactFormOnPage() ) {\n\t\t\tcontext.contactForm = {\n\t\t\t\tisOnPage: true,\n\t\t\t};\n\t\t}\n\n\t\tif ( getIsHandoff() ) {\n\t\t\tcontext.currentHandoffArea = currentHandoffArea;\n\t\t\tsetContext( contentToolkit.name, context );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! selectedBlock ) {\n\t\t\tsetContext( contentToolkit.name, context );\n\t\t\treturn;\n\t\t}\n\n\t\tconst patternCategory = getParentPatternCategory( selectedBlock );\n\n\t\tswitch ( selectedBlock.name ) {\n\t\t\tcase 'core/image':\n\t\t\tcase 'core/site-logo':\n\t\t\tcase 'core/cover':\n\t\t\t\tcontext.selectedBlock = {\n\t\t\t\t\ttype: selectedBlock.name,\n\t\t\t\t\tclientId: selectedBlock.clientId,\n\t\t\t\t\tparentPatternCategory: patternCategory,\n\t\t\t\t};\n\t\t\t\tcontext.images = {\n\t\t\t\t\tstyles: imageStyles,\n\t\t\t\t\tdefaultStyle: defaultImageStyle,\n\t\t\t\t};\n\t\t\t\tsetContext( contentToolkit.name, context );\n\t\t\t\tbreak;\n\t\t\tcase 'core/paragraph':\n\t\t\tcase 'core/heading':\n\t\t\t\tcontext.selectedBlock = {\n\t\t\t\t\ttype: selectedBlock.name,\n\t\t\t\t\tclientId: selectedBlock.clientId,\n\t\t\t\t\tparentPatternCategory: patternCategory,\n\t\t\t\t\tcontent:\n\t\t\t\t\t\ttypeof selectedBlock.attributes.content === 'string'\n\t\t\t\t\t\t\t? selectedBlock.attributes.content\n\t\t\t\t\t\t\t: selectedBlock.attributes.content?.originalHTML ||\n\t\t\t\t\t\t\t  selectedBlock.attributes.content?.text,\n\t\t\t\t};\n\t\t\t\tsetContext( contentToolkit.name, context );\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tcontext.selectedBlock = {\n\t\t\t\t\ttype: selectedBlock.name,\n\t\t\t\t\tclientId: selectedBlock.clientId,\n\t\t\t\t\tparentPatternCategory: patternCategory,\n\t\t\t\t};\n\t\t\t\tsetContext( contentToolkit.name, context );\n\t\t\t\tbreak;\n\t\t}\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [\n\t\tselectedBlock,\n\t\tsetContext,\n\t\tgetIsHandoff,\n\t\tcurrentHandoffArea,\n\t\tsiteLocation,\n\t] );\n\n\treturn {\n\t\tcreateToolCallback,\n\t\twithPendingToolCallback,\n\t\tcallbacks,\n\t};\n};\n\nexport default useContentToolkit;\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useRegistry, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { __, sprintf } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport useReplaceContent from '@ai/tasks/replace-content/use-replace-content.js';\nimport useBlocks from '@hooks/use-blocks';\nimport usePatterns from '@hooks/use-patterns';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport { store as aiStore } from '@store';\nimport setDelay from '@utils/set-delay';\n\nexport default function useContentToolFunctions() {\n\tconst { getCachedContent } = useSelect( aiStore );\n\tconst { addCachedContent, setBlockBeforeChanges, setLastCancelableAction } =\n\t\tuseDispatch( aiStore );\n\tconst { getBlock, getBlockOrder, getBlockParents } =\n\t\tuseSelect( blockEditorStore );\n\tconst { insertBlock, updateBlockAttributes } =\n\t\tuseDispatch( blockEditorStore );\n\tconst {\n\t\tcopyBlockWithInnerBlocks,\n\t\tsetBlockIsProcessing,\n\t\tgetFirstChildBlockByName,\n\t\tscrollToBlock,\n\t} = useBlocks();\n\tconst {\n\t\tITEM_KEY,\n\t\tSECTION_KEY,\n\t\tgetParentPatternCategory,\n\t\tgetPattern,\n\t\tgetSections,\n\t\tgetSection,\n\t\tgetItems,\n\t\tgetItem,\n\t} = usePatterns();\n\tconst { getSiteMetadata } = useSiteMetadata();\n\n\tconst { replaceContent } = useReplaceContent();\n\tconst registry = useRegistry();\n\n\tconst shouldReplaceContent = ( category ) => {\n\t\treturn ! [ 'team' ].includes( category );\n\t};\n\n\tconst replaceContentAgent = ( { content, message } ) => {\n\t\tconst remappedContent = content.map( ( block ) => ( {\n\t\t\tclientId: block.i,\n\t\t\ttext: block.e,\n\t\t} ) );\n\n\t\tregistry.batch( () => {\n\t\t\tremappedContent?.forEach( ( newContent ) => {\n\t\t\t\tconst attributes = {};\n\t\t\t\tconst block = getBlock( newContent.clientId );\n\t\t\t\tif ( block ) {\n\t\t\t\t\t// Setting the previous block attributes allows us to undo the change later.\n\n\t\t\t\t\tsetBlockBeforeChanges( block );\n\t\t\t\t\tif (\n\t\t\t\t\t\tblock.name === 'core/heading' ||\n\t\t\t\t\t\tblock.name === 'core/paragraph'\n\t\t\t\t\t) {\n\t\t\t\t\t\tattributes.content = newContent.text;\n\t\t\t\t\t} else if ( block.name === 'core/site-title' ) {\n\t\t\t\t\t} else if ( block.name === 'core/button' ) {\n\t\t\t\t\t\tattributes.text = newContent.text;\n\t\t\t\t\t}\n\n\t\t\t\t\tupdateBlockAttributes( newContent.clientId, {\n\t\t\t\t\t\t...attributes,\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t} );\n\t\t} );\n\n\t\treturn message\n\t\t\t? message\n\t\t\t: __( 'I have replaced the content.', 'big-sky' );\n\t};\n\n\tconst getCurrentPricingContent = () => {\n\t\tconst cachedContent = getCachedContent();\n\t\tif ( cachedContent?.pricing && cachedContent.pricing[ 0 ]?.tiers ) {\n\t\t\treturn {\n\t\t\t\ttitle: cachedContent.pricing[ 0 ]?.title,\n\t\t\t\tdescription: cachedContent.pricing[ 0 ]?.description,\n\t\t\t\ttiers: cachedContent.pricing[ 0 ].tiers.map(\n\t\t\t\t\t( tier ) => tier.name\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\t\treturn {};\n\t};\n\n\tconst getItemsCount = (\n\t\tcategory,\n\t\tblock = getItems( category, getPattern( category ) )\n\t) => {\n\t\tif ( ! block ) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tlet count = 0;\n\t\tfor ( const innerBlock of block.innerBlocks ) {\n\t\t\tif ( innerBlock.attributes?.metadata?.name === ITEM_KEY ) {\n\t\t\t\tcount++;\n\t\t\t}\n\t\t\tcount += getItemsCount( category, innerBlock );\n\t\t}\n\t\treturn count;\n\t};\n\n\tconst validateMenuSectionArgs = ( args ) => {\n\t\tif ( ! args.title ) {\n\t\t\tthrow new Error(\n\t\t\t\t__( 'Please provide a title for the menu section.', 'big-sky' )\n\t\t\t);\n\t\t}\n\t};\n\n\tconst validateAddContentSectionArgs = ( args ) => {\n\t\tif ( ! getPattern( args.category ) ) {\n\t\t\tthrow new Error(\n\t\t\t\tsprintf(\n\t\t\t\t\t// translators: %s is the name of the pattern category.\n\t\t\t\t\t__( `No %s pattern found.`, 'big-sky' ),\n\t\t\t\t\targs.category\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tif ( ! getSections( args.category ) ) {\n\t\t\tthrow new Error(\n\t\t\t\tsprintf(\n\t\t\t\t\t// translators: %s is the name of the pattern category.\n\t\t\t\t\t__( `No %s sections block found.`, 'big-sky' ),\n\t\t\t\t\targs.category\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tswitch ( args.category ) {\n\t\t\tcase 'menu':\n\t\t\t\tvalidateMenuSectionArgs( args );\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst getStartIndex = ( category, title ) => {\n\t\tconst cachedContent = getCachedContent();\n\t\tlet startIndex = cachedContent?.[ category ]?.length - 1 || -1;\n\t\tif ( category === 'menu' ) {\n\t\t\tstartIndex =\n\t\t\t\tcachedContent?.[ category ]?.find(\n\t\t\t\t\t( item ) => item.name === title\n\t\t\t\t)?.items?.length - 1 || -1;\n\t\t} else if ( category === 'pricing' ) {\n\t\t\tstartIndex =\n\t\t\t\tcachedContent?.[ category ]?.[ 0 ]?.tiers?.length - 1 || -1;\n\t\t}\n\t\treturn startIndex;\n\t};\n\n\tconst addSection = async ( {\n\t\tcategory,\n\t\ttitle,\n\t\titems,\n\t\tuseCacheKey = false,\n\t} ) => {\n\t\ttry {\n\t\t\tconst { siteDescription } = getSiteMetadata();\n\t\t\tconst sectionsBlock = getSections( category );\n\t\t\tconst sectionBlock = getSection( category, sectionsBlock );\n\n\t\t\t// insert the menu section block\n\t\t\tconst blockToInsert = copyBlockWithInnerBlocks( sectionBlock );\n\t\t\tawait insertBlock(\n\t\t\t\tblockToInsert,\n\t\t\t\tgetBlockOrder( sectionsBlock.clientId ).length,\n\t\t\t\tsectionsBlock.clientId,\n\t\t\t\tfalse\n\t\t\t);\n\t\t\tif ( shouldReplaceContent( category ) ) {\n\t\t\t\tsetBlockIsProcessing( blockToInsert, true );\n\t\t\t}\n\t\t\tscrollToBlock( blockToInsert.clientId, 'center' );\n\t\t\tawait setDelay( 500 );\n\n\t\t\t// update the section heading\n\t\t\tif ( title ) {\n\t\t\t\tconst headingBlock = getFirstChildBlockByName(\n\t\t\t\t\tblockToInsert,\n\t\t\t\t\t'core/heading'\n\t\t\t\t);\n\t\t\t\tif ( headingBlock ) {\n\t\t\t\t\theadingBlock.attributes.content = title;\n\t\t\t\t\tupdateBlockAttributes(\n\t\t\t\t\t\theadingBlock.clientId,\n\t\t\t\t\t\theadingBlock.attributes\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// update the section content\n\t\t\tconst itemsBlock = getItems( category, blockToInsert );\n\t\t\tconst replaceContentArgs = {\n\t\t\t\tconceptSection: [ itemsBlock ],\n\t\t\t\tsectionCategory: category,\n\t\t\t\tsiteDescription,\n\t\t\t\tsectionHeading: title,\n\t\t\t\treplaceHeading: false,\n\t\t\t\tinMemory: false,\n\t\t\t\tstartIndex: getStartIndex( category, title ),\n\t\t\t};\n\n\t\t\tlet itemsToAdd = 0;\n\t\t\tconst itemsCount = getItemsCount( category, itemsBlock );\n\t\t\t// if the section has a title, then we should use it as a key under the cached content\n\t\t\tif ( useCacheKey && items ) {\n\t\t\t\tawait addCachedContent( {\n\t\t\t\t\tcategory,\n\t\t\t\t\tcontent: [ { name: title, items } ],\n\t\t\t\t\tappend: true,\n\t\t\t\t} );\n\t\t\t\titemsToAdd = items.length - itemsCount;\n\t\t\t} else if ( items ) {\n\t\t\t\tawait addCachedContent( {\n\t\t\t\t\tcategory,\n\t\t\t\t\tcontent: items,\n\t\t\t\t\tappend: true,\n\t\t\t\t} );\n\t\t\t\titemsToAdd = items.length - itemsCount;\n\t\t\t} else {\n\t\t\t\treplaceContentArgs.noCache = true;\n\t\t\t\treplaceContentArgs.numOfSections = 1;\n\t\t\t}\n\n\t\t\tif ( shouldReplaceContent( category ) ) {\n\t\t\t\t// replace content of the existing items\n\t\t\t\tawait replaceContent( replaceContentArgs );\n\t\t\t}\n\n\t\t\t// check if we need to add more items\n\t\t\tif ( itemsToAdd > 0 ) {\n\t\t\t\tawait addItems( {\n\t\t\t\t\tclientId: itemsBlock.clientId,\n\t\t\t\t\tcount: itemsToAdd,\n\t\t\t\t\tcategory,\n\t\t\t\t\tcacheOffset: itemsCount - 1,\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tif ( shouldReplaceContent( category ) ) {\n\t\t\t\tawait setDelay( 500 );\n\t\t\t\tsetBlockIsProcessing( blockToInsert, false );\n\t\t\t}\n\n\t\t\t// Set the last cancelable action to allow the user to undo the pattern insertion\n\t\t\tsetLastCancelableAction( {\n\t\t\t\taction: `add_${ category }_section`,\n\t\t\t\tclientId: blockToInsert.clientId,\n\t\t\t} );\n\n\t\t\treturn sprintf(\n\t\t\t\t// translators: %s is the name of the pattern category.\n\t\t\t\t__( 'I have added a new %s section.', 'big-sky' ),\n\t\t\t\tcategory\n\t\t\t);\n\t\t} catch ( error ) {\n\t\t\treturn sprintf(\n\t\t\t\t// translators: %s is the name of the pattern category.\n\t\t\t\t__(\n\t\t\t\t\t'There was an issue updating the content for the new %s section.',\n\t\t\t\t\t'big-sky'\n\t\t\t\t),\n\t\t\t\tcategory\n\t\t\t);\n\t\t}\n\t};\n\n\tconst getParentComponentByName = ( childBlock, name ) => {\n\t\tif ( childBlock.attributes?.metadata?.name === name ) {\n\t\t\treturn childBlock;\n\t\t}\n\n\t\tconst groupBlockParentIds = getBlockParents( childBlock.clientId );\n\t\tfor ( const groupBlockParentId of groupBlockParentIds ) {\n\t\t\tconst groupBlockParent = getBlock( groupBlockParentId );\n\t\t\tif ( groupBlockParent.attributes?.metadata?.name === name ) {\n\t\t\t\treturn groupBlockParent;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst validateAddItemsArgs = ( args ) => {\n\t\tif ( ! getPattern( args.category ) ) {\n\t\t\tthrow new Error(\n\t\t\t\tsprintf(\n\t\t\t\t\t// translators: %s is the name of the pattern category.\n\t\t\t\t\t__( 'No %s pattern found.', 'big-sky' ),\n\t\t\t\t\targs.category\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tconst sections = getSections( args.category );\n\t\t// if there is no selected block and there are sections, throw an error\n\t\tif ( ! args.clientId ) {\n\t\t\tif ( sections ) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\tsprintf(\n\t\t\t\t\t\t// translators: %s is the name of the pattern category.\n\t\t\t\t\t\t__( 'Select a %s section to add items to.', 'big-sky' ),\n\t\t\t\t\t\targs.category\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\t// if there's no sections, check if the selected block is within the pattern\n\t\tif (\n\t\t\t! sections &&\n\t\t\tgetParentPatternCategory( getBlock( args.clientId ) ) ===\n\t\t\t\targs.category\n\t\t) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst addItems = async ( {\n\t\tcategory,\n\t\tclientId,\n\t\tcount,\n\t\titems,\n\t\tuseCacheKey = false,\n\t} ) => {\n\t\ttry {\n\t\t\tconst { topic } = getSiteMetadata();\n\t\t\tlet title = topic;\n\t\t\tlet itemsBlock;\n\n\t\t\tif ( clientId ) {\n\t\t\t\tconst block = getBlock( clientId );\n\t\t\t\tconst sectionBlock = getParentComponentByName(\n\t\t\t\t\tblock,\n\t\t\t\t\tSECTION_KEY\n\t\t\t\t);\n\n\t\t\t\tif ( sectionBlock ) {\n\t\t\t\t\tconst headingBlock = getFirstChildBlockByName(\n\t\t\t\t\t\tsectionBlock,\n\t\t\t\t\t\t'core/heading'\n\t\t\t\t\t);\n\t\t\t\t\ttitle =\n\t\t\t\t\t\theadingBlock?.attributes?.content?.text ||\n\t\t\t\t\t\theadingBlock?.attributes?.content ||\n\t\t\t\t\t\ttitle;\n\t\t\t\t\titemsBlock = getItems( category, sectionBlock );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\titemsBlock =\n\t\t\t\titemsBlock || getItems( category, getPattern( category ) );\n\n\t\t\t// get the item block\n\t\t\tconst itemBlock = getItem( category, itemsBlock );\n\n\t\t\t// insert the item block\n\t\t\tconst blocksToInsert = [];\n\t\t\tconst insertIndex = getBlockOrder( itemsBlock.clientId ).length;\n\t\t\tfor ( let i = 0; i < count; i++ ) {\n\t\t\t\tconst blockToInsert = copyBlockWithInnerBlocks( itemBlock );\n\t\t\t\tawait insertBlock(\n\t\t\t\t\tblockToInsert,\n\t\t\t\t\tinsertIndex + i,\n\t\t\t\t\titemsBlock.clientId,\n\t\t\t\t\tfalse\n\t\t\t\t);\n\t\t\t\tif ( shouldReplaceContent( category ) ) {\n\t\t\t\t\tsetBlockIsProcessing( blockToInsert, true );\n\t\t\t\t}\n\t\t\t\tblocksToInsert.push( blockToInsert );\n\t\t\t}\n\n\t\t\t// get the start index to replace content\n\t\t\tconst startIndex = getStartIndex( category, title );\n\n\t\t\tif ( items ) {\n\t\t\t\tif ( useCacheKey ) {\n\t\t\t\t\tawait addCachedContent( {\n\t\t\t\t\t\tcategory,\n\t\t\t\t\t\tcontent: [ { name: title, items } ],\n\t\t\t\t\t\tappend: true,\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\tawait addCachedContent( {\n\t\t\t\t\t\tcategory,\n\t\t\t\t\t\tcontent: items,\n\t\t\t\t\t\tappend: true,\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( shouldReplaceContent( category ) ) {\n\t\t\t\tlet newStartIndex = startIndex;\n\t\t\t\tfor ( const blockToInsert of blocksToInsert ) {\n\t\t\t\t\tawait replaceContent( {\n\t\t\t\t\t\tconceptSection: [ blockToInsert ],\n\t\t\t\t\t\tsectionCategory: category,\n\t\t\t\t\t\tsectionHeading: title,\n\t\t\t\t\t\tstartIndex: newStartIndex,\n\t\t\t\t\t\tinMemory: false,\n\t\t\t\t\t} );\n\t\t\t\t\tawait setDelay( 500 );\n\t\t\t\t\tsetBlockIsProcessing( blockToInsert, false );\n\t\t\t\t\tnewStartIndex++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsetLastCancelableAction( {\n\t\t\t\taction: `add_${ category }_items`,\n\t\t\t\tclientIds: blocksToInsert.map( ( block ) => block.clientId ),\n\t\t\t} );\n\n\t\t\treturn sprintf(\n\t\t\t\t// translators: %s is the name of the pattern category.\n\t\t\t\t__( 'I have added new %s items.', 'big-sky' ),\n\t\t\t\tcategory\n\t\t\t);\n\t\t} catch ( error ) {\n\t\t\treturn sprintf(\n\t\t\t\t// translators: %s is the name of the pattern category.\n\t\t\t\t__(\n\t\t\t\t\t'There was an issue updating the content for the new %s item.',\n\t\t\t\t\t'big-sky'\n\t\t\t\t),\n\t\t\t\tcategory\n\t\t\t);\n\t\t}\n\t};\n\n\treturn {\n\t\treplaceContentAgent,\n\t\taddSection,\n\t\tvalidateAddContentSectionArgs,\n\t\taddItems,\n\t\tvalidateAddItemsArgs,\n\t\tgetItemsCount,\n\t\tgetCurrentPricingContent,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\nimport { applyFormat, create, toHTMLString } from '@wordpress/rich-text';\n\n/**\n * Internal dependencies\n */\nimport { store as aiStore } from '@store';\nimport log from '@utils/log-debug.js';\n\nfunction useFormatContentToolFunctions() {\n\tconst { getSelectedBlock, getSelectionStart, getSelectionEnd } = useSelect(\n\t\t( select ) => select( blockEditorStore )\n\t);\n\tconst { updateBlockAttributes } = useDispatch( blockEditorStore );\n\tconst { setBlockBeforeChanges } = useDispatch( aiStore );\n\n\tconst validateFormatContentArgs = ( args ) => {\n\t\tconst selectedBlock = getSelectedBlock();\n\n\t\tif (\n\t\t\t! selectedBlock.attributes?.content?.originalHTML ||\n\t\t\tselectedBlock.attributes?.content?.originalHTML !== args?.text\n\t\t) {\n\t\t\tthrow new Error(\n\t\t\t\t__(\n\t\t\t\t\t'Please select a single block that contains the text you want to format.',\n\t\t\t\t\t'big-sky'\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t\treturn true;\n\t};\n\n\tconst formatContent = async ( { text, substring, formats } ) => {\n\t\ttry {\n\t\t\tconst selectedBlock = getSelectedBlock();\n\n\t\t\tlet start = 0;\n\t\t\tlet end = text?.length;\n\n\t\t\tif ( substring ) {\n\t\t\t\tconst substringStart = text?.indexOf( substring );\n\t\t\t\tif ( substringStart !== -1 ) {\n\t\t\t\t\tstart = substringStart;\n\t\t\t\t\tend = start + substring.length;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst selectionStart = getSelectionStart()?.offset;\n\t\t\t\tconst selectionEnd = getSelectionEnd()?.offset;\n\n\t\t\t\tif ( selectionStart !== selectionEnd ) {\n\t\t\t\t\tstart = selectionStart ?? 0;\n\t\t\t\t\tend = selectionEnd ?? text?.length;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsetBlockBeforeChanges( selectedBlock );\n\n\t\t\tconst richText = create( {\n\t\t\t\thtml: selectedBlock.attributes.content || '',\n\t\t\t} );\n\t\t\tlet newRichText = richText;\n\n\t\t\tformats.forEach( ( format ) => {\n\t\t\t\tnewRichText = applyFormat(\n\t\t\t\t\tnewRichText,\n\t\t\t\t\t{ type: `core/${ format }` },\n\t\t\t\t\tstart,\n\t\t\t\t\tend\n\t\t\t\t);\n\t\t\t} );\n\t\t\tupdateBlockAttributes( selectedBlock.clientId, {\n\t\t\t\tcontent: toHTMLString( { value: newRichText } ),\n\t\t\t} );\n\n\t\t\treturn __( 'Content has been formatted successfully.', 'big-sky' );\n\t\t} catch ( error ) {\n\t\t\tlog.error( 'Error formatting content:', error );\n\t\t\treturn __( 'Failed to format the content.', 'big-sky' );\n\t\t}\n\t};\n\n\treturn {\n\t\tformatContent,\n\t\tvalidateFormatContentArgs,\n\t};\n}\n\nexport default useFormatContentToolFunctions;\n","/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport { useChat } from '@automattic/big-sky-agents';\nimport useResetSite from '@hooks/use-reset-site';\n\nexport default function useSiteToolFunctions() {\n\tconst { resetSite } = useResetSite();\n\tconst { clearMessages } = useChat();\n\n\tconst startOverActions = [\n\t\t{\n\t\t\tactionName: __( 'Yes', 'big-sky' ),\n\t\t\tdescription: __( 'Permanently reset my site', 'big-sky' ),\n\t\t\ttype: 'confirmationDestructive',\n\t\t\tkey: 'start-over-yes',\n\t\t},\n\t\t{\n\t\t\tactionName: __( 'No', 'big-sky' ),\n\t\t\tdescription: __( 'I have changed my mind', 'big-sky' ),\n\t\t\ttype: 'confirmation',\n\t\t\tkey: 'start-over-no',\n\t\t},\n\t];\n\tconst startOver = async ( userConfirmation ) => {\n\t\tif ( userConfirmation.startsWith( startOverActions[ 0 ].actionName ) ) {\n\t\t\tresetSite();\n\t\t}\n\n\t\tclearMessages();\n\t};\n\n\treturn {\n\t\tstartOver,\n\t\tstartOverActions,\n\t};\n}\n","import createColorPaletteGeneratorTool from './tools/color-palette-generator.js';\nimport createUpdateComponentColorTool from './tools/update-component-color.js';\nimport changeAssistantTool from '@ai/assistants/shared/change-assistant/change-assistant-tool.js';\nimport { ASSISTANTS } from '@ai/assistants/constants.js';\nimport { isForwardedByRouter } from '@ai/assistants/shared/prompts.js';\n\nconst colorAssistantToolkit = {\n\tname: 'color',\n\ttools: ( context ) => {\n\t\tconst tools = [\n\t\t\tcreateColorPaletteGeneratorTool(\n\t\t\t\tcontext.colors?.colorVariationCategories\n\t\t\t),\n\t\t\tcreateUpdateComponentColorTool(),\n\t\t];\n\n\t\tif (\n\t\t\tcontext.currentHandoffArea !== 'colors' &&\n\t\t\t! isForwardedByRouter( context )\n\t\t) {\n\t\t\ttools.push( changeAssistantTool( ASSISTANTS.COLOR ) );\n\t\t}\n\n\t\treturn tools;\n\t},\n};\n\nexport default colorAssistantToolkit;\n","const createUpdateComponentColorTool = () => {\n\treturn {\n\t\tname: 'update_component_color',\n\t\tdescription: `Update the color of the component.\n\t\t\tAvailable components are background, text, buttons, and button text.\n\t\t\tDefault scope to global.\n\t\t\tA global scope request will contain keywords like 'site' or 'all' or similar words.\n\t\t\tIf the scope isn't global and a clientId is provided, use block as the scope \n\t\t\tif the user specifically says this button, this paragraph, etc. Otherwise the scope is section.`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tbackground_color: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription: 'The hex color value.',\n\t\t\t\t},\n\t\t\t\ttext_color: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription: 'The hex color value.',\n\t\t\t\t},\n\t\t\t\tbutton_color: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription: 'The hex color value.',\n\t\t\t\t},\n\t\t\t\tbutton_text_color: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription: 'The hex color value.',\n\t\t\t\t},\n\t\t\t\tscope: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription: 'The scope of the component.',\n\t\t\t\t\tenum: [ 'global', 'section', 'block' ],\n\t\t\t\t},\n\t\t\t\tclientId: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription: 'The client ID of the selected block.',\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [\n\t\t\t\t'background_color',\n\t\t\t\t'text_color',\n\t\t\t\t'button_color',\n\t\t\t\t'button_text_color',\n\t\t\t\t'scope',\n\t\t\t\t'clientId',\n\t\t\t],\n\t\t\tadditionalProperties: false,\n\t\t},\n\t\tstrict: true,\n\t};\n};\n\nexport default createUpdateComponentColorTool;\n","var a=function(a){return\"string\"==typeof a?a.length>0:\"number\"==typeof a},t=function(a,t,o){return void 0===t&&(t=0),void 0===o&&(o=Math.pow(10,t)),Math.round(o*a)/o+0},o=function(a,t,o){return void 0===t&&(t=0),void 0===o&&(o=1),a>o?o:a>t?a:t},r=function(a){var t=a/255;return t<.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},h=function(a){return 255*(a>.0031308?1.055*Math.pow(a,1/2.4)-.055:12.92*a)},n=96.422,p=100,M=82.521,u=function(a){var t,r,n={x:.9555766*(t=a).x+-.0230393*t.y+.0631636*t.z,y:-.0282895*t.x+1.0099416*t.y+.0210077*t.z,z:.0122982*t.x+-.020483*t.y+1.3299098*t.z};return r={r:h(.032404542*n.x-.015371385*n.y-.004985314*n.z),g:h(-.00969266*n.x+.018760108*n.y+41556e-8*n.z),b:h(556434e-9*n.x-.002040259*n.y+.010572252*n.z),a:a.a},{r:o(r.r,0,255),g:o(r.g,0,255),b:o(r.b,0,255),a:o(r.a)}},e=function(a){var t=r(a.r),h=r(a.g),u=r(a.b);return function(a){return{x:o(a.x,0,n),y:o(a.y,0,p),z:o(a.z,0,M),a:o(a.a)}}(function(a){return{x:1.0478112*a.x+.0228866*a.y+-.050127*a.z,y:.0295424*a.x+.9904844*a.y+-.0170491*a.z,z:-.0092345*a.x+.0150436*a.y+.7521316*a.z,a:a.a}}({x:100*(.4124564*t+.3575761*h+.1804375*u),y:100*(.2126729*t+.7151522*h+.072175*u),z:100*(.0193339*t+.119192*h+.9503041*u),a:a.a}))},w=216/24389,b=24389/27,i=function(t){var r=t.l,h=t.a,n=t.b,p=t.alpha,M=void 0===p?1:p;if(!a(r)||!a(h)||!a(n))return null;var u=function(a){return{l:o(a.l,0,400),a:a.a,b:a.b,alpha:o(a.alpha)}}({l:Number(r),a:Number(h),b:Number(n),alpha:Number(M)});return l(u)},l=function(a){var t=(a.l+16)/116,o=a.a/500+t,r=t-a.b/200;return u({x:(Math.pow(o,3)>w?Math.pow(o,3):(116*o-16)/b)*n,y:(a.l>8?Math.pow((a.l+16)/116,3):a.l/b)*p,z:(Math.pow(r,3)>w?Math.pow(r,3):(116*r-16)/b)*M,a:a.alpha})};export default function(a,r){a.prototype.toLab=function(){return o=e(this.rgba),h=o.y/p,u=o.z/M,r=(r=o.x/n)>w?Math.cbrt(r):(b*r+16)/116,a={l:116*(h=h>w?Math.cbrt(h):(b*h+16)/116)-16,a:500*(r-h),b:200*(h-(u=u>w?Math.cbrt(u):(b*u+16)/116)),alpha:o.a},{l:t(a.l,2),a:t(a.a,2),b:t(a.b,2),alpha:t(a.alpha,3)};var a,o,r,h,u},a.prototype.delta=function(r){void 0===r&&(r=\"#FFF\");var h=r instanceof a?r:new a(r),n=function(a,t){var o=a.l,r=a.a,h=a.b,n=t.l,p=t.a,M=t.b,u=180/Math.PI,e=Math.PI/180,w=Math.pow(Math.pow(r,2)+Math.pow(h,2),.5),b=Math.pow(Math.pow(p,2)+Math.pow(M,2),.5),i=(o+n)/2,l=Math.pow((w+b)/2,7),c=.5*(1-Math.pow(l/(l+Math.pow(25,7)),.5)),f=r*(1+c),y=p*(1+c),v=Math.pow(Math.pow(f,2)+Math.pow(h,2),.5),x=Math.pow(Math.pow(y,2)+Math.pow(M,2),.5),z=(v+x)/2,s=0===f&&0===h?0:Math.atan2(h,f)*u,d=0===y&&0===M?0:Math.atan2(M,y)*u;s<0&&(s+=360),d<0&&(d+=360);var g=d-s,m=Math.abs(d-s);m>180&&d<=s?g+=360:m>180&&d>s&&(g-=360);var N=s+d;m<=180?N/=2:N=(s+d<360?N+360:N-360)/2;var F=1-.17*Math.cos(e*(N-30))+.24*Math.cos(2*e*N)+.32*Math.cos(e*(3*N+6))-.2*Math.cos(e*(4*N-63)),L=n-o,I=x-v,P=2*Math.sin(e*g/2)*Math.pow(v*x,.5),j=1+.015*Math.pow(i-50,2)/Math.pow(20+Math.pow(i-50,2),.5),k=1+.045*z,q=1+.015*z*F,A=30*Math.exp(-1*Math.pow((N-275)/25,2)),B=-2*Math.pow(l/(l+Math.pow(25,7)),.5)*Math.sin(2*e*A);return Math.pow(Math.pow(L/1/j,2)+Math.pow(I/1/k,2)+Math.pow(P/1/q,2)+B*I*P/(1*k*1*q),.5)}(this.toLab(),h.toLab())/100;return o(t(n,3))},r.object.push([i,\"lab\"])}\n","/**\n * WordPress dependencies\n */\nimport { SVG, Path } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst arrowLeft = /*#__PURE__*/_jsx(SVG, {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 24 24\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"M20 11.2H6.8l3.7-3.7-1-1L3.9 12l5.6 5.5 1-1-3.7-3.7H20z\"\n  })\n});\nexport default arrowLeft;\n//# sourceMappingURL=arrow-left.js.map","/**\n * WordPress dependencies\n */\nimport { SVG, Path } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst arrowRight = /*#__PURE__*/_jsx(SVG, {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 24 24\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"m14.5 6.5-1 1 3.7 3.7H4v1.6h13.2l-3.7 3.7 1 1 5.6-5.5z\"\n  })\n});\nexport default arrowRight;\n//# sourceMappingURL=arrow-right.js.map","/*!\n * is-plain-object <https://github.com/jonschlinkert/is-plain-object>\n *\n * Copyright (c) 2014-2017, Jon Schlinkert.\n * Released under the MIT License.\n */\n\nfunction isObject(o) {\n  return Object.prototype.toString.call(o) === '[object Object]';\n}\n\nfunction isPlainObject(o) {\n  var ctor,prot;\n\n  if (isObject(o) === false) return false;\n\n  // If has modified constructor\n  ctor = o.constructor;\n  if (ctor === undefined) return true;\n\n  // If has modified prototype\n  prot = ctor.prototype;\n  if (isObject(prot) === false) return false;\n\n  // If constructor does not have an Object-specific method\n  if (prot.hasOwnProperty('isPrototypeOf') === false) {\n    return false;\n  }\n\n  // Most likely a plain Object\n  return true;\n}\n\nexport { isPlainObject };\n","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"keycodes\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"compose\"];","/**\n * WordPress dependencies\n */\nimport {\n\tprivateApis as blockEditorPrivateApis,\n\t__unstableEditorStyles as EditorStyles,\n\t__unstableIframe as Iframe,\n} from '@wordpress/block-editor';\nimport {\n\t__experimentalHStack as HStack,\n\t__unstableMotion as motion,\n\t__experimentalVStack as VStack,\n} from '@wordpress/components';\nimport { useResizeObserver, useThrottle } from '@wordpress/compose';\nimport { useLayoutEffect, useMemo, useState } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { unlock } from '@utils/lock-unlock';\nimport useStyles from '@hooks/use-styles';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport useVariations from '@hooks/use-variations';\n\nconst { useGlobalStyle, useGlobalStylesOutput } = unlock(\n\tblockEditorPrivateApis\n);\n\nconst firstFrame = {\n\tstart: {\n\t\tscale: 1,\n\t\topacity: 1,\n\t},\n};\n\nconst secondFrame = {\n\tstart: {\n\t\tscale: 0,\n\t\topacity: 0,\n\t},\n};\n\nconst normalizedWidth = 248;\nconst normalizedHeight = 152;\n\nconst normalizedColorSwatchSize = 52;\n\n// Throttle options for useThrottle. Must be defined outside of the component,\n// so that the object reference is the same on each render.\nconst THROTTLE_OPTIONS = {\n\tleading: true,\n\ttrailing: true,\n};\n\nconst StylesPreview = ( { label, type } ) => {\n\tconst [ fontFamily = 'serif' ] = useGlobalStyle( 'typography.fontFamily' );\n\tconst [ fontWeight ] = useGlobalStyle( 'typography.fontWeight' );\n\tconst [ fontStyle = 'normal' ] = useGlobalStyle( 'typography.fontStyle' );\n\tconst [ textTransform = 'none' ] = useGlobalStyle(\n\t\t'typography.textTransform'\n\t);\n\tconst [ textColor = 'black' ] = useGlobalStyle( 'color.text' );\n\n\tconst [ h1FontFamily ] = useGlobalStyle(\n\t\t'elements.h1.typography.fontFamily'\n\t);\n\tconst [ headingFontFamily ] = useGlobalStyle(\n\t\t'elements.heading.typography.fontFamily'\n\t);\n\tconst headerFontFamily = h1FontFamily ?? headingFontFamily ?? fontFamily;\n\n\tconst [ h1FontWeight ] = useGlobalStyle(\n\t\t'elements.h1.typography.fontWeight'\n\t);\n\tconst [ headingFontWeight ] = useGlobalStyle(\n\t\t'elements.heading.typography.fontWeight'\n\t);\n\tconst headerFontWeight = h1FontWeight ?? headingFontWeight ?? fontWeight;\n\n\tconst [ h1FontStyle ] = useGlobalStyle(\n\t\t'elements.h1.typography.fontStyle'\n\t);\n\tconst [ headingFontStyle ] = useGlobalStyle(\n\t\t'elements.heading.typography.fontStyle'\n\t);\n\tconst headerFontStyle = h1FontStyle ?? headingFontStyle ?? fontStyle;\n\n\tconst [ h1TextTransform ] = useGlobalStyle(\n\t\t'elements.h1.typography.textTransform'\n\t);\n\tconst [ headingTextTransform ] = useGlobalStyle(\n\t\t'elements.heading.typography.textTransform'\n\t);\n\tconst headerTextTransform =\n\t\th1TextTransform ?? headingTextTransform ?? textTransform;\n\n\tconst [ h1Color ] = useGlobalStyle( 'elements.h1.color.text' );\n\tconst [ headingColor ] = useGlobalStyle( 'elements.heading.color.text' );\n\tconst headerColor = h1Color ?? headingColor ?? textColor;\n\n\tconst [ backgroundColor = 'white' ] = useGlobalStyle( 'color.background' );\n\tconst [ styles ] = useGlobalStylesOutput();\n\tconst [ containerResizeListener, { width } ] = useResizeObserver();\n\tconst [ throttledWidth, setThrottledWidthState ] = useState( width );\n\tconst [ ratioState, setRatioState ] = useState();\n\n\tconst setThrottledWidth = useThrottle(\n\t\tsetThrottledWidthState,\n\t\t250,\n\t\tTHROTTLE_OPTIONS\n\t);\n\n\tconst { currentColor } = useSiteMetadata().getSiteMetadata();\n\tconst { getColorVariationByTitle } = useVariations();\n\tconst colorVariation = getColorVariationByTitle( currentColor );\n\n\tconst activeBackgroundColor = () => {\n\t\tconst backgroundVar = colorVariation?.styles?.color?.background;\n\t\tconst colorNumber = backgroundVar\n\t\t\t?.split( '--' )[ 4 ]\n\t\t\t.replace( ')', '' );\n\n\t\t// Return the theme color where the slug matches the color number\n\t\treturn colorVariation?.settings?.color?.palette?.theme?.find(\n\t\t\t( color ) => {\n\t\t\t\treturn color.slug === colorNumber;\n\t\t\t}\n\t\t)?.color;\n\t};\n\n\tconst activeTextColor = () => {\n\t\tconst textVar = colorVariation?.styles?.color?.text;\n\t\tconst colorNumber = textVar?.split( '--' )[ 4 ].replace( ')', '' );\n\n\t\t// Return the theme color where the slug matches the color number\n\t\treturn colorVariation?.settings?.color?.palette?.theme?.find(\n\t\t\t( color ) => {\n\t\t\t\treturn color.slug === colorNumber;\n\t\t\t}\n\t\t)?.color;\n\t};\n\n\tconst getVariationBackgroundColor = () => {\n\t\tif ( type === 'color' ) {\n\t\t\treturn backgroundColor ? backgroundColor : '#ffffff';\n\t\t}\n\n\t\treturn activeBackgroundColor() || '#ffffff';\n\t};\n\n\t// Must use useLayoutEffect to avoid a flash of the iframe at the wrong\n\t// size before the width is set.\n\tuseLayoutEffect( () => {\n\t\tif ( width ) {\n\t\t\tsetThrottledWidth( width );\n\t\t}\n\t}, [ width, setThrottledWidth ] );\n\n\t// Must use useLayoutEffect to avoid a flash of the iframe at the wrong\n\t// size before the width is set.\n\tuseLayoutEffect( () => {\n\t\tconst newRatio = throttledWidth ? throttledWidth / normalizedWidth : 1;\n\t\tconst ratioDiff = newRatio - ( ratioState || 0 );\n\n\t\t// Only update the ratio state if the difference is big enough\n\t\t// or if the ratio state is not yet set. This is to avoid an\n\t\t// endless loop of updates at particular viewport heights when the\n\t\t// presence of a scrollbar causes the width to change slightly.\n\t\tconst isRatioDiffBigEnough = Math.abs( ratioDiff ) > 0.1;\n\n\t\tif ( isRatioDiffBigEnough || ! ratioState ) {\n\t\t\tsetRatioState( newRatio );\n\t\t}\n\t}, [ throttledWidth, ratioState ] );\n\n\t// Set a fallbackRatio to use before the throttled ratio has been set.\n\tconst fallbackRatio = width ? width / normalizedWidth : 1;\n\t// Use the throttled ratio if it has been calculated, otherwise\n\t// use the fallback ratio. The throttled ratio is used to avoid\n\t// an endless loop of updates at particular viewport heights.\n\t// See: https://github.com/WordPress/gutenberg/issues/55112\n\tconst ratio = ratioState ? ratioState : fallbackRatio;\n\n\tconst { paletteColors, getThemeColors } = useStyles();\n\n\tconst getColorsToShow = () => {\n\t\tconst colorsToShow = getThemeColors();\n\t\t// filter out the background color\n\t\treturn colorsToShow\n\t\t\t.filter( ( color ) => color.color !== backgroundColor )\n\t\t\t.slice( 0, 3 );\n\t};\n\n\t// Reset leaked styles from WP common.css and remove main content layout padding and border.\n\tconst editorStyles = useMemo( () => {\n\t\tif ( styles ) {\n\t\t\treturn [\n\t\t\t\t...styles,\n\t\t\t\t{\n\t\t\t\t\tcss: 'html{overflow:hidden}body{min-width: 0;padding: 0;border: none;}',\n\t\t\t\t\tisGlobalStyles: true,\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\n\t\treturn styles;\n\t}, [ styles ] );\n\tconst isReady = !! width;\n\n\treturn (\n\t\t<>\n\t\t\t<div style={ { position: 'relative' } }>\n\t\t\t\t{ containerResizeListener }\n\t\t\t</div>\n\t\t\t{ isReady && (\n\t\t\t\t<Iframe\n\t\t\t\t\tclassName=\"edit-site-global-styles-preview__iframe\"\n\t\t\t\t\tstyle={ {\n\t\t\t\t\t\twidth: '100%',\n\t\t\t\t\t\theight: normalizedHeight * ratio,\n\t\t\t\t\t} }\n\t\t\t\t\ttabIndex={ -1 }\n\t\t\t\t>\n\t\t\t\t\t<EditorStyles styles={ editorStyles } />\n\t\t\t\t\t<motion.div\n\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\theight: normalizedHeight * ratio,\n\t\t\t\t\t\t\twidth: '100%',\n\t\t\t\t\t\t\tbackground: getVariationBackgroundColor(),\n\t\t\t\t\t\t\tcursor: 'pointer',\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tinitial=\"start\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<motion.div\n\t\t\t\t\t\t\tvariants={ firstFrame }\n\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\theight: '100%',\n\t\t\t\t\t\t\t\toverflow: 'hidden',\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<HStack\n\t\t\t\t\t\t\t\tspacing={ 10 * ratio }\n\t\t\t\t\t\t\t\tjustify=\"center\"\n\t\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\t\theight: '100%',\n\t\t\t\t\t\t\t\t\toverflow: 'hidden',\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ type === 'font' && (\n\t\t\t\t\t\t\t\t\t<motion.div\n\t\t\t\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\t\t\t\tcolor:\n\t\t\t\t\t\t\t\t\t\t\t\tactiveTextColor() || '#000000',\n\t\t\t\t\t\t\t\t\t\t\twhiteSpace: 'nowrap',\n\t\t\t\t\t\t\t\t\t\t\tpaddingLeft: '5px',\n\t\t\t\t\t\t\t\t\t\t\tlineHeight: 1,\n\t\t\t\t\t\t\t\t\t\t\tpadding: '0.2em',\n\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\tanimate={ { scale: 1, opacity: 1 } }\n\t\t\t\t\t\t\t\t\t\tinitial={ { scale: 0.1, opacity: 0 } }\n\t\t\t\t\t\t\t\t\t\ttransition={ {\n\t\t\t\t\t\t\t\t\t\t\tdelay: 0.3,\n\t\t\t\t\t\t\t\t\t\t\ttype: 'tween',\n\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\t\t\t\t\tfontFamily: headerFontFamily,\n\t\t\t\t\t\t\t\t\t\t\t\tfontSize: 100 * ratio,\n\t\t\t\t\t\t\t\t\t\t\t\tfontWeight: headerFontWeight,\n\t\t\t\t\t\t\t\t\t\t\t\tfontStyle: headerFontStyle,\n\t\t\t\t\t\t\t\t\t\t\t\ttextTransform:\n\t\t\t\t\t\t\t\t\t\t\t\t\theaderTextTransform,\n\t\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\tA\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\t\t\t\t\tfontFamily,\n\t\t\t\t\t\t\t\t\t\t\t\tfontSize: 90 * ratio,\n\t\t\t\t\t\t\t\t\t\t\t\tfontWeight,\n\t\t\t\t\t\t\t\t\t\t\t\tfontStyle,\n\t\t\t\t\t\t\t\t\t\t\t\ttextTransform,\n\t\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\ta\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</motion.div>\n\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t{ type === 'color' && (\n\t\t\t\t\t\t\t\t\t<HStack\n\t\t\t\t\t\t\t\t\t\tspacing={ 0 }\n\t\t\t\t\t\t\t\t\t\talignment=\"center\"\n\t\t\t\t\t\t\t\t\t\tstyle={ { margin: '0 0 0 10px' } }\n\t\t\t\t\t\t\t\t\t\tclassName=\"big-sky__color-swatch\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ getColorsToShow().map(\n\t\t\t\t\t\t\t\t\t\t\t( { slug, color }, index ) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<motion.div\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={ ` ${ slug }_${ index }` }\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\theight:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnormalizedColorSwatchSize *\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tratio,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twidth:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnormalizedColorSwatchSize *\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tratio,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbackground: color,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tborderRadius: '100%',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmargin: '0 0 0 -10px',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tborder: `3px solid ${ getVariationBackgroundColor() }`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tboxSizing:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'content-box',\n\t\t\t\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\t\t\t\tanimate={ {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tscale: 1,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\topacity: 1,\n\t\t\t\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\t\t\t\tinitial={ {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tscale: 0.1,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\t\t\t\ttransition={ {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdelay:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tindex === 1\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 0.2\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 0.1,\n\t\t\t\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t</HStack>\n\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t</HStack>\n\t\t\t\t\t\t</motion.div>\n\t\t\t\t\t\t<motion.div\n\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\theight: '100%',\n\t\t\t\t\t\t\t\twidth: '100%',\n\t\t\t\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t\t\t\toverflow: 'hidden',\n\t\t\t\t\t\t\t\tfilter: 'blur(60px)',\n\t\t\t\t\t\t\t\topacity: 0.1,\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<HStack\n\t\t\t\t\t\t\t\tspacing={ 0 }\n\t\t\t\t\t\t\t\tjustify=\"flex-start\"\n\t\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\t\theight: '100%',\n\t\t\t\t\t\t\t\t\toverflow: 'hidden',\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ paletteColors\n\t\t\t\t\t\t\t\t\t.slice( 0, 4 )\n\t\t\t\t\t\t\t\t\t.map( ( { color }, index ) => (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tkey={ index }\n\t\t\t\t\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\t\t\t\t\theight: '100%',\n\t\t\t\t\t\t\t\t\t\t\t\tbackground: color,\n\t\t\t\t\t\t\t\t\t\t\t\tflexGrow: 1,\n\t\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t) ) }\n\t\t\t\t\t\t\t</HStack>\n\t\t\t\t\t\t</motion.div>\n\t\t\t\t\t\t<motion.div\n\t\t\t\t\t\t\tvariants={ secondFrame }\n\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\theight: '100%',\n\t\t\t\t\t\t\t\twidth: '100%',\n\t\t\t\t\t\t\t\toverflow: 'hidden',\n\t\t\t\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<VStack\n\t\t\t\t\t\t\t\tspacing={ 3 * ratio }\n\t\t\t\t\t\t\t\tjustify=\"center\"\n\t\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\t\theight: '100%',\n\t\t\t\t\t\t\t\t\toverflow: 'hidden',\n\t\t\t\t\t\t\t\t\tpadding: 10 * ratio,\n\t\t\t\t\t\t\t\t\tboxSizing: 'border-box',\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ label && (\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\t\t\t\tfontSize: 40 * ratio,\n\t\t\t\t\t\t\t\t\t\t\tfontFamily: headerFontFamily,\n\t\t\t\t\t\t\t\t\t\t\tcolor:\n\t\t\t\t\t\t\t\t\t\t\t\ttype === 'color'\n\t\t\t\t\t\t\t\t\t\t\t\t\t? headerColor\n\t\t\t\t\t\t\t\t\t\t\t\t\t: '#1e1e1e',\n\t\t\t\t\t\t\t\t\t\t\tfontWeight: headerFontWeight,\n\t\t\t\t\t\t\t\t\t\t\tfontStyle: headerFontStyle,\n\t\t\t\t\t\t\t\t\t\t\ttextTransform: headerTextTransform,\n\t\t\t\t\t\t\t\t\t\t\tlineHeight: '1em',\n\t\t\t\t\t\t\t\t\t\t\ttextAlign: 'center',\n\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ label }\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t</VStack>\n\t\t\t\t\t\t</motion.div>\n\t\t\t\t\t</motion.div>\n\t\t\t\t</Iframe>\n\t\t\t) }\n\t\t</>\n\t);\n};\n\nexport default StylesPreview;\n","/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport deepmerge from 'deepmerge';\nimport { isPlainObject } from 'is-plain-object';\n\n/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\n\nimport { store as coreStore } from '@wordpress/core-data';\nimport { useContext, useMemo, useState } from '@wordpress/element';\nimport { ENTER } from '@wordpress/keycodes';\nimport { __experimentalGrid as Grid } from '@wordpress/components';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { privateApis as blockEditorPrivateApis } from '@wordpress/block-editor';\nimport { recordTracksEvent } from '@utils/tracks';\n\n/**\n * Internal dependencies\n */\nimport StylesPreview from '@components/styles-preview';\nimport { unlock } from '@utils/lock-unlock';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport useStyles from '@hooks/use-styles';\n\nconst { GlobalStylesContext } = unlock( blockEditorPrivateApis );\n\nfunction mergeBaseAndUserConfigs( base = {}, user = {} ) {\n\treturn deepmerge( base, user, {\n\t\t// We only pass as arrays the presets,\n\t\t// in which case we want the new array of values\n\t\t// to override the old array (no merging).\n\t\tisMergeableObject: isPlainObject,\n\t} );\n}\n\nexport function Variation( { variation, type } ) {\n\tconst { setStyles } = useStyles();\n\tconst [ isFocused, setIsFocused ] = useState( false );\n\tconst { base } = useContext( GlobalStylesContext );\n\tconst context = useMemo( () => {\n\t\tconst user = {\n\t\t\tsettings: {\n\t\t\t\t...variation?.settings,\n\t\t\t\tisPreview: true,\n\t\t\t},\n\t\t\tstyles: variation?.styles ?? {},\n\t\t};\n\n\t\treturn {\n\t\t\tuser,\n\t\t\tbase,\n\t\t\tmerged: mergeBaseAndUserConfigs( base, user ),\n\t\t\tsetUserConfig: () => {},\n\t\t};\n\t}, [ variation, base ] );\n\tconst { currentColor, currentFont } = useSiteMetadata().getSiteMetadata();\n\n\tconst handleSelectVariation = () => {\n\t\tif ( type === 'color' ) {\n\t\t\trecordTracksEvent( 'color_variation_click', {\n\t\t\t\tcolor: variation.title,\n\t\t\t} );\n\t\t\tsetStyles( { color: variation.title } );\n\t\t} else {\n\t\t\trecordTracksEvent( 'font_variation_click', {\n\t\t\t\tfont: variation.title,\n\t\t\t} );\n\t\t\tsetStyles( { font: variation.title } );\n\t\t}\n\t};\n\n\tconst selectOnEnter = ( event ) => {\n\t\tif ( event.keyCode === ENTER ) {\n\t\t\tevent.preventDefault();\n\t\t\thandleSelectVariation();\n\t\t}\n\t};\n\n\tconst isActive = () => {\n\t\tif ( type === 'color' ) {\n\t\t\treturn variation?.title === currentColor;\n\t\t}\n\n\t\treturn variation?.title === currentFont;\n\t};\n\n\tlet label = variation?.title;\n\tif ( variation?.description ) {\n\t\tlabel = sprintf(\n\t\t\t/* translators: %1$s: variation title. %2$s variation description. */\n\t\t\t__( '%1$s (%2$s)', 'big-sky' ),\n\t\t\tvariation?.title,\n\t\t\tvariation?.description\n\t\t);\n\t}\n\n\treturn (\n\t\t<GlobalStylesContext.Provider value={ context }>\n\t\t\t<div\n\t\t\t\tclassName={ classnames(\n\t\t\t\t\t'edit-site-global-styles-variations_item',\n\t\t\t\t\t{\n\t\t\t\t\t\t'is-active': isActive(),\n\t\t\t\t\t}\n\t\t\t\t) }\n\t\t\t\trole=\"button\"\n\t\t\t\tonClick={ handleSelectVariation }\n\t\t\t\tonKeyDown={ selectOnEnter }\n\t\t\t\ttabIndex=\"0\"\n\t\t\t\taria-label={ label }\n\t\t\t\taria-current={ isActive() }\n\t\t\t\tonFocus={ () => setIsFocused( true ) }\n\t\t\t\tonBlur={ () => setIsFocused( false ) }\n\t\t\t>\n\t\t\t\t<div className=\"edit-site-global-styles-variations_item-preview\">\n\t\t\t\t\t<StylesPreview\n\t\t\t\t\t\tlabel={ variation?.title }\n\t\t\t\t\t\tisFocused={ isFocused }\n\t\t\t\t\t\ttype={ type }\n\t\t\t\t\t\tclassName=\"big-sky__styles-preview\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</GlobalStylesContext.Provider>\n\t);\n}\n\nexport function StyleVariationsContainer() {\n\tconst variations = useSelect( ( select ) => {\n\t\treturn select(\n\t\t\tcoreStore\n\t\t).__experimentalGetCurrentThemeGlobalStylesVariations();\n\t}, [] );\n\n\tconst withEmptyVariation = useMemo( () => {\n\t\treturn [\n\t\t\t{\n\t\t\t\ttitle: __( 'Default', 'big-sky' ),\n\t\t\t\tsettings: {},\n\t\t\t\tstyles: {},\n\t\t\t},\n\t\t\t...( variations ?? [] ).map( ( variation ) => ( {\n\t\t\t\t...variation,\n\t\t\t\tsettings: variation.settings ?? {},\n\t\t\t\tstyles: variation.styles ?? {},\n\t\t\t} ) ),\n\t\t];\n\t}, [ variations ] );\n\n\treturn (\n\t\t<Grid\n\t\t\tcolumns={ 2 }\n\t\t\tclassName=\"edit-site-global-styles-style-variations-container\"\n\t\t>\n\t\t\t{ withEmptyVariation.map( ( variation, index ) => (\n\t\t\t\t<Variation key={ index } variation={ variation } />\n\t\t\t) ) }\n\t\t</Grid>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { useEffect, useMemo, useState } from '@wordpress/element';\nimport {\n\tButton,\n\t__experimentalGrid as Grid,\n\t__experimentalHStack as HStack,\n\t__experimentalVStack as VStack,\n} from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { arrowLeft, arrowRight } from '@wordpress/icons';\nimport { Variation } from '@components/style-variations-container.js';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\n\n/**\n * Sort variations so that the current variation is the first in the list.\n *\n * @param {Array}  variations            Array of variation objects.\n * @param {string} currentVariationTitle Title of current variation.\n * @param {number} numSuggestions        Number of suggestions to show. Assumes the variations are sorted with the suggested ones first.\n * @return {Array} New Array of variation objects.\n */\nconst prepareVariations = (\n\tvariations,\n\tcurrentVariationTitle,\n\tnumSuggestions\n) => {\n\tconst preparedVariations = [\n\t\t...variations.filter( ( v ) => v.title !== currentVariationTitle ),\n\t].filter( ( v ) => v );\n\tif ( numSuggestions > 0 ) {\n\t\tconst suggestedVariations = preparedVariations.slice(\n\t\t\t0,\n\t\t\tnumSuggestions // if the current variation is the original variation, we need to offset the number of suggestions\n\t\t);\n\t\treturn [ ...suggestedVariations ];\n\t}\n\treturn preparedVariations;\n};\n\n/**\n * Slice variations ensuring the list does not exceed the specified count and\n * filters out the current variation.\n *\n * @param {Array}  variations Array of variation objects.\n * @param {number} start      Starting index for the slice.\n * @param {number} count      Number of items to include in the slice.\n * @return {Array}            Sliced array of variation objects without the current variation.\n */\nconst sliceVariations = ( variations, start, count ) => {\n\treturn variations.slice( start, start + count );\n};\n\nconst VariationPicker = ( {\n\tvariations,\n\tcurrentVariation,\n\tmaxToShow = 6,\n\ttype,\n\tnumSuggestions = 0,\n} ) => {\n\t// const [ originalVariation, setOriginalVariation ] = useState( null );\n\tconst [ variationsToShow, setVariationsToShow ] = useState( [] );\n\tconst [ firstIndex, setFirstIndex ] = useState( 0 );\n\n\tconst numOfOtherVariationsToShow = maxToShow;\n\n\tconst sortedVariations = useMemo(\n\t\t() => prepareVariations( variations, currentVariation, numSuggestions ),\n\t\t[ variations, currentVariation, numSuggestions ]\n\t);\n\n\tuseEffect( () => {\n\t\tif ( ! sortedVariations ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// set initial variations\n\t\tconst initialVariations = sliceVariations(\n\t\t\tsortedVariations,\n\t\t\t0,\n\t\t\tnumOfOtherVariationsToShow\n\t\t);\n\t\tsetVariationsToShow( initialVariations );\n\t}, [ numOfOtherVariationsToShow, sortedVariations ] );\n\n\tconst revealPrevious = () => {\n\t\tconst nextFirstIndex = Math.max(\n\t\t\t0,\n\t\t\tfirstIndex - numOfOtherVariationsToShow\n\t\t);\n\t\tsetFirstIndex( nextFirstIndex );\n\n\t\tconst newVariations = sliceVariations(\n\t\t\tsortedVariations,\n\t\t\tnextFirstIndex,\n\t\t\tnumOfOtherVariationsToShow\n\t\t);\n\n\t\tsetVariationsToShow( newVariations );\n\t};\n\n\tconst revealNext = () => {\n\t\tconst nextFirstIndex = Math.min(\n\t\t\tfirstIndex + numOfOtherVariationsToShow,\n\t\t\tMath.floor( sortedVariations.length / numOfOtherVariationsToShow ) *\n\t\t\t\tnumOfOtherVariationsToShow\n\t\t);\n\t\tsetFirstIndex( nextFirstIndex );\n\n\t\tconst newVariations = sliceVariations(\n\t\t\tsortedVariations,\n\t\t\tnextFirstIndex,\n\t\t\tnumOfOtherVariationsToShow\n\t\t);\n\t\tsetVariationsToShow( newVariations );\n\t};\n\n\tif ( sortedVariations && sortedVariations.length === 0 ) {\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t{ __(\n\t\t\t\t\t'There was a problem retrieving options. Please try again.',\n\t\t\t\t\t'big-sky'\n\t\t\t\t) }\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className=\"big-sky__dock__menu__variation-picker\">\n\t\t\t{ variationsToShow && variationsToShow.length > 0 && (\n\t\t\t\t<VStack spacing={ 2 }>\n\t\t\t\t\t<Grid columns={ 3 } className=\"big-sky__variations\">\n\t\t\t\t\t\t{ variationsToShow.map( ( variation, index ) => (\n\t\t\t\t\t\t\t<Variation\n\t\t\t\t\t\t\t\tkey={ index }\n\t\t\t\t\t\t\t\tvariation={ variation }\n\t\t\t\t\t\t\t\ttype={ type }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) ) }\n\t\t\t\t\t</Grid>\n\t\t\t\t\t{ sortedVariations.length > maxToShow && (\n\t\t\t\t\t\t<HStack\n\t\t\t\t\t\t\tclassName=\"big-sky__wizard-actions\"\n\t\t\t\t\t\t\talignment=\"edge\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\taria-label={ __(\n\t\t\t\t\t\t\t\t\t'Previous options',\n\t\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\tvariant=\"tertiary\"\n\t\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\t\ticon={ arrowLeft }\n\t\t\t\t\t\t\t\tonClick={ revealPrevious }\n\t\t\t\t\t\t\t\tdisabled={ firstIndex === 0 }\n\t\t\t\t\t\t\t\talign=\"left\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\taria-label={ __( 'Next options', 'big-sky' ) }\n\t\t\t\t\t\t\t\talign=\"right\"\n\t\t\t\t\t\t\t\tvariant=\"tertiary\"\n\t\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\t\ticon={ arrowRight }\n\t\t\t\t\t\t\t\tonClick={ revealNext }\n\t\t\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\t\t\tfirstIndex + numOfOtherVariationsToShow >=\n\t\t\t\t\t\t\t\t\tsortedVariations.length - 1\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</HStack>\n\t\t\t\t\t) }\n\t\t\t\t</VStack>\n\t\t\t) }\n\t\t</div>\n\t);\n};\n\nexport default VariationPicker;\n","import VariationPicker from '@components/variation-picker';\nimport useSiteMetadata from '@hooks/use-site-metadata';\n\nconst ColorVariationPicker = ( {\n\tcolorVariations,\n\tmaxColorsToShow = 12,\n\tnumSuggestions = 0,\n\tcurrentVariationIsSuggested = false,\n} ) => {\n\tconst { currentColor } = useSiteMetadata().getSiteMetadata();\n\n\treturn (\n\t\t<VariationPicker\n\t\t\tvariations={ colorVariations }\n\t\t\tcurrentVariation={ currentColor }\n\t\t\tmaxToShow={ maxColorsToShow }\n\t\t\tnumSuggestions={ numSuggestions }\n\t\t\tcurrentVariationIsSuggested={ currentVariationIsSuggested }\n\t\t\ttype=\"color\"\n\t\t/>\n\t);\n};\n\nexport default ColorVariationPicker;\n","/**\n * WordPress dependencies\n */\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { getBlockSupport } from '@wordpress/blocks';\nimport { useDispatch, useRegistry, useSelect } from '@wordpress/data';\nimport { __, sprintf } from '@wordpress/i18n';\n\n/**\n * External dependencies\n */\nimport { colord, extend } from 'colord';\nimport namesPlugin from 'colord/plugins/names';\nimport labPlugin from 'colord/plugins/lab';\nextend( [ namesPlugin, labPlugin ] );\n\n/**\n * Internal dependencies\n */\nimport ColorVariationPicker from '@components/color-variation-picker';\nimport { store as aiStore } from '@store';\nimport useBlocks from '@hooks/use-blocks';\nimport useCanvas from '@hooks/use-canvas';\nimport usePatterns from '@hooks/use-patterns';\nimport useStyles from '@hooks/use-styles';\nimport useVariations from '@hooks/use-variations';\nimport { dockViews } from '@utils/constants';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport { BIG_SKY_CUSTOM_THEME_PREFIX } from '@utils/custom-color-variations/constants';\nimport { addColorToTheme } from '@utils/colors';\n\nconst cssKeywordToColorMapping = {\n\tbeige: 'white',\n\tblack: 'black',\n\tbisque: 'white',\n\tblanchedalmond: 'white',\n\tcrimson: 'red',\n\tdarkslategray: 'black',\n\tdarkgoldenrod: 'brown',\n\tdarkolivegreen: 'green',\n\tfirebrick: 'red',\n\tgainsboro: 'gray',\n\tgold: 'yellow',\n\thoneydew: 'white',\n\tindigo: 'blue',\n\tivory: 'white',\n\tkhaki: 'brown',\n\tlavender: 'purple',\n\tlavenderblush: 'white',\n\tlightgrey: 'gray',\n\tlightsalmon: 'orange',\n\tlime: 'green',\n\tlinen: 'white',\n\tmaroon: 'red',\n\tmintcream: 'white',\n\tperu: 'brown',\n\tsalmon: 'orange',\n\tseashell: 'white',\n\tsienna: 'brown',\n\tsilver: 'gray',\n\tsnow: 'white',\n\ttan: 'brown',\n\tteal: 'blue',\n\ttomato: 'red',\n\tviolet: 'purple',\n\twheat: 'brown',\n\twhite: 'white',\n};\n\nconst getColorSlug = ( backgroundVar ) => {\n\tconst parts = backgroundVar.split( '--' );\n\treturn parts.pop().replace( ')', '' );\n};\n\nexport default function useColorToolFunctions() {\n\tconst {\n\t\tpushGeneratedVariations,\n\t\tsetDockView,\n\t\tsetLastCancelableAction,\n\t\tsetIsToolContainerVisible,\n\t} = useDispatch( aiStore );\n\tconst { zoomIn } = useCanvas();\n\tconst { getColorVariations, getColorVariationByTitle } = useVariations();\n\tconst { currentColor: currentColorMeta } =\n\t\tuseSiteMetadata().getSiteMetadata();\n\tconst { getCurrentColor } = useSelect( aiStore );\n\tconst {\n\t\tpaletteColors,\n\t\tgetCurrentTheme,\n\t\tsaveStylesEntityRecord,\n\t\tsetStyles,\n\t\tcreateCustomSchemeVariations,\n\t\tupdateRootBlocksStyles,\n\t} = useStyles();\n\tconst { setSiteMetadata } = useSiteMetadata();\n\tconst { getBlocks, getBlock, getBlockAttributes } =\n\t\tuseSelect( blockEditorStore );\n\tconst { updateBlockAttributes } = useDispatch( blockEditorStore );\n\tconst { getTemplatePartClientID } = useBlocks();\n\n\tconst { getParentRootPatternBlock } = useBlocks();\n\tconst { getRootBlocksOfPostContent } = usePatterns();\n\tconst registry = useRegistry();\n\n\tconst validateGenerateColorPaletteArgs = ( args ) => {\n\t\tif ( ! args ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { colors, keyword } = args;\n\n\t\tif (\n\t\t\t( ! colors || ! Array.isArray( colors ) || ! colors.length ) &&\n\t\t\t! keyword\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst generateColorPalette = ( {\n\t\tcolors: requestedColors = [],\n\t\tkeyword = '',\n\t\tcustom_colors,\n\t\tcallback = () => {},\n\t} ) => {\n\t\tconst currentColor = getCurrentColor() || currentColorMeta;\n\t\tconst colorVariations = getColorVariations();\n\n\t\t// get the current theme to use for the cancel action\n\t\tconst currentTheme =\n\t\t\tgetColorVariationByTitle( currentColor ) || getCurrentTheme();\n\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tcolorVariations.sort( () => Math.random() - 0.5 );\n\n\t\t// get color variations with a background that match the requested color\n\t\tlet suggestedVariations = [];\n\t\tif ( keyword || requestedColors?.length > 0 ) {\n\t\t\tsuggestedVariations = colorVariations.filter(\n\t\t\t\t( colorVariation ) => {\n\t\t\t\t\t// get a list of color slugs that are used as a background\n\t\t\t\t\tconst backgroundColorSlugs = [];\n\t\t\t\t\tconst defaultBackground =\n\t\t\t\t\t\tcolorVariation.styles?.color?.background;\n\t\t\t\t\tif ( defaultBackground ) {\n\t\t\t\t\t\tbackgroundColorSlugs.push(\n\t\t\t\t\t\t\tgetColorSlug( defaultBackground )\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tconst variationBackgrounds =\n\t\t\t\t\t\tcolorVariation.styles?.blocks?.[ 'core/group' ]\n\t\t\t\t\t\t\t?.variations;\n\t\t\t\t\tif ( ! variationBackgrounds ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tfor ( const styles of Object.values(\n\t\t\t\t\t\tvariationBackgrounds\n\t\t\t\t\t) ) {\n\t\t\t\t\t\tconst background = styles.color?.background;\n\t\t\t\t\t\tif ( background )\n\t\t\t\t\t\t\tbackgroundColorSlugs.push(\n\t\t\t\t\t\t\t\tgetColorSlug( background )\n\t\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\t// remove null values and duplicates\n\t\t\t\t\tconst uniqueBackgroundColorSlugs = [\n\t\t\t\t\t\t...new Set( backgroundColorSlugs.filter( Boolean ) ),\n\t\t\t\t\t];\n\n\t\t\t\t\tif ( requestedColors?.length ) {\n\t\t\t\t\t\t// Calculate the color relevance\n\t\t\t\t\t\tcolorVariation.relevance =\n\t\t\t\t\t\t\tcolorVariation.settings?.color?.palette?.theme\n\t\t\t\t\t\t\t\t?.filter( ( color ) =>\n\t\t\t\t\t\t\t\t\tuniqueBackgroundColorSlugs.includes(\n\t\t\t\t\t\t\t\t\t\tcolor.slug\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.reduce( ( maxRelevance, color ) => {\n\t\t\t\t\t\t\t\t\treturn Math.max(\n\t\t\t\t\t\t\t\t\t\tmaxRelevance,\n\t\t\t\t\t\t\t\t\t\t...requestedColors.map(\n\t\t\t\t\t\t\t\t\t\t\t( requestedColor ) =>\n\t\t\t\t\t\t\t\t\t\t\t\t1 -\n\t\t\t\t\t\t\t\t\t\t\t\tcolord( requestedColor ).delta(\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor.color\n\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}, 0 );\n\t\t\t\t\t}\n\n\t\t\t\t\t// check if the requested color is in the palette background colors\n\t\t\t\t\tconst hasRequestedColor =\n\t\t\t\t\t\t!! requestedColors &&\n\t\t\t\t\t\tcolorVariation.settings?.color?.palette?.theme?.some(\n\t\t\t\t\t\t\t( color ) => {\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t! uniqueBackgroundColorSlugs.includes(\n\t\t\t\t\t\t\t\t\t\tcolor.slug\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tconst cssKeyword = colord( color.color ).toName(\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tclosest: true,\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tconst colorName =\n\t\t\t\t\t\t\t\t\tcssKeywordToColorMapping[ cssKeyword ] ||\n\t\t\t\t\t\t\t\t\t'';\n\t\t\t\t\t\t\t\treturn requestedColors.some(\n\t\t\t\t\t\t\t\t\t( requestedColor ) =>\n\t\t\t\t\t\t\t\t\t\tcolorName.includes( requestedColor ) ||\n\t\t\t\t\t\t\t\t\t\tcssKeyword.includes( requestedColor ) ||\n\t\t\t\t\t\t\t\t\t\tcolorVariation.title === requestedColor\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t// check if the requested keyword matches\n\t\t\t\t\tconst hasRequestedKeyword =\n\t\t\t\t\t\tcolorVariation[ 'x-big-sky-meta' ]?.keywords?.includes(\n\t\t\t\t\t\t\tkeyword\n\t\t\t\t\t\t);\n\n\t\t\t\t\treturn hasRequestedColor || hasRequestedKeyword;\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\t// check if the current color is one of the suggested variations\n\t\tconst currentColorIsSuggested = suggestedVariations.find(\n\t\t\t( colorVariation ) => colorVariation.title === currentColor\n\t\t);\n\n\t\t// order suggested variations by relevance descending\n\t\tlet suggestedVariationsSorted = suggestedVariations.sort( ( a, b ) => {\n\t\t\tif ( a.relevance > b.relevance ) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif ( a.relevance < b.relevance ) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\treturn 0;\n\t\t} );\n\n\t\t// put suggested color palettes first\n\t\tlet colorVariationsSorted = suggestedVariationsSorted.concat(\n\t\t\tcolorVariations.filter(\n\t\t\t\t( colorVariation ) =>\n\t\t\t\t\t! suggestedVariationsSorted.includes( colorVariation )\n\t\t\t)\n\t\t);\n\n\t\tif ( colorVariationsSorted.length === 0 ) {\n\t\t\tcolorVariationsSorted = colorVariations;\n\t\t}\n\n\t\tlet customPalettes = [];\n\t\tif ( custom_colors ) {\n\t\t\tcustomPalettes = createCustomSchemeVariations( {\n\t\t\t\tcustom_colors,\n\t\t\t} );\n\t\t\tcolorVariationsSorted = [\n\t\t\t\t...customPalettes,\n\t\t\t\t...colorVariationsSorted,\n\t\t\t];\n\t\t\tsuggestedVariationsSorted = [\n\t\t\t\t...customPalettes,\n\t\t\t\t...suggestedVariationsSorted,\n\t\t\t];\n\t\t\t// We have to update the global styles with the custom color scheme.\n\t\t}\n\n\t\tconst styleChanges = collectBlockColorAttributes();\n\t\t// Set the last cancelable action to allow the user to undo the color selection\n\t\tsetLastCancelableAction( {\n\t\t\taction: 'color_palette_generator',\n\t\t\toriginalVariationName:\n\t\t\t\tcurrentTheme.title.raw ||\n\t\t\t\tcurrentTheme.title ||\n\t\t\t\tBIG_SKY_CUSTOM_THEME_PREFIX,\n\t\t\tpaletteColors,\n\t\t\tcustomColors: styleChanges,\n\t\t} );\n\n\t\tcallback(\n\t\t\t<ColorVariationPicker\n\t\t\t\tcolorVariations={ colorVariationsSorted }\n\t\t\t\tnumSuggestions={ suggestedVariationsSorted.length }\n\t\t\t\tcurrentVariationIsSuggested={ currentColorIsSuggested }\n\t\t\t\tmaxColorsToShow={ 6 }\n\t\t\t\tkey=\"color-picker\"\n\t\t\t/>,\n\t\t\t__( 'Which of these palettes would you like?', 'big-sky' )\n\t\t);\n\t};\n\n\tconst cancelGenerateColorPalette = ( lastCancelableAction ) => {\n\t\tsetStyles( {\n\t\t\tcolor: lastCancelableAction.originalVariationName,\n\t\t} );\n\t\treapplyBlockColors( lastCancelableAction.customColors );\n\t\tsetDockView( dockViews.MENUS );\n\t\tsetIsToolContainerVisible( false );\n\t\tzoomIn();\n\t};\n\n\tconst doneGenerateColorPalette = () => {\n\t\tsaveStylesEntityRecord();\n\t\tsetSiteMetadata( {}, true ); // persist the current site metadata\n\t\tsetDockView( dockViews.MENUS );\n\t\tsetIsToolContainerVisible( false );\n\t\tzoomIn();\n\t};\n\n\tconst validateUpdateComponentColorArgs = ( {\n\t\tbackground_color,\n\t\ttext_color,\n\t\tbutton_color,\n\t\tbutton_text_color,\n\t\tscope,\n\t\tclientId,\n\t} ) => {\n\t\tif ( ! clientId && scope !== 'global' ) {\n\t\t\tthrow new Error(\n\t\t\t\t__(\n\t\t\t\t\t'Select the block you wish to update and try again.',\n\t\t\t\t\t'big-sky'\n\t\t\t\t)\n\t\t\t);\n\t\t} else if ( clientId && scope !== 'global' ) {\n\t\t\t// check if the selected block is supported\n\t\t\tconst selectedBlock = getBlock( clientId );\n\n\t\t\tif (\n\t\t\t\t! [ 'jetpack/button', 'jetpack/subscriptions' ].includes(\n\t\t\t\t\tselectedBlock.name\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tconst supports = getBlockSupport( selectedBlock.name, 'color' );\n\t\t\t\tconst supportsTextColor =\n\t\t\t\t\tsupports?.text ||\n\t\t\t\t\tsupports?.__experimentalDefaultControls?.text ||\n\t\t\t\t\tsupports?.defaultControls?.text;\n\t\t\t\tconst supportsBackgroundColor =\n\t\t\t\t\tsupports?.background ||\n\t\t\t\t\tsupports?.__experimentalDefaultControls?.background ||\n\t\t\t\t\tsupports?.defaultControls?.background;\n\t\t\t\tif (\n\t\t\t\t\t( text_color || button_text_color ) &&\n\t\t\t\t\t! supportsTextColor\n\t\t\t\t) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'The selected block does not support text color. Please select a different block and try again.',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\t( background_color || button_color ) &&\n\t\t\t\t\t! supportsBackgroundColor\n\t\t\t\t) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'The selected block does not support background color. Please select a different block and try again.',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t};\n\n\tconst updateComponentColor = async ( {\n\t\tbackground_color,\n\t\ttext_color,\n\t\tbutton_color,\n\t\tbutton_text_color,\n\t\tscope,\n\t\tclientId,\n\t} ) => {\n\t\tconst updatedComponents = [];\n\t\tconst currentColor = getCurrentColor() || currentColorMeta;\n\n\t\t// get a copy of the current theme to avoid mutating the original theme\n\t\tconst currentTheme = JSON.parse(\n\t\t\tJSON.stringify(\n\t\t\t\tgetColorVariationByTitle( currentColor ) || getCurrentTheme()\n\t\t\t)\n\t\t);\n\n\t\t// if the colors don't already exist in the current palette, add them\n\t\tif ( background_color ) {\n\t\t\tbackground_color = addColorToTheme( {\n\t\t\t\ttheme: currentTheme,\n\t\t\t\tcolor: background_color,\n\t\t\t} );\n\t\t\tupdatedComponents.push( 'background color' );\n\t\t}\n\t\tif ( text_color ) {\n\t\t\ttext_color = addColorToTheme( {\n\t\t\t\ttheme: currentTheme,\n\t\t\t\tcolor: text_color,\n\t\t\t} );\n\t\t\tupdatedComponents.push( 'text color' );\n\t\t}\n\t\tif ( button_color ) {\n\t\t\tbutton_color = addColorToTheme( {\n\t\t\t\ttheme: currentTheme,\n\t\t\t\tcolor: button_color,\n\t\t\t} );\n\t\t\tupdatedComponents.push( 'button color' );\n\t\t}\n\t\tif ( button_text_color ) {\n\t\t\tbutton_text_color = addColorToTheme( {\n\t\t\t\ttheme: currentTheme,\n\t\t\t\tcolor: button_text_color,\n\t\t\t} );\n\t\t\tupdatedComponents.push( 'button text color' );\n\t\t}\n\n\t\t// make sure the variations are copied over from the current theme\n\t\tcurrentTheme.styles.variations =\n\t\t\tcurrentTheme.styles.blocks[ 'core/group' ].variations;\n\n\t\tregistry.batch( () => {\n\t\t\tswitch ( scope ) {\n\t\t\t\tcase 'global':\n\t\t\t\t\t// apply colors to all root blocks\n\t\t\t\t\tconst rootBlocks = [\n\t\t\t\t\t\t...getRootBlocksOfPostContent(),\n\t\t\t\t\t\t...getBlocks( getTemplatePartClientID( 'header' ) ),\n\t\t\t\t\t\t...getBlocks( getTemplatePartClientID( 'footer' ) ),\n\t\t\t\t\t];\n\t\t\t\t\tupdateRootBlocksStyles( {\n\t\t\t\t\t\trootBlocks,\n\t\t\t\t\t\tbackground_color,\n\t\t\t\t\t\ttext_color,\n\t\t\t\t\t\tbutton_color,\n\t\t\t\t\t\tbutton_text_color,\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'section':\n\t\t\t\t\t// apply background color and text color to the root block of the selected block\n\t\t\t\t\tconst rootBlock = getParentRootPatternBlock( clientId );\n\t\t\t\t\tif ( rootBlock ) {\n\t\t\t\t\t\tupdateRootBlocksStyles( {\n\t\t\t\t\t\t\trootBlocks: [ rootBlock ],\n\t\t\t\t\t\t\tbackground_color,\n\t\t\t\t\t\t\ttext_color,\n\t\t\t\t\t\t\tbutton_color,\n\t\t\t\t\t\t\tbutton_text_color,\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'block':\n\t\t\t\t\t// apply changes to the selected block and its children (thoeretically not much)\n\t\t\t\t\tconst selectedBlock = getBlock( clientId );\n\t\t\t\t\tif ( selectedBlock ) {\n\t\t\t\t\t\tupdateRootBlocksStyles( {\n\t\t\t\t\t\t\trootBlocks: [ selectedBlock ],\n\t\t\t\t\t\t\tbackground_color,\n\t\t\t\t\t\t\ttext_color,\n\t\t\t\t\t\t\tbutton_color,\n\t\t\t\t\t\t\tbutton_text_color,\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcurrentTheme.title = BIG_SKY_CUSTOM_THEME_PREFIX;\n\t\t\tpushGeneratedVariations( [ currentTheme ] );\n\t\t\tsetStyles( {\n\t\t\t\tcolor: currentTheme.title,\n\t\t\t\tupdateBlocks: false,\n\t\t\t} );\n\t\t} );\n\n\t\tconst closingMessages = [\n\t\t\t__( 'Let me know if you need me to do anything else!', 'big-sky' ),\n\t\t\t__( 'Do you wish to change any other colors?', 'big-sky' ),\n\t\t\t__( \"Is there anything else you'd like me to adjust?\", 'big-sky' ),\n\t\t];\n\t\tlet contextSuffix = '';\n\t\tif ( scope === 'global' ) {\n\t\t\tcontextSuffix = __( 'for your site', 'big-sky' );\n\t\t} else if ( scope === 'section' ) {\n\t\t\tcontextSuffix = __( 'in this section', 'big-sky' );\n\t\t} else if ( scope === 'block' ) {\n\t\t\tcontextSuffix = __( 'of the selected block', 'big-sky' );\n\t\t}\n\t\tconst message = sprintf(\n\t\t\t/* translators: 1: list of updated color components, 2: context (for your site/in this section) */\n\t\t\t__( \"I've updated the %1$s %2$s.\", 'big-sky' ),\n\t\t\tupdatedComponents.length > 1\n\t\t\t\t? updatedComponents.slice( 0, -1 ).join( ', ' ) +\n\t\t\t\t\t\t__( ' and ', 'big-sky' ) +\n\t\t\t\t\t\tupdatedComponents.slice( -1 )\n\t\t\t\t: updatedComponents[ 0 ],\n\t\t\tcontextSuffix\n\t\t);\n\t\t/* eslint-disable no-restricted-syntax */\n\t\tconst randomClosing =\n\t\t\tclosingMessages[\n\t\t\t\tMath.floor( Math.random() * closingMessages.length )\n\t\t\t];\n\t\t/* eslint-enable no-restricted-syntax */\n\n\t\treturn `${ message } ${ randomClosing }`;\n\t};\n\n\tconst collectBlockColorAttributes = () => {\n\t\tconst blocks = [\n\t\t\t...getRootBlocksOfPostContent(),\n\t\t\t...getBlocks( getTemplatePartClientID( 'header' ) ),\n\t\t\t...getBlocks( getTemplatePartClientID( 'footer' ) ),\n\t\t];\n\t\tconst colorAttributes = [];\n\n\t\tconst processBlock = ( block ) => {\n\t\t\tconst attributes = getBlockAttributes( block.clientId );\n\n\t\t\t// Check for direct color attributes\n\t\t\tif ( attributes?.backgroundColor ) {\n\t\t\t\tcolorAttributes.push( {\n\t\t\t\t\tclientId: block.clientId,\n\t\t\t\t\tkey: 'backgroundColor',\n\t\t\t\t\tvalue: attributes.backgroundColor,\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tif ( attributes?.textColor ) {\n\t\t\t\tcolorAttributes.push( {\n\t\t\t\t\tclientId: block.clientId,\n\t\t\t\t\tkey: 'textColor',\n\t\t\t\t\tvalue: attributes.textColor,\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t// Check for style color attributes\n\t\t\tif ( attributes?.style?.color?.text ) {\n\t\t\t\tcolorAttributes.push( {\n\t\t\t\t\tclientId: block.clientId,\n\t\t\t\t\tkey: 'styleText',\n\t\t\t\t\tvalue: attributes.style.color.text,\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tif ( attributes?.style?.color?.background ) {\n\t\t\t\tcolorAttributes.push( {\n\t\t\t\t\tclientId: block.clientId,\n\t\t\t\t\tkey: 'styleBackground',\n\t\t\t\t\tvalue: attributes.style.color.background,\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t// Recursively check inner blocks\n\t\t\tif ( block.innerBlocks?.length > 0 ) {\n\t\t\t\tblock.innerBlocks.forEach( ( innerBlock ) => {\n\t\t\t\t\tprocessBlock( innerBlock );\n\t\t\t\t} );\n\t\t\t}\n\t\t};\n\n\t\t// Process each block in the input array\n\t\tblocks.forEach( ( block ) => {\n\t\t\tprocessBlock( block );\n\t\t} );\n\n\t\treturn colorAttributes;\n\t};\n\n\tconst reapplyBlockColors = ( colorAttributes ) => {\n\t\tregistry.batch( () => {\n\t\t\tcolorAttributes.forEach( ( { clientId, key, value } ) => {\n\t\t\t\tconst attributes = getBlockAttributes( clientId );\n\t\t\t\tconst updatedAttributes = { ...attributes };\n\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'backgroundColor':\n\t\t\t\t\tcase 'textColor':\n\t\t\t\t\t\tupdatedAttributes[ key ] = value;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'styleText':\n\t\t\t\t\tcase 'styleBackground':\n\t\t\t\t\t\tif ( ! updatedAttributes.style )\n\t\t\t\t\t\t\tupdatedAttributes.style = {};\n\t\t\t\t\t\tif ( ! updatedAttributes.style.color )\n\t\t\t\t\t\t\tupdatedAttributes.style.color = {};\n\n\t\t\t\t\t\tif ( key === 'styleText' ) {\n\t\t\t\t\t\t\tupdatedAttributes.style.color.text = value;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tupdatedAttributes.style.color.background = value;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tupdateBlockAttributes( clientId, updatedAttributes );\n\t\t\t} );\n\t\t} );\n\t};\n\n\treturn {\n\t\tvalidateGenerateColorPaletteArgs,\n\t\tgenerateColorPalette,\n\t\tcancelGenerateColorPalette,\n\t\tdoneGenerateColorPalette,\n\t\tvalidateUpdateComponentColorArgs,\n\t\tupdateComponentColor,\n\t\tcollectBlockColorAttributes,\n\t\treapplyBlockColors,\n\t};\n}\n","export default function(e,f){var a={white:\"#ffffff\",bisque:\"#ffe4c4\",blue:\"#0000ff\",cadetblue:\"#5f9ea0\",chartreuse:\"#7fff00\",chocolate:\"#d2691e\",coral:\"#ff7f50\",antiquewhite:\"#faebd7\",aqua:\"#00ffff\",azure:\"#f0ffff\",whitesmoke:\"#f5f5f5\",papayawhip:\"#ffefd5\",plum:\"#dda0dd\",blanchedalmond:\"#ffebcd\",black:\"#000000\",gold:\"#ffd700\",goldenrod:\"#daa520\",gainsboro:\"#dcdcdc\",cornsilk:\"#fff8dc\",cornflowerblue:\"#6495ed\",burlywood:\"#deb887\",aquamarine:\"#7fffd4\",beige:\"#f5f5dc\",crimson:\"#dc143c\",cyan:\"#00ffff\",darkblue:\"#00008b\",darkcyan:\"#008b8b\",darkgoldenrod:\"#b8860b\",darkkhaki:\"#bdb76b\",darkgray:\"#a9a9a9\",darkgreen:\"#006400\",darkgrey:\"#a9a9a9\",peachpuff:\"#ffdab9\",darkmagenta:\"#8b008b\",darkred:\"#8b0000\",darkorchid:\"#9932cc\",darkorange:\"#ff8c00\",darkslateblue:\"#483d8b\",gray:\"#808080\",darkslategray:\"#2f4f4f\",darkslategrey:\"#2f4f4f\",deeppink:\"#ff1493\",deepskyblue:\"#00bfff\",wheat:\"#f5deb3\",firebrick:\"#b22222\",floralwhite:\"#fffaf0\",ghostwhite:\"#f8f8ff\",darkviolet:\"#9400d3\",magenta:\"#ff00ff\",green:\"#008000\",dodgerblue:\"#1e90ff\",grey:\"#808080\",honeydew:\"#f0fff0\",hotpink:\"#ff69b4\",blueviolet:\"#8a2be2\",forestgreen:\"#228b22\",lawngreen:\"#7cfc00\",indianred:\"#cd5c5c\",indigo:\"#4b0082\",fuchsia:\"#ff00ff\",brown:\"#a52a2a\",maroon:\"#800000\",mediumblue:\"#0000cd\",lightcoral:\"#f08080\",darkturquoise:\"#00ced1\",lightcyan:\"#e0ffff\",ivory:\"#fffff0\",lightyellow:\"#ffffe0\",lightsalmon:\"#ffa07a\",lightseagreen:\"#20b2aa\",linen:\"#faf0e6\",mediumaquamarine:\"#66cdaa\",lemonchiffon:\"#fffacd\",lime:\"#00ff00\",khaki:\"#f0e68c\",mediumseagreen:\"#3cb371\",limegreen:\"#32cd32\",mediumspringgreen:\"#00fa9a\",lightskyblue:\"#87cefa\",lightblue:\"#add8e6\",midnightblue:\"#191970\",lightpink:\"#ffb6c1\",mistyrose:\"#ffe4e1\",moccasin:\"#ffe4b5\",mintcream:\"#f5fffa\",lightslategray:\"#778899\",lightslategrey:\"#778899\",navajowhite:\"#ffdead\",navy:\"#000080\",mediumvioletred:\"#c71585\",powderblue:\"#b0e0e6\",palegoldenrod:\"#eee8aa\",oldlace:\"#fdf5e6\",paleturquoise:\"#afeeee\",mediumturquoise:\"#48d1cc\",mediumorchid:\"#ba55d3\",rebeccapurple:\"#663399\",lightsteelblue:\"#b0c4de\",mediumslateblue:\"#7b68ee\",thistle:\"#d8bfd8\",tan:\"#d2b48c\",orchid:\"#da70d6\",mediumpurple:\"#9370db\",purple:\"#800080\",pink:\"#ffc0cb\",skyblue:\"#87ceeb\",springgreen:\"#00ff7f\",palegreen:\"#98fb98\",red:\"#ff0000\",yellow:\"#ffff00\",slateblue:\"#6a5acd\",lavenderblush:\"#fff0f5\",peru:\"#cd853f\",palevioletred:\"#db7093\",violet:\"#ee82ee\",teal:\"#008080\",slategray:\"#708090\",slategrey:\"#708090\",aliceblue:\"#f0f8ff\",darkseagreen:\"#8fbc8f\",darkolivegreen:\"#556b2f\",greenyellow:\"#adff2f\",seagreen:\"#2e8b57\",seashell:\"#fff5ee\",tomato:\"#ff6347\",silver:\"#c0c0c0\",sienna:\"#a0522d\",lavender:\"#e6e6fa\",lightgreen:\"#90ee90\",orange:\"#ffa500\",orangered:\"#ff4500\",steelblue:\"#4682b4\",royalblue:\"#4169e1\",turquoise:\"#40e0d0\",yellowgreen:\"#9acd32\",salmon:\"#fa8072\",saddlebrown:\"#8b4513\",sandybrown:\"#f4a460\",rosybrown:\"#bc8f8f\",darksalmon:\"#e9967a\",lightgoldenrodyellow:\"#fafad2\",snow:\"#fffafa\",lightgrey:\"#d3d3d3\",lightgray:\"#d3d3d3\",dimgray:\"#696969\",dimgrey:\"#696969\",olivedrab:\"#6b8e23\",olive:\"#808000\"},r={};for(var d in a)r[a[d]]=d;var l={};e.prototype.toName=function(f){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return\"transparent\";var d,i,n=r[this.toHex()];if(n)return n;if(null==f?void 0:f.closest){var o=this.toRgb(),t=1/0,b=\"black\";if(!l.length)for(var c in a)l[c]=new e(a[c]).toRgb();for(var g in a){var u=(d=o,i=l[g],Math.pow(d.r-i.r,2)+Math.pow(d.g-i.g,2)+Math.pow(d.b-i.b,2));u<t&&(t=u,b=g)}return b}};f.string.push([function(f){var r=f.toLowerCase(),d=\"transparent\"===r?\"#0000\":a[r];return d?new e(d).toRgb():null},\"name\"])}\n","/**\n * WordPress dependencies\n */\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { useEffect } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * External dependencies\n */\nimport { useChat, useToolkits } from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport colorToolkit from './toolkit.js';\nimport useColorToolFunctions from './tools/use-tool-functions.js';\nimport useCanvas from '@hooks/use-canvas';\nimport { store as aiStore } from '@store';\nimport useVariations from '@hooks/use-variations';\nimport useChangeAssistantTool from '@ai/assistants/shared/change-assistant/use-change-assistant-tool.js';\nimport useCreateToolCallback from '../shared/use-create-tool-callback.js';\nimport useSiteMetadata from '@hooks/use-site-metadata';\n\nconst useColorToolkit = () => {\n\tconst { createToolCallback } = useCreateToolCallback();\n\tconst { getVariationKeywords } = useVariations();\n\tconst { changeAssistant } = useChangeAssistantTool();\n\tconst { agentSay } = useChat();\n\tconst { setCallbacks, setContext } = useToolkits();\n\n\tconst { getSiteMetadata } = useSiteMetadata();\n\tconst { siteTitle, siteDescription, topic } = getSiteMetadata();\n\n\tconst {\n\t\tgenerateColorPalette,\n\t\tvalidateGenerateColorPaletteArgs,\n\t\tvalidateUpdateComponentColorArgs,\n\t\tupdateComponentColor,\n\t} = useColorToolFunctions();\n\n\tconst { zoomOut } = useCanvas();\n\n\tconst { getIsHandoff, currentHandoffArea, selectedBlock } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\t\t\tconst { getIsHandoff: _getIsHandoff, getCurrentHandoffArea } =\n\t\t\t\tselect( aiStore );\n\t\t\treturn {\n\t\t\t\tselectedBlock: getSelectedBlock(),\n\t\t\t\tgetIsHandoff: _getIsHandoff,\n\t\t\t\tcurrentHandoffArea: getCurrentHandoffArea(),\n\t\t\t};\n\t\t}\n\t);\n\n\tconst {\n\t\tsetChatComponents,\n\t\tsetIsToolContainerVisible,\n\t\tsetToolComponent,\n\t\tsetShowThread,\n\t} = useDispatch( aiStore );\n\n\tuseEffect( () => {\n\t\tsetCallbacks( colorToolkit.name, {\n\t\t\tcolor_palette_generator: createToolCallback( {\n\t\t\t\tname: 'color_palette_generator',\n\t\t\t\taction: ( _args ) => {\n\t\t\t\t\tgenerateColorPalette( {\n\t\t\t\t\t\t..._args,\n\t\t\t\t\t\tcallback: ( component, message ) => {\n\t\t\t\t\t\t\tif ( getIsHandoff() ) {\n\t\t\t\t\t\t\t\tsetChatComponents( [ component ] );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tzoomOut();\n\t\t\t\t\t\t\t\tsetToolComponent( component );\n\t\t\t\t\t\t\t\tsetIsToolContainerVisible( true );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tagentSay( message );\n\t\t\t\t\t\t},\n\t\t\t\t\t} );\n\t\t\t\t},\n\t\t\t\tvalidator: ( _args ) =>\n\t\t\t\t\tvalidateGenerateColorPaletteArgs( _args ),\n\t\t\t\tfailValidatorAction: () =>\n\t\t\t\t\tagentSay(\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'Please provide a color or a category to view color options.',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t\tcloseChatWhenDone: () => ! getIsHandoff(),\n\t\t\t} ),\n\t\t\tupdate_component_color: createToolCallback( {\n\t\t\t\tname: 'update_component_color',\n\t\t\t\tvalidator: ( _args ) =>\n\t\t\t\t\tvalidateUpdateComponentColorArgs( _args ),\n\t\t\t\tfailValidatorAction: ( _, error ) => {\n\t\t\t\t\tagentSay( error.message );\n\t\t\t\t},\n\t\t\t\taction: async ( _args ) => {\n\t\t\t\t\tagentSay( await updateComponentColor( _args ) );\n\t\t\t\t},\n\t\t\t\tcloseChatWhenDone: () => false,\n\t\t\t} ),\n\t\t\tchange_assistant: createToolCallback( {\n\t\t\t\tname: 'change_assistant',\n\t\t\t\taction: ( _args ) => {\n\t\t\t\t\tsetShowThread( true );\n\t\t\t\t\tchangeAssistant( _args );\n\t\t\t\t},\n\t\t\t\tcloseChatWhenDone: () => false,\n\t\t\t} ),\n\t\t} );\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ setCallbacks ] );\n\n\tuseEffect( () => {\n\t\tconst context = {\n\t\t\tsite: {\n\t\t\t\tsiteTitle,\n\t\t\t\tsiteDescription,\n\t\t\t\ttopic,\n\t\t\t},\n\t\t\tselectedBlock: {\n\t\t\t\tclientId: selectedBlock?.clientId,\n\t\t\t\ttype: selectedBlock?.type,\n\t\t\t\tname: selectedBlock?.name,\n\t\t\t},\n\t\t\tcolors: {\n\t\t\t\tcolorVariationCategories: getVariationKeywords( 'color' ),\n\t\t\t},\n\t\t};\n\n\t\tif ( getIsHandoff() ) {\n\t\t\tcontext.currentHandoffArea = currentHandoffArea;\n\t\t}\n\n\t\tsetContext( colorToolkit.name, context );\n\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ setContext, getIsHandoff, currentHandoffArea, selectedBlock ] );\n};\n\nexport default useColorToolkit;\n","import colorAssistantPrompt from './prompt.js';\nimport colorAssistantToolkit from './toolkit.js';\nimport { ASSISTANTS } from '../constants.js';\nimport useColorToolkit from './use-color-toolkit.js';\n\nconst colorAssistant = {\n\tid: ASSISTANTS.COLOR,\n\tdescription:\n\t\t'An assistant that handles website colors and color palette creation and selection.',\n\tinstructions: ( context ) => {\n\t\treturn colorAssistantPrompt( context );\n\t},\n\ttags: [ ASSISTANTS.COLOR ],\n\ttoolkits: [ colorAssistantToolkit ],\n\ttoolkitHook: useColorToolkit,\n\tonStart: ( invoke, clearMessages = () => {}, agentMessage = null ) => {\n\t\tif ( agentMessage ) {\n\t\t\tclearMessages();\n\t\t\tinvoke.agentSay( agentMessage );\n\t\t}\n\t},\n};\n\nexport default colorAssistant;\n","import {\n\tanalysisPrompt,\n\tgetReturnToRouterPrompt,\n\tgetSelectedBlockContextPrompt,\n\tgetSiteContextPrompt,\n\thelpActionPrompt,\n\thelpAssistantPrompt,\n\tisForwardedByRouter,\n\tlanguagePrompt,\n\trouterActionPrompt,\n} from '../shared/prompts.js';\n\nexport default function colorAssistantPrompt( context ) {\n\tconst routerExamples = ! isForwardedByRouter( context )\n\t\t? `User: \"Make all my headings use the Roboto font\"\n         Analysis: This is not related to color and is not in the form of a question.\n         Action: ${ routerActionPrompt }`\n\t\t: '';\n\n\tconst prompt = `\nYou are an expert website designer, specializing in color palette creation, selection, and assisting users with website color modifications. Your primary goal is to help users customize their website colors effectively.\n\nHere is the current context, use this to inform your responses:\n\n<site_context>\n${ getSiteContextPrompt( context, [\n\t'siteTitle',\n\t'siteDescription',\n\t'topic',\n] ) }\n</site_context>\n\n<selected_block_context>\n${ getSelectedBlockContextPrompt( context, [ 'clientId', 'type' ] ) }\n</selected_block_context>\n\nHere is the language you should use for responses unless explicitly instructed otherwise:\n\n<language>\n${ languagePrompt }\n</language>\n\nInstructions:\n\n1. Analyze User Input:\n   ${ analysisPrompt }\n   a) Determine if the request is color-related or not\n   b) If color-related, list any specific colors or themes mentioned\n   c) Check if the request matches any specific routing criteria\n   d) Consider the appropriate tool to use based on the analysis\n   e) For color-related requests, note any component-specific changes (background, text, button, button text)\n   f) For non-color-related requests, identify if it's a question or another type of request\n   g) Determine if routing to other assistant is needed\n\n2. Handle Color-Related Requests:\n   - If specific colors are provided, immediately call the color_palette_generator tool.\n   - If specific keywords are provided, immediately call the color_palette_generator tool and pass the exact keywords found.\n   - If the request is vague but includes identifiable colors (e.g., \"make my site more blue\") immediately call the color_palette_generator tool.\n   - If the request includes a specific component (background, text, button, button text, etc), call the update_component_color tool.\n   - If colors can be inferred from the request (e.g., \"NY Yankees team colors\"), use those colors without asking for confirmation.\n   - For vague color requests where no colors can be identified , ask if the user has a specific color in mind.\n\n3. Handle Non-Color-Related Requests:\n   - ${ helpAssistantPrompt }\n   ${ getReturnToRouterPrompt( context ) }\n\n4. Special cases:\n   - If the request is color-related but there's no specific tool to handle it, ${ helpActionPrompt }\n\n5. Examples:\n\nUser: \"I want the buttons to be red\"\nAnalysis: This is about updating the color of the buttons\nAction: Call the update_component_color tool with the component 'button' and the color 'red'\n\nUser: \"Make my site more blue\"\nAnalysis: This is about updating the color of the site with blue as the primary color\nAction: Call the color_palette_generator tool with the color 'blue'\n\nUser: \"I love Arsenal FC, can you make my site more like the colors of Arsenal?\"\nAnalysis: This is about updating the color of the site with Arsenal FC colors\nAction: Call the color_palette_generator tool with the colors inferred from \"Arsenal FC colors\"\n\n${ routerExamples }\n\nUser: \"How do I install the WooCommerce plugin?\"\nAnalysis: This is not related to color and is in the form of a question.\nAction: ${ helpActionPrompt }\n\n6. Restrictions:\n   - Only answer requests related to color and website color changes.\n   - Adhere strictly to the routing rules specified above.\n   - Do not display your analysis process in the final output.\n\nRemember to immediately call the appropriate tool or ask a follow-up question based on your analysis, without showing the analysis itself.\n`;\n\n\treturn prompt;\n}\n","export default function addPatternTool(\n\tcategories = [],\n\tsiteLocationName = null\n) {\n\treturn {\n\t\tname: 'add_pattern',\n\t\tdescription: `Adds a pattern, also referred to as a section, to the current page. Patterns can include forms, tables, images, paragraphs, and more.\n\t\tIf the user is asking for a map, the category must be \"contact\".\n\t\tIf the site location is not specified in the user request, default to ${\n\t\t\tsiteLocationName ? `\"${ siteLocationName }\"` : '\"null\"'\n\t\t}`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tclientId: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The clientId of the selected block that the pattern will be inserted before or after. Default to null if not supplied in the context.',\n\t\t\t\t},\n\t\t\t\tdirection: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tenum: [ 'before', 'after' ],\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'Where to insert patterns relative to clientId. If user does not indicate \"before\" or \"after\", default to \"after\".',\n\t\t\t\t},\n\t\t\t\tcategories: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\tdescription: `The ordered list of component categories that the patterns will be based off.`,\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\tenum: categories,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tisAskingForMap: {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'Whether the user is asking to replace a pattern with a map.',\n\t\t\t\t},\n\t\t\t\tsiteLocation: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription: 'The site location.',\n\t\t\t\t},\n\t\t\t\tuserPrompt: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The original prompt from the user. Pass this through, do not edit it.',\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [\n\t\t\t\t'clientId',\n\t\t\t\t'categories',\n\t\t\t\t'direction',\n\t\t\t\t'isAskingForMap',\n\t\t\t\t'siteLocation',\n\t\t\t\t'userPrompt',\n\t\t\t],\n\t\t},\n\t\tstrict: true,\n\t};\n}\n","export default function generatePatternTool( siteLocationName = null ) {\n\treturn {\n\t\tname: 'generate_pattern',\n\t\tdescription: `When a user asks to add a section, pattern, or something new that isn't a full new page,\n\t\tuse this tool to generate a pattern and add it to the current page.\n\t\tWhen the user provides a list of sections (bulleted, numbered, or otherwise), treat it as a single pattern request and include all sections in one call.\n\t\tIf the site location is not specified in the user request, default to ${\n\t\t\tsiteLocationName ? `\"${ siteLocationName }\"` : '\"null\"'\n\t\t}`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tclientId: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The clientId of the selected block that the pattern will be inserted before or after. Default to null if not supplied in the context.',\n\t\t\t\t},\n\t\t\t\tdirection: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tenum: [ 'before', 'after' ],\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'Where to insert patterns relative to clientId. If user does not indicate \"before\" or \"after\", default to \"after\".',\n\t\t\t\t},\n\t\t\t\tsiteLocation: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription: 'The site location.',\n\t\t\t\t},\n\t\t\t\tuserPrompt: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The original prompt from the user. Pass this through, do not edit it. If the prompt contains multiple sections, include them all in this single prompt.',\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'clientId', 'direction', 'siteLocation', 'userPrompt' ],\n\t\t},\n\t\tstrict: true,\n\t};\n}\n","export default function replacePatternTool(\n\tcategories = [],\n\tparentPatternCategory = null,\n\tsiteLocationName = null\n) {\n\treturn {\n\t\tname: 'replace_pattern',\n\t\tdescription: `Replaces an existing pattern with an alternative one. If the user is asking for a map, the category must be \"contact\".\n\t\tIf the category is not specified in the user request, default the category to ${\n\t\t\tparentPatternCategory ? `\"${ parentPatternCategory }\"` : '\"null\"'\n\t\t}\n\t\tIf the site location is not specified in the user request, default to ${\n\t\t\tsiteLocationName ? `\"${ siteLocationName }\"` : '\"null\"'\n\t\t}`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tclientId: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription: 'The clientId of the block to replace.',\n\t\t\t\t},\n\t\t\t\tcategory: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: `The category of the pattern to use as a replacement.`,\n\t\t\t\t\tenum: categories,\n\t\t\t\t},\n\t\t\t\tisAskingForMap: {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'Whether the user is asking to replace a pattern with a map.',\n\t\t\t\t},\n\t\t\t\tsiteLocation: {\n\t\t\t\t\ttype: [ 'string', 'null' ],\n\t\t\t\t\tdescription: 'The site location.',\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [\n\t\t\t\t'clientId',\n\t\t\t\t'category',\n\t\t\t\t'isAskingForMap',\n\t\t\t\t'siteLocation',\n\t\t\t],\n\t\t},\n\t\tstrict: true,\n\t};\n}\n","import addPatternTool from './tools/add-pattern/add-pattern-tool.js';\nimport generatePatternTool from './tools/generate-pattern/generate-pattern-tool.js';\nimport removeBlockTool from './tools/remove-block/remove-block-tool.js';\nimport replacePatternTool from './tools/replace-pattern/replace-pattern-tool.js';\nimport changeAssistantTool from '@ai/assistants/shared/change-assistant/change-assistant-tool';\nimport patternCategories from '../../../data/pattern-categories.js';\nimport { ASSISTANTS } from '@ai/assistants/constants.js';\nimport { isForwardedByRouter } from '@ai/assistants/shared/prompts.js';\n\nconst availableCategories = patternCategories.map(\n\t( category ) => category.slug\n);\n\nconst patternToolkit = {\n\tname: 'pattern',\n\ttools: ( context ) => {\n\t\tconst tools = [\n\t\t\ttypeof window !== 'undefined' &&\n\t\t\twindow.localStorage.getItem( 'isGeneratingPatterns' ) === 'true'\n\t\t\t\t? generatePatternTool( context?.site?.location?.name )\n\t\t\t\t: addPatternTool(\n\t\t\t\t\t\tavailableCategories,\n\t\t\t\t\t\tcontext?.site?.location?.name\n\t\t\t\t  ),\n\t\t\tremoveBlockTool(),\n\t\t\treplacePatternTool(\n\t\t\t\tavailableCategories,\n\t\t\t\tcontext?.selectedBlock?.parentPatternCategory,\n\t\t\t\tcontext?.site?.location?.name\n\t\t\t),\n\t\t\t...( ! isForwardedByRouter( context )\n\t\t\t\t? [ changeAssistantTool( ASSISTANTS.PATTERN ) ]\n\t\t\t\t: [] ),\n\t\t];\n\n\t\treturn tools;\n\t},\n};\n\nexport default patternToolkit;\n","export default function removeBlockTool() {\n\treturn {\n\t\tname: 'remove_block',\n\t\tdescription: `Removes a block or section from the page.`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tclientId: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: 'The clientId of the block to remove.',\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'clientId' ],\n\t\t},\n\t\tstrict: true,\n\t};\n}\n","/**\n * External dependencies\n */\nimport { __, sprintf } from '@wordpress/i18n';\nimport { useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n/**\n * Internal dependencies\n */\nimport useValidation from '@hooks/use-validation';\nimport useGeocoder from '@hooks/use-geocoder';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport usePatterns from '@hooks/use-patterns';\nimport { customSectionNames } from '@ai/tasks/replace-content/section-types';\n\nexport default function usePatternToolValidation() {\n\tconst { isValidClientId, blockExists } = useValidation();\n\tconst { getCoordinates } = useGeocoder();\n\tconst { getPattern } = usePatterns();\n\tconst { setSiteMetadata } = useSiteMetadata();\n\tconst { canRemoveBlock } = useSelect( blockEditorStore );\n\n\tconst validateBlockArgs = ( args ) => {\n\t\tif ( ! args ) {\n\t\t\tthrow new Error(\n\t\t\t\t__(\n\t\t\t\t\t'I could not complete your request at this time. Please try again.',\n\t\t\t\t\t'big-sky'\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst validateClientIdArgs = ( args ) => {\n\t\tconst { clientId } = args;\n\n\t\t// check if client ID is null or invalid and that we have a valid block.\n\t\tif ( ! isValidClientId( clientId ) || ! blockExists( clientId ) ) {\n\t\t\tthrow new Error(\n\t\t\t\t__( 'Please select a block and try again.', 'big-sky' )\n\t\t\t);\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst validateAddPatternArgs = async ( args ) => {\n\t\tvalidateBlockArgs( args );\n\t\tvalidateClientIdArgs( args );\n\n\t\tconst onlyOneAllowedSections = [\n\t\t\t'header',\n\t\t\t'footer',\n\t\t\t...customSectionNames,\n\t\t];\n\t\tfor ( const category of args.categories ) {\n\t\t\tconst pattern = getPattern( category );\n\t\t\tif ( onlyOneAllowedSections.includes( category ) && pattern ) {\n\t\t\t\targs.doReplace = true; // set a flag to replace the existing section\n\t\t\t\t// update args to pass into the replace_pattern tool callback\n\t\t\t\targs.clientId = pattern.clientId;\n\t\t\t\targs.category = category;\n\t\t\t\tthrow new Error(\n\t\t\t\t\tsprintf(\n\t\t\t\t\t\t// Translators: %s is the name of a pattern category.\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'You already have a %s section on this page. Please remove the existing section before adding a new one, or select the existing section and ask to replace it.',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tcategory\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tawait validateMapRequestArgs( args );\n\n\t\treturn true;\n\t};\n\n\tconst validateGeneratePatternArgs = async ( args ) => {\n\t\tvalidateBlockArgs( args );\n\t\tvalidateClientIdArgs( args );\n\n\t\tawait validateMapRequestArgs( args );\n\n\t\treturn true;\n\t};\n\n\tconst validateMapRequestArgs = async ( args ) => {\n\t\tif (\n\t\t\t( args.categories && ! args.categories.includes( 'contact' ) ) ||\n\t\t\t( args.category && args.category !== 'contact' )\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( args.isAskingForMap && ! args.siteLocation ) {\n\t\t\tthrow new Error(\n\t\t\t\t__(\n\t\t\t\t\t'I notice there is no location set for this site. What would you like the site location to be?',\n\t\t\t\t\t'big-sky'\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\t// set site location in site metadata, pass it back in the args\n\t\tif ( args.siteLocation ) {\n\t\t\tconst newSiteLocation = {\n\t\t\t\tname: args.siteLocation,\n\t\t\t\tcoordinates: await getCoordinates( args.siteLocation ),\n\t\t\t};\n\t\t\tsetSiteMetadata(\n\t\t\t\t{\n\t\t\t\t\tsiteLocation: newSiteLocation,\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\t\t\targs.siteLocation = newSiteLocation;\n\t\t}\n\t};\n\n\tconst validateRemoveBlockArgs = ( args ) => {\n\t\ttry {\n\t\t\tvalidateBlockArgs( args );\n\t\t\tvalidateClientIdArgs( args );\n\t\t} catch ( error ) {\n\t\t\tthrow new Error(\n\t\t\t\t`I was not able to find a block to remove. ${ error?.message }`\n\t\t\t);\n\t\t}\n\n\t\tconst { clientId } = args;\n\t\tif ( ! canRemoveBlock( clientId ) ) {\n\t\t\tthrow new Error(\n\t\t\t\t__( \"I'm sorry, but I cannot remove that block.\", 'big-sky' )\n\t\t\t);\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst validateReplacePatternArgs = async ( args ) => {\n\t\tvalidateBlockArgs( args );\n\n\t\t// if the clientId is provided, we need to validate it\n\t\t// it's ok if it's not provided, we'll find the block by category\n\t\tif ( args.clientId ) {\n\t\t\tvalidateClientIdArgs( args );\n\t\t}\n\n\t\tconst replaceBlock = getPattern( args.category );\n\t\tif ( ! replaceBlock ) {\n\t\t\tthrow new Error(\n\t\t\t\tsprintf(\n\t\t\t\t\t// Translators: Placeholder represents the category of the section requested by the user.\n\t\t\t\t\t__(\n\t\t\t\t\t\t'It looks like there is no %s section on this page. Would you like to add one?',\n\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t),\n\t\t\t\t\targs.category\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tawait validateMapRequestArgs( args );\n\n\t\treturn true;\n\t};\n\n\treturn {\n\t\tvalidateBlockArgs,\n\t\tvalidateClientIdArgs,\n\t\tvalidateMapRequestArgs,\n\t\tvalidateAddPatternArgs,\n\t\tvalidateGeneratePatternArgs,\n\t\tvalidateRemoveBlockArgs,\n\t\tvalidateReplacePatternArgs,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { SVG, Path } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst chevronLeft = /*#__PURE__*/_jsx(SVG, {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 24 24\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"M14.6 7l-1.2-1L8 12l5.4 6 1.2-1-4.6-5z\"\n  })\n});\nexport default chevronLeft;\n//# sourceMappingURL=chevron-left.js.map","/**\n * WordPress dependencies\n */\nimport { SVG, Path } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst chevronRight = /*#__PURE__*/_jsx(SVG, {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 24 24\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"M10.6 6L9.4 7l4.6 5-4.6 5 1.2 1 5.4-6z\"\n  })\n});\nexport default chevronRight;\n//# sourceMappingURL=chevron-right.js.map","/**\n * WordPress dependencies\n */\nimport { Button } from '@wordpress/components';\nimport {\n\tuseCallback,\n\tuseEffect,\n\tuseLayoutEffect,\n\tuseState,\n} from '@wordpress/element';\nimport { chevronLeft, chevronRight } from '@wordpress/icons';\n\nexport default function useScrollButtons(\n\tref,\n\tscrollableSelector,\n\tpixelsToScrollBy = 260\n) {\n\tconst [ canScrollLeft, setCanScrollLeft ] = useState( false );\n\tconst [ canScrollRight, setCanScrollRight ] = useState( false );\n\n\tconst ScrollButton = ( { direction, onClick, disabled, icon } ) => (\n\t\t<Button\n\t\t\ticon={ icon }\n\t\t\tclassName={ `big-sky__dock__menu__arrow-${ direction }` }\n\t\t\tonClick={ onClick }\n\t\t\tdisabled={ disabled }\n\t\t/>\n\t);\n\n\tconst checkScrollButtons = useCallback( () => {\n\t\tconst element = ref.current;\n\t\tif ( ! element ) return;\n\n\t\tconst grid = element.querySelector( scrollableSelector );\n\t\tif ( ! grid ) return;\n\n\t\tconst { scrollLeft, scrollWidth, clientWidth } = grid;\n\n\t\t// Increase the buffer to account for potential rounding errors\n\t\tconst buffer = 10;\n\t\tsetCanScrollLeft( scrollLeft > buffer );\n\t\tsetCanScrollRight( scrollLeft < scrollWidth - clientWidth - buffer );\n\t}, [ ref, scrollableSelector ] );\n\n\tuseLayoutEffect( () => {\n\t\tconst initialCheckTimeout = setTimeout( () => {\n\t\t\tcheckScrollButtons();\n\t\t}, 200 );\n\n\t\treturn () => clearTimeout( initialCheckTimeout );\n\t}, [ checkScrollButtons ] );\n\n\tuseEffect( () => {\n\t\tconst element = ref.current;\n\t\tconst grid = element?.querySelector( scrollableSelector );\n\t\tif ( grid ) {\n\t\t\tcheckScrollButtons();\n\t\t\tgrid.addEventListener( 'scroll', checkScrollButtons );\n\t\t\treturn () => {\n\t\t\t\tgrid.removeEventListener( 'scroll', checkScrollButtons );\n\t\t\t};\n\t\t}\n\t}, [ ref, checkScrollButtons, scrollableSelector ] );\n\n\tconst scrollElement = ( amount ) => {\n\t\tconst element = ref.current;\n\t\tif ( ! element ) return;\n\n\t\tconst grid = element.querySelector( scrollableSelector );\n\t\tif ( ! grid ) return;\n\n\t\tconst newScrollLeft = grid.scrollLeft + amount;\n\t\tgrid.scrollTo( {\n\t\t\tleft: newScrollLeft,\n\t\t\tbehavior: 'smooth',\n\t\t} );\n\n\t\t// Update scroll buttons after scrolling\n\t\tsetTimeout( checkScrollButtons, 300 );\n\t};\n\n\tconst leftScrollButton = (\n\t\t<ScrollButton\n\t\t\tdirection=\"left\"\n\t\t\ticon={ chevronLeft }\n\t\t\tonClick={ () => scrollElement( -pixelsToScrollBy ) }\n\t\t\tdisabled={ ! canScrollLeft }\n\t\t/>\n\t);\n\n\tconst rightScrollButton = (\n\t\t<ScrollButton\n\t\t\tdirection=\"right\"\n\t\t\ticon={ chevronRight }\n\t\t\tonClick={ () => scrollElement( pixelsToScrollBy ) }\n\t\t\tdisabled={ ! canScrollRight }\n\t\t/>\n\t);\n\n\treturn { leftScrollButton, rightScrollButton, checkScrollButtons };\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"viewport\"];","/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\nimport useSiteMetadata from '@hooks/use-site-metadata';\n\nexport default function ThinkingMessage() {\n\tconst isOnboarded = useSiteMetadata().getSiteMetadata().isOnboarded;\n\n\tconst thinkingMessageClassnames = classnames( 'big-sky__thinking-message', {\n\t\t'big-sky__thinking-message__is-light': ! isOnboarded,\n\t} );\n\n\treturn (\n\t\t<div className={ thinkingMessageClassnames }>\n\t\t\t<div className=\"big-sky__thinking-message__three-dots\"></div>\n\t\t</div>\n\t);\n}\n","/**\n * External dependencies\n */\nimport classNames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __unstableMotion as motion } from '@wordpress/components';\nimport {\n\tstore as blockEditorStore,\n\tBlockPreview,\n} from '@wordpress/block-editor';\nimport { select, useDispatch, useSelect } from '@wordpress/data';\nimport { store as viewportStore } from '@wordpress/viewport';\nimport { memo, useCallback, useEffect, useState } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\nimport usePatterns from '@hooks/use-patterns';\nimport { animationTiming } from '@utils/constants';\nimport setDelay from '@utils/set-delay';\nimport ThinkingMessage from '../thinking-message/index.js';\nimport { store as aiStore } from '@store';\nimport { getCanvasIframeElements } from '@utils/canvas-iframe-elements';\nimport { recordTracksEvent } from '@utils/tracks';\n\nconst PatternsPreview = ( {\n\titem,\n\tindex,\n\tadditionalStyles,\n\tviewportWidthMax = 1440,\n\tclientId = null,\n\tonRendered,\n} ) => {\n\tconst MAX_SHOWN_PATTERNS = 4;\n\tconst [ isResolved, setIsResolved ] = useState( false );\n\tconst { setLastCancelableAction } = useDispatch( aiStore );\n\tconst { getSelectedBlockClientId } = useSelect( blockEditorStore );\n\tconst { selectBlock } = useDispatch( blockEditorStore );\n\n\tconst { getRootBlocksOfPostContent, insertPatterns, replaceTemplatePart } =\n\t\tusePatterns();\n\n\tconst fullLayoutItemSelect = useCallback( async () => {\n\t\t// This is a full page layout picker, so we need to update the selected item with all patterns on canvas.\n\t\tinsertPatterns( item.patterns, null, 'replace', false );\n\n\t\tconst { canvasiFrameDocument } = getCanvasIframeElements();\n\t\tconst el = canvasiFrameDocument.querySelector(\n\t\t\t`.wp-block:first-child`\n\t\t);\n\n\t\tawait setDelay( animationTiming.scrollWaitTime );\n\t\tel.scrollIntoView( {\n\t\t\tbehavior: 'instant',\n\t\t\tblock: 'start',\n\t\t} );\n\t}, [ insertPatterns, item.patterns ] );\n\n\tconst singleSectionItemSelect = useCallback( async () => {\n\t\tconst replaceClientId = clientId ?? getSelectedBlockClientId();\n\n\t\t// This is a single section picker, so we only need to update the pattern in specified block.\n\t\tif ( ! replaceClientId ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Ensure item and patterns exist and are valid\n\t\tif (\n\t\t\t! item?.patterns ||\n\t\t\t! Array.isArray( item.patterns ) ||\n\t\t\titem.patterns.length === 0\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst firstPattern = item.patterns[ 0 ];\n\t\tif (\n\t\t\t! firstPattern?.blocks ||\n\t\t\t! Array.isArray( firstPattern.blocks ) ||\n\t\t\tfirstPattern.blocks.length === 0\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Make sure the pattern doesn't already exist on the page before inserting\n\t\tconst rootBlocks = getRootBlocksOfPostContent() || [];\n\t\tconst rootBlockIds = Array.isArray( rootBlocks )\n\t\t\t? rootBlocks.map( ( block ) => block?.clientId ).filter( Boolean )\n\t\t\t: [];\n\n\t\tconst rootClientId = firstPattern.blocks[ 0 ]?.clientId;\n\t\tif ( ! rootClientId || rootBlockIds.includes( rootClientId ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tfirstPattern.category &&\n\t\t\t[ 'header', 'footer' ].includes( firstPattern.category )\n\t\t) {\n\t\t\tawait replaceTemplatePart(\n\t\t\t\tfirstPattern.category,\n\t\t\t\tfirstPattern.blocks\n\t\t\t);\n\t\t} else {\n\t\t\tinsertPatterns( item.patterns, replaceClientId, 'replace' );\n\n\t\t\t// Update the last cancelable action client ID to allow the user to undo the pattern insertion/replacement\n\t\t\tsetLastCancelableAction( {\n\t\t\t\tclientId: rootClientId,\n\t\t\t} );\n\t\t}\n\t\tselectBlock( rootClientId );\n\t}, [\n\t\tclientId,\n\t\tgetRootBlocksOfPostContent,\n\t\tgetSelectedBlockClientId,\n\t\tinsertPatterns,\n\t\titem?.patterns,\n\t\treplaceTemplatePart,\n\t\tselectBlock,\n\t\tsetLastCancelableAction,\n\t] );\n\n\tuseEffect( () => {\n\t\tasync function checkIsResolved() {\n\t\t\tif ( ! item.resolvers ) {\n\t\t\t\tsetIsResolved( true );\n\t\t\t\tonRendered();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait Promise.all(\n\t\t\t\titem.resolvers.map( async ( resolver ) => resolver.resolver )\n\t\t\t);\n\t\t\tsetIsResolved( true );\n\t\t\tonRendered();\n\t\t}\n\t\tif ( ! isResolved ) {\n\t\t\tcheckIsResolved();\n\t\t}\n\t}, [ item, isResolved, onRendered ] );\n\tif ( ! isResolved ) {\n\t\treturn (\n\t\t\t<div className=\"big-sky__item-loading big-sky__item-preview\">\n\t\t\t\t<ThinkingMessage />\n\t\t\t</div>\n\t\t);\n\t}\n\n\t// Get the first three patterns from the item, with defensive checks\n\tconst shownPatterns = Array.isArray( item?.patterns )\n\t\t? item.patterns\n\t\t\t\t.filter(\n\t\t\t\t\t( pattern ) =>\n\t\t\t\t\t\tpattern &&\n\t\t\t\t\t\tArray.isArray( pattern.blocks ) &&\n\t\t\t\t\t\tpattern.blocks.length > 0\n\t\t\t\t)\n\t\t\t\t.map( ( pattern ) => pattern.blocks[ 0 ] )\n\t\t\t\t.slice( 0, MAX_SHOWN_PATTERNS )\n\t\t: [];\n\n\tconst { isViewportMatch } = select( viewportStore );\n\tlet viewportWidth = viewportWidthMax;\n\tif ( isViewportMatch( '< small' ) ) {\n\t\tviewportWidth = 480;\n\t} else if ( isViewportMatch( '< medium' ) ) {\n\t\tviewportWidth = 600;\n\t} else if ( isViewportMatch( '< large' ) ) {\n\t\tviewportWidth = 782;\n\t} else if ( isViewportMatch( '< wide' ) ) {\n\t\tviewportWidth = 960;\n\t} else if ( isViewportMatch( '< huge' ) ) {\n\t\tviewportWidth = 1280;\n\t}\n\n\tconst onItemSelect = ( element ) => {\n\t\trecordTracksEvent( 'patterns_preview_click', {\n\t\t\ttype: item.patterns.length > 1 ? 'full-layout' : 'single-pattern',\n\t\t} );\n\t\t// remove selected class from all elements\n\t\tconst elements = document.querySelectorAll( '.big-sky__item-preview' );\n\t\telements.forEach( ( el ) => {\n\t\t\tel.classList.remove( 'selected' );\n\t\t} );\n\t\t// add selected class to the element\n\t\telement.currentTarget.classList.add( 'selected' );\n\n\t\tif ( item.patterns.length > 1 ) {\n\t\t\tfullLayoutItemSelect();\n\t\t} else {\n\t\t\tsingleSectionItemSelect();\n\t\t}\n\t};\n\n\tconst className = classNames( 'big-sky__item-preview', {\n\t\tselected: index === 0,\n\t\t[ 'big-sky__item-preview__id-' + item.id ]: true,\n\t} );\n\n\treturn (\n\t\t<motion.button\n\t\t\tinitial={ {\n\t\t\t\topacity: 0.8,\n\t\t\t} }\n\t\t\twhileHover={ {\n\t\t\t\topacity: 1,\n\t\t\t\tscale: 1.05,\n\t\t\t\tboxShadow: '0px 2px 4px rgba(0,0,0,.05)',\n\t\t\t} }\n\t\t\tclassName={ className }\n\t\t\tonClick={ onItemSelect }\n\t\t\tdata-pattern-id={ item?.patterns?.[ 0 ]?.ID || '' }\n\t\t>\n\t\t\t<BlockPreview\n\t\t\t\tblocks={ shownPatterns }\n\t\t\t\tadditionalStyles={ additionalStyles }\n\t\t\t\tviewportWidth={ viewportWidth }\n\t\t\t/>\n\t\t</motion.button>\n\t);\n};\n\nexport default memo( PatternsPreview );\n","export const Layout = () => {\n\treturn (\n\t\t<svg\n\t\t\twidth=\"16\"\n\t\t\theight=\"16\"\n\t\t\tviewBox=\"0 0 16 16\"\n\t\t\tfill=\"none\"\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t>\n\t\t\t<path\n\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\td=\"M11.9998 3.66699H3.99984C3.81574 3.66699 3.6665 3.81623 3.6665 4.00033V6.00033H12.3332V4.00033C12.3332 3.81623 12.1839 3.66699 11.9998 3.66699ZM12.3332 7.00033H6.6665L6.6665 12.3337H11.9998C12.1839 12.3337 12.3332 12.1844 12.3332 12.0003V7.00033ZM5.6665 7.00033H3.6665V12.0003C3.6665 12.1844 3.81574 12.3337 3.99984 12.3337H5.6665L5.6665 7.00033ZM3.99984 2.66699H11.9998C12.7362 2.66699 13.3332 3.26395 13.3332 4.00033V12.0003C13.3332 12.7367 12.7362 13.3337 11.9998 13.3337H3.99984C3.26346 13.3337 2.6665 12.7367 2.6665 12.0003V4.00033C2.6665 3.26395 3.26346 2.66699 3.99984 2.66699Z\"\n\t\t\t/>\n\t\t</svg>\n\t);\n};\n\nexport const Raindrop = () => {\n\treturn (\n\t\t<svg\n\t\t\twidth=\"16\"\n\t\t\theight=\"16\"\n\t\t\tviewBox=\"0 0 16 16\"\n\t\t\tfill=\"none\"\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t>\n\t\t\t<path\n\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\td=\"M7.35129 3.44638C7.73943 2.96479 8 2.66699 8 2.66699C8 2.66699 8.26057 2.96479 8.64871 3.44638C9.78128 4.85164 12 7.82181 12 9.52414C12 11.8098 10.41 13.3337 8 13.3337C5.59003 13.3337 4 11.8098 4 9.52414C4 7.82181 6.21872 4.85164 7.35129 3.44638ZM8 4.23605C7.65761 4.66607 7.23764 5.21415 6.81923 5.81188C6.33366 6.50556 5.86391 7.24666 5.51943 7.93563C5.15966 8.65517 5 9.19543 5 9.52414C5 10.4265 5.30816 11.1061 5.78656 11.5625C6.26917 12.023 7.00719 12.3337 8 12.3337C8.99281 12.3337 9.73083 12.023 10.2134 11.5625C10.6918 11.1061 11 10.4265 11 9.52414C11 9.19543 10.8403 8.65517 10.4806 7.93563C10.1361 7.24666 9.66634 6.50556 9.18077 5.81188C8.76236 5.21415 8.34239 4.66607 8 4.23605Z\"\n\t\t\t/>\n\t\t</svg>\n\t);\n};\n\nexport const Typography = () => {\n\treturn (\n\t\t<svg\n\t\t\twidth=\"16\"\n\t\t\theight=\"16\"\n\t\t\tviewBox=\"0 0 16 16\"\n\t\t\tfill=\"none\"\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t>\n\t\t\t<path\n\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\td=\"M2.28896 10.2312H5.76872L6.60227 12.5996H8.07091L4.74993 3.33789H3.30775L0 12.5996H1.45541L2.28896 10.2312ZM4.03546 5.30931L5.31886 8.94784H2.75205L4.03546 5.30931ZM9.80194 12.1936C10.0856 12.5056 10.5395 12.6617 11.1635 12.6617C11.589 12.6617 11.9862 12.5766 12.3549 12.4064C12.7331 12.2267 13.0593 11.9052 13.3336 11.4419C13.343 11.7634 13.4281 12.0471 13.5889 12.2929C13.7591 12.5387 14.1042 12.6617 14.6242 12.6617C14.9363 12.6617 15.1916 12.6144 15.3901 12.5198C15.5981 12.4253 15.8014 12.2976 16 12.1369L15.8582 11.8958C15.7636 11.9714 15.6691 12.0376 15.5745 12.0943C15.4799 12.1511 15.3759 12.1794 15.2625 12.1794C15.1112 12.1794 15.0072 12.1274 14.9504 12.0234C14.8937 11.9194 14.8653 11.7539 14.8653 11.527V7.61244C14.8653 7.14912 14.8275 6.75672 14.7519 6.43523C14.6762 6.10429 14.5202 5.83008 14.2838 5.61261C14.0853 5.41404 13.8347 5.27221 13.5321 5.18711C13.239 5.09255 12.8891 5.04528 12.4826 5.04528C12.0476 5.04528 11.6505 5.09728 11.2912 5.20129C10.9413 5.3053 10.6529 5.43295 10.426 5.58424C10.218 5.72607 10.0478 5.87736 9.9154 6.0381C9.79248 6.19884 9.73102 6.40687 9.73102 6.66216C9.73102 6.90801 9.80194 7.12548 9.94377 7.31459C10.0856 7.49424 10.3031 7.58407 10.5962 7.58407C10.8609 7.58407 11.0784 7.50843 11.2486 7.35714C11.4283 7.20585 11.5181 6.99783 11.5181 6.73308C11.5181 6.48724 11.4472 6.28394 11.3054 6.1232C11.173 5.953 11.0028 5.83954 10.7948 5.7828C10.9366 5.60315 11.1304 5.48496 11.3763 5.42822C11.6221 5.36203 11.8538 5.32894 12.0712 5.32894C12.3265 5.32894 12.544 5.37149 12.7237 5.45659C12.9128 5.54169 13.0593 5.68825 13.1634 5.89627C13.2768 6.09483 13.3336 6.36432 13.3336 6.70471V7.66917C13.3336 7.88665 13.2343 8.0663 13.0357 8.20813C12.8466 8.34997 12.6008 8.47761 12.2982 8.59108C12.0051 8.69509 11.6883 8.80856 11.3479 8.93148C11.017 9.04494 10.7002 9.18677 10.3976 9.35697C10.1045 9.51772 9.8634 9.72574 9.67429 9.98103C9.48518 10.2363 9.39062 10.5673 9.39062 10.9739C9.39062 11.4655 9.52773 11.8721 9.80194 12.1936ZM12.6669 11.7823C12.4306 11.9147 12.1894 11.9809 11.9436 11.9809C11.641 11.9809 11.3905 11.8816 11.1919 11.683C10.9933 11.4845 10.894 11.1724 10.894 10.7469C10.894 10.312 10.9933 9.97158 11.1919 9.72574C11.3905 9.47989 11.6268 9.28606 11.9011 9.14422C12.1847 8.99294 12.4589 8.85583 12.7237 8.73291C12.9979 8.60999 13.2012 8.44925 13.3336 8.25068V11.0731C13.1255 11.4041 12.9033 11.6405 12.6669 11.7823Z\"\n\t\t\t/>\n\t\t</svg>\n\t);\n};\n\nexport const TextAndImage = () => {\n\treturn (\n\t\t<svg\n\t\t\twidth=\"16\"\n\t\t\theight=\"16\"\n\t\t\tviewBox=\"0 0 16 16\"\n\t\t\tfill=\"none\"\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\tstyle={ { top: '1px' } }\n\t\t>\n\t\t\t<path\n\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\td=\"M3.40724 3.33301C2.99814 3.33301 2.6665 3.66465 2.6665 4.07375V9.25893C2.6665 9.66803 2.99814 9.99967 3.40724 9.99967H8.59243C9.00153 9.99967 9.33317 9.66803 9.33317 9.25893V4.07375C9.33317 3.66465 9.00153 3.33301 8.59243 3.33301H3.40724ZM3.6665 4.33301V7.19331L4.56238 6.54006C4.72977 6.41801 4.95508 6.41182 5.12892 6.52449L5.93718 7.04836L6.98462 6.03001C7.17868 5.84134 7.48764 5.84134 7.6817 6.03001L8.33317 6.66339V4.33301H3.6665ZM3.6665 8.99967V8.43092L4.87365 7.55071L5.72788 8.10438C5.92363 8.23126 6.18111 8.20591 6.34837 8.0433L7.33316 7.08586L8.31795 8.0433L8.33317 8.02765V8.99967H3.6665Z\"\n\t\t\t/>\n\t\t\t<path d=\"M13.3332 8.66634H10.6665V9.66634H13.3332V8.66634Z\" />\n\t\t\t<path d=\"M13.3332 11.333H2.6665V12.333H13.3332V11.333Z\" />\n\t\t</svg>\n\t);\n};\n\nexport const AI = () => {\n\treturn (\n\t\t<svg\n\t\t\twidth=\"24\"\n\t\t\theight=\"24\"\n\t\t\tviewBox=\"0 0 24 24\"\n\t\t\tfill=\"none\"\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t>\n\t\t\t<path\n\t\t\t\td=\"M18.7035 11.5821L15.8309 10.5912C14.6949 10.2009 13.7991 9.30509 13.4088 8.16908L12.4179 5.29651C12.2828 4.90116 11.7172 4.90116 11.5821 5.29651L10.5912 8.16908C10.2009 9.30509 9.30509 10.2009 8.16908 10.5912L5.29651 11.5821C4.90116 11.7172 4.90116 12.2828 5.29651 12.4179L8.16908 13.4088C9.30509 13.7991 10.2009 14.6949 10.5912 15.8309L11.5821 18.7035C11.7172 19.0988 12.2828 19.0988 12.4179 18.7035L13.4088 15.8309C13.7991 14.6949 14.6949 13.7991 15.8309 13.4088L18.7035 12.4179C19.0988 12.2828 19.0988 11.7172 18.7035 11.5821ZM15.3505 12.2127L13.9142 12.7081C13.3437 12.9033 12.8983 13.3537 12.7031 13.9192L12.2077 15.3555C12.1376 15.5557 11.8574 15.5557 11.7873 15.3555L11.2919 13.9192C11.0967 13.3487 10.6463 12.9033 10.0808 12.7081L8.6445 12.2127C8.44433 12.1426 8.44433 11.8624 8.6445 11.7923L10.0808 11.2969C10.6513 11.1017 11.0967 10.6513 11.2919 10.0858L11.7873 8.64951C11.8574 8.44933 12.1376 8.44933 12.2077 8.64951L12.7031 10.0858C12.8983 10.6563 13.3487 11.1017 13.9142 11.2969L15.3505 11.7923C15.5507 11.8624 15.5507 12.1426 15.3505 12.2127Z\"\n\t\t\t\tfill=\"currentColor\"\n\t\t\t/>\n\t\t</svg>\n\t);\n};\n\nexport const AskAI = () => {\n\treturn (\n\t\t<svg\n\t\t\twidth=\"21\"\n\t\t\theight=\"19\"\n\t\t\tviewBox=\"0 0 21 19\"\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t>\n\t\t\t<path d=\"M20.0417 11.3358L17.1759 10.3472C16.0425 9.95779 15.1488 9.06408 14.7594 7.93072L13.7708 5.06487C13.636 4.67044 13.0718 4.67044 12.937 5.06487L11.9484 7.93072C11.559 9.06408 10.6653 9.95779 9.53192 10.3472L6.66606 11.3358C6.27163 11.4706 6.27163 12.0348 6.66606 12.1696L9.53192 13.1582C10.6653 13.5476 11.559 14.4413 11.9484 15.5747L12.937 18.4405C13.0718 18.835 13.636 18.835 13.7708 18.4405L14.7594 15.5747C15.1488 14.4413 16.0425 13.5476 17.1759 13.1582L20.0417 12.1696C20.4361 12.0348 20.4361 11.4706 20.0417 11.3358ZM16.6966 11.9649L15.2636 12.4592C14.6945 12.6539 14.2501 13.1032 14.0554 13.6674L13.5611 15.1004C13.4912 15.3001 13.2116 15.3001 13.1417 15.1004L12.6474 13.6674C12.4527 13.0983 12.0033 12.6539 11.4392 12.4592L10.0062 11.9649C9.80652 11.895 9.80652 11.6154 10.0062 11.5455L11.4392 11.0512C12.0083 10.8565 12.4527 10.4071 12.6474 9.84296L13.1417 8.41003C13.2116 8.21032 13.4912 8.21032 13.5611 8.41003L14.0554 9.84296C14.2501 10.4121 14.6994 10.8565 15.2636 11.0512L16.6966 11.5455C16.8963 11.6154 16.8963 11.895 16.6966 11.9649Z\" />\n\t\t\t<path d=\"M3.26632 3.60462C3.26632 3.39034 3.09262 3.21664 2.87834 3.21664C2.66406 3.21664 2.49036 3.39034 2.49036 3.60462C2.49036 4.36555 2.32181 4.8249 2.04627 5.10044C1.77074 5.37598 1.31139 5.54452 0.550456 5.54452C0.33618 5.54452 0.162476 5.71823 0.162476 5.9325C0.162476 6.14678 0.33618 6.32048 0.550456 6.32048C1.31139 6.32048 1.77074 6.48903 2.04627 6.76457C2.32181 7.04011 2.49036 7.49945 2.49036 8.26039C2.49036 8.47466 2.66406 8.64837 2.87834 8.64837C3.09262 8.64837 3.26632 8.47466 3.26632 8.26039C3.26632 7.49945 3.43487 7.04011 3.71041 6.76457C3.98594 6.48903 4.44529 6.32048 5.20622 6.32048C5.4205 6.32048 5.5942 6.14678 5.5942 5.9325C5.5942 5.71823 5.4205 5.54452 5.20622 5.54452C4.44529 5.54452 3.98594 5.37598 3.71041 5.10044C3.43487 4.8249 3.26632 4.36555 3.26632 3.60462Z\" />\n\t\t\t<path d=\"M7.14613 0.500774C7.14613 0.286498 6.97242 0.112793 6.75815 0.112793C6.54387 0.112793 6.37017 0.286498 6.37017 0.500774C6.37017 0.992275 6.26089 1.25763 6.11199 1.40654C5.96308 1.55544 5.69773 1.66472 5.20622 1.66472C4.99195 1.66472 4.81824 1.83842 4.81824 2.0527C4.81824 2.26697 4.99195 2.44068 5.20622 2.44068C5.69773 2.44068 5.96308 2.54995 6.11199 2.69885C6.26089 2.84776 6.37017 3.11312 6.37017 3.60462C6.37017 3.81889 6.54387 3.9926 6.75815 3.9926C6.97242 3.9926 7.14613 3.81889 7.14613 3.60462C7.14613 3.11312 7.2554 2.84776 7.40431 2.69885C7.55321 2.54995 7.81857 2.44068 8.31007 2.44068C8.52435 2.44068 8.69805 2.26697 8.69805 2.0527C8.69805 1.83842 8.52435 1.66472 8.31007 1.66472C7.81857 1.66472 7.55321 1.55544 7.40431 1.40654C7.2554 1.25763 7.14613 0.992275 7.14613 0.500774Z\" />\n\t\t</svg>\n\t);\n};\n\nexport const Translate = () => {\n\treturn (\n\t\t<svg\n\t\t\twidth=\"16\"\n\t\t\theight=\"16\"\n\t\t\tviewBox=\"0 0 16 16\"\n\t\t\tfill=\"none\"\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t>\n\t\t\t<path d=\"M13.0849 11.922H10.1299V10.897H13.0849V11.922ZM11.4549 7.80199H11.7649L9.69492 13.667H8.54492L11.0399 6.66699H12.1749L14.6749 13.667H13.5199L11.4549 7.80199Z\" />\n\t\t\t<path\n\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\td=\"M6.33333 3.5H2.5V4.5H11.1667V3.5H7.33333V2H6.33333V3.5Z\"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\td=\"M7.24076 7.09729C8.25825 5.87631 9.03632 4.61515 9.34512 3.22559L10.3213 3.44252C9.96343 5.05296 9.07483 6.45846 8.00899 7.73748C7.85077 7.92734 7.68771 8.11545 7.52096 8.30192C7.57933 8.36532 7.63813 8.42849 7.69731 8.49137C9.01796 9.89457 10.4696 11.0932 11.3901 11.5535L10.9429 12.4479C9.86345 11.9082 8.31512 10.6069 6.96911 9.17673C6.92555 9.13045 6.88214 9.08397 6.83891 9.03732C6.33169 9.56714 5.80622 10.0844 5.29076 10.5917C5.0301 10.8483 4.77199 11.1024 4.5201 11.3543L3.81299 10.6472C4.07792 10.3822 4.34473 10.1196 4.61075 9.85764C5.14158 9.33501 5.66932 8.81544 6.17293 8.28707C5.79356 7.8401 5.44011 7.38672 5.13109 6.9425C4.61872 6.20597 4.20794 5.46564 4.01911 4.80475L4.98064 4.53002C5.12514 5.03579 5.46437 5.67047 5.95199 6.37144C6.21925 6.75561 6.52497 7.15107 6.85562 7.54547C6.98671 7.39724 7.11524 7.24793 7.24076 7.09729Z\"\n\t\t\t/>\n\t\t</svg>\n\t);\n};\n\nexport const Image = () => {\n\treturn (\n\t\t<svg\n\t\t\twidth=\"16\"\n\t\t\theight=\"16\"\n\t\t\tviewBox=\"0 0 16 16\"\n\t\t\tfill=\"none\"\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t>\n\t\t\t<path\n\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\td=\"M3.33333 3H12.6667C12.8508 3 13 3.14924 13 3.33333V8.90451L11.0152 6.97484C10.8211 6.78617 10.5122 6.78617 10.3181 6.97484L7.93734 9.28948L5.98622 8.02487C5.81239 7.9122 5.58707 7.91839 5.41969 8.04044L3 9.8048V3.33333C3 3.14924 3.14924 3 3.33333 3ZM3 11.0424V12.6667C3 12.8508 3.14924 13 3.33333 13H12.6667C12.8508 13 13 12.8508 13 12.6667V10.2688L12.9848 10.2844L10.6667 8.03069L8.34853 10.2844C8.18127 10.447 7.9238 10.4724 7.72804 10.3455L5.73095 9.05109L3 11.0424ZM2 3.33333C2 2.59695 2.59695 2 3.33333 2H12.6667C13.403 2 14 2.59695 14 3.33333V12.6667C14 13.403 13.403 14 12.6667 14H3.33333C2.59695 14 2 13.403 2 12.6667V3.33333Z\"\n\t\t\t/>\n\t\t</svg>\n\t);\n};\n\nexport const ArrowRight = () => {\n\treturn (\n\t\t<svg\n\t\t\twidth=\"24\"\n\t\t\theight=\"24\"\n\t\t\tviewBox=\"0 0 24 24\"\n\t\t\tfill=\"none\"\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t>\n\t\t\t<path\n\t\t\t\td=\"M16 13.9277V8.67956C16 8.27586 15.7309 8 15.3137 8H10.0656C9.66863 8 9.3995 8.29605 9.3995 8.63919C9.3995 8.98234 9.69554 9.26493 10.0454 9.26493H11.7073L14.0219 9.17746L13.0395 10.032L8.20185 14.8696C8.07401 15.0042 8 15.1724 8 15.3339C8 15.677 8.3095 16 8.65938 16C8.82759 16 8.98907 15.926 9.12363 15.7982L13.9613 10.9605L14.8225 9.9714L14.7216 12.2658V13.9479C14.7216 14.2977 15.0109 14.6005 15.3541 14.6005C15.704 14.6005 16 14.3112 16 13.9277Z\"\n\t\t\t\tfill=\"currentColor\"\n\t\t\t/>\n\t\t</svg>\n\t);\n};\n\nexport const ArrowUp = () => {\n\treturn (\n\t\t<svg\n\t\t\twidth=\"24\"\n\t\t\theight=\"24\"\n\t\t\tviewBox=\"0 0 24 24\"\n\t\t\tfill=\"none\"\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t>\n\t\t\t<path\n\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\td=\"M7.58994 10.2172L11.3816 6.42555C11.7233 6.08384 12.2773 6.08384 12.619 6.42555L16.4107 10.2172C16.7524 10.5589 16.7524 11.1129 16.4107 11.4547C16.069 11.7964 15.515 11.7964 15.1733 11.4547L12.8753 9.15671L12.8753 16.9609C12.8753 17.4442 12.4836 17.8359 12.0003 17.8359C11.5171 17.8359 11.1253 17.4442 11.1253 16.9609L11.1253 9.15671L8.82738 11.4547C8.48567 11.7964 7.93165 11.7964 7.58994 11.4547C7.24823 11.1129 7.24823 10.5589 7.58994 10.2172Z\"\n\t\t\t\tfill=\"currentColor\"\n\t\t\t/>\n\t\t</svg>\n\t);\n};\n","/**\n * WordPress dependencies\n */\nimport {\n\t__experimentalGrid as Grid,\n\t__unstableMotion as motion,\n\t__experimentalVStack as VStack,\n} from '@wordpress/components';\nimport { memo, useEffect, useMemo, useRef, useState } from '@wordpress/element';\nimport useScrollButtons from '@hooks/use-scroll-buttons';\n/**\n * Internal dependencies\n */\nimport ItemPreview from '@components/item-preview';\nimport { getCanvasIframeElements } from '@utils/canvas-iframe-elements';\nimport { AskAI } from '@components/icons';\nimport { recordTracksEvent } from '@utils/tracks';\n\nconst ItemPicker = ( {\n\titems,\n\tclientId,\n\tgenerateNewItem,\n\tinitialRenderedItems = {},\n} ) => {\n\tconst pickerRef = useRef();\n\tconst [ allItemsRendered, setAllItemsRendered ] = useState( false );\n\tconst [ renderedItems, setRenderedItems ] =\n\t\tuseState( initialRenderedItems );\n\n\tconst getAdditionalStyles = useMemo( () => {\n\t\tconst { canvasiFrameRoot } = getCanvasIframeElements();\n\t\tconst canvasiFrameStyle = window.getComputedStyle( canvasiFrameRoot );\n\n\t\tconst stylePropertiesToCopy = [\n\t\t\t'--site-logo-url',\n\t\t\t'--site-logo-object-position',\n\t\t];\n\n\t\tconst styleProperties = stylePropertiesToCopy.map(\n\t\t\t( styleProperty ) =>\n\t\t\t\t`${ styleProperty }: ${\n\t\t\t\t\tcanvasiFrameStyle.getPropertyValue( styleProperty ) || ' '\n\t\t\t\t};`\n\t\t);\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tcss: `html { ${ styleProperties.join( ' ' ) } }`,\n\t\t\t},\n\t\t];\n\t}, [] );\n\n\tconst categories = new Set(\n\t\titems.map( ( item ) => item?.patterns?.[ 0 ]?.category )\n\t);\n\tlet columns = 3;\n\tlet className = 'big-sky__layout-variations';\n\tlet viewportWidthMax = 1440;\n\tif ( categories.size === 1 ) {\n\t\tconst category = [ ...categories.values() ][ 0 ];\n\t\tswitch ( category ) {\n\t\t\tcase 'header':\n\t\t\tcase 'footer':\n\t\t\t\t// Widen the preview by switching from 3 to two columns.\n\t\t\t\tcolumns = 2;\n\t\t\t\tclassName += ' big-sky__layout-variations-wider';\n\t\t\t\t// \"Zoom in\" more by making the iframe's viewport narrower.\n\t\t\t\tviewportWidthMax = 'header' === category ? 480 : 1000;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tconst { leftScrollButton, rightScrollButton, checkScrollButtons } =\n\t\tuseScrollButtons( pickerRef, '.components-grid' );\n\n\tuseEffect( () => {\n\t\tcheckScrollButtons();\n\t}, [ items, checkScrollButtons ] );\n\n\tuseEffect( () => {\n\t\tconst allRendered = items.every( ( item ) => renderedItems[ item.id ] );\n\t\tsetAllItemsRendered( allRendered );\n\t}, [ items, renderedItems ] );\n\n\tconst handleItemRendered = ( itemId ) => {\n\t\tsetRenderedItems( ( prev ) => ( { ...prev, [ itemId ]: true } ) );\n\t};\n\n\tconst generateNewItemClickHandler = () => {\n\t\trecordTracksEvent( 'item_picker_generate_new_item_click' );\n\t\tgenerateNewItem();\n\t};\n\n\treturn (\n\t\t<div ref={ pickerRef } className=\"big-sky__item-picker\">\n\t\t\t{ leftScrollButton }\n\n\t\t\t<VStack spacing={ 3 }>\n\t\t\t\t<Grid columns={ columns } className={ className }>\n\t\t\t\t\t{ items && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{ items\n\t\t\t\t\t\t\t\t.filter(\n\t\t\t\t\t\t\t\t\t( item ) =>\n\t\t\t\t\t\t\t\t\t\t! item.isPlaceholder &&\n\t\t\t\t\t\t\t\t\t\titem.patterns?.length > 0\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.map( ( item, index ) => {\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<ItemPreview\n\t\t\t\t\t\t\t\t\t\t\tkey={ item.id }\n\t\t\t\t\t\t\t\t\t\t\tindex={ index }\n\t\t\t\t\t\t\t\t\t\t\titem={ item }\n\t\t\t\t\t\t\t\t\t\t\tadditionalStyles={\n\t\t\t\t\t\t\t\t\t\t\t\tgetAdditionalStyles\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tviewportWidthMax={\n\t\t\t\t\t\t\t\t\t\t\t\tviewportWidthMax\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\t\t\t\t\t\t\tonRendered={ () =>\n\t\t\t\t\t\t\t\t\t\t\t\thandleItemRendered( item.id )\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} ) }\n\t\t\t\t\t\t</>\n\t\t\t\t\t) }\n\t\t\t\t\t{ generateNewItem && allItemsRendered && (\n\t\t\t\t\t\t<motion.button\n\t\t\t\t\t\t\tinitial={ {\n\t\t\t\t\t\t\t\topacity: 0.8,\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\twhileHover={ {\n\t\t\t\t\t\t\t\topacity: 1,\n\t\t\t\t\t\t\t\tscale: 1.05,\n\t\t\t\t\t\t\t\tboxShadow: '0px 2px 4px rgba(0,0,0,.05)',\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\tclassName={ 'big-sky__item-preview' }\n\t\t\t\t\t\t\tonClick={ generateNewItemClickHandler }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<AskAI />\n\t\t\t\t\t\t</motion.button>\n\t\t\t\t\t) }\n\t\t\t\t</Grid>\n\t\t\t</VStack>\n\t\t\t{ rightScrollButton }\n\t\t</div>\n\t);\n};\n\nexport default memo( ItemPicker );\n","/**\n * External dependencies\n */\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useSelect } from '@wordpress/data';\nimport { useRef } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\nimport { store as aiStore } from '@store';\nimport ItemPicker from '@components/item-picker';\nimport useScrollButtons from '@hooks/use-scroll-buttons';\n\nexport default function PatternPickerMenu( { patterns } ) {\n\tconst pickerRef = useRef();\n\n\tconst { leftScrollButton, rightScrollButton } = useScrollButtons(\n\t\tpickerRef,\n\t\t'.components-grid'\n\t);\n\n\tconst { lastCancelableAction } = useSelect( ( select ) => {\n\t\tconst ai = select( aiStore );\n\t\tconst blockEditor = select( blockEditorStore );\n\n\t\treturn {\n\t\t\tlastCancelableAction: ai.getLastCancelableAction(),\n\t\t\tselectedBlock: blockEditor.getSelectedBlock(),\n\t\t};\n\t}, [] );\n\n\tif (\n\t\t! [ 'add_pattern', 'replace_pattern' ].includes(\n\t\t\tlastCancelableAction?.action\n\t\t)\n\t) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div className=\"big-sky__dock__menu__pattern-picker\" ref={ pickerRef }>\n\t\t\t{ leftScrollButton }\n\n\t\t\t<ItemPicker\n\t\t\t\titems={ patterns }\n\t\t\t\tclientId={ lastCancelableAction.clientId }\n\t\t\t/>\n\n\t\t\t{ rightScrollButton }\n\t\t</div>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { __, sprintf } from '@wordpress/i18n';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useDispatch, useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport usePatterns from '@hooks/use-patterns';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport useBlocks from '@hooks/use-blocks';\nimport useCanvas from '@hooks/use-canvas';\nimport { store as aiStore } from '@store';\nimport { animationTiming, dockViews } from '@utils/constants';\nimport PatternPickerMenu from '@components/dock/menus/pattern-picker';\nimport usePatternToolValidation from '@ai/assistants/pattern/use-pattern-tool-validation.js';\nimport setDelay from '@utils/set-delay';\n\nexport default function useAddPatternTool() {\n\tconst { insertPatterns, composePatterns } = usePatterns();\n\tconst { getSiteMetadata } = useSiteMetadata();\n\tconst { zoomIn, zoomOut, createDummySection } = useCanvas();\n\tconst { insertBlock } = useDispatch( blockEditorStore );\n\tconst { validateAddPatternArgs } = usePatternToolValidation();\n\n\tconst {\n\t\tgetContentBlockClientID,\n\t\tscrollToBlock,\n\t\tgetParentRootPatternBlock,\n\t} = useBlocks();\n\n\tconst {\n\t\tsetIsToolContainerVisible,\n\t\tsetToolComponent,\n\t\tsetLastCancelableAction,\n\t\tsetDockView,\n\t} = useDispatch( aiStore );\n\n\tconst {\n\t\tgetBlock,\n\t\tgetBlockIndex,\n\t\tgetBlockParentsByBlockName,\n\t\tgetBlocksByName,\n\t\tgetBlocks,\n\t\tgetSelectedBlock,\n\t} = useSelect( ( select ) => ( {\n\t\tgetBlock: select( blockEditorStore ).getBlock,\n\t\tgetBlockIndex: select( blockEditorStore ).getBlockIndex,\n\t\tgetBlockParentsByBlockName:\n\t\t\tselect( blockEditorStore ).getBlockParentsByBlockName,\n\t\tgetBlocksByName: select( blockEditorStore ).getBlocksByName,\n\t\tgetBlocks: select( blockEditorStore ).getBlocks,\n\t\tgetSelectedBlock: select( blockEditorStore ).getSelectedBlock,\n\t} ) );\n\n\tconst addPattern = async ( {\n\t\tclientId,\n\t\tcategories,\n\t\tdirection,\n\t\tsiteLocation: newSiteLocation,\n\t\tisAskingForMap,\n\t} ) => {\n\t\ttry {\n\t\t\tawait validateAddPatternArgs( {\n\t\t\t\tclientId,\n\t\t\t\tcategories,\n\t\t\t\tdirection,\n\t\t\t\tsiteLocation: newSiteLocation,\n\t\t\t\tisAskingForMap,\n\t\t\t} );\n\n\t\t\tconst { topic, siteDescription, siteLocation } = getSiteMetadata();\n\t\t\tconst zoomedOut = zoomOut();\n\n\t\t\tconst insertionId = getBlocksByName( 'core/post-content' );\n\t\t\tconst insertionBlockId = insertionId[ 0 ];\n\t\t\t// get the parent template-part/post-content block of the last selected block\n\t\t\tconst parentBlock = getBlock(\n\t\t\t\tgetBlockParentsByBlockName( clientId, [\n\t\t\t\t\t'core/template-part',\n\t\t\t\t\t'core/post-content',\n\t\t\t\t] )[ 0 ]\n\t\t\t);\n\n\t\t\t// if the parent block is a template-part, determine if it's a header or footer\n\t\t\t// and set the insertion block id accordingly\n\t\t\tlet blockIndex;\n\t\t\tif ( parentBlock?.name === 'core/template-part' ) {\n\t\t\t\tif ( parentBlock.attributes.slug === 'header' ) {\n\t\t\t\t\tblockIndex = 0;\n\t\t\t\t} else if ( parentBlock.attributes.slug === 'footer' ) {\n\t\t\t\t\tblockIndex = getBlocks( getContentBlockClientID() ).length;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// get the root pattern block of the selected block\n\t\t\t\tconst offset = direction === 'before' ? 0 : 1;\n\t\t\t\tconst rootPatternBlock = getParentRootPatternBlock( clientId );\n\t\t\t\tif ( ! rootPatternBlock ) {\n\t\t\t\t\tblockIndex = getBlockIndex( clientId ) + offset;\n\t\t\t\t} else {\n\t\t\t\t\tblockIndex =\n\t\t\t\t\t\tgetBlockIndex( rootPatternBlock.clientId ) + offset;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Insert a dummy loading section while the patterns are resolving\n\t\t\tconst dummySection = createDummySection();\n\t\t\tinsertBlock( dummySection, blockIndex, insertionBlockId );\n\n\t\t\tlet scrolled = false;\n\n\t\t\tzoomedOut.then( () => {\n\t\t\t\tif ( scrolled ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tscrolled = true;\n\t\t\t\t// Select the in-progress new (dummy) section.\n\t\t\t\tscrollToBlock( dummySection.clientId, 'center' );\n\t\t\t} );\n\n\t\t\t// compose one pattern first so we can generate some content, in case it doesn't exist in the cache\n\t\t\tconst initialPatternOptions = composePatterns( {\n\t\t\t\tcategories: [ { slug: categories[ 0 ] } ],\n\t\t\t\ttopic,\n\t\t\t\tsiteLocation: newSiteLocation || siteLocation,\n\t\t\t\tsiteDescription,\n\t\t\t\tnumberOfConcepts: 1,\n\t\t\t\tisAskingForMap,\n\t\t\t} );\n\n\t\t\tif ( ! initialPatternOptions ) {\n\t\t\t\tzoomIn();\n\t\t\t\treturn __(\n\t\t\t\t\t\"I'm having trouble finding options for that. Please try a different request.\",\n\t\t\t\t\t'big-sky'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Resolve all promises while showing a loading indicator on the canvas for the pattern.\n\t\t\tconst initialResolvers = initialPatternOptions.flatMap(\n\t\t\t\t( concept ) =>\n\t\t\t\t\tconcept.resolvers.map( ( resolver ) => resolver.resolver )\n\t\t\t);\n\t\t\tawait Promise.all( initialResolvers );\n\n\t\t\t// create the other pattern options\n\t\t\tconst morePatternOptions =\n\t\t\t\twindow.localStorage.getItem( 'isGeneratingPatterns' ) !== 'true'\n\t\t\t\t\t? composePatterns( {\n\t\t\t\t\t\t\tcategories: [ { slug: categories[ 0 ] } ],\n\t\t\t\t\t\t\ttopic,\n\t\t\t\t\t\t\tsiteLocation: newSiteLocation || siteLocation,\n\t\t\t\t\t\t\tsiteDescription,\n\t\t\t\t\t\t\tselectedConcept: initialPatternOptions[ 0 ],\n\t\t\t\t\t\t\tisAskingForMap,\n\t\t\t\t\t  } )\n\t\t\t\t\t: [];\n\n\t\t\t// Resolve all promises while showing a loading indicator on the canvas for the pattern.\n\t\t\tconst moreResolvers = initialPatternOptions.flatMap( ( concept ) =>\n\t\t\t\tconcept.resolvers.map( ( resolver ) => resolver.resolver )\n\t\t\t);\n\t\t\tawait Promise.all( moreResolvers );\n\n\t\t\t// Often this all happens too quickly, so make sure we have a few seconds of loading before inserting\n\t\t\t// to allow the user time to adjust to what is happening on the screen.\n\t\t\tawait setDelay( animationTiming.visualAdjustmentWaitTime );\n\n\t\t\t// Insert the first pattern in the list when all patterns and content have been resolved.\n\t\t\tinsertPatterns(\n\t\t\t\tinitialPatternOptions[ 0 ].patterns,\n\t\t\t\tdummySection.clientId,\n\t\t\t\t'replace'\n\t\t\t);\n\n\t\t\t// Select the newly inserted pattern\n\t\t\tif ( ! scrolled ) {\n\t\t\t\tscrolled = true;\n\t\t\t\tscrollToBlock(\n\t\t\t\t\tinitialPatternOptions[ 0 ].patterns[ 0 ].blocks[ 0 ]\n\t\t\t\t\t\t.clientId,\n\t\t\t\t\t'center',\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst generatingPatterns =\n\t\t\t\twindow.localStorage.getItem( 'isGeneratingPatterns' ) ===\n\t\t\t\t'true';\n\t\t\t// combine the initial and more pattern options\n\t\t\tconst patternOptions = ! generatingPatterns\n\t\t\t\t? [ ...initialPatternOptions, ...morePatternOptions ]\n\t\t\t\t: [];\n\n\t\t\t// Display the dock pattern picker menu to allow selection of other patterns\n\t\t\tif ( ! generatingPatterns ) {\n\t\t\t\tsetToolComponent(\n\t\t\t\t\t<PatternPickerMenu\n\t\t\t\t\t\tpatterns={ patternOptions }\n\t\t\t\t\t\tkey=\"pattern-picker\"\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t\tsetIsToolContainerVisible( true );\n\t\t\t}\n\n\t\t\t// Set the last cancelable action to allow the user to undo the pattern insertion\n\t\t\tsetLastCancelableAction( {\n\t\t\t\taction: 'add_pattern',\n\t\t\t\tclientId:\n\t\t\t\t\tinitialPatternOptions[ 0 ].patterns[ 0 ].blocks[ 0 ]\n\t\t\t\t\t\t.clientId,\n\t\t\t} );\n\n\t\t\treturn sprintf(\n\t\t\t\t// Translators: Placeholder represents the category of the section requested by the user.\n\t\t\t\t__( 'I have added a new %s section to the page.', 'big-sky' ),\n\t\t\t\tcategories[ 0 ]\n\t\t\t);\n\t\t} catch ( error ) {\n\t\t\tthrow error;\n\t\t}\n\t};\n\n\tconst doneAddPattern = () => {\n\t\tsetDockView( dockViews.MENUS );\n\t\tsetIsToolContainerVisible( false );\n\t\tzoomIn().then( () => {\n\t\t\tscrollToBlock( getSelectedBlock()?.clientId, 'start', true );\n\t\t} );\n\t};\n\n\treturn {\n\t\taddPattern,\n\t\tdoneAddPattern,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { __, sprintf } from '@wordpress/i18n';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useDispatch, useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport usePatterns from '@hooks/use-patterns';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport useBlocks from '@hooks/use-blocks';\nimport useCanvas from '@hooks/use-canvas';\nimport { animationTiming, dockViews } from '@utils/constants';\nimport setDelay from '@utils/set-delay';\nimport PatternPickerMenu from '@components/dock/menus/pattern-picker';\nimport usePatternToolValidation from '@ai/assistants/pattern/use-pattern-tool-validation.js';\nimport { store as aiStore } from '@store';\n\nexport default function useReplacePatternTool() {\n\tconst { getSiteMetadata } = useSiteMetadata();\n\tconst { zoomIn, zoomOut } = useCanvas();\n\n\tconst {\n\t\tgetPattern,\n\t\tcomposePatterns,\n\t\tgetPatternCategory,\n\t\tcreateConceptFromCurrentCanvas,\n\t\tcreateConceptFromSelectedBlock,\n\t\tsetCTAInSection,\n\t} = usePatterns();\n\n\tconst {\n\t\tgetFirstChildBlockByClientIdDOMElement,\n\t\tgetParentRootTemplatePartBlock,\n\t\tisTemplatePart,\n\t\tsetBlockIsProcessing,\n\t\tscrollToBlock,\n\t\tgetParentRootPatternBlock,\n\t} = useBlocks();\n\n\tconst {\n\t\tsetIsToolContainerVisible,\n\t\tsetToolComponent,\n\t\tsetLastCancelableAction,\n\t\tsetDockView,\n\t} = useDispatch( aiStore );\n\n\tconst { __unstableGetEditorMode, getSelectedBlock } = useSelect(\n\t\t( select ) => ( {\n\t\t\t__unstableGetEditorMode:\n\t\t\t\tselect( blockEditorStore ).__unstableGetEditorMode,\n\t\t\tgetSelectedBlock: select( blockEditorStore ).getSelectedBlock,\n\t\t} )\n\t);\n\n\tconst { validateReplacePatternArgs } = usePatternToolValidation();\n\n\tconst replacePattern = async ( {\n\t\tclientId,\n\t\tcategory,\n\t\tsiteLocation: newSiteLocation,\n\t\tisAskingForMap,\n\t} ) => {\n\t\ttry {\n\t\t\tawait validateReplacePatternArgs( {\n\t\t\t\tclientId,\n\t\t\t\tcategory,\n\t\t\t\tsiteLocation: newSiteLocation,\n\t\t\t\tisAskingForMap,\n\t\t\t} );\n\n\t\t\tconst { topic, siteLocation, siteDescription } = getSiteMetadata();\n\t\t\tif ( __unstableGetEditorMode() !== 'zoom-out' ) {\n\t\t\t\tzoomOut();\n\t\t\t}\n\n\t\t\tlet replaceBlock, patternCategory;\n\n\t\t\tif ( clientId && clientId !== 'undefined' ) {\n\t\t\t\tconst rootPatternBlock =\n\t\t\t\t\tgetParentRootTemplatePartBlock( clientId );\n\t\t\t\tif ( ! rootPatternBlock ) {\n\t\t\t\t\treplaceBlock = getParentRootPatternBlock( clientId );\n\t\t\t\t} else {\n\t\t\t\t\t// if this is a template part, get the first child block\n\t\t\t\t\t// need to use the DOM here because templates aren't editable in zoom out mode\n\t\t\t\t\treplaceBlock = getFirstChildBlockByClientIdDOMElement(\n\t\t\t\t\t\trootPatternBlock.clientId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tpatternCategory = getPatternCategory( replaceBlock.clientId );\n\t\t\t}\n\n\t\t\t// if the selected block doesn't match the category, try to find the matching pattern on the page\n\t\t\tif ( patternCategory !== category ) {\n\t\t\t\treplaceBlock = getPattern( category );\n\t\t\t\tif ( [ 'header', 'footer' ].includes( category ) ) {\n\t\t\t\t\treplaceBlock = getFirstChildBlockByClientIdDOMElement(\n\t\t\t\t\t\treplaceBlock.clientId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsetBlockIsProcessing( replaceBlock, true );\n\t\t\tscrollToBlock( replaceBlock.clientId, 'center' );\n\n\t\t\tconst selectedConceptCanvas = createConceptFromCurrentCanvas();\n\n\t\t\tconst patternOptions = composePatterns( {\n\t\t\t\tcategories: [ { slug: category } ],\n\t\t\t\ttopic,\n\t\t\t\tsiteLocation: newSiteLocation || siteLocation,\n\t\t\t\tsiteDescription,\n\t\t\t\tselectedConcept: selectedConceptCanvas,\n\t\t\t\tisAskingForMap,\n\t\t\t} );\n\n\t\t\tif ( ! patternOptions ) {\n\t\t\t\tsetBlockIsProcessing( replaceBlock, false );\n\t\t\t\tzoomIn();\n\t\t\t\treturn __(\n\t\t\t\t\t\"I'm having trouble finding options for that. Please try a different request.\",\n\t\t\t\t\t'big-sky'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Resolve all promises while showing a loading indicator on the canvas for the pattern.\n\t\t\tconst resolvers = patternOptions.flatMap( ( concept ) =>\n\t\t\t\tconcept.resolvers.map( ( resolver ) => resolver.resolver )\n\t\t\t);\n\t\t\tawait Promise.all( resolvers );\n\n\t\t\t// add the current section to the pattern options as the first option\n\t\t\tconst currentSection = createConceptFromSelectedBlock(\n\t\t\t\treplaceBlock.clientId\n\t\t\t);\n\t\t\tpatternOptions.unshift( currentSection );\n\n\t\t\t// Often this all happens too quickly, so make sure we have a few seconds of loading before inserting\n\t\t\t// to allow the user time to adjust to what is happening on the screen.\n\t\t\tawait setDelay( animationTiming.visualAdjustmentWaitTime );\n\n\t\t\tsetBlockIsProcessing( replaceBlock, false );\n\n\t\t\tif ( category === 'header' ) {\n\t\t\t\tpatternOptions\n\t\t\t\t\t.flatMap( ( concept ) => concept.patterns )\n\t\t\t\t\t.forEach( ( pattern ) =>\n\t\t\t\t\t\tsetCTAInSection( {\n\t\t\t\t\t\t\tcategory: pattern.category,\n\t\t\t\t\t\t\tblocks: pattern.blocks,\n\t\t\t\t\t\t} )\n\t\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Display the dock pattern picker menu to allow selection of other patterns\n\t\t\tsetToolComponent(\n\t\t\t\t<PatternPickerMenu\n\t\t\t\t\tpatterns={ patternOptions }\n\t\t\t\t\tkey=\"pattern-picker\"\n\t\t\t\t/>\n\t\t\t);\n\t\t\tsetIsToolContainerVisible( true );\n\n\t\t\t// Set the last cancelable action to allow the user to undo the pattern insertion\n\t\t\tsetLastCancelableAction( {\n\t\t\t\taction: 'replace_pattern',\n\t\t\t\tclientId:\n\t\t\t\t\tpatternOptions[ 0 ].patterns[ 0 ].blocks[ 0 ].clientId,\n\t\t\t\toriginalBlock: replaceBlock,\n\t\t\t\tisTemplatePart: isTemplatePart( replaceBlock.clientId ),\n\t\t\t} );\n\n\t\t\treturn sprintf(\n\t\t\t\t// Translators: Placeholder represents the category of the section requested by the user.\n\t\t\t\t__(\n\t\t\t\t\t'I have replaced the section with a new %s section.',\n\t\t\t\t\t'big-sky'\n\t\t\t\t),\n\t\t\t\tcategory\n\t\t\t);\n\t\t} catch ( error ) {\n\t\t\tthrow error;\n\t\t}\n\t};\n\n\tconst doneReplacePattern = () => {\n\t\tsetDockView( dockViews.MENUS );\n\t\tsetIsToolContainerVisible( false );\n\t\tzoomIn().then( () => {\n\t\t\tscrollToBlock( getSelectedBlock()?.clientId, 'start', true );\n\t\t} );\n\t};\n\n\treturn {\n\t\treplacePattern,\n\t\tdoneReplacePattern,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport apiFetch from '@wordpress/api-fetch';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport useUserPrompt from '@ai/assistants/pattern/tools/generate-pattern/prompts/use-user-prompt';\nimport log from '@utils/log-debug.js';\nimport useStreamParser from '@ai/assistants/pattern/tools/generate-pattern/hooks/use-stream-parser';\nimport useCanvas from '@hooks/use-canvas';\nimport useBlocks from '@hooks/use-blocks';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport { store as aiStore } from '@store/index.js';\nimport useCreateToolCallback from '@ai/assistants/shared/use-create-tool-callback';\n\n/**\n * Hook that provides pattern generation functionality.\n *\n * Handles the full lifecycle of pattern generation including:\n * - Setting up a temporary canvas area\n * - Making the API request to generate the pattern\n * - Parsing the streaming response\n * - Inserting the generated pattern into the page\n * - Cleaning up temporary elements\n *\n * @return {Object} Pattern generation functions object containing:\n *                  - generatePattern: Function to generate a new pattern based on user prompt.\n */\nexport default function useGeneratePatternTool() {\n\tconst { getUserPrompt } = useUserPrompt();\n\tconst { extractPhase, parseSSEChunk } = useStreamParser();\n\tconst { zoomOut, createDummySection } = useCanvas();\n\tconst { insertBlock, replaceBlock, clearSelectedBlock } =\n\t\tuseDispatch( blockEditorStore );\n\tconst { setCurrentToolCall, setLastCancelableAction } =\n\t\tuseDispatch( aiStore );\n\n\tconst { withPendingToolCallback } = useCreateToolCallback();\n\tconst { getSiteMetadata, setSiteMetadata } = useSiteMetadata();\n\tconst { logAnthropicUsage } = useDispatch( aiStore );\n\n\tconst {\n\t\tgetContentBlockClientID,\n\t\tscrollToBlock,\n\t\tgetParentRootPatternBlock,\n\t} = useBlocks();\n\n\tconst {\n\t\tsetGeneratedPatternAsString,\n\t\tsetGeneratedPatternAsBlocks,\n\t\tsetGeneratedPatternChunksAsJSON,\n\t\tsetGeneratedPatternDummySectionClientId,\n\t\tsetGeneratedRootPatternClientId,\n\t} = useDispatch( aiStore );\n\n\tconst {\n\t\tgetBlock,\n\t\tgetBlockIndex,\n\t\tgetBlockParentsByBlockName,\n\t\tgetBlocksByName,\n\t\tgetBlocks,\n\t} = useSelect( ( select ) => ( {\n\t\tgetBlock: select( blockEditorStore ).getBlock,\n\t\tgetBlockIndex: select( blockEditorStore ).getBlockIndex,\n\t\tgetBlockParentsByBlockName:\n\t\t\tselect( blockEditorStore ).getBlockParentsByBlockName,\n\t\tgetBlocksByName: select( blockEditorStore ).getBlocksByName,\n\t\tgetBlocks: select( blockEditorStore ).getBlocks,\n\t} ) );\n\n\t/**\n\t * Generates a new pattern based on user input.\n\t *\n\t * @param {Object} options            Pattern generation options.\n\t * @param {string} options.userPrompt The user's prompt for pattern generation.\n\t * @param {string} options.clientId   The client ID of the block to insert the pattern near.\n\t * @param {string} options.direction  The direction to insert the pattern ('before' or 'after').\n\t * @return {Promise<string>} The generated pattern stream buffer.\n\t */\n\tconst generatePattern = async ( { userPrompt, clientId, direction } ) => {\n\t\tconst dummySectionClientId = prepareCanvas( clientId, direction );\n\n\t\t// Set the current tool call\n\t\tsetCurrentToolCall( 'generate_pattern' );\n\n\t\t// Store the user prompt for pattern registration\n\t\tconst storedUserPrompt = userPrompt;\n\n\t\t// Deselect the current block for better visual generation without outlines\n\t\tclearSelectedBlock();\n\n\t\t// Create the pattern generation function\n\t\tconst generatePatternAction = async () => {\n\t\t\ttry {\n\t\t\t\tconst _userPrompt = await getUserPrompt( storedUserPrompt );\n\t\t\t\tconst response = await makePatternRequest( _userPrompt );\n\t\t\t\tconst streamBuffer = await processPatternStream(\n\t\t\t\t\tresponse.body.getReader()\n\t\t\t\t);\n\t\t\t\tcleanupCanvas( dummySectionClientId, storedUserPrompt );\n\t\t\t\treturn streamBuffer;\n\t\t\t} catch ( error ) {\n\t\t\t\tlog.error( 'Error generating pattern:', error );\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t};\n\n\t\t// Wrap the action with the pending callback handler\n\t\tconst result = await withPendingToolCallback( generatePatternAction )();\n\t\treturn result;\n\t};\n\n\t/**\n\t * Makes the API request to generate a pattern using the Anthropic API.\n\t *\n\t * @param {string} userPrompt The prompt to send to the API.\n\t * @return {Promise<Response>} The API response.\n\t */\n\tconst makePatternRequest = async ( userPrompt ) => {\n\t\tconst response = await fetch(\n\t\t\t'/wp-json/wpcom/v2/big-sky/v1/anthropic/messages',\n\t\t\t{\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t'X-WP-Nonce': apiFetch.nonceMiddleware.nonce,\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify( {\n\t\t\t\t\tmodel: 'claude-3-5-sonnet-20241022',\n\t\t\t\t\tmax_tokens: 8000,\n\t\t\t\t\ttemperature: 0.2,\n\t\t\t\t\tmessages: [ { role: 'user', content: userPrompt } ],\n\t\t\t\t\tstream: true,\n\t\t\t\t} ),\n\t\t\t}\n\t\t);\n\n\t\tif ( ! response.ok ) {\n\t\t\tthrow new Error( `HTTP error! status: ${ response.status }` );\n\t\t}\n\n\t\treturn response;\n\t};\n\n\t/**\n\t * Process phases from the stream buffer.\n\t *\n\t * @param {string} streamBuffer    The current stream buffer.\n\t * @param {Set}    completedPhases Set of completed phases.\n\t * @return {string} The updated stream buffer.\n\t */\n\tconst processPhases = ( streamBuffer, completedPhases ) => {\n\t\tlet currentPhase = 1;\n\t\twhile ( true ) {\n\t\t\tif ( completedPhases.has( currentPhase ) ) {\n\t\t\t\tcurrentPhase++;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst phase = extractPhase( streamBuffer, currentPhase );\n\t\t\tif ( phase === null ) break;\n\n\t\t\tcompletedPhases.add( currentPhase );\n\t\t\tcurrentPhase++;\n\t\t}\n\t\treturn streamBuffer;\n\t};\n\n\t/**\n\t * Processes a stream of SSE events, extracting and managing phases.\n\t *\n\t * @param {ReadableStreamDefaultReader} reader The stream reader.\n\t * @return {Promise<string>} The complete stream buffer.\n\t */\n\tconst processPatternStream = async ( reader ) => {\n\t\tconst decoder = new TextDecoder();\n\t\tlet streamBuffer = '';\n\t\tconst completedPhases = new Set();\n\t\tlet pendingChunk = '';\n\t\tlet totalInputTokens = 0;\n\t\tlet totalOutputTokens = 0;\n\n\t\ttry {\n\t\t\twhile ( true ) {\n\t\t\t\tconst { done, value } = await reader.read();\n\t\t\t\tif ( done ) break;\n\n\t\t\t\tconst chunk = decoder.decode( value, { stream: true } );\n\t\t\t\tpendingChunk += chunk;\n\n\t\t\t\tconst events = pendingChunk.split( '\\n\\n' );\n\t\t\t\tpendingChunk = events.pop() || '';\n\n\t\t\t\tfor ( const event of events ) {\n\t\t\t\t\tif ( event.trim() ) {\n\t\t\t\t\t\tconst text = parseSSEChunk( event );\n\t\t\t\t\t\tif ( text ) {\n\t\t\t\t\t\t\tstreamBuffer += text;\n\t\t\t\t\t\t\tstreamBuffer = processPhases(\n\t\t\t\t\t\t\t\tstreamBuffer,\n\t\t\t\t\t\t\t\tcompletedPhases\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Extract token counts from specific events\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst [ , eventData ] = event\n\t\t\t\t\t\t\t\t.split( '\\n' )\n\t\t\t\t\t\t\t\t.map( ( line ) =>\n\t\t\t\t\t\t\t\t\tline.replace( /^[^:]+: /, '' )\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif ( eventData ) {\n\t\t\t\t\t\t\t\tconst data = JSON.parse( eventData );\n\n\t\t\t\t\t\t\t\t// Get input tokens from message_start event\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tdata.type === 'message_start' &&\n\t\t\t\t\t\t\t\t\tdata.message?.usage?.input_tokens\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\ttotalInputTokens =\n\t\t\t\t\t\t\t\t\t\tdata.message.usage.input_tokens;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Get output tokens from final message_delta event\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tdata.type === 'message_delta' &&\n\t\t\t\t\t\t\t\t\tdata.delta?.stop_reason === 'end_turn'\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\ttotalOutputTokens =\n\t\t\t\t\t\t\t\t\t\tdata.usage?.output_tokens || 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch ( e ) {\n\t\t\t\t\t\t\t// Ignore parsing errors for non-usage events\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Log the token usage after stream completion\n\t\t\tif ( totalInputTokens > 0 || totalOutputTokens > 0 ) {\n\t\t\t\tlogAnthropicUsage( 'claude-3-5-sonnet-20241022', {\n\t\t\t\t\tinput_tokens: totalInputTokens,\n\t\t\t\t\toutput_tokens: totalOutputTokens,\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\treturn streamBuffer;\n\t\t} finally {\n\t\t\treader.releaseLock();\n\t\t}\n\t};\n\n\t/**\n\t * Register a generated pattern in the site metadata.\n\t *\n\t * @param {Object} block      The block to register as a pattern.\n\t * @param {string} userPrompt The user's prompt that generated the pattern.\n\t */\n\tconst registerGeneratedPattern = ( block, userPrompt ) => {\n\t\tconst metadata = getSiteMetadata();\n\n\t\t// Create a title from the user prompt, limiting it to a reasonable length\n\t\tconst title =\n\t\t\tuserPrompt.length > 40\n\t\t\t\t? userPrompt.substring( 0, 40 ) + '...'\n\t\t\t\t: userPrompt;\n\n\t\t// Generate a unique pattern ID starting with 999\n\t\tconst timestamp = Date.now().toString().slice( -5 ); // Get last 5 digits of timestamp\n\t\tconst patternId = parseInt( '999' + timestamp, 10 );\n\n\t\t// Add metadata to the block's attributes\n\t\tblock.attributes = {\n\t\t\t...block.attributes,\n\t\t\tmetadata: {\n\t\t\t\tremotePatternId: patternId.toString(),\n\t\t\t\tpatternCategory: 'generated',\n\t\t\t},\n\t\t};\n\n\t\t// Create the pattern metadata\n\t\tconst pattern = {\n\t\t\tcategory: 'generated',\n\t\t\ttitle,\n\t\t\tcontent: block,\n\t\t};\n\n\t\t// Initialize patterns array for this pattern ID if needed\n\t\tif ( ! metadata.patterns[ patternId ] ) {\n\t\t\tmetadata.patterns[ patternId ] = [];\n\t\t}\n\n\t\t// Add the pattern to the patterns array\n\t\tmetadata.patterns[ patternId ].push( pattern );\n\n\t\t// Update the site metadata\n\t\tsetSiteMetadata( metadata );\n\t};\n\n\t/**\n\t * Resets all generated pattern state to initial values.\n\t */\n\tconst resetGeneratedPattern = () => {\n\t\tsetGeneratedPatternAsString( '' );\n\t\tsetGeneratedPatternAsBlocks( [] );\n\t\tsetGeneratedPatternChunksAsJSON( [] );\n\t\tsetGeneratedPatternDummySectionClientId( null );\n\t\tsetGeneratedRootPatternClientId( null );\n\t};\n\n\t/**\n\t * Prepares the canvas for pattern generation by inserting a dummy section.\n\t *\n\t * @param {string} clientId  The client ID of the block to insert near.\n\t * @param {string} direction The direction to insert ('before' or 'after').\n\t * @return {string} The client ID of the inserted dummy section.\n\t */\n\tconst prepareCanvas = ( clientId, direction ) => {\n\t\tconst zoomedOut = zoomOut();\n\n\t\tconst insertionId = getBlocksByName( 'core/post-content' );\n\t\tconst insertionBlockId = insertionId[ 0 ];\n\n\t\t// get the parent template-part/post-content block of the last selected block\n\t\tconst parentBlock = getBlock(\n\t\t\tgetBlockParentsByBlockName( clientId, [\n\t\t\t\t'core/template-part',\n\t\t\t\t'core/post-content',\n\t\t\t] )[ 0 ]\n\t\t);\n\n\t\t// if the parent block is a template-part, determine if it's a header or footer\n\t\t// and set the insertion block id accordingly\n\t\tlet blockIndex;\n\t\tif ( parentBlock?.name === 'core/template-part' ) {\n\t\t\tif ( parentBlock.attributes.slug === 'header' ) {\n\t\t\t\tblockIndex = 0;\n\t\t\t} else if ( parentBlock.attributes.slug === 'footer' ) {\n\t\t\t\tblockIndex = getBlocks( getContentBlockClientID() ).length;\n\t\t\t}\n\t\t} else {\n\t\t\t// get the root pattern block of the selected block\n\t\t\tconst offset = direction === 'before' ? 0 : 1;\n\t\t\tconst rootPatternBlock = getParentRootPatternBlock( clientId );\n\t\t\tif ( ! rootPatternBlock ) {\n\t\t\t\tblockIndex = getBlockIndex( clientId ) + offset;\n\t\t\t} else {\n\t\t\t\tblockIndex =\n\t\t\t\t\tgetBlockIndex( rootPatternBlock.clientId ) + offset;\n\t\t\t}\n\t\t}\n\n\t\t// Insert a dummy loading section while the patterns are resolving\n\t\tconst dummySection = createDummySection( {\n\t\t\tisEmpty: false,\n\t\t\tclassName: 'big-sky__is-loading-dummy__generated-pattern',\n\t\t} );\n\n\t\tinsertBlock( dummySection, blockIndex, insertionBlockId );\n\n\t\tlet scrolled = false;\n\t\tzoomedOut.then( () => {\n\t\t\tif ( scrolled ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tscrolled = true;\n\t\t\t// Select the in-progress new (dummy) section.\n\t\t\tscrollToBlock( dummySection.clientId, 'center' );\n\t\t} );\n\n\t\tsetGeneratedPatternDummySectionClientId( dummySection.clientId );\n\n\t\treturn dummySection.clientId;\n\t};\n\n\t/**\n\t * Cleans up the canvas after pattern generation by replacing the dummy section.\n\t *\n\t * @param {string} dummySectionClientId The client ID of the dummy section.\n\t * @param {string} userPrompt           The user's prompt that generated the pattern.\n\t */\n\tconst cleanupCanvas = ( dummySectionClientId, userPrompt ) => {\n\t\t// Validate the dummy section ID\n\t\tif ( ! dummySectionClientId ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Get the dummy section and its first inner block\n\t\tconst dummySection = getBlock( dummySectionClientId );\n\t\tconst innerBlock = getBlock(\n\t\t\tdummySection?.innerBlocks?.[ 1 ]?.clientId // dummy patterns have a p at [0]\n\t\t);\n\n\t\tif ( ! innerBlock ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Register the pattern in site metadata\n\t\tregisterGeneratedPattern( innerBlock, userPrompt );\n\n\t\t// Replace the dummy section with the inner blocks\n\t\treplaceBlock( dummySection.clientId, innerBlock );\n\n\t\t// After the pattern is generated and rendered, set it as a cancelable action\n\t\tsetLastCancelableAction( {\n\t\t\taction: 'add_pattern',\n\t\t\tclientId: innerBlock.clientId,\n\t\t} );\n\n\t\tresetGeneratedPattern();\n\t};\n\n\treturn {\n\t\tgeneratePattern,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { store as blocksStore } from '@wordpress/blocks';\nimport { useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport useImages from '@hooks/use-images';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport patternExample1 from '../pattern-examples/1.js';\nimport patternExample2 from '../pattern-examples/2.js';\nimport patternExample3 from '../pattern-examples/3.js';\nimport patternExample4 from '../pattern-examples/4.js';\nimport patternExample5 from '../pattern-examples/5.js';\nimport patternExample6 from '../pattern-examples/6.js';\nimport patternExample7 from '../pattern-examples/7.js';\nimport patternExample8 from '../pattern-examples/8.js';\nimport patternExample9 from '../pattern-examples/9.js';\nimport patternExample10 from '../pattern-examples/10.js';\n\nexport default function useUserPrompt() {\n\tconst { getStockImageURL } = useImages();\n\tconst { siteTitle, siteDescription, siteLocation, topic, siteType } =\n\t\tuseSiteMetadata().getSiteMetadata();\n\n\tconst allowedBlocks = useSelect(\n\t\t( select ) =>\n\t\t\tselect( blocksStore )\n\t\t\t\t.getBlockTypes()\n\t\t\t\t.map( ( block ) => block.name )\n\t\t\t\t.filter(\n\t\t\t\t\t( block ) =>\n\t\t\t\t\t\t! [\n\t\t\t\t\t\t\t'core/media-text',\n\t\t\t\t\t\t\t'jetpack/contact-info',\n\t\t\t\t\t\t\t'jetpack/address',\n\t\t\t\t\t\t\t'jetpack/email',\n\t\t\t\t\t\t\t'jetpack/phone',\n\t\t\t\t\t\t].includes( block )\n\t\t\t\t),\n\t\t[]\n\t);\n\n\tconst getUserPrompt = async ( userPrompt ) => {\n\t\t// Get 10 stock images\n\t\tconst urls = await Promise.all(\n\t\t\tArray.from( { length: 20 }, () => getStockImageURL( topic ) )\n\t\t);\n\n\t\tconst portraitUrls = urls.slice( 0, 10 ).map( ( url ) => {\n\t\t\t// Remove all existing width, height, and fit parameters\n\t\t\tconst cleanedUrl = url.replace( /[?&](w|h|fit)=[^&]+/g, '' );\n\t\t\t// Add our desired dimensions\n\t\t\treturn (\n\t\t\t\tcleanedUrl +\n\t\t\t\t( cleanedUrl.includes( '?' ) ? '&' : '?' ) +\n\t\t\t\t'fit=crop&w=800&h=1200&orientation=portrait'\n\t\t\t);\n\t\t} );\n\t\tconst landscapeUrls = urls.slice( 10 ).map( ( url ) => {\n\t\t\t// Remove all existing width, height, and fit parameters\n\t\t\tconst cleanedUrl = url.replace( /[?&](w|h|fit)=[^&]+/g, '' );\n\t\t\t// Add our desired dimensions\n\t\t\treturn (\n\t\t\t\tcleanedUrl +\n\t\t\t\t( cleanedUrl.includes( '?' ) ? '&' : '?' ) +\n\t\t\t\t'fit=crop&w=1200&h=800&orientation=landscape'\n\t\t\t);\n\t\t} );\n\n\t\treturn `\nYou are a WordPress block pattern generator specializing in creating complex, structured content patterns using a container-based approach. Your task is to analyze the given information and generate a WordPress block pattern that meets the specified requirements.\n\nFirst, let's review the key information you'll be working with:\n\n1. Available Images:\n<portrait_image_urls>\n${ portraitUrls.join( '\\n' ) }\n</portrait_image_urls>\n\n<landscape_image_urls>\n${ landscapeUrls.join( '\\n' ) }\n</landscape_image_urls>\n\n2. Website Configuration:\n<website_details>\nTitle: ${ siteTitle }\nDescription: ${ siteDescription }\nLocation: ${ siteLocation?.name }\nTopic: ${ topic }\nType: ${ siteType }\n</website_details>\n\n3. Allowed Blocks:\n<allowed_blocks>\n${ allowedBlocks.join( ', ' ) }\n</allowed_blocks>\n\n4. Pattern Examples:\n<pattern_examples>\nExample 1:\n${ patternExample1 }\n\nExample 2:\n${ patternExample2 }\n\nExample 3:\n${ patternExample3 }\n\nExample 4:\n${ patternExample4 }\n\nExample 5:\n${ patternExample5 }\n\nExample 6:\n${ patternExample6 }\n\nExample 7:\n${ patternExample7 }\n\nExample 8:\n${ patternExample8 }\n\nExample 9:\n${ patternExample9 }\n\nExample 10:\n${ patternExample10 }\n</pattern_examples>\n\nNow, let's break down the process of generating the WordPress block pattern:\n\n1. Pattern Examples Analysis:\n<thought_process>\n- Review all provided pattern examples carefully\n- Note unique layout approaches and structural variations\n- Identify creative container relationships and hierarchies\n- List interesting compositional techniques that could be adapted\n- Look for non-standard groupings and unconventional arrangements\n</thought_process>\n\n2. Analyze the pattern structure:\n<thought_process>\n- Examine the user prompt: ${ userPrompt }\n- Extract and note any specific numerical requirements (e.g., \"top 5\", \"3 sections\")\n- List the main components needed for this pattern based on the user prompt\n- Determine how these components relate to the website configuration and topic\n- Outline the overall structure and hierarchy of the pattern\n- List specific blocks you plan to use based on the allowed blocks and pattern examples\n</thought_process>\n\n3. Create container hierarchy:\n<thought_process>\n- Design a container structure that accommodates all necessary components\n- Ensure container structure exactly matches any numerical requirements from the user prompt\n- List each container with a unique and descriptive ID\n- Describe how containers are nested logically and efficiently\n- Outline how each container, no matter how small, will be broken down into sub-phases\n</thought_process>\n\n4. Plan content grouping:\n<thought_process>\n- List the content divided into logical, independently renderable groups\n- Specify which container each content group will be associated with\n- Ensure content groups match any numerical requirements specified in the user prompt\n- Describe how content groups relate to each other and the overall pattern structure\n- Identify which pattern example's layout approach could be adapted\n- Note specific structural elements to incorporate from that example\n- Explain how the chosen layout serves the content purpose\n</thought_process>\n\nNow, generate the WordPress block pattern following these rules:\n\n1. Container Syntax:\n   Phase 1 must use:\n   <!-- CONTAINER_ID:unique_name type=\"container-type\" -->\n\n   Subsequent phases must wrap content with:\n   <!-- CONTAINER_REF:unique_name -->\n   [content]\n   <!-- /CONTAINER_REF:unique_name -->\n\n2. Phase Structure:\n   - Start each phase with /begin-phase-[number] and end with /end-phase-[number]\n   - Block Structure Requirements:\n     1. Every phase must be complete and valid\n     2. Every phase must contain both opening and closing tags\n     3. No partial blocks or incomplete HTML allowed\n     4. No splitting blocks across phases\n     5. No orphaned HTML tags\n     6. Phase 1 must only contain CONTAINER_ID markers\n     7. All content phases must be wrapped in CONTAINER_REF tags\n\n3. Content Phases:\n- Each content phase fills ONE complete container\n- Must be wrapped in correct CONTAINER_REF tags\n- Must be completely self-contained\n- Place individual column blocks in separate containers and phases\n\n4. Layout Requirements:\n- Avoid defaulting to basic column-based layouts unless specifically requested\n- Draw inspiration from provided pattern examples' structural approaches\n- Choose a layout style that best serves the content and user intent\n\n5. Content Rules\n   - wp:heading blocks should always include \"align\":\"wide\" in their attributes\n   - wp:columns blocks should contain images with the same orientation, all portrait or all landscape\n   - Use wp:spacer blocks to add space between sections of the pattern\n   - The outermost wp:group block must include one of these className variations randomly chosen: \"is-style-section-default\", \"is-style-section-1\", \"is-style-section-2\", \"is-style-section-3\"\n   - If the user wants a subscription form, use the jetpack/subscriptions block if available\n\n6. Generation Rules:\n   - Phase 1: Output outermost container with CONTAINER_ID markers\n   - Phase 2+: Fill each container with content wrapped in CONTAINER_REF tags\n   - Each content container must be filled in order\n   - Max 50 lines per phase\n   - Layout Selection:\n     * Review pattern examples for diverse layout approaches\n     * Choose a layout style that differs from basic column structures\n     * Adapt interesting techniques from example patterns\n     * Consider the specific content type and purpose when selecting layout\n   - Numerical Requirements:\n     * Create exactly the number of containers specified in the user prompt\n     * Fill all numerically-specified containers completely\n     * Never generate fewer items than specifically requested\n\n6. Image Guidelines:\n   - Never use inline height/width styles in the image block\n   - Always retain all image attributes in the URL\n   - Do not mix portrait and landscape images in patterns\n   - Keep images the same size across columns\n   - Use the correct format:\n     <!-- wp:image {\"sizeSlug\":\"full\",\"linkDestination\":\"none\"} -->\n     <figure class=\"wp-block-image size-full\">\n       <img src=\"[IMAGE_URL]\" alt=\"[Alt]\"/>\n     </figure>\n     <!-- /wp:image -->\n\n7. Additional Requirements:\n   - Break down each container into sub-phases for more granular control\n   - Ensure clear mapping between CONTAINER_ID and CONTAINER_REF\n   - Work from outside containers inward\n   - Generate independently renderable sections\n   - Do not use \\`\\`\\` or any other code block formatting\n\nExample of correct pattern structure, this is only an example, please create different structures based on the user prompt:\n\n<example_pattern_structure>\n/begin-phase-1\n<!-- wp:group -->\n<div class=\"wp-block-group\">\n  <!-- CONTAINER_ID:intro type=\"content\" -->\n  <!-- CONTAINER_ID:grid type=\"grid\" -->\n  <!-- CONTAINER_ID:footer type=\"content\" -->\n</div>\n<!-- /wp:group -->\n/end-phase-1\n\n/begin-phase-2\n<!-- CONTAINER_REF:intro -->\n<!-- wp:heading -->\n<h2>Title</h2>\n<!-- /wp:heading -->\n<!-- /CONTAINER_REF:hero -->\n/end-phase-2\n\n/begin-phase-3\n<!-- CONTAINER_REF:grid -->\n<!-- wp:columns -->\n<div class=\"wp-block-columns\">\n  <!-- wp:column -->\n  <div class=\"wp-block-column\">\n    <!-- CONTAINER_ID:col1 type=\"content\" -->\n  </div>\n  <!-- /wp:column -->\n  <!-- wp:column -->\n  <div class=\"wp-block-column\">\n    <!-- CONTAINER_ID:col2 type=\"content\" -->\n  </div>\n  <!-- /wp:column -->\n</div>\n<!-- /wp:columns -->\n<!-- /CONTAINER_REF:grid -->\n/end-phase-3\n\n/begin-phase-4\n<!-- CONTAINER_REF:footer -->\n<!-- wp:paragraph -->\n<p>Footer content</p>\n<!-- /wp:paragraph -->\n<!-- /CONTAINER_REF:footer -->\n/end-phase-4\n</example_pattern_structure>\n\nIMPORTANT:\n - Generate the complete pattern in a single response without asking for permission to continue or checking if more phases should be added. Generate ALL phases needed to complete the pattern, including all requested items and content. Every content phase must be properly wrapped in CONTAINER_REF tags that match their corresponding CONTAINER_ID markers.\n - Don't use any introduction text or any other text other than the phases and content.\n - DO NOT mix portrait and landscape image orientations in patterns.\n\n Begin generating the WordPress block pattern now, following the phase structure and rules outlined above. Remember to use the allowed blocks, consider the website configuration, and incorporate the available images appropriately.`;\n\t};\n\n\treturn {\n\t\tgetUserPrompt,\n\t};\n}\n","/**\n * Internal dependencies\n */\nimport usePatternRenderer from '@ai/assistants/pattern/tools/generate-pattern/hooks/use-pattern-renderer';\n\n/**\n * Custom hook for parsing streaming pattern generation responses.\n *\n * Provides functions for extracting and processing phases from content streams\n * and parsing Server-Sent Events chunks.\n */\nexport default function useStreamParser() {\n\tconst { processPhase } = usePatternRenderer();\n\n\t/**\n\t * Extracts and processes a phase from the content stream.\n\t *\n\t * Validates the phase content structure and processes it if valid.\n\t * Logs warnings for any validation issues encountered.\n\t *\n\t * @param {string} content     The full content stream.\n\t * @param {number} phaseNumber The phase number to extract.\n\t */\n\tconst extractPhase = ( content, phaseNumber ) => {\n\t\ttry {\n\t\t\t// Extract phase content\n\t\t\tconst extraction = extractPhaseContent( content, phaseNumber );\n\t\t\tif ( ! extraction.success ) return null;\n\n\t\t\t// Validate block structure\n\t\t\tconst blockValidation = validateBlockStructure(\n\t\t\t\textraction.content\n\t\t\t);\n\t\t\tif ( ! blockValidation.isValid ) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`Phase ${ phaseNumber } ${ blockValidation.message }`\n\t\t\t\t);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Validate container structure\n\t\t\tconst containerValidation = validateContainerStructure(\n\t\t\t\textraction.content,\n\t\t\t\tcontent\n\t\t\t);\n\t\t\tif ( ! containerValidation.isValid ) {\n\t\t\t\tcontainerValidation.warnings.forEach( ( warning ) =>\n\t\t\t\t\tconsole.warn( `Phase ${ phaseNumber } ${ warning }` )\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Process the phase content\n\t\t\tprocessPhase( {\n\t\t\t\tcontent: extraction.content,\n\t\t\t\tphaseNumber,\n\t\t\t} );\n\t\t} catch ( error ) {\n\t\t\tconsole.error( `Error extracting phase ${ phaseNumber }:`, error );\n\t\t\treturn null;\n\t\t}\n\t};\n\n\t/**\n\t * Parses a Server-Sent Events chunk into text content.\n\t *\n\t * Processes SSE chunks containing content block deltas and extracts\n\t * the text content. Handles JSON parsing errors gracefully.\n\t *\n\t * @param {string} chunk The SSE chunk to parse.\n\t * @return {string}     The extracted text content.\n\t */\n\tconst parseSSEChunk = ( chunk ) => {\n\t\ttry {\n\t\t\tconst lines = chunk.split( '\\n' );\n\t\t\tlet text = '';\n\n\t\t\tfor ( const line of lines ) {\n\t\t\t\tif ( line.startsWith( 'data: ' ) ) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst data = JSON.parse( line.slice( 6 ) );\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tdata.type === 'content_block_delta' &&\n\t\t\t\t\t\t\tdata.delta?.type === 'text_delta'\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\ttext += data.delta.text;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch ( e ) {\n\t\t\t\t\t\tconsole.warn( 'Invalid JSON in SSE chunk:', e );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn text;\n\t\t} catch ( error ) {\n\t\t\tconsole.error( 'Error parsing SSE chunk:', error );\n\t\t\treturn '';\n\t\t}\n\t};\n\n\t/**\n\t * Validates WordPress block structure in content.\n\t *\n\t * Checks if the content is not empty and contains valid WordPress block markers.\n\t *\n\t * @param {string} content The content to validate.\n\t * @return {Object}       Validation result with status and message.\n\t */\n\tconst validateBlockStructure = ( content ) => {\n\t\tif ( ! content ) {\n\t\t\treturn { isValid: false, message: 'Content is empty' };\n\t\t}\n\n\t\tif ( ! content.includes( '<!-- wp:' ) ) {\n\t\t\treturn {\n\t\t\t\tisValid: false,\n\t\t\t\tmessage: 'Content may be malformed: no block markers found',\n\t\t\t};\n\t\t}\n\n\t\treturn { isValid: true };\n\t};\n\n\t/**\n\t * Validates container references and IDs.\n\t *\n\t * Ensures all container references have corresponding container IDs\n\t * either in the phase content or the full content stream.\n\t *\n\t * @param {string} phaseContent The phase content to validate.\n\t * @param {string} fullContent  The full content for cross-referencing.\n\t * @return {Object}            Validation result with status and warnings.\n\t */\n\tconst validateContainerStructure = ( phaseContent, fullContent ) => {\n\t\tconst containerIds = [\n\t\t\t...phaseContent.matchAll( /<!-- CONTAINER_ID:([^\\s]+)/g ),\n\t\t].map( ( match ) => match[ 1 ] );\n\t\tconst containerRefs = [\n\t\t\t...phaseContent.matchAll( /<!-- CONTAINER_REF:([^\\s]+)/g ),\n\t\t].map( ( match ) => match[ 1 ] );\n\n\t\tconst warnings = [];\n\t\tfor ( const ref of containerRefs ) {\n\t\t\tif (\n\t\t\t\t! containerIds.includes( ref ) &&\n\t\t\t\t! fullContent.includes( `<!-- CONTAINER_ID:${ ref }` )\n\t\t\t) {\n\t\t\t\twarnings.push( `References undefined container: ${ ref }` );\n\t\t\t}\n\t\t}\n\n\t\treturn { isValid: warnings.length === 0, warnings };\n\t};\n\n\t/**\n\t * Extracts phase content from markers.\n\t *\n\t * Finds and extracts content between phase markers in the stream.\n\t * Returns a success status and the extracted content if found.\n\t *\n\t * @param {string} content     The content to extract from.\n\t * @param {number} phaseNumber The phase number to extract.\n\t * @return {Object}           Extraction result with success status and content.\n\t */\n\tconst extractPhaseContent = ( content, phaseNumber ) => {\n\t\tconst startMarker = `/begin-phase-${ phaseNumber }`;\n\t\tconst endMarker = `/end-phase-${ phaseNumber }`;\n\n\t\tconst startIndex = content.indexOf( startMarker );\n\t\tif ( startIndex === -1 ) return { success: false };\n\n\t\tconst endIndex = content.indexOf( endMarker, startIndex );\n\t\tif ( endIndex === -1 ) return { success: false };\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\tcontent: content\n\t\t\t\t.substring( startIndex + startMarker.length, endIndex )\n\t\t\t\t.trim(),\n\t\t};\n\t};\n\n\treturn {\n\t\textractPhase,\n\t\tparseSSEChunk,\n\t};\n}\n","/**\n * External dependencies\n */\nimport { useCallback, useEffect, useState } from '@wordpress/element';\nimport { parse } from '@wordpress/blocks';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport useBlocks from '@hooks/use-blocks';\nimport { store as aiStore } from '@store/index';\n\n/**\n * Custom hook for rendering and managing pattern generation in the editor.\n *\n * Handles the lifecycle of pattern generation including processing phases,\n * converting between string and block representations, and rendering in the editor.\n */\nexport default function usePatternRenderer() {\n\tconst [ isProcessing, setIsProcessing ] = useState( false );\n\tconst { replaceBlock, insertBlock, clearSelectedBlock } =\n\t\tuseDispatch( blockEditorStore );\n\tconst { getBlock } = useSelect( blockEditorStore );\n\tconst { fixInvalidBlock, getContentBlockClientID } = useBlocks();\n\n\tconst {\n\t\tsetGeneratedPatternAsString,\n\t\tsetGeneratedPatternAsBlocks,\n\t\tsetGeneratedPatternChunksAsJSON,\n\t\tsetGeneratedRootPatternClientId,\n\t} = useDispatch( aiStore );\n\n\tconst {\n\t\tgeneratedPatternAsString,\n\t\tgeneratedPatternChunksAsJSON,\n\t\tgeneratedPatternDummySectionClientId,\n\t\tgeneratedRootPatternClientId,\n\t} = useSelect( ( select ) => ( {\n\t\tgeneratedPatternAsString:\n\t\t\tselect( aiStore ).getGeneratedPatternAsString(),\n\t\tgeneratedPatternChunksAsJSON:\n\t\t\tselect( aiStore ).getGeneratedPatternChunksAsJSON(),\n\t\tgeneratedPatternDummySectionClientId:\n\t\t\tselect( aiStore ).getGeneratedPatternDummySectionClientId(),\n\t\tgeneratedRootPatternClientId:\n\t\t\tselect( aiStore ).getGeneratedRootPatternClientId(),\n\t} ) );\n\n\t/**\n\t * Processes a phase of pattern generation.\n\t *\n\t * Cleans and validates the content, extracts container references,\n\t * and updates the pattern chunks in the store.\n\t *\n\t * @param {Object} options             Options for processing the phase.\n\t * @param {string} options.content     The content to process.\n\t * @param {number} options.phaseNumber The phase number being processed.\n\t */\n\tconst processPhase = ( { content, phaseNumber } ) => {\n\t\t// Clean up any invalid content\n\t\tconst lines = content.split( '\\n' );\n\t\tconst cleanLines = lines.filter( ( line ) => {\n\t\t\tconst trimmed = line.trim();\n\t\t\treturn (\n\t\t\t\ttrimmed.startsWith( '<!-- wp:' ) ||\n\t\t\t\ttrimmed.startsWith( '<!-- CONTAINER' ) ||\n\t\t\t\ttrimmed.startsWith( '<!-- /wp:' ) ||\n\t\t\t\ttrimmed.startsWith( '<!-- /CONTAINER' ) ||\n\t\t\t\t( trimmed.length > 0 &&\n\t\t\t\t\t! trimmed.startsWith( '<!--' ) &&\n\t\t\t\t\t! trimmed.endsWith( '-->' ) )\n\t\t\t);\n\t\t} );\n\n\t\tconst cleanedCode = cleanLines.join( '\\n' ).trim();\n\n\t\tconst containerRefPattern =\n\t\t\t/<!--\\s*CONTAINER_REF:([^\\s]+)\\s*-->((?:(?!<!--\\s*(?:\\/)?CONTAINER_REF)[\\s\\S])*?)<!--\\s*\\/CONTAINER_REF:[^\\s]+\\s*-->/g;\n\t\tconst containerRefs = [];\n\t\tlet match;\n\n\t\twhile ( ( match = containerRefPattern.exec( cleanedCode ) ) !== null ) {\n\t\t\tcontainerRefs.push( {\n\t\t\t\trefId: match[ 1 ],\n\t\t\t\tcontent: match[ 2 ].trim(),\n\t\t\t} );\n\t\t}\n\n\t\tif ( containerRefs.length === 0 ) {\n\t\t\tcontainerRefs.push( {\n\t\t\t\trefId: 'root',\n\t\t\t\tcontent: cleanedCode,\n\t\t\t} );\n\t\t}\n\n\t\tconst phaseJSON = {\n\t\t\tphase: phaseNumber,\n\t\t\tcontainers: containerRefs,\n\t\t};\n\n\t\tsetGeneratedPatternChunksAsJSON( phaseJSON );\n\t};\n\n\t/**\n\t * Renders pattern blocks in the editor.\n\t *\n\t * Either replaces an existing block or inserts a new block in the post content,\n\t * depending on whether we have a root pattern ID.\n\t *\n\t * @param {Array} patternAsBlocks Array of blocks to render.\n\t */\n\tconst renderInEditor = useCallback(\n\t\t( patternAsBlocks ) => {\n\t\t\tif ( ! patternAsBlocks?.length ) return;\n\n\t\t\t// Get the post content block as the target location\n\t\t\tconst contentBlockClientId = getContentBlockClientID();\n\t\t\tif ( ! contentBlockClientId ) return;\n\n\t\t\t// If we have a rootPatternId, we're updating an existing block\n\t\t\tif (\n\t\t\t\tgeneratedRootPatternClientId &&\n\t\t\t\tgetBlock( generatedRootPatternClientId )\n\t\t\t) {\n\t\t\t\treplaceBlock(\n\t\t\t\t\tgeneratedRootPatternClientId,\n\t\t\t\t\tpatternAsBlocks[ 0 ]\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t// Otherwise insert as a new block in the post content\n\t\t\t\tinsertBlock(\n\t\t\t\t\tpatternAsBlocks[ 0 ],\n\t\t\t\t\tundefined,\n\t\t\t\t\tgeneratedPatternDummySectionClientId\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Deselect any selected block after rendering\n\t\t\tclearSelectedBlock();\n\t\t},\n\t\t[\n\t\t\tgetContentBlockClientID,\n\t\t\tgeneratedRootPatternClientId,\n\t\t\tgetBlock,\n\t\t\treplaceBlock,\n\t\t\tinsertBlock,\n\t\t\tclearSelectedBlock,\n\t\t\tgeneratedPatternDummySectionClientId,\n\t\t]\n\t);\n\n\t/**\n\t * Converts a pattern string to blocks.\n\t *\n\t * Removes container IDs, parses the pattern into blocks,\n\t * fixes any invalid blocks, and manages the root pattern ID.\n\t *\n\t * @param {string} patternAsString Pattern HTML string to convert.\n\t * @return {Array|undefined}      Array of blocks if successful, undefined otherwise.\n\t */\n\tconst convertToBlocks = useCallback(\n\t\t( patternAsString ) => {\n\t\t\tif ( ! patternAsString ) return;\n\n\t\t\t// Remove <!-- CONTAINER_ID:[ID] --> from the raw patternAsString\n\t\t\t// otherwise it will cause validation errors\n\t\t\tconst containerIdPattern =\n\t\t\t\t/<!--\\s*CONTAINER_ID:([^\\s]+)(?:\\s+type=\"[^\"]*\")?\\s*-->/g;\n\t\t\tconst patternWithoutContainerIds = patternAsString.replace(\n\t\t\t\tcontainerIdPattern,\n\t\t\t\t''\n\t\t\t);\n\n\t\t\tconst blocks = parse( patternWithoutContainerIds );\n\t\t\tconst fixedBlocks = blocks.map( ( block ) =>\n\t\t\t\tfixInvalidBlock( block )\n\t\t\t);\n\n\t\t\t// If rootPatternId is not null, set the root pattern id to the clientId of the first block\n\t\t\tif ( ! generatedRootPatternClientId ) {\n\t\t\t\tsetGeneratedRootPatternClientId( fixedBlocks[ 0 ].clientId );\n\t\t\t} else {\n\t\t\t\t// Otherwise make sure the root pattern client ID remains the same\n\t\t\t\tfixedBlocks[ 0 ].clientId = generatedRootPatternClientId;\n\t\t\t}\n\n\t\t\tsetGeneratedPatternAsBlocks( fixedBlocks );\n\t\t\treturn fixedBlocks;\n\t\t},\n\t\t[\n\t\t\tfixInvalidBlock,\n\t\t\tgeneratedRootPatternClientId,\n\t\t\tsetGeneratedRootPatternClientId,\n\t\t\tsetGeneratedPatternAsBlocks,\n\t\t]\n\t);\n\n\t/**\n\t * Converts pattern JSON to a string representation.\n\t *\n\t * Processes each phase and container, replacing container references\n\t * with their content in the pattern string.\n\t *\n\t * @param {Array} patternJSON Array of pattern phases to convert.\n\t * @return {string|undefined} Updated pattern string if changed, undefined otherwise.\n\t */\n\tconst convertToString = useCallback(\n\t\t( patternJSON ) => {\n\t\t\tif ( ! patternJSON?.length ) return;\n\n\t\t\tlet updatedPatternAsString = '';\n\t\t\tpatternJSON.forEach( ( json ) => {\n\t\t\t\tconst { phase, containers } = json;\n\n\t\t\t\tcontainers.forEach( ( container ) => {\n\t\t\t\t\tif ( phase === 1 ) {\n\t\t\t\t\t\tupdatedPatternAsString = container.content;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst containerRefPattern = new RegExp(\n\t\t\t\t\t\t`<!-- CONTAINER_ID:${ container.refId }(?:\\\\s+type=\"[^\"]*\")?\\\\s*-->`,\n\t\t\t\t\t\t'g'\n\t\t\t\t\t);\n\n\t\t\t\t\tconst existingContainer =\n\t\t\t\t\t\tupdatedPatternAsString.match( containerRefPattern );\n\n\t\t\t\t\tif ( existingContainer ) {\n\t\t\t\t\t\tupdatedPatternAsString = updatedPatternAsString.replace(\n\t\t\t\t\t\t\tcontainerRefPattern,\n\t\t\t\t\t\t\tcontainer.content\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\n\t\t\tif ( updatedPatternAsString !== generatedPatternAsString ) {\n\t\t\t\tsetGeneratedPatternAsString( updatedPatternAsString );\n\t\t\t\treturn updatedPatternAsString;\n\t\t\t}\n\t\t},\n\t\t[ setGeneratedPatternAsString, generatedPatternAsString ]\n\t);\n\n\t// Process pattern changes when chunks are updated\n\tuseEffect( () => {\n\t\tif ( isProcessing || ! generatedPatternChunksAsJSON?.length ) return;\n\n\t\tconst processPattern = async () => {\n\t\t\tsetIsProcessing( true );\n\t\t\ttry {\n\t\t\t\tconst patternString = convertToString(\n\t\t\t\t\tgeneratedPatternChunksAsJSON\n\t\t\t\t);\n\t\t\t\tif ( patternString ) {\n\t\t\t\t\tconst blocks = convertToBlocks( patternString );\n\t\t\t\t\tif ( blocks?.length ) {\n\t\t\t\t\t\trenderInEditor( blocks );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} finally {\n\t\t\t\tsetIsProcessing( false );\n\t\t\t}\n\t\t};\n\n\t\tprocessPattern();\n\t}, [\n\t\tgeneratedPatternChunksAsJSON,\n\t\tconvertToString,\n\t\tconvertToBlocks,\n\t\trenderInEditor,\n\t\tisProcessing,\n\t] );\n\n\treturn {\n\t\tprocessPhase,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { useEffect } from '@wordpress/element';\n\n/**\n * External dependencies\n */\nimport { useChat, useToolkits } from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport patternToolkit from './toolkit.js';\nimport { store as aiStore } from '@store';\nimport useChangeAssistantTool from '@ai/assistants/shared/change-assistant/use-change-assistant-tool.js';\nimport useCreateToolCallback from '@ai/assistants/shared/use-create-tool-callback.js';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport usePatterns from '@hooks/use-patterns';\nimport usePatternToolValidation from './use-pattern-tool-validation.js';\nimport useAddPatternTool from './tools/add-pattern/use-add-pattern-tool.js';\nimport useRemoveBlockTool from './tools/remove-block/use-remove-block-tool.js';\nimport useReplacePatternTool from './tools/replace-pattern/use-replace-pattern-tool.js';\nimport useGeneratePatternTool from './tools/generate-pattern/use-generate-pattern-tool.js';\n\nconst usePatternToolkit = () => {\n\tconst { createToolCallback } = useCreateToolCallback();\n\tconst { changeAssistant } = useChangeAssistantTool();\n\tconst { agentSay } = useChat();\n\tconst { setCallbacks, setContext } = useToolkits();\n\tconst { selectedBlock } = useSelect( ( select ) => {\n\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\t\treturn {\n\t\t\tselectedBlock: getSelectedBlock(),\n\t\t};\n\t} );\n\tconst { getSiteMetadata } = useSiteMetadata();\n\tconst { siteTitle, siteDescription, topic, siteLocation } =\n\t\tgetSiteMetadata();\n\n\tconst { getParentPatternCategory } = usePatterns();\n\n\tconst { addPattern } = useAddPatternTool();\n\tconst { removeBlock } = useRemoveBlockTool();\n\tconst { replacePattern } = useReplacePatternTool();\n\tconst { generatePattern } = useGeneratePatternTool();\n\n\tconst {\n\t\tvalidateAddPatternArgs,\n\t\tvalidateGeneratePatternArgs,\n\t\tvalidateRemoveBlockArgs,\n\t\tvalidateReplacePatternArgs,\n\t} = usePatternToolValidation();\n\n\tconst { setShowThread } = useDispatch( aiStore );\n\n\tconst { getIsHandoff } = useSelect( ( select ) => {\n\t\tconst { getIsHandoff: _getIsHandoff } = select( aiStore );\n\t\treturn {\n\t\t\tgetIsHandoff: _getIsHandoff,\n\t\t};\n\t} );\n\n\t// Register the toolkit's callbacks\n\tuseEffect( () => {\n\t\tsetCallbacks( patternToolkit.name, {\n\t\t\t...( window.localStorage.getItem( 'isGeneratingPatterns' ) ===\n\t\t\t'true'\n\t\t\t\t? {\n\t\t\t\t\t\tgenerate_pattern: createToolCallback( {\n\t\t\t\t\t\t\tname: 'generate_pattern',\n\t\t\t\t\t\t\taction: async ( _args ) => {\n\t\t\t\t\t\t\t\tconst message = await generatePattern( _args );\n\t\t\t\t\t\t\t\tagentSay( message );\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tvalidator: validateGeneratePatternArgs,\n\t\t\t\t\t\t\tfailValidatorAction: ( _, error ) => {\n\t\t\t\t\t\t\t\tsetShowThread( true );\n\t\t\t\t\t\t\t\tagentSay( error.message );\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcloseChatWhenDone: () => ! getIsHandoff(),\n\t\t\t\t\t\t} ),\n\t\t\t\t  }\n\t\t\t\t: {\n\t\t\t\t\t\tadd_pattern: createToolCallback( {\n\t\t\t\t\t\t\tname: 'add_pattern',\n\t\t\t\t\t\t\taction: async ( _args ) => {\n\t\t\t\t\t\t\t\tconst message = await addPattern( _args );\n\t\t\t\t\t\t\t\tagentSay( message );\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tvalidator: validateAddPatternArgs,\n\t\t\t\t\t\t\tfailValidatorAction: ( _, error ) => {\n\t\t\t\t\t\t\t\tsetShowThread( true );\n\t\t\t\t\t\t\t\tagentSay( error.message );\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcloseChatWhenDone: () => ! getIsHandoff(),\n\t\t\t\t\t\t} ),\n\t\t\t\t  } ),\n\t\t\tremove_block: createToolCallback( {\n\t\t\t\tname: 'remove_block',\n\t\t\t\taction: async ( _args ) => {\n\t\t\t\t\tconst message = await removeBlock( _args );\n\t\t\t\t\tagentSay( message );\n\t\t\t\t},\n\t\t\t\tvalidator: validateRemoveBlockArgs,\n\t\t\t\tfailValidatorAction: ( _, error ) => {\n\t\t\t\t\tsetShowThread( true );\n\t\t\t\t\tagentSay( error.message );\n\t\t\t\t},\n\t\t\t\tcloseChatWhenDone: () => ! getIsHandoff(),\n\t\t\t} ),\n\t\t\treplace_pattern: createToolCallback( {\n\t\t\t\tname: 'replace_pattern',\n\t\t\t\taction: async ( _args ) => {\n\t\t\t\t\tconst message = await replacePattern( _args );\n\t\t\t\t\tagentSay( message );\n\t\t\t\t},\n\t\t\t\tvalidator: validateReplacePatternArgs,\n\t\t\t\tfailValidatorAction: ( _, error ) => {\n\t\t\t\t\tsetShowThread( true );\n\t\t\t\t\tagentSay( error.message );\n\t\t\t\t},\n\t\t\t\tcloseChatWhenDone: () => ! getIsHandoff(),\n\t\t\t} ),\n\t\t\tchange_assistant: createToolCallback( {\n\t\t\t\tname: 'change_assistant',\n\t\t\t\taction: ( _args ) => {\n\t\t\t\t\tsetShowThread( true );\n\t\t\t\t\tchangeAssistant( _args );\n\t\t\t\t},\n\t\t\t\tcloseChatWhenDone: () => false,\n\t\t\t} ),\n\t\t} );\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ setCallbacks ] );\n\n\tlet patternCategory = null;\n\tif ( selectedBlock ) {\n\t\tpatternCategory = getParentPatternCategory( selectedBlock );\n\t}\n\n\tuseEffect( () => {\n\t\tconst context = {\n\t\t\tselectedBlock: {\n\t\t\t\tclientId: selectedBlock?.clientId,\n\t\t\t\tname: selectedBlock?.name,\n\t\t\t\ttype: selectedBlock?.type,\n\t\t\t\tparentPatternCategory: patternCategory,\n\t\t\t},\n\t\t\tsite: {\n\t\t\t\tsiteTitle,\n\t\t\t\tsiteDescription,\n\t\t\t\tsiteLocation,\n\t\t\t\ttopic,\n\t\t\t},\n\t\t};\n\n\t\tsetContext( patternToolkit.name, context );\n\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ setContext, selectedBlock, topic, patternCategory ] );\n};\n\nexport default usePatternToolkit;\n","import patternAssistantPrompt from './prompt.js';\nimport patternToolkit from './toolkit.js';\nimport { ASSISTANTS } from '../constants.js';\nimport usePatternToolkit from './use-pattern-toolkit.js';\n\nconst patternAssistant = {\n\tid: ASSISTANTS.PATTERN,\n\tdescription:\n\t\t'An assistant that handles adding, removing, and replacing patterns and sections.',\n\tinstructions: ( context ) => {\n\t\treturn patternAssistantPrompt( context );\n\t},\n\ttags: [ 'big-sky-pattern' ],\n\ttoolkits: [ patternToolkit ],\n\ttoolkitHook: usePatternToolkit,\n\tonStart: ( invoke, clearMessages = () => {}, agentMessage = null ) => {\n\t\tif ( agentMessage ) {\n\t\t\tclearMessages();\n\t\t\tinvoke.agentSay( agentMessage );\n\t\t}\n\t},\n};\n\nexport default patternAssistant;\n","import {\n\tanalysisPrompt,\n\tgetReturnToRouterPrompt,\n\tgetSelectedBlockContextPrompt,\n\tgetSiteContextPrompt,\n\thelpActionPrompt,\n\thelpAssistantPrompt,\n\tisForwardedByRouter,\n\tlanguagePrompt,\n\trouterActionPrompt,\n} from '../shared/prompts.js';\n\nexport default function patternAssistantPrompt( context ) {\n\tconst routerExamples = ! isForwardedByRouter( context )\n\t\t? `User: \"Make my site more blue\"\n   Analysis: This is not related to pattern/section and is not in the form of a question\n   Action: ${ routerActionPrompt }\n   \n   User: \"Add a new page for contact us\"\n   Analysis: The user is asking to add a new page rather a pattern/section and is mot in the form of a question\n   Action: ${ routerActionPrompt }\n\n   User: \"Find me a new stock image to replace the one I have selected.\"\n   Analysis: This is not related to pattern/section and is not in the form of a question\n   Action: ${ routerActionPrompt }\n\n   User: \"I want to change the layout of my site.\"\n   Analysis: This is related to full site layout/design rather than an individual pattern/section\n   Action: ${ routerActionPrompt }`\n\t\t: '';\n\n\tconst prompt = `\nYou are an expert website designer at Automattic, specializing in pattern and section management for WordPress sites. Your primary goal is to help users customize their website patterns and sections effectively or route their queries to appropriate assistance.\n\nHere is the current context, use this to inform your responses:\n\n<site_context>\n${ getSiteContextPrompt( context, [\n\t'siteTitle',\n\t'siteDescription',\n\t'siteLocation',\n\t'topic',\n] ) }\n</site_context>\n\n<selected_block_context>\n${ getSelectedBlockContextPrompt( context, [ 'clientId', 'type' ] ) }\n</selected_block_context>\n\nHere is the language you should use for responses unless explicitly instructed otherwise:\n\n<language>\n${ languagePrompt }\n</language>\n\nInstructions:\n\n1. Analyze the User Input:\n   ${ analysisPrompt }\n   - Identify key words or phrases related to patterns/sections\n   - Determine the specific operation requested (add, remove, replace, or none)\n   - Check if it's a map-specific request\n   - Evaluate if it's a question or other type of request\n   - Consider potential misinterpretations (e.g., content modifications vs. pattern changes)\n   - Is the request related to entire patterns or sections, or is it about modifying content within an existing pattern/section?\n   - Is the request related to full site or page layouts and not specific patterns or sections?\n   - Pay special attention to requests containing words like \"replace\" or \"add\" to ensure they are truly about entire patterns/sections and not general text modifications or unrelated actions.\n   - Requests to add, remove, or modify rows, items, or fields within an existing section should be treated as non-pattern requests.\n   - Determine if routing to other assistant is needed\n\n2. Handle Pattern/Section-Related Requests:\n   - For new patterns, use the add_pattern tool with appropriate categories.\n   - For pattern removal, use the remove_block tool.\n   - For pattern replacement, use the replace_pattern tool.\n   - For map requests, verify site location and use the \"contact\" category.\n   - For duplicate section errors, offer remove or replace options.\n   - For changing section/pattern designs call replace_pattern\n\n3. Handle Non-Pattern/Section Requests:\n   - ${ helpAssistantPrompt }\n   ${ getReturnToRouterPrompt( context ) }\n\n4. Special cases:\n   - If the request is pattern-related but there's no specific tool to handle it, ${ helpActionPrompt }\n\n5. Examples:\n   User: \"Add a contact form\"\n   Analysis: Pattern-related request for new form\n   Action: Call add_pattern with form category\n\n   User: \"Replace this section with a map\"\n   Analysis: Map-specific pattern replacement\n   Action: Call replace_pattern with contact category and isAskingForMap true\n\n   User: \"How do I install the WooCommerce plugin?\"\n   Analysis: This is not related to pattern/section and is in the form of a question\n   Action: ${ helpActionPrompt }\n\n${ routerExamples }\n\n6. Restrictions:\n   - Only handle operations related to entire patterns/sections.\n   - Validate pattern categories before operations.\n   - Prevent duplicate unique sections.\n   - Route non-pattern/section requests appropriately.\n\nRemember to immediately execute appropriate tool calls or guide users based on analysis, without displaying the analysis process.\n`;\n\n\treturn prompt;\n}\n","/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useDispatch, useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport useCanvas from '@hooks/use-canvas';\nimport usePatternToolValidation from '@ai/assistants/pattern/use-pattern-tool-validation.js';\nimport { store as aiStore } from '@store';\nimport { dockViews } from '@utils/constants';\n\nexport default function useRemoveBlockTool() {\n\tconst { zoomIn } = useCanvas();\n\tconst { setIsToolContainerVisible } = useDispatch( aiStore );\n\tconst { validateRemoveBlockArgs } = usePatternToolValidation();\n\tconst { setDockView, setLastSelectedBlock } = useDispatch( aiStore );\n\n\tconst { removeBlock: removeBlockFromEditor } =\n\t\tuseDispatch( blockEditorStore );\n\n\tconst { getBlock, getSelectedBlock, getBlockRootClientId } = useSelect(\n\t\t( select ) => ( {\n\t\t\tgetBlock: select( blockEditorStore ).getBlock,\n\t\t\tgetSelectedBlock: select( blockEditorStore ).getSelectedBlock,\n\t\t\tgetBlockRootClientId:\n\t\t\t\tselect( blockEditorStore ).getBlockRootClientId,\n\t\t} )\n\t);\n\n\tconst { lastSelectedBlock } = useSelect( ( select ) => {\n\t\tconst ai = select( aiStore );\n\n\t\treturn {\n\t\t\tlastSelectedBlock: ai.getLastSelectedBlock(),\n\t\t};\n\t} );\n\n\tconst removeBlock = async ( { clientId } ) => {\n\t\ttry {\n\t\t\tlet __clientId = clientId;\n\t\t\tif ( ! clientId ) {\n\t\t\t\t// Use the selected block if no clientId is provided\n\t\t\t\t__clientId = getSelectedBlock()?.clientId;\n\t\t\t}\n\n\t\t\tif ( ! __clientId ) {\n\t\t\t\t// If there's no selected block, use the last selected block\n\t\t\t\t__clientId = lastSelectedBlock?.clientId;\n\t\t\t}\n\n\t\t\tawait validateRemoveBlockArgs( { clientId: __clientId } );\n\n\t\t\t// If the block is a core/cover block, remove the parent core/group block instead\n\t\t\tconst _clientId =\n\t\t\t\tgetBlock( __clientId )?.name === 'core/cover'\n\t\t\t\t\t? getBlockRootClientId( __clientId )\n\t\t\t\t\t: __clientId;\n\n\t\t\tif ( getBlock( _clientId ) ) {\n\t\t\t\tremoveBlockFromEditor( _clientId );\n\t\t\t}\n\n\t\t\tsetLastSelectedBlock( null );\n\t\t\tsetDockView( dockViews.MENUS );\n\t\t\tsetIsToolContainerVisible( false );\n\t\t\tzoomIn();\n\n\t\t\treturn __( 'I have removed the block for you.', 'big-sky' );\n\t\t} catch ( error ) {\n\t\t\tthrow error;\n\t\t}\n\t};\n\n\treturn {\n\t\tremoveBlock,\n\t};\n}\n","import createShowFontPickerTool from './tools/show-font-picker.js';\nimport changeAssistantTool from '@ai/assistants/shared/change-assistant/change-assistant-tool';\nimport { ASSISTANTS } from '@ai/assistants/constants.js';\nimport { isForwardedByRouter } from '@ai/assistants/shared/prompts.js';\n\nconst fontToolkit = {\n\tname: 'font',\n\ttools: ( context ) => {\n\t\tconst tools = [ createShowFontPickerTool( context?.keywords ) ];\n\n\t\tif (\n\t\t\tcontext.currentHandoffArea !== 'fonts' &&\n\t\t\t! isForwardedByRouter( context )\n\t\t) {\n\t\t\ttools.push( changeAssistantTool( ASSISTANTS.FONT ) );\n\t\t}\n\n\t\treturn tools;\n\t},\n};\n\nexport default fontToolkit;\n","import VariationPicker from '@components/variation-picker';\nimport useSiteMetadata from '@hooks/use-site-metadata';\n\nconst FontVariationPicker = ( { fontVariations, maxFontsToShow = 12 } ) => {\n\tconst { currentFont } = useSiteMetadata().getSiteMetadata();\n\n\treturn (\n\t\t<VariationPicker\n\t\t\tvariations={ fontVariations }\n\t\t\tcurrentVariation={ currentFont }\n\t\t\tmaxToShow={ maxFontsToShow }\n\t\t\ttype=\"font\"\n\t\t/>\n\t);\n};\n\nexport default FontVariationPicker;\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport FontVariationPicker from '@components/font-variation-picker';\nimport { store as aiStore } from '@store';\nimport useCanvas from '@hooks/use-canvas';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport useStyles from '@hooks/use-styles';\nimport useVariations from '@hooks/use-variations';\nimport { dockViews, MAX_VARIATIONS_TO_SHOW } from '@utils/constants';\nimport { calculateFontVariationsToShow } from '@utils/fonts';\n\nexport default function useFontToolFunctions() {\n\tconst { zoomIn } = useCanvas();\n\tconst { getCurrentFont } = useSelect( aiStore );\n\tconst { getFontVariationByTitle, getFontVariations } = useVariations();\n\tconst { setDockView, setIsToolContainerVisible, setLastCancelableAction } =\n\t\tuseDispatch( aiStore );\n\tconst { setSiteMetadata } = useSiteMetadata();\n\tconst { currentFont: currentFontMeta } =\n\t\tuseSiteMetadata().getSiteMetadata();\n\tconst { saveStylesEntityRecord, setStyles } = useStyles();\n\n\tconst cancelShowFontPicker = ( variationName ) => {\n\t\tsetDockView( dockViews.MENUS );\n\t\tsetStyles( { font: variationName } );\n\t\tsetIsToolContainerVisible( false );\n\t\tzoomIn();\n\t};\n\n\tconst validateArguments = ( args ) => {\n\t\tif ( ! args ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { keywords } = args;\n\n\t\tif ( ! keywords ) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst doneShowFontPicker = () => {\n\t\tsaveStylesEntityRecord();\n\t\tsetSiteMetadata( {}, true ); // persist the current site metadata\n\t\tsetDockView( dockViews.MENUS );\n\t\tsetIsToolContainerVisible( false );\n\t\tzoomIn();\n\t};\n\n\tconst showFontPicker = ( parameters ) => {\n\t\tconst currentFont = getCurrentFont() || currentFontMeta;\n\t\tconst { keywords = [], fonts = [], callback = () => {} } = parameters;\n\n\t\tconst { fontVariationsToShow, message } = calculateFontVariationsToShow(\n\t\t\t{\n\t\t\t\tchosenFonts: fonts,\n\t\t\t\tkeywords,\n\t\t\t\tcurrentFont,\n\t\t\t\tgetFontVariations,\n\t\t\t\tgetFontVariationByTitle,\n\t\t\t}\n\t\t);\n\n\t\tsetLastCancelableAction( {\n\t\t\taction: 'show_font_picker',\n\t\t\toriginalVariationName: currentFont,\n\t\t} );\n\n\t\tcallback(\n\t\t\t<FontVariationPicker\n\t\t\t\tfontVariations={ fontVariationsToShow }\n\t\t\t\tkey=\"font-picker\"\n\t\t\t\tmaxFontsToShow={ MAX_VARIATIONS_TO_SHOW }\n\t\t\t/>,\n\t\t\tmessage\n\t\t);\n\t};\n\n\treturn {\n\t\tshowFontPicker,\n\t\tcancelShowFontPicker,\n\t\tdoneShowFontPicker,\n\t\tvalidateArguments,\n\t};\n}\n","import { __ } from '@wordpress/i18n';\n\nexport function calculateFontVariationsToShow( {\n\tkeywords,\n\tchosenFonts = [],\n\tcurrentFont,\n\tgetFontVariations,\n\tgetFontVariationByTitle,\n} ) {\n\tlet fontVariationsToShow = [];\n\tlet message = __( 'There are no fonts available.', 'big-sky' );\n\tconst fontVariations = getFontVariations() || [];\n\n\tif ( fontVariations.length === 0 ) {\n\t\treturn { fontVariationsToShow, message };\n\t}\n\n\tif ( chosenFonts && chosenFonts.length ) {\n\t\tfontVariationsToShow = fontVariations.filter( ( fontVariation ) => {\n\t\t\treturn chosenFonts.includes( fontVariation.title );\n\t\t} );\n\t} else if ( keywords && keywords.length ) {\n\t\tconst fontVariationKeywordMatches = fontVariations.map(\n\t\t\t( fontVariation ) => {\n\t\t\t\tconst hardcodedKeywords =\n\t\t\t\t\tfontVariation[ 'x-big-sky-meta' ]?.keywords || [];\n\t\t\t\tconst matchingKeywords = hardcodedKeywords.filter(\n\t\t\t\t\t( keyword ) => keywords.includes( keyword )\n\t\t\t\t);\n\t\t\t\treturn {\n\t\t\t\t\t...fontVariation,\n\t\t\t\t\tmatchingKeywords: matchingKeywords.length,\n\t\t\t\t};\n\t\t\t}\n\t\t);\n\n\t\tfontVariationsToShow = fontVariationKeywordMatches\n\t\t\t.sort( ( a, b ) => b.matchingKeywords - a.matchingKeywords )\n\t\t\t.filter( ( fontVariation ) => fontVariation.matchingKeywords > 0 );\n\t}\n\tmessage =\n\t\tfontVariationsToShow.length > 0\n\t\t\t? __( 'Here are your matching fonts.', 'big-sky' )\n\t\t\t: __(\n\t\t\t\t\t\"I didn't find any fonts that match, but here are all available fonts.\",\n\t\t\t\t\t'big-sky'\n\t\t\t  );\n\n\tif ( fontVariationsToShow.length === 0 ) {\n\t\tfontVariationsToShow = fontVariations;\n\t}\n\n\t// Add the current font variation to the front of the list and remove duplicates.\n\tconst currentFontVariation = getFontVariationByTitle( currentFont );\n\tif ( currentFontVariation ) {\n\t\tfontVariationsToShow = [\n\t\t\tcurrentFontVariation,\n\t\t\t...fontVariationsToShow.filter(\n\t\t\t\t( font ) => font.title !== currentFont\n\t\t\t),\n\t\t];\n\t}\n\tfontVariationsToShow = [ ...new Set( fontVariationsToShow ) ];\n\n\treturn { fontVariationsToShow, message };\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { useEffect } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * External dependencies\n */\nimport { useChat, useToolkits } from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport fontToolkit from './toolkit.js';\nimport useFontToolFunctions from './tools/use-tool-functions.js';\nimport useCanvas from '@hooks/use-canvas';\nimport { store as aiStore } from '@store';\nimport useVariations from '@hooks/use-variations';\nimport useChangeAssistantTool from '@ai/assistants/shared/change-assistant/use-change-assistant-tool.js';\nimport useCreateToolCallback from '@ai/assistants/shared/use-create-tool-callback.js';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\nconst useFontToolkit = () => {\n\tconst { createToolCallback } = useCreateToolCallback();\n\tconst { getVariationKeywords } = useVariations();\n\tconst { changeAssistant } = useChangeAssistantTool();\n\tconst { agentSay } = useChat();\n\tconst { setCallbacks, setContext } = useToolkits();\n\n\tconst { getSiteMetadata } = useSiteMetadata();\n\tconst { siteTitle, siteDescription, topic } = getSiteMetadata();\n\n\tconst { showFontPicker, validateArguments: validateShowFontPickerArgs } =\n\t\tuseFontToolFunctions();\n\n\tconst { zoomOut } = useCanvas();\n\n\tconst { getIsHandoff, currentHandoffArea, selectedBlock } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\t\t\tconst { getIsHandoff: _getIsHandoff, getCurrentHandoffArea } =\n\t\t\t\tselect( aiStore );\n\t\t\treturn {\n\t\t\t\tselectedBlock: getSelectedBlock(),\n\t\t\t\tgetIsHandoff: _getIsHandoff,\n\t\t\t\tcurrentHandoffArea: getCurrentHandoffArea(),\n\t\t\t};\n\t\t}\n\t);\n\n\tconst {\n\t\tsetChatComponents,\n\t\tsetIsToolContainerVisible,\n\t\tsetToolComponent,\n\t\tsetShowThread,\n\t} = useDispatch( aiStore );\n\n\tuseEffect( () => {\n\t\tsetCallbacks( fontToolkit.name, {\n\t\t\tshow_font_picker: createToolCallback( {\n\t\t\t\tname: 'show_font_picker',\n\t\t\t\taction: ( _args ) => {\n\t\t\t\t\tshowFontPicker( {\n\t\t\t\t\t\t..._args,\n\t\t\t\t\t\tcallback: ( component, message ) => {\n\t\t\t\t\t\t\tif ( getIsHandoff() ) {\n\t\t\t\t\t\t\t\tsetChatComponents( [ component ] );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tzoomOut();\n\t\t\t\t\t\t\t\tsetToolComponent( component );\n\t\t\t\t\t\t\t\tsetIsToolContainerVisible( true );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tagentSay( message );\n\t\t\t\t\t\t},\n\t\t\t\t\t} );\n\t\t\t\t},\n\t\t\t\tvalidator: ( _args ) => validateShowFontPickerArgs( _args ),\n\t\t\t\tfailValidatorAction: () =>\n\t\t\t\t\tagentSay(\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'Please provide a font or a category to view font options.',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t\tcloseChatWhenDone: () => ! getIsHandoff(),\n\t\t\t} ),\n\t\t\tchange_assistant: createToolCallback( {\n\t\t\t\tname: 'change_assistant',\n\t\t\t\taction: ( _args ) => {\n\t\t\t\t\tsetShowThread( true );\n\t\t\t\t\tchangeAssistant( _args );\n\t\t\t\t},\n\t\t\t\tcloseChatWhenDone: () => false,\n\t\t\t} ),\n\t\t} );\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ setCallbacks ] );\n\n\tuseEffect( () => {\n\t\tconst context = {\n\t\t\tsite: {\n\t\t\t\tsiteTitle,\n\t\t\t\tsiteDescription,\n\t\t\t\ttopic,\n\t\t\t},\n\t\t\tselectedBlock: {\n\t\t\t\tclientId: selectedBlock?.clientId,\n\t\t\t\ttype: selectedBlock?.type,\n\t\t\t\tname: selectedBlock?.name,\n\t\t\t},\n\t\t\tkeywords: getVariationKeywords( 'font' ),\n\t\t};\n\n\t\tif ( getIsHandoff() ) {\n\t\t\tcontext.currentHandoffArea = currentHandoffArea;\n\t\t}\n\n\t\tsetContext( fontToolkit.name, context );\n\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ setContext, getIsHandoff, currentHandoffArea, selectedBlock ] );\n};\n\nexport default useFontToolkit;\n","import fontAssistantPrompt from './prompt.js';\nimport fontToolkit from './toolkit.js';\nimport { ASSISTANTS } from '../constants.js';\nimport useFontToolkit from './use-font-toolkit.js';\n\nconst fontAssistant = {\n\tid: ASSISTANTS.FONT,\n\tdescription: 'An assistant that handles font selection.',\n\tinstructions: ( context ) => {\n\t\treturn fontAssistantPrompt( context );\n\t},\n\ttags: [ ASSISTANTS.FONT ],\n\ttoolkits: [ fontToolkit ],\n\ttoolkitHook: useFontToolkit,\n\tonStart: ( invoke, clearMessages = () => {}, agentMessage = null ) => {\n\t\tif ( agentMessage ) {\n\t\t\tclearMessages();\n\t\t\tinvoke.agentSay( agentMessage );\n\t\t}\n\t},\n};\n\nexport default fontAssistant;\n","import {\n\tanalysisPrompt,\n\tgetReturnToRouterPrompt,\n\tgetSelectedBlockContextPrompt,\n\tgetSiteContextPrompt,\n\thelpActionPrompt,\n\thelpAssistantPrompt,\n\tisForwardedByRouter,\n\tlanguagePrompt,\n\trouterActionPrompt,\n} from '../shared/prompts.js';\n\nexport default function fontAssistantPrompt( context ) {\n\tconst routerExamples = ! isForwardedByRouter( context )\n\t\t? `User: \"Move this image to the right\"\n         Analysis: This is not related to fonts and is not in the form of a question\n         Action: ${ routerActionPrompt }`\n\t\t: '';\n\n\tconst prompt = `\nYou are an expert website designer, specializing in font selection and helping users modify their website fonts. Your primary goal is to help users customize their website fonts effectively or route their queries to appropriate assistance.\n\nHere is the current context, use this to inform your responses:\n\n<site_context>\n${ getSiteContextPrompt( context, [\n\t'siteTitle',\n\t'siteDescription',\n\t'topic',\n] ) }\n</site_context>\n\n<selected_block_context>\n${ getSelectedBlockContextPrompt( context, [ 'clientId', 'type' ] ) }\n</selected_block_context>\n\nHere is the language you should use for responses unless explicitly instructed otherwise:\n\n<language>\n${ languagePrompt }\n</language>\n\nInstructions:\n\n1. Analyze User Input:\n   ${ analysisPrompt }\n   a) Determine if font-related or not\n   b) If font-related, list specific fonts or styles mentioned\n   c) Check routing criteria\n   d) Note any component-specific changes\n   e) For non-font requests, identify if question or other request type\n   f) Determine if routing to other assistant is needed\n\n2. Handle Font-Related Requests:\n   - If specific fonts/keywords provided, immediately call show_font_picker tool\n   - If style can be inferred (e.g., \"like New York Times\"), call show_font_picker with keywords inferred from the style\n   - For vague requests (\"show me fonts\"), infer keywords from the site context\n   - Pass fonts parameter as null if not specified\n   - Pass keywords parameter as null if not specified\n\n3. Handle Non-Font-Related Requests:\n   - ${ helpAssistantPrompt }\n   - ${ getReturnToRouterPrompt() }\n\n4. Special cases:\n   - If the request is font-related but there's no specific tool to handle it, ${ helpActionPrompt }\n\n5. Examples:\n\nUser: \"I want the Roboto font\"\nAnalysis: Font-specific request\nAction: Call show_font_picker with fonts=[\"Roboto\"], keywords=null\n\nUser: \"Show me serif fonts\"\nAnalysis: Font style request\nAction: Call show_font_picker with fonts=null, keywords=[\"serif\"]\n\nUser: \"Make my site look professional\"\nAnalysis: Vague request where fonts are not specified, but there is a keyword \"professional\"\nAction: Call show_font_picker with fonts=null, keywords=[\"professional\"]\n\nUser: \"I want fonts that are easy to read\"\nAnalysis: This is a keyword based request\nAction: Call show_font_picker with fonts=null, keywords=[\"readable\", \"clear\", \"simple\"]\n\n${ routerExamples }\n\nUser: \"How do I change my theme?\"\nAnalysis: This is a question, and not related to fonts\nAction: ${ helpActionPrompt }\n\n\n6. Restrictions:\n   - Only answer questions related to fonts and website font changes.\n   - Adhere strictly to the routing rules specified above.\n   - Do not display your analysis process in the final output.\n`;\n\n\treturn prompt;\n}\n","import showLayoutPickerTool from './tools/show-layout-picker/show-layout-picker-tool.js';\nimport changeAssistantTool from '@ai/assistants/shared/change-assistant/change-assistant-tool';\nimport { ASSISTANTS } from '@ai/assistants/constants.js';\nimport { isForwardedByRouter } from '@ai/assistants/shared/prompts.js';\n\nconst layoutToolkit = {\n\tname: 'layout',\n\ttools: ( context ) => {\n\t\tconst tools = [ showLayoutPickerTool() ];\n\n\t\tif (\n\t\t\tcontext.currentHandoffArea !== 'layouts' &&\n\t\t\t! isForwardedByRouter( context )\n\t\t) {\n\t\t\ttools.push( changeAssistantTool( ASSISTANTS.LAYOUT ) );\n\t\t}\n\n\t\treturn tools;\n\t},\n};\n\nexport default layoutToolkit;\n","const createShowLayoutPickerTool = () => {\n\treturn {\n\t\tname: 'show_layout_picker',\n\t\tdescription: 'Show a site layout picker to the user.',\n\t};\n};\n\nexport default createShowLayoutPickerTool;\n","/**\n * External dependencies\n */\nimport { useState } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\nimport ItemPicker from '@components/item-picker';\n\nexport default function LayoutPicker( {\n\tconcepts: propConcepts,\n\tselectedConcept,\n\tonGenerateNewConcept,\n} ) {\n\tconst [ concepts, setConcepts ] = useState( propConcepts );\n\n\tconst handleGenerateNewConcept = async () => {\n\t\tconst updatedConcepts = await onGenerateNewConcept( concepts );\n\t\tsetConcepts( updatedConcepts );\n\t};\n\n\treturn (\n\t\t<div className=\"big-sky__dock__menu__layout-picker\">\n\t\t\t<div className=\"components-grid\">\n\t\t\t\t<ItemPicker\n\t\t\t\t\tkey=\"site-layout-picker\"\n\t\t\t\t\titems={ concepts }\n\t\t\t\t\tselectedItem={ selectedConcept }\n\t\t\t\t\tgenerateNewItem={ handleGenerateNewConcept }\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\nimport { useCallback } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport LayoutPicker from '@components/dock/menus/layout-picker';\nimport useCanvas from '@hooks/use-canvas';\nimport usePatterns from '@hooks/use-patterns';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport { store as aiStore } from '@store';\nimport { dockViews } from '@utils/constants';\n\nexport default function useShowLayoutPickerToolFunctions() {\n\tconst { getSiteMetadata, getPagePatterns } = useSiteMetadata();\n\n\tconst { zoomIn } = useCanvas();\n\tconst { composePatterns, createConceptFromCurrentCanvas, insertPatterns } =\n\t\tusePatterns();\n\n\tconst { setDockView, setLastCancelableAction, setIsToolContainerVisible } =\n\t\tuseDispatch( aiStore );\n\n\tconst composeNewConcept = useCallback(\n\t\t( concepts ) => {\n\t\t\tconst { topic, siteDescription, siteLocation } = getSiteMetadata();\n\t\t\tconst categoriesFromPageMeta = getPagePatterns();\n\t\t\tconst selectedConcept = createConceptFromCurrentCanvas();\n\t\t\tconst newConcepts = composePatterns( {\n\t\t\t\tcategories: categoriesFromPageMeta.filter(\n\t\t\t\t\t( category ) =>\n\t\t\t\t\t\tcategory.slug !== 'header' && category.slug !== 'footer'\n\t\t\t\t),\n\t\t\t\ttopic,\n\t\t\t\tsiteDescription,\n\t\t\t\tsiteLocation,\n\t\t\t\tnumberOfConcepts: 1,\n\t\t\t\tselectedConcept,\n\t\t\t} );\n\n\t\t\tconst updatedConcepts = [ ...concepts, ...newConcepts ];\n\t\t\treturn updatedConcepts;\n\t\t},\n\t\t[\n\t\t\tgetPagePatterns,\n\t\t\tcreateConceptFromCurrentCanvas,\n\t\t\tcomposePatterns,\n\t\t\tgetSiteMetadata,\n\t\t]\n\t);\n\n\tconst showSiteLayouts = useCallback(\n\t\t( {\n\t\t\tcategories = null,\n\t\t\tnumberOfConcepts = 3,\n\t\t\tcallback = () => {},\n\t\t} ) => {\n\t\t\tconst { topic, siteDescription, siteLocation } = getSiteMetadata();\n\t\t\tconst categoriesFromPageMeta = getPagePatterns();\n\t\t\tconst selectedConcept = createConceptFromCurrentCanvas();\n\t\t\tconst categoriesFromPageMetaFiltered =\n\t\t\t\tcategoriesFromPageMeta.filter(\n\t\t\t\t\t( category ) =>\n\t\t\t\t\t\tcategory.slug !== 'header' && category.slug !== 'footer'\n\t\t\t\t);\n\n\t\t\tconst newConcepts = composePatterns( {\n\t\t\t\tcategories: categories || categoriesFromPageMetaFiltered,\n\t\t\t\ttopic,\n\t\t\t\tsiteDescription,\n\t\t\t\tsiteLocation,\n\t\t\t\tnumberOfConcepts,\n\t\t\t\tselectedConcept,\n\t\t\t} );\n\n\t\t\tconst updatedConcepts = [ selectedConcept, ...newConcepts ].filter(\n\t\t\t\t( concept, index, self ) =>\n\t\t\t\t\tindex === self.findIndex( ( t ) => t.id === concept.id )\n\t\t\t);\n\n\t\t\tsetLastCancelableAction( {\n\t\t\t\taction: 'show_layout_picker',\n\t\t\t\toriginalLayout: selectedConcept,\n\t\t\t} );\n\n\t\t\tcallback(\n\t\t\t\t<LayoutPicker\n\t\t\t\t\tconcepts={ updatedConcepts }\n\t\t\t\t\tselectedConcept={ selectedConcept }\n\t\t\t\t\tkey=\"site-layout-picker\"\n\t\t\t\t\tonGenerateNewConcept={ ( concepts ) =>\n\t\t\t\t\t\tcomposeNewConcept( concepts )\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t);\n\n\t\t\treturn __( 'Which of these layouts would you like?', 'big-sky' );\n\t\t},\n\t\t[\n\t\t\tgetSiteMetadata,\n\t\t\tgetPagePatterns,\n\t\t\tcreateConceptFromCurrentCanvas,\n\t\t\tcomposePatterns,\n\t\t\tsetLastCancelableAction,\n\t\t\tcomposeNewConcept,\n\t\t]\n\t);\n\n\tconst cancelShowLayoutPicker = ( layout ) => {\n\t\tinsertPatterns( layout.patterns, null, 'replace', false );\n\t\tsetDockView( dockViews.MENUS );\n\t\tsetIsToolContainerVisible( false );\n\t\tzoomIn();\n\t};\n\n\tconst doneShowLayoutPicker = () => {\n\t\tsetDockView( dockViews.MENUS );\n\t\tsetIsToolContainerVisible( false );\n\t\tzoomIn();\n\t};\n\n\treturn {\n\t\tcancelShowLayoutPicker,\n\t\tdoneShowLayoutPicker,\n\t\tshowSiteLayouts,\n\t\tcomposeNewConcept,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { useEffect } from '@wordpress/element';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n/**\n * External dependencies\n */\nimport { useChat, useToolkits } from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport layoutToolkit from './toolkit.js';\nimport useCanvas from '@hooks/use-canvas';\nimport { store as aiStore } from '@store';\nimport useVariations from '@hooks/use-variations';\nimport useChangeAssistantTool from '@ai/assistants/shared/change-assistant/use-change-assistant-tool.js';\nimport useCreateToolCallback from '@ai/assistants/shared/use-create-tool-callback.js';\nimport useShowLayoutPickerToolFunctions from '@ai/assistants/layout/tools/show-layout-picker/use-show-layout-picker-tool.js';\nimport useSiteMetadata from '@hooks/use-site-metadata';\n\nconst useLayoutToolkit = () => {\n\tconst { createToolCallback } = useCreateToolCallback();\n\tconst { getVariationKeywords } = useVariations();\n\tconst { changeAssistant } = useChangeAssistantTool();\n\tconst { agentSay } = useChat();\n\tconst { setCallbacks, setContext } = useToolkits();\n\tconst { getSiteMetadata } = useSiteMetadata();\n\tconst { siteTitle, siteDescription, siteLocation, topic } =\n\t\tgetSiteMetadata();\n\tconst { zoomOut } = useCanvas();\n\n\tconst { getIsHandoff, currentHandoffArea, selectedBlock } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\t\t\tconst { getIsHandoff: _getIsHandoff, getCurrentHandoffArea } =\n\t\t\t\tselect( aiStore );\n\t\t\treturn {\n\t\t\t\tselectedBlock: getSelectedBlock(),\n\t\t\t\tgetIsHandoff: _getIsHandoff,\n\t\t\t\tcurrentHandoffArea: getCurrentHandoffArea(),\n\t\t\t};\n\t\t}\n\t);\n\n\tconst { showSiteLayouts } = useShowLayoutPickerToolFunctions();\n\tconst { setIsToolContainerVisible, setToolComponent, setShowThread } =\n\t\tuseDispatch( aiStore );\n\n\tuseEffect( () => {\n\t\tsetCallbacks( layoutToolkit.name, {\n\t\t\tshow_layout_picker: createToolCallback( {\n\t\t\t\tname: 'show_layout_picker',\n\t\t\t\taction: () => {\n\t\t\t\t\tagentSay(\n\t\t\t\t\t\tshowSiteLayouts( {\n\t\t\t\t\t\t\tcallback: ( component ) => {\n\t\t\t\t\t\t\t\tzoomOut();\n\t\t\t\t\t\t\t\tsetToolComponent( component );\n\t\t\t\t\t\t\t\tsetIsToolContainerVisible( true );\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t} )\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tcloseChatWhenDone: () => ! getIsHandoff(),\n\t\t\t} ),\n\t\t\tchange_assistant: createToolCallback( {\n\t\t\t\tname: 'change_assistant',\n\t\t\t\taction: ( _args ) => {\n\t\t\t\t\tsetShowThread( true );\n\t\t\t\t\tchangeAssistant( _args );\n\t\t\t\t},\n\t\t\t\tcloseChatWhenDone: () => false,\n\t\t\t} ),\n\t\t} );\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ setCallbacks ] );\n\n\tuseEffect( () => {\n\t\tconst context = {\n\t\t\tsite: {\n\t\t\t\tsiteTitle,\n\t\t\t\tsiteDescription,\n\t\t\t\tsiteLocation,\n\t\t\t\ttopic,\n\t\t\t},\n\t\t\tselectedBlock: {\n\t\t\t\tclientId: selectedBlock?.clientId,\n\t\t\t\ttype: selectedBlock?.type,\n\t\t\t\tname: selectedBlock?.name,\n\t\t\t},\n\t\t\tkeywords: getVariationKeywords( 'font' ),\n\t\t};\n\n\t\tif ( getIsHandoff() ) {\n\t\t\tcontext.currentHandoffArea = currentHandoffArea;\n\t\t}\n\n\t\tsetContext( layoutToolkit.name, context );\n\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ setContext, getIsHandoff, currentHandoffArea, selectedBlock ] );\n};\n\nexport default useLayoutToolkit;\n","import layoutAssistantPrompt from './prompt.js';\nimport layoutToolkit from './toolkit.js';\nimport { ASSISTANTS } from '../constants.js';\nimport useLayoutToolkit from './use-layout-toolkit.js';\n\nconst layoutAssistant = {\n\tid: ASSISTANTS.LAYOUT,\n\tdescription:\n\t\t'Helps with all requests related to switching the page layout.',\n\tinstructions: ( context ) => {\n\t\treturn layoutAssistantPrompt( context );\n\t},\n\ttags: [ ASSISTANTS.LAYOUT ],\n\ttoolkits: [ layoutToolkit ],\n\ttoolkitHook: useLayoutToolkit,\n\tonStart: ( invoke, clearMessages = () => {}, agentMessage = null ) => {\n\t\tif ( agentMessage ) {\n\t\t\tclearMessages();\n\t\t\tinvoke.agentSay( agentMessage );\n\t\t}\n\t},\n};\n\nexport default layoutAssistant;\n","import {\n\tanalysisPrompt,\n\tgetReturnToRouterPrompt,\n\tgetSelectedBlockContextPrompt,\n\tgetSiteContextPrompt,\n\thelpActionPrompt,\n\thelpAssistantPrompt,\n\tisForwardedByRouter,\n\tlanguagePrompt,\n\trouterActionPrompt,\n} from '../shared/prompts.js';\n\nexport default function layoutAssistantPrompt( context ) {\n\tconst routerExamples = ! isForwardedByRouter( context )\n\t\t? `User: \"Make my site more blue\"\nAnalysis: This is not related to layout and is not in the form of a question\nAction: ${ routerActionPrompt }\n\nUser: \"Add a section for a newsletter signup\"\nAnalysis: This is not related to layout and is about a specific section\nAction: ${ routerActionPrompt }`\n\t\t: '';\n\n\tconst prompt = `\nYou are an expert website designer at Automattic, specializing in layout customization and helping users modify their website layouts. Your role is to assist users with layout changes or route their queries appropriately.\n\nHere is the current context, use this to inform your responses:\n\n<site_context>\n${ getSiteContextPrompt( context, [\n\t'siteTitle',\n\t'siteDescription',\n\t'topic',\n] ) }\n</site_context>\n\n<selected_block_context>\n${ getSelectedBlockContextPrompt( context, [ 'clientId', 'type' ] ) }\n</selected_block_context>\n\nHere is the language you should use for responses unless explicitly instructed otherwise:\n\n<language>\n${ languagePrompt }\n</language>\n\nInstructions:\n\n1. Analyze User Input:\n   ${ analysisPrompt }\n   a) Determine if request is layout-related\n   b) Layout-related requests involve the page, website, or layout. Never individual sections or patterns.\n   c) Check for routing criteria\n   d) For non-layout requests, identify if it's a question\n   e) Determine if routing to other assistant is needed\n\n2. Handle Layout-Related Requests:\n   - Call show_layout_picker tool immediately.\n   - Don't respond with anything else.\n\n3. Handle Non-Layout Requests:\n   - ${ helpAssistantPrompt }\n   ${ getReturnToRouterPrompt( context ) }\n\n4. Special cases:\n   - If the request is layout-related but there's no specific tool to handle it, ${ helpActionPrompt }\n\n5. Examples:\n\nUser: \"I want a sidebar on my homepage\"\nAnalysis: Layout-related request with specific element\nAction: Call show_layout_picker tool\n\nUser: \"I don't like the layout of my site, can you help me?\"\nAnalysis: Layout-related request for the specific layout of the page\nAction: Call show_layout_picker tool\n\nUser: \"How do I change my theme?\"\nAnalysis: This is a question and is not in the form of a layout request\nAction: ${ helpActionPrompt }\n\n${ routerExamples }\n\n6. Restrictions:\n   - Only handle layout-related requests\n   - Follow routing rules strictly\n   - Don't display analysis in output\n`;\n\n\treturn prompt;\n}\n","export default function generateImageTool( {\n\tstyles = [],\n\tdefaultStyle = 'photographic',\n} ) {\n\treturn {\n\t\tname: 'generate_image',\n\t\tdescription: `Generate a new image using AI.`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tclientId: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: 'The clientId of the current selected block.',\n\t\t\t\t},\n\t\t\t\tdescription: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The description of the new image. Do not include any text about replacing the image or something similar, only what the content of the image should be. For example, if the user request is \"replace this image with a dog\", the description should be \"dog\".',\n\t\t\t\t},\n\t\t\t\tstyle: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: `The style of an AI image. If the user does not specify a style for the AI image, default to ${ defaultStyle }`,\n\t\t\t\t\tenum: styles,\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'clientId', 'description', 'style' ],\n\t\t},\n\t\tstrict: true,\n\t};\n}\n","/**\n * Internal dependencies\n */\nimport generateImageTool from './tools/generate-image/generate-image-tool.js';\nimport getStockImageTool from './tools/get-stock-image/get-stock-image-tool.js';\nimport generateSiteLogoTool from './tools/generate-site-logo/generate-site-logo-tool.js';\nimport uploadSiteLogoTool from './tools/upload-site-logo/upload-site-logo-tool.js';\nimport changeAssistantTool from '@ai/assistants/shared/change-assistant/change-assistant-tool.js';\nimport { ASSISTANTS } from '@ai/assistants/constants.js';\nimport { isForwardedByRouter } from '@ai/assistants/shared/prompts.js';\n\nconst imageToolkit = {\n\tname: 'image',\n\ttools: ( context ) => {\n\t\tconst tools = [\n\t\t\tgenerateImageTool( {\n\t\t\t\tstyles: context.images?.styles,\n\t\t\t\tdefaultStyle: context.images?.defaultStyle,\n\t\t\t} ),\n\t\t\tgetStockImageTool(),\n\t\t\tgenerateSiteLogoTool(),\n\t\t\tuploadSiteLogoTool(),\n\t\t\t...( ! isForwardedByRouter( context )\n\t\t\t\t? [ changeAssistantTool( ASSISTANTS.IMAGE ) ]\n\t\t\t\t: [] ),\n\t\t];\n\n\t\treturn tools;\n\t},\n};\n\nexport default imageToolkit;\n","export default function getStockImageTool() {\n\treturn {\n\t\tname: 'get_stock_image',\n\t\tdescription: `Get a new stock image.`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tclientId: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: 'The clientId of the current selected block.',\n\t\t\t\t},\n\t\t\t\tdescription: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The description of the new image. Do not include any text about replacing the image or something similar, only what the content of the image should be. For example, if the user request is \"replace this image with a dog\", the description should be \"dog\".',\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'clientId', 'description' ],\n\t\t},\n\t\tstrict: true,\n\t};\n}\n","export default function generateSiteLogoTool() {\n\treturn {\n\t\tname: 'generate_site_logo',\n\t\tdescription: `Generate a new site logo with AI.`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tdescription: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: 'The description of the new site logo.',\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'description' ],\n\t\t},\n\t\tstrict: true,\n\t};\n}\n","export default function uploadSiteLogoTool() {\n\treturn {\n\t\tname: 'upload_site_logo',\n\t\tdescription: 'Allow the user to upload a new site logo image.',\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch } from '@wordpress/data';\nimport { store as coreStore, useEntityRecord } from '@wordpress/core-data';\nimport { __ } from '@wordpress/i18n';\nimport { uploadMedia } from '@wordpress/media-utils';\n\n/**\n * Internal dependencies\n */\nimport useBlocks from '@hooks/use-blocks';\nimport log from '@utils/log-debug.js';\nimport { store as aiStore } from '@store/index.js';\n\nexport default function useUploadSiteLogoTool() {\n\tconst {\n\t\tscrollToFirstBlockByName,\n\t\tfindSiteLogoBlock,\n\t\tsetBlockIsProcessing,\n\t} = useBlocks();\n\tconst { setInputtedFiles, setLastCancelableAction } =\n\t\tuseDispatch( aiStore );\n\tconst { editEntityRecord } = useDispatch( coreStore );\n\n\tconst { record: siteData, editedRecord: editedSiteData } = useEntityRecord(\n\t\t'root',\n\t\t'site'\n\t);\n\n\tconst uploadSiteLogo = async ( imageFile ) => {\n\t\ttry {\n\t\t\tconst siteLogoBlock = findSiteLogoBlock();\n\t\t\tscrollToFirstBlockByName( 'core/site-logo' );\n\n\t\t\t// upload to media library\n\t\t\tawait uploadMedia( {\n\t\t\t\tfilesList: [ imageFile ],\n\t\t\t\tonError: ( { message } ) => log.error( message ),\n\t\t\t\tonFileChange: ( [ fileObj ] ) => {\n\t\t\t\t\tif ( siteLogoBlock ) {\n\t\t\t\t\t\tsetBlockIsProcessing( siteLogoBlock, true );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( fileObj?.id ) {\n\t\t\t\t\t\tconst settings = editedSiteData ?? siteData;\n\t\t\t\t\t\tsetLastCancelableAction( {\n\t\t\t\t\t\t\taction: 'upload_site_logo',\n\t\t\t\t\t\t\toriginalId: settings.site_logo,\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tsetInputtedFiles( [] );\n\n\t\t\t\t\t\teditEntityRecord( 'root', 'site', undefined, {\n\t\t\t\t\t\t\tsite_logo: fileObj.id,\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tif ( siteLogoBlock ) {\n\t\t\t\t\t\t\tsetBlockIsProcessing( siteLogoBlock, false );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t} );\n\n\t\t\tif ( siteLogoBlock ) {\n\t\t\t\treturn __( 'I have updated the site logo.', 'big-sky' );\n\t\t\t}\n\n\t\t\treturn __(\n\t\t\t\t`I have updated the site logo! However, I notice neither the header nor footer contains a site logo.\\n\\nTo change the header/footer layouts, ask me to \"**replace the header/footer section**\".`,\n\t\t\t\t'big-sky'\n\t\t\t);\n\t\t} catch ( error ) {\n\t\t\tlog.error( 'Error:', error );\n\t\t\treturn __(\n\t\t\t\t'I encountered an error while processing your request. Please try again.',\n\t\t\t\t'big-sky'\n\t\t\t);\n\t\t}\n\t};\n\n\tconst cancelUploadSiteLogo = ( lastCancelableAction ) => {\n\t\teditEntityRecord( 'root', 'site', undefined, {\n\t\t\tsite_logo: lastCancelableAction.originalId,\n\t\t} );\n\t};\n\n\treturn {\n\t\tuploadSiteLogo,\n\t\tcancelUploadSiteLogo,\n\t};\n}\n","import imageAssistantPrompt from './prompt.js';\nimport imageToolkit from './toolkit.js';\nimport { ASSISTANTS } from '../constants.js';\nimport useImageToolkit from './use-image-toolkit.js';\n\nconst imageAssistant = {\n\tid: ASSISTANTS.IMAGE,\n\tdescription:\n\t\t'Helps with all requests related to image and site logo generating and replacement.',\n\tinstructions: ( context = {} ) => {\n\t\treturn imageAssistantPrompt( context );\n\t},\n\ttags: [ ASSISTANTS.IMAGE ],\n\ttoolkits: [ imageToolkit ],\n\ttoolkitHook: useImageToolkit,\n\tonStart: ( invoke, clearMessages = () => {}, agentMessage = null ) => {\n\t\tif ( agentMessage ) {\n\t\t\tclearMessages();\n\t\t\tinvoke.agentSay( agentMessage );\n\t\t}\n\t},\n};\n\nexport default imageAssistant;\n","import {\n\tanalysisPrompt,\n\tgetReturnToRouterPrompt,\n\tgetSelectedBlockContextPrompt,\n\tgetSiteContextPrompt,\n\thelpActionPrompt,\n\thelpAssistantPrompt,\n\tisForwardedByRouter,\n\tlanguagePrompt,\n\trouterActionPrompt,\n} from '../shared/prompts.js';\n\nexport default function imageAssistantPrompt( context ) {\n\tconst routerExamples = ! isForwardedByRouter( context )\n\t\t? `User: \"Make the background of my site more blue\"\nAnalysis: This is not related to images and is not in the form of a question\nAction: ${ routerActionPrompt }\n\nUser: \"Replace this\"\nAnalysis: This could be related to images but the the selected block is not an image\nAction: ${ routerActionPrompt }`\n\t\t: '';\n\n\tconst prompt = `\nYou are an expert website designer specializing in image replacement and optimization. Your primary goal is to help users customize their website images or route queries to appropriate assistance.\n\nHere is the current context, use this to inform your responses:\n\n<site_context>\n${ getSiteContextPrompt( context, [\n\t'siteTitle',\n\t'siteDescription',\n\t'siteLocation',\n\t'topic',\n] ) }\n</site_context>\n\n<selected_block_context>\n${ getSelectedBlockContextPrompt( context, [ 'clientId', 'type' ] ) }\n</selected_block_context>\n\nHere is the language you should use for responses unless explicitly instructed otherwise:\n\n<language>\n${ languagePrompt }\n</language>\n\nInstructions:\n\n1. Analyze the user's input:\n   ${ analysisPrompt }\n   a) Is it image-related?\n   b) If image-related:\n      - Is it a logo request?\n      - For non-logo requests:\n        * Note the selected block's clientId\n        * Identify the image description, if it is not provided use the site topic\n        * Determine if AI or stock image is requested (default to AI if unspecified)\n        * For AI images: note any style preferences (use default if unspecified)\n   c) Are all required parameters for the chosen tool present?\n   d) If not image-related, explain why it needs routing to another assistant\n   e) Determine if routing to other assistant is needed\n\n   Then, consider the context:\n   f) How does the request relate to the site context?\n   g) Is the request appropriate for the type of website described?\n\n   For image requests, make a decision:\n   h) If AI vs. stock is not specified, consider which would be more appropriate based on the context and request.\n\n   List out required parameters:\n   i) For each potential tool, list the required parameters and check if they're present in the user's request.\n\n2. Handle image-related requests:\n   For logo changes:\n   - If uploading own logo: Call 'upload_site_logo', do not follow up with your own message\n   - If generating a logo: Call 'generate_site_logo' with description\n   - If unclear: Ask if they want to generate a new logo or upload their own\n\n   For other images:\n   - For AI images: Call 'generate_image' with:\n     * clientId\n     * description (content only, no meta text)\n     * style (use default if unspecified)\n   - For stock images: Call 'get_stock_image' with:\n     * clientId\n     * description (content only, no meta text)\n\n   If information is missing:\n   - No description: Ask for details\n   - No block selected (for non-logo requests): Ask user to select an image\n   - Unclear if stock or AI is wanted: Ask for preference\n\n3. Handle non-image requests:\n   - ${ helpAssistantPrompt }\n   ${ getReturnToRouterPrompt( context ) }\n\n4. Special cases:\n   - If the request is image-related but there's no specific tool to handle it, ${ helpActionPrompt }\n\n5. Examples:\n\nUser: \"I want to change my logo\"\nAnalysis: This is a logo request but unclear if user wants to upload or generate\nAction: Ask if they want to generate a new logo or upload their own\n\nUser: \"Generate an AI logo for my coffee shop\"\nAnalysis: This is a logo generation request with clear description\nAction: Call generate_site_logo tool with description \"coffee shop logo\"\n\nUser: \"Replace with an AI image of mountains\"\nAnalysis: AI image request with selected block and clear description\nAction: Call generate_image tool with clientId, \"mountains\", and default style\n\nUser: \"I need a stock photo of a beach\"\nAnalysis: Stock image request with selected block and clear description\nAction: Call get_stock_image tool with clientId and \"beach\"\n\nUser: \"How do I optimize my images?\"\nAnalysis: This is a question about images\nAction: ${ helpActionPrompt }\n\n${ routerExamples }\n\nUser: \"Split this image into two images\"\nAnalysis: This request is image related but there is no tool to handle it\nAction: ${ helpActionPrompt }\n\n6. Restrictions:\n   - Only handle image and logo-related requests\n   - If the request is image or logo-related but there is no tool to handle it, ${ helpActionPrompt }\n   - Follow routing rules strictly\n   - Never show analysis in output\n   - Immediately call appropriate tool or request necessary information\n   - Do not respond after calling the tool\n`;\n\treturn prompt;\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { useCallback, useEffect } from '@wordpress/element';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * External dependencies\n */\nimport { useChat, useToolkits } from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport imageToolkit from './toolkit.js';\nimport imageStyles from '@data/image-styles.json' assert { type: 'json' };\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport { store as aiStore } from '@store';\n\nimport useGenerateImageTool from '@ai/assistants/image/tools/generate-image/use-generate-image-tool.js';\nimport useGetStockImageTool from '@ai/assistants/image/tools/get-stock-image/use-get-stock-image-tool.js';\nimport useGenerateSiteLogoTool from '@ai/assistants/image/tools/generate-site-logo/use-generate-site-logo-tool.js';\nimport useUploadSiteLogoTool from '@ai/assistants/image/tools/upload-site-logo/use-upload-site-logo-tool.js';\nimport useCreateToolCallback from '@ai/assistants/shared/use-create-tool-callback.js';\nimport useChangeAssistantTool from '@ai/assistants/shared/change-assistant/use-change-assistant-tool.js';\nimport Notice from '@components/dock/notice';\nimport { ALLOWED_IMAGE_FILE_TYPES, isAllowedImageFile } from '@utils/images';\nimport useImageToolValidation from './use-image-tool-validation.js';\n\nexport default function useImageToolkit() {\n\tconst { validateArguments } = useImageToolValidation();\n\tconst { createToolCallback, withPendingToolCallback } =\n\t\tuseCreateToolCallback();\n\tconst { changeAssistant } = useChangeAssistantTool();\n\tconst { agentSay } = useChat();\n\tconst { setCallbacks, setContext } = useToolkits();\n\n\tconst { generateImage } = useGenerateImageTool();\n\tconst { getStockImage } = useGetStockImageTool();\n\tconst { generateSiteLogo } = useGenerateSiteLogoTool();\n\tconst { uploadSiteLogo } = useUploadSiteLogoTool();\n\tconst {\n\t\tdefaultImageStyle,\n\t\ttopic,\n\t\tsiteTitle,\n\t\tsiteDescription,\n\t\tsiteLocation,\n\t} = useSiteMetadata().getSiteMetadata();\n\n\tconst {\n\t\tselectedBlock,\n\t\tgetInputtedFiles,\n\t\tinputtedFiles,\n\t\tonInputtedFilesAction,\n\t} = useSelect( ( select ) => {\n\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\t\tconst {\n\t\t\tgetInputtedFiles: _getInputtedFiles,\n\t\t\tgetOnInputtedFilesAction,\n\t\t} = select( aiStore );\n\t\treturn {\n\t\t\tselectedBlock: getSelectedBlock(),\n\t\t\tgetInputtedFiles: _getInputtedFiles,\n\t\t\tinputtedFiles: _getInputtedFiles(),\n\t\t\tonInputtedFilesAction: getOnInputtedFilesAction(),\n\t\t};\n\t} );\n\n\tconst {\n\t\tsetShowThread,\n\t\tsetOnInputtedFilesAction,\n\t\tsetInputtedFiles,\n\t\tsetToolComponent,\n\t\tsetIsToolContainerVisible,\n\t} = useDispatch( aiStore );\n\n\tuseEffect( () => {\n\t\tsetCallbacks( imageToolkit.name, {\n\t\t\tgenerate_image: createToolCallback( {\n\t\t\t\tname: 'generate_image',\n\t\t\t\taction: async ( _args ) => {\n\t\t\t\t\tagentSay( await generateImage( _args ) );\n\t\t\t\t},\n\t\t\t\tvalidator: ( _args ) => validateArguments( _args ),\n\t\t\t\tfailValidatorAction: ( _, error ) => agentSay( error.message ),\n\t\t\t\tcloseChatWhenDone: () => true,\n\t\t\t} ),\n\t\t\tget_stock_image: createToolCallback( {\n\t\t\t\tname: 'get_stock_image',\n\t\t\t\taction: async ( _args ) => {\n\t\t\t\t\tagentSay( await getStockImage( _args ) );\n\t\t\t\t},\n\t\t\t\tvalidator: ( _args ) => validateArguments( _args ),\n\t\t\t\tfailValidatorAction: ( _, error ) => agentSay( error.message ),\n\t\t\t\tcloseChatWhenDone: () => true,\n\t\t\t} ),\n\t\t\tgenerate_site_logo: createToolCallback( {\n\t\t\t\tname: 'generate_site_logo',\n\t\t\t\taction: async ( _args ) => {\n\t\t\t\t\tagentSay( await generateSiteLogo( _args ) );\n\t\t\t\t},\n\t\t\t\tcloseChatWhenDone: () => true,\n\t\t\t} ),\n\t\t\tupload_site_logo: createToolCallback( {\n\t\t\t\tname: 'upload_site_logo',\n\t\t\t\taction: async () => {\n\t\t\t\t\tconst file = getInputtedFiles()?.[ 0 ];\n\t\t\t\t\tif ( ! file ) {\n\t\t\t\t\t\tsetOnInputtedFilesAction( {\n\t\t\t\t\t\t\taction: 'upload_site_logo',\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tsetShowThread( true );\n\t\t\t\t\t\tagentSay(\n\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\"Drag your logo into this chat box and I'll add it to your site.\",\n\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdoUploadSiteLogo();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcloseChatWhenDone: () => false,\n\t\t\t} ),\n\t\t\tchange_assistant: createToolCallback( {\n\t\t\t\tname: 'change_assistant',\n\t\t\t\taction: ( _args ) => {\n\t\t\t\t\tsetShowThread( true );\n\t\t\t\t\tchangeAssistant( _args );\n\t\t\t\t},\n\t\t\t\tcloseChatWhenDone: () => false,\n\t\t\t} ),\n\t\t} );\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ setCallbacks ] );\n\n\tuseEffect( () => {\n\t\tconst context = {\n\t\t\timages: {\n\t\t\t\tstyles: imageStyles,\n\t\t\t\tdefaultStyle: defaultImageStyle,\n\t\t\t},\n\t\t\tsite: {\n\t\t\t\tsiteTitle,\n\t\t\t\tsiteDescription,\n\t\t\t\tsiteLocation,\n\t\t\t\ttopic,\n\t\t\t},\n\t\t\tselectedBlock: {\n\t\t\t\tclientId: selectedBlock?.clientId,\n\t\t\t\ttype: selectedBlock?.type,\n\t\t\t\tname: selectedBlock?.name,\n\t\t\t},\n\t\t};\n\n\t\tif ( selectedBlock ) {\n\t\t\tcontext.selectedBlock = {\n\t\t\t\ttype: selectedBlock?.name,\n\t\t\t\tclientId: selectedBlock?.clientId,\n\t\t\t};\n\t\t}\n\n\t\tsetContext( imageToolkit.name, context );\n\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ setContext, selectedBlock ] );\n\n\tconst doUploadSiteLogo = useCallback( () => {\n\t\tconst file = getInputtedFiles()?.[ 0 ];\n\t\tconst fileName = file.name;\n\t\tif ( isAllowedImageFile( fileName ) ) {\n\t\t\tsetOnInputtedFilesAction( {} );\n\t\t\twithPendingToolCallback( async () => {\n\t\t\t\tconst result = await uploadSiteLogo( file.file );\n\t\t\t\tsetToolComponent(\n\t\t\t\t\t<Notice notice={ result } type=\"info\" delay={ -1 } />\n\t\t\t\t);\n\t\t\t\tsetIsToolContainerVisible( true );\n\t\t\t} )();\n\t\t} else {\n\t\t\tsetOnInputtedFilesAction( {\n\t\t\t\taction: 'upload_site_logo',\n\t\t\t} );\n\t\t\tsetInputtedFiles( [] );\n\t\t\tagentSay(\n\t\t\t\tsprintf(\n\t\t\t\t\t// Translators: %s is a comma-separated list of allowed file types.\n\t\t\t\t\t__(\n\t\t\t\t\t\t'Please provide a valid image file. Allowed file types: %s',\n\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t),\n\t\t\t\t\tALLOWED_IMAGE_FILE_TYPES.join( ', ' )\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t}, [\n\t\tgetInputtedFiles,\n\t\tsetOnInputtedFilesAction,\n\t\twithPendingToolCallback,\n\t\tuploadSiteLogo,\n\t\tsetToolComponent,\n\t\tsetIsToolContainerVisible,\n\t\tagentSay,\n\t\tsetInputtedFiles,\n\t] );\n\n\tuseEffect( () => {\n\t\tif ( ! inputtedFiles?.length ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( onInputtedFilesAction?.action ) {\n\t\t\tswitch ( onInputtedFilesAction.action ) {\n\t\t\t\tcase 'upload_site_logo':\n\t\t\t\t\tdoUploadSiteLogo();\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}, [ inputtedFiles, onInputtedFilesAction, doUploadSiteLogo ] );\n}\n","/**\n * WordPress dependencies\n */\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useSelect } from '@wordpress/data';\n\nexport default function useImageToolValidation() {\n\tconst { getBlock } = useSelect( blockEditorStore );\n\n\tconst validateArguments = ( args ) => {\n\t\tif ( ! args?.clientId ) {\n\t\t\tthrow new Error( 'Please select an image block and try again.' );\n\t\t}\n\n\t\t// check if the block is an image\n\t\tconst block = getBlock( args.clientId );\n\t\tif ( block?.name !== 'core/image' ) {\n\t\t\tthrow new Error(\n\t\t\t\t'The selected block is not an image. Please select an image and try again.'\n\t\t\t);\n\t\t}\n\t\treturn true;\n\t};\n\n\treturn {\n\t\tvalidateArguments,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport useImages from '@hooks/use-images.js';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport { store as aiStore } from '@store/index.js';\nimport useBlocks from '@hooks/use-blocks.js';\n\nexport default function useGenerateImageTool() {\n\tconst { generateImageWithAI } = useImages();\n\tconst { setSiteMetadata } = useSiteMetadata();\n\tconst { getBlock } = useSelect( blockEditorStore );\n\tconst { setBlockBeforeChanges } = useDispatch( aiStore );\n\tconst { setBlockIsProcessing } = useBlocks();\n\n\tconst generateImage = async ( parameters ) => {\n\t\tconst { clientId, description, style } = parameters;\n\n\t\tconst imageBlock = getBlock( clientId );\n\t\tsetBlockBeforeChanges( imageBlock );\n\t\tsetSiteMetadata( {\n\t\t\tdefaultImageStyle: style,\n\t\t} );\n\n\t\tsetBlockIsProcessing( imageBlock, true );\n\n\t\tconst generatedImage = await generateImageWithAI( {\n\t\t\tdescription,\n\t\t\tstyle,\n\t\t\tblock: imageBlock,\n\t\t} );\n\n\t\tsetBlockIsProcessing( imageBlock, false );\n\n\t\treturn generatedImage;\n\t};\n\n\treturn { generateImage };\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport useImages from '@hooks/use-images.js';\nimport { store as aiStore } from '@store/index.js';\nimport useBlocks from '@hooks/use-blocks.js';\n\nexport default function useGetStockImageTool() {\n\tconst { getNewStockImage } = useImages();\n\tconst { getBlock } = useSelect( blockEditorStore );\n\tconst { setBlockBeforeChanges } = useDispatch( aiStore );\n\tconst { setBlockIsProcessing } = useBlocks();\n\n\tconst getStockImage = async ( parameters ) => {\n\t\tconst { clientId, description } = parameters;\n\n\t\tconst imageBlock = getBlock( clientId );\n\t\tsetBlockBeforeChanges( imageBlock );\n\t\tsetBlockIsProcessing( imageBlock, true );\n\n\t\tconst stockImage = await getNewStockImage( {\n\t\t\ttopic: description,\n\t\t\tblock: imageBlock,\n\t\t} );\n\n\t\tsetBlockIsProcessing( imageBlock, false );\n\n\t\treturn stockImage;\n\t};\n\n\treturn { getStockImage };\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport useImages from '@hooks/use-images.js';\nimport useBlocks from '@hooks/use-blocks.js';\nimport { store as aiStore } from '@store';\n\nexport default function useGenerateSiteLogoTool() {\n\tconst { generateLogoWithAI } = useImages();\n\tconst { getBlock } = useSelect( blockEditorStore );\n\tconst { setBlockIsProcessing, findSiteLogoBlock } = useBlocks();\n\tconst { setBlockBeforeChanges } = useDispatch( aiStore );\n\n\tconst generateSiteLogo = async ( description ) => {\n\t\t// Find the core/site-logo block\n\t\tconst siteLogoBlock = findSiteLogoBlock();\n\n\t\tif ( ! siteLogoBlock ) {\n\t\t\treturn {\n\t\t\t\terror: 'No site logo block found',\n\t\t\t};\n\t\t}\n\n\t\tsetBlockBeforeChanges( siteLogoBlock );\n\t\tsetBlockIsProcessing( getBlock( siteLogoBlock.clientId ), true );\n\n\t\tconst logo = await generateLogoWithAI( {\n\t\t\tdescription,\n\t\t\tblock: siteLogoBlock,\n\t\t} );\n\n\t\tsetBlockIsProcessing( getBlock( siteLogoBlock.clientId ), false );\n\n\t\treturn logo;\n\t};\n\n\treturn { generateSiteLogo };\n}\n","export default function addPageTool( categories = [] ) {\n\tconst pageGuidance = {\n\t\tabout: [ 'intro', 'about', 'contact' ],\n\t\tcontact: [ 'contact', 'newsletter' ],\n\t\tevents: [ 'intro', 'events', 'newsletter' ],\n\t\tmenu: [ 'about', 'menu' ],\n\t\tpricing: [ 'intro', 'pricing', 'testimonials' ],\n\t\tgallery: [ 'about', 'gallery' ],\n\t\tblog: [ 'intro', 'posts', 'about' ],\n\t\tservices: [ 'about', 'services' ],\n\t\tother: [ 'intro', 'about' ],\n\t};\n\n\treturn {\n\t\tname: 'add_page',\n\t\tdescription: `Add a new page based on the user's description.\n\t\t\tCategories define the type of content blocks that will be used for page layout.\n\t\t\tDo not use this tool if the user requests a new section or pattern.\n\t\t\tPlease refer to the following guidance for the categories to choose for the type of page:\n\t\t\t${ JSON.stringify( pageGuidance ) }`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\ttitle: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'The title of the page that will be displayed to the users.',\n\t\t\t\t},\n\t\t\t\tcategories: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\tdescription: `An ordered list of page sections. The tool will use these categories to generate the structure of the page.`,\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: 'object',\n\t\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t\t\trequired: [ 'slug', 'reason' ],\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tslug: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'The slug identifying the specific category of the page section.',\n\t\t\t\t\t\t\t\tenum: categories,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\treason: {\n\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t'A brief explanation for choosing this category. This helps guide content creation by clarifying what type of content or information would fit well in this section based on its purpose.',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'title', 'categories' ],\n\t\t},\n\t\tstrict: true,\n\t};\n}\n","export default function navigateToPageTool( pages = [] ) {\n\tconst homepage = pages.find( ( page ) => page.isHomePage );\n\tconst currentPage = pages.find( ( page ) => page.isCurrentPage );\n\n\treturn {\n\t\tname: 'navigate_to_page',\n\t\tdescription: `Navigate to and edit a page based on user input.\n\t\tHome page: \"${ homepage?.title }\" (ID: ${ homepage?.id })\n\t\tCurrent page: \"${ currentPage?.title }\" (ID: ${ currentPage?.id })\n\t\tIf already on requested page, respond: \"You're already on the page.\"\n\t\tFor unclear requests or non-existent pages, ask for clarification.\n\t\tIf page doesn't exist, offer to create a new one.\n\t\tDo not return any content in your response.`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tpage: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: 'The title:postId of the page.',\n\t\t\t\t\tenum: [\n\t\t\t\t\t\t...pages.map(\n\t\t\t\t\t\t\t( page ) => `${ page.title }:${ page.id }`\n\t\t\t\t\t\t),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tgoHome: {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'Whether the user wants to navigate to the homepage in order to edit it.',\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'page', 'goHome' ],\n\t\t},\n\t\tadditionalProperties: false,\n\t\tstrict: true,\n\t};\n}\n","import addPageTool from './tools/add-page/add-page-tool.js';\nimport navigateToPageTool from './tools/navigate-to-page/navigate-to-page-tool.js';\nimport changeAssistantTool from '@ai/assistants/shared/change-assistant/change-assistant-tool';\nimport { ASSISTANTS } from '@ai/assistants/constants.js';\nimport { isForwardedByRouter } from '@ai/assistants/shared/prompts.js';\n\nconst pageToolkit = {\n\tname: 'page',\n\ttools: ( context ) => {\n\t\tconst tools = [\n\t\t\taddPageTool( context.categories ),\n\t\t\tnavigateToPageTool( context.pages ),\n\t\t\t...( ! isForwardedByRouter( context )\n\t\t\t\t? [ changeAssistantTool( ASSISTANTS.PAGE ) ]\n\t\t\t\t: [] ),\n\t\t];\n\n\t\treturn tools;\n\t},\n};\n\nexport default pageToolkit;\n","import pageAssistantPrompt from './prompt.js';\nimport pageToolkit from './toolkit.js';\nimport { ASSISTANTS } from '../constants.js';\nimport usePageToolkit from './use-page-toolkit.js';\n\nconst pageAssistant = {\n\tid: ASSISTANTS.PAGE,\n\tdescription:\n\t\t'Helps with all requests related to adding a new page, and navigating between pages.',\n\tinstructions: ( context = {} ) => {\n\t\treturn pageAssistantPrompt( context );\n\t},\n\ttags: [ ASSISTANTS.PAGE ],\n\ttoolkits: [ pageToolkit ],\n\ttoolkitHook: usePageToolkit,\n\tonStart: ( invoke, clearMessages = () => {}, agentMessage = null ) => {\n\t\tif ( agentMessage ) {\n\t\t\tclearMessages();\n\t\t\tinvoke.agentSay( agentMessage );\n\t\t}\n\t},\n};\n\nexport default pageAssistant;\n","import {\n\tanalysisPrompt,\n\tgetReturnToRouterPrompt,\n\tgetSelectedBlockContextPrompt,\n\tgetSiteContextPrompt,\n\thelpActionPrompt,\n\thelpAssistantPrompt,\n\tisForwardedByRouter,\n\tlanguagePrompt,\n\trouterActionPrompt,\n} from '../shared/prompts.js';\n\nexport default function pageAssistantPrompt( context ) {\n\tconst pagesList = context.pages\n\t\t? context.pages.map( ( page ) => ` - ${ page.title }` ).join( '\\n' )\n\t\t: 'No Pages';\n\n\tconst routerExamples = ! isForwardedByRouter( context )\n\t\t? `User: \"Make the font of my site more readable\"\nAnalysis: This is not related to page management and is not in the form of a question\nAction: ${ routerActionPrompt }\n\nUser: \"Add an about section\"\nAnalysis: This is not a page request, it's about adding an individual section or pattern to the page.\nAction: ${ routerActionPrompt }\n\nUser: \"Insert a Gallery\"\nAnalysis: This is not a page request, it's about inserting an individual section or pattern to the page.\nAction: ${ routerActionPrompt }`\n\t\t: '';\n\n\tconst prompt = `\nYou are an expert website page manager, specializing in page creation, navigation, and structure optimization. Your primary goal is to help users effectively manage their website pages or route their queries to appropriate assistance.\n\nHere is the current context, use this to inform your responses:\n\n<site_context>\n${ getSiteContextPrompt( context, [\n\t'siteTitle',\n\t'siteDescription',\n\t'topic',\n] ) }\n</site_context>\n\n<selected_block_context>\n${ getSelectedBlockContextPrompt( context, [ 'clientId', 'type' ] ) }\n</selected_block_context>\n\nHere is a list of the pages that exist on this site:\n\n<site_pages>\n${ pagesList }\n</site_pages>\n\nHere is the language you should use for responses unless explicitly instructed otherwise:\n\n<language>\n${ languagePrompt }\n</language>\n\nInstructions:\n\n1. Analyze the user's input:\n   ${ analysisPrompt }\n   a) List out each relevant piece of information from the user's request.\n   b) Determine if the request is page-related or not.\n   c) If page-related:\n      - Is it a creation or navigation request?\n      - Identify the page type and required sections based on pageGuidance.\n      - List the specific sections that would be included in this page type.\n   d) If not page-related:\n      - Is it a question or another type of request?\n      - Categorize the type of assistance needed (e.g., general help, technical support, content creation).\n   e) List potential tool calls that might be appropriate for this request:\n      - For each potential tool call, list out the required parameters.\n      - Note whether each required parameter is present in the user's input or needs to be inferred/requested.\n   f) If any aspect of the request is ambiguous, list potential clarification questions you might need to ask the user.\n   g) Determine if routing to other assistant is needed\n\n2. Handle requests based on your analysis:\n\n   For page-related requests:\n   - If it's a new page request, call the add_page tool with the appropriate title and categories.\n   - For navigation requests, call the navigate_to_page tool.\n   - Use pageGuidance to determine required sections for new pages.\n   - If the page type is unclear, ask the user for clarification.\n   - If a requested page doesn't exist, offer to create it.\n\n   For non-page-related requests (including pattern/section-related requests):\n   - ${ helpAssistantPrompt }\n   ${ getReturnToRouterPrompt( context ) }\n\n3. Special cases:\n   - If the request is page-related but there's no specific tool to handle it, ${ helpActionPrompt }\n\n4. Examples:\n\nUser: \"Create an About page\"\nAnalysis: Page creation request for About type\nAction: Call add_page with categories from pageGuidance.about\n\nUser: \"Take me to the Contact page\"\nAnalysis: Navigation request\nAction: Call navigate_to_page for Contact page\n\nUser: \"How do I install the WooCommerce plugin?\"\nAnalysis: This is not related to page management and is in the form of a question\nAction: ${ helpActionPrompt }\n\n${ routerExamples }\n\n5. Restrictions:\n   - Only handle page creation and navigation\n   - Follow pageGuidance structure strictly\n   - Don't create duplicate pages\n   - Don't display analysis in output\n\nAlways call appropriate tools immediately or request clarification based on analysis.\n`;\n\n\treturn prompt;\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { useEffect } from '@wordpress/element';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * External dependencies\n */\nimport { useChat, useToolkits } from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport pageToolkit from './toolkit.js';\nimport { store as aiStore } from '@store';\nimport useChangeAssistantTool from '@ai/assistants/shared/change-assistant/use-change-assistant-tool.js';\nimport useCreateToolCallback from '@ai/assistants/shared/use-create-tool-callback.js';\nimport useAddPageTool from '@ai/assistants/page/tools/add-page/use-add-page-tool.js';\nimport useNavigateToPageTool from '@ai/assistants/page/tools/navigate-to-page/use-navigate-to-page-tool.js';\nimport usePages from '@hooks/use-pages.js';\nimport { animationTiming, dockViews } from '@utils/constants';\nimport { ChatSuggestions } from '@ai/assistants/shared/make-suggestions/index.js';\nimport setDelay from '@utils/set-delay.js';\nimport patternCategories from '@data/pattern-categories.js';\nimport useSiteMetadata from '@hooks/use-site-metadata.js';\n\nconst usePageToolkit = () => {\n\tconst { createToolCallback } = useCreateToolCallback();\n\tconst { changeAssistant } = useChangeAssistantTool();\n\tconst { agentSay } = useChat();\n\tconst { setCallbacks, setContext } = useToolkits();\n\tconst { saveAndGoToPage } = usePages();\n\tconst { addPage } = useAddPageTool();\n\tconst { navigateToPage } = useNavigateToPageTool();\n\tconst { getPages } = usePages();\n\tconst { getSiteMetadata } = useSiteMetadata();\n\tconst { siteTitle, siteDescription, siteLocation, topic } =\n\t\tgetSiteMetadata();\n\n\tconst { setShowThread, setChatComponents, setDockView, setNewPageId } =\n\t\tuseDispatch( aiStore );\n\n\tconst { selectedBlock } = useSelect( ( select ) => {\n\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\t\treturn {\n\t\t\tselectedBlock: getSelectedBlock(),\n\t\t};\n\t} );\n\n\t// Register the toolkit's callbacks\n\tuseEffect( () => {\n\t\tsetCallbacks( pageToolkit.name, {\n\t\t\tadd_page: createToolCallback( {\n\t\t\t\tname: 'add_page',\n\t\t\t\taction: async ( _args ) => {\n\t\t\t\t\tagentSay(\n\t\t\t\t\t\tsprintf(\n\t\t\t\t\t\t\t// Translators: %s is the page title.\n\t\t\t\t\t\t\t__( 'Generating the %s page…', 'big-sky' ),\n\t\t\t\t\t\t\t_args.title\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t\tconst { title, categories, pageId } =\n\t\t\t\t\t\tawait addPage( _args );\n\t\t\t\t\tconst categorySlugs = categories.map(\n\t\t\t\t\t\t( category ) => category.slug\n\t\t\t\t\t);\n\t\t\t\t\tagentSay(\n\t\t\t\t\t\tsprintf(\n\t\t\t\t\t\t\t/* translators: %1$s: page title, %2$s: list of category slugs */\n\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t'A new page titled \"%1$s\" has been generated with \"%2$s\" sections.',\n\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\ttitle,\n\t\t\t\t\t\t\tcategorySlugs.join( ', ' )\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t\tconst suggestions = {\n\t\t\t\t\t\tactions: [ __( 'Save and take me there', 'big-sky' ) ],\n\t\t\t\t\t};\n\t\t\t\t\tsetChatComponents( [\n\t\t\t\t\t\t<ChatSuggestions\n\t\t\t\t\t\t\tkey=\"suggestions\"\n\t\t\t\t\t\t\targs={ suggestions }\n\t\t\t\t\t\t\trespond={ async () => {\n\t\t\t\t\t\t\t\tsaveAndGoToPage( pageId );\n\t\t\t\t\t\t\t\tsetDockView( dockViews.MENUS );\n\t\t\t\t\t\t\t\tsetChatComponents( [] );\n\t\t\t\t\t\t\t\tsetNewPageId( pageId );\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t/>,\n\t\t\t\t\t] );\n\t\t\t\t},\n\t\t\t\tcloseChatWhenDone: () => false,\n\t\t\t} ),\n\t\t\tnavigate_to_page: createToolCallback( {\n\t\t\t\tname: 'navigate_to_page',\n\t\t\t\taction: async ( _args ) => {\n\t\t\t\t\tconst { pageTitle, postId, goHome } =\n\t\t\t\t\t\tawait navigateToPage( _args );\n\t\t\t\t\tagentSay(\n\t\t\t\t\t\tsprintf(\n\t\t\t\t\t\t\t/* translators: %s: page title */\n\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t'Found the %s page. Taking you there…',\n\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tpageTitle\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t\tawait setDelay(\n\t\t\t\t\t\tanimationTiming.assistantMessageThinkingTime\n\t\t\t\t\t);\n\t\t\t\t\tawait saveAndGoToPage( postId, goHome );\n\t\t\t\t\tsetDockView( dockViews.MENUS );\n\t\t\t\t},\n\t\t\t\tcloseChatWhenDone: () => false,\n\t\t\t} ),\n\t\t\tchange_assistant: createToolCallback( {\n\t\t\t\tname: 'change_assistant',\n\t\t\t\taction: ( _args ) => {\n\t\t\t\t\tsetShowThread( true );\n\t\t\t\t\tchangeAssistant( _args );\n\t\t\t\t},\n\t\t\t\tcloseChatWhenDone: () => false,\n\t\t\t} ),\n\t\t} );\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ setCallbacks ] );\n\n\tuseEffect( () => {\n\t\tconst context = {\n\t\t\tsite: {\n\t\t\t\tsiteTitle,\n\t\t\t\tsiteDescription,\n\t\t\t\tsiteLocation,\n\t\t\t\ttopic,\n\t\t\t},\n\t\t\tselectedBlock: {\n\t\t\t\tclientId: selectedBlock?.clientId,\n\t\t\t\ttype: selectedBlock?.type,\n\t\t\t\tname: selectedBlock?.name,\n\t\t\t},\n\t\t\tcategories: patternCategories.map( ( category ) => category.slug ),\n\t\t\tpages: getPages(),\n\t\t};\n\n\t\tsetContext( pageToolkit.name, context );\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ getPages, setContext, selectedBlock ] );\n};\n\nexport default usePageToolkit;\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { useCallback } from '@wordpress/element';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport usePages from '@hooks/use-pages';\nimport usePatterns from '@hooks/use-patterns';\nimport useSiteMetadata from '@hooks/use-site-metadata';\n\nexport default function useAddPageTool() {\n\tconst { getSelectedBlock } = useSelect( blockEditorStore );\n\n\tconst { updateBlockAttributes } = useDispatch( blockEditorStore );\n\tconst { createPage } = usePages();\n\tconst { syncSiteMetadataPatterns } = usePatterns();\n\tconst { getSiteMetadata } = useSiteMetadata();\n\n\tconst addPage = useCallback(\n\t\tasync ( parameters ) => {\n\t\t\tconst { topic, siteDescription, siteLocation } = getSiteMetadata();\n\n\t\t\tconst selectedBlock = getSelectedBlock();\n\t\t\tconst isLinkBlock = [ 'core/button' ].includes(\n\t\t\t\tselectedBlock?.name\n\t\t\t);\n\t\t\tconst { title, categories } = parameters;\n\n\t\t\tconst { newPage, rootBlocks } = await createPage(\n\t\t\t\ttitle,\n\t\t\t\tcategories,\n\t\t\t\ttopic,\n\t\t\t\tsiteDescription,\n\t\t\t\tsiteLocation\n\t\t\t);\n\t\t\tsyncSiteMetadataPatterns( {\n\t\t\t\tids: [ newPage.id ],\n\t\t\t\tblocks: [ rootBlocks ],\n\t\t\t\tpersist: true,\n\t\t\t} );\n\n\t\t\tif ( isLinkBlock ) {\n\t\t\t\tupdateBlockAttributes( selectedBlock.clientId, {\n\t\t\t\t\turl: `/?page_id=${ newPage.id }`,\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\treturn { title, categories, pageId: newPage.id };\n\t\t},\n\t\t[\n\t\t\tcreatePage,\n\t\t\tgetSelectedBlock,\n\t\t\tgetSiteMetadata,\n\t\t\tsyncSiteMetadataPatterns,\n\t\t\tupdateBlockAttributes,\n\t\t]\n\t);\n\n\treturn { addPage };\n}\n","export default function useNavigateToPageTool() {\n\tconst navigateToPage = async ( parameters ) => {\n\t\tconst { page, goHome } = parameters;\n\t\tconst pageTitle = page.split( ':' )[ 0 ];\n\t\tconst postId = parseInt( page.split( ':' )[ 1 ] );\n\n\t\treturn { pageTitle, postId, goHome };\n\t};\n\n\treturn {\n\t\tnavigateToPage,\n\t};\n}\n","import { __ } from '@wordpress/i18n';\n\nconst getMDLink = ( text, url ) => {\n\treturn `[${ text }](${ url })`;\n};\n/**\n * Answers to questions specific to Big Sky+editor interactions\n */\nexport const answers = [\n\t{\n\t\tslug: [ 'what-can-i-do' ],\n\t\tdescription:\n\t\t\t'An overview of all available customization and editing features for the site.',\n\t\tanswer: `**${ __(\n\t\t\t\"Here's a list of things I can help you with:\",\n\t\t\t'big-sky'\n\t\t) }**\\n- ${ __( 'Updating text', 'big-sky' ) }\\n- ${ __(\n\t\t\t'Updating an image or logo',\n\t\t\t'big-sky'\n\t\t) }\\n- ${ __( 'Changing your site colors', 'big-sky' ) }\\n- ${ __(\n\t\t\t'Changing your site fonts',\n\t\t\t'big-sky'\n\t\t) }\\n- ${ __( 'Changing your site layout', 'big-sky' ) }\\n- ${ __(\n\t\t\t'Adding or replacing a section',\n\t\t\t'big-sky'\n\t\t) }\\n- ${ __( 'Adding a new page', 'big-sky' ) }\\n- ${ __(\n\t\t\t'Adding or updating a social link',\n\t\t\t'big-sky'\n\t\t) }\\n- ${ __( 'Updating your address', 'big-sky' ) }\\n\\n ${ __(\n\t\t\t'Also feel free to click around the editor and see the services I can provide!',\n\t\t\t'big-sky'\n\t\t) }`,\n\t},\n\t{\n\t\tslug: [ 'update-address' ],\n\t\tdescription:\n\t\t\t'Instructions for updating the site address and associated map locations.',\n\t\tanswer: `**${ __( 'To update your address:', 'big-sky' ) }**\\n1. ${ __(\n\t\t\t'Ask me to \"Update my address to {address}\"',\n\t\t\t'big-sky'\n\t\t) }\\n2. ${ __(\n\t\t\t\"I'll update the address on your site and any maps that use it\",\n\t\t\t'big-sky'\n\t\t) }`,\n\t},\n\t{\n\t\tslug: [ 'add-social-link' ],\n\t\tdescription:\n\t\t\t'Guidance on adding new social media links to the site header or footer.',\n\t\tanswer: `**${ __(\n\t\t\t\"If you'd like me to add a social link to your site:\",\n\t\t\t'big-sky'\n\t\t) }**\\n1. ${ __(\n\t\t\t'Ask me to \"Add a social link for my {social network url}\"',\n\t\t\t'big-sky'\n\t\t) }\\n2. ${ __(\n\t\t\t\"I'll add the new social link to the header and/or footer of your site\",\n\t\t\t'big-sky'\n\t\t) }\\n\\n**${ __(\n\t\t\t\"If you'd like to do this manually:\",\n\t\t\t'big-sky'\n\t\t) }**\\n1. ${ __(\n\t\t\t'Click on the social links block in the editor',\n\t\t\t'big-sky'\n\t\t) }\\n2. ${ __( 'Click the \"+\" button', 'big-sky' ) }\\n3. ${ __(\n\t\t\t'Select or browse for your desired social network',\n\t\t\t'big-sky'\n\t\t) }\\n4. ${ __(\n\t\t\t'Click on the added social link and enter your URL',\n\t\t\t'big-sky'\n\t\t) }`,\n\t},\n\t{\n\t\tslug: [ 'update-social-link' ],\n\t\tdescription:\n\t\t\t'Steps for updating existing social media links in the site header or footer.',\n\t\tanswer: `**${ __(\n\t\t\t\"If you'd like me to update a social link on your site:\",\n\t\t\t'big-sky'\n\t\t) }**\\n1. ${ __(\n\t\t\t'Ask me to \"Update the {social network} social link to {social network url}\"',\n\t\t\t'big-sky'\n\t\t) }\\n2. ${ __(\n\t\t\t\"I'll update the corresponding social links in the header and/or footer of your site\",\n\t\t\t'big-sky'\n\t\t) }\\n\\n**${ __(\n\t\t\t\"If you'd like to do this manually:\",\n\t\t\t'big-sky'\n\t\t) }**\\n1. ${ __(\n\t\t\t'Click on the social link you want to update in the editor',\n\t\t\t'big-sky'\n\t\t) }\\n2. ${ __( 'Enter your URL', 'big-sky' ) }`,\n\t},\n\t{\n\t\tslug: [ 'color' ],\n\t\tdescription:\n\t\t\t'Instructions for customizing the site color scheme and palette.',\n\t\tanswer: `**${ __(\n\t\t\t\"If you'd like me to help you update your site colors:\",\n\t\t\t'big-sky'\n\t\t) }**\\n1. ${ __(\n\t\t\t'Ask me to \"Change my site colors\"',\n\t\t\t'big-sky'\n\t\t) }\\n2. ${ __(\n\t\t\t'Provide me with a list of specific colors you\\'d like to use, or a type of color scheme you\\'d like to use (e.g. \"pastel\", \"vibrant\", \"muted\", etc.)',\n\t\t\t'big-sky'\n\t\t) }\\n3. ${ __(\n\t\t\t\"I'll provide you a list of color palettes to choose from\",\n\t\t\t'big-sky'\n\t\t) }\\n\\n**${ __(\n\t\t\t\"If you'd like to do this manually:\",\n\t\t\t'big-sky'\n\t\t) }**\\n1. ${ __(\n\t\t\t'Click on the \"Styles\" button in the top toolbar',\n\t\t\t'big-sky'\n\t\t) }\\n2. ${ __( 'Click on \"Browse styles\"', 'big-sky' ) }\\n3. ${ __(\n\t\t\t'Select from one of the predefined color palettes',\n\t\t\t'big-sky'\n\t\t) }`,\n\t},\n\t{\n\t\tslug: [ 'contact-form' ],\n\t\tdescription:\n\t\t\t'Help with modifying contact form fields and requirements.',\n\t\tanswer: `**${ __(\n\t\t\t'Here are some examples you can give me to update the contact form on your site:',\n\t\t\t'big-sky'\n\t\t) }**\\n- ${ __( 'add a phone number field', 'big-sky' ) }\\n- ${ __(\n\t\t\t'make the message field required',\n\t\t\t'big-sky'\n\t\t) }\\n- ${ __( 'remove the email field', 'big-sky' ) }`,\n\t},\n\t{\n\t\tslug: [ 'font' ],\n\t\tdescription:\n\t\t\t'Guidance for updating and customizing site typography scheme and font choices.',\n\t\tanswer: `**${ __(\n\t\t\t\"If you'd like me to help you update your site fonts:\",\n\t\t\t'big-sky'\n\t\t) }**\\n1. ${ __(\n\t\t\t'Ask me to \"Change my site fonts\"',\n\t\t\t'big-sky'\n\t\t) }\\n2. ${ __(\n\t\t\t'Provide me with a list of specific fonts you\\'d like to use, or a type of font scheme you\\'d like to use (e.g. \"serif\", \"sans-serif\", \"modern\", etc.)',\n\t\t\t'big-sky'\n\t\t) }\\n3. ${ __(\n\t\t\t\"I'll provide you a list of font sets to choose from\",\n\t\t\t'big-sky'\n\t\t) }\\n\\n**${ __(\n\t\t\t\"If you'd like to do this manually:\",\n\t\t\t'big-sky'\n\t\t) }**\\n1. ${ __(\n\t\t\t'Click on the \"Styles\" button in the top toolbar',\n\t\t\t'big-sky'\n\t\t) }\\n2. ${ __( 'Click on \"Browse styles\"', 'big-sky' ) }\\n3. ${ __(\n\t\t\t'Select from one of the predefined font sets',\n\t\t\t'big-sky'\n\t\t) }`,\n\t},\n\t{\n\t\tslug: [ 'image' ],\n\t\tdescription:\n\t\t\t'Steps for updating or replacing and image or images using AI generation or manual uploads.',\n\t\tanswer: `**${ __(\n\t\t\t\"If you'd like me to help you update an image:\",\n\t\t\t'big-sky'\n\t\t) }**\\n1. ${ __(\n\t\t\t'Select an image in the editor',\n\t\t\t'big-sky'\n\t\t) }\\n2. ${ __( 'Click \"Regenerate\"', 'big-sky' ) }\\n3. ${ __(\n\t\t\t'Ask me to \"Generate an image using AI\" or \"Find an image from stock\"',\n\t\t\t'big-sky'\n\t\t) }\\n\\n**${ __(\n\t\t\t\"If you'd like to do this manually:\",\n\t\t\t'big-sky'\n\t\t) }**\\n- ${ __(\n\t\t\t'Drag any image on top of one in the editor to replace it',\n\t\t\t'big-sky'\n\t\t) }\\n- ${ __(\n\t\t\t'Select an image and click \"Replace\" in the top toolbar',\n\t\t\t'big-sky'\n\t\t) }`,\n\t},\n\t{\n\t\tslug: [ 'logo' ],\n\t\tdescription:\n\t\t\t'Instructions for updating the site logo using custom uploads or AI generation.',\n\t\tanswer: `**${ __(\n\t\t\t'If you already have a logo image you want to use:',\n\t\t\t'big-sky'\n\t\t) }**\\n1. ${ __( 'Ask me to \"update the logo\"', 'big-sky' ) }\\n2. ${ __(\n\t\t\t\"Drop your logo image into the chat box and I'll do the rest!\",\n\t\t\t'big-sky'\n\t\t) }\\n\\n**${ __(\n\t\t\t'If you want me to generate a new logo for you:',\n\t\t\t'big-sky'\n\t\t) }**\\n1. ${ __(\n\t\t\t'Select the logo image in the editor',\n\t\t\t'big-sky'\n\t\t) }\\n2. ${ __( 'Click \"Regenerate\"', 'big-sky' ) }\\n3. ${ __(\n\t\t\t'Click \"Make a logo using AI\"',\n\t\t\t'big-sky'\n\t\t) }`,\n\t},\n\t{\n\t\tslug: [ 'new-page-design' ],\n\t\tdescription:\n\t\t\t'Intructions about new page designs, eg. \"how do I see alternative page designs?\"',\n\t\tanswer: `**${ __(\n\t\t\t'To update your site layout:',\n\t\t\t'big-sky'\n\t\t) }**\\n1. ${ __(\n\t\t\t'Ask me to \"Change my site layout\"',\n\t\t\t'big-sky'\n\t\t) }\\n2. ${ __(\n\t\t\t\"I'll provide you with a list of layouts to choose from\",\n\t\t\t'big-sky'\n\t\t) }\\n3. ${ __(\n\t\t\t'To generate a new layout, click on the last empty layout in the list',\n\t\t\t'big-sky'\n\t\t) }`,\n\t},\n\t{\n\t\tslug: [ 'dimensions' ],\n\t\tdescription:\n\t\t\t'Intructions about changing the dimensions of a block using padding, margins and spacing\"',\n\t\tanswer: `${ __(\n\t\t\t\"I can't help with adjusting spacing yet, but you can adjust this yourself:\",\n\t\t\t'big-sky'\n\t\t) }\\n\\n ${ getMDLink(\n\t\t\t__( 'Learn about editing block spacing', 'big-sky' ),\n\t\t\t'https://wordpress.com/support/block-dimensions-settings/'\n\t\t) }`,\n\t},\n\t{\n\t\tslug: [ 'edit-text' ],\n\t\tdescription:\n\t\t\t'Instructions for modifying text content and bold and italic styling.',\n\t\tanswer: `**${ __(\n\t\t\t'To update text on your site:',\n\t\t\t'big-sky'\n\t\t) }**\\n1. ${ __(\n\t\t\t'Click on the text you want to change',\n\t\t\t'big-sky'\n\t\t) }\\n2. ${ __( 'Start typing to make changes', 'big-sky' ) }\\n3. ${ __(\n\t\t\t\"You'll find some tools in the top toolbar to change style and alignment\",\n\t\t\t'big-sky'\n\t\t) }\\n4. ${ __(\n\t\t\t'You can also ask me to generate or rewrite text',\n\t\t\t'big-sky'\n\t\t) }`,\n\t},\n\n\t{\n\t\tslug: [ 'add-section' ],\n\t\tdescription:\n\t\t\t'Steps for adding new patterns and sections to the site layout.',\n\t\tanswer: `**${ __(\n\t\t\t'To add a section to your site:',\n\t\t\t'big-sky'\n\t\t) }**\\n1. ${ __(\n\t\t\t'Select a section in the editor',\n\t\t\t'big-sky'\n\t\t) }\\n2. ${ __( 'Click \"Add Pattern\"', 'big-sky' ) }\\n3. ${ __(\n\t\t\t'Specify which section you would like to add by either selecting one from the list or telling me the type of section (e.g. \"menu\", \"services\", \"about\", etc.)',\n\t\t\t'big-sky'\n\t\t) }\\n4. ${ __(\n\t\t\t'You can also specify if you want the new section added before or after the one selected',\n\t\t\t'big-sky'\n\t\t) }`,\n\t},\n\t{\n\t\tslug: [ 'replace-section' ],\n\t\tdescription:\n\t\t\t'Guide for replacing existing content sections and patterns with new layouts.',\n\t\tanswer: `**${ __(\n\t\t\t'To replace a section on your site:',\n\t\t\t'big-sky'\n\t\t) }**\\n1. ${ __(\n\t\t\t'Select a section in the editor',\n\t\t\t'big-sky'\n\t\t) }\\n2. ${ __(\n\t\t\t'Ask me to \"Replace this section\"',\n\t\t\t'big-sky'\n\t\t) }\\n3. ${ __(\n\t\t\t\"I'll provide you with a list of different section options you can choose from\",\n\t\t\t'big-sky'\n\t\t) }`,\n\t},\n\t{\n\t\tslug: [ 'domain', 'seo', 'pricing', 'wordpress.com', 'other' ],\n\t\tdescription:\n\t\t\t'Fallback entries for domain, SEO, pricing and other WordPress.com related queries.',\n\t},\n];\n\n/**\n * Array of slugs for use in the help tool enum\n */\nexport const answerSlugs = answers.flatMap( ( answer ) => answer.slug );\n","import askWordPressExpertTool from './tools/ask-wordpress-expert/ask-wordpress-expert-tool.js';\nimport changeAssistantTool from '@ai/assistants/shared/change-assistant/change-assistant-tool';\nimport { ASSISTANTS } from '@ai/assistants/constants.js';\n\nconst helpToolkit = {\n\tname: 'help',\n\ttools: ( context ) => {\n\t\t// The ask WordPress expert tool is called via the askBigSkyExpertTool function if it cant find an answer in the answers array\n\t\tconst tools = [ askWordPressExpertTool() ];\n\n\t\tif (\n\t\t\tcontext?.currentHandoffArea !== 'help' &&\n\t\t\t! context?.fromAssistantId\n\t\t) {\n\t\t\ttools.push( changeAssistantTool( ASSISTANTS.HELP ) );\n\t\t}\n\n\t\treturn tools;\n\t},\n};\n\nexport default helpToolkit;\n","import { answerSlugs } from './answers.js';\n\nexport default function askWordPressExpertTool() {\n\treturn {\n\t\tname: 'ask_wordpress_expert',\n\t\tdescription: `\n\t\t\tClassify the user question into one of the given answer slugs.\n\t\t\tUse this tool for all WordPress (both WordPress.com and self-hosted) questions.\n\t\t\t`,\n\t\tparameters: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tquestion: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: 'The user question to classify.',\n\t\t\t\t},\n\t\t\t\tslug: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: 'The slug of the answer to return.',\n\t\t\t\t\tenum: answerSlugs,\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [ 'question', 'slug' ],\n\t\t},\n\t\tstrict: true,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport log from '@utils/log-debug.js';\nimport { requestJetpackToken } from '@utils/request-jetpack-token.ts';\nimport { store as aiStore } from '@store';\nlet lastOdieChat = 0;\n\nconst odieSource = 'big-sky';\nexport default function useAskOdieToolFunctions() {\n\tconst { isDevMode, sessionId } = useSelect( ( select ) => ( {\n\t\tisDevMode: select( aiStore ).getIsDevMode(),\n\t\tsessionId: select( aiStore ).getSessionId(),\n\t} ) );\n\n\tconst ask_odie = async ( parameters, retry = false ) => {\n\t\tlet output = __(\n\t\t\t\"I don't know the answer to that question.\",\n\t\t\t'big-sky'\n\t\t);\n\n\t\tconst jetpackToken = await requestJetpackToken( ! retry );\n\t\tif ( jetpackToken ) {\n\t\t\tconst odieUrl =\n\t\t\t\t'https://public-api.wordpress.com/wpcom/v2/odie/chat/wpcom-chat-bigsky' +\n\t\t\t\t( lastOdieChat ? `/${ lastOdieChat }` : '' );\n\n\t\t\ttry {\n\t\t\t\tconst response = await fetch( odieUrl, {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\tAuthorization: `Bearer ${ jetpackToken.token }`,\n\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t},\n\t\t\t\t\tbody: JSON.stringify( {\n\t\t\t\t\t\t// context: ..., @todo add context parameters.\n\t\t\t\t\t\tmessage: parameters.question,\n\t\t\t\t\t\tsource: odieSource,\n\t\t\t\t\t\tsource_user: sessionId,\n\t\t\t\t\t\ttest: isDevMode,\n\t\t\t\t\t} ),\n\t\t\t\t} );\n\n\t\t\t\tconst body = await response.json();\n\n\t\t\t\tconst message = body?.messages?.[ 0 ];\n\t\t\t\tif ( message?.content ) {\n\t\t\t\t\tlastOdieChat = body.chat_id;\n\t\t\t\t\toutput = message.content;\n\n\t\t\t\t\tif ( message?.context?.sources ) {\n\t\t\t\t\t\t// Dedupe sources based on URL\n\t\t\t\t\t\tconst uniqueSources = Object.values(\n\t\t\t\t\t\t\tmessage.context.sources.reduce( ( acc, source ) => {\n\t\t\t\t\t\t\t\tif ( ! acc[ source.url ] ) {\n\t\t\t\t\t\t\t\t\tacc[ source.url ] = source;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn acc;\n\t\t\t\t\t\t\t}, {} )\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\toutput += uniqueSources\n\t\t\t\t\t\t\t.map(\n\t\t\t\t\t\t\t\t( source ) =>\n\t\t\t\t\t\t\t\t\t`\\n\\n- [${ source.title }](${ source.url })`\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.join( '' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch ( error ) {\n\t\t\t\t// retry once with a new token\n\t\t\t\tif ( ! retry ) {\n\t\t\t\t\treturn ask_odie( parameters, true );\n\t\t\t\t}\n\n\t\t\t\tlog.error( 'Error calling WordPress Expert API: ', error );\n\t\t\t}\n\t\t}\n\n\t\treturn output;\n\t};\n\treturn {\n\t\task_odie,\n\t};\n}\n","import helpAssistantPrompt from './prompt.js';\nimport helpToolkit from './toolkit.js';\nimport { ASSISTANTS } from '../constants.js';\nimport useHelpToolkit from './use-help-toolkit.js';\n\nconst helpAssistant = {\n\tid: ASSISTANTS.HELP,\n\tdescription: `An assistant that helps answer questions about WordPress, website building, and providing technical guidance.`,\n\tinstructions: ( context ) => {\n\t\treturn helpAssistantPrompt( context );\n\t},\n\ttags: [ ASSISTANTS.HELP ],\n\ttoolkits: [ helpToolkit ],\n\ttoolkitHook: useHelpToolkit,\n\tonStart: ( invoke, clearMessages = () => {}, agentMessage = null ) => {\n\t\tif ( agentMessage ) {\n\t\t\tclearMessages();\n\t\t\tinvoke.agentSay( agentMessage );\n\t\t}\n\t},\n};\n\nexport default helpAssistant;\n","import {\n\tanalysisPrompt,\n\tgetSelectedBlockContextPrompt,\n\tgetSiteContextPrompt,\n\tinvalidRequestPrompt,\n\tlanguagePrompt,\n\trouterActionPrompt,\n} from '../shared/prompts.js';\nimport { answers } from './tools/ask-wordpress-expert/answers.js';\nimport { ASSISTANTS } from '../constants.js';\nexport default function helpAssistantPrompt( context ) {\n\tconst isForwardedByAssistant = context?.fromAssistantId;\n\n\tconst routerExamples = ! isForwardedByAssistant\n\t\t? `User: \"Build me a landing page\"\n         Analysis: This is an instruction and is not in the form of a question\n         Action: ${ routerActionPrompt }\n\n         User: \"Show me more yellow color palettes\"\n         Analysis: This is an instruction and is not in the form of a question\n         Action: ${ routerActionPrompt }\n\n         User: \"Update social media links\"\n         Analysis: This is an instruction and is not in the form of a question\n         Action: ${ routerActionPrompt }\n\n         User: \"Change the colors of the buttons on my site\"\n         Analysis: This is an instruction and is not in the form of a question\n         Action: ${ routerActionPrompt }`\n\t\t: '';\n\n\tconst handleNonQuestions = isForwardedByAssistant\n\t\t? `Always rephrase the user request as a question and call the 'ask_wordpress_expert' tool`\n\t\t: `If user request is not a question, ignore all other instructions and call 'change_assistant' with the toAssistantId '${ ASSISTANTS.ROUTER }`;\n\n\tconst prompt = `\nYou are a WordPress expert at Automattic specializing in answering questions about WordPress, website building, and technical guidance.\n\n<site_context>\n${ getSiteContextPrompt( context, [\n\t'siteTitle',\n\t'siteDescription',\n\t'siteLocation',\n\t'topic',\n] ) }\n</site_context>\n\n<selected_block_context>\n${ getSelectedBlockContextPrompt( context, [ 'clientId', 'type' ] ) }\n</selected_block_context>\n\nHere is the language you should use for responses unless explicitly instructed otherwise:\n\n<language>\n${ languagePrompt }\n</language>\n\nInstructions:\n\n1. Analyze User Input and any additional System Messages:\n   ${ analysisPrompt }\n   a) Determine if this is a help request forwarded from another assistant\n   b) Determine if input contains a question mark, or question words\n   c) For questions and requests from other assistants, identify the specific WordPress topic/area\n   d) For non-questions, verify that they are not a question\n   e) Note any specific WordPress components, features, or functionality mentioned\n\n2. Handle Invalid Requests:\n   - ${ invalidRequestPrompt }\n\n3. Handle Non Questions:\n   - ${ handleNonQuestions }\n\n4. Handle Questions:\n   - If the request has been forwarded from another assistant always call 'ask_wordpress_expert' tool, do not forward it to the router assistant\n   - If you are not able to determine a WordPress or website topic/area you can ask the user for clarification\n   - Always call 'ask_wordpress_expert' tool when:\n     - The request has been forwarded from another assistant and make sure to phrase the user request as a question\n     - Contains a question mark\n     - Starts with question words: who, what, where, when, why, how, can, could, should, would, will, do, does, did, is, are, was, were\n   - Include all relevant context and specific components mentioned\n   - Always call 'ask_wordpress_expert' tool never try to answer the question yourself\n   - Never pretend to have completed the requested task yourself\n\n5. Choose a slug:\n   - Classify the user question into one of the given answer slugs \n   - When choosing a slug always use the description to help pick the most relevant slug\n   - If the answer slug cannot be inferred from the user question, try using the selected block context\n   - If the user question cannot be classified, set the slug value to 'other'\n\n6. Answer slugs\n${ answers\n\t.map(\n\t\t( answer ) =>\n\t\t\t`- slug: ${ answer.slug }, description: ${ answer.description }`\n\t)\n\t.join( '\\n' ) }\n\n7. Examples:\n\nUser: \"How do I customize my header?\"\nAnalysis: Question about header customization\nAction: Call 'ask_wordpress_expert' tool with context about header modification\n\nUser: \"What's the difference between pages and posts?\"\nAnalysis: Question about WordPress content types\nAction: Call 'ask_wordpress_expert' tool with context about content management\n\nUser: \"Can you replace the contact section\"\nAnalysis: Question about section or pattern replacement\nAction: Call 'ask_wordpress_expert' tool with context about section or pattern replacement\n\n${ routerExamples }\n8. Restrictions:\n   - Only answer WordPress-related questions\n   - Never rephrase the user request yourself to make it a question\n   - Never attempt to handle non-question yourself unless they are forwarded from another assistant; always use the 'change_assistant' tool for these.\n   - Don't display analysis in output\n   - Stick to WordPress expertise scope\n\nRemember to call appropriate tool immediately based on analysis, without showing the analysis process.\n`;\n\treturn prompt;\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { useEffect } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * External dependencies\n */\nimport { useChat, useToolkits } from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport helpToolkit from './toolkit.js';\nimport useAskWordPressExpertTool from './tools/ask-wordpress-expert/use-ask-wordpress-expert-tool.js';\nimport useChangeAssistantTool from '@ai/assistants/shared/change-assistant/use-change-assistant-tool.js';\nimport useCreateToolCallback from '@ai/assistants/shared/use-create-tool-callback.js';\nimport useHelpToolValidation from './use-help-tool-validation.js';\nimport { store as aiStore } from '@store';\nimport useSiteMetadata from '@hooks/use-site-metadata';\n\nexport default function useHelpToolkit() {\n\tconst { createToolCallback } = useCreateToolCallback();\n\tconst { changeAssistant } = useChangeAssistantTool();\n\tconst { agentSay } = useChat();\n\tconst { setCallbacks, setContext } = useToolkits();\n\tconst { askWordPressExpert } = useAskWordPressExpertTool();\n\tconst { validateArguments } = useHelpToolValidation();\n\tconst { setShowThread } = useDispatch( aiStore );\n\n\tconst { getSiteMetadata } = useSiteMetadata();\n\tconst { siteTitle, siteDescription, topic, siteLocation } =\n\t\tgetSiteMetadata();\n\n\tconst { selectedBlock } = useSelect( ( select ) => {\n\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\t\treturn {\n\t\t\tselectedBlock: getSelectedBlock(),\n\t\t};\n\t} );\n\n\tuseEffect( () => {\n\t\tsetCallbacks( helpToolkit.name, {\n\t\t\task_wordpress_expert: createToolCallback( {\n\t\t\t\tname: 'ask_wordpress_expert',\n\t\t\t\taction: async ( _args ) => {\n\t\t\t\t\tconst message = await askWordPressExpert( _args );\n\t\t\t\t\tagentSay( message );\n\t\t\t\t},\n\t\t\t\tvalidator: ( _args ) => validateArguments( _args ),\n\t\t\t\tfailValidatorAction: () =>\n\t\t\t\t\tagentSay(\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'Please provide a question to ask the WordPress expert.',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t\tcloseChatWhenDone: () => false,\n\t\t\t} ),\n\t\t\tchange_assistant: createToolCallback( {\n\t\t\t\tname: 'change_assistant',\n\t\t\t\taction: ( _args ) => {\n\t\t\t\t\tsetShowThread( true );\n\t\t\t\t\tchangeAssistant( _args );\n\t\t\t\t},\n\t\t\t\tcloseChatWhenDone: () => false,\n\t\t\t} ),\n\t\t} );\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ setCallbacks ] );\n\n\tuseEffect( () => {\n\t\tconst context = {\n\t\t\tsite: {\n\t\t\t\tsiteTitle,\n\t\t\t\tsiteDescription,\n\t\t\t\tsiteLocation,\n\t\t\t\ttopic,\n\t\t\t},\n\t\t\tselectedBlock: {\n\t\t\t\tclientId: selectedBlock?.clientId,\n\t\t\t\ttype: selectedBlock?.type,\n\t\t\t\tname: selectedBlock?.name,\n\t\t\t},\n\t\t};\n\n\t\tsetContext( helpToolkit.name, context );\n\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ setContext, selectedBlock ] );\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { answers } from './answers.js';\nimport { useChat } from '@automattic/big-sky-agents';\nimport useAskOdieToolFunctions from '../ask-odie/use-ask-odie-tool.js';\nimport { messageRoles } from '@utils/constants';\nimport { store as aiStore } from '@store/index';\nimport { ASSISTANTS } from '@ai/assistants/constants.js';\nexport default function useAskWordPressExpertTool() {\n\tconst { ask_odie } = useAskOdieToolFunctions();\n\tconst { clearMessages } = useChat();\n\tconst { setAssistant } = useDispatch( aiStore );\n\n\tconst askWordPressExpert = async ( parameters ) => {\n\t\t// At this point we can clear the `Help request forwarded from another assistant:` system message.\n\t\tclearMessages( messageRoles.SYSTEM );\n\t\tsetAssistant( ASSISTANTS.ROUTER );\n\n\t\t// get the answer from the answers array\n\t\tconst answer = answers.find( ( ans ) =>\n\t\t\tans.slug.includes( parameters.slug )\n\t\t);\n\n\t\tif ( ! answer || ! answer?.answer ) {\n\t\t\treturn ask_odie( parameters );\n\t\t}\n\n\t\treturn answer?.answer;\n\t};\n\treturn {\n\t\taskWordPressExpert,\n\t};\n}\n","export default function useHelpToolValidation() {\n\tconst validateArguments = ( args ) => {\n\t\tif ( ! args?.question ) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t};\n\n\treturn {\n\t\tvalidateArguments,\n\t};\n}\n","/**\n * Internal dependencies\n */\nimport routerAssistant from './router/index.js';\nimport specAssistant from './spec/index.js';\nimport contentAssistant from './content/index.js';\nimport colorAssistant from './color/index.js';\nimport patternAssistant from './pattern/index.js';\nimport fontAssistant from './font/index.js';\nimport layoutAssistant from './layout/index.js';\nimport imageAssistant from './image/index.js';\nimport pageAssistant from './page/index.js';\nimport helpAssistant from './help/index.js';\nimport {\n\tgetAssistantById,\n\tgetAssistants,\n\tregisterAssistant,\n} from './assistant-registry.js';\n\n// Register all assistants\n[\n\trouterAssistant,\n\tspecAssistant,\n\tcontentAssistant,\n\tcolorAssistant,\n\tpatternAssistant,\n\tfontAssistant,\n\tlayoutAssistant,\n\timageAssistant,\n\tpageAssistant,\n\thelpAssistant,\n].forEach( registerAssistant );\n\n// Export the assistants array and lookup functions\nexport const assistants = getAssistants();\nexport const assistantsById = ( id ) => getAssistantById( id );\n\n// Named exports for specific assistants\nexport {\n\trouterAssistant,\n\tcolorAssistant,\n\tpatternAssistant,\n\tfontAssistant,\n\tlayoutAssistant,\n\timageAssistant,\n\tpageAssistant,\n\thelpAssistant,\n};\n","/**\n * Internal dependencies\n */\nimport './style.scss';\n\nexport default function AIBuildMode() {\n\treturn <></>;\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { useEffect, useRef, useState } from '@wordpress/element';\nimport { Popover, ToggleControl } from '@wordpress/components';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { store as editorStore } from '@wordpress/editor';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\nimport { store as aiStore } from '@store';\nimport imageStyles from '@data/image-styles.json' assert { type: 'json' };\nimport usePatterns from '@hooks/use-patterns';\nimport useVariations from '@hooks/use-variations.js';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport { useChat } from '@automattic/big-sky-agents';\nimport useResetSite from '@hooks/use-reset-site';\nimport useBuildSiteTool from '@ai/assistants/spec/tools/build-site/use-build-site-tool';\n\nconst ResetSiteMetadataButton = () => {\n\tconst [ isResetting, setIsResetting ] = useState( false );\n\tconst { resetSite } = useResetSite();\n\n\treturn (\n\t\t<button\n\t\t\tclassName=\"button button-primary\"\n\t\t\tdisabled={ isResetting }\n\t\t\tonClick={ async () => {\n\t\t\t\tsetIsResetting( true );\n\t\t\t\tresetSite();\n\t\t\t} }\n\t\t>\n\t\t\t{ isResetting ? `Resetting...` : `Reset remote site metadata` }\n\t\t</button>\n\t);\n};\n\nconst StoreConversationToggle = () => {\n\tconst { isStoringConversation, setStoreConversation } = useChat();\n\n\treturn (\n\t\t<ToggleControl\n\t\t\tlabel={ 'Store conversation in OpenAI Evals' }\n\t\t\tchecked={ isStoringConversation }\n\t\t\tonChange={ ( value ) => {\n\t\t\t\tsetStoreConversation( value );\n\t\t\t} }\n\t\t/>\n\t);\n};\n\nconst GeneratePatternsToggle = () => {\n\tconst [ isGeneratingPatterns, setIsGeneratingPatternsState ] = useState(\n\t\t() => {\n\t\t\t// Get initial value from localStorage\n\t\t\tconst stored = window.localStorage.getItem(\n\t\t\t\t'isGeneratingPatterns'\n\t\t\t);\n\t\t\treturn stored === 'true';\n\t\t}\n\t);\n\n\tconst setIsGeneratingPatterns = ( value ) => {\n\t\t// Update both state and localStorage\n\t\tsetIsGeneratingPatternsState( value );\n\t\twindow.localStorage.setItem( 'isGeneratingPatterns', value );\n\t};\n\n\treturn (\n\t\t<ToggleControl\n\t\t\tlabel={ 'Generate Patterns' }\n\t\t\tchecked={ isGeneratingPatterns }\n\t\t\tonChange={ ( value ) => {\n\t\t\t\tsetIsGeneratingPatterns( value );\n\t\t\t} }\n\t\t/>\n\t);\n};\n\nconst QuickOnboardingButton = ( { setShowDebug } ) => {\n\tconst { buildSiteTask } = useBuildSiteTool();\n\n\tconst [ staticSiteMetadata, setStaticSiteMetadata ] = useState( null );\n\tconst { isEditorIframeLoaded } = useSelect( ( select ) => ( {\n\t\tisEditorIframeLoaded: select( aiStore ).getIsEditorIframeLoaded(),\n\t} ) );\n\n\tuseEffect( () => {\n\t\tif ( process.env.NODE_ENV === 'development' ) {\n\t\t\t// read from local storage\n\t\t\t// eslint-disable-next-line no-undef\n\t\t\tconst siteMetadata = localStorage.getItem( 'siteMeta' );\n\t\t\tif ( siteMetadata ) {\n\t\t\t\tsetStaticSiteMetadata( JSON.parse( siteMetadata ) );\n\t\t\t}\n\t\t}\n\t}, [] );\n\n\treturn (\n\t\t<button\n\t\t\tclassName=\"button button-primary\"\n\t\t\tonClick={ async () => {\n\t\t\t\tbuildSiteTask( staticSiteMetadata, true );\n\t\t\t\tsetShowDebug( false );\n\t\t\t} }\n\t\t\tdisabled={ ! staticSiteMetadata || ! isEditorIframeLoaded }\n\t\t>\n\t\t\t{ `Quick Onboarding` }\n\t\t</button>\n\t);\n};\n\nconst SaveCurrentBuild = () => {\n\tconst siteMetadata = useSiteMetadata().getSiteMetadata();\n\tconst buildDesigns = {\n\t\tcolors: [ siteMetadata.currentColor ],\n\t\tfonts: [ siteMetadata.currentFont ],\n\t};\n\n\treturn (\n\t\t<button\n\t\t\tclassName=\"button button-primary\"\n\t\t\tonClick={ async () => {\n\t\t\t\t// eslint-disable-next-line no-undef\n\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t'siteMeta',\n\t\t\t\t\tJSON.stringify( siteMetadata )\n\t\t\t\t);\n\t\t\t\t// eslint-disable-next-line no-undef\n\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t'buildDesigns',\n\t\t\t\t\tJSON.stringify( buildDesigns )\n\t\t\t\t);\n\t\t\t} }\n\t\t>\n\t\t\t{ `Save Current Build` }\n\t\t</button>\n\t);\n};\n\nconst ModifyBuildForm = ( { setShowModifyBuildForm, setShowDebug } ) => {\n\tconst { resetCachedContent } = useDispatch( aiStore );\n\tconst { buildSiteTask } = useBuildSiteTool();\n\n\tconst formRef = useRef();\n\n\tconst saveFormData = () => {\n\t\tconst form = formRef.current;\n\t\tconst formData = {\n\t\t\tsiteType: form.querySelector( '[name=\"siteType\"]' ).value,\n\t\t\tsiteTitle: form.querySelector( '[name=\"siteTitle\"]' ).value,\n\t\t\tsiteDescription: form.querySelector( '[name=\"siteDescription\"]' )\n\t\t\t\t.value,\n\t\t\ttopic: form.querySelector( '[name=\"topic\"]' ).value,\n\t\t\tcurrentColor: form.querySelector( '[name=\"currentColor\"]' ).value,\n\t\t\tcurrentFont: form.querySelector( '[name=\"currentFont\"]' ).value,\n\t\t\tdefaultImageStyle: form.querySelector(\n\t\t\t\t'[name=\"defaultImageStyle\"]'\n\t\t\t).value,\n\t\t\tsiteLocation: {\n\t\t\t\tname: form.querySelector( '[name=\"locationName\"]' ).value,\n\t\t\t},\n\t\t\tpatterns: Array.from(\n\t\t\t\tform.querySelectorAll( '[name=\"pattern\"]' )\n\t\t\t).map( ( select ) => ( {\n\t\t\t\tid: parseInt( select.value ),\n\t\t\t\tcategory:\n\t\t\t\t\tselect.options[ select.selectedIndex ].dataset.category,\n\t\t\t} ) ),\n\t\t};\n\t\tconst buildDesigns = {\n\t\t\tcolors: [ formData.currentColor ],\n\t\t\tfonts: [ formData.currentFont ],\n\t\t};\n\n\t\t// eslint-disable-next-line no-undef\n\t\tlocalStorage.setItem( 'siteMeta', JSON.stringify( formData ) );\n\t\t// eslint-disable-next-line no-undef\n\t\tlocalStorage.setItem( 'buildDesigns', JSON.stringify( buildDesigns ) );\n\t\treturn formData;\n\t};\n\n\tconst handleSave = () => {\n\t\tconst newSiteMetadata = saveFormData();\n\n\t\t// if clear cached content is checked, clear cached content\n\t\tif (\n\t\t\tformRef.current.querySelector( '[name=\"resetCachedContent\"]' )\n\t\t\t\t.checked\n\t\t) {\n\t\t\tresetCachedContent();\n\t\t}\n\n\t\t// if rebuild site is checked, rebuild site\n\t\tif ( formRef.current.querySelector( '[name=\"rebuildSite\"]' ).checked ) {\n\t\t\tbuildSiteTask( newSiteMetadata, true );\n\t\t\tsetShowDebug( false );\n\t\t}\n\t};\n\n\treturn (\n\t\t<div ref={ formRef }>\n\t\t\t<h2>Modify Build</h2>\n\t\t\t<SiteData editable />\n\t\t\t<div className=\"big-sky__ai-debug__checkboxes\">\n\t\t\t\t<div>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tname=\"resetCachedContent\"\n\t\t\t\t\t\tdefaultChecked={ false }\n\t\t\t\t\t/>\n\t\t\t\t\t<label htmlFor=\"resetCachedContent\">\n\t\t\t\t\t\tReset cached content\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tname=\"rebuildSite\"\n\t\t\t\t\t\tdefaultChecked={ true }\n\t\t\t\t\t/>\n\t\t\t\t\t<label htmlFor=\"rebuildSite\">Rebuild site</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"big-sky__ai-debug__buttons\">\n\t\t\t\t<button\n\t\t\t\t\tclassName=\"button button-primary\"\n\t\t\t\t\tonClick={ handleSave }\n\t\t\t\t>\n\t\t\t\t\tSave\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tclassName=\"button\"\n\t\t\t\t\tonClick={ () => setShowModifyBuildForm( false ) }\n\t\t\t\t>\n\t\t\t\t\tClose\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\nconst ModifyBuild = ( { setShowModifyBuildForm } ) => {\n\treturn (\n\t\t<button\n\t\t\tclassName=\"button\"\n\t\t\tonClick={ async () => {\n\t\t\t\tsetShowModifyBuildForm( true );\n\t\t\t} }\n\t\t>\n\t\t\t{ `Modify Build` }\n\t\t</button>\n\t);\n};\n\nfunction AssemblerDebug( { setShowDebug } ) {\n\tconst [ showModifyBuildForm, setShowModifyBuildForm ] = useState( false );\n\tconst { saveEntityRecord } = useDispatch( coreStore );\n\tconst { isOnboarded } = useSiteMetadata().getSiteMetadata();\n\tconst {\n\t\tsessionId,\n\t\tchatUsage,\n\t\tchat35Usage,\n\t\tanthropicUsage,\n\t\tisBuildingSite,\n\t\tisHandoff,\n\t} = useSelect( ( select ) => ( {\n\t\tchatUsage: select( aiStore ).getOpenAIChatUsage(),\n\t\tchat35Usage: select( aiStore ).getOpenAIChat35Usage(),\n\t\tanthropicUsage: select( aiStore ).getAnthropicUsage(),\n\t\tsessionId: select( aiStore ).getSessionId(),\n\t\tisBuildingSite: select( aiStore ).getIsBuildingSite(),\n\t\tisHandoff: select( aiStore ).getIsHandoff(),\n\t} ) );\n\n\treturn (\n\t\t<Popover className=\"big-sky__ai-debug\">\n\t\t\t{ showModifyBuildForm ? (\n\t\t\t\t<ModifyBuildForm\n\t\t\t\t\tsetShowModifyBuildForm={ setShowModifyBuildForm }\n\t\t\t\t\tsetShowDebug={ setShowDebug }\n\t\t\t\t/>\n\t\t\t) : (\n\t\t\t\t<>\n\t\t\t\t\t<h2>Site Data</h2>\n\t\t\t\t\t<SiteData />\n\n\t\t\t\t\t<h2>Model Usage</h2>\n\t\t\t\t\t<table>\n\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<th></th>\n\t\t\t\t\t\t\t\t<th>Prompt</th>\n\t\t\t\t\t\t\t\t<th>Completion</th>\n\t\t\t\t\t\t\t\t<th>Total</th>\n\t\t\t\t\t\t\t\t<th>Reqs</th>\n\t\t\t\t\t\t\t\t<th>Cost</th>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t<UsageRow usageType=\"GPT 4\" usage={ chatUsage } />\n\t\t\t\t\t\t\t<UsageRow\n\t\t\t\t\t\t\t\tusageType=\"GPT 3.5\"\n\t\t\t\t\t\t\t\tusage={ chat35Usage }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<UsageRow\n\t\t\t\t\t\t\t\tusageType=\"Claude 3\"\n\t\t\t\t\t\t\t\tusage={ {\n\t\t\t\t\t\t\t\t\tpromptTokens: anthropicUsage?.inputTokens,\n\t\t\t\t\t\t\t\t\tcompletionTokens:\n\t\t\t\t\t\t\t\t\t\tanthropicUsage?.outputTokens,\n\t\t\t\t\t\t\t\t\ttotalTokens: anthropicUsage?.totalTokens,\n\t\t\t\t\t\t\t\t\ttotalRequests:\n\t\t\t\t\t\t\t\t\t\tanthropicUsage?.totalRequests,\n\t\t\t\t\t\t\t\t\testimatedCost:\n\t\t\t\t\t\t\t\t\t\tanthropicUsage?.estimatedCost,\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>\n\n\t\t\t\t\t<>\n\t\t\t\t\t\t<h2>Tools</h2>\n\t\t\t\t\t\t<Tools />\n\t\t\t\t\t</>\n\n\t\t\t\t\t<div className=\"big-sky__ai-debug__buttons\">\n\t\t\t\t\t\t<StoreConversationToggle />\n\t\t\t\t\t\t<GeneratePatternsToggle />\n\t\t\t\t\t\t<ResetSiteMetadataButton />\n\t\t\t\t\t\t{ ! isOnboarded && (\n\t\t\t\t\t\t\t<QuickOnboardingButton\n\t\t\t\t\t\t\t\tsetShowDebug={ setShowDebug }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) }\n\t\t\t\t\t\t{ isOnboarded && ( isHandoff || ! isBuildingSite ) && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<SaveCurrentBuild />\n\t\t\t\t\t\t\t\t<ModifyBuild\n\t\t\t\t\t\t\t\t\tsetShowModifyBuildForm={\n\t\t\t\t\t\t\t\t\t\tsetShowModifyBuildForm\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t) }\n\t\t\t\t\t\t{ window?.bigSkyInitialState?.lastPayload && (\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclassName=\"button\"\n\t\t\t\t\t\t\t\tonClick={ async () => {\n\t\t\t\t\t\t\t\t\tconst saved = await saveEntityRecord(\n\t\t\t\t\t\t\t\t\t\t'root',\n\t\t\t\t\t\t\t\t\t\t'site',\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tbig_sky_last_site_design_payload:\n\t\t\t\t\t\t\t\t\t\t\t\tJSON.stringify(\n\t\t\t\t\t\t\t\t\t\t\t\t\twindow.bigSkyInitialState\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.lastPayload\n\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tsaved.big_sky_last_site_design_payload\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\t\t\t\t\t\talert(\n\t\t\t\t\t\t\t\t\t\t\t'Payload saved. Now you can run evals with npm run evals'\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tStore Last Payload\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t) }\n\t\t\t\t\t\t{ sessionId && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\thref={ `https://mc.a8c.com/big-sky/session/?session_uuid=${ sessionId }` }\n\t\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\t\trel=\"noreferrer\"\n\t\t\t\t\t\t\t\t\tclassName=\"button\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tSession Log\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</div>\n\t\t\t\t</>\n\t\t\t) }\n\t\t</Popover>\n\t);\n}\n\n// Component for each usage row\nfunction UsageRow( { usageType, usage } ) {\n\treturn (\n\t\t<tr>\n\t\t\t<td>{ usageType }</td>\n\t\t\t<td>{ usage?.promptTokens || 0 }</td>\n\t\t\t<td>{ usage?.completionTokens || 0 }</td>\n\t\t\t<td>{ usage?.totalTokens || 0 }</td>\n\t\t\t<td>{ usage?.totalRequests || 0 }</td>\n\t\t\t<td>${ ( usage?.estimatedCost || 0 ).toFixed( 2 ) }</td>\n\t\t</tr>\n\t);\n}\n\nfunction Palette( { paletteColors } ) {\n\treturn (\n\t\t<>\n\t\t\t{ paletteColors.map( ( { color, slug } ) => (\n\t\t\t\t<span\n\t\t\t\t\tclassName=\"big-sky__ai-debug__swatch\"\n\t\t\t\t\tkey={ slug }\n\t\t\t\t\tstyle={ { backgroundColor: color } }\n\t\t\t\t></span>\n\t\t\t) ) }\n\t\t</>\n\t);\n}\n\nfunction SiteData( { editable = false } ) {\n\tconst {\n\t\tcurrentColor,\n\t\tcurrentFont,\n\t\tsiteType,\n\t\ttopic,\n\t\tsiteDescription,\n\t\tsiteLocation,\n\t\tsiteTitle,\n\t\tdefaultImageStyle,\n\t\tpatterns: savedPatterns,\n\t\tcolorRequest,\n\t} = useSiteMetadata().getSiteMetadata();\n\tconst { remotePatterns } = useSelect( ( select ) => {\n\t\tconst store = select( aiStore );\n\t\tconst userLocale = store.getUserLocale();\n\n\t\treturn {\n\t\t\tremotePatterns: store.getRemotePatterns( userLocale ),\n\t\t};\n\t} );\n\tconst { currentPostId } = useSelect( ( select ) => ( {\n\t\tcurrentPostId: select( editorStore ).getCurrentPostId(),\n\t} ) );\n\n\t// Backwards compatibility for savedPatterns, which wa an array in the past but is now an object.\n\tlet patterns;\n\tif ( Array.isArray( savedPatterns ) ) {\n\t\tpatterns = savedPatterns;\n\t} else {\n\t\tpatterns = savedPatterns[ currentPostId ] || [];\n\t}\n\n\t// Get paletteColors from `useVariations()`. The data from `useStyles()`\n\t// is the currently set palette, which can sometimes be different than\n\t// the palette defined by the selected variation.\n\tconst { getColorVariations, getColorVariationByTitle, getFontVariations } =\n\t\tuseVariations();\n\tconst variation = getColorVariationByTitle( currentColor );\n\tconst paletteColors = variation?.settings?.color?.palette?.theme ?? [];\n\n\tconst getLocationCoordinates = () => {\n\t\tif ( siteLocation && siteLocation.coordinates ) {\n\t\t\treturn `${ siteLocation.coordinates[ 0 ] }, ${ siteLocation.coordinates[ 1 ] }`;\n\t\t}\n\t};\n\tconst additionalContext = useSelect( ( select ) =>\n\t\tselect( aiStore ).getAdditionalContext()\n\t);\n\n\treturn (\n\t\t<div className=\"big-sky__ai-debug__site-data\">\n\t\t\t<table>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>Site Type</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t{ editable ? (\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tname=\"siteType\"\n\t\t\t\t\t\t\t\t\tdefaultValue={ siteType }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\tsiteType\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>Title</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t{ editable ? (\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tname=\"siteTitle\"\n\t\t\t\t\t\t\t\t\tdefaultValue={ siteTitle }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\tsiteTitle\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>Description</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t{ editable ? (\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tname=\"siteDescription\"\n\t\t\t\t\t\t\t\t\tdefaultValue={ siteDescription }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\tsiteDescription\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>Topic</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t{ editable ? (\n\t\t\t\t\t\t\t\t<input name=\"topic\" defaultValue={ topic } />\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\ttopic !== 'abstract' && topic\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>Color Request</td>\n\t\t\t\t\t\t<td>{ colorRequest && colorRequest }</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>Color Palette</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t{ editable ? (\n\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\tname=\"currentColor\"\n\t\t\t\t\t\t\t\t\tdefaultValue={ currentColor }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ getColorVariations()\n\t\t\t\t\t\t\t\t\t\t.sort( ( a, b ) =>\n\t\t\t\t\t\t\t\t\t\t\ta.title.localeCompare( b.title )\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t.map( ( { title } ) => (\n\t\t\t\t\t\t\t\t\t\t\t<option\n\t\t\t\t\t\t\t\t\t\t\t\tkey={ title }\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={ title }\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{ title }\n\t\t\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t\t) ) }\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t{ currentColor }{ ' ' }\n\t\t\t\t\t\t\t\t\t<Palette paletteColors={ paletteColors } />\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>Font</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t{ editable ? (\n\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\tname=\"currentFont\"\n\t\t\t\t\t\t\t\t\tdefaultValue={ currentFont }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ getFontVariations()\n\t\t\t\t\t\t\t\t\t\t.sort( ( a, b ) =>\n\t\t\t\t\t\t\t\t\t\t\ta.title.localeCompare( b.title )\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t.map( ( { title } ) => (\n\t\t\t\t\t\t\t\t\t\t\t<option\n\t\t\t\t\t\t\t\t\t\t\t\tkey={ title }\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={ title }\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{ title }\n\t\t\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t\t) ) }\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\tcurrentFont\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>Location Name</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t{ editable ? (\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tname=\"locationName\"\n\t\t\t\t\t\t\t\t\tdefaultValue={ JSON.stringify(\n\t\t\t\t\t\t\t\t\t\tsiteLocation?.name\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\tJSON.stringify( siteLocation?.name )\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t{ ! editable && (\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>Location Coordinates</td>\n\t\t\t\t\t\t\t<td>{ getLocationCoordinates() }</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t) }\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>Image Style</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t{ editable ? (\n\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\tname=\"defaultImageStyle\"\n\t\t\t\t\t\t\t\t\tdefaultValue={\n\t\t\t\t\t\t\t\t\t\tdefaultImageStyle || 'photographic'\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ imageStyles.map( ( style ) => (\n\t\t\t\t\t\t\t\t\t\t<option key={ style } value={ style }>\n\t\t\t\t\t\t\t\t\t\t\t{ style }\n\t\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t) ) }\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\tdefaultImageStyle\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>Patterns</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t{ editable\n\t\t\t\t\t\t\t\t? patterns?.map( ( pattern ) => {\n\t\t\t\t\t\t\t\t\t\t// filter remote patterns by category, build options\n\t\t\t\t\t\t\t\t\t\tconst options = remotePatterns\n\t\t\t\t\t\t\t\t\t\t\t.filter(\n\t\t\t\t\t\t\t\t\t\t\t\t( remotePattern ) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\tremotePattern.category ===\n\t\t\t\t\t\t\t\t\t\t\t\t\tpattern.category\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t.sort( ( a, b ) =>\n\t\t\t\t\t\t\t\t\t\t\t\ta.title.localeCompare( b.title )\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t.map( ( remotePattern ) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<option\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={ remotePattern.ID }\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={ remotePattern.ID }\n\t\t\t\t\t\t\t\t\t\t\t\t\tdata-category={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tremotePattern.category\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{ remotePattern.title } ({ ' ' }\n\t\t\t\t\t\t\t\t\t\t\t\t\t{ remotePattern.ID } )\n\t\t\t\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t\t\t) );\n\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\t\t\t\tname=\"pattern\"\n\t\t\t\t\t\t\t\t\t\t\t\tdefaultValue={ pattern.id }\n\t\t\t\t\t\t\t\t\t\t\t\tkey={ pattern.id }\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{ options }\n\t\t\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t  } )\n\t\t\t\t\t\t\t\t: patterns?.map( ( pattern ) => (\n\t\t\t\t\t\t\t\t\t\t<div key={ pattern.id }>\n\t\t\t\t\t\t\t\t\t\t\t{ pattern.id } &middot;{ ' ' }\n\t\t\t\t\t\t\t\t\t\t\t{ pattern.category }\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t  ) ) }\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t{ additionalContext &&\n\t\t\t\t\t\tObject.keys( additionalContext ).map( ( key ) => (\n\t\t\t\t\t\t\t<tr key={ key }>\n\t\t\t\t\t\t\t\t<td>Additional Context: { key }</td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t{ JSON.stringify(\n\t\t\t\t\t\t\t\t\t\tadditionalContext[ key ]\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t) ) }\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\n\t);\n}\n\nfunction Tools() {\n\tconst { patterns } = useSelect( ( select ) => {\n\t\tconst store = select( aiStore );\n\t\tconst userLocale = store.getUserLocale();\n\n\t\treturn {\n\t\t\tpatterns: store.getRemotePatterns( userLocale ),\n\t\t};\n\t} );\n\n\tconst { selectedBlock } = useSelect( ( select ) => {\n\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\t\treturn {\n\t\t\tselectedBlock: getSelectedBlock(),\n\t\t};\n\t} );\n\n\tconst selectedPatternId =\n\t\tselectedBlock?.attributes?.metadata?.remotePatternId || 'None selected';\n\n\tconst { convertToBlocks, insertPatterns } = usePatterns();\n\tconst [ insertPatternId, setInsertPatternId ] = useState( null );\n\tconst sortedPatternsById = patterns.sort( ( a, b ) => a.ID - b.ID );\n\n\tconst handleInsertPattern = () => {\n\t\tconst patternToInsert = sortedPatternsById.find(\n\t\t\t( pattern ) => pattern.ID === parseInt( insertPatternId )\n\t\t);\n\t\tconst blocks = convertToBlocks( patternToInsert.html );\n\t\tpatternToInsert.blocks = blocks;\n\t\tinsertPatterns( [ patternToInsert ] );\n\t};\n\n\tconst { isOnboarded } = useSiteMetadata().getSiteMetadata();\n\n\tuseEffect( () => {\n\t\tsetInsertPatternId( sortedPatternsById[ 0 ]?.ID );\n\t}, [ sortedPatternsById ] );\n\n\treturn (\n\t\t<div className=\"big-sky__ai-debug__tools\">\n\t\t\t{ isOnboarded && (\n\t\t\t\t<div className=\"big-sky__ai-debug__tools__insert-pattern\">\n\t\t\t\t\t<p>Selected Pattern: { selectedPatternId }</p>\n\n\t\t\t\t\t<p>Insert Pattern:</p>\n\t\t\t\t\t<div className=\"big-sky__ai-debug__flex\">\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tonChange={ ( event ) =>\n\t\t\t\t\t\t\t\tsetInsertPatternId( event.target.value )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ sortedPatternsById.map( ( pattern ) => (\n\t\t\t\t\t\t\t\t<option key={ pattern.ID } value={ pattern.ID }>\n\t\t\t\t\t\t\t\t\t{ pattern.ID } &middot; { pattern.title }\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t) ) }\n\t\t\t\t\t\t</select>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclassName=\"button button-primary\"\n\t\t\t\t\t\t\tonClick={ handleInsertPattern }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tInsert\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t) }\n\t\t</div>\n\t);\n}\n\nconst AssemblerDebugWrapper = () => {\n\tconst [ showDebug, setShowDebug ] = useState( false );\n\n\tuseEffect( () => {\n\t\tconst handleKeyDown = ( event ) => {\n\t\t\tif ( event.ctrlKey && event.key === 'd' ) {\n\t\t\t\tsetShowDebug( ! showDebug );\n\t\t\t}\n\t\t};\n\n\t\tdocument.addEventListener( 'keydown', handleKeyDown );\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener( 'keydown', handleKeyDown );\n\t\t};\n\t}, [ showDebug ] );\n\n\treturn showDebug ? <AssemblerDebug setShowDebug={ setShowDebug } /> : null;\n};\n\nexport default AssemblerDebugWrapper;\n","/**\n * WordPress dependencies\n */\nimport { SVG, Path } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst close = /*#__PURE__*/_jsx(SVG, {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 24 24\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"m13.06 12 6.47-6.47-1.06-1.06L12 10.94 5.53 4.47 4.47 5.53 10.94 12l-6.47 6.47 1.06 1.06L12 13.06l6.47 6.47 1.06-1.06L13.06 12Z\"\n  })\n});\nexport default close;\n//# sourceMappingURL=close.js.map","/**\n * WordPress dependencies\n */\nimport { useDispatch } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { store as aiStore } from '@store';\nimport { requestJetpackToken } from '@utils/request-jetpack-token.ts';\n\nconst useJetpackToken = () => {\n\tconst { setApiKey, setHasRetriedChatRequest } = useDispatch( aiStore );\n\n\tconst withJetpackTokenRequest = async ( callback ) => {\n\t\tsetHasRetriedChatRequest( false );\n\t\tconst newTokenData = await requestJetpackToken();\n\t\tif ( newTokenData && newTokenData.token ) {\n\t\t\tsetApiKey( newTokenData.token );\n\t\t\tcallback( newTokenData );\n\t\t}\n\t};\n\n\treturn { withJetpackTokenRequest };\n};\n\nexport default useJetpackToken;\n","/**\n * WordPress dependencies\n */\nimport { SVG, Path } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst warning = /*#__PURE__*/_jsx(SVG, {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"-2 -2 24 24\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"M10 2c4.42 0 8 3.58 8 8s-3.58 8-8 8-8-3.58-8-8 3.58-8 8-8zm1.13 9.38l.35-6.46H8.52l.35 6.46h2.26zm-.09 3.36c.24-.23.37-.55.37-.96 0-.42-.12-.74-.36-.97s-.59-.35-1.06-.35-.82.12-1.07.35-.37.55-.37.97c0 .41.13.73.38.96.26.23.61.34 1.06.34s.8-.11 1.05-.34z\"\n  })\n});\nexport default warning;\n//# sourceMappingURL=warning.js.map","/**\n * External dependencies\n */\nimport classNames from 'classnames';\nimport Markdown from 'react-markdown';\nimport { useChat } from '@automattic/big-sky-agents';\n\n/**\n * WordPress dependencies\n */\nimport { Icon, __unstableMotion as motion } from '@wordpress/components';\nimport { useDispatch } from '@wordpress/data';\nimport { warning } from '@wordpress/icons';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { cloneElement } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\nimport { messageRoles } from '@utils/constants';\nimport { AI } from '@components/icons';\nimport useJetpackToken from '@hooks/use-jetpack-token';\n\nconst markdownComponents = {\n\ta: ( props ) => {\n\t\tconst { href } = props;\n\t\treturn (\n\t\t\t<a href={ href } target=\"_blank\" rel=\"noopener noreferrer\">\n\t\t\t\t{ props.children }\n\t\t\t</a>\n\t\t);\n\t},\n};\n\nexport default function ChatMessage( { message } ) {\n\tconst { userSay } = useChat();\n\tconst { selectBlock } = useDispatch( blockEditorStore );\n\tconst { withJetpackTokenRequest } = useJetpackToken();\n\n\tconst handleOnClick = async () => {\n\t\tif ( message.clientId ) {\n\t\t\tselectBlock( message.clientId );\n\t\t\treturn;\n\t\t}\n\t\tif ( message.role === messageRoles.ACTION ) {\n\t\t\tawait withJetpackTokenRequest( () => userSay( message.content ) );\n\t\t}\n\t};\n\n\tconst formatMessageContent = ( content ) => {\n\t\tlet messageContent = content;\n\t\tif ( typeof messageContent === 'string' ) {\n\t\t\tmessageContent = (\n\t\t\t\t<Markdown components={ markdownComponents }>\n\t\t\t\t\t{ messageContent }\n\t\t\t\t</Markdown>\n\t\t\t);\n\t\t} else if (\n\t\t\ttypeof messageContent === 'object' &&\n\t\t\t! Array.isArray( messageContent )\n\t\t) {\n\t\t\tmessageContent = cloneElement( messageContent );\n\t\t} else if ( Array.isArray( messageContent ) ) {\n\t\t\tmessageContent = (\n\t\t\t\t<Markdown components={ markdownComponents }>\n\t\t\t\t\t{ messageContent[ 0 ]?.text }\n\t\t\t\t</Markdown>\n\t\t\t);\n\t\t}\n\n\t\treturn messageContent;\n\t};\n\n\tconst cssClasses = classNames( 'big-sky__chat-message', {\n\t\t'big-sky__chat-message__user': message.role === messageRoles.USER,\n\t\t'big-sky__chat-message__error': message.role === messageRoles.ERROR,\n\t\t'big-sky__chat-message__thinking':\n\t\t\tmessage.role === messageRoles.THINKING,\n\t\t'big-sky__chat-message__component':\n\t\t\tmessage.role === messageRoles.COMPONENT,\n\t\t'big-sky__chat-message__action': message.role === messageRoles.ACTION,\n\t\t'big-sky__chat-message__has-block-link': !! message.clientId,\n\t} );\n\n\tconst animations = {\n\t\tinitial: {\n\t\t\ty: 40,\n\t\t\topacity: 0,\n\t\t\ttransition: { duration: 0.3 },\n\t\t},\n\t\texit: {\n\t\t\topacity: 0,\n\t\t\ttransition: { duration: 0 },\n\t\t},\n\t\tanimate: {\n\t\t\ty: 0,\n\t\t\topacity: 1,\n\t\t\ttransition: { duration: 0.3 },\n\t\t},\n\t};\n\n\treturn (\n\t\t<motion.div\n\t\t\tlayoutScroll\n\t\t\tinitial={ animations.initial }\n\t\t\texit={ animations.exit }\n\t\t\tanimate={ animations.animate }\n\t\t\tclassName={ cssClasses }\n\t\t\trole=\"button\"\n\t\t\ttabIndex=\"0\"\n\t\t\tonClick={ handleOnClick }\n\t\t\tonKeyDown={ handleOnClick }\n\t\t\tonFocus={ handleOnClick }\n\t\t>\n\t\t\t{ ( message.role === messageRoles.ASSISTANT ||\n\t\t\t\tmessage.role === messageRoles.THINKING ||\n\t\t\t\tmessage.role === messageRoles.TOOL ) && (\n\t\t\t\t<div className=\"big-sky__chat-message__avatar\">\n\t\t\t\t\t<Icon icon={ AI } />\n\t\t\t\t</div>\n\t\t\t) }\n\t\t\t<div className=\"big-sky__chat-message__content\">\n\t\t\t\t{ message.role === messageRoles.ERROR && (\n\t\t\t\t\t<Icon icon={ warning } />\n\t\t\t\t) }\n\t\t\t\t{ formatMessageContent( message.content ) }\n\t\t\t</div>\n\t\t</motion.div>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { __, sprintf } from '@wordpress/i18n';\nimport {\n\tButton,\n\t__unstableMotion as motion,\n\tTextareaControl,\n} from '@wordpress/components';\nimport {\n\tforwardRef,\n\tuseCallback,\n\tuseEffect,\n\tuseMemo,\n\tuseRef,\n\tuseState,\n} from '@wordpress/element';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport {\n\tuseChat,\n\tuseNextToolCall,\n\tuseToolkits,\n} from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport { store as aiStore } from '@store';\nimport useIsThinking from '@hooks/use-is-thinking';\nimport useJetpackToken from '@hooks/use-jetpack-token';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport { ArrowUp, AskAI } from '@components/icons';\nimport { dockViews, messageRoles } from '@utils/constants';\nimport ChatMessage from '@components/chat/message';\nimport useLog from '@hooks/use-log';\nimport { recordTracksEvent } from '@utils/tracks';\nimport { assistantsById } from '@ai/assistants/index.js';\nimport './style.scss';\n\nconst ChatInput = forwardRef(\n\t( { prompt, onSendMessage, animationProps = {} }, ref ) => {\n\t\tconst { userSay, pendingToolCalls, resetChangeAgentCount } = useChat();\n\t\tconst { setContext } = useToolkits();\n\t\tconst { withJetpackTokenRequest } = useJetpackToken();\n\t\tconst { isThinking } = useIsThinking();\n\t\tconst { logUserMessage } = useLog();\n\t\tconst currentToolCall = useMemo( () => {\n\t\t\tif ( pendingToolCalls.length > 0 ) {\n\t\t\t\treturn pendingToolCalls[ 0 ].function?.name;\n\t\t\t}\n\t\t}, [ pendingToolCalls ] );\n\n\t\tconst { args, respond } = useNextToolCall( currentToolCall );\n\n\t\tconst [ submitButtonEnabled, setSubmitButtonEnabled ] =\n\t\t\tuseState( false );\n\t\tconst [ errorTooLong, setErrorTooLong ] = useState( '' );\n\t\tconst [ hasRecordedLongMessage, setHasRecordedLongMessage ] =\n\t\t\tuseState( false );\n\t\tconst {\n\t\t\tsetChatComponents,\n\t\t\tsetCurrentUserMessage,\n\t\t\tsetShowThread,\n\t\t\tsetShowChatContinueButton,\n\t\t\tsetIsTyping,\n\t\t} = useDispatch( aiStore );\n\t\tconst {\n\t\t\tcurrentUserMessage,\n\t\t\tshowChatContinueButton,\n\t\t\tchatContinueButtonOnClick,\n\t\t\tdockView,\n\t\t\thideInput,\n\t\t\tcurrentAssistant,\n\t\t} = useSelect( ( select ) => {\n\t\t\tconst ai = select( aiStore );\n\t\t\treturn {\n\t\t\t\tcurrentUserMessage: ai.currentUserMessage(),\n\t\t\t\tshowChatContinueButton: ai.getShowChatContinueButton(),\n\t\t\t\tchatContinueButtonOnClick: ai.getChatContinueButtonOnClick(),\n\t\t\t\tdockView: ai.getDockView(),\n\t\t\t\thideInput: ai.getHideInput(),\n\t\t\t\tcurrentAssistant: ai.getAssistant(),\n\t\t\t};\n\t\t} );\n\t\tconst typingTimeout = useRef( null );\n\n\t\tconst { isOnboarded } = useSiteMetadata().getSiteMetadata();\n\t\tuseEffect( () => {\n\t\t\tif ( ! ref?.current ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tref.current?.parentNode?.style?.setProperty(\n\t\t\t\t'--big-sky-textarea-component-font-family',\n\t\t\t\twindow.getComputedStyle( ref.current ).fontFamily\n\t\t\t);\n\t\t}, [ ref ] );\n\t\tuseEffect( () => {\n\t\t\tif ( ! isThinking && ref?.current ) {\n\t\t\t\tref?.current?.focus();\n\t\t\t}\n\t\t}, [ ref, isThinking ] );\n\t\tconst characterLimit = isOnboarded ? 600 : 1200;\n\t\tconst adjustTextAreaHeight = useCallback( () => {\n\t\t\tconst textarea = ref.current;\n\t\t\tif ( textarea ) {\n\t\t\t\tconst parent = textarea.parentNode;\n\t\t\t\t// Set the after content to the full text. The ::after pseudo-element\n\t\t\t\t// will grow in height with its content. The textarea's height is tied\n\t\t\t\t// to ::after's height via CSS Grid.\n\t\t\t\tparent.dataset.all = textarea.value;\n\t\t\t\tif ( textarea.selectionStart === textarea.selectionEnd ) {\n\t\t\t\t\t// Set the before content to equal the text to the left of the cursor.\n\t\t\t\t\t// This way, the ::before pseudo-element's height will be the same as\n\t\t\t\t\t// the cursor's position in the textarea's scrollHeight.\n\t\t\t\t\tparent.dataset.before = textarea.value.slice(\n\t\t\t\t\t\t0,\n\t\t\t\t\t\ttextarea.selectionStart\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\t// If there's an active selection, don't try to do anything interesting.\n\t\t\t\t\tparent.dataset.before = '';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst before = window.getComputedStyle( parent, ':before' );\n\t\t\t\tconst height = Math.round( parseFloat( before.height ) );\n\t\t\t\tif ( textarea.scrollHeight === height ) {\n\t\t\t\t\t// If we're typing in the last line of text in the textarea,\n\t\t\t\t\t// make sure we're scrolled all the way to the bottom.\n\t\t\t\t\ttextarea.scrollTop = textarea.scrollHeight;\n\t\t\t\t} else if (\n\t\t\t\t\theight <=\n\t\t\t\t\tparseInt(\n\t\t\t\t\t\twindow.getComputedStyle( textarea ).minHeight,\n\t\t\t\t\t\t10\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\t// If we're typing in the first line (or so) of text in the textarea,\n\t\t\t\t\t// make sure we're scrolled all the way to the top.\n\t\t\t\t\ttextarea.scrollTop = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}, [ ref ] );\n\n\t\tuseEffect( () => {\n\t\t\tif (\n\t\t\t\t[ dockViews.MENUS, dockViews.CHAT, dockViews.HANDOFF ].includes(\n\t\t\t\t\tdockView\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tadjustTextAreaHeight();\n\t\t\t}\n\t\t}, [ currentUserMessage, adjustTextAreaHeight, dockView ] );\n\n\t\tconst handleInputChange = ( value ) => {\n\t\t\tsetCurrentUserMessage( value );\n\t\t\tif ( value.length <= characterLimit ) {\n\t\t\t\tif ( errorTooLong ) {\n\t\t\t\t\tsetErrorTooLong( '' );\n\t\t\t\t}\n\t\t\t\tsetHasRecordedLongMessage( false );\n\t\t\t} else {\n\t\t\t\tif ( ! hasRecordedLongMessage ) {\n\t\t\t\t\trecordTracksEvent( 'chat_input_message_too_long', {\n\t\t\t\t\t\tis_onboarded: isOnboarded,\n\t\t\t\t\t} );\n\t\t\t\t\tsetHasRecordedLongMessage( true );\n\t\t\t\t}\n\t\t\t\tconst inputError = sprintf(\n\t\t\t\t\t// Translators: Placeholder is a number representing the maximum number of characters allowed in a message.\n\t\t\t\t\t__( 'Your message is too long %1$s/%2$s', 'big-sky' ),\n\t\t\t\t\tvalue.length,\n\t\t\t\t\tcharacterLimit\n\t\t\t\t);\n\t\t\t\tsetErrorTooLong( inputError );\n\t\t\t}\n\t\t};\n\n\t\tconst sendMessage = useCallback( async () => {\n\t\t\trecordTracksEvent( 'chat_input_send_message' );\n\t\t\tsetErrorTooLong( '' );\n\t\t\tsetChatComponents( [] );\n\t\t\tresetChangeAgentCount();\n\t\t\tsetContext(\n\t\t\t\tassistantsById( currentAssistant )?.toolkits[ 0 ]?.name,\n\t\t\t\t{\n\t\t\t\t\tfromAssistantId: null,\n\t\t\t\t}\n\t\t\t);\n\t\t\tif ( args && respond ) {\n\t\t\t\tawait withJetpackTokenRequest( () => {\n\t\t\t\t\trespond( currentUserMessage );\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tlogUserMessage( currentUserMessage );\n\t\t\t\tawait withJetpackTokenRequest( () => {\n\t\t\t\t\tuserSay( currentUserMessage );\n\t\t\t\t} );\n\t\t\t}\n\t\t\tsetChatComponents( [] );\n\t\t\tsetCurrentUserMessage( '' );\n\t\t\tsetSubmitButtonEnabled( false );\n\t\t\tsetShowThread( true );\n\t\t\tconst textarea = ref.current;\n\t\t\ttextarea?.style?.removeProperty( 'height' );\n\t\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t\t}, [\n\t\t\tsetChatComponents,\n\t\t\targs,\n\t\t\trespond,\n\t\t\tsetCurrentUserMessage,\n\t\t\tsetShowThread,\n\t\t\tref,\n\t\t\twithJetpackTokenRequest,\n\t\t\tcurrentUserMessage,\n\t\t\tlogUserMessage,\n\t\t\tuserSay,\n\t\t] );\n\n\t\tconst handleSubmit = useCallback( async () => {\n\t\t\tsetSubmitButtonEnabled( false );\n\n\t\t\tif ( onSendMessage ) {\n\t\t\t\tawait onSendMessage( currentUserMessage );\n\t\t\t}\n\t\t\tsendMessage();\n\t\t}, [ onSendMessage, currentUserMessage, sendMessage ] );\n\n\t\tconst handleTextAreaKeyDown = ( e ) => {\n\t\t\tif ( ( e.key === 'Enter' && ! e.shiftKey ) || e.key === 'Escape' ) {\n\t\t\t\te.preventDefault();\n\t\t\t} else {\n\t\t\t\tsetIsTyping( true );\n\t\t\t}\n\t\t};\n\n\t\t// detect enter key and send message\n\t\tconst handleTextAreaKeyUp = ( e ) => {\n\t\t\tif ( e.key === 'Enter' && ! e.shiftKey && ! errorTooLong ) {\n\t\t\t\tif ( currentUserMessage.trim() === '' ) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tsetCurrentUserMessage( '' );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\thandleSubmit();\n\t\t\t}\n\n\t\t\tif ( typingTimeout.current ) {\n\t\t\t\tclearTimeout( typingTimeout.current );\n\t\t\t}\n\n\t\t\ttypingTimeout.current = setTimeout( () => {\n\t\t\t\tsetIsTyping( false );\n\t\t\t}, 800 );\n\t\t};\n\n\t\tif ( hideInput ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{ errorTooLong && (\n\t\t\t\t\t<div className=\"big-sky__chat-input__error-too-long\">\n\t\t\t\t\t\t<ChatMessage\n\t\t\t\t\t\t\tmessage={ {\n\t\t\t\t\t\t\t\tcontent: errorTooLong,\n\t\t\t\t\t\t\t\trole: messageRoles.ERROR,\n\t\t\t\t\t\t\t\ttype: messageRoles.ERROR,\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t) }\n\t\t\t\t<motion.div\n\t\t\t\t\tclassName=\"big-sky__chat-input\"\n\t\t\t\t\t{ ...animationProps }\n\t\t\t\t\tkey=\"chat-input\"\n\t\t\t\t>\n\t\t\t\t\t{ showChatContinueButton && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tclassName=\"big-sky__chat-input__continue\"\n\t\t\t\t\t\t\t\tonClick={ chatContinueButtonOnClick }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ __( 'Continue', 'big-sky' ) }\n\t\t\t\t\t\t\t</Button>\n\n\t\t\t\t\t\t\t<div className=\"big-sky__chat-input__ask-ai\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\ticon={ AskAI }\n\t\t\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\t\t\tsetShowChatContinueButton( false );\n\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t\t\t\t'Try something different',\n\t\t\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) }\n\n\t\t\t\t\t{ ! showChatContinueButton && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<TextareaControl\n\t\t\t\t\t\t\t\tclassName=\"big-sky__chat-input__textarea\"\n\t\t\t\t\t\t\t\tresizable=\"false\"\n\t\t\t\t\t\t\t\trows={ 1 }\n\t\t\t\t\t\t\t\t__nextHasNoMarginBottom={ true }\n\t\t\t\t\t\t\t\tonChange={ ( content ) => {\n\t\t\t\t\t\t\t\t\thandleInputChange( content );\n\t\t\t\t\t\t\t\t\tsetSubmitButtonEnabled(\n\t\t\t\t\t\t\t\t\t\tcontent.length > 0\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\tlabel={ __( 'Chat Input', 'big-sky' ) }\n\t\t\t\t\t\t\t\thideLabelFromVision={ true }\n\t\t\t\t\t\t\t\tplaceholder={ prompt }\n\t\t\t\t\t\t\t\tvalue={ currentUserMessage }\n\t\t\t\t\t\t\t\tonKeyUp={ handleTextAreaKeyUp }\n\t\t\t\t\t\t\t\tonKeyDown={ handleTextAreaKeyDown }\n\t\t\t\t\t\t\t\tdisabled={ isThinking }\n\t\t\t\t\t\t\t\tref={ ref }\n\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\ticon={ ArrowUp }\n\t\t\t\t\t\t\t\tclassName=\"big-sky__chat-input__submit\"\n\t\t\t\t\t\t\t\tonClick={ handleSubmit }\n\t\t\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\t\t\t! submitButtonEnabled ||\n\t\t\t\t\t\t\t\t\tisThinking ||\n\t\t\t\t\t\t\t\t\terrorTooLong\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) }\n\t\t\t\t</motion.div>\n\t\t\t</>\n\t\t);\n\t}\n);\n\nexport default ChatInput;\n","/**\n * WordPress dependencies\n */\nimport { Path, SVG } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst resizeCornerNE = /*#__PURE__*/_jsx(SVG, {\n  viewBox: \"0 0 24 24\",\n  xmlns: \"http://www.w3.org/2000/svg\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"M7 18h4.5v1.5h-7v-7H6V17L17 6h-4.5V4.5h7v7H18V7L7 18Z\"\n  })\n});\nexport default resizeCornerNE;\n//# sourceMappingURL=resize-corner-n-e.js.map","/**\n * WordPress dependencies\n */\nimport { Button } from '@wordpress/components';\nimport { resizeCornerNE } from '@wordpress/icons';\nimport { useDispatch, useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { store as aiStore } from '@store';\n\nexport default function ResizeButton() {\n\tconst { isMaximized } = useSelect( ( select ) => ( {\n\t\tisMaximized: select( aiStore ).getIsMaximized(),\n\t} ) );\n\tconst { setIsMaximized } = useDispatch( aiStore );\n\treturn (\n\t\t<Button\n\t\t\ticon={ resizeCornerNE }\n\t\t\tclassName=\"big-sky__chat-navigation__resize\"\n\t\t\tsize=\"compact\"\n\t\t\tonClick={ () => setIsMaximized( ! isMaximized ) }\n\t\t/>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { Button } from '@wordpress/components';\nimport { chevronLeft } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport ResizeButton from '@components/chat/navigation/resize-button';\n\nexport default function ChatNavigation( { title, onClickBackButton } ) {\n\tconst { isOnboarded } = useSiteMetadata().getSiteMetadata();\n\n\treturn (\n\t\t<div className=\"big-sky__chat-navigation\">\n\t\t\t{ isOnboarded && (\n\t\t\t\t<Button\n\t\t\t\t\ticon={ chevronLeft }\n\t\t\t\t\tclassName=\"big-sky__chat-navigation__back\"\n\t\t\t\t\tonClick={ () => onClickBackButton() }\n\t\t\t\t\tsize=\"compact\"\n\t\t\t\t/>\n\t\t\t) }\n\t\t\t{ title && <h4>{ title }</h4> }\n\t\t\t<ResizeButton />\n\t\t</div>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { cloneElement, forwardRef } from '@wordpress/element';\n\n/** @typedef {{icon: JSX.Element, size?: number} & import('@wordpress/primitives').SVGProps} IconProps */\n\n/**\n * Return an SVG icon.\n *\n * @param {IconProps}                                 props icon is the SVG component to render\n *                                                          size is a number specifiying the icon size in pixels\n *                                                          Other props will be passed to wrapped SVG component\n * @param {import('react').ForwardedRef<HTMLElement>} ref   The forwarded ref to the SVG element.\n *\n * @return {JSX.Element}  Icon component\n */\nfunction Icon({\n  icon,\n  size = 24,\n  ...props\n}, ref) {\n  return cloneElement(icon, {\n    width: size,\n    height: size,\n    ...props,\n    ref\n  });\n}\nexport default forwardRef(Icon);\n//# sourceMappingURL=index.js.map","/**\n * WordPress dependencies\n */\nimport { SVG, Path } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst title = /*#__PURE__*/_jsx(SVG, {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 24 24\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"m4 5.5h2v6.5h1.5v-6.5h2v-1.5h-5.5zm16 10.5h-16v-1.5h16zm-7 4h-9v-1.5h9z\"\n  })\n});\nexport default title;\n//# sourceMappingURL=title.js.map","/**\n * Internal dependencies\n */\n\nimport { default as pencil } from './pencil';\nexport default pencil;\n//# sourceMappingURL=edit.js.map","/**\n * WordPress dependencies\n */\nimport { SVG, Path } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst pencil = /*#__PURE__*/_jsx(SVG, {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 24 24\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z\"\n  })\n});\nexport default pencil;\n//# sourceMappingURL=pencil.js.map","/**\n * WordPress dependencies\n */\nimport { SVG, Path } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst tag = /*#__PURE__*/_jsx(SVG, {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 24 24\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"M6.08 10.103h2.914L9.657 12h1.417L8.23 4H6.846L4 12h1.417l.663-1.897Zm1.463-4.137.994 2.857h-2l1.006-2.857ZM11 16H4v-1.5h7V16Zm1 0h8v-1.5h-8V16Zm-4 4H4v-1.5h4V20Zm7-1.5V20H9v-1.5h6Z\"\n  })\n});\nexport default tag;\n//# sourceMappingURL=term-description.js.map","/**\n * WordPress dependencies\n */\nimport { SVG, Path } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst mapMarker = /*#__PURE__*/_jsx(SVG, {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 24 24\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"M12 9c-.8 0-1.5.7-1.5 1.5S11.2 12 12 12s1.5-.7 1.5-1.5S12.8 9 12 9zm0-5c-3.6 0-6.5 2.8-6.5 6.2 0 .8.3 1.8.9 3.1.5 1.1 1.2 2.3 2 3.6.7 1 3 3.8 3.2 3.9l.4.5.4-.5c.2-.2 2.6-2.9 3.2-3.9.8-1.2 1.5-2.5 2-3.6.6-1.3.9-2.3.9-3.1C18.5 6.8 15.6 4 12 4zm4.3 8.7c-.5 1-1.1 2.2-1.9 3.4-.5.7-1.7 2.2-2.4 3-.7-.8-1.9-2.3-2.4-3-.8-1.2-1.4-2.3-1.9-3.3-.6-1.4-.7-2.2-.7-2.5 0-2.6 2.2-4.7 5-4.7s5 2.1 5 4.7c0 .2-.1 1-.7 2.4z\"\n  })\n});\nexport default mapMarker;\n//# sourceMappingURL=map-marker.js.map","/**\n * WordPress dependencies\n */\nimport {\n\tedit,\n\tIcon,\n\tmapMarker,\n\ttermDescription,\n\ttitle,\n} from '@wordpress/icons';\nimport { Tooltip } from '@wordpress/components';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { useEffect, useMemo, useState } from '@wordpress/element';\nimport { useDispatch } from '@wordpress/data';\nimport { useChat, withToolCall } from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport { store as aiStore } from '@store';\nimport ChatMessage from '@components/chat/message';\nimport { ChatSuggestions } from '@ai/assistants/shared/make-suggestions';\nimport { messageRoles } from '@utils/constants';\nimport { recordTracksEvent } from '@utils/tracks';\nimport useJetpackToken from '@hooks/use-jetpack-token';\nimport './style.scss';\n\nfunction SiteSpecsList( { args, respond, onLoad } ) {\n\tconst { withJetpackTokenRequest } = useJetpackToken();\n\tconst { userSay, running } = useChat();\n\tconst { setSiteMetadata, getSiteMetadata } = useSiteMetadata();\n\tconst { setCurrentUserMessage, setChatComponents } = useDispatch( aiStore );\n\tconst currentSiteMetadata = getSiteMetadata();\n\tconst { isOnboarded } = currentSiteMetadata;\n\tconst hoveringOffState = {\n\t\ttitle: false,\n\t\tdescription: false,\n\t\tlocation: false,\n\t};\n\n\tconst [ isHovering, setIsHovering ] = useState( hoveringOffState );\n\tconst {\n\t\tsiteTitle,\n\t\tsiteType,\n\t\ttopic,\n\t\tsiteDescription,\n\t\tsiteLocationName,\n\t\tdefaultImageStyle,\n\t\tactions,\n\t} = {\n\t\t...currentSiteMetadata,\n\t\tsiteLocationName: currentSiteMetadata.siteLocation?.name,\n\t\t...Object.fromEntries(\n\t\t\tObject.entries( args || {} ).filter( ( [ , value ] ) => !! value )\n\t\t), // only include args that have a value, fallback to currentSiteMetadata\n\t};\n\n\tconst siteMeta = useMemo(\n\t\t() => ( {\n\t\t\tsiteType,\n\t\t\ttopic,\n\t\t\tsiteTitle,\n\t\t\tsiteDescription,\n\t\t\tdefaultImageStyle,\n\t\t\tsiteLocation: {\n\t\t\t\tname: siteLocationName,\n\t\t\t},\n\t\t} ),\n\t\t[\n\t\t\tsiteType,\n\t\t\ttopic,\n\t\t\tsiteTitle,\n\t\t\tsiteDescription,\n\t\t\tsiteLocationName,\n\t\t\tdefaultImageStyle,\n\t\t]\n\t);\n\n\tconst hasSpecs = siteTitle || siteDescription || siteLocationName;\n\n\tuseEffect( () => {\n\t\tif ( onLoad ) {\n\t\t\tonLoad();\n\t\t}\n\t}, [ onLoad ] );\n\n\tuseEffect( () => {\n\t\tif ( hasSpecs && ! isOnboarded ) {\n\t\t\tconst specActions = actions || [\n\t\t\t\t{\n\t\t\t\t\tactionName: __( 'Looks good', 'big-sky' ),\n\t\t\t\t\tdescription: sprintf(\n\t\t\t\t\t\t/* Translators: placeholder is the site title */\n\t\t\t\t\t\t__( 'Build %s', 'big-sky' ),\n\t\t\t\t\t\tsiteTitle\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t];\n\t\t\tsetChatComponents( [\n\t\t\t\t<ChatSuggestions\n\t\t\t\t\tkey=\"suggestions\"\n\t\t\t\t\targs={ {\n\t\t\t\t\t\tsiteTitle,\n\t\t\t\t\t\tsiteType,\n\t\t\t\t\t\ttopic,\n\t\t\t\t\t\tsiteDescription,\n\t\t\t\t\t\tsiteLocationName,\n\t\t\t\t\t\tactions: specActions,\n\t\t\t\t\t} }\n\t\t\t\t\trespond={ () => {\n\t\t\t\t\t\tsetSiteMetadata( siteMeta, false, true );\n\t\t\t\t\t\tif ( args ) {\n\t\t\t\t\t\t\trespond( specActions[ 0 ]?.description );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst message = specActions[ 0 ]?.description;\n\t\t\t\t\t\tsetCurrentUserMessage( message );\n\t\t\t\t\t\twithJetpackTokenRequest( () => userSay( message ) );\n\t\t\t\t\t} }\n\t\t\t\t/>,\n\t\t\t] );\n\t\t}\n\t}, [\n\t\tsetChatComponents,\n\t\tsetSiteMetadata,\n\t\trespond,\n\t\tsiteMeta,\n\t\thasSpecs,\n\t\tsiteTitle,\n\t\tsiteType,\n\t\ttopic,\n\t\tsiteDescription,\n\t\tsiteLocationName,\n\t\tactions,\n\t\tisOnboarded,\n\t\targs,\n\t\tsetCurrentUserMessage,\n\t\twithJetpackTokenRequest,\n\t\tuserSay,\n\t] );\n\n\tif ( ( ! args && ! currentSiteMetadata?.siteTitle ) || isOnboarded ) {\n\t\treturn null;\n\t}\n\n\tconst upperCaseFirstLetter = ( specContent ) =>\n\t\tspecContent\n\t\t\t? `${ specContent.charAt( 0 ).toUpperCase() }${ specContent.slice(\n\t\t\t\t\t1\n\t\t\t  ) }`\n\t\t\t: '';\n\n\tconst handleTableRowClick = ( specItem ) => {\n\t\trecordTracksEvent( 'site_specs_list_click', {\n\t\t\tspec_item: specItem,\n\t\t} );\n\t\tsetCurrentUserMessage( `Change my ${ specItem } to ` );\n\t\tdocument.querySelector( '.big-sky__ai-input__input textarea' )?.focus();\n\t};\n\n\tif ( ! hasSpecs || running ) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<ChatMessage\n\t\t\tmessage={ {\n\t\t\t\trole: messageRoles.COMPONENT,\n\t\t\t\tcontent: (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<table className=\"big-sky__spec-list\">\n\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t<tr\n\t\t\t\t\t\t\t\t\tonClick={ () =>\n\t\t\t\t\t\t\t\t\t\thandleTableRowClick( 'site title' )\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tonMouseEnter={ () =>\n\t\t\t\t\t\t\t\t\t\tsetIsHovering( {\n\t\t\t\t\t\t\t\t\t\t\ttitle: true,\n\t\t\t\t\t\t\t\t\t\t\tdescription: false,\n\t\t\t\t\t\t\t\t\t\t\tlocation: false,\n\t\t\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tonMouseLeave={ () =>\n\t\t\t\t\t\t\t\t\t\tsetIsHovering( hoveringOffState )\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<td className=\"big-sky__spec-icon\">\n\t\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\t\ttext={ __(\n\t\t\t\t\t\t\t\t\t\t\t\t'Click to update site title',\n\t\t\t\t\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t{ ! isHovering.title && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Icon icon={ title } />\n\t\t\t\t\t\t\t\t\t\t\t\t) }\n\n\t\t\t\t\t\t\t\t\t\t\t\t{ isHovering.title && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Icon icon={ edit } />\n\t\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\t\ttext={ __(\n\t\t\t\t\t\t\t\t\t\t\t\t'Click to update site title',\n\t\t\t\t\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<span>{ siteTitle }</span>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr\n\t\t\t\t\t\t\t\t\tonClick={ () =>\n\t\t\t\t\t\t\t\t\t\thandleTableRowClick(\n\t\t\t\t\t\t\t\t\t\t\t'site description'\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tonMouseEnter={ () =>\n\t\t\t\t\t\t\t\t\t\tsetIsHovering( {\n\t\t\t\t\t\t\t\t\t\t\ttitle: false,\n\t\t\t\t\t\t\t\t\t\t\tdescription: true,\n\t\t\t\t\t\t\t\t\t\t\tlocation: false,\n\t\t\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tonMouseLeave={ () =>\n\t\t\t\t\t\t\t\t\t\tsetIsHovering( hoveringOffState )\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<td className=\"big-sky__spec-icon\">\n\t\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\t\ttext={ __(\n\t\t\t\t\t\t\t\t\t\t\t\t'Click to update description',\n\t\t\t\t\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t{ ! isHovering.description && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Icon\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ticon={ termDescription }\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t\t\t{ isHovering.description && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Icon icon={ edit } />\n\t\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\t\ttext={ __(\n\t\t\t\t\t\t\t\t\t\t\t\t'Click to update description',\n\t\t\t\t\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t\t{ upperCaseFirstLetter(\n\t\t\t\t\t\t\t\t\t\t\t\t\tsiteDescription\n\t\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t{ siteLocationName && (\n\t\t\t\t\t\t\t\t\t<tr\n\t\t\t\t\t\t\t\t\t\tonClick={ () =>\n\t\t\t\t\t\t\t\t\t\t\thandleTableRowClick( 'location' )\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tonMouseEnter={ () =>\n\t\t\t\t\t\t\t\t\t\t\tsetIsHovering( {\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: false,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: false,\n\t\t\t\t\t\t\t\t\t\t\t\tlocation: true,\n\t\t\t\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tonMouseLeave={ () =>\n\t\t\t\t\t\t\t\t\t\t\tsetIsHovering( hoveringOffState )\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<td className=\"big-sky__spec-icon\">\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\t\t\ttext={ __(\n\t\t\t\t\t\t\t\t\t\t\t\t\t'Click to update location',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{ ! isHovering.location && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Icon\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ticon={ mapMarker }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t\t\t\t{ isHovering.location && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Icon icon={ edit } />\n\t\t\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\t\t\ttext={ __(\n\t\t\t\t\t\t\t\t\t\t\t\t\t'Click to update location',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{ siteLocationName }\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t</table>\n\n\t\t\t\t\t\t{ args && (\n\t\t\t\t\t\t\t<div className=\"big-sky__site-specs-list-confirm\">\n\t\t\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t\t\t'Do the above details look correct?',\n\t\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</>\n\t\t\t\t),\n\t\t\t} }\n\t\t/>\n\t);\n}\nexport default withToolCall( 'confirm_site_specs', SiteSpecsList );\n","/**\n * WordPress dependencies\n */\nimport { __unstableMotion as motion, Notice } from '@wordpress/components';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport {\n\tcreateInterpolateElement,\n\tuseEffect,\n\tuseRef,\n} from '@wordpress/element';\nimport { useChat } from '@automattic/big-sky-agents';\nimport { __, sprintf } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\nimport SiteSpecsList from '@ai/assistants/spec/tools/confirm-site-specs/site-specs-list';\nimport ChatMessage from '@components/chat/message';\nimport ThinkingMessage from '@components/thinking-message';\nimport useIsThinking from '@hooks/use-is-thinking';\nimport { store as aiStore } from '@store';\nimport { messageRoles } from '@utils/constants';\nimport { fetchJetpackToken } from '@utils/request-jetpack-token.ts';\nimport { recordTracksEvent } from '@utils/tracks';\n\nexport default function ChatThread( { onlyShowLastRequest = false } ) {\n\tconst { hasRetriedChatRequest, getSessionId } = useSelect( ( select ) => ( {\n\t\thasRetriedChatRequest: select( aiStore ).getHasRetriedChatRequest(),\n\t\tgetSessionId: select( aiStore ).getSessionId(),\n\t} ) );\n\tconst { messages, error, setError } = useChat();\n\tconst messagesEndRef = useRef();\n\tconst { isThinking } = useIsThinking();\n\tconst { setApiKey, setHasRetriedChatRequest } = useDispatch( aiStore );\n\tconst scrollToBottom = () => {\n\t\tconst doScroll = () => {\n\t\t\tmessagesEndRef.current?.scrollIntoView( { behavior: 'smooth' } );\n\t\t};\n\t\tconst timeoutId = setTimeout( doScroll, 100 );\n\t\treturn () => clearTimeout( timeoutId );\n\t};\n\n\tconst isUnauthorizedError = error === 'Unauthorized';\n\tuseEffect( () => {\n\t\t// If this is an Unauthorized error, fetch a new token and try again\n\t\tconst retry = async () => {\n\t\t\tawait fetchJetpackToken( setApiKey, false );\n\t\t\tsetError( '' );\n\t\t\tsetHasRetriedChatRequest( true );\n\t\t};\n\n\t\tif ( isUnauthorizedError && ! hasRetriedChatRequest ) {\n\t\t\tretry();\n\t\t}\n\t}, [\n\t\terror,\n\t\tisUnauthorizedError,\n\t\tmessages,\n\t\tsetApiKey,\n\t\tsetError,\n\t\thasRetriedChatRequest,\n\t\tsetHasRetriedChatRequest,\n\t] );\n\n\tuseEffect( () => {\n\t\tscrollToBottom();\n\t}, [ messages ] );\n\n\tconst dismissError = () => {\n\t\trecordTracksEvent( 'error_dismissed' );\n\t\tsetError( '' );\n\t};\n\n\treturn (\n\t\t<motion.div\n\t\t\tclassName=\"big-sky__chat-thread\"\n\t\t\tinitial={ { opacity: 0, y: 10 } }\n\t\t\tanimate={ {\n\t\t\t\topacity: 1,\n\t\t\t\ty: 0,\n\t\t\t\ttransition: {\n\t\t\t\t\tduration: 0.2,\n\t\t\t\t},\n\t\t\t} }\n\t\t\texit={ {\n\t\t\t\topacity: 0,\n\t\t\t\ty: -10,\n\t\t\t\ttransition: {\n\t\t\t\t\tduration: 0.2,\n\t\t\t\t},\n\t\t\t} }\n\t\t\tkey=\"chat-thread\"\n\t\t>\n\t\t\t<motion.div className=\"big-sky__chat-thread__scroller\" layoutRoot>\n\t\t\t\t{ messages\n\t\t\t\t\t?.filter( ( message, index, array ) => {\n\t\t\t\t\t\t// Find the last user message index\n\t\t\t\t\t\tconst lastUserIndex = array\n\t\t\t\t\t\t\t.map( ( m ) => m.role )\n\t\t\t\t\t\t\t.lastIndexOf( messageRoles.USER );\n\n\t\t\t\t\t\t// Only show messages from the last user message onwards\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tindex >=\n\t\t\t\t\t\t\t\t( onlyShowLastRequest ? lastUserIndex : 0 ) &&\n\t\t\t\t\t\t\tmessage.content !== '' &&\n\t\t\t\t\t\t\tmessage.role !== messageRoles.TOOL &&\n\t\t\t\t\t\t\tmessage.role !== messageRoles.SYSTEM &&\n\t\t\t\t\t\t\t( message.role !== messageRoles.ASSISTANT ||\n\t\t\t\t\t\t\t\tmessage.tool_calls?.[ 0 ]?.function.name !==\n\t\t\t\t\t\t\t\t\t'make_suggestions' )\n\t\t\t\t\t\t);\n\t\t\t\t\t} )\n\t\t\t\t\t.map( ( message, index ) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<ChatMessage message={ message } key={ index } />\n\t\t\t\t\t\t);\n\t\t\t\t\t} ) }\n\t\t\t\t{ error &&\n\t\t\t\t\t( ! isUnauthorizedError || hasRetriedChatRequest ) && (\n\t\t\t\t\t\t<Notice\n\t\t\t\t\t\t\tstatus=\"error\"\n\t\t\t\t\t\t\tpoliteness=\"assertive\"\n\t\t\t\t\t\t\tonRemove={ dismissError }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ error.includes( 'openai_error' )\n\t\t\t\t\t\t\t\t? __(\n\t\t\t\t\t\t\t\t\t\t'Whoops! Our AI is having some issues right now. Please try again later.',\n\t\t\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t\t  )\n\t\t\t\t\t\t\t\t: createInterpolateElement(\n\t\t\t\t\t\t\t\t\t\tsprintf(\n\t\t\t\t\t\t\t\t\t\t\t/* translators: %s is a reference for debugging, support is an inline link \"contact support\" to the support page */\n\t\t\t\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\t\t\t'Something went wrong. Please try again or <support></support> with reference: %s',\n\t\t\t\t\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\tgetSessionId\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tsupport: (\n\t\t\t\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\t\t\thref=\"https://wordpress.com/help?help-center=wapuu\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'contact support',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t  ) }\n\t\t\t\t\t\t</Notice>\n\t\t\t\t\t) }\n\t\t\t\t{ isThinking && <ThinkingMessage /> }\n\t\t\t\t<SiteSpecsList onLoad={ scrollToBottom } />\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"big-sky__chat-thread__end\"\n\t\t\t\t\tref={ messagesEndRef }\n\t\t\t\t/>\n\t\t\t</motion.div>\n\t\t</motion.div>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { __unstableMotion as motion } from '@wordpress/components';\nimport { useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport useIsThinking from '@hooks/use-is-thinking';\nimport { store as aiStore } from '@store';\n\nexport default function ChatComponents() {\n\tconst { chatComponents } = useSelect( ( select ) => ( {\n\t\tchatComponents: select( aiStore ).getChatComponents(),\n\t} ) );\n\tconst { isThinking } = useIsThinking();\n\n\tif ( ! chatComponents || chatComponents.length === 0 || isThinking ) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<motion.div\n\t\t\tclassName=\"big-sky__chat-components\"\n\t\t\tinitial={ { opacity: 0, y: 20 } }\n\t\t\tlayout\n\t\t\tanimate={ {\n\t\t\t\topacity: 1,\n\t\t\t\ty: 0,\n\t\t\t\ttransition: {\n\t\t\t\t\tduration: 0.2,\n\t\t\t\t\tdelay: 0.14,\n\t\t\t\t},\n\t\t\t} }\n\t\t\texit={ {\n\t\t\t\topacity: 0,\n\t\t\t\ty: -10,\n\t\t\t\ttransition: {\n\t\t\t\t\tduration: 0.2,\n\t\t\t\t},\n\t\t\t} }\n\t\t\tkey=\"chat-components-actions\"\n\t\t>\n\t\t\t{ chatComponents.map( ( component, index ) => (\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"big-sky__chat-components-component\"\n\t\t\t\t\tkey={ index }\n\t\t\t\t>\n\t\t\t\t\t{ component }\n\t\t\t\t</div>\n\t\t\t) ) }\n\t\t</motion.div>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport {\n\t__unstableAnimatePresence as AnimatePresence,\n\t__unstableMotion as motion,\n} from '@wordpress/components';\nimport { useEffect } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport useBigSkyIcon from '@hooks/use-big-sky-icon';\nimport useIsThinking from '@hooks/use-is-thinking';\nimport { store as aiStore } from '@store/index';\n\nexport default function BigSkyIcon( {\n\tcolor = 'blue',\n\tinstanceId,\n\tonClick,\n\twidth = 32,\n\theight = 32,\n} ) {\n\tconst { RiveComponent, inactiveInput, typingInput, thinkingInput } =\n\t\tuseBigSkyIcon( color );\n\n\tconst { isTyping } = useSelect( ( select ) => {\n\t\tconst ai = select( aiStore );\n\t\treturn {\n\t\t\tisTyping: ai.getIsTyping(),\n\t\t};\n\t} );\n\tconst { isThinking } = useIsThinking();\n\n\tuseEffect( () => {\n\t\tif ( typingInput ) {\n\t\t\ttypingInput.value = isTyping;\n\t\t}\n\n\t\tif ( thinkingInput ) {\n\t\t\tthinkingInput.value = isThinking;\n\t\t}\n\n\t\tif ( inactiveInput ) {\n\t\t\tinactiveInput.value = ! isTyping && ! isThinking;\n\t\t}\n\t}, [ isTyping, isThinking, typingInput, thinkingInput, inactiveInput ] );\n\n\tconst iconAnimate = {\n\t\tdefault: {\n\t\t\tscale: 1,\n\t\t\ty: 0,\n\t\t\tx: 0,\n\t\t},\n\t\twaiting: {\n\t\t\tscale: [ 0.5, 0.6, 0.5 ],\n\t\t\ty: [ -10, 10, -10 ],\n\t\t\tx: [ 0, 0, 0 ],\n\t\t\ttransition: {\n\t\t\t\tease: 'easeInOut',\n\t\t\t\trepeat: Infinity,\n\t\t\t\tduration: 1.5,\n\t\t\t},\n\t\t},\n\t\twaitingEnter: {\n\t\t\tscale: 0.5,\n\t\t\ty: -10,\n\t\t\tx: 0,\n\t\t\ttransition: { ease: 'easeInOut', duration: 0.3 },\n\t\t},\n\t\twaitingExit: {\n\t\t\tscale: 1,\n\t\t\ty: 0,\n\t\t\tx: 0,\n\t\t\ttransition: { ease: 'easeInOut', duration: 0.3 },\n\t\t},\n\t};\n\n\treturn (\n\t\t<AnimatePresence mode=\"wait\">\n\t\t\t<motion.div\n\t\t\t\tvariants={ iconAnimate }\n\t\t\t\tinitial={ { x: 0 } }\n\t\t\t\tclassName=\"big-sky__assistant-icon\"\n\t\t\t\tid={ instanceId }\n\t\t\t\tonClick={ ( e ) => {\n\t\t\t\t\tif ( onClick ) {\n\t\t\t\t\t\tonClick( e );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn e.preventDefault();\n\t\t\t\t} }\n\t\t\t>\n\t\t\t\t<RiveComponent style={ { width, height } } />\n\t\t\t</motion.div>\n\t\t</AnimatePresence>\n\t);\n}\n","import { useRive, useStateMachineInput } from '@rive-app/react-canvas';\nimport { useCallback, useEffect } from '@wordpress/element';\n\nexport default function useBigSkyIcon( color = 'blue' ) {\n\tconst stateMachineName = 'State Machine A';\n\n\tconst iconURL =\n\t\t'https://s0.wp.com/wp-content/plugins/big-sky-plugin/assets/big-sky-icon';\n\tconst blueIcon = `${ iconURL }/blue.riv`;\n\tconst whiteIcon = `${ iconURL }/white.riv`;\n\n\tconst { rive, RiveComponent } = useRive( {\n\t\tsrc: color === 'blue' ? blueIcon : whiteIcon,\n\t\tstateMachines: stateMachineName,\n\t\tautoplay: false,\n\t} );\n\n\tconst inactiveInput = useStateMachineInput(\n\t\trive,\n\t\tstateMachineName,\n\t\t'inactive',\n\t\tfalse\n\t);\n\tconst thinkingInput = useStateMachineInput(\n\t\trive,\n\t\tstateMachineName,\n\t\t'thinking',\n\t\tfalse\n\t);\n\tconst typingInput = useStateMachineInput(\n\t\trive,\n\t\tstateMachineName,\n\t\t'typing',\n\t\tfalse\n\t);\n\n\tconst startStateMachine = useCallback( () => {\n\t\tif ( rive ) {\n\t\t\trive.play( stateMachineName );\n\t\t}\n\t}, [ rive, stateMachineName ] );\n\n\tconst pauseStateMachine = useCallback( () => {\n\t\tif ( rive ) {\n\t\t\trive.pause( stateMachineName );\n\t\t}\n\t}, [ rive, stateMachineName ] );\n\n\tuseEffect( () => {\n\t\treturn () => {\n\t\t\tif ( rive ) {\n\t\t\t\trive.cleanup();\n\t\t\t}\n\t\t};\n\t}, [ rive ] );\n\n\tuseEffect( () => {\n\t\tstartStateMachine();\n\t}, [ startStateMachine ] );\n\n\treturn {\n\t\trive,\n\t\tRiveComponent,\n\t\tinactiveInput,\n\t\ttypingInput,\n\t\tthinkingInput,\n\t\tstartStateMachine,\n\t\tpauseStateMachine,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport {\n\tButton,\n\tDropZone,\n\t__experimentalItem as Item,\n\t__experimentalItemGroup as ItemGroup,\n} from '@wordpress/components';\nimport { useCallback, useEffect, useRef } from '@wordpress/element';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { close } from '@wordpress/icons';\n\nimport {\n\tChatModelService,\n\tChatModelType,\n\tuseAgentExecutor,\n\tuseAgents,\n\tuseChat,\n\tuseChatSettings,\n\tuseToolkits,\n} from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\nimport ChatInput from '@components/chat/input';\nimport ChatActions from '@components/chat/actions';\nimport ChatNavigation from '@components/chat/navigation';\nimport ChatThread from '@components/chat/thread';\nimport useIsThinking from '@hooks/use-is-thinking';\nimport useJetpackToken from '@hooks/use-jetpack-token';\nimport { store as aiStore } from '@store';\nimport ChatSuggestions from '@ai/assistants/shared/make-suggestions';\nimport ChatComponents from '@components/chat/components';\nimport BigSkyIcon from '@components/big-sky-icon';\n\nexport default function AgentChat( {\n\tshowNavigation = true,\n\tnavigationTitle,\n\tonClickBackButton,\n\tuseBlockContext,\n\tdefaultPrompt,\n\tisOnboarded,\n\tagentQuestion,\n\tfileUploadEnabled = true,\n\tonlyShowLastRequest = false,\n} ) {\n\tconst {\n\t\tapiKey,\n\t\tinputtedFiles,\n\t\tisHandoff,\n\t\tshowThread,\n\t\tcurrentUserMessage,\n\t\tsessionId,\n\t\tassistant,\n\t} = useSelect( ( select ) => ( {\n\t\tapiKey: select( aiStore ).getApiKey(),\n\t\tinputtedFiles: select( aiStore ).getInputtedFiles(),\n\t\tisBuildingSite: select( aiStore ).getIsBuildingSite(),\n\t\tisHandoff: select( aiStore ).getIsHandoff(),\n\t\tshowThread: select( aiStore ).getShowThread(),\n\t\tsessionId: select( aiStore ).getSessionId(),\n\t\tcurrentUserMessage: select( aiStore ).currentUserMessage(),\n\t\tshowEditorWelcome: select( aiStore ).getShowEditorWelcome(),\n\t\tassistant: select( aiStore ).getAssistant(),\n\t} ) );\n\tconst { setCurrentUserMessage, setInputtedFiles, setShowThread } =\n\t\tuseDispatch( aiStore );\n\n\tconst { withJetpackTokenRequest } = useJetpackToken();\n\n\tconst isLocalGraph = window.bigSkyInitialState?.isLocalGraph;\n\tuseChatSettings( {\n\t\tapiKey,\n\t\tfeature: 'big-sky',\n\t\tservice: isLocalGraph\n\t\t\t? ChatModelService.LOCAL_GRAPH\n\t\t\t: ChatModelService.WPCOM_JETPACK_AI, // switch to LOCAL_GRAPH for end-to-end local development\n\t\tmodel: ChatModelType.GPT_4O,\n\t\tstream: false,\n\t\tsessionId,\n\t} );\n\n\tconst inputRef = useRef();\n\tconst { activeAgent, setActiveAgent } = useAgents();\n\tconst { messages, clearMessages, userSay } = useChat();\n\tconst { invoke } = useToolkits();\n\tconst { isThinking } = useIsThinking();\n\tuseAgentExecutor();\n\n\tuseEffect( () => {\n\t\tif ( assistant ) {\n\t\t\tsetActiveAgent( assistant );\n\t\t}\n\t}, [ assistant, setActiveAgent ] );\n\n\tuseEffect( () => {\n\t\tif ( activeAgent?.onStart ) {\n\t\t\tactiveAgent.onStart( invoke, clearMessages, agentQuestion );\n\t\t}\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ activeAgent, agentQuestion, clearMessages ] );\n\n\tconst focusInput = () => {\n\t\tinputRef.current?.focus();\n\t};\n\n\tconst addFiles = useCallback(\n\t\tasync ( newFiles ) => {\n\t\t\tconst fileNamesAndUrls = await Promise.all(\n\t\t\t\tnewFiles.map( async ( file ) => ( {\n\t\t\t\t\tfile,\n\t\t\t\t\tname: file.name,\n\t\t\t\t\turl: URL.createObjectURL( file ),\n\t\t\t\t} ) )\n\t\t\t);\n\n\t\t\tsetInputtedFiles( [ ...inputtedFiles, ...fileNamesAndUrls ] );\n\t\t},\n\t\t[ inputtedFiles, setInputtedFiles ]\n\t);\n\n\tconst removeFile = useCallback(\n\t\t( index ) => {\n\t\t\tsetInputtedFiles( inputtedFiles.filter( ( _, i ) => i !== index ) );\n\t\t},\n\t\t[ inputtedFiles, setInputtedFiles ]\n\t);\n\n\tconst FilePreview = ( { name, url, onRemove } ) => {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{ url && (\n\t\t\t\t\t<img\n\t\t\t\t\t\twidth=\"50\"\n\t\t\t\t\t\theight=\"50\"\n\t\t\t\t\t\tstyle={ { verticalAlign: 'middle' } }\n\t\t\t\t\t\talt={ name }\n\t\t\t\t\t\tsrc={ url }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t\t{ name }{ ' ' }\n\t\t\t\t<Button size=\"small\" icon={ close } onClick={ onRemove } />\n\t\t\t</>\n\t\t);\n\t};\n\n\tconst inputAnimationProps = {\n\t\tinitial: {\n\t\t\topacity: 0,\n\t\t\tfilter: 'blur(5px)',\n\t\t\tscale: 0.9,\n\t\t},\n\t\tanimate: {\n\t\t\topacity: 1,\n\t\t\tfilter: 'blur(0px)',\n\t\t\tscale: 1,\n\t\t\ttransition: {\n\t\t\t\tduration: 0.3,\n\t\t\t\tdelay: 0.1,\n\t\t\t\tease: [ 0.42, 0.24, 0.02, 1 ],\n\t\t\t},\n\t\t},\n\t\texit: {\n\t\t\tfilter: 'blur(5px)',\n\t\t\topacity: 0,\n\t\t\tscale: 0.9,\n\t\t\ttransition: {\n\t\t\t\tduration: 0.2,\n\t\t\t\tease: [ 0.42, 0.24, 0.02, 1 ],\n\t\t\t},\n\t\t},\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t{ fileUploadEnabled && <DropZone onFilesDrop={ addFiles } /> }\n\t\t\t<div className=\"big-sky__dock__chat-view\">\n\t\t\t\t<div className=\"big-sky__dock__chat-content\">\n\t\t\t\t\t{ showNavigation && (\n\t\t\t\t\t\t<ChatNavigation\n\t\t\t\t\t\t\ttitle={ navigationTitle }\n\t\t\t\t\t\t\tonClickBackButton={ () => onClickBackButton() }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\n\t\t\t\t\t{ ! messages.length && ! isHandoff && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<ChatNavigation\n\t\t\t\t\t\t\t\ttitle={ ' ' }\n\t\t\t\t\t\t\t\tonClickBackButton={ () => onClickBackButton() }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<BigSkyIcon width={ 64 } height={ 64 } />\n\t\t\t\t\t\t</>\n\t\t\t\t\t) }\n\n\t\t\t\t\t{ ( showThread || ! isOnboarded ) && (\n\t\t\t\t\t\t<ChatThread\n\t\t\t\t\t\t\tonlyShowLastRequest={ onlyShowLastRequest }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ ! showThread && isOnboarded && ! currentUserMessage && (\n\t\t\t\t\t\t<ChatActions\n\t\t\t\t\t\t\tuseBlockContext={ useBlockContext }\n\t\t\t\t\t\t\tfocusInput={ focusInput }\n\t\t\t\t\t\t\tonActionClick={ async ( message ) => {\n\t\t\t\t\t\t\t\tsetShowThread( true );\n\t\t\t\t\t\t\t\tawait withJetpackTokenRequest( () =>\n\t\t\t\t\t\t\t\t\tuserSay( message )\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tsetCurrentUserMessage( '' );\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</div>\n\t\t\t\t<ChatComponents />\n\t\t\t\t<ChatSuggestions />\n\t\t\t\t<div className=\"big-sky__dock__chat-input\">\n\t\t\t\t\t<ChatInput\n\t\t\t\t\t\tprompt={ defaultPrompt }\n\t\t\t\t\t\tref={ inputRef }\n\t\t\t\t\t\tanimationProps={ inputAnimationProps }\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t{ fileUploadEnabled &&\n\t\t\t\t\t! isThinking &&\n\t\t\t\t\t!! inputtedFiles?.length && (\n\t\t\t\t\t\t<ItemGroup isBordered isSeparated>\n\t\t\t\t\t\t\t{ inputtedFiles.map( ( { name, url }, index ) => (\n\t\t\t\t\t\t\t\t<Item key={ index }>\n\t\t\t\t\t\t\t\t\t<FilePreview\n\t\t\t\t\t\t\t\t\t\tname={ name }\n\t\t\t\t\t\t\t\t\t\turl={ url }\n\t\t\t\t\t\t\t\t\t\tonRemove={ () => removeFile( index ) }\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</Item>\n\t\t\t\t\t\t\t) ) }\n\t\t\t\t\t\t</ItemGroup>\n\t\t\t\t\t) }\n\t\t\t</div>\n\t\t</>\n\t);\n}\n","import { __ } from '@wordpress/i18n';\nimport { dockViews } from '@utils/constants';\nconst defaultDimensions = {\n\tmenus: { width: 'auto', height: 48 },\n\tchat: { width: 340, height: 400 },\n\tpending: { width: 'auto', height: 48 },\n\tcompleted: { width: 'auto', height: 48 },\n\thandoff: { width: 368, height: 'auto' },\n};\n\nconst maximizedDimensions = {\n\tmenus: { width: 'auto', height: 48 },\n\tchat: { width: 600, height: 600 },\n\tpending: { width: 'auto', height: 48 },\n\tcompleted: { width: 'auto', height: 48 },\n\thandoff: { width: 600, height: 'auto' },\n};\n\nexport const getDockWidth = ( dockView, isMaximized ) => {\n\tif ( isMaximized ) {\n\t\treturn maximizedDimensions[ dockView ]?.width || 'auto';\n\t}\n\treturn defaultDimensions[ dockView ]?.width || 'auto';\n};\n\nexport const getDockHeight = ( dockView, isMaximized ) => {\n\tif ( isMaximized ) {\n\t\treturn maximizedDimensions[ dockView ]?.height || 'auto';\n\t}\n\treturn defaultDimensions[ dockView ]?.height || 48;\n};\n\nconst getContentReplacementMessage = ( selectedBlock ) => {\n\tif ( ! selectedBlock ) return __( 'Replacing content…', 'big-sky' );\n\n\tswitch ( selectedBlock.name ) {\n\t\tcase 'core/paragraph':\n\t\t\treturn __( 'Regenerating text…', 'big-sky' );\n\t\tcase 'core/image':\n\t\t\treturn __( 'Regenerating image…', 'big-sky' );\n\t\tdefault:\n\t\t\treturn __( 'Replacing content…', 'big-sky' );\n\t}\n};\n\nexport const getPendingActionMessage = ( currentToolCall, selectedBlock ) => {\n\tif ( currentToolCall ) {\n\t\tswitch ( currentToolCall ) {\n\t\t\tcase 'modify_contact_form':\n\t\t\t\treturn __( 'Generating contact form…', 'big-sky' );\n\t\t\tcase 'remove_block':\n\t\t\t\tif (\n\t\t\t\t\tselectedBlock &&\n\t\t\t\t\t( selectedBlock?.name === 'core/pattern' ||\n\t\t\t\t\t\tselectedBlock?.name === 'core/group' )\n\t\t\t\t) {\n\t\t\t\t\treturn __( 'Removing pattern…', 'big-sky' );\n\t\t\t\t}\n\t\t\t\treturn __( 'Removing block…', 'big-sky' );\n\t\t\tcase 'add_pattern':\n\t\t\t\treturn __( 'Adding pattern…', 'big-sky' );\n\t\t\tcase 'replace_pattern':\n\t\t\t\treturn __( 'Replacing pattern…', 'big-sky' );\n\t\t\tcase 'generate_pattern':\n\t\t\t\treturn __( 'Generating pattern…', 'big-sky' );\n\t\t\tcase 'generate_image':\n\t\t\t\treturn __( 'Generating image…', 'big-sky' );\n\t\t\tcase 'get_stock_image':\n\t\t\t\treturn __( 'Getting stock image…', 'big-sky' );\n\t\t\tcase 'replace_content':\n\t\t\t\treturn getContentReplacementMessage( selectedBlock );\n\t\t\tcase 'upload_site_logo':\n\t\t\t\treturn __( 'Updating site logo…', 'big-sky' );\n\t\t\tcase 'generate_site_logo':\n\t\t\t\treturn __( 'Generating site logo…', 'big-sky' );\n\t\t\tdefault:\n\t\t\t\treturn __( 'Working on your request…', 'big-sky' );\n\t\t}\n\t}\n};\n\nexport const getDefaultChatSettings = ( isOnboarded = false ) => {\n\treturn isOnboarded\n\t\t? {\n\t\t\t\ttitle: __( 'How can I help you?', 'big-sky' ),\n\t\t\t\tprompt: __( \"Type what you'd like to do\", 'big-sky' ),\n\t\t  }\n\t\t: {\n\t\t\t\ttitle: __( 'What sort of website do you need?', 'big-sky' ),\n\t\t\t\tprompt: __( 'Describe your site', 'big-sky' ),\n\t\t  };\n};\n\nexport function getNewDockView( {\n\tisOnboarded,\n\tisHandoff,\n\tdockView,\n\tshowThread,\n\tisToolContainerVisible,\n\tpendingToolCallbacks,\n\tselectedBlockHasChanged,\n\tcurrentToolCall,\n} ) {\n\tif ( ! isOnboarded ) {\n\t\treturn dockViews.CHAT;\n\t}\n\n\tif ( isHandoff ) {\n\t\treturn dockViews.HANDOFF;\n\t}\n\n\tif ( pendingToolCallbacks > 0 ) {\n\t\treturn dockViews.PENDING;\n\t}\n\n\tif ( dockView === dockViews.PENDING && ! pendingToolCallbacks ) {\n\t\treturn dockViews.COMPLETED;\n\t}\n\n\t// If the selected block changes you usually want to show a new menu for that block, unless we just removed a block.\n\t// In that case, we still want to leave the view at COMPLETED so the user can undo the removal.\n\tif (\n\t\t( dockView === dockViews.CHAT || dockView === dockViews.COMPLETED ) &&\n\t\t! showThread &&\n\t\tselectedBlockHasChanged &&\n\t\t! isToolContainerVisible &&\n\t\tcurrentToolCall !== 'remove_block' &&\n\t\tcurrentToolCall !== 'modify_contact_form'\n\t) {\n\t\treturn dockViews.MENUS;\n\t}\n\n\treturn dockView;\n}\n\n// The message thread shows the latest agent and user messages. When it is hidden the quick actions display instead.\nexport function shouldHideMessageThread( {\n\tshowThread,\n\tnewView,\n\tuseBlockContext,\n\tselectedBlockHasChanged,\n} ) {\n\tif ( ! showThread ) {\n\t\treturn false;\n\t}\n\n\tif ( newView === dockViews.PENDING || newView === dockViews.COMPLETED ) {\n\t\treturn true;\n\t}\n\n\tif (\n\t\tnewView === dockViews.CHAT &&\n\t\tuseBlockContext &&\n\t\tselectedBlockHasChanged\n\t) {\n\t\treturn true;\n\t}\n\treturn false;\n}\n\n/**\n * Determines if a block must be undone using Gutenberg's undo functionality.\n *\n * Some blocks, like the Site Logo block, don't have attribute changes that can be\n * directly undone. For these blocks, we need to use Gutenberg's built-in undo\n * functionality instead of relying on updateBlockAttributes().\n *\n * @param {Object} selectedBlock - The currently selected block object.\n * @return {boolean} Returns true if the block needs to be undone using Gutenberg,\n *                    false otherwise.\n */\n\nexport const mustUndoBlockWithGutenberg = ( currentToolCall ) => {\n\treturn [ 'generate_site_logo', 'remove_block' ].includes( currentToolCall );\n};\n","/**\n * External dependencies\n */\nimport classNames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { Popover } from '@wordpress/components';\n\nimport { useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\n\nimport { store as aiStore } from '@store';\n\nexport default function ToolContainer() {\n\tconst { isHandoff, isToolContainerVisible, toolComponent } = useSelect(\n\t\t( select ) => {\n\t\t\tconst ai = select( aiStore );\n\n\t\t\treturn {\n\t\t\t\tisHandoff: ai.getIsHandoff(),\n\t\t\t\tisToolContainerVisible: ai.isToolContainerVisible(),\n\t\t\t\ttoolComponent: ai.getToolComponent(),\n\t\t\t};\n\t\t}\n\t);\n\tif ( ! isToolContainerVisible || ! toolComponent ) {\n\t\treturn;\n\t}\n\n\tconst toolComponentKey = toolComponent.key;\n\n\treturn (\n\t\t<Popover\n\t\t\tclassName={ classNames( 'big-sky__dock__tool-container', {\n\t\t\t\t'big-sky__assistant-ai-actions__popover-content': true,\n\t\t\t\t'big-sky__dock__wrapper': true,\n\t\t\t\t'big-sky__dock__use-hover-effects':\n\t\t\t\t\t! [\n\t\t\t\t\t\t'color-picker',\n\t\t\t\t\t\t'font-picker',\n\t\t\t\t\t\t'site-layout-picker',\n\t\t\t\t\t\t'pattern-picker',\n\t\t\t\t\t].includes( toolComponentKey ) && ! isHandoff,\n\t\t\t\t'big-sky__dock__handoff': isHandoff,\n\t\t\t} ) }\n\t\t\tanimate={ false }\n\t\t>\n\t\t\t{ toolComponent }\n\t\t</Popover>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { Button, Modal } from '@wordpress/components';\n\nexport default function ConfirmationDialog( {\n\tisOpen,\n\tonClose,\n\tonCancel,\n\tonConfirm,\n\tcancelText,\n\tconfirmText,\n\tmessage,\n\ttitle,\n} ) {\n\treturn (\n\t\tisOpen && (\n\t\t\t<Modal\n\t\t\t\tclassName=\"big-sky-onboarding__dialog\"\n\t\t\t\tonRequestClose={ onClose }\n\t\t\t\ttitle={ title }\n\t\t\t>\n\t\t\t\t<p>{ message }</p>\n\t\t\t\t<div className=\"big-sky-onboarding__dialog-buttons\">\n\t\t\t\t\t<Button variant=\"secondary\" onClick={ onCancel }>\n\t\t\t\t\t\t{ cancelText }\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button variant=\"primary\" onClick={ onConfirm }>\n\t\t\t\t\t\t{ confirmText }\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</Modal>\n\t\t)\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { Button } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { store as editorStore } from '@wordpress/editor';\nimport { useCallback, useEffect, useState } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport useAddPatternTool from '@ai/assistants/pattern/tools/add-pattern/use-add-pattern-tool.js';\nimport useReplacePatternTool from '@ai/assistants/pattern/tools/replace-pattern/use-replace-pattern-tool.js';\nimport useColorToolFunctions from '@ai/assistants/color/tools/use-tool-functions.js';\nimport useShowLayoutPickerTool from '@ai/assistants/layout/tools/show-layout-picker/use-show-layout-picker-tool.js';\nimport useButtonToolFunctions from '@ai/assistants/content/tools/button/use-tool-functions.js';\nimport useUndoRedo from '@hooks/use-undo-redo';\nimport useCanvas from '@hooks/use-canvas.js';\nimport usePatterns from '@hooks/use-patterns.js';\nimport usePages from '@hooks/use-pages';\nimport { store as aiStore } from '@store';\nimport { dockViews } from '@utils/constants';\nimport { mustUndoBlockWithGutenberg } from '@components/dock/utils';\nimport useFontToolFunctions from '@ai/assistants/font/tools/use-tool-functions.js';\nimport useUploadSiteLogoTool from '@ai/assistants/image/tools/upload-site-logo/use-upload-site-logo-tool.js';\nimport useAddressToolFunctions from '@ai/assistants/content/tools/address/use-tool-functions.js';\nimport { recordTracksEvent } from '@utils/tracks';\nimport ConfirmationDialog from '@components/onboarding/confirmation-dialog';\n\nexport default function CompletedAction( { setIsToolContainerVisible } ) {\n\tconst [ showDeletePageDialog, setShowDeletePageDialog ] = useState( false );\n\tconst { zoomIn } = useCanvas();\n\tconst { replacePattern } = usePatterns();\n\tconst { deletePage, goBackPage } = usePages();\n\tconst {\n\t\tremoveBlock: removeBlockFromEditor,\n\t\treplaceInnerBlocks,\n\t\tselectBlock,\n\t\tupdateBlockAttributes,\n\t} = useDispatch( blockEditorStore );\n\tconst { selectedBlock, newPageId, currentPostId } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\t\t\tconst { getNewPageId } = select( aiStore );\n\t\t\tconst { getCurrentPostId } = select( editorStore );\n\t\t\treturn {\n\t\t\t\tselectedBlock: getSelectedBlock(),\n\t\t\t\tnewPageId: getNewPageId(),\n\t\t\t\tcurrentPostId: getCurrentPostId(),\n\t\t\t};\n\t\t}\n\t);\n\n\tconst {\n\t\tsetBlockBeforeChanges,\n\t\tsetDockView,\n\t\tsetLastCancelableAction,\n\t\tsetCurrentToolCall,\n\t\tsetNewPageId,\n\t} = useDispatch( aiStore );\n\tconst { currentToolCall, lastCancelableAction, blockBeforeChanges } =\n\t\tuseSelect( ( select ) => {\n\t\t\tconst ai = select( aiStore );\n\n\t\t\treturn {\n\t\t\t\tlastCancelableAction: ai.getLastCancelableAction(),\n\t\t\t\tblockBeforeChanges: ai.getBlockBeforeChanges(),\n\t\t\t\tcurrentToolCall: ai.getCurrentToolCall(),\n\t\t\t};\n\t\t} );\n\tconst shouldShowCancel = !! lastCancelableAction?.action;\n\n\tconst doResetDockView = useCallback( () => {\n\t\tif (\n\t\t\tshouldShowCancel &&\n\t\t\tcurrentToolCall === 'color_palette_generator'\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t\tsetDockView( dockViews.MENUS );\n\t}, [ shouldShowCancel, currentToolCall, setDockView ] );\n\n\tconst { popUndoStack, undo } = useUndoRedo( {\n\t\tonToolbarUndoCallback: doResetDockView,\n\t} );\n\n\tconst { doneAddPattern } = useAddPatternTool();\n\tconst { doneReplacePattern } = useReplacePatternTool();\n\tconst { cancelGenerateColorPalette, doneGenerateColorPalette } =\n\t\tuseColorToolFunctions();\n\tconst { cancelShowFontPicker, doneShowFontPicker } = useFontToolFunctions();\n\tconst { cancelShowLayoutPicker, doneShowLayoutPicker } =\n\t\tuseShowLayoutPickerTool();\n\tconst { cancelUpdateButtonLink } = useButtonToolFunctions();\n\tconst { cancelUploadSiteLogo } = useUploadSiteLogoTool();\n\tconst { cancelUpdateAddress } = useAddressToolFunctions();\n\n\tconst resetDockView = useCallback( () => {\n\t\tzoomIn();\n\t\tsetDockView( dockViews.MENUS );\n\t\tsetIsToolContainerVisible( false );\n\t\tsetCurrentToolCall( '' );\n\t\tsetBlockBeforeChanges( null );\n\t}, [\n\t\tzoomIn,\n\t\tsetDockView,\n\t\tsetIsToolContainerVisible,\n\t\tsetCurrentToolCall,\n\t\tsetBlockBeforeChanges,\n\t] );\n\n\tconst handleCancel = useCallback( () => {\n\t\t// If the user is creating a new page, cancel button will delete the page.\n\t\t// But we want to confirm first.\n\t\tif ( newPageId ) {\n\t\t\tsetShowDeletePageDialog( true );\n\t\t\treturn;\n\t\t}\n\t\tif ( ! lastCancelableAction ) return;\n\n\t\trecordTracksEvent( 'cancel_action', {\n\t\t\taction: lastCancelableAction.action,\n\t\t} );\n\n\t\tswitch ( lastCancelableAction.action ) {\n\t\t\tcase 'add_menu_items':\n\t\t\tcase 'add_events_items':\n\t\t\tcase 'add_team_items':\n\t\t\t\tfor ( const clientId of lastCancelableAction.clientIds ) {\n\t\t\t\t\tremoveBlockFromEditor( clientId );\n\t\t\t\t}\n\t\t\t\tresetDockView();\n\t\t\t\tbreak;\n\t\t\tcase 'add_events_section':\n\t\t\tcase 'add_menu_section':\n\t\t\tcase 'add_pricing_section':\n\t\t\tcase 'add_services_section':\n\t\t\tcase 'add_testimonials_section':\n\t\t\tcase 'add_team_section':\n\t\t\t\tremoveBlockFromEditor( lastCancelableAction.clientId );\n\t\t\t\tresetDockView();\n\t\t\t\tbreak;\n\t\t\tcase 'add_pattern':\n\t\t\t\tremoveBlockFromEditor( lastCancelableAction.clientId );\n\t\t\t\tresetDockView();\n\t\t\t\tbreak;\n\t\t\tcase 'replace_pattern':\n\t\t\t\treplacePattern(\n\t\t\t\t\tlastCancelableAction.clientId,\n\t\t\t\t\tlastCancelableAction.originalBlock\n\t\t\t\t);\n\t\t\t\tresetDockView();\n\t\t\t\tbreak;\n\t\t\tcase 'color_palette_generator':\n\t\t\t\tcancelGenerateColorPalette( lastCancelableAction );\n\t\t\t\tbreak;\n\t\t\tcase 'show_font_picker':\n\t\t\t\tcancelShowFontPicker(\n\t\t\t\t\tlastCancelableAction.originalVariationName\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase 'show_layout_picker':\n\t\t\t\tcancelShowLayoutPicker( lastCancelableAction.originalLayout );\n\t\t\t\tbreak;\n\t\t\tcase 'update_button_link':\n\t\t\t\tcancelUpdateButtonLink( lastCancelableAction );\n\t\t\t\tresetDockView();\n\t\t\t\tbreak;\n\t\t\tcase 'upload_site_logo':\n\t\t\t\tcancelUploadSiteLogo( lastCancelableAction );\n\t\t\t\tresetDockView();\n\t\t\t\tbreak;\n\t\t\tcase 'update_address':\n\t\t\t\tcancelUpdateAddress( lastCancelableAction );\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t\tsetLastCancelableAction( null );\n\t}, [\n\t\tcancelGenerateColorPalette,\n\t\tcancelShowFontPicker,\n\t\tcancelShowLayoutPicker,\n\t\tcancelUpdateAddress,\n\t\tcancelUpdateButtonLink,\n\t\tcancelUploadSiteLogo,\n\t\tnewPageId,\n\t\tlastCancelableAction,\n\t\tremoveBlockFromEditor,\n\t\treplacePattern,\n\t\tresetDockView,\n\t\tsetLastCancelableAction,\n\t] );\n\n\tconst handleDone = useCallback( () => {\n\t\trecordTracksEvent( 'done_action', {\n\t\t\taction: lastCancelableAction?.action || currentToolCall,\n\t\t} );\n\n\t\tswitch ( lastCancelableAction?.action ) {\n\t\t\tcase 'add_pattern':\n\t\t\t\tdoneAddPattern();\n\t\t\t\tbreak;\n\t\t\tcase 'replace_pattern':\n\t\t\t\tdoneReplacePattern();\n\t\t\t\tbreak;\n\t\t\tcase 'color_palette_generator':\n\t\t\t\tdoneGenerateColorPalette();\n\t\t\t\tbreak;\n\t\t\tcase 'show_font_picker':\n\t\t\t\tdoneShowFontPicker();\n\t\t\t\tbreak;\n\t\t\tcase 'show_layout_picker':\n\t\t\t\tdoneShowLayoutPicker();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tresetDockView();\n\t\t\t\tbreak;\n\t\t}\n\t\tif ( newPageId ) {\n\t\t\tsetNewPageId( 0 );\n\t\t}\n\t\tsetLastCancelableAction( null );\n\t}, [\n\t\tnewPageId,\n\t\tsetNewPageId,\n\t\tlastCancelableAction,\n\t\tdoneAddPattern,\n\t\tcurrentToolCall,\n\t\tdoneReplacePattern,\n\t\tdoneGenerateColorPalette,\n\t\tdoneShowFontPicker,\n\t\tdoneShowLayoutPicker,\n\t\tresetDockView,\n\t\tsetLastCancelableAction,\n\t] );\n\n\t// If the done button is showing, \"Enter\" key should trigger it.\n\tuseEffect( () => {\n\t\tconst handleKeyDown = ( event ) => {\n\t\t\tif ( event.key === 'Enter' ) {\n\t\t\t\thandleDone();\n\t\t\t}\n\t\t\tif ( event.key === 'Escape' ) {\n\t\t\t\thandleCancel();\n\t\t\t}\n\t\t};\n\t\tdocument.addEventListener( 'keydown', handleKeyDown );\n\t\treturn () => {\n\t\t\t// Why setTimeout?\n\t\t\t// This cleanup function is called when the component unmounts, ensuring we dont have dangling handlers.\n\t\t\t// But when handling Escape, the PARENT component is unmounted as well in dock/index.js\n\t\t\t// So this component is unmounted before we can trigger the event handler because it has not bubbled here yet.\n\t\t\t// As a result, the handler never gets called and the `handleCancel` does not get called.\n\t\t\t// With setTimeout, we wait for the bubble to complete so all events triggered by the same key can be triggered.\n\t\t\t/* eslint-disable @wordpress/react-no-unsafe-timeout */\n\t\t\tsetTimeout(\n\t\t\t\t() => document.removeEventListener( 'keydown', handleKeyDown ),\n\t\t\t\t1000\n\t\t\t);\n\t\t};\n\t}, [ handleDone, handleCancel ] );\n\n\tconst handleUndo = useCallback( async () => {\n\t\trecordTracksEvent( 'undo_action', {\n\t\t\taction: currentToolCall,\n\t\t} );\n\n\t\tif ( mustUndoBlockWithGutenberg( currentToolCall, selectedBlock ) ) {\n\t\t\tundo();\n\t\t} else {\n\t\t\tpopUndoStack();\n\t\t\tswitch ( currentToolCall ) {\n\t\t\t\tcase 'modify_contact_form':\n\t\t\t\t\treplaceInnerBlocks(\n\t\t\t\t\t\tblockBeforeChanges.clientId,\n\t\t\t\t\t\tblockBeforeChanges.innerBlocks\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tif ( blockBeforeChanges?.attributes ) {\n\t\t\t\t\t\tupdateBlockAttributes(\n\t\t\t\t\t\t\tselectedBlock?.clientId,\n\t\t\t\t\t\t\tblockBeforeChanges.attributes\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif ( selectedBlock ) {\n\t\t\tselectBlock( selectedBlock.clientId );\n\t\t}\n\t\tresetDockView();\n\t}, [\n\t\tblockBeforeChanges,\n\t\tcurrentToolCall,\n\t\tpopUndoStack,\n\t\treplaceInnerBlocks,\n\t\tresetDockView,\n\t\tselectBlock,\n\t\tselectedBlock,\n\t\tundo,\n\t\tupdateBlockAttributes,\n\t] );\n\n\tconst getConfirmButtonText = () => {\n\t\tif ( newPageId ) {\n\t\t\treturn __( 'Create', 'big-sky' );\n\t\t}\n\t\tswitch ( lastCancelableAction?.action ) {\n\t\t\tcase 'color_palette_generator':\n\t\t\tcase 'show_font_picker':\n\t\t\t\treturn __( 'Save', 'big-sky' );\n\t\t\tdefault:\n\t\t\t\treturn __( 'Done', 'big-sky' );\n\t\t}\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<ConfirmationDialog\n\t\t\t\tisOpen={ showDeletePageDialog }\n\t\t\t\tonClose={ () => setShowDeletePageDialog( false ) }\n\t\t\t\tonCancel={ () => setShowDeletePageDialog( false ) }\n\t\t\t\tonConfirm={ () => {\n\t\t\t\t\tsetShowDeletePageDialog( false );\n\t\t\t\t\tsetNewPageId( 0 );\n\t\t\t\t\tconst pageIdToDelete = currentPostId;\n\t\t\t\t\tgoBackPage();\n\t\t\t\t\tdeletePage( pageIdToDelete );\n\t\t\t\t\tresetDockView();\n\t\t\t\t} }\n\t\t\t\tmessage={ __(\n\t\t\t\t\t'Are you sure you want to delete this page?',\n\t\t\t\t\t'big-sky'\n\t\t\t\t) }\n\t\t\t\tcancelText={ __( 'Cancel', 'big-sky' ) }\n\t\t\t\tconfirmText={ __( 'Delete', 'big-sky' ) }\n\t\t\t\ttitle={ __( 'Delete Page?', 'big-sky' ) }\n\t\t\t/>\n\t\t\t<div className=\"big-sky__dock__action\">\n\t\t\t\t{ shouldShowCancel && (\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclassName=\"big-sky__dock__action__cancel\"\n\t\t\t\t\t\tonClick={ handleCancel }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ __( 'Cancel', 'big-sky' ) }\n\t\t\t\t\t</Button>\n\t\t\t\t) }\n\t\t\t\t{ ! shouldShowCancel && (\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclassName=\"big-sky__dock__action__undo\"\n\t\t\t\t\t\tonClick={ handleUndo }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ __( 'Undo', 'big-sky' ) }\n\t\t\t\t\t</Button>\n\t\t\t\t) }\n\t\t\t\t<Button\n\t\t\t\t\tclassName=\"big-sky__dock__action__done\"\n\t\t\t\t\tonClick={ handleDone }\n\t\t\t\t>\n\t\t\t\t\t{ getConfirmButtonText() }\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { store as coreDataStore } from '@wordpress/core-data';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as editorStore } from '@wordpress/editor';\nimport { useCallback, useEffect } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { store as aiStore } from '@store';\nimport { unlock } from '@utils/lock-unlock';\nimport log from '@utils/log-debug.js';\n\nexport default function useUndoRedo( { onToolbarUndoCallback } = {} ) {\n\tconst { isEditorReady } = useSelect( ( select ) => ( {\n\t\tisEditorReady: select( aiStore ).getIsEditorReady(),\n\t} ) );\n\n\tconst { getUndoManager } = unlock( useSelect( coreDataStore ) );\n\tconst { undo: undoCommand, redo: redoCommand } = useDispatch( editorStore );\n\n\tconst onToolbarUndo = useCallback( () => {\n\t\tif ( onToolbarUndoCallback ) {\n\t\t\tonToolbarUndoCallback();\n\t\t}\n\t}, [ onToolbarUndoCallback ] );\n\n\t// add click handler to the undo button\n\tuseEffect( () => {\n\t\tif ( ! isEditorReady ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst undoButton = document.querySelector( '.editor-history__undo' );\n\t\tif ( undoButton ) {\n\t\t\tundoButton.addEventListener( 'click', onToolbarUndo );\n\t\t}\n\n\t\treturn () => {\n\t\t\tif ( undoButton ) {\n\t\t\t\tundoButton.removeEventListener( 'click', onToolbarUndo );\n\t\t\t}\n\t\t};\n\t}, [ isEditorReady, onToolbarUndo ] );\n\n\tconst undo = () => {\n\t\ttry {\n\t\t\tundoCommand();\n\t\t} catch ( error ) {\n\t\t\tlog.error( error );\n\t\t}\n\t};\n\n\tconst redo = () => {\n\t\ttry {\n\t\t\tredoCommand();\n\t\t} catch ( error ) {\n\t\t\tlog.error( error );\n\t\t}\n\t};\n\n\tconst popUndoStack = () => {\n\t\t// pop the undo stack\n\t\t// this doesn't actually update the block itself, but it does remove the last item (update) from the undo stack\n\t\tgetUndoManager().undo();\n\t};\n\n\treturn {\n\t\tundo,\n\t\tredo,\n\t\tpopUndoStack,\n\t};\n}\n","/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { Button } from '@wordpress/components';\nimport { useEffect, useRef, useState } from '@wordpress/element';\nimport { chevronLeft } from '@wordpress/icons';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport { AskAI } from '@components/icons';\n\nexport default function HandoffStep( {\n\ttitle = '\\u00A0',\n\tdescription = '',\n\tcomponent = null,\n\tprimaryCta = {\n\t\ttext: __( 'Continue', 'big-sky' ),\n\t\tonClick: () => {},\n\t},\n\ttertiaryCta = {\n\t\ttext: __( 'Cancel', 'big-sky' ),\n\t\tonClick: () => {},\n\t\tisAi: false,\n\t},\n\tonBackClick = null,\n\tisChatMode = false,\n\tonSkip = null,\n} ) {\n\tconst [ didLoad, setDidLoad ] = useState( false );\n\tconst [ handoffComponent, setHandoffComponent ] = useState( null );\n\n\tconst componentRef = useRef( component );\n\n\tuseEffect( () => {\n\t\tcomponentRef.current = component;\n\t}, [ component ] );\n\n\tuseEffect( () => {\n\t\tif ( ! didLoad ) {\n\t\t\tif (\n\t\t\t\tcomponentRef.current &&\n\t\t\t\ttypeof componentRef.current === 'function'\n\t\t\t) {\n\t\t\t\tcomponentRef.current( setHandoffComponent );\n\t\t\t} else {\n\t\t\t\tsetHandoffComponent( componentRef.current );\n\t\t\t}\n\t\t\tsetDidLoad( true );\n\t\t}\n\t}, [ didLoad ] );\n\n\treturn (\n\t\t<div className=\"big-sky__dock__handoff-step\">\n\t\t\t<div className=\"big-sky__dock__handoff-step__title-actions\">\n\t\t\t\t{ onBackClick && (\n\t\t\t\t\t<div className=\"big-sky__dock__handoff-step__title-actions__back\">\n\t\t\t\t\t\t<Button icon={ chevronLeft } onClick={ onBackClick } />\n\t\t\t\t\t</div>\n\t\t\t\t) }\n\t\t\t\t<div className=\"big-sky__dock__handoff-step__title-actions__title\">\n\t\t\t\t\t{ title }\n\t\t\t\t</div>\n\t\t\t\t{ onSkip && (\n\t\t\t\t\t<div className=\"big-sky__dock__handoff-step__title-actions__skip\">\n\t\t\t\t\t\t<Button onClick={ onSkip }>\n\t\t\t\t\t\t\t{ __( 'Skip', 'big-sky' ) }\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t) }\n\t\t\t</div>\n\t\t\t{ description && (\n\t\t\t\t<div className=\"big-sky__dock__handoff-step__description\">\n\t\t\t\t\t{ description }\n\t\t\t\t</div>\n\t\t\t) }\n\t\t\t<div className=\"big-sky__dock__handoff-step__component\">\n\t\t\t\t{ handoffComponent }\n\t\t\t</div>\n\t\t\t{ ! isChatMode && (\n\t\t\t\t<div className=\"big-sky__dock__handoff-step__buttons\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclassName=\"big-sky__dock__handoff-step__buttons__button big-sky__dock__handoff-step__buttons__button-primary\"\n\t\t\t\t\t\tonClick={ primaryCta.onClick }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ primaryCta.text }\n\t\t\t\t\t</Button>\n\t\t\t\t\t{ tertiaryCta && (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\t\t'big-sky__dock__handoff-step__buttons__button big-sky__dock__handoff-step__buttons__button-tertiary',\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t'big-sky__dock__handoff-step__buttons__button-tertiary-ai':\n\t\t\t\t\t\t\t\t\t\ttertiaryCta.isAi,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\ttertiaryCta.onClick( setHandoffComponent );\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ tertiaryCta.isAi ? (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<AskAI />\n\t\t\t\t\t\t\t\t\t{ tertiaryCta.text }\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\ttertiaryCta.text\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t) }\n\t\t\t\t</div>\n\t\t\t) }\n\t\t</div>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch } from '@wordpress/data';\nimport { useChat } from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport { store as aiStore } from '@store';\n\nexport default function useChatThread() {\n\tconst { agentSay, clearMessages } = useChat();\n\tconst { setShowThread } = useDispatch( aiStore );\n\n\tconst initializeThread = ( assistantMessage ) => {\n\t\tclearMessages();\n\t\tsetShowThread( true );\n\t\tagentSay( assistantMessage );\n\t};\n\n\treturn {\n\t\tinitializeThread,\n\t};\n}\n","/**\n * WordPress dependencies\n */\nimport { useAgents, useChat } from '@automattic/big-sky-agents';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { cloneElement, useEffect, useRef } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\nimport HandoffStep from './step.js';\nimport { ChatSuggestions } from '@ai/assistants/shared/make-suggestions';\nimport useShowLayoutPickerTool from '@ai/assistants/layout/tools/show-layout-picker/use-show-layout-picker-tool.js';\nimport useColorToolFunctions from '@ai/assistants/color/tools/use-tool-functions';\nimport useFontToolFunctions from '@ai/assistants/font/tools/use-tool-functions';\nimport Chat from '@components/chat';\nimport useChatThread from '@components/chat/thread/use-thread.js';\nimport useCanvas from '@hooks/use-canvas';\nimport useJetpackToken from '@hooks/use-jetpack-token';\nimport { useRouting } from '@hooks/use-routing';\nimport { store as aiStore } from '@store';\nimport { dockViews } from '@utils/constants';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport { recordTracksEvent } from '@utils/tracks';\nimport { colorAssistant, fontAssistant } from '@ai/assistants';\n\nexport default function Handoff() {\n\tconst { getSiteMetadata } = useSiteMetadata();\n\tconst { setAiStep } = useRouting();\n\n\tconst {\n\t\tchosenCategories,\n\t\tchosenColors,\n\t\tchosenFonts,\n\t\thandoffStep,\n\t\tchosenCustomColors,\n\t} = useSelect( ( select ) => {\n\t\tconst ai = select( aiStore );\n\n\t\treturn {\n\t\t\tchosenCategories: ai.getChosenCategories(),\n\t\t\tchosenColors: ai.getChosenColors(),\n\t\t\tchosenCustomColors: ai.getChosenCustomColors(),\n\t\t\tchosenFonts: ai.getChosenFonts(),\n\t\t\thandoffStep: ai.getHandoffStep(),\n\t\t};\n\t} );\n\tconst {\n\t\tsetDockView,\n\t\tsetIsBuildingSite,\n\t\tsetIsHandoff,\n\t\tsetIsToolContainerVisible,\n\t\tsetCurrentHandoffArea,\n\t\tsetCurrentUserMessage,\n\t\tsetChatComponents,\n\t\tsetShowChatContinueButton,\n\t\tsetChatContinueButtonOnClick,\n\t\tsetHandoffStep,\n\t\tsetShowEditorWelcome,\n\t\tsetAssistant,\n\t} = useDispatch( aiStore );\n\n\tconst { zoomIn } = useCanvas();\n\tconst { userSay } = useChat();\n\tconst { activeAgent } = useAgents();\n\tconst { initializeThread } = useChatThread();\n\tconst { generateColorPalette } = useColorToolFunctions();\n\tconst { showFontPicker } = useFontToolFunctions();\n\tconst { showSiteLayouts } = useShowLayoutPickerTool();\n\tconst { withJetpackTokenRequest } = useJetpackToken();\n\n\tconst { currentColor, currentFont } = getSiteMetadata();\n\tconst prevColorRef = useRef();\n\tconst prevFontRef = useRef();\n\tconst handoffStartRef = useRef();\n\n\tconst setupEditorWelcome = () => {\n\t\tsetShowEditorWelcome( true );\n\t\tinitializeThread(\n\t\t\t__(\n\t\t\t\t'Welcome to the editor! Click around to edit your layout, images, or copy. You can also give me commands.',\n\t\t\t\t'big-sky'\n\t\t\t)\n\t\t);\n\t\tconst suggestions = [\n\t\t\t{\n\t\t\t\tkey: 'help-edit-text',\n\t\t\t\tactionName: __( 'How do I edit text?', 'big-sky' ),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: 'help-edit-images',\n\t\t\t\tactionName: __( 'How do I change images?', 'big-sky' ),\n\t\t\t},\n\t\t];\n\n\t\tconst respond = async ( message ) => {\n\t\t\tawait withJetpackTokenRequest( () => userSay( message ) );\n\t\t\tsetCurrentUserMessage( '' );\n\t\t\tsetChatComponents( [] );\n\t\t};\n\n\t\tsetChatComponents( [\n\t\t\t<ChatSuggestions\n\t\t\t\tkey=\"suggestions\"\n\t\t\t\targs={ { actions: suggestions } }\n\t\t\t\trespond={ respond }\n\t\t\t/>,\n\t\t] );\n\t};\n\n\tconst finishHandoff = () => {\n\t\trecordTracksEvent( 'handoff_finished' );\n\t\tsetIsBuildingSite( false );\n\t\tsetIsHandoff( false );\n\t\tsetCurrentHandoffArea( null );\n\t\tsetDockView( dockViews.CHAT );\n\t\tsetIsToolContainerVisible( false );\n\n\t\tsetAiStep( 'edit' );\n\n\t\tzoomIn();\n\t\tsetupEditorWelcome();\n\t};\n\n\tuseEffect( () => {\n\t\tif ( ! handoffStartRef.current ) {\n\t\t\trecordTracksEvent( 'handoff_start' );\n\t\t\thandoffStartRef.current = true;\n\t\t}\n\t}, [] );\n\n\tconst changeStep = ( key ) => {\n\t\t// clear any chat components\n\t\tsetChatComponents( [] );\n\t\tconst nextIndex = steps.findIndex( ( step ) => step.key === key );\n\t\tsetHandoffStep( nextIndex );\n\t};\n\n\tuseEffect( () => {\n\t\tif (\n\t\t\tsteps[ handoffStep ].key !== 'ask-ai-colors' &&\n\t\t\tsteps[ handoffStep ].key !== 'ask-ai-fonts'\n\t\t) {\n\t\t\tsetShowChatContinueButton( false );\n\t\t\tprevColorRef.current = currentColor;\n\t\t\tprevFontRef.current = currentFont;\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tsteps[ handoffStep ].key === 'ask-ai-colors' &&\n\t\t\tactiveAgent?.id !== colorAssistant.id\n\t\t) {\n\t\t\tsetAssistant( colorAssistant.id );\n\t\t}\n\t\tif (\n\t\t\tsteps[ handoffStep ].key === 'ask-ai-fonts' &&\n\t\t\tactiveAgent?.id !== fontAssistant.id\n\t\t) {\n\t\t\tsetAssistant( fontAssistant.id );\n\t\t}\n\n\t\tif ( prevColorRef.current !== currentColor ) {\n\t\t\tprevColorRef.current = currentColor;\n\t\t\tsetShowChatContinueButton( true );\n\t\t\tsetChatContinueButtonOnClick( () => {\n\t\t\t\tchangeStep( 'pick-fonts' );\n\t\t\t\tsetCurrentHandoffArea( 'fonts' );\n\t\t\t} );\n\t\t}\n\n\t\tif ( prevFontRef.current !== currentFont ) {\n\t\t\tprevFontRef.current = currentFont;\n\t\t\tsetShowChatContinueButton( true );\n\t\t\tsetChatContinueButtonOnClick( () => {\n\t\t\t\tchangeStep( 'pick-layouts' );\n\t\t\t\tsetCurrentHandoffArea( 'layouts' );\n\t\t\t} );\n\t\t}\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [\n\t\tcurrentColor,\n\t\tcurrentFont,\n\t\thandoffStep,\n\t\tsetShowChatContinueButton,\n\t\tsetChatContinueButtonOnClick,\n\t\tchangeStep,\n\t\tsetCurrentHandoffArea,\n\t] );\n\n\tconst steps = [\n\t\t{\n\t\t\tkey: 'welcome',\n\t\t\tcomponent: (\n\t\t\t\t<HandoffStep\n\t\t\t\t\ttitle={ __( 'Welcome!', 'big-sky' ) }\n\t\t\t\t\tdescription={ __(\n\t\t\t\t\t\t'Pick your color palette, font pairing, and layout in three quick steps. Edit details after in the Editor.',\n\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t) }\n\t\t\t\t\tprimaryCta={ {\n\t\t\t\t\t\ttext: __( 'Continue', 'big-sky' ),\n\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\trecordTracksEvent( 'handoff_continue_click', {\n\t\t\t\t\t\t\t\tstep: 'welcome',\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\tchangeStep( 'pick-colors' );\n\t\t\t\t\t\t\tsetCurrentHandoffArea( 'colors' );\n\t\t\t\t\t\t},\n\t\t\t\t\t} }\n\t\t\t\t\ttertiaryCta={ {\n\t\t\t\t\t\ttext: __( 'Do this later', 'big-sky' ),\n\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\trecordTracksEvent( 'handoff_do_later_click' );\n\t\t\t\t\t\t\tfinishHandoff();\n\t\t\t\t\t\t},\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t),\n\t\t},\n\t\t{\n\t\t\tkey: 'pick-colors',\n\t\t\tcomponent: (\n\t\t\t\t<HandoffStep\n\t\t\t\t\tonBackClick={ () => {\n\t\t\t\t\t\trecordTracksEvent( 'handoff_back_click', {\n\t\t\t\t\t\t\tstep: 'pick-colors',\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tchangeStep( 'welcome' );\n\t\t\t\t\t} }\n\t\t\t\t\ttitle={ __( 'Pick your colors', 'big-sky' ) }\n\t\t\t\t\tdescription={ __(\n\t\t\t\t\t\t\"Select from our AI-recommended color palettes to complement your site's design.\",\n\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t) }\n\t\t\t\t\tcomponent={ ( setHandoffComponent ) => {\n\t\t\t\t\t\tgenerateColorPalette( {\n\t\t\t\t\t\t\tcolors: chosenColors,\n\t\t\t\t\t\t\tcustom_colors: chosenCustomColors,\n\t\t\t\t\t\t\tcategory: '',\n\t\t\t\t\t\t\tcallback: ( component ) => {\n\t\t\t\t\t\t\t\tsetHandoffComponent( component );\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t} );\n\t\t\t\t\t} }\n\t\t\t\t\tprimaryCta={ {\n\t\t\t\t\t\ttext: __( 'Continue', 'big-sky' ),\n\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\trecordTracksEvent( 'handoff_continue_click', {\n\t\t\t\t\t\t\t\tstep: 'pick-colors',\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\tchangeStep( 'pick-fonts' );\n\t\t\t\t\t\t\tsetCurrentHandoffArea( 'fonts' );\n\t\t\t\t\t\t},\n\t\t\t\t\t} }\n\t\t\t\t\ttertiaryCta={ {\n\t\t\t\t\t\ttext: __( 'Ask AI for new color palettes', 'big-sky' ),\n\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\trecordTracksEvent( 'handoff_ask_ai_click', {\n\t\t\t\t\t\t\t\tstep: 'pick-colors',\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\tchangeStep( 'ask-ai-colors' );\n\t\t\t\t\t\t},\n\t\t\t\t\t\tisAi: true,\n\t\t\t\t\t} }\n\t\t\t\t\tonSkip={ () => {\n\t\t\t\t\t\trecordTracksEvent( 'handoff_skip_click', {\n\t\t\t\t\t\t\tstep: 'pick-colors',\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tchangeStep( 'pick-fonts' );\n\t\t\t\t\t\tsetCurrentHandoffArea( 'fonts' );\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t),\n\t\t},\n\t\t{\n\t\t\tkey: 'ask-ai-colors',\n\t\t\tcomponent: (\n\t\t\t\t<HandoffStep\n\t\t\t\t\tonBackClick={ () => {\n\t\t\t\t\t\trecordTracksEvent( 'handoff_back_click', {\n\t\t\t\t\t\t\tstep: 'ask-ai-colors',\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tchangeStep( 'pick-colors' );\n\t\t\t\t\t} }\n\t\t\t\t\ttitle={ __( 'Ask AI', 'big-sky' ) }\n\t\t\t\t\tcomponent={\n\t\t\t\t\t\t<Chat\n\t\t\t\t\t\t\tshowNavigation={ false }\n\t\t\t\t\t\t\tuseBlockContext={ false }\n\t\t\t\t\t\t\tagentQuestion={ __(\n\t\t\t\t\t\t\t\t'Give me a little more information on the type of colors you want, or I can suggest colors for you.',\n\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\tdefaultPrompt={ __(\n\t\t\t\t\t\t\t\t'\"Show me modern colors\"',\n\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\tonlyShowLastRequest={ true }\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t\tisChatMode={ true }\n\t\t\t\t\tonSkip={ () => {\n\t\t\t\t\t\trecordTracksEvent( 'handoff_skip_click', {\n\t\t\t\t\t\t\tstep: 'ask-ai-colors',\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tchangeStep( 'pick-fonts' );\n\t\t\t\t\t\tsetCurrentHandoffArea( 'fonts' );\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t),\n\t\t},\n\t\t{\n\t\t\tkey: 'pick-fonts',\n\t\t\tcomponent: (\n\t\t\t\t<HandoffStep\n\t\t\t\t\tonBackClick={ () => {\n\t\t\t\t\t\trecordTracksEvent( 'handoff_back_click', {\n\t\t\t\t\t\t\tstep: 'pick-fonts',\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tchangeStep( 'pick-colors' );\n\t\t\t\t\t\tsetCurrentHandoffArea( 'colors' );\n\t\t\t\t\t} }\n\t\t\t\t\ttitle={ __( 'Pick your font pair', 'big-sky' ) }\n\t\t\t\t\tdescription={ __(\n\t\t\t\t\t\t'Select from these curated fonts pairing.',\n\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t) }\n\t\t\t\t\tcomponent={ ( setHandoffComponent ) => {\n\t\t\t\t\t\tshowFontPicker( {\n\t\t\t\t\t\t\tkeywords: [],\n\t\t\t\t\t\t\tfonts: chosenFonts,\n\t\t\t\t\t\t\tcallback: ( component ) => {\n\t\t\t\t\t\t\t\tsetHandoffComponent( component );\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t} );\n\t\t\t\t\t} }\n\t\t\t\t\tprimaryCta={ {\n\t\t\t\t\t\ttext: __( 'Continue', 'big-sky' ),\n\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\tchangeStep( 'pick-layouts' );\n\t\t\t\t\t\t\tsetCurrentHandoffArea( 'layouts' );\n\t\t\t\t\t\t},\n\t\t\t\t\t} }\n\t\t\t\t\ttertiaryCta={ {\n\t\t\t\t\t\ttext: __(\n\t\t\t\t\t\t\t'Ask AI to combine more font pairings',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\tchangeStep( 'ask-ai-fonts' );\n\t\t\t\t\t\t},\n\t\t\t\t\t\tisAi: true,\n\t\t\t\t\t} }\n\t\t\t\t\tonSkip={ () => {\n\t\t\t\t\t\trecordTracksEvent( 'handoff_skip_click', {\n\t\t\t\t\t\t\tstep: 'pick-fonts',\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tchangeStep( 'pick-layouts' );\n\t\t\t\t\t\tsetCurrentHandoffArea( 'layouts' );\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t),\n\t\t},\n\t\t{\n\t\t\tkey: 'ask-ai-fonts',\n\t\t\tcomponent: (\n\t\t\t\t<HandoffStep\n\t\t\t\t\tonBackClick={ () => {\n\t\t\t\t\t\trecordTracksEvent( 'handoff_back_click', {\n\t\t\t\t\t\t\tstep: 'ask-ai-fonts',\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tchangeStep( 'pick-fonts' );\n\t\t\t\t\t} }\n\t\t\t\t\ttitle={ __( 'Ask AI', 'big-sky' ) }\n\t\t\t\t\tcomponent={\n\t\t\t\t\t\t<Chat\n\t\t\t\t\t\t\tshowNavigation={ false }\n\t\t\t\t\t\t\tuseBlockContext={ false }\n\t\t\t\t\t\t\tagentQuestion={ __(\n\t\t\t\t\t\t\t\t\"Give me a little more information on the type of fonts you'd like. I can also suggest some fonts for you.\",\n\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\tdefaultPrompt={ __(\n\t\t\t\t\t\t\t\t'\"Show me modern fonts\"',\n\t\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\tonlyShowLastRequest={ true }\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t\tisChatMode={ true }\n\t\t\t\t\tonSkip={ () => {\n\t\t\t\t\t\trecordTracksEvent( 'handoff_skip_click', {\n\t\t\t\t\t\t\tstep: 'ask-ai-fonts',\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tchangeStep( 'pick-layouts' );\n\t\t\t\t\t\tsetCurrentHandoffArea( 'layouts' );\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t),\n\t\t},\n\t\t{\n\t\t\tkey: 'pick-layouts',\n\t\t\tcomponent: (\n\t\t\t\t<HandoffStep\n\t\t\t\t\tonBackClick={ () => {\n\t\t\t\t\t\trecordTracksEvent( 'handoff_back_click', {\n\t\t\t\t\t\t\tstep: 'pick-layouts',\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tchangeStep( 'pick-fonts' );\n\t\t\t\t\t\tsetCurrentHandoffArea( 'fonts' );\n\t\t\t\t\t} }\n\t\t\t\t\ttitle={ __( 'Pick a layout', 'big-sky' ) }\n\t\t\t\t\tdescription={ __(\n\t\t\t\t\t\t'Finally, pick from these layouts to organize your content and enhance user experience.',\n\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t) }\n\t\t\t\t\tcomponent={ ( setHandoffComponent ) => {\n\t\t\t\t\t\tshowSiteLayouts( {\n\t\t\t\t\t\t\tcategories: chosenCategories,\n\t\t\t\t\t\t\tcallback: ( component ) => {\n\t\t\t\t\t\t\t\tsetHandoffComponent( component );\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t} );\n\t\t\t\t\t} }\n\t\t\t\t\tprimaryCta={ {\n\t\t\t\t\t\ttext: __( 'Continue', 'big-sky' ),\n\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\trecordTracksEvent( 'handoff_finish' );\n\t\t\t\t\t\t\tfinishHandoff();\n\t\t\t\t\t\t},\n\t\t\t\t\t} }\n\t\t\t\t\ttertiaryCta={ false }\n\t\t\t\t\tonSkip={ () => {\n\t\t\t\t\t\trecordTracksEvent( 'handoff_skip_click', {\n\t\t\t\t\t\t\tstep: 'pick-layouts',\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tfinishHandoff();\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t),\n\t\t},\n\t];\n\n\treturn (\n\t\t<div key={ steps[ handoffStep ].key }>\n\t\t\t{ cloneElement( steps[ handoffStep ].component ) }\n\t\t</div>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport { getPendingActionMessage } from '@components/dock/utils';\nimport { store as aiStore } from '@store';\n\nexport default function PendingActionMessage() {\n\tconst { currentToolCall } = useSelect( ( select ) => ( {\n\t\tcurrentToolCall: select( aiStore ).getCurrentToolCall(),\n\t} ) );\n\n\tconst { getSelectedBlock } = useSelect( blockEditorStore );\n\tconst selectedBlock = getSelectedBlock();\n\n\treturn (\n\t\t<p className=\"big-sky__dock__pending-action-message\">\n\t\t\t{ getPendingActionMessage( currentToolCall, selectedBlock ) }\n\t\t</p>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { Path, SVG } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst image = /*#__PURE__*/_jsx(SVG, {\n  viewBox: \"0 0 24 24\",\n  xmlns: \"http://www.w3.org/2000/svg\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 4.5h14c.3 0 .5.2.5.5v8.4l-3-2.9c-.3-.3-.8-.3-1 0L11.9 14 9 12c-.3-.2-.6-.2-.8 0l-3.6 2.6V5c-.1-.3.1-.5.4-.5zm14 15H5c-.3 0-.5-.2-.5-.5v-2.4l4.1-3 3 1.9c.3.2.7.2.9-.1L16 12l3.5 3.4V19c0 .3-.2.5-.5.5z\"\n  })\n});\nexport default image;\n//# sourceMappingURL=image.js.map","/**\n * WordPress dependencies\n */\nimport { SVG, Path } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst chevronDown = /*#__PURE__*/_jsx(SVG, {\n  viewBox: \"0 0 24 24\",\n  xmlns: \"http://www.w3.org/2000/svg\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z\"\n  })\n});\nexport default chevronDown;\n//# sourceMappingURL=chevron-down.js.map","/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Button } from '@wordpress/components';\nimport { chevronDown, Icon, image } from '@wordpress/icons';\n\nexport default function CoverImageDockMenuItem( {\n\tonAssistantMenuClick,\n\timageUrl,\n} ) {\n\tconst assistantMenuTitle = __( 'Background Image', 'big-sky' );\n\tconst assistantMenuSlug = 'background-image';\n\n\treturn (\n\t\t<>\n\t\t\t<Button\n\t\t\t\tonClick={ () =>\n\t\t\t\t\tonAssistantMenuClick(\n\t\t\t\t\t\tassistantMenuTitle,\n\t\t\t\t\t\tassistantMenuSlug\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t\ticon={ ! imageUrl && image }\n\t\t\t\tclassName=\"has-color-picker has-chevron\"\n\t\t\t\tlabel={ __( 'Background image', 'big-sky' ) }\n\t\t\t>\n\t\t\t\t{ imageUrl && (\n\t\t\t\t\t<img\n\t\t\t\t\t\tsrc={ imageUrl }\n\t\t\t\t\t\talt={ __( 'Cover image', 'big-sky' ) }\n\t\t\t\t\t\tclassName=\"big-sky__assistant-ai-actions__color-picker__button is-small\"\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t\t<Icon icon={ chevronDown } />\n\t\t\t</Button>\n\t\t</>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Button } from '@wordpress/components';\nimport { chevronDown, Icon } from '@wordpress/icons';\n\nexport default function ButtonDockMenus( { onAssistantMenuClick } ) {\n\tconst assistantMenuTitle = __( 'Update', 'big-sky' );\n\tconst assistantMenuSlug = 'button-update';\n\n\treturn (\n\t\t<>\n\t\t\t<Button\n\t\t\t\tclassName=\"has-chevron\"\n\t\t\t\tonClick={ () =>\n\t\t\t\t\tonAssistantMenuClick(\n\t\t\t\t\t\tassistantMenuTitle,\n\t\t\t\t\t\tassistantMenuSlug\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t>\n\t\t\t\t{ assistantMenuTitle }\n\t\t\t\t<Icon icon={ chevronDown } />\n\t\t\t</Button>\n\t\t</>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { SVG, Path } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst plus = /*#__PURE__*/_jsx(SVG, {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 24 24\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"M11 12.5V17.5H12.5V12.5H17.5V11H12.5V6H11V11H6V12.5H11Z\"\n  })\n});\nexport default plus;\n//# sourceMappingURL=plus.js.map","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { Button } from '@wordpress/components';\nimport { plus } from '@wordpress/icons';\nimport { useChat } from '@automattic/big-sky-agents';\nimport { store as editorStore } from '@wordpress/editor';\n\n/**\n * Internal dependencies\n */\nimport { ChatSuggestions } from '@ai/assistants/shared/make-suggestions';\nimport useChatThread from '@components/chat/thread/use-thread.js';\nimport { store as aiStore } from '@store';\nimport useJetpackToken from '@hooks/use-jetpack-token';\nimport usePatterns from '@hooks/use-patterns';\nimport useSiteMetadata from '@hooks/use-site-metadata';\n\nexport default function GroupDockMenus( { onAssistantMenuClick } ) {\n\tconst assistantMenuTitle = __( 'Add Pattern', 'big-sky' );\n\tconst assistantMenuSlug = 'add-pattern';\n\tconst assistantPrompt = __( 'Describe the pattern to add', 'big-sky' );\n\tconst { userSay } = useChat();\n\tconst { initializeThread } = useChatThread();\n\tconst { setChatComponents, setCurrentUserMessage } = useDispatch( aiStore );\n\tconst { withJetpackTokenRequest } = useJetpackToken();\n\tconst { getAvailablePatternCategories } = usePatterns();\n\n\tconst { patterns } = useSiteMetadata().getSiteMetadata();\n\n\tconst { currentPostId } = useSelect( ( select ) => ( {\n\t\tcurrentPostId: select( editorStore ).getCurrentPostId(),\n\t} ) );\n\n\tconst onClickAddPattern = async () => {\n\t\tonAssistantMenuClick(\n\t\t\tassistantMenuTitle,\n\t\t\tassistantMenuSlug,\n\t\t\tassistantPrompt\n\t\t);\n\t\tinitializeThread(\n\t\t\t__(\n\t\t\t\t'What kind of pattern would you like to add to your page?',\n\t\t\t\t'big-sky'\n\t\t\t)\n\t\t);\n\n\t\tconst availableCategories = getAvailablePatternCategories()?.filter(\n\t\t\t( category ) => category !== 'header' && category !== 'footer'\n\t\t);\n\n\t\tlet currentPatternCategories = [];\n\t\tif ( Array.isArray( patterns ) ) {\n\t\t\tcurrentPatternCategories = patterns.map(\n\t\t\t\t( pattern ) => pattern.category\n\t\t\t);\n\t\t} else {\n\t\t\tcurrentPatternCategories = patterns[ currentPostId ]?.map(\n\t\t\t\t( pattern ) => pattern.category\n\t\t\t);\n\t\t}\n\n\t\t// Randomize the order of the suggested categories\n\t\t// @todo: Prioritize the list based on something relevant.\n\t\tconst suggestedCategories = availableCategories\n\t\t\t.filter(\n\t\t\t\t( category ) => ! currentPatternCategories.includes( category )\n\t\t\t)\n\t\t\t/* eslint-disable-next-line no-restricted-syntax */\n\t\t\t.sort( () => Math.random() - 0.5 );\n\n\t\tconst suggestionArgs = ( category ) => {\n\t\t\tswitch ( category ) {\n\t\t\t\tcase 'about':\n\t\t\t\t\treturn {\n\t\t\t\t\t\tkey: category,\n\t\t\t\t\t\tactionName: __( 'About Section', 'big-sky' ),\n\t\t\t\t\t\tdescription: __( 'A section about my site', 'big-sky' ),\n\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t'Insert a section all about my site',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\tcase 'contact':\n\t\t\t\t\treturn {\n\t\t\t\t\t\tkey: category,\n\t\t\t\t\t\tactionName: __( 'Contact', 'big-sky' ),\n\t\t\t\t\t\tdescription: __( 'A contact section', 'big-sky' ),\n\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t'Insert a section with contact information',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\tcase 'events':\n\t\t\t\t\treturn {\n\t\t\t\t\t\tkey: category,\n\t\t\t\t\t\tactionName: __( 'Events List', 'big-sky' ),\n\t\t\t\t\t\tdescription: __(\n\t\t\t\t\t\t\t'A list of upcoming events',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t'Insert a section with a list of upcoming events',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\tcase 'gallery':\n\t\t\t\t\treturn {\n\t\t\t\t\t\tkey: category,\n\t\t\t\t\t\tactionName: __( 'Image Gallery', 'big-sky' ),\n\t\t\t\t\t\tdescription: __( 'A gallery of images', 'big-sky' ),\n\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t'Insert a section with a gallery of images',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\tcase 'intro':\n\t\t\t\t\treturn {\n\t\t\t\t\t\tkey: category,\n\t\t\t\t\t\tactionName: __( 'Intro Section', 'big-sky' ),\n\t\t\t\t\t\tdescription: __(\n\t\t\t\t\t\t\t'A section introducing my site',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t'Insert a section introducing my site',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\tcase 'menu':\n\t\t\t\t\treturn {\n\t\t\t\t\t\tkey: category,\n\t\t\t\t\t\tactionName: __( 'Menu', 'big-sky' ),\n\t\t\t\t\t\tdescription: __( 'A food menu', 'big-sky' ),\n\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t'Insert a section for my food menu',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\tcase 'newsletter':\n\t\t\t\t\treturn {\n\t\t\t\t\t\tkey: category,\n\t\t\t\t\t\tactionName: __( 'Newsletter', 'big-sky' ),\n\t\t\t\t\t\tdescription: __(\n\t\t\t\t\t\t\t'A newsletter subscribe form',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t'Insert a section with a newsletter subscribe form',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\tcase 'posts':\n\t\t\t\t\treturn {\n\t\t\t\t\t\tkey: category,\n\t\t\t\t\t\tactionName: __( 'Posts List', 'big-sky' ),\n\t\t\t\t\t\tdescription: __( 'A list of my posts', 'big-sky' ),\n\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t'Insert a section with a list of my posts',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\tcase 'pricing':\n\t\t\t\t\treturn {\n\t\t\t\t\t\tkey: category,\n\t\t\t\t\t\tactionName: __( 'Pricing Table', 'big-sky' ),\n\t\t\t\t\t\tdescription: __(\n\t\t\t\t\t\t\t'A pricing table for my services',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t'Insert a section with a pricing table for my services',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\tcase 'services':\n\t\t\t\t\treturn {\n\t\t\t\t\t\tkey: category,\n\t\t\t\t\t\tactionName: __( 'Services List', 'big-sky' ),\n\t\t\t\t\t\tdescription: __( 'A list of my services', 'big-sky' ),\n\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t'Insert a section with a list of my services',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\tcase 'testimonials':\n\t\t\t\t\treturn {\n\t\t\t\t\t\tkey: category,\n\t\t\t\t\t\tactionName: __( 'Testimonials', 'big-sky' ),\n\t\t\t\t\t\tdescription: __( 'A list of testimonials', 'big-sky' ),\n\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t'Insert a section with some testimonials',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\tcase 'team':\n\t\t\t\t\treturn {\n\t\t\t\t\t\tkey: category,\n\t\t\t\t\t\tactionName: __( 'Team', 'big-sky' ),\n\t\t\t\t\t\tdescription: __( 'A list of team members', 'big-sky' ),\n\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t'Insert a section with a list of team members',\n\t\t\t\t\t\t\t'big-sky'\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\tdefault:\n\t\t\t\t\tconst uppercaseCategory =\n\t\t\t\t\t\tcategory.charAt( 0 ).toUpperCase() +\n\t\t\t\t\t\tcategory.slice( 1 );\n\t\t\t\t\treturn {\n\t\t\t\t\t\tkey: category,\n\t\t\t\t\t\tactionName: uppercaseCategory,\n\t\t\t\t\t\tdescription: sprintf(\n\t\t\t\t\t\t\t// translators: %s is the pattern category name\n\t\t\t\t\t\t\t__( 'A %s section', 'big-sky' ),\n\t\t\t\t\t\t\tuppercaseCategory\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t}\n\t\t};\n\n\t\t// Build the args for the chat suggestions\n\t\t// If there are no suggested patterns, show a generic \"add a pattern\" suggestion\n\t\tconst args = {\n\t\t\tactions: suggestedCategories.map( ( category ) =>\n\t\t\t\tsuggestionArgs( category )\n\t\t\t),\n\t\t};\n\n\t\tconst respond = async ( message ) => {\n\t\t\tawait withJetpackTokenRequest( () => userSay( message ) );\n\t\t\tsetCurrentUserMessage( '' );\n\t\t\tsetChatComponents( [] );\n\t\t};\n\n\t\tsetChatComponents( [\n\t\t\t<ChatSuggestions\n\t\t\t\tkey=\"suggestions\"\n\t\t\t\targs={ args }\n\t\t\t\trespond={ respond }\n\t\t\t/>,\n\t\t] );\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<Button\n\t\t\t\tonClick={ () => onClickAddPattern() }\n\t\t\t\ticon={ plus }\n\t\t\t\ticonPosition=\"left\"\n\t\t\t>\n\t\t\t\t{ assistantMenuTitle }\n\t\t\t</Button>\n\t\t</>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Button } from '@wordpress/components';\nimport { chevronDown, Icon } from '@wordpress/icons';\n\nexport default function ImageDockMenus( { onAssistantMenuClick } ) {\n\tconst assistantMenuTitle = __( 'Regenerate', 'big-sky' );\n\tconst assistantMenuSlug = 'regenerate-image';\n\n\treturn (\n\t\t<>\n\t\t\t<Button\n\t\t\t\tclassName=\"has-chevron\"\n\t\t\t\tonClick={ () =>\n\t\t\t\t\tonAssistantMenuClick(\n\t\t\t\t\t\tassistantMenuTitle,\n\t\t\t\t\t\tassistantMenuSlug\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t>\n\t\t\t\t{ assistantMenuTitle }\n\t\t\t\t<Icon icon={ chevronDown } />\n\t\t\t</Button>\n\t\t</>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\nimport { Button } from '@wordpress/components';\nimport { plus } from '@wordpress/icons';\nimport { useChat } from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport { ChatSuggestions } from '@ai/assistants/shared/make-suggestions';\nimport useChatThread from '@components/chat/thread/use-thread.js';\nimport { store as aiStore } from '@store';\nimport useJetpackToken from '@hooks/use-jetpack-token';\n\nexport default function NavigationDockMenus( { onAssistantMenuClick } ) {\n\tconst assistantMenuTitle = __( 'Add Page', 'big-sky' );\n\tconst assistantPrompt = __( 'Describe the page to add', 'big-sky' );\n\tconst assistantMenuSlug = 'add-page';\n\tconst { userSay } = useChat();\n\tconst { initializeThread } = useChatThread();\n\tconst { setChatComponents } = useDispatch( aiStore );\n\tconst { withJetpackTokenRequest } = useJetpackToken();\n\n\tconst onClickAddPage = async () => {\n\t\tonAssistantMenuClick(\n\t\t\tassistantMenuTitle,\n\t\t\tassistantMenuSlug,\n\t\t\tassistantPrompt\n\t\t);\n\t\tinitializeThread(\n\t\t\t__( 'What kind of page would you like to add?', 'big-sky' )\n\t\t);\n\n\t\t// TODO - Smart suggestion for pages.\n\t\tconst args = {\n\t\t\tactions: [\n\t\t\t\t__( 'A contact page', 'big-sky' ),\n\t\t\t\t__( 'A blog page', 'big-sky' ),\n\t\t\t],\n\t\t};\n\t\tconst respond = async ( message ) => {\n\t\t\tawait withJetpackTokenRequest( () => userSay( message ) );\n\t\t\tsetChatComponents( [] );\n\t\t};\n\n\t\tsetChatComponents( [\n\t\t\t<ChatSuggestions\n\t\t\t\tkey=\"suggestions\"\n\t\t\t\targs={ args }\n\t\t\t\trespond={ respond }\n\t\t\t/>,\n\t\t] );\n\n\t\t// TODO - Add page to the nav menu.\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<Button\n\t\t\t\tonClick={ () => onClickAddPage() }\n\t\t\t\ticon={ plus }\n\t\t\t\ticonPosition=\"left\"\n\t\t\t>\n\t\t\t\t{ assistantMenuTitle }\n\t\t\t</Button>\n\t\t</>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Button } from '@wordpress/components';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as editorStore } from '@wordpress/editor';\n\nfunction NavigationItemDockMenus( { selectedBlock } ) {\n\tconst { currentPostId } = useSelect( ( select ) => ( {\n\t\tcurrentPostId: select( editorStore ).getCurrentPostId(),\n\t} ) );\n\tconst { savePost } = useDispatch( editorStore );\n\n\t// Don't show the menu if the menu item is the current page.\n\tif ( selectedBlock?.attributes?.id === currentPostId ) {\n\t\treturn null;\n\t}\n\n\tconst assistantMenuTitle = __( 'Edit page', 'big-sky' );\n\tconst navigateToPage = async () => {\n\t\tawait savePost();\n\t\twindow.location.href = `/wp-admin/site-editor.php?postId=${ selectedBlock?.attributes?.id }&postType=${ selectedBlock?.attributes?.type }&canvas=edit`;\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<Button icon=\"edit\" onClick={ navigateToPage }>\n\t\t\t\t{ assistantMenuTitle }\n\t\t\t</Button>\n\t\t</>\n\t);\n}\n\nexport default NavigationItemDockMenus;\n","/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Button } from '@wordpress/components';\nimport { chevronDown, Icon } from '@wordpress/icons';\n\nexport default function TextDockMenus( { onAssistantMenuClick } ) {\n\tconst assistantMenuTitle = __( 'Rewrite', 'big-sky' );\n\tconst assistantMenuSlug = 'rewrite';\n\n\treturn (\n\t\t<>\n\t\t\t<Button\n\t\t\t\tclassName=\"has-chevron\"\n\t\t\t\tonClick={ () =>\n\t\t\t\t\tonAssistantMenuClick(\n\t\t\t\t\t\tassistantMenuTitle,\n\t\t\t\t\t\tassistantMenuSlug\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t>\n\t\t\t\t{ assistantMenuTitle }\n\t\t\t\t<Icon icon={ chevronDown } />\n\t\t\t</Button>\n\t\t</>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Button } from '@wordpress/components';\nimport { useCallback, useMemo } from '@wordpress/element';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { store as blocksStore } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\nimport useVariations from '@hooks/use-variations';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport useStyles from '@hooks/use-styles';\nimport { recordTracksEvent } from '@utils/tracks';\nimport { sectionStyleRegex } from '@utils/constants';\n\nexport default function SectionColorVariationPickerMenu() {\n\tconst { selectedBlock } = useSelect( ( select ) => {\n\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\t\treturn {\n\t\t\tselectedBlock: getSelectedBlock(),\n\t\t};\n\t} );\n\tconst { getBlockStyles } = useSelect( blocksStore );\n\tconst { updateBlockAttributes } = useDispatch( blockEditorStore );\n\n\tconst { resetBlockTextColor } = useStyles();\n\tconst { getSectionVariationBackgroundColor, getSectionVariationTextColor } =\n\t\tuseVariations();\n\tconst { currentColor: currentColorVariationName } =\n\t\tuseSiteMetadata().getSiteMetadata();\n\n\tconst getVariations = useCallback( () => {\n\t\tif ( ! selectedBlock ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst variations = getBlockStyles( selectedBlock.name );\n\n\t\tif ( ! variations ) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Add in the default theme variation if default doesn't exist already\n\t\tif ( ! variations.find( ( v ) => v.name === 'section-default' ) ) {\n\t\t\tvariations.unshift( {\n\t\t\t\tname: 'section-default',\n\t\t\t\tlabel: 'Default',\n\t\t\t} );\n\t\t}\n\n\t\treturn variations;\n\t}, [ getBlockStyles, selectedBlock ] );\n\n\tconst getCurrentVariation = useCallback( () => {\n\t\tif ( ! selectedBlock || ! selectedBlock?.attributes?.className ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst styleClasses = [\n\t\t\t...selectedBlock.attributes.className?.matchAll(\n\t\t\t\tsectionStyleRegex\n\t\t\t),\n\t\t];\n\n\t\tif ( ! styleClasses || styleClasses.length < 1 ) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn styleClasses[ 0 ][ 1 ]?.trim();\n\t}, [ selectedBlock ] );\n\n\tconst resetInnerBlocksTextColor = useCallback(\n\t\t( block ) => {\n\t\t\tresetBlockTextColor( block );\n\t\t\tif ( block.innerBlocks.length ) {\n\t\t\t\tblock.innerBlocks.forEach( ( innerBlock ) => {\n\t\t\t\t\tresetInnerBlocksTextColor( innerBlock );\n\t\t\t\t} );\n\t\t\t}\n\t\t},\n\t\t[ resetBlockTextColor ]\n\t);\n\n\tconst setNextVariation = useCallback(\n\t\t( currentVariationName ) => {\n\t\t\tif ( ! selectedBlock ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst variations = getVariations();\n\n\t\t\trecordTracksEvent( 'dock_menu_item_click', {\n\t\t\t\tmenu_slug: 'section-color-variation-picker',\n\t\t\t} );\n\n\t\t\tif ( ! variations ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentVariationIndex = variations.findIndex(\n\t\t\t\t( v ) => v.name === currentVariationName\n\t\t\t);\n\n\t\t\tconst nextVariationIndex =\n\t\t\t\tcurrentVariationIndex + 1 >= variations.length\n\t\t\t\t\t? 0\n\t\t\t\t\t: currentVariationIndex + 1;\n\n\t\t\tconst sectionVariationName = variations[ nextVariationIndex ].name;\n\n\t\t\t// remove is-style-X from the className of the selectedBlock\n\t\t\tconst newClassNames = selectedBlock.attributes.className.replaceAll(\n\t\t\t\tsectionStyleRegex,\n\t\t\t\t''\n\t\t\t);\n\n\t\t\tupdateBlockAttributes( selectedBlock.clientId, {\n\t\t\t\tclassName: `${ newClassNames.trim() } is-style-${ sectionVariationName }`,\n\t\t\t} );\n\n\t\t\t// reset color of all inner blocks\n\t\t\tresetInnerBlocksTextColor( selectedBlock );\n\t\t},\n\t\t[\n\t\t\tgetVariations,\n\t\t\tresetInnerBlocksTextColor,\n\t\t\tselectedBlock,\n\t\t\tupdateBlockAttributes,\n\t\t]\n\t);\n\n\treturn useMemo( () => {\n\t\tconst activeVariation = getCurrentVariation();\n\n\t\tif ( ! activeVariation ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst { hex: backgroundColor } = getSectionVariationBackgroundColor(\n\t\t\tactiveVariation,\n\t\t\tcurrentColorVariationName\n\t\t);\n\t\tconst { hex: textColor } = getSectionVariationTextColor(\n\t\t\tactiveVariation,\n\t\t\tcurrentColorVariationName\n\t\t);\n\n\t\treturn (\n\t\t\tbackgroundColor &&\n\t\t\ttextColor && (\n\t\t\t\t<Button\n\t\t\t\t\tkey={ `variation-${ activeVariation }` }\n\t\t\t\t\tlabel={ __( 'Pattern styles', 'big-sky' ) }\n\t\t\t\t\tonClick={ () => setNextVariation( activeVariation ) }\n\t\t\t\t\tstyle={ {\n\t\t\t\t\t\tbackground: `linear-gradient(90deg, ${ backgroundColor } 50%, ${ textColor } 50%, ${ textColor } 100%)`,\n\t\t\t\t\t} }\n\t\t\t\t\tclassName={ `big-sky__pattern-variations-menu__button` }\n\t\t\t\t/>\n\t\t\t)\n\t\t);\n\t}, [\n\t\tgetCurrentVariation,\n\t\tgetSectionVariationBackgroundColor,\n\t\tcurrentColorVariationName,\n\t\tgetSectionVariationTextColor,\n\t\tsetNextVariation,\n\t] );\n}\n","import classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { Button, ColorPicker, Dropdown, Icon } from '@wordpress/components';\nimport { useCallback, useEffect, useRef, useState } from '@wordpress/element';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\nimport { chevronDown } from '@wordpress/icons';\nimport useStyles from '@hooks/use-styles';\nimport useBlocks from '@hooks/use-blocks';\nimport useVariations from '@hooks/use-variations';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport { recordTracksEvent } from '@utils/tracks';\nimport { sectionStyleRegex } from '@utils/constants';\n\nexport default function ColorPickerMenu() {\n\tconst { currentColor } = useSiteMetadata().getSiteMetadata();\n\tconst { getBlockAttributes, selectedBlock } = useSelect( ( select ) => {\n\t\tconst { getBlockAttributes: _getBlockAttributes, getSelectedBlock } =\n\t\t\tselect( blockEditorStore );\n\t\treturn {\n\t\t\tgetBlockAttributes: _getBlockAttributes,\n\t\t\tselectedBlock: getSelectedBlock(),\n\t\t};\n\t} );\n\tconst { updateBlockAttributes } = useDispatch( blockEditorStore );\n\n\tconst { getParentRootPatternBlock } = useBlocks();\n\tconst { getThemeColors } = useStyles();\n\tconst { getSectionVariationTextColor } = useVariations();\n\n\tconst themeColors = getThemeColors();\n\tconst [ selectedColor, setSelectedColor ] = useState( () => {\n\t\treturn (\n\t\t\tselectedBlock.attributes?.textColor ||\n\t\t\tselectedBlock.attributes?.style?.color?.text ||\n\t\t\tnull\n\t\t);\n\t} );\n\tconst [ customColor, setCustomColor ] = useState( null );\n\n\tconst getDefaultTextColor = useCallback( () => {\n\t\tconst blankStyle =\n\t\t\t'#fff linear-gradient(-45deg,#0000 48%,#ddd 0,#ddd 52%,#0000 0)';\n\n\t\tif ( ! selectedBlock ) {\n\t\t\treturn blankStyle;\n\t\t}\n\n\t\tconst parentRootPatternBlock = getParentRootPatternBlock(\n\t\t\tselectedBlock.clientId\n\t\t);\n\n\t\tif (\n\t\t\t! parentRootPatternBlock ||\n\t\t\t! parentRootPatternBlock.attributes?.className\n\t\t) {\n\t\t\treturn blankStyle;\n\t\t}\n\n\t\t// Find the css Classname in parentRootPatternBlock.attributes.className and that starts with is-style-X and return it\n\t\tconst classNames = [\n\t\t\t...parentRootPatternBlock.attributes.className?.matchAll(\n\t\t\t\tsectionStyleRegex\n\t\t\t),\n\t\t];\n\n\t\tif ( ! classNames.length ) {\n\t\t\treturn blankStyle;\n\t\t}\n\n\t\tconst variationName = classNames[ 0 ][ 1 ];\n\n\t\tif ( ! variationName ) {\n\t\t\treturn blankStyle;\n\t\t}\n\n\t\tconst { hex: defaultTextColor } = getSectionVariationTextColor(\n\t\t\tvariationName,\n\t\t\tcurrentColor\n\t\t);\n\n\t\treturn defaultTextColor || blankStyle;\n\t}, [\n\t\tselectedBlock,\n\t\tgetParentRootPatternBlock,\n\t\tgetSectionVariationTextColor,\n\t\tcurrentColor,\n\t] );\n\n\tconst getSelectedBlockTextColor = useCallback( () => {\n\t\t// find the theme color corresponding to the slug\n\t\tconst themeColor = themeColors.find( ( { slug } ) => {\n\t\t\treturn slug === selectedBlock.attributes?.textColor;\n\t\t} );\n\t\treturn (\n\t\t\tthemeColor?.color ||\n\t\t\tselectedBlock.attributes?.style?.color?.text ||\n\t\t\tgetDefaultTextColor()\n\t\t);\n\t}, [ getDefaultTextColor, selectedBlock.attributes, themeColors ] );\n\n\tuseEffect( () => {\n\t\tsetSelectedColor( null );\n\n\t\tconst selectedBlockTextColor = getSelectedBlockTextColor();\n\n\t\tif ( selectedBlockTextColor ) {\n\t\t\tsetSelectedColor( selectedBlockTextColor );\n\t\t}\n\n\t\t// Check if the selected color is in the theme colors list.\n\t\t// If not then set it as a custom color.\n\t\tif (\n\t\t\tthemeColors.find( ( { color } ) => {\n\t\t\t\treturn color === selectedBlock.attributes?.textColor;\n\t\t\t} ) === undefined\n\t\t) {\n\t\t\tdoSetCustomColor( selectedBlock.attributes?.style?.color?.text );\n\t\t}\n\t}, [ getSelectedBlockTextColor, selectedBlock, themeColors ] );\n\n\tconst colorWheelButton = useRef();\n\n\tconst doSetSelectedColor = async ( { color, slug } ) => {\n\t\tsetSelectedColor( color );\n\t\tconst attributes = getBlockAttributes( selectedBlock.clientId );\n\t\tconst updatedAttributes = {\n\t\t\t...attributes,\n\t\t\ttextColor: slug,\n\t\t};\n\t\tif ( ! slug ) {\n\t\t\tupdatedAttributes.textColor = null;\n\t\t\tupdatedAttributes.style = {\n\t\t\t\t...attributes.style,\n\t\t\t\tcolor: {\n\t\t\t\t\t...attributes.style.color,\n\t\t\t\t\ttext: color,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\tawait updateBlockAttributes(\n\t\t\tselectedBlock.clientId,\n\t\t\tupdatedAttributes\n\t\t);\n\t};\n\n\tconst doSetCustomColor = ( newColor ) => {\n\t\tif ( colorWheelButton.current ) {\n\t\t\tcolorWheelButton.current.style.background = newColor;\n\t\t}\n\t\tsetCustomColor( newColor );\n\t};\n\n\tconst renderColorPalette = () => {\n\t\treturn themeColors.map( ( { color, slug } ) => {\n\t\t\treturn (\n\t\t\t\t<Button\n\t\t\t\t\tkey={ color }\n\t\t\t\t\tstyle={ { background: color } }\n\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\trecordTracksEvent( 'dock_menu_item_click', {\n\t\t\t\t\t\t\tselected_block: selectedBlock?.name || null,\n\t\t\t\t\t\t\tmenu_slug: 'color-picker-choice',\n\t\t\t\t\t\t\tcolor_name: color,\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tdoSetSelectedColor( { color, slug } );\n\t\t\t\t\t} }\n\t\t\t\t\tclassName={ `big-sky__assistant-ai-actions__color-picker__button${\n\t\t\t\t\t\tselectedColor === color ? ' is-selected' : ''\n\t\t\t\t\t}` }\n\t\t\t\t/>\n\t\t\t);\n\t\t} );\n\t};\n\n\tconst renderColorWheel = () => {\n\t\treturn (\n\t\t\t<Dropdown\n\t\t\t\tclassName=\"big-sky__assistant-ai-actions__color-picker__wheel\"\n\t\t\t\tcontentClassName=\"big-sky__assistant-ai-actions__popover-content big-sky__assistant-ai-actions__popover-colorpicker\"\n\t\t\t\tpopoverProps={ { placement: 'top-center', offset: 16 } }\n\t\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\t'big-sky__assistant-ai-actions__color-picker__button',\n\t\t\t\t\t\t\t'big-sky__assistant-ai-actions__color-picker__wheel-button',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t'is-selected': selectedColor === customColor,\n\t\t\t\t\t\t\t\t'has-custom-color': customColor,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tstyle={ { background: customColor } }\n\t\t\t\t\t\tref={ colorWheelButton }\n\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\trecordTracksEvent( 'dock_menu_item_click', {\n\t\t\t\t\t\t\t\tselected_block: selectedBlock?.name || null,\n\t\t\t\t\t\t\t\tmenu_slug: 'color-picker-choice',\n\t\t\t\t\t\t\t\tcolor_name: 'color-wheel',\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\tif ( customColor ) {\n\t\t\t\t\t\t\t\tdoSetCustomColor( customColor );\n\t\t\t\t\t\t\t\tdoSetSelectedColor( {\n\t\t\t\t\t\t\t\t\tcolor: customColor,\n\t\t\t\t\t\t\t\t\tslug: null,\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonToggle();\n\t\t\t\t\t\t} }\n\t\t\t\t\t\taria-expanded={ isOpen }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ customColor && (\n\t\t\t\t\t\t\t<span className=\"big-sky__assistant-ai-actions__color-picker__custom-indicator\"></span>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</Button>\n\t\t\t\t) }\n\t\t\t\trenderContent={ () => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<ColorPicker\n\t\t\t\t\t\t\tonChange={ ( color ) => {\n\t\t\t\t\t\t\t\tdoSetCustomColor( color );\n\t\t\t\t\t\t\t\tdoSetSelectedColor( {\n\t\t\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t\t\t\tslug: null,\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\tcolor={ customColor }\n\t\t\t\t\t\t/>\n\t\t\t\t\t);\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\t};\n\n\tconst menuBackgroundColor =\n\t\tselectedColor || customColor || getDefaultTextColor();\n\n\treturn (\n\t\t<Dropdown\n\t\t\tcontentClassName=\"big-sky__assistant-ai-actions__popover-content\"\n\t\t\tpopoverProps={ { placement: 'top-center', offset: 14 } }\n\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\n\t\t\t\t<div\n\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\trecordTracksEvent( 'dock_menu_item_click', {\n\t\t\t\t\t\t\tselected_block: selectedBlock?.name || null,\n\t\t\t\t\t\t\tmenu_slug: 'color-picker-toggle',\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tonToggle();\n\t\t\t\t\t} }\n\t\t\t\t\trole=\"button\"\n\t\t\t\t\ttabIndex={ 0 }\n\t\t\t\t\tonKeyDown={ ( e ) => {\n\t\t\t\t\t\tif ( e.key === 'Enter' || e.key === ' ' ) {\n\t\t\t\t\t\t\tonToggle();\n\t\t\t\t\t\t}\n\t\t\t\t\t} }\n\t\t\t\t>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclassName=\"has-chevron has-color-picker\"\n\t\t\t\t\t\taria-expanded={ isOpen }\n\t\t\t\t\t>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tstyle={ { background: menuBackgroundColor } }\n\t\t\t\t\t\t\tclassName=\"big-sky__assistant-ai-actions__color-picker__button is-small\"\n\t\t\t\t\t\t></span>\n\t\t\t\t\t\t<Icon icon={ chevronDown } />\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t) }\n\t\t\trenderContent={ () => {\n\t\t\t\treturn (\n\t\t\t\t\t<div className=\"big-sky__assistant-ai-actions__color-picker\">\n\t\t\t\t\t\t{ renderColorPalette() }\n\t\t\t\t\t\t{ renderColorWheel() }\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t} }\n\t\t/>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useCallback } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport CoverImageDockMenuItem from '@components/dock/menus/cover-image';\nimport ButtonDockMenus from '@components/dock/menus/button';\nimport GroupDockMenus from '@components/dock/menus/group';\nimport ImageDockMenus from '@components/dock/menus/images';\nimport NavigationDockMenus from '@components/dock/menus/navigation';\nimport NavigationItemDockMenus from '@components/dock/menus/navigation-item';\nimport TextDockMenus from '@components/dock/menus/text';\nimport SectionColorVariationPickerMenu from '@components/dock/menus/section-color-variation-picker';\nimport ColorPickerMenu from '@components/dock/menus/color-picker';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport { getDefaultChatSettings } from '@components/dock/utils';\nimport { store as aiStore } from '@store';\nimport { dockViews } from '@utils/constants';\nimport { recordTracksEvent } from '@utils/tracks';\n\nexport default function ButtonBarMenus( {\n\tsetChatSettings,\n\tsetUseBlockContext,\n} ) {\n\tconst { isOnboarded } = useSiteMetadata().getSiteMetadata();\n\n\tconst { selectedBlock } = useSelect( ( select ) => {\n\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\t\treturn {\n\t\t\tselectedBlock: getSelectedBlock(),\n\t\t};\n\t} );\n\tconst { setDockView, setLastSelectedBlock, setHideInput } =\n\t\tuseDispatch( aiStore );\n\n\tconst getMenus = useCallback( () => {\n\t\tif ( ! selectedBlock || ! isOnboarded ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst getMenuProps = ( additionalChatSettings = {} ) => {\n\t\t\treturn {\n\t\t\t\tonAssistantMenuClick: (\n\t\t\t\t\tdockMenuTitle,\n\t\t\t\t\tassistantMenuSlug = null,\n\t\t\t\t\tdockPrompt = getDefaultChatSettings( isOnboarded ).prompt,\n\t\t\t\t\tuseBlockContext = true\n\t\t\t\t) => {\n\t\t\t\t\trecordTracksEvent( 'dock_menu_item_click', {\n\t\t\t\t\t\tselected_block: selectedBlock?.name || null,\n\t\t\t\t\t\tmenu_slug: assistantMenuSlug,\n\t\t\t\t\t} );\n\t\t\t\t\tsetHideInput( false );\n\t\t\t\t\tsetUseBlockContext( useBlockContext );\n\t\t\t\t\tsetLastSelectedBlock( selectedBlock );\n\t\t\t\t\tsetDockView( dockViews.CHAT );\n\t\t\t\t\tsetChatSettings( {\n\t\t\t\t\t\ttitle: dockMenuTitle,\n\t\t\t\t\t\tprompt: dockPrompt,\n\t\t\t\t\t\t...additionalChatSettings,\n\t\t\t\t\t} );\n\t\t\t\t},\n\t\t\t};\n\t\t};\n\n\t\tconst isPatternSelected =\n\t\t\tselectedBlock?.attributes?.metadata?.remotePatternId;\n\n\t\tswitch ( selectedBlock.name ) {\n\t\t\tcase 'core/group':\n\t\t\tcase 'core/post-content':\n\t\t\t\tif ( ! isPatternSelected ) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\treturn (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<GroupDockMenus\n\t\t\t\t\t\t\t{ ...getMenuProps( { showThread: true } ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<SectionColorVariationPickerMenu />\n\t\t\t\t\t</>\n\t\t\t\t);\n\t\t\tcase 'core/paragraph':\n\t\t\tcase 'core/heading':\n\t\t\t\treturn (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<TextDockMenus { ...getMenuProps() } />\n\t\t\t\t\t\t<ColorPickerMenu />\n\t\t\t\t\t</>\n\t\t\t\t);\n\t\t\tcase 'core/image':\n\t\t\tcase 'core/site-logo':\n\t\t\t\treturn (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<ImageDockMenus { ...getMenuProps() } />\n\t\t\t\t\t</>\n\t\t\t\t);\n\t\t\tcase 'core/cover':\n\t\t\t\treturn (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<GroupDockMenus\n\t\t\t\t\t\t\t{ ...getMenuProps( { showThread: true } ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<CoverImageDockMenuItem\n\t\t\t\t\t\t\t{ ...getMenuProps() }\n\t\t\t\t\t\t\timageUrl={ selectedBlock?.attributes?.url }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</>\n\t\t\t\t);\n\t\t\tcase 'core/button':\n\t\t\tcase 'core/social-link':\n\t\t\t\treturn (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<ButtonDockMenus { ...getMenuProps() } />\n\t\t\t\t\t</>\n\t\t\t\t);\n\t\t\tcase 'core/navigation-link':\n\t\t\t\treturn (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<NavigationItemDockMenus\n\t\t\t\t\t\t\t{ ...getMenuProps() }\n\t\t\t\t\t\t\tselectedBlock={ selectedBlock }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</>\n\t\t\t\t);\n\t\t\tcase 'core/page-list':\n\t\t\tcase 'core/navigation':\n\t\t\t\treturn (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<NavigationDockMenus { ...getMenuProps() } />\n\t\t\t\t\t</>\n\t\t\t\t);\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t}, [\n\t\tselectedBlock,\n\t\tisOnboarded,\n\t\tsetHideInput,\n\t\tsetUseBlockContext,\n\t\tsetLastSelectedBlock,\n\t\tsetDockView,\n\t\tsetChatSettings,\n\t] );\n\n\tconst menus = getMenus();\n\n\treturn (\n\t\t<>\n\t\t\t{ menus && <div className=\"big-sky__dock-ai-menus\">{ menus }</div> }\n\t\t</>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { useCallback, useEffect } from '@wordpress/element';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport { store as aiStore } from '@store';\nimport CompletedAction from './completed-action.js';\nimport Handoff from './handoff/index.js';\nimport PendingActionMessage from './pending-action.js';\nimport ButtonBarMenus from '@components/dock/menus';\nimport BigSkyIcon from '@components/big-sky-icon';\nimport { getDefaultChatSettings } from '@components/dock/utils';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport { dockViews } from '@utils/constants.js';\nimport { recordTracksEvent } from '@utils/tracks';\nimport { useChat } from '@automattic/big-sky-agents';\n\nexport default function ButtonBar( { setChatSettings, setUseBlockContext } ) {\n\tconst { isOnboarded } = useSiteMetadata().getSiteMetadata();\n\tconst { setDockView, setIsToolContainerVisible, setHideInput } =\n\t\tuseDispatch( aiStore );\n\tconst {\n\t\tdockView,\n\t\tisAssistantButtonVisible,\n\t\tisBuildingSite,\n\t\tselectedBlock,\n\t} = useSelect( ( select ) => {\n\t\tconst ai = select( aiStore );\n\t\tconst blockEditor = select( blockEditorStore );\n\n\t\treturn {\n\t\t\tisAssistantButtonVisible: ai.getIsAssistantButtonVisible(),\n\t\t\tisBuildingSite: ai.getIsBuildingSite(),\n\t\t\tdockView: ai.getDockView(),\n\t\t\tselectedBlock: blockEditor.getSelectedBlock(),\n\t\t};\n\t} );\n\tconst { setShowThread } = useDispatch( aiStore );\n\tconst { clearMessages } = useChat();\n\n\tconst openAssistant = useCallback( () => {\n\t\tif (\n\t\t\tisBuildingSite ||\n\t\t\t[ dockViews.PENDING, dockViews.HANDOFF ].includes( dockView )\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t\trecordTracksEvent( 'dock_assistant_icon_click', {\n\t\t\tselected_block: selectedBlock?.name || null,\n\t\t} );\n\t\tclearMessages();\n\t\tsetHideInput( false );\n\t\tsetUseBlockContext( false );\n\t\tsetShowThread( false );\n\t\tsetDockView( dockViews.CHAT );\n\t\tsetChatSettings( getDefaultChatSettings( isOnboarded ) );\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [\n\t\tisBuildingSite,\n\t\tdockView,\n\t\tsetUseBlockContext,\n\t\tsetShowThread,\n\t\tsetDockView,\n\t\tsetChatSettings,\n\t\tisOnboarded,\n\t] );\n\n\tuseEffect( () => {\n\t\tconst handleKeyDown = ( event ) => {\n\t\t\t// Open Assistant on cmd+j\n\t\t\tif (\n\t\t\t\tisOnboarded &&\n\t\t\t\t( event.metaKey || event.ctrlKey ) &&\n\t\t\t\tevent.key === 'j'\n\t\t\t) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif ( dockView === dockViews.CHAT ) {\n\t\t\t\t\tsetDockView( dockViews.MENUS );\n\t\t\t\t} else {\n\t\t\t\t\topenAssistant();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tdocument.addEventListener( 'keydown', handleKeyDown );\n\t\treturn () => {\n\t\t\tdocument.removeEventListener( 'keydown', handleKeyDown );\n\t\t};\n\t}, [ openAssistant, dockView, setDockView, isOnboarded ] );\n\n\treturn (\n\t\t<>\n\t\t\t{ ( ! [\n\t\t\t\tdockViews.CHAT,\n\t\t\t\tdockViews.COMPLETED,\n\t\t\t\tdockViews.HANDOFF,\n\t\t\t].includes( dockView ) ||\n\t\t\t\t( dockView === dockViews.HANDOFF &&\n\t\t\t\t\tisAssistantButtonVisible ) ) && (\n\t\t\t\t<BigSkyIcon\n\t\t\t\t\tonClick={ openAssistant }\n\t\t\t\t\twidth={ 48 }\n\t\t\t\t\theight={ 48 }\n\t\t\t\t/>\n\t\t\t) }\n\t\t\t{ dockView === dockViews.HANDOFF && (\n\t\t\t\t<Handoff setChatSettings={ setChatSettings } />\n\t\t\t) }\n\t\t\t{ dockView === dockViews.COMPLETED && (\n\t\t\t\t<CompletedAction\n\t\t\t\t\tsetIsToolContainerVisible={ setIsToolContainerVisible }\n\t\t\t\t/>\n\t\t\t) }\n\t\t\t{ dockView === dockViews.PENDING && <PendingActionMessage /> }\n\t\t\t{ dockView === dockViews.MENUS && (\n\t\t\t\t<ButtonBarMenus\n\t\t\t\t\tsetUseBlockContext={ setUseBlockContext }\n\t\t\t\t\tsetChatSettings={ setChatSettings }\n\t\t\t\t/>\n\t\t\t) }\n\t\t</>\n\t);\n}\n","/**\n * External dependencies\n */\nimport classNames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport {\n\t__unstableAnimatePresence as AnimatePresence,\n\t__unstableMotion as motion,\n\tPopover,\n} from '@wordpress/components';\n\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { useCallback, useEffect, useRef, useState } from '@wordpress/element';\nimport { store as editorStore } from '@wordpress/editor';\n\n/**\n * Internal dependencies\n */\nimport { dockViews } from '@utils/constants';\nimport { recordTracksEvent } from '@utils/tracks';\nimport './style.scss';\n\nimport Chat from '@components/chat';\nimport { getCanvasIframeElements } from '@utils/canvas-iframe-elements';\nimport useCanvas from '@hooks/use-canvas.js';\nimport { store as aiStore } from '@store';\nimport useSiteMetadata from '@hooks/use-site-metadata';\n\nimport {\n\tgetDefaultChatSettings,\n\tgetDockHeight,\n\tgetDockWidth,\n\tgetNewDockView,\n\tshouldHideMessageThread,\n} from '@components/dock/utils';\nimport ToolContainer from './tool-container/index.js';\nimport ButtonBar from './button-bar/index.js';\nimport { useChat } from '@automattic/big-sky-agents';\nimport useShowLayoutPickerToolFunctions from '@ai/assistants/layout/tools/show-layout-picker/use-show-layout-picker-tool.js';\n\nexport default function Dock() {\n\t// If there is a selected block, but the user clicks the assistant button instead\n\t// the block menu then the block context is ignored and site actions are shown.\n\tconst [ useBlockContext, setUseBlockContext ] = useState( true );\n\n\tconst [ cssClasses, setCssClasses ] = useState( 'big-sky__dock' );\n\tconst [ previousSelectedBlockClientId, setPreviousSelectedBlockClientId ] =\n\t\tuseState( null );\n\tconst { isOnboarded } = useSiteMetadata().getSiteMetadata();\n\tconst { zoomIn, zoomOut } = useCanvas();\n\tconst [ chatSettings, setChatSettings ] = useState(\n\t\tgetDefaultChatSettings( isOnboarded )\n\t);\n\n\tconst { messages, clearMessages, agentSay } = useChat();\n\tconst { showSiteLayouts } = useShowLayoutPickerToolFunctions();\n\n\tconst {\n\t\tsetChatComponents,\n\t\tsetShowThread,\n\t\tsetDockView,\n\t\tsetOnSelectedBlockAction,\n\t\tsetInputtedFiles,\n\t\tsetOnInputtedFilesAction,\n\t\tsetShowEditorWelcome,\n\t\tsetToolComponent,\n\t\tsetIsToolContainerVisible,\n\t} = useDispatch( aiStore );\n\tconst { selectedBlock, editorMode, currentPostId } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getSelectedBlock, __unstableGetEditorMode } =\n\t\t\t\tselect( blockEditorStore );\n\t\t\tconst { getCurrentPostId } = select( editorStore );\n\t\t\treturn {\n\t\t\t\tselectedBlock: getSelectedBlock(),\n\t\t\t\teditorMode: __unstableGetEditorMode(),\n\t\t\t\tcurrentPostId: getCurrentPostId(),\n\t\t\t};\n\t\t}\n\t);\n\tconst {\n\t\tisHandoff,\n\t\tisBuildingSite,\n\t\tisToolContainerVisible,\n\t\tisMaximized,\n\t\tshowThread,\n\t\tpendingToolCallbacks,\n\t\tdockView,\n\t\tcurrentToolCall,\n\t\tonSelectedBlockAction,\n\t\tisEditorReady,\n\t\tnewPageId,\n\t} = useSelect( ( select ) => {\n\t\tconst ai = select( aiStore );\n\n\t\treturn {\n\t\t\tisHandoff: ai.getIsHandoff(),\n\t\t\tisBuildingSite: ai.getIsBuildingSite(),\n\t\t\tisToolContainerVisible: ai.isToolContainerVisible(),\n\t\t\tcurrentToolCall: ai.getCurrentToolCall(),\n\t\t\tshowThread: ai.getShowThread(),\n\t\t\tpendingToolCallbacks: select( aiStore ).getPendingToolCallbacks(),\n\t\t\tdockView: ai.getDockView(),\n\t\t\tisMaximized: ai.getIsMaximized(),\n\t\t\tonSelectedBlockAction: ai.getOnSelectedBlockAction(),\n\t\t\tisEditorReady: ai.getIsEditorReady(),\n\t\t\tnewPageId: ai.getNewPageId(),\n\t\t};\n\t} );\n\n\tconst dockContentRef = useRef();\n\n\tconst resetDockState = useCallback( () => {\n\t\tsetShowThread( false );\n\t\tsetChatComponents( [] );\n\t\tsetOnSelectedBlockAction( {} );\n\t\tsetInputtedFiles( [] );\n\t\tsetOnInputtedFilesAction( {} );\n\t\tclearMessages();\n\t\tsetShowEditorWelcome( false );\n\t}, [\n\t\tsetShowThread,\n\t\tsetChatComponents,\n\t\tsetOnSelectedBlockAction,\n\t\tsetInputtedFiles,\n\t\tsetOnInputtedFilesAction,\n\t\tclearMessages,\n\t\tsetShowEditorWelcome,\n\t] );\n\n\t// Set the correct CSS classes on the top level dock container\n\t// depending on the state of the dock.\n\tuseEffect( () => {\n\t\tsetCssClasses(\n\t\t\tclassNames( 'big-sky__dock', {\n\t\t\t\t'big-sky__dock__is-menus': dockView === dockViews.MENUS,\n\t\t\t\t'big-sky__dock__is-chat': dockView === dockViews.CHAT,\n\t\t\t} )\n\t\t);\n\n\t\tconst { canvasiFrameBody } = getCanvasIframeElements();\n\n\t\t// add class to the iframe body representing the current dock view\n\t\tif ( canvasiFrameBody?.classList ) {\n\t\t\tcanvasiFrameBody.classList.remove( 'big-sky__dock__is-menus' );\n\t\t\tcanvasiFrameBody.classList.remove( 'big-sky__dock__is-chat' );\n\t\t\tcanvasiFrameBody.classList.add( `big-sky__dock__is-${ dockView }` );\n\t\t}\n\t}, [ dockView, isOnboarded ] );\n\n\tconst selectedBlockHasChanged =\n\t\tselectedBlock?.clientId &&\n\t\tpreviousSelectedBlockClientId !== selectedBlock?.clientId;\n\n\tuseEffect( () => {\n\t\tif ( selectedBlockHasChanged ) {\n\t\t\tresetDockState();\n\t\t\tsetPreviousSelectedBlockClientId( selectedBlock.clientId );\n\t\t}\n\t}, [\n\t\tonSelectedBlockAction?.action,\n\t\tresetDockState,\n\t\tselectedBlock,\n\t\tselectedBlockHasChanged,\n\t\teditorMode,\n\t] );\n\n\tuseEffect( () => {\n\t\tconst newView = getNewDockView( {\n\t\t\tisOnboarded,\n\t\t\tisHandoff,\n\t\t\tdockView,\n\t\t\tshowThread,\n\t\t\tisToolContainerVisible,\n\t\t\tpendingToolCallbacks,\n\t\t\tselectedBlockHasChanged,\n\t\t\tcurrentToolCall,\n\t\t} );\n\n\t\tif ( newView !== dockView ) {\n\t\t\tsetDockView( newView );\n\t\t}\n\n\t\tif (\n\t\t\tshouldHideMessageThread( {\n\t\t\t\tshowThread,\n\t\t\t\tnewView,\n\t\t\t\tuseBlockContext,\n\t\t\t\tselectedBlockHasChanged,\n\t\t\t} )\n\t\t) {\n\t\t\tsetShowThread( false );\n\t\t}\n\t}, [\n\t\tisOnboarded,\n\t\tisHandoff,\n\t\tdockView,\n\t\tshowThread,\n\t\tselectedBlock,\n\t\tpreviousSelectedBlockClientId,\n\t\tisToolContainerVisible,\n\t\tpendingToolCallbacks,\n\t\tsetShowThread,\n\t\tselectedBlockHasChanged,\n\t\tuseBlockContext,\n\t\tsetDockView,\n\t\tcurrentToolCall,\n\t] );\n\n\tconst handleOnClickBack = useCallback( () => {\n\t\trecordTracksEvent( 'dock_back_button_click' );\n\t\tzoomIn();\n\t\tsetDockView( dockViews.MENUS );\n\t\tresetDockState();\n\t}, [ zoomIn, setDockView, resetDockState ] );\n\n\t// Close Dock on Escape ESC\n\tuseEffect( () => {\n\t\tif ( ! isOnboarded || isBuildingSite ) {\n\t\t\treturn;\n\t\t}\n\t\tconst handleKeyDown = ( event ) => {\n\t\t\tif ( event.key === 'Escape' ) {\n\t\t\t\thandleOnClickBack();\n\t\t\t}\n\t\t};\n\t\tdocument.addEventListener( 'keydown', handleKeyDown );\n\t\treturn () => {\n\t\t\tdocument.removeEventListener( 'keydown', handleKeyDown );\n\t\t};\n\t}, [ handleOnClickBack, isOnboarded, isBuildingSite ] );\n\n\t// When creating a new page, show the layout picker after navigation\n\tuseEffect( () => {\n\t\tif ( ! isEditorReady || newPageId !== currentPostId ) {\n\t\t\treturn;\n\t\t}\n\t\tagentSay(\n\t\t\tshowSiteLayouts( {\n\t\t\t\tcallback: ( component ) => {\n\t\t\t\t\tzoomOut();\n\t\t\t\t\tsetToolComponent( component );\n\t\t\t\t\tsetIsToolContainerVisible( true );\n\t\t\t\t\tsetDockView( dockViews.COMPLETED );\n\t\t\t\t},\n\t\t\t} )\n\t\t);\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ currentPostId, isEditorReady, newPageId ] );\n\n\treturn (\n\t\t<>\n\t\t\t<ToolContainer />\n\t\t\t<Popover\n\t\t\t\tresize={ isMaximized }\n\t\t\t\tclassName={ classNames(\n\t\t\t\t\t'big-sky__dock__wrapper',\n\t\t\t\t\t'big-sky__assistant-ai-actions__popover-content',\n\t\t\t\t\t{\n\t\t\t\t\t\t'big-sky__dock__is-onboarding': ! isOnboarded,\n\t\t\t\t\t\t'big-sky__dock__is-maximized': isMaximized,\n\t\t\t\t\t}\n\t\t\t\t) }\n\t\t\t>\n\t\t\t\t<div className={ cssClasses }>\n\t\t\t\t\t<AnimatePresence mode=\"wait\">\n\t\t\t\t\t\t<div className=\"big-sky__dock__container\">\n\t\t\t\t\t\t\t<motion.div\n\t\t\t\t\t\t\t\tlayoutRoot\n\t\t\t\t\t\t\t\tclassName=\"big-sky__dock__animator\"\n\t\t\t\t\t\t\t\tkey={ `${ selectedBlock?.name }-content` }\n\t\t\t\t\t\t\t\tref={ dockContentRef }\n\t\t\t\t\t\t\t\tinitial={ {\n\t\t\t\t\t\t\t\t\twidth: dockContentRef.current?.offsetWidth,\n\t\t\t\t\t\t\t\t\theight: dockContentRef.current\n\t\t\t\t\t\t\t\t\t\t?.offsetHeight,\n\t\t\t\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\tanimate={ {\n\t\t\t\t\t\t\t\t\topacity: 1,\n\t\t\t\t\t\t\t\t\twidth: getDockWidth(\n\t\t\t\t\t\t\t\t\t\tdockView,\n\t\t\t\t\t\t\t\t\t\tisMaximized\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\theight: getDockHeight(\n\t\t\t\t\t\t\t\t\t\tdockView,\n\t\t\t\t\t\t\t\t\t\tisMaximized\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\ttransition: {\n\t\t\t\t\t\t\t\t\t\ttype: 'spring',\n\t\t\t\t\t\t\t\t\t\tmass: 1.1,\n\t\t\t\t\t\t\t\t\t\tstiffness: 280,\n\t\t\t\t\t\t\t\t\t\tdamping: 28,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ dockView === dockViews.CHAT &&\n\t\t\t\t\t\t\t\t\t! selectedBlockHasChanged && (\n\t\t\t\t\t\t\t\t\t\t<Chat\n\t\t\t\t\t\t\t\t\t\t\tshowNavigation={\n\t\t\t\t\t\t\t\t\t\t\t\tmessages.length > 0\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tnavigationTitle={\n\t\t\t\t\t\t\t\t\t\t\t\tchatSettings.title\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tonClickBackButton={ () =>\n\t\t\t\t\t\t\t\t\t\t\t\thandleOnClickBack()\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tuseBlockContext={ useBlockContext }\n\t\t\t\t\t\t\t\t\t\t\tdefaultPrompt={\n\t\t\t\t\t\t\t\t\t\t\t\tchatSettings.prompt\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tisOnboarded={ isOnboarded }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t<ButtonBar\n\t\t\t\t\t\t\t\t\tsetChatSettings={ setChatSettings }\n\t\t\t\t\t\t\t\t\tsetUseBlockContext={ setUseBlockContext }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</motion.div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</AnimatePresence>\n\t\t\t\t</div>\n\t\t\t</Popover>\n\t\t</>\n\t);\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"preferences\"];","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as editorStore } from '@wordpress/editor';\nimport { store as coreDataStore } from '@wordpress/core-data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport apiFetch from '@wordpress/api-fetch';\n\n/**\n * Internal dependencies\n */\nimport log from '@utils/log-debug.js';\nimport { isSimpleSite } from '@utils/site-type.js';\n\nfunction preloadImageAndLogError( url ) {\n\t/* global Image */\n\tconst image = new Image();\n\timage.onerror = ( error ) => {\n\t\tlog.error(\n\t\t\t'Error preloading image after uploading from pexels',\n\t\t\terror,\n\t\t\t{ url }\n\t\t);\n\t};\n\timage.src = url;\n}\n\nfunction getExternalImages( blocks, siteUrl ) {\n\tconst result = [];\n\n\tblocks.forEach( ( block ) => {\n\t\tif (\n\t\t\t[ 'core/image', 'core/cover' ].includes( block.name ) &&\n\t\t\tblock.attributes.url &&\n\t\t\t! block.attributes.url.startsWith( siteUrl ) &&\n\t\t\tblock.attributes.url.includes( 'pexels.com' ) // We only want to upload images from Pexels\n\t\t) {\n\t\t\tresult.push( block );\n\t\t}\n\t\tresult.push( ...getExternalImages( block.innerBlocks, siteUrl ) );\n\t} );\n\n\treturn result;\n}\n\nlet isUploading = false;\n\nexport default function useSaveExternalImages() {\n\tconst { postType, postId } = useSelect( ( select ) => ( {\n\t\tpostType: select( editorStore ).getCurrentPostType(),\n\t\tpostId: select( editorStore ).getCurrentPostId(),\n\t} ) );\n\tconst isSavingPage = useSelect( ( select ) =>\n\t\tselect( coreDataStore ).isSavingEntityRecord(\n\t\t\t'postType',\n\t\t\tpostType,\n\t\t\tpostId\n\t\t)\n\t);\n\tconst { editorBlocks, siteUrl } = useSelect(\n\t\t( select ) => ( {\n\t\t\teditorBlocks: select( editorStore ).getEditorBlocks(),\n\t\t\tmediaUpload: select( blockEditorStore ).getSettings().mediaUpload,\n\t\t\tsiteUrl: select( coreDataStore ).getSite()?.url || '',\n\t\t} ),\n\t\t[]\n\t);\n\n\tconst { updateBlockAttributes } = useDispatch( blockEditorStore );\n\tconst { savePost } = useDispatch( editorStore );\n\n\tfunction uploadImages() {\n\t\tconst isWpcomSimple = isSimpleSite();\n\t\tconst mediaUrl = isWpcomSimple\n\t\t\t? `https://${ window.Jetpack_Editor_Initial_State.siteFragment }`\n\t\t\t: siteUrl;\n\t\tconst externalImages = getExternalImages( editorBlocks, mediaUrl );\n\n\t\tconst externalImagesWithSourceId = externalImages.map( ( image ) => {\n\t\t\tconst pexelsIdMatch = image.attributes.url.match(\n\t\t\t\t/pexels\\.com\\/photos\\/(\\d+)\\//\n\t\t\t);\n\t\t\timage.pexelsID = pexelsIdMatch ? pexelsIdMatch[ 1 ] : null;\n\t\t\treturn image;\n\t\t} );\n\n\t\tconst externalImagesFromPexels = externalImagesWithSourceId.filter(\n\t\t\t( image ) => image.pexelsID\n\t\t);\n\n\t\tconst responsePromises = [];\n\n\t\tif ( externalImagesFromPexels.length > 0 ) {\n\t\t\tconst path = isWpcomSimple\n\t\t\t\t? 'rest/v1.1/external-media-upload'\n\t\t\t\t: 'wpcom/v2/external-media/copy/pexels';\n\n\t\t\tconst mediaData = externalImagesFromPexels.map( ( item ) => ( {\n\t\t\t\tguid: JSON.stringify( {\n\t\t\t\t\turl: item.attributes.url,\n\t\t\t\t\tcaption: item.pexelsID,\n\t\t\t\t\tname: `image-pexels-${ item.pexelsID }.jpg`,\n\t\t\t\t\ttitle: 'Uploaded from Pexels ' + item.pexelsID,\n\t\t\t\t} ),\n\t\t\t} ) );\n\t\t\tconst pexelsUploadViaEndpointPromise = apiFetch( {\n\t\t\t\tpath,\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdata: {\n\t\t\t\t\t[ isWpcomSimple ? 'external_ids' : 'media' ]: isWpcomSimple\n\t\t\t\t\t\t? mediaData.map( ( item ) => item.guid )\n\t\t\t\t\t\t: mediaData,\n\t\t\t\t\tservice: 'pexels', // WPCOM.\n\t\t\t\t\tpost_id: postId,\n\t\t\t\t},\n\t\t\t} ).then(\n\t\t\t\t( response ) =>\n\t\t\t\t\tnew Promise( ( resolve, reject ) => {\n\t\t\t\t\t\tconst responseMedia = response?.media ?? response;\n\t\t\t\t\t\tlog.info( 'Uploaded images', responseMedia );\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\texternalImagesFromPexels.length !==\n\t\t\t\t\t\t\tresponseMedia.length\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\treject( 'Not all images were uploaded' );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor ( let i = 0; i < responseMedia.length; i++ ) {\n\t\t\t\t\t\t\tconst error =\n\t\t\t\t\t\t\t\tresponseMedia[ i ].error ??\n\t\t\t\t\t\t\t\tresponseMedia[ i ].errors ??\n\t\t\t\t\t\t\t\tnull;\n\t\t\t\t\t\t\tif ( null !== error ) {\n\t\t\t\t\t\t\t\treject( error );\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tpreloadImageAndLogError(\n\t\t\t\t\t\t\t\tresponseMedia[ i ]?.URL ??\n\t\t\t\t\t\t\t\t\tresponseMedia[ i ].url\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tupdateBlockAttributes(\n\t\t\t\t\t\t\t\texternalImagesFromPexels[ i ].clientId,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tid:\n\t\t\t\t\t\t\t\t\t\tresponseMedia[ i ]?.ID ??\n\t\t\t\t\t\t\t\t\t\tresponseMedia[ i ].id,\n\t\t\t\t\t\t\t\t\turl:\n\t\t\t\t\t\t\t\t\t\tresponseMedia[ i ]?.URL ??\n\t\t\t\t\t\t\t\t\t\tresponseMedia[ i ].url,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} )\n\t\t\t);\n\t\t\tresponsePromises.push( pexelsUploadViaEndpointPromise );\n\t\t} else {\n\t\t\tPromise.resolve( [] );\n\t\t}\n\n\t\treturn Promise.all( responsePromises );\n\t}\n\n\tconst importExternalImagesNow = async () => {\n\t\tisUploading = true;\n\t\tawait uploadImages();\n\t\tisUploading = false;\n\t};\n\n\tconst importExternalImagesOnSave = async () => {\n\t\tif (\n\t\t\tisUploading ||\n\t\t\t! isSavingPage ||\n\t\t\tprocess.env.PERSIST === 'false'\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t\tisUploading = true;\n\t\tconst uploaded = await uploadImages();\n\t\tif ( uploaded.length > 0 ) {\n\t\t\tawait savePost();\n\t\t}\n\t\tisUploading = false;\n\t};\n\n\treturn { importExternalImagesNow, importExternalImagesOnSave };\n}\n","/**\n * WordPress dependencies\n */\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { subscribe, useDispatch, useSelect } from '@wordpress/data';\nimport { store as editorStore } from '@wordpress/editor';\nimport { store as preferencesStore } from '@wordpress/preferences';\nimport { useCallback, useEffect, useRef, useState } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport useSaveExternalImages from '@hooks/use-save-external-images';\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport useBlocks from '@hooks/use-blocks';\nimport { store as aiStore } from '@store';\nimport setDelay from '@utils/set-delay';\nimport useCanvas from '@hooks/use-canvas.js';\nimport usePatterns from '@hooks/use-patterns.js';\nimport { getCanvasIframeElements } from '@utils/canvas-iframe-elements';\nimport useColorizedLogo from '@hooks/use-colorized-logo';\n\nexport default function EditorSetup() {\n\tuseCanvasSetup( { awaitEditor: true } );\n\tconst { importExternalImagesOnSave } = useSaveExternalImages();\n\tuseEffect( () => {\n\t\timportExternalImagesOnSave();\n\t}, [ importExternalImagesOnSave ] );\n\n\treturn null;\n}\n\n// This hook is deliberately in the same file as the component that uses it as the\n// useEffects run should only be added once so we don't want this hook accidently used elsewhere.\nfunction useCanvasSetup( { awaitEditor } ) {\n\tconst {\n\t\tcanvasMode,\n\t\tclearTemplateParts,\n\t\tclearBlocks,\n\t\tinsertDummySections,\n\t\tsetIframeScale,\n\t\tzoomIn,\n\t\tzoomOut,\n\t} = useCanvas();\n\tconst { setDefaultEditMode } = usePatterns();\n\tconst [ awaitingEditor, setAwaitingEditor ] = useState( false );\n\tconst [ awaitingTemplatePartContent, setAwaitingTemplatePartContent ] =\n\t\tuseState( false );\n\tconst { getBlocks, getBlockCount } = useSelect( ( select ) => ( {\n\t\tgetBlocks: select( blockEditorStore ).getBlocks,\n\t\tgetBlockCount: select( blockEditorStore ).getBlockCount,\n\t} ) );\n\n\tconst { setRenderingMode } = useDispatch( editorStore );\n\n\tconst { isOnboarded } = useSiteMetadata().getSiteMetadata();\n\tconst {\n\t\tchosenCategories,\n\t\tisBuildingSite,\n\t\tisEditorReady,\n\t\tisEditorIframeLoaded,\n\t\tisHandoff,\n\t\tisTemplatePartContentReady,\n\t} = useSelect( ( select ) => ( {\n\t\tchosenCategories: select( aiStore ).getChosenCategories(),\n\t\tisBuildingSite: select( aiStore ).getIsBuildingSite(),\n\t\tisEditorReady: select( aiStore ).getIsEditorReady(),\n\t\tisEditorIframeLoaded: select( aiStore ).getIsEditorIframeLoaded(),\n\t\tisHandoff: select( aiStore ).getIsHandoff(),\n\t\tisTemplatePartContentReady:\n\t\t\tselect( aiStore ).getIsTemplatePartContentReady(),\n\t} ) );\n\n\tconst { getContentBlockClientID, getTemplatePartClientID } = useBlocks();\n\n\tconst { setDefaults: setPreferencesDefaults } =\n\t\tuseDispatch( preferencesStore );\n\tconst {\n\t\tsetIsEditorReady,\n\t\tsetIsEditorIframeLoaded,\n\t\tsetIsTemplatePartContentReady,\n\t} = useDispatch( aiStore );\n\n\tconst { setShowWelcomeGuide } =\n\t\tuseDispatch( 'automattic/wpcom-welcome-guide' ) ?? {}; // eslint-disable-line @wordpress/data-no-store-string-literals\n\n\tuseEffect( () => {\n\t\tconst whenEditorIsReady = () => {\n\t\t\treturn new Promise( ( resolve ) => {\n\t\t\t\tconst unsubscribe = subscribe( () => {\n\t\t\t\t\t// This will trigger after the initial render blocking, before the window load event\n\t\t\t\t\t// This seems currently more reliable than using __unstableIsEditorReady\n\t\t\t\t\tif ( getBlockCount( getContentBlockClientID() ) >= 0 ) {\n\t\t\t\t\t\tunsubscribe();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\t\t};\n\n\t\tconst waitForEditorReady = async () => {\n\t\t\tawait whenEditorIsReady();\n\t\t\tsetIsEditorReady( true );\n\t\t};\n\n\t\tif ( awaitEditor && ! awaitingEditor ) {\n\t\t\tsetAwaitingEditor( true );\n\t\t\twaitForEditorReady();\n\t\t}\n\t}, [\n\t\tgetBlockCount,\n\t\tsetIsEditorReady,\n\t\tawaitEditor,\n\t\tawaitingEditor,\n\t\tgetContentBlockClientID,\n\t] );\n\n\tconst getCanvasHtml = useCallback( () => {\n\t\tconst { canvasiFrameDocument } = getCanvasIframeElements();\n\t\treturn canvasiFrameDocument?.querySelector( 'html' );\n\t}, [] );\n\n\tuseEffect( () => {\n\t\tsetPreferencesDefaults( 'core', {\n\t\t\tdistractionFree: true,\n\t\t\tfixedToolbar: true,\n\t\t\tisComplementaryAreaVisible: false,\n\t\t\tshowBlockBreadcrumbs: false,\n\t\t} );\n\n\t\tsetPreferencesDefaults( 'core/edit-site', {\n\t\t\tisComplementaryAreaVisible: false,\n\t\t\twelcomeGuide: false,\n\t\t\twelcomeGuidePage: false,\n\t\t\twelcomeGuideStyles: false,\n\t\t\twelcomeGuideTemplate: false,\n\t\t} );\n\t}, [ setPreferencesDefaults ] );\n\n\tuseEffect( () => {\n\t\tif ( setShowWelcomeGuide ) setShowWelcomeGuide( false );\n\t}, [ setShowWelcomeGuide ] );\n\n\tuseEffect( () => {\n\t\tconst checkIframeLoaded = async () => {\n\t\t\tconst canvasHtml = getCanvasHtml();\n\t\t\tif (\n\t\t\t\t! canvasHtml?.classList.contains( 'block-editor-iframe__html' )\n\t\t\t) {\n\t\t\t\tawait setDelay( 500 );\n\t\t\t\tcheckIframeLoaded();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetIsEditorIframeLoaded( true );\n\t\t};\n\t\tif ( isEditorReady && awaitEditor && ! isEditorIframeLoaded ) {\n\t\t\tcheckIframeLoaded();\n\t\t}\n\t}, [\n\t\tawaitEditor,\n\t\tgetCanvasHtml,\n\t\tisEditorIframeLoaded,\n\t\tisEditorReady,\n\t\tsetIsEditorIframeLoaded,\n\t] );\n\n\tuseColorizedLogo();\n\n\tconst observer = useRef( null );\n\n\tuseEffect( () => {\n\t\tconst { canvasiFrame } = getCanvasIframeElements();\n\n\t\tif ( isEditorIframeLoaded ) {\n\t\t\t// set iframe visibility\n\t\t\tcanvasiFrame.style.visibility = 'visible';\n\n\t\t\tif ( ! observer.current ) {\n\t\t\t\tobserver.current = new window.MutationObserver(\n\t\t\t\t\t( mutations ) => {\n\t\t\t\t\t\tfor ( const mutation of mutations ) {\n\t\t\t\t\t\t\tfor ( const removedNode of mutation.removedNodes ) {\n\t\t\t\t\t\t\t\tif ( removedNode.contains( canvasiFrame ) ) {\n\t\t\t\t\t\t\t\t\tsetIsEditorIframeLoaded( false );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tobserver.current.observe(\n\t\t\t\t\tdocument.getElementById( 'site-editor' ),\n\t\t\t\t\t{ subtree: true, childList: true }\n\t\t\t\t);\n\t\t\t}\n\t\t} else if ( observer.current ) {\n\t\t\tobserver.current.disconnect();\n\t\t\tobserver.current = null;\n\t\t}\n\n\t\treturn () => {\n\t\t\tif ( observer.current ) {\n\t\t\t\tobserver.current.disconnect();\n\t\t\t\tobserver.current = null;\n\t\t\t}\n\t\t};\n\t}, [ isEditorIframeLoaded, setIsEditorIframeLoaded ] );\n\n\tuseEffect( () => {\n\t\tconst adjustCanvasOpacity = async () => {\n\t\t\tconst { canvasiFrame } = getCanvasIframeElements();\n\t\t\tif ( isEditorReady && ! isEditorIframeLoaded && canvasiFrame ) {\n\t\t\t\tcanvasiFrame.style.opacity = 0;\n\t\t\t} else if (\n\t\t\t\tisEditorReady &&\n\t\t\t\tisEditorIframeLoaded &&\n\t\t\t\tcanvasiFrame\n\t\t\t) {\n\t\t\t\tawait setDelay( 300 );\n\t\t\t\tcanvasiFrame.style.opacity = 1;\n\t\t\t}\n\t\t};\n\t\tadjustCanvasOpacity();\n\t}, [ isEditorReady, isEditorIframeLoaded ] );\n\n\tuseEffect( () => {\n\t\tconst whenTemplatePartContentIsReady = () => {\n\t\t\treturn new Promise( ( resolve ) => {\n\t\t\t\tconst unsubscribe = subscribe( () => {\n\t\t\t\t\tconst headerContentBlocks = getBlocks(\n\t\t\t\t\t\tgetTemplatePartClientID( 'header' )\n\t\t\t\t\t);\n\t\t\t\t\tconst footerContentBlocks = getBlocks(\n\t\t\t\t\t\tgetTemplatePartClientID( 'footer' )\n\t\t\t\t\t);\n\t\t\t\t\tif (\n\t\t\t\t\t\theaderContentBlocks.length > 0 &&\n\t\t\t\t\t\tfooterContentBlocks.length > 0\n\t\t\t\t\t) {\n\t\t\t\t\t\tunsubscribe();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\t\t};\n\n\t\tconst waitForTemplatePartContentReady = async () => {\n\t\t\tawait whenTemplatePartContentIsReady();\n\t\t\tsetIsTemplatePartContentReady( true );\n\t\t};\n\n\t\tif ( awaitEditor && ! awaitingTemplatePartContent ) {\n\t\t\tsetAwaitingTemplatePartContent( true );\n\t\t\twaitForTemplatePartContentReady();\n\t\t}\n\t}, [\n\t\tgetTemplatePartClientID,\n\t\tgetBlocks,\n\t\tsetIsTemplatePartContentReady,\n\t\tawaitEditor,\n\t\tawaitingTemplatePartContent,\n\t] );\n\n\tuseEffect( () => {\n\t\tif ( ! isTemplatePartContentReady ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst headerBlocks = getBlocks( getTemplatePartClientID( 'header' ) );\n\t\tconst footerBlocks = getBlocks( getTemplatePartClientID( 'footer' ) );\n\n\t\tsetDefaultEditMode( [ ...headerBlocks, ...footerBlocks ] );\n\t}, [\n\t\tisTemplatePartContentReady,\n\t\tgetBlocks,\n\t\tgetTemplatePartClientID,\n\t\tsetDefaultEditMode,\n\t] );\n\n\tuseEffect( () => {\n\t\tconst adjustCanvasMode = async () => {\n\t\t\tconst { canvasiFrame, canvasiFrameRoot } =\n\t\t\t\tgetCanvasIframeElements();\n\n\t\t\tif ( isBuildingSite ) {\n\t\t\t\tcanvasiFrame.classList.add( 'big-sky__is-building-site' );\n\t\t\t\tcanvasiFrameRoot.classList.add( 'big-sky__is-building-site' );\n\t\t\t\tcanvasiFrameRoot.classList.add(\n\t\t\t\t\t'big-sky__is-building-site-overlay'\n\t\t\t\t);\n\n\t\t\t\tzoomOut();\n\t\t\t\tsetRenderingMode( 'template-locked' );\n\n\t\t\t\tif ( ! isHandoff ) {\n\t\t\t\t\tawait setDelay( 500 );\n\t\t\t\t\tawait Promise.all( [\n\t\t\t\t\t\tclearTemplateParts(),\n\t\t\t\t\t\tclearBlocks(),\n\t\t\t\t\t] );\n\t\t\t\t\tif ( chosenCategories.length ) {\n\t\t\t\t\t\tawait insertDummySections( {\n\t\t\t\t\t\t\tcount: chosenCategories.length + 2,\n\t\t\t\t\t\t\treplaceTemplateParts: true,\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tcanvasiFrameRoot.classList.remove(\n\t\t\t\t\t\t\t'big-sky__is-building-site-overlay'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( isOnboarded ) {\n\t\t\t\tsetRenderingMode( 'template-locked' );\n\t\t\t\tzoomIn();\n\t\t\t}\n\n\t\t\tcanvasiFrame.classList.remove( 'big-sky__is-building-site' );\n\t\t\tcanvasiFrameRoot.classList.remove( 'big-sky__is-building-site' );\n\t\t};\n\n\t\tif ( ! isEditorIframeLoaded ) return;\n\n\t\tadjustCanvasMode();\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [\n\t\tchosenCategories,\n\t\tisBuildingSite,\n\t\tisEditorIframeLoaded,\n\t\tisOnboarded,\n\t] );\n\n\tuseEffect( () => {\n\t\tconst handleCanvasModeChange = async () => {\n\t\t\tconst { canvasiFrameRoot } = getCanvasIframeElements();\n\t\t\tconst messageList = document.querySelector(\n\t\t\t\t'.big-sky__ai-messages'\n\t\t\t);\n\t\t\tif ( canvasMode === 'view' ) {\n\t\t\t\tdocument\n\t\t\t\t\t.querySelector( 'body' )\n\t\t\t\t\t.classList.add( 'big-sky__canvas-mode-view' );\n\t\t\t\tcanvasiFrameRoot?.classList?.add( 'big-sky__canvas-mode-view' );\n\t\t\t\tif ( messageList ) messageList.style.visibility = 'hidden';\n\t\t\t} else {\n\t\t\t\tdocument\n\t\t\t\t\t.querySelector( 'body' )\n\t\t\t\t\t.classList.remove( 'big-sky__canvas-mode-view' );\n\t\t\t\tcanvasiFrameRoot?.classList?.remove(\n\t\t\t\t\t'big-sky__canvas-mode-view'\n\t\t\t\t);\n\n\t\t\t\tawait setDelay( 1500 );\n\t\t\t\tif ( messageList ) messageList.style.visibility = 'visible';\n\t\t\t\tsetIframeScale();\n\t\t\t}\n\t\t};\n\n\t\thandleCanvasModeChange();\n\t}, [ canvasMode, isEditorIframeLoaded, setIframeScale ] );\n}\n","/**\n * Colorizes the black-and-transparent logo to match the current color.\n *\n * There are three ways of colorizing the logo:\n * 1. SVG Filter: https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feColorMatrix\n * 2. CSS Mask: https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_masking\n * 3. Canvas Compositing: https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation\n *\n * # SVG Filter #\n * The filter can be applied to any element. It's defined as a matrix which takes as input RGBA values and outputs\n * transformed R'G'B'A' values.\n *\n * Pros:\n * * Quick. The effect is generated by the browser using CSS.\n * * Applicable to any element and is \"live\" on that element.\n *\n * Cons:\n * * Because of some odd colorspace issues, the resulting color isn't always precisely the same as what we'd\n *   expect. (It's always close.)\n * * Requires DOM manipulation. We need an SVG element in the canvas iframe.\n *   In theory, it would be possible to include the SVG element in the CSS file instead via an inline data URL.\n *   Mobile Safari does not support fragments in data URLs, though (i.e., data:image/svg,...#fragment),\n *   and fragments are required for referencing the SVG filter in CSS. So we're stuck with direct DOM manipulation.\n * * Requires CSS/HTML changes on the frontend.\n *\n * # CSS Masking #\n * Sets the background color of an element to the desired color, then applies the logo as the CSS mask for that element.\n *\n * Pros:\n * * Quick. The effect is generated by the browser using CSS.\n * * No DOM manipulation required.\n * * No colorspace issues.\n *\n * Cons:\n * * Can't be used on the logo when it's being edited (zoomed, rotated, etc.) without going through many hoops.\n * * Requires CSS changes on the frontend.\n *\n * # Canvas Compositing #\n * Creates a new image (and Blob URL) based on the site logo but colorized with the color we want.\n *\n * Pros:\n * * No DOM manipulation required.\n * * No colorspace issue.\n * * Generates a real image we can later store and use on the front end without requiring any CSS/JS. This is helpful\n *   since we want the frontend to still function if Big Sky is later disabled.\n *\n * Cons:\n * * (Comparatively) slow. The effect is generated via JS. Requires some careful garbage collection.\n * * Difficult to integrate with the editor when the logo is being actively modified.\n * * We can make as many different colorized PNGs as we want, but it's hard to trick the site-logo block to load\n *   the correct colorized file for each differently colored section.\n *\n * Taking the various pros and cons of each technique into account, we do the following:\n * 1. Use an SVG Filter when editing the image (cropping, zooming, rotating, etc.) in Gutenberg.\n *    One <svg> element per section style variation is injected into the canvas\n *    iframe and updated via DOM manipulation (rather than React). We need the SVG filter\n *    here to make the interactive logo modification UI (zooming, rotating, etc.) work nicely.\n * 2. Elsewhere in Big Sky and Gutenberg, and on the front end, we use CSS Masking. Passing around\n *    various custom CSS props is simpler than injecting SVG elements everywhere.\n *    The front end CSS masking CSS is added to the Global Style's custom CSS with a highly specific\n *    selector:\n *    .custom-logo[src=\"{the logo's URL}\"]\n *    That way, if the Big Sky plugin is disabled, the custom CSS will stick around. If the logo is\n *    subsequently changed outside of Big Sky, the masking CSS won't apply and so won't mess up the\n *    new logo.\n * We no longer generate real colorized PNGs via Canvas Compositing.\n */\n\n/**\n * WordPress dependencies\n */\nimport { store as coreStore, useEntityRecord } from '@wordpress/core-data';\nimport { useSelect } from '@wordpress/data';\nimport { useEffect, useRef } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport useSiteMetadata from '@hooks/use-site-metadata';\nimport useStyles from '@hooks/use-styles';\nimport useVariations from '@hooks/use-variations';\nimport { store as aiStore } from '@store';\nimport { getMediaById } from '@utils/media.js';\nimport { removeCustomLogoCss, setCustomLogoCss } from '@utils/images.js';\nimport useCanvas from '@hooks/use-canvas.js';\nimport { getCanvasIframeElements } from '@utils/canvas-iframe-elements';\n\nfunction setSvgColors( svg, style, sectionColors ) {\n\tsvg.replaceChildren();\n\n\tconst styleRules = [];\n\tfor ( const sectionColor of sectionColors ) {\n\t\t// `is-stlye-{sectionColor.name}-{unpredictable-uuid}` is getting the color set, but not\n\t\t// `is-stlye-{sectionColor.name}`, so we need to set it here. Minimize impact by just setting it for `feFlood`.\n\t\tstyleRules.push(\n\t\t\t`.is-style-${ sectionColor.name } feFlood { color: ${ sectionColor.text }; }`\n\t\t);\n\t\t// Set the custom CSS property for the section class.\n\t\tstyleRules.push(\n\t\t\t`.is-style-${ sectionColor.name } { --site-logo-filter: url(#svg-logo-color-${ sectionColor.name }); }`\n\t\t);\n\n\t\tconst filter = svg.ownerDocument.createElementNS(\n\t\t\t'http://www.w3.org/2000/svg',\n\t\t\t'filter'\n\t\t);\n\n\t\tfilter.setAttribute( 'id', `svg-logo-color-${ sectionColor.name }` );\n\t\tfilter.setAttribute( 'class', `is-style-${ sectionColor.name }` );\n\t\tfilter.setAttribute( 'color-interpolation-filters', 'sRGB' );\n\t\tconst feFlood = svg.ownerDocument.createElementNS(\n\t\t\t'http://www.w3.org/2000/svg',\n\t\t\t'feFlood'\n\t\t);\n\t\tfeFlood.setAttribute( 'flood-color', 'currentcolor' ); // `currentcolor` uses the current color CSS prop.\n\t\tfeFlood.setAttribute( 'result', 'flood' );\n\n\t\tconst feComposite = svg.ownerDocument.createElementNS(\n\t\t\t'http://www.w3.org/2000/svg',\n\t\t\t'feComposite'\n\t\t);\n\t\tfeComposite.setAttribute( 'operator', 'in' );\n\t\tfeComposite.setAttribute( 'in', 'flood' );\n\t\tfeComposite.setAttribute( 'in2', 'SourceGraphic' );\n\n\t\tfilter.appendChild( feFlood );\n\t\tfilter.appendChild( feComposite );\n\n\t\tsvg.appendChild( filter );\n\t}\n\n\tstyle.textContent = styleRules.join( '\\n' );\n}\n\nexport default function useColorizedLogo() {\n\t// Holds the <svg> element in the canvas iframe.\n\tconst svgRef = useRef();\n\t// Holds the <style> element in the canvas iframe.\n\tconst styleRef = useRef();\n\n\tconst { getMedia } = useSelect( ( select ) => {\n\t\tconst { getMedia: _getMedia } = select( coreStore );\n\t\treturn {\n\t\t\tgetMedia: _getMedia,\n\t\t};\n\t}, [] );\n\n\tconst {\n\t\trecord: siteData,\n\t\teditedRecord: editedSiteData,\n\t\tisResolving: isResolvingSiteData,\n\t} = useEntityRecord( 'root', 'site' );\n\n\tconst { useCustomCss } = useStyles();\n\n\tconst [ customCss, setCustomCss ] = useCustomCss();\n\n\tconst { currentColor } = useSiteMetadata().getSiteMetadata();\n\n\tconst { setStyleProperties } = useCanvas();\n\n\tconst { getColorVariationByTitle } = useVariations();\n\n\tconst { isEditorReady, isEditorIframeLoaded } = useSelect( ( select ) => ( {\n\t\tisEditorReady: select( aiStore ).getIsEditorReady(),\n\t\tisEditorIframeLoaded: select( aiStore ).getIsEditorIframeLoaded(),\n\t} ) );\n\n\tconst { canvasiFrameDocument } = getCanvasIframeElements();\n\n\t// Set up the <svg> element when the iframe is ready.\n\tuseEffect( () => {\n\t\tif (\n\t\t\t! isEditorReady ||\n\t\t\t! isEditorIframeLoaded ||\n\t\t\t! canvasiFrameDocument\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst svgAlready =\n\t\t\tcanvasiFrameDocument.getElementById( 'svg-logo-colors' );\n\t\tif ( svgAlready ) {\n\t\t\tsvgRef.current = svgAlready;\n\t\t} else {\n\t\t\tconst svg = canvasiFrameDocument.createElementNS(\n\t\t\t\t'http://www.w3.org/2000/svg',\n\t\t\t\t'svg'\n\t\t\t);\n\t\t\tsvg.setAttribute( 'id', 'svg-logo-colors' );\n\t\t\tsvg.setAttribute( 'width', '0px' );\n\t\t\tsvg.setAttribute( 'height', '0px' );\n\t\t\tsvg.setAttribute( 'class', 'logo-svg' );\n\n\t\t\tcanvasiFrameDocument.body.appendChild( svg );\n\n\t\t\tsvgRef.current = svg;\n\t\t}\n\n\t\tconst styleAlready =\n\t\t\tcanvasiFrameDocument.getElementById( 'style-logo-colors' );\n\t\tif ( styleAlready ) {\n\t\t\tstyleRef.current = styleAlready;\n\t\t} else {\n\t\t\tconst style = canvasiFrameDocument.createElement( 'style' );\n\t\t\tstyle.setAttribute( 'id', 'style-logo-colors' );\n\t\t\tcanvasiFrameDocument.body.appendChild( style );\n\n\t\t\tstyleRef.current = style;\n\t\t}\n\t}, [ canvasiFrameDocument, isEditorIframeLoaded, isEditorReady ] );\n\n\tuseEffect( () => {\n\t\tif ( ! isEditorReady || ! isEditorIframeLoaded ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( isResolvingSiteData ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst siteLogo = editedSiteData?.site_logo ?? siteData?.site_logo;\n\n\t\tif ( ! siteLogo ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst setSiteLogoColors = async () => {\n\t\t\tlet media = getMedia( siteLogo );\n\t\t\tif ( ! media && siteLogo ) {\n\t\t\t\tmedia = await getMediaById( siteLogo );\n\t\t\t}\n\n\t\t\tconst isBigSkyLogo = !! media?.meta?.big_sky_generated_logo;\n\n\t\t\tconst variation = getColorVariationByTitle( currentColor );\n\n\t\t\t// If it's a Big Sky logo, set up the per-section-color-variation SVG filters.\n\t\t\t// If it's not, remove any SVG filters already present.\n\t\t\t// The SVG filters are only used when the logo is being edited in Gutenberg (zoomed, rotated, etc.).\n\t\t\tconst sectionColors = isBigSkyLogo\n\t\t\t\t? Object.entries(\n\t\t\t\t\t\tgetColorVariationByTitle( currentColor )?.styles\n\t\t\t\t\t\t\t?.blocks?.[ 'core/group' ]?.variations ?? {}\n\t\t\t\t  ).map( ( [ name, sectionVariation ] ) => ( {\n\t\t\t\t\t\tname,\n\t\t\t\t\t\ttext:\n\t\t\t\t\t\t\tsectionVariation?.color?.text ??\n\t\t\t\t\t\t\tvariation?.styles?.color?.text ??\n\t\t\t\t\t\t\t'#000',\n\t\t\t\t  } ) )\n\t\t\t\t: [];\n\t\t\tif (\n\t\t\t\tisBigSkyLogo &&\n\t\t\t\t! sectionColors.includes( 'section-default' )\n\t\t\t) {\n\t\t\t\tsectionColors.unshift( {\n\t\t\t\t\tname: 'section-default',\n\t\t\t\t\ttext: variation?.styles?.color?.text ?? '#000',\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t// Set the SVG filters to the new colors.\n\t\t\tif ( svgRef.current && styleRef.current ) {\n\t\t\t\tsetSvgColors( svgRef.current, styleRef.current, sectionColors );\n\t\t\t}\n\n\t\t\t// Set the CSS Masking properties.\n\t\t\t// These are used by the page/section layout preview iframes.\n\t\t\tsetStyleProperties(\n\t\t\t\tisBigSkyLogo\n\t\t\t\t\t? {\n\t\t\t\t\t\t\t'--site-logo-url': `url(${ media.source_url })`,\n\t\t\t\t\t\t\t'--site-logo-object-position': '-1024px',\n\t\t\t\t\t  }\n\t\t\t\t\t: {\n\t\t\t\t\t\t\t'--site-logo-url': 'none',\n\t\t\t\t\t\t\t'--site-logo-object-position': '50%',\n\t\t\t\t\t  }\n\t\t\t);\n\n\t\t\tif ( isBigSkyLogo ) {\n\t\t\t\tsetCustomLogoCss( customCss, setCustomCss, media.source_url );\n\t\t\t} else {\n\t\t\t\tremoveCustomLogoCss( customCss, setCustomCss );\n\t\t\t}\n\t\t};\n\t\tsetSiteLogoColors();\n\t}, [\n\t\tcurrentColor,\n\t\tgetColorVariationByTitle,\n\t\tgetMedia,\n\t\tisEditorIframeLoaded,\n\t\tisEditorReady,\n\t\tisResolvingSiteData,\n\t\tsetStyleProperties,\n\t\tcustomCss,\n\t\tsetCustomCss,\n\t\teditedSiteData?.site_logo,\n\t\tsiteData?.site_logo,\n\t] );\n}\n","/**\n * WordPress dependencies\n */\nimport apiFetch from '@wordpress/api-fetch';\n\n/**\n * Internal dependencies\n */\nimport log from '@utils/log-debug.js';\n\nexport async function getMediaById( id ) {\n\ttry {\n\t\treturn await apiFetch( {\n\t\t\tpath: `/wp/v2/media/${ id }`,\n\t\t\tmethod: 'GET',\n\t\t} );\n\t} catch ( error ) {\n\t\tlog.error( 'Error fetching media by id: ', error );\n\t}\n}\n","/**\n * Internal dependencies\n */\nimport { assistants } from '@ai/assistants';\n\n// Component that safely calls a single hook\nconst HookRunner = ( { hook } ) => {\n\thook();\n\treturn null;\n};\n\nexport default function ToolkitsProvider() {\n\t// Render a HookRunner for each assistant hook so we can load these\n\t// without having to name them while still complying with the rules of hooks.\n\n\treturn (\n\t\t<>\n\t\t\t{ assistants\n\t\t\t\t.filter( ( assistant ) => assistant.toolkitHook )\n\t\t\t\t.map( ( assistant, index ) => (\n\t\t\t\t\t<HookRunner key={ index } hook={ assistant.toolkitHook } />\n\t\t\t\t) ) }\n\t\t</>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { SVG, Path } from '@wordpress/primitives';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nconst reusableBlock = /*#__PURE__*/_jsx(SVG, {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 24 24\",\n  children: /*#__PURE__*/_jsx(Path, {\n    d: \"M7 7.2h8.2L13.5 9l1.1 1.1 3.6-3.6-3.5-4-1.1 1 1.9 2.3H7c-.9 0-1.7.3-2.3.9-1.4 1.5-1.4 4.2-1.4 5.6v.2h1.5v-.3c0-1.1 0-3.5 1-4.5.3-.3.7-.5 1.2-.5zm13.8 4V11h-1.5v.3c0 1.1 0 3.5-1 4.5-.3.3-.7.5-1.3.5H8.8l1.7-1.7-1.1-1.1L5.9 17l3.5 4 1.1-1-1.9-2.3H17c.9 0 1.7-.3 2.3-.9 1.5-1.4 1.5-4.2 1.5-5.6z\"\n  })\n});\nexport default reusableBlock;\n//# sourceMappingURL=reusable-block.js.map","/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useCallback, useEffect, useState } from '@wordpress/element';\nimport {\n\t__unstableAnimatePresence as AnimatePresence,\n\tButton,\n\t__unstableMotion as motion,\n} from '@wordpress/components';\nimport { reusableBlock } from '@wordpress/icons';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { useChat } from '@automattic/big-sky-agents';\n/**\n * Internal dependencies\n */\nimport ChatActions from '@components/chat/actions';\nimport uuidv4 from '@utils/uuid';\nimport { store as aiStore } from '@store';\nimport setDelay from '@utils/set-delay';\nimport useLog from '@hooks/use-log';\nimport useJetpackToken from '@hooks/use-jetpack-token';\nimport { recordTracksEvent } from '@utils/tracks';\n\nconst ALL_ACTIONS = [\n\t{\n\t\tactionName: __( 'Build a website', 'big-sky' ),\n\t\tdescription: __( 'for my bakery', 'big-sky' ),\n\t},\n\t{\n\t\tactionName: __( 'Design a portfolio', 'big-sky' ),\n\t\tdescription: __( 'for showcasing my work', 'big-sky' ),\n\t},\n\t{\n\t\tactionName: __( 'Make a landing page', 'big-sky' ),\n\t\tdescription: __( 'for my new book', 'big-sky' ),\n\t},\n\t{\n\t\tactionName: __( 'Create a portfolio', 'big-sky' ),\n\t\tdescription: __( 'for my handmade jewelry', 'big-sky' ),\n\t},\n\t{\n\t\tactionName: __( 'Build a blog', 'big-sky' ),\n\t\tdescription: __( 'for my travel adventures', 'big-sky' ),\n\t},\n\t{\n\t\tactionName: __( 'Design a website', 'big-sky' ),\n\t\tdescription: __( 'for my restaurant', 'big-sky' ),\n\t},\n\t{\n\t\tactionName: __( 'Design a landing page', 'big-sky' ),\n\t\tdescription: __( 'for my photography', 'big-sky' ),\n\t},\n\t{\n\t\tactionName: __( 'Make a website', 'big-sky' ),\n\t\tdescription: __( 'for my yoga studio', 'big-sky' ),\n\t},\n\t{\n\t\tactionName: __( 'Build an online presence', 'big-sky' ),\n\t\tdescription: __( 'for my business', 'big-sky' ),\n\t},\n\t{\n\t\tactionName: __( 'Create a site', 'big-sky' ),\n\t\tdescription: __( 'for my podcast', 'big-sky' ),\n\t},\n\t{\n\t\tactionName: __( 'Design a website', 'big-sky' ),\n\t\tdescription: __( 'for my fitness coaching', 'big-sky' ),\n\t},\n\t{\n\t\tactionName: __( 'Build a website', 'big-sky' ),\n\t\tdescription: __( 'for my coffee shop', 'big-sky' ),\n\t},\n];\n\nexport default function OnboardingSiteSuggestions( {\n\tonClickSuggestion,\n\tanimationVariants,\n} ) {\n\tconst { setChatComponents, setCurrentUserMessage } = useDispatch( aiStore );\n\tconst { userSay } = useChat();\n\tconst { logUserChoice } = useLog();\n\tconst { withJetpackTokenRequest } = useJetpackToken();\n\tconst [ isLoading, setIsLoading ] = useState( false );\n\n\tconst { currentUserMessage } = useSelect( ( select ) => {\n\t\tconst ai = select( aiStore );\n\t\treturn {\n\t\t\tcurrentUserMessage: ai.currentUserMessage(),\n\t\t};\n\t} );\n\n\tconst respond = useCallback(\n\t\tasync ( message ) => {\n\t\t\trecordTracksEvent( 'onboarding_suggestion_click' );\n\t\t\tonClickSuggestion();\n\t\t\tsetCurrentUserMessage( message );\n\n\t\t\t// Wait for animations to finish before sending message\n\t\t\tawait setDelay( 1500 );\n\n\t\t\tlogUserChoice( message );\n\t\t\tawait withJetpackTokenRequest( () => userSay( message ) );\n\t\t\tsetChatComponents( [] );\n\t\t\tsetCurrentUserMessage( '' );\n\t\t},\n\t\t[\n\t\t\tlogUserChoice,\n\t\t\tonClickSuggestion,\n\t\t\tsetChatComponents,\n\t\t\tsetCurrentUserMessage,\n\t\t\tuserSay,\n\t\t\twithJetpackTokenRequest,\n\t\t]\n\t);\n\n\tconst getRandomActions = useCallback(\n\t\t( count = 3, previousActions = [] ) => {\n\t\t\tconst previousActionStrings = previousActions.map(\n\t\t\t\t( action ) => `${ action.actionName } ${ action.description }`\n\t\t\t);\n\n\t\t\tconst availableActions = ALL_ACTIONS.filter(\n\t\t\t\t( action ) =>\n\t\t\t\t\t! previousActionStrings.includes(\n\t\t\t\t\t\t`${ action.actionName } ${ action.description }`\n\t\t\t\t\t)\n\t\t\t);\n\n\t\t\tconst shuffled = [ ...availableActions ].sort(\n\t\t\t\t// eslint-disable-next-line no-restricted-syntax\n\t\t\t\t() => 0.5 - Math.random()\n\t\t\t);\n\t\t\treturn shuffled.slice( 0, count ).map( ( action ) => ( {\n\t\t\t\t...action,\n\t\t\t\tkey: uuidv4(),\n\t\t\t\tonClick: () => {\n\t\t\t\t\trespond( `${ action.actionName } ${ action.description }` );\n\t\t\t\t},\n\t\t\t} ) );\n\t\t},\n\t\t[ respond ]\n\t);\n\n\tconst [ actions, setActions ] = useState( getRandomActions() );\n\n\tuseEffect( () => {\n\t\tif ( currentUserMessage?.length > 0 && actions?.length > 0 ) {\n\t\t\tsetActions( [] );\n\t\t}\n\t\tif ( ! currentUserMessage?.length > 0 && ! actions?.length > 0 ) {\n\t\t\tsetActions( getRandomActions() );\n\t\t}\n\t}, [ currentUserMessage, actions, getRandomActions ] );\n\n\tconst refreshActions = async () => {\n\t\trecordTracksEvent( 'onboarding_suggestion_refresh_click' );\n\t\tsetIsLoading( true );\n\n\t\t// Wait for 1 second\n\t\tawait setDelay( 500 );\n\n\t\tsetActions( getRandomActions( 3, actions ) );\n\t\tsetIsLoading( false );\n\t};\n\n\tconst suggestionItemAnimationProps = {\n\t\tinitial: { opacity: 0, y: 10 },\n\t\tanimate: { opacity: 1, y: 0 },\n\t\texit: { opacity: 0, y: 10 },\n\t\ttransition: {\n\t\t\tease: [ 0.42, 0.24, 0.02, 1 ],\n\t\t\tduration: 0.2,\n\t\t\tdelay: 0.05,\n\t\t},\n\t};\n\n\treturn (\n\t\t<motion.div { ...animationVariants }>\n\t\t\t<AnimatePresence\n\t\t\t\tmode=\"wait\"\n\t\t\t\tonExitComplete={ () => setIsLoading( false ) }\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclassName={ classnames( 'big-sky-onboarding__actions', {\n\t\t\t\t\t\t'big-sky-onboarding__actions__is-loading': isLoading,\n\t\t\t\t\t} ) }\n\t\t\t\t>\n\t\t\t\t\t<ChatActions\n\t\t\t\t\t\tactions={ actions }\n\t\t\t\t\t\tkey={ actions[ 0 ]?.key }\n\t\t\t\t\t\tanimationVariants={ suggestionItemAnimationProps }\n\t\t\t\t\t/>\n\t\t\t\t\t{ actions.length > 0 && (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\ticon={ reusableBlock }\n\t\t\t\t\t\t\tonClick={ refreshActions }\n\t\t\t\t\t\t\tclassName=\"big-sky-onboarding__refresh-actions\"\n\t\t\t\t\t\t\tlabel={ __( 'Refresh', 'big-sky' ) }\n\t\t\t\t\t\t\tdisabled={ isLoading }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</div>\n\t\t\t</AnimatePresence>\n\t\t</motion.div>\n\t);\n}\n","/**\n * External dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useRef } from '@wordpress/element';\nimport { __unstableMotion as motion } from '@wordpress/components';\n\n/**\n * Internal dependencies\n */\nimport ChatInput from '@components/chat/input';\nimport OnboardingSiteSuggestions from '@components/onboarding/site-suggestions';\nimport BigSkyIcon from '@components/big-sky-icon';\n\nexport default function OnboardingLandingView( {\n\tonSendMessage,\n\tonClickSuggestion,\n} ) {\n\tconst inputRef = useRef( null );\n\n\tconst defaultEasing = [ 0.42, 0.24, 0.02, 1 ];\n\tconst defaultTransition = {\n\t\tease: defaultEasing,\n\t\tduration: 0.2,\n\t};\n\tconst defaultAnimationProps = {\n\t\tinitial: { opacity: 0, y: 10 },\n\t\tanimate: { opacity: 1, y: 0 },\n\t\texit: {\n\t\t\topacity: 0,\n\t\t\ty: 10,\n\t\t\ttransition: {\n\t\t\t\t...defaultTransition,\n\t\t\t\tdelay: 0.3,\n\t\t\t},\n\t\t},\n\t\ttransition: defaultTransition,\n\t};\n\n\tconst transitionToChat = {\n\t\tease: defaultEasing,\n\t\tduration: 0.6,\n\t\tdelay: defaultAnimationProps.exit.transition.delay + 0.5,\n\t};\n\n\tconst assistantButtonAnimationProps = {\n\t\texit: () => {\n\t\t\tconst assistantButton = document.querySelector(\n\t\t\t\t'.big-sky-onboarding__assistant-button'\n\t\t\t);\n\t\t\tconst buttonRect = assistantButton.getBoundingClientRect();\n\t\t\tconst landingView = document.querySelector(\n\t\t\t\t'.big-sky-onboarding__landing-view'\n\t\t\t);\n\t\t\tconst landingViewStyle = window.getComputedStyle( landingView );\n\t\t\tconst paddingTop = parseInt( landingViewStyle.paddingTop, 10 );\n\t\t\tconst targetY = paddingTop - buttonRect.top;\n\t\t\treturn { y: targetY };\n\t\t},\n\t\ttransition: transitionToChat,\n\t};\n\n\tconst chatInputAnimationProps = {\n\t\texit: () => {\n\t\t\tconst chatInput = document.querySelector(\n\t\t\t\t'.big-sky-onboarding__chat-input'\n\t\t\t);\n\t\t\tconst chatInputRect = chatInput.getBoundingClientRect();\n\t\t\tconst windowHeight = window.innerHeight;\n\t\t\tconst landingView = document.querySelector(\n\t\t\t\t'.big-sky-onboarding__landing-view'\n\t\t\t);\n\t\t\tconst landingViewStyle = window.getComputedStyle( landingView );\n\t\t\tconst paddingBottom = parseInt(\n\t\t\t\tlandingViewStyle.paddingBottom,\n\t\t\t\t10\n\t\t\t);\n\t\t\tconst targetY = windowHeight - chatInputRect.bottom - paddingBottom;\n\t\t\treturn { y: targetY };\n\t\t},\n\t\ttransition: transitionToChat,\n\t};\n\n\treturn (\n\t\t<div className=\"big-sky-onboarding__landing-view\">\n\t\t\t<motion.div\n\t\t\t\tclassName=\"big-sky-onboarding__assistant-button\"\n\t\t\t\t{ ...assistantButtonAnimationProps }\n\t\t\t>\n\t\t\t\t<BigSkyIcon width={ 100 } height={ 100 } color=\"white\" />\n\t\t\t</motion.div>\n\t\t\t<motion.h1\n\t\t\t\tclassName=\"big-sky-onboarding__title\"\n\t\t\t\t{ ...defaultAnimationProps }\n\t\t\t>\n\t\t\t\t{ __( 'Make a website as unique as you.', 'big-sky' ) }\n\t\t\t</motion.h1>\n\t\t\t<motion.div\n\t\t\t\tclassName=\"big-sky-onboarding__chat-input\"\n\t\t\t\t{ ...chatInputAnimationProps }\n\t\t\t>\n\t\t\t\t<ChatInput\n\t\t\t\t\tref={ inputRef }\n\t\t\t\t\tprompt={ __( 'What do you want to build?', 'big-sky' ) }\n\t\t\t\t\tonSendMessage={ onSendMessage }\n\t\t\t\t/>\n\t\t\t</motion.div>\n\n\t\t\t<OnboardingSiteSuggestions\n\t\t\t\tonClickSuggestion={ onClickSuggestion }\n\t\t\t\tanimationVariants={ defaultAnimationProps }\n\t\t\t/>\n\t\t</div>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useEffect, useRef } from '@wordpress/element';\nimport {\n\t__unstableAnimatePresence as AnimatePresence,\n\t__unstableMotion as motion,\n} from '@wordpress/components';\n\n/**\n * Internal dependencies\n */\nimport ChatInput from '@components/chat/input';\nimport BigSkyIcon from '@components/big-sky-icon';\nimport ChatThread from '@components/chat/thread';\nimport ChatSuggestions from '@ai/assistants/shared/make-suggestions';\nimport ChatComponents from '@components/chat/components';\n\nexport default function OnboardingChatView( { onSendMessage } ) {\n\tconst inputRef = useRef( null );\n\tconst chatInputRef = useRef( null );\n\n\tuseEffect( () => {\n\t\t// eslint-disable-next-line no-undef\n\t\tconst resizeObserver = new ResizeObserver( ( entries ) => {\n\t\t\tfor ( const entry of entries ) {\n\t\t\t\tif ( entry.target === chatInputRef.current ) {\n\t\t\t\t\tdocument.documentElement.style.setProperty(\n\t\t\t\t\t\t'--chat-input-height',\n\t\t\t\t\t\t`${ entry.contentRect.height }px`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\n\t\tif ( chatInputRef.current ) {\n\t\t\tresizeObserver.observe( chatInputRef.current );\n\t\t}\n\n\t\treturn () => {\n\t\t\tresizeObserver.disconnect();\n\t\t};\n\t}, [] );\n\n\treturn (\n\t\t<div className=\"big-sky-onboarding__chat-view\">\n\t\t\t<motion.div className=\"big-sky-onboarding__assistant-button\">\n\t\t\t\t<BigSkyIcon width={ 100 } height={ 100 } color=\"white\" />\n\t\t\t</motion.div>\n\n\t\t\t<motion.div className=\"big-sky-onboarding__chat-thread\">\n\t\t\t\t<ChatThread />\n\t\t\t</motion.div>\n\n\t\t\t<motion.div\n\t\t\t\tclassName=\"big-sky-onboarding__chat-input\"\n\t\t\t\tref={ chatInputRef }\n\t\t\t>\n\t\t\t\t<motion.div className=\"big-sky-onboarding__actions\">\n\t\t\t\t\t<AnimatePresence mode=\"wait\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<ChatComponents key=\"chat-components-actions\" />\n\t\t\t\t\t\t\t<ChatSuggestions key=\"chat-suggestions-actions\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</AnimatePresence>\n\t\t\t\t</motion.div>\n\n\t\t\t\t<ChatInput\n\t\t\t\t\tref={ inputRef }\n\t\t\t\t\tprompt={ __( 'Send a message', 'big-sky' ) }\n\t\t\t\t\tonSendMessage={ onSendMessage }\n\t\t\t\t/>\n\t\t\t</motion.div>\n\t\t</div>\n\t);\n}\n","/**\n * External dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { useEffect, useRef, useState } from '@wordpress/element';\nimport {\n\t__unstableAnimatePresence as AnimatePresence,\n\t__unstableMotion as motion,\n\tPopover,\n} from '@wordpress/components';\nimport {\n\tChatModelService,\n\tChatModelType,\n\tuseAgentExecutor,\n\tuseChat,\n\tuseChatSettings,\n} from '@automattic/big-sky-agents';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\nimport OnboardingLandingView from '@components/onboarding/landing-view';\nimport OnboardingChatView from '@components/onboarding/chat-view';\nimport { store as aiStore } from '@store';\nimport { recordTracksEvent } from '@utils/tracks';\nimport setDelay from '@utils/set-delay';\nimport { useRouting } from '@hooks/use-routing';\nimport useSiteMetadata from '@hooks/use-site-metadata';\n\nexport default function Onboarding() {\n\tconst { topic } = useSiteMetadata().getSiteMetadata();\n\tconst { apiKey, sessionId } = useSelect( ( select ) => ( {\n\t\tapiKey: select( aiStore ).getApiKey(),\n\t\tsessionId: select( aiStore ).getSessionId(),\n\t} ) );\n\tconst [ showChat, setShowChat ] = useState( !! topic );\n\tconst previousTopicRef = useRef( topic );\n\tconst isLocalGraph = window.bigSkyInitialState?.isLocalGraph;\n\tconst { setStoreConversation } = useChat();\n\n\tconst { setAiStep } = useRouting();\n\n\tuseEffect( () => {\n\t\tif ( previousTopicRef.current !== null && topic === null ) {\n\t\t\tsetShowChat( false );\n\t\t}\n\t\tpreviousTopicRef.current = topic;\n\t}, [ topic ] );\n\n\tsetAiStep( 'onboarding' );\n\n\tuseChatSettings( {\n\t\tapiKey,\n\t\tfeature: 'big-sky',\n\t\tservice: isLocalGraph\n\t\t\t? ChatModelService.LOCAL_GRAPH\n\t\t\t: ChatModelService.WPCOM_JETPACK_AI,\n\t\tmodel: ChatModelType.GPT_4O,\n\t\tsessionId,\n\t\tstream: false,\n\t} );\n\n\tuseAgentExecutor();\n\n\t// Add body overflow class on mount and remove on unmount\n\tuseEffect( () => {\n\t\tdocument.body.classList.add( 'big-sky-onboarding-open' );\n\t\treturn () => {\n\t\t\tdocument.body.classList.remove( 'big-sky-onboarding-open' );\n\t\t};\n\t}, [] );\n\n\tconst hasRecordedEvent = useRef( false );\n\tuseEffect( () => {\n\t\tif ( ! hasRecordedEvent.current ) {\n\t\t\trecordTracksEvent( 'onboarding_started' );\n\t\t\thasRecordedEvent.current = true;\n\t\t}\n\t}, [] );\n\n\tuseEffect( () => {\n\t\tif ( setStoreConversation ) {\n\t\t\t// We decided during the Big Sky call 2024-11-01 that we want to store all convos by default dyring the launch.\n\t\t\tsetStoreConversation( true );\n\t\t}\n\t}, [ setStoreConversation ] );\n\n\tconst handleShowChatView = async () => {\n\t\tsetShowChat( true );\n\n\t\t// wait for animations before sending the message.\n\t\tawait setDelay( 1500 );\n\t};\n\n\tconst contentAnimationProps = {\n\t\tinitial: { opacity: 0 },\n\t\tanimate: { opacity: 1 },\n\t\texit: { opacity: 0 },\n\t\ttransition: {\n\t\t\tease: 'easeInOut',\n\t\t\tduration: 0.3,\n\t\t\tdelay: 0.3,\n\t\t},\n\t};\n\n\treturn (\n\t\t<Popover className=\"big-sky-onboarding\">\n\t\t\t<motion.div\n\t\t\t\tclassName=\"big-sky-onboarding__content\"\n\t\t\t\tkey=\"onboarding-content\"\n\t\t\t\t{ ...contentAnimationProps }\n\t\t\t>\n\t\t\t\t<AnimatePresence mode=\"wait\">\n\t\t\t\t\t{ ! showChat ? (\n\t\t\t\t\t\t<OnboardingLandingView\n\t\t\t\t\t\t\tkey=\"onboarding-landing-view\"\n\t\t\t\t\t\t\tonSendMessage={ handleShowChatView }\n\t\t\t\t\t\t\tonClickSuggestion={ handleShowChatView }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<OnboardingChatView key=\"onboarding-chat-view\" />\n\t\t\t\t\t) }\n\t\t\t\t</AnimatePresence>\n\t\t\t</motion.div>\n\t\t</Popover>\n\t);\n}\n","/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as editorStore } from '@wordpress/editor';\nimport { useEffect, useRef, useState } from '@wordpress/element';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { AgentsProvider, useChat } from '@automattic/big-sky-agents';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport routerAssistant from '@ai/assistants/router';\nimport specAssistant from '@ai/assistants/spec';\nimport { assistants } from '@ai/assistants';\nimport AIBuildMode from '@components/ai-build-mode';\nimport AssemblerDebug from '@components/assembler-debug';\nimport Dock from '@components/dock';\nimport useAfterSave from '@hooks/use-after-save';\nimport useLog from '@hooks/use-log';\nimport { messageRoles } from '@utils/constants';\nimport { store as aiStore } from '@store';\nimport EditorSetup from '@components/editor-setup';\nimport useCanvas from '@hooks/use-canvas';\nimport ToolkitsProvider from '@ai/assistants/toolkits-provider';\nimport Onboarding from '@components/onboarding';\nimport { getCanvasIframeElements } from '@utils/canvas-iframe-elements';\nimport { useRouting } from '@hooks/use-routing';\nimport { dockViews } from '@utils/constants.js';\nimport ConfirmationDialog from '@components/onboarding/confirmation-dialog';\nimport useResetSite from '@hooks/use-reset-site.js';\nimport useSiteMetadata from '@hooks/use-site-metadata';\n\n/**\n * This component wraps the Assembler component so that:\n * 1. It only renders on page post types\n * 2. It only renders after the canvas has loaded\n * 3. It logs the save action\n */\nfunction BigSky() {\n\tconst {\n\t\tisBuildingSite,\n\t\tisEditorIframeLoaded,\n\t\tisDevMode,\n\t\tsiteMetadata,\n\t\tcurrentHandoffArea,\n\t} = useSelect( ( select ) => ( {\n\t\tisBuildingSite: select( aiStore ).getIsBuildingSite(),\n\t\tisEditorIframeLoaded: select( aiStore ).getIsEditorIframeLoaded(),\n\t\tisDevMode: select( aiStore ).getIsDevMode(),\n\t\tsiteMetadata: select( aiStore ).getSiteMetadata(),\n\t\tcurrentHandoffArea: select( aiStore ).getCurrentHandoffArea(),\n\t} ) );\n\tconst isAfterSave = useAfterSave();\n\tconst { logAction, logToolCall, logAssistantMessage, logError } = useLog();\n\n\tconst { canvasMode } = useCanvas();\n\n\tconst { setLastSelectedBlock, setDockView } = useDispatch( aiStore );\n\tconst { lastSelectedBlock } = useSelect( ( select ) => {\n\t\tconst ai = select( aiStore );\n\n\t\treturn {\n\t\t\tlastSelectedBlock: ai.getLastSelectedBlock(),\n\t\t};\n\t} );\n\tconst { selectedBlock } = useSelect( ( select ) => {\n\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\t\treturn {\n\t\t\tselectedBlock: getSelectedBlock(),\n\t\t};\n\t} );\n\n\tconst { postType } = useSelect( ( select ) => {\n\t\treturn {\n\t\t\tpostType: select( editorStore ).getCurrentPostType(),\n\t\t};\n\t} );\n\n\tconst [ isPagePostType, setIsPagePostType ] = useState( false );\n\tconst [ hasCanvasLoaded, setHasCanvasLoaded ] = useState( false );\n\tconst previousSelectedBlockRef = useRef( null );\n\tconst { messages, error } = useChat();\n\tconst lastLoggedMessageRef = useRef( null );\n\tconst lastLoggedErrorRef = useRef( null );\n\n\tconst { buildNewSite } = useResetSite();\n\tconst { setSiteMetadata } = useSiteMetadata();\n\tconst isOnboarded = siteMetadata?.isOnboarded;\n\n\tconst { setAiStep, showOnboardingDialog, setShowOnboardingDialog } =\n\t\tuseRouting( {\n\t\t\trunUrlChangeHandling: true,\n\t\t} );\n\n\tconst { canvasiFrameBody } = getCanvasIframeElements();\n\n\t// Log the last assistant message or tool call.\n\tuseEffect( () => {\n\t\t// Get the last message.\n\t\tconst lastMessage = messages?.[ messages.length - 1 ];\n\n\t\t// Check if this message has already been logged\n\t\tif ( lastMessage && lastMessage !== lastLoggedMessageRef.current ) {\n\t\t\tconst role = lastMessage?.role;\n\t\t\tconst content =\n\t\t\t\tlastMessage?.content?.[ 0 ]?.text || lastMessage?.content || '';\n\t\t\tconst lastToolCall = lastMessage?.tool_calls?.[ 0 ];\n\n\t\t\tif ( role === messageRoles.ASSISTANT ) {\n\t\t\t\tconst toolCall = lastToolCall?.function;\n\t\t\t\tif ( toolCall ) {\n\t\t\t\t\tlogToolCall( toolCall, lastMessage.id );\n\t\t\t\t}\n\t\t\t\tif ( content ) {\n\t\t\t\t\tlogAssistantMessage( content, lastMessage.id );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Update the ref with the last logged message\n\t\t\tlastLoggedMessageRef.current = lastMessage;\n\t\t}\n\t}, [ messages, logToolCall, logAssistantMessage ] );\n\n\t// Log errors that occur in the chat history\n\tuseEffect( () => {\n\t\tif ( error ) {\n\t\t\tif ( error !== lastLoggedErrorRef.current ) {\n\t\t\t\tlogError( error );\n\t\t\t\tlastLoggedErrorRef.current = error;\n\t\t\t}\n\t\t} else {\n\t\t\tlastLoggedErrorRef.current = null;\n\t\t}\n\t}, [ error, logError ] );\n\n\tuseEffect( () => {\n\t\tif ( isAfterSave ) {\n\t\t\tlogAction( 'Save Page', messageRoles.SAVE_PAGE );\n\t\t}\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ isAfterSave ] );\n\n\tuseEffect( () => {\n\t\tif (\n\t\t\tselectedBlock &&\n\t\t\tselectedBlock.clientId !==\n\t\t\t\tpreviousSelectedBlockRef.current?.clientId\n\t\t) {\n\t\t\tsetLastSelectedBlock( previousSelectedBlockRef.current );\n\t\t\tpreviousSelectedBlockRef.current = selectedBlock;\n\t\t}\n\t}, [ selectedBlock, setLastSelectedBlock, lastSelectedBlock ] );\n\n\tuseEffect( () => {\n\t\tconst allowablePostTypes = [ 'page' ];\n\t\tif ( postType && allowablePostTypes.includes( postType ) ) {\n\t\t\tsetIsPagePostType( true );\n\t\t} else {\n\t\t\tsetIsPagePostType( false );\n\t\t}\n\t}, [ postType ] );\n\n\tuseEffect( () => {\n\t\tif ( ! canvasiFrameBody ) {\n\t\t\tsetHasCanvasLoaded( false );\n\t\t\treturn;\n\t\t}\n\t\tif ( isEditorIframeLoaded && ! hasCanvasLoaded ) {\n\t\t\tsetHasCanvasLoaded( true );\n\t\t}\n\t}, [\n\t\tisEditorIframeLoaded,\n\t\thasCanvasLoaded,\n\t\tsetHasCanvasLoaded,\n\t\tcanvasiFrameBody,\n\t] );\n\n\tconst agents = isOnboarded ? [ ...assistants ] : [ specAssistant ];\n\n\tconst colorAssistant = assistants.find(\n\t\t( assistant ) => assistant.id === 'big-sky-color'\n\t);\n\tconst fontAssistant = assistants.find(\n\t\t( assistant ) => assistant.id === 'big-sky-font'\n\t);\n\tconst getActiveAssistantId = () => {\n\t\tif ( currentHandoffArea === 'colors' ) {\n\t\t\treturn colorAssistant.id;\n\t\t}\n\t\tif ( currentHandoffArea === 'fonts' ) {\n\t\t\treturn fontAssistant.id;\n\t\t}\n\n\t\treturn routerAssistant.id;\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t{ canvasMode === 'edit' && isPagePostType && (\n\t\t\t\t<>\n\t\t\t\t\t<AgentsProvider\n\t\t\t\t\t\tactiveAgentId={\n\t\t\t\t\t\t\tisOnboarded\n\t\t\t\t\t\t\t\t? getActiveAssistantId()\n\t\t\t\t\t\t\t\t: specAssistant.id\n\t\t\t\t\t\t}\n\t\t\t\t\t\tagents={ agents }\n\t\t\t\t\t\tstarted={ true }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ hasCanvasLoaded && isOnboarded && <Dock /> }\n\t\t\t\t\t\t{ ! isOnboarded && <Onboarding /> }\n\t\t\t\t\t\t<ToolkitsProvider />\n\t\t\t\t\t</AgentsProvider>\n\n\t\t\t\t\t{ isBuildingSite && <AIBuildMode /> }\n\t\t\t\t\t{ isDevMode ? <AssemblerDebug /> : null }\n\t\t\t\t</>\n\t\t\t) }\n\t\t\t<ConfirmationDialog\n\t\t\t\tisOpen={ showOnboardingDialog }\n\t\t\t\tonClose={ () => setShowOnboardingDialog( false ) }\n\t\t\t\tonCancel={ () => {\n\t\t\t\t\tsetShowOnboardingDialog( false );\n\t\t\t\t\tsetAiStep( 'handoff', true );\n\t\t\t\t\tsetDockView( dockViews.MENUS );\n\t\t\t\t} }\n\t\t\t\tonConfirm={ () => {\n\t\t\t\t\tsetShowOnboardingDialog( false );\n\t\t\t\t\tsetSiteMetadata( { isOnboarded: false }, false, true );\n\t\t\t\t\tbuildNewSite();\n\t\t\t\t} }\n\t\t\t\tmessage={ __(\n\t\t\t\t\t'If you go back, your current progress may be lost. From there, you can start fresh and create a new site.',\n\t\t\t\t\t'big-sky'\n\t\t\t\t) }\n\t\t\t\tcancelText={ __( 'Continue editing', 'big-sky' ) }\n\t\t\t\tconfirmText={ __( 'Build a new site', 'big-sky' ) }\n\t\t\t\ttitle={ __( 'Start Over?', 'big-sky' ) }\n\t\t\t/>\n\t\t\t<EditorSetup />\n\t\t</>\n\t);\n}\n\nexport default BigSky;\n","import { Component } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport log from '@utils/log-debug.js';\n\nclass ErrorBoundary extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\t\tthis.state = { hasError: false, error: null };\n\t}\n\n\tstatic getDerivedStateFromError( error ) {\n\t\treturn { hasError: true, error };\n\t}\n\n\tcomponentDidCatch( error, errorInfo ) {\n\t\tlog.error( 'Plugin Error:', error, errorInfo );\n\t\tthis.props.onReset?.();\n\t}\n\n\trender() {\n\t\treturn this.props.children;\n\t}\n}\n\nexport default ErrorBoundary;\n","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"commands\"];","/**\n * WordPress dependencies\n */\nimport { useEffect } from '@wordpress/element';\nimport { store as commandsStore } from '@wordpress/commands';\nimport { useDispatch, useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { store as aiStore } from '@store';\nimport log from '@utils/log-debug.js';\n\n/**\n * This file is FUNKY!\n * So we are basically doing a lot React magic to retrieve command pallette commands from the command pallette API.\n * The complexity stems from the fact that command pallette loaders contain custom React hooks that we have to run.\n * We have iterate over arbitrary hooks and then render them without breaking the rules of hooks.\n */\n\n// This is copied from original command pallette work https://github.com/WordPress/gutenberg/blob/8f8c4d7b44427c49d0e231b3a895da2a3c448ec9/packages/commands/src/components/command-menu.js#L79\nfunction CommandMenuLoaderWrapper( { name, hook, search } ) {\n\tconst { commands } = useSelect( ( select ) => ( {\n\t\tcommands: select( aiStore ).getCommands(),\n\t} ) );\n\n\tconst { addCommand } = useDispatch( aiStore );\n\tconst hookResult = hook( { search } ) ?? {};\n\tuseEffect( () => {\n\t\tif (\n\t\t\t! commands[ name ] ||\n\t\t\tcommands[ name ].length !== hookResult.commands.length\n\t\t) {\n\t\t\taddCommand( { [ name ]: hookResult.commands } );\n\t\t}\n\t}, [ addCommand, commands, hook, hookResult.commands, name ] );\n\n\tif ( ! name || ! hook ) {\n\t\tlog.warn( 'invalid loader', { name, hook } );\n\t\treturn null;\n\t}\n\treturn null;\n}\n\nexport default function RetrieveCommands() {\n\tconst { commandLoadersNonContextual, commandLoadersContextual } = useSelect(\n\t\t( select ) => {\n\t\t\treturn {\n\t\t\t\tcommandLoadersNonContextual:\n\t\t\t\t\tselect( commandsStore ).getCommandLoaders( false ),\n\t\t\t\tcommandLoadersContextual:\n\t\t\t\t\tselect( commandsStore ).getCommandLoaders( true ),\n\t\t\t};\n\t\t}\n\t);\n\n\t// Filter the non-ai specific commnad palette actions. These are not designed to work with AI, so we limit this to\n\t// only generic command pallette actions that make sense in the AI context.\n\tconst nonAIActions = [\n\t\t'core/block-editor/blockQuickActions',\n\t\t'core/block-editor/blockTransforms',\n\t];\n\n\treturn (\n\t\t<>\n\t\t\t{ commandLoadersContextual\n\t\t\t\t.concat( commandLoadersNonContextual )\n\t\t\t\t.filter(\n\t\t\t\t\t( loader ) =>\n\t\t\t\t\t\tloader?.name &&\n\t\t\t\t\t\t( nonAIActions.includes( loader.name ) ||\n\t\t\t\t\t\t\tloader.name.startsWith( 'ai/' ) )\n\t\t\t\t)\n\t\t\t\t.map( ( loader ) => {\n\t\t\t\t\t// We need to retrieve both contextual and NON-contextual loaders because they are always meant to show all.\n\t\t\t\t\tif ( ! loader || ! loader.name ) {\n\t\t\t\t\t\tlog.warn( 'invalid loader', loader );\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<CommandMenuLoaderWrapper\n\t\t\t\t\t\t\tkey={ loader.name }\n\t\t\t\t\t\t\tname={ loader.name }\n\t\t\t\t\t\t\thook={ loader.hook }\n\t\t\t\t\t\t\tsearch=\"\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t);\n\t\t\t\t} ) }\n\t\t</>\n\t);\n}\n","import { useCallback, useEffect, useState } from '@wordpress/element';\nimport { subscribe, useDispatch, useSelect } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\nimport useStyles from '@hooks/use-styles';\nimport { store as aiStore } from '@store';\nimport { getContrastingThemeColor } from '@utils/colors';\nimport { getMediaColor } from '@utils/images';\n\nfunction EditorSubscriptions() {\n\tconst [ isUpdatingCoverImage, setIsUpdatingCoverImage ] = useState( false );\n\tconst [ coverBlockUrls, setCoverBlockUrls ] = useState( [] );\n\tconst {\n\t\tgetBlock,\n\t\tgetBlocksByName,\n\t\tgetBlockAttributes,\n\t\tisEditorIframeLoaded,\n\t\tisHandoff,\n\t\tselectedBlock,\n\t} = useSelect( ( select ) => {\n\t\tconst { getSelectedBlock } = select( blockEditorStore );\n\t\treturn {\n\t\t\tgetBlock: select( blockEditorStore ).getBlock,\n\t\t\tgetBlocksByName: select( blockEditorStore ).getBlocksByName,\n\t\t\tgetBlockAttributes: select( blockEditorStore ).getBlockAttributes,\n\t\t\tselectedBlock: getSelectedBlock(),\n\t\t\tisEditorIframeLoaded: select( aiStore ).getIsEditorIframeLoaded(),\n\t\t\tisHandoff: select( aiStore ).getIsHandoff(),\n\t\t\tgetImageStyle: select( aiStore ).getImageStyle,\n\t\t};\n\t} );\n\tconst { updateBlockAttributes } = useDispatch( blockEditorStore );\n\tconst { themeColors } = useStyles();\n\n\tuseEffect( () => {\n\t\tif ( ! isEditorIframeLoaded ) return;\n\n\t\t// get the cover block urls\n\t\tconst coverBlockIds = getBlocksByName( 'core/cover' );\n\t\tsetCoverBlockUrls(\n\t\t\tcoverBlockIds.map( ( id ) => {\n\t\t\t\tconst block = getBlock( id );\n\t\t\t\treturn { clientId: block.clientId, url: block.attributes.url };\n\t\t\t} )\n\t\t);\n\t}, [ getBlock, getBlocksByName, isEditorIframeLoaded, isHandoff ] );\n\n\tconst coverBlockUrlChanged = useCallback(\n\t\t( coverBlock ) => {\n\t\t\tconst coverBlockId = coverBlock.clientId;\n\t\t\t// check if blockId exists in coverBlockUrls\n\t\t\tconst coverBlockUrl = coverBlockUrls.find(\n\t\t\t\t( block ) => block.clientId === coverBlockId\n\t\t\t)?.url;\n\t\t\treturn coverBlock.attributes.url !== coverBlockUrl;\n\t\t},\n\t\t[ coverBlockUrls ]\n\t);\n\n\t// if the selected block is a cover block and the url has changed, reset the custom overlay color\n\tconst handleCoverBlockChange = useCallback( async () => {\n\t\tsetIsUpdatingCoverImage( true );\n\t\tconst mediaColor = await getMediaColor( selectedBlock.attributes.url );\n\t\tsetCoverBlockUrls( ( prevUrls ) => {\n\t\t\tconst existingBlockIndex = prevUrls.findIndex(\n\t\t\t\t( block ) => block.clientId === selectedBlock.clientId\n\t\t\t);\n\t\t\tif ( existingBlockIndex !== -1 ) {\n\t\t\t\treturn prevUrls.map( ( block, index ) =>\n\t\t\t\t\tindex === existingBlockIndex\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t...block,\n\t\t\t\t\t\t\t\turl: selectedBlock.attributes.url,\n\t\t\t\t\t\t  }\n\t\t\t\t\t\t: block\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn [\n\t\t\t\t...prevUrls,\n\t\t\t\t{\n\t\t\t\t\tclientId: selectedBlock.clientId,\n\t\t\t\t\turl: selectedBlock.attributes.url,\n\t\t\t\t},\n\t\t\t];\n\t\t} );\n\n\t\tconst textColor = getContrastingThemeColor( mediaColor, themeColors );\n\n\t\tconst attributes = getBlockAttributes( selectedBlock.clientId );\n\t\tawait updateBlockAttributes( selectedBlock.clientId, {\n\t\t\toverlayColor: undefined,\n\t\t\tcustomOverlayColor: mediaColor,\n\t\t\tisUserOverlayColor: false,\n\t\t\tstyle: {\n\t\t\t\t...attributes?.style,\n\t\t\t\tcolor: {\n\t\t\t\t\ttext: textColor?.color,\n\t\t\t\t},\n\t\t\t},\n\t\t} );\n\t\tsetIsUpdatingCoverImage( false );\n\t}, [\n\t\tselectedBlock,\n\t\tupdateBlockAttributes,\n\t\tgetBlockAttributes,\n\t\tthemeColors,\n\t] );\n\n\tuseEffect( () => {\n\t\tif ( ! selectedBlock ) return;\n\n\t\tlet unsubscribe = () => {};\n\t\tif (\n\t\t\tselectedBlock.name === 'core/cover' &&\n\t\t\tselectedBlock.attributes.url &&\n\t\t\tcoverBlockUrlChanged( selectedBlock ) &&\n\t\t\t! isUpdatingCoverImage\n\t\t) {\n\t\t\tunsubscribe = subscribe( handleCoverBlockChange );\n\t\t}\n\n\t\treturn () => {\n\t\t\tunsubscribe();\n\t\t};\n\t}, [\n\t\tselectedBlock,\n\t\thandleCoverBlockChange,\n\t\tcoverBlockUrlChanged,\n\t\tisUpdatingCoverImage,\n\t] );\n\n\treturn <></>;\n}\n\nexport default EditorSubscriptions;\n","/**\n * WordPress dependencies\n */\nimport { registerPlugin } from '@wordpress/plugins';\nimport { more } from '@wordpress/icons';\nimport { unlock } from '@utils/lock-unlock';\nimport { privateApis as blockEditorPrivateApis } from '@wordpress/editor';\n\nconst { GlobalStylesProvider } = unlock( blockEditorPrivateApis );\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\nimport BigSky from './components/index.js';\nimport ErrorBoundary from './components/error-boundary.js';\nimport RetrieveCommands from '@ai/commands/retrieve-commands.js';\nimport EditorSubscriptions from '@components/editor-subscriptions';\nimport useHandleReset from './hooks/use-handle-reset.js';\n\nexport const AssemblerPlugin = () => {\n\tconst handleReset = useHandleReset();\n\n\treturn (\n\t\t<ErrorBoundary onReset={ handleReset }>\n\t\t\t<GlobalStylesProvider>\n\t\t\t\t<BigSky />\n\t\t\t\t<RetrieveCommands />\n\t\t\t\t<EditorSubscriptions />\n\t\t\t</GlobalStylesProvider>\n\t\t</ErrorBoundary>\n\t);\n};\n\nregisterPlugin( 'big-sky-assembler', {\n\ticon: more,\n\trender: AssemblerPlugin,\n} );\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t57: 0,\n\t350: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = globalThis[\"webpackChunkbig_sky\"] = globalThis[\"webpackChunkbig_sky\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [350], () => (__webpack_require__(852)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","factory","__webpack_modules__","__unused_webpack___webpack_module__","r","d","_scriptDir","Rive","document","currentScript","src","undefined","moduleArg","aa","ea","m","fa","a","g","n","c","b","Map","forEach","p","l","console","error","this","ob","e","Tb","f","requestAnimationFrame","bind","set","cancelAnimationFrame","delete","size","Rb","body","remove","createElement","style","backgroundColor","position","right","top","color","padding","innerHTML","toFixed","appendChild","performance","now","Ob","ha","assert","push","has","clearTimeout","get","setTimeout","length","Math","max","keys","ready","Promise","ia","onRuntimeInitialized","decodeAudio","decodeFont","FileAssetLoader","ptrToAsset","ptrToFileAsset","isImage","ptrToImageAsset","isFont","ptrToFontAsset","isAudio","ptrToAudioAsset","CustomFileAssetLoader","extend","__construct","loadContents","__parent","call","Gb","CDNFileAssetLoader","cdnUuid","cdnBaseUrl","XMLHttpRequest","responseType","onreadystatechange","readyState","status","decode","Uint8Array","response","open","send","FallbackFileAssetLoader","kb","addLoader","ja","split","ka","k","t","alpha","depth","stencil","antialias","premultipliedAlpha","preserveDrawingBuffer","preferLowPowerToHighPerformance","failIfMajorPerformanceCaveat","enableExtensionsByDefault","explicitSwapControl","renderViaOffscreenBackBuffer","test","navigator","userAgent","getContext","log","A","D","w","M","createShader","shaderSource","compileShader","getShaderInfoLog","attachShader","Proxy","isContextLost","apply","min","getParameter","MAX_RENDERBUFFER_SIZE","MAX_TEXTURE_SIZE","createProgram","VERTEX_SHADER","FRAGMENT_SHADER","bindAttribLocation","linkProgram","getProgramInfoLog","trim","getUniformLocation","useProgram","bindBuffer","ARRAY_BUFFER","createBuffer","enableVertexAttribArray","ELEMENT_ARRAY_BUFFER","uniform1i","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","hc","Mb","deleteTexture","Lb","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","LINEAR_MIPMAP_LINEAR","generateMipmap","u","v","x","Qb","canvas","T","width","height","viewport","disable","SCISSOR_TEST","clearColor","clear","COLOR_BUFFER_BIT","enable","sort","F","ba","wb","bufferData","DYNAMIC_DRAW","bufferSubData","Ta","ca","Db","ra","indices","image","Ka","Ja","mc","scissor","Ya","Za","jb","Ac","uniform4f","Ba","Ca","uniform2f","ic","jc","vertexAttribPointer","FLOAT","drawElements","TRIANGLES","UNSIGNED_SHORT","la","q","srcOver","screen","overlay","darken","lighten","colorDodge","colorBurn","hardLight","softLight","difference","exclusion","multiply","hue","saturation","luminosity","drawWidth","drawHeight","reset","z","H","RenderPaintStyle","RenderPath","RenderPaint","Renderer","StrokeCap","StrokeJoin","BlendMode","fill","stroke","FillRule","evenOdd","RenderImage","xa","__destruct","URL","revokeObjectURL","Wa","G","Image","createObjectURL","Blob","type","onload","Fb","Path2D","rewind","addPath","C","I","J","K","X","Q","DOMMatrix","fillRule","Va","moveTo","lineTo","cubicTo","bezierCurveTo","close","closePath","Xa","thickness","Ib","join","miter","Ia","round","bevel","cap","butt","Ha","square","Hb","blendMode","Eb","clearGradient","linearGradient","yb","zb","bb","cb","Ra","radialGradient","ec","addStop","stop","completeGradient","draw","globalCompositeOperation","createRadialGradient","sqrt","createLinearGradient","da","R","addColorStop","strokeStyle","lineWidth","lineCap","lineJoin","fillStyle","Set","CanvasRenderer","S","Ua","save","slice","restore","splice","transform","rotate","sin","cos","_drawPath","_drawRiveImage","globalAlpha","drawImage","_getMatrix","_drawImageMesh","Yb","Zb","Ga","sa","ceil","ta","DynamicRectanizer","addRect","add","$b","ac","Float32Array","Uint16Array","za","qd","resetTransform","bc","_clipPath","clip","clearRect","flush","translate","makeRenderer","indexOf","Error","decodeImage","renderFactory","makeRenderPaint","makeRenderPath","makeRenderImage","total","loaded","load","enableFPSCounter","disableFPSCounter","resolveAnimationFrame","cleanup","ua","va","ma","Object","assign","na","oa","window","pa","importScripts","qa","self","location","href","substr","replace","lastIndexOf","onerror","ya","wa","print","printErr","thisProgram","wasmBinary","noExitRuntime","WebAssembly","Aa","y","B","E","Da","Ea","L","N","Fa","buffer","HEAP8","Int8Array","HEAP16","Int16Array","HEAP32","Int32Array","HEAPU8","HEAPU16","HEAPU32","Uint32Array","HEAPF32","HEAPF64","Float64Array","La","Ma","Na","Oa","preRun","shift","unshift","Pa","Qa","onAbort","RuntimeError","Sa","startsWith","locateFile","fetch","credentials","then","ok","arrayBuffer","catch","resolve","instantiate","$a","db","AudioContext","webkitAudioContext","h","capture","ga","stopped","xb","yc","Cb","pop","Sc","Bb","unlock","state","resume","ab","pb","map","removeEventListener","addEventListener","mediaDevices","getUserMedia","sampleRate","suspend","Z","createScriptProcessor","onaudioprocess","inputBuffer","getChannelData","outputBuffer","numberOfChannels","audio","video","createMediaStreamSource","connect","destination","disconnect","eb","fb","gb","charAt","filter","hb","exec","ib","crypto","getRandomValues","lb","arguments","TypeError","mb","TextDecoder","nb","subarray","String","fromCharCode","charCodeAt","qb","rb","Array","sb","tb","input","V","ub","vb","node","O","s","seekable","read","timestamp","Date","write","prompt","readline","Fc","Hc","Ec","Gc","Dc","cc","dc","j","Ub","P","U","createNode","dir","Y","Ab","stream","file","link","mode","Kc","Jc","id","Mc","Oc","uid","Lc","Bc","Nc","Ic","Jb","Cc","parent","name","hasOwnProperty","prototype","byteOffset","o","path","root","Kb","Nb","lc","Pb","includes","Vb","defineProperties","object","flags","Sb","Wb","Qc","kc","Xb","zc","logReadFiles","fc","gc","pc","message","constructor","stack","nc","oc","qc","rc","value","sc","tc","toString","create","uc","vc","W","wc","xc","count","i","Pc","FinalizationRegistry","unregister","register","Rc","fromWireType","Tc","Uc","Vc","Wc","Xc","Yc","Zc","$c","ad","bd","cd","dd","ed","fd","clone","gd","hd","toWireType","jd","kd","ld","concat","md","nd","od","pd","rd","sd","td","ud","vd","wd","xd","yd","zd","Ad","Bd","Cd","Dd","Ed","Fd","Md","Gd","Jd","Kd","Ld","Nd","USER","LOGNAME","PATH","PWD","HOME","LANG","languages","_","Od","Pd","Qd","byteLength","BindingError","super","count_emval_handles","PureVirtualError","Sd","Td","getInheritedInstanceCount","getLiveInheritedInstances","flushPendingDeletes","setDelayFunction","InternalError","isAliasOf","getPrototypeOf","isDeleted","deleteLater","argPackAdvance","readValueFromPointer","deleteObject","pointerType","UnboundTypeError","Wd","__syscall_fcntl64","Ud","__syscall_ioctl","__syscall_openat","_embind_create_inheriting_constructor","defineProperty","implement","notifyOnDestruction","_embind_finalize_value_object","_embind_register_bigint","_embind_register_bool","_embind_register_class","$","_embind_register_class_class_function","Symbol","substring","_embind_register_class_class_property","enumerable","configurable","_embind_register_class_constructor","_embind_register_class_function","className","_embind_register_class_property","_embind_register_emval","_embind_register_enum","values","_embind_register_enum_value","_embind_register_float","_embind_register_function","_embind_register_integer","_embind_register_memory_view","_embind_register_std_string","ArrayBuffer","Uint8ClampedArray","Vd","_embind_register_std_wstring","_embind_register_value_object","_embind_register_value_object_field","_embind_register_void","_emscripten_get_now_is_monotonic","_emval_as","_emval_call_method","_emval_call_void_method","_emval_decref","_emval_get_method_caller","Id","Hd","_emval_get_module_property","_emval_get_property","_emval_incref","_emval_new_cstring","_emval_new_object","_emval_run_destructors","_emval_set_property","_emval_take_value","abort","emscripten_asm_const_int","emscripten_date_now","emscripten_get_now","emscripten_memcpy_big","copyWithin","emscripten_resize_heap","grow","environ_get","environ_sizes_get","fd_close","fd_read","fd_seek","NaN","isNaN","abs","floor","fd_write","strftime_l","getFullYear","getMonth","getDate","getDay","getTime","setDate","setMonth","setFullYear","RegExp","Rd","exports","memory","__indirect_function_table","__wasm_call_ctors","monitorRunDependencies","clearInterval","env","wasi_snapshot_preview1","instantiateWasm","instantiateStreaming","instance","free","malloc","_ma_device__on_notification_unlocked","ma_device__on_notification_unlocked","_ma_malloc_emscripten","ma_malloc_emscripten","_ma_free_emscripten","ma_free_emscripten","Xd","_ma_device_process_pcm_frames_capture__webaudio","ma_device_process_pcm_frames_capture__webaudio","_ma_device_process_pcm_frames_playback__webaudio","ma_device_process_pcm_frames_playback__webaudio","__errno_location","__getTypeName","Zd","calledRun","noFSInit","stdin","stdout","stderr","postRun","setStatus","__embind_initialize_bindings","_embind_initialize_bindings","dynCall_iiji","dynCall_jiji","dynCall_iiiji","dynCall_iij","dynCall_jii","dynCall_viijii","dynCall_iiiiij","dynCall_iiiiijj","dynCall_iiiiiijj","Yd","preInit","__WEBPACK_DEFAULT_EXPORT__","module","JSON","parse","__unused_webpack_module","Animation","_Animation__WEBPACK_IMPORTED_MODULE_0__","animation","artboard","runtime","playing","loopCount","scrubTo","LinearAnimationInstance","time","loopValue","advance","mix","BLANK_URL","_sanitizeUrl__WEBPACK_IMPORTED_MODULE_1__","registerTouchInteractions","_registerTouchInteractions__WEBPACK_IMPORTED_MODULE_0__","sanitizeUrl","_a","_b","stateMachines","renderer","rive","fit","alignment","_c","isTouchScrollEnabled","_prevEventType","_syntheticEventsActive","callback","event","MouseEvent","boundingRect","currentTarget","getBoundingClientRect","touches","preventDefault","clientX","clientY","changedTouches","getClientCoordinates","canvasX","left","canvasY","forwardMatrix","computeAlignment","minX","minY","maxX","maxY","bounds","invertedMatrix","Mat2D","invert","canvasCoordinatesVector","Vec2D","transformedVector","mapXY","transformedX","transformedY","_i","stateMachines_1","pointerMove","stateMachines_2","stateMachines_3","pointerDown","_d","stateMachines_4","pointerUp","passive","invalidProtocolRegex","htmlEntitiesRegex","htmlCtrlEntityRegex","ctrlCharactersRegex","urlSchemeRegex","relativeFirstCharacters","url","str","sanitizedUrl","match","dec","isRelativeUrlWithoutProtocol","urlSchemeParseResults","urlScheme","__webpack_module_cache__","moduleId","cachedModule","definition","key","obj","prop","toStringTag","Alignment","EventType","Fit","Layout","LoopType","RiveEventType","RiveFile","RuntimeLoader","StateMachineInput","StateMachineInputType","Testing","extendStatics","_rive_advanced_mjs__WEBPACK_IMPORTED_MODULE_0__","package_json__WEBPACK_IMPORTED_MODULE_1__","_animation__WEBPACK_IMPORTED_MODULE_2__","_utils__WEBPACK_IMPORTED_MODULE_3__","__extends","setPrototypeOf","__proto__","__","__awaiter","thisArg","_arguments","generator","reject","fulfilled","step","next","rejected","result","done","__generator","label","sent","trys","ops","verb","iterator","op","params","_e","_f","Contain","Center","new","warn","copyWith","runtimeFit","cachedRuntimeFit","Cover","cover","contain","Fill","FitWidth","fitWidth","FitHeight","fitHeight","ScaleDown","scaleDown","none","runtimeAlignment","cachedRuntimeAlignment","TopLeft","topLeft","TopCenter","topCenter","TopRight","topRight","CenterLeft","centerLeft","CenterRight","centerRight","BottomLeft","bottomLeft","BottomCenter","bottomCenter","BottomRight","bottomRight","center","loadRuntime","wasmURL","callBackQueue","backupJsdelivrUrl","version","toLowerCase","setWasmUrl","getInstance","isLoading","awaitInstance","runtimeInput","fire","Trigger","StateMachine","stateMachine","inputs","StateMachineInstance","initInputs","names","stateChangedCount","stateChangedNameByIndex","reportedEventCount","reportedEventAt","inputCount","mapRuntimeInput","SMIInput","bool","Boolean","asBool","number","Number","asNumber","trigger","asTrigger","Animator","eventManager","animations","animatables","fireEvent","mapToStringArray","instancedAnimationNames","instancedMachineNames","aIndex","mIndex","anim","animationByName","newAnimation","sm","stateMachineByName","newStateMachine","Play","data","Pause","paused","initLinearAnimations","initStateMachines","instancedStateMachineNames","play","pause","scrub","forScrubbing","_this","removedNames","animationsToRemove","machinesToRemove","Stop","reduce","acc","curr","isPlaying","atLeastOne","instancedName","animationCount","animationByIndex","stateMachineCount","stateMachineByIndex","handleLooping","Loop","PingPong","handleStateChanges","statesChanged","StateChange","handleAdvancing","Advance","SystemAudioStatus","EventManager","listeners","getListeners","listener","currentListener","removeAll","TaskQueueManager","queue","task","process","action","AudioManager","_super","_started","_enabled","_status","UNAVAILABLE","delay","timeout","reportToListeners","AudioStatusChange","enableAudio","AVAILABLE","testAudio","_audioContext","race","_establishAudio","listenForUserAction","once","establishAudio","audioManager","FakeResizeObserver","observe","unobserve","MyResizeObserver","globalThis","ResizeObserver","observers","ObjectObservers","_elementsMap","_onObservedEntry","entry","observed","target","onResize","clientWidth","clientHeight","_resizeObserver","_onObserved","entries","element","enableRiveAssetCDN","referenceCount","assetLoader","onLoad","on","Load","onLoadError","LoadError","initData","loader","loadRiveFile","fileLoadErrorMessage","init","missingErrorMessage","off","removeAllRiveEventListeners","readyForPlaying","eventCleanup","shouldDisableRiveListeners","automaticallyHandleEvents","_volume","_hasZeroSize","durations","frameTimes","frameCount","onCanvasResize","hasZeroSize","_layout","resizeToCanvas","renderSecondTimer","HTMLCanvasElement","_observed","riveFile","layout","onPlay","onPause","onStop","onLoop","onStateChange","onAdvance","onloaderror","onplay","onpause","onstop","onloop","onstatechange","taskQueue","autoplay","useOffscreenRenderer","onSystemAudioChanged","volume","startingAnimationNames","startingStateMachineNames","resizeDrawingSurfaceToCanvas","setupRiveListeners","riveListenerOptions","activeStateMachines","animator","hasListeners","touchScrollEnabledOption","removeRiveListeners","initializeAudio","hasAudio","artboardName","animationNames","stateMachineNames","msg","initArtboard","drawFrame","instanceNames","rootArtboard","artboardByName","defaultArtboard","systemVolume","startRendering","onSecond","frameRequestId","before","lastRenderTime","elapsedTime","activeAnimations_1","needsScrub","first","didLoop","activeStateMachines_1","numEventsReported","event_1","OpenUrl","RiveEvent","newAnchorTag","setAttribute","click","alignRenderer","after","isPaused","isStopped","align","stopRendering","cleanupInstances","deleteRiveRenderer","retrieveTextRun","textRunName","textRun","getTextRunValue","text","setTextRunValue","textRunValue","artBoardName","customDevicePixelRatio","dpr","devicePixelRatio","stateMachineInputs","find","retrieveInputAtPath","inputByPath","setBooleanStateAtPath","inputName","setNumberStateAtPath","fireStateAtPath","retrieveTextAtPath","textByPath","getTextRunValueAtPath","textName","run","setTextRunValueAtPath","unsubscribe","unsubscribeAll","fpsCallback","riveContents","artboards","artboardCount","artboardByIndex","artboardContents","name_1","inputContents","req","Request","bytes","default","getOwnPropertySymbols","propertyIsEnumerable","SuppressedError","useState","useEffect","innerWidth","innerHeight","useRef","contentRect","current","useDevicePixelRatio","fitCanvasToArtboardHeight","shouldResizeCanvasToContainer","riveLoaded","canvasElem","containerRef","options","onCanvasHasResized","artboardBounds","matchMedia","addListener","removeListener","useCallback","IntersectionObserver","elementsMap","onObserved","observer","registerCallback","removeCallback","setContainerRef","setCanvasRef","children","ref","verticalAlign","documentElement","bottom","shouldUseIntersectionObserver","isIntersecting","boundingClientRect","container","RiveComponent","useResizeCanvas","useRive","useRiveFile","throw","Iterator","return","useStateMachineInput","sleep","timeoutInMs","waitForFocus","hasFocus","checkIfBrowserSupported","getDisplayMedia","takeScreenshot","onCaptureEnd","onCaptureStart","quality","soundEffectUrl","preferCurrentTab","frameRate","mediaStream","muted","playsInline","srcObject","createVideoElementToCaptureFrames","loop","playCameraClickSound","videoTrackSettings","getTracks","getSettings","ctx","paintVideoFrameOnCanvas","screenshot","toDataURL","tracks","track","stopCapture","formatArgs","args","useColors","namespace","humanize","diff","index","lastC","namespaces","storage","setItem","removeItem","getItem","__nwjs","WebkitAppearance","firebug","exception","table","parseInt","$1","localStorage","localstorage","destroy","warned","colors","debug","formatters","stringify","createDebug","prevTime","namespacesCache","enabledCache","enableOverride","enabled","ms","prev","coerce","format","formatter","val","selectColor","delimiter","newDebug","toNamespace","regexp","skips","len","hash","isMergeableObject","isNonNullObject","stringValue","$$typeof","REACT_ELEMENT_TYPE","isReactElement","isSpecial","for","cloneUnlessOtherwiseSpecified","deepmerge","isArray","defaultArrayMerge","source","getKeys","symbol","getEnumerableOwnPropertySymbols","propertyIsOnObject","property","arrayMerge","sourceIsArray","propertyIsUnsafe","customMerge","getMergeFunction","mergeObject","all","array","deepmerge_1","hasOwn","toStr","gOPD","getOwnPropertyDescriptor","arr","isPlainObject","hasOwnConstructor","hasIsPrototypeOf","setProperty","newValue","writable","getProperty","copy","copyIsArray","deep","COMMENT_REGEX","NEWLINE_REGEX","WHITESPACE_REGEX","PROPERTY_REGEX","COLON_REGEX","VALUE_REGEX","SEMICOLON_REGEX","TRIM_REGEX","EMPTY_STRING","lineno","column","updatePosition","lines","start","line","Position","whitespace","end","content","errorsList","err","reason","filename","silent","re","comments","rules","comment","pos","declaration","ret","decl","decls","declarations","plural","msAbs","isPlural","parseFloat","isFinite","long","fmtShort","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","ReactCurrentOwner","__self","__source","defaultProps","props","_owner","Fragment","jsx","jsxs","__importDefault","mod","__esModule","inline_style_parser_1","styleObject","hasIterator","classNames","classes","arg","appendClass","parseValue","newClass","SVG","viewBox","xmlns","Path","optInStrings","lock","optInString","__dangerousOptInToUnstableAPIsOnlyForCoreModules","anError","optInToUnstableAPIs","showLogs","bigSkyInitialState","isDevMode","globalConsole","info","storeLastPayload","payload","lastPayload","BOM","EventSourceParserStream","TransformStream","parser","controller","onParse","isFirstChunk","startingPosition","startingFieldLength","eventId","eventName","feed","chunk","every","charCode","hasBom","discardTrailingNewline","character","lineLength","fieldLength","parseEventStreamLine","lineBuffer","noValue","field","valueLength","retry","createParser","enqueue","ChatModelService","WPCOM_JETPACK_AI","WPCOM_OPENAI","OPENAI","GROQ","OLLAMA","LMSTUDIO","LOCALAI","LOCAL_GRAPH","WPCOM_GRAPH","getAvailable","getDefault","getDefaultApiKey","service","ChatModelType","GPT_4O_MINI","GPT_4_TURBO","GPT_4O","LLAMA3_70B_8192","LLAMA3_70B_8192_WPCOM","GEMMA_7b_INSTRUCT","PHI_3_MEDIUM","MISTRAL_03","HERMES_2_PRO_MISTRAL","isMultimodal","model","supportsToolMessages","formatMessagesForModel","messages","imageUrls","image_url","role","tool_calls","tool_call","function","DEFAULT_SYSTEM_PROMPT","formatMessages","history","instructions","additionalInstructions","maxHistoryLength","trimmedMessages","firstNonToolMessageIndex","findIndex","ChatModel","apiKey","feature","sessionId","abortController","getApiKey","tools","temperature","maxTokens","tags","middleware","store","_model","_temperature","getDefaultModel","getDefaultTemperature","max_tokens","getDefaultMaxTokens","invokeChatModel","choice","choices","finish_reason","request","getParams","headers","getHeaders","AbortController","serviceRequest","getServiceUrl","method","signal","responseText","json","_response$message","code","runStream","_model2","_temperature2","reader","pipeThrough","TextDecoderStream","getReader","releaseLock","abortRequest","tool_choice","response_format","Authorization","GroqChatModel","OpenAIChatModel","WPCOMJetpackAIChatModel","WPCOMOpenAIChatModel","OllamaChatModel","LMStudioChatModel","LocalAIChatModel","LocalGraphChatModel","WPCOMGraphChatModel","session_id","initialState","agents","activeAgentId","started","changeAgentCount","actions","setAgentStarted","setActiveAgent","agentId","registerAgent","agent","incrementChangeAgentCount","resetChangeAgentCount","reducer","existingAgentIndex","updatedAgents","selectors","getActiveAgentId","getAgents","isAgentStarted","getChangeAgentCount","getActiveAgent","createSelector","getActiveAgentName","uuidv4","messageRoles","SYSTEM","ASSISTANT","LOCAL_ASSISTANT","USER_CHOICE","CONFIRM","ACTION","COMPONENT","THINKING","ERROR","TOOL_CALL","TOOL","SCREENSHOT","SET_TOPIC","SET_COLOR","SET_FONT","SET_SITE_TITLE","SET_SITE_DESCRIPTION","SET_SITE_LOCATION","SAVE_PAGE","defaultSiteMetadata","siteDescription","siteLocation","siteTitle","siteType","topic","colorRequest","currentColor","currentFont","defaultImageStyle","patterns","animationTiming","scrollWaitTime","assistantMessageThinkingTime","visualAdjustmentWaitTime","dockViews","CHAT","COMPLETED","HANDOFF","PENDING","MENUS","MAX_VARIATIONS_TO_SHOW","sectionStyleRegex","patternKeys","ITEMS_KEY","ITEM_KEY","SECTIONS_KEY","SECTION_KEY","graphConfig","documents","isToolRunning","isFetchingChatCompletion","baseUrl","getChatModel","select","runChatCompletion","async","dispatch","chatCompletionThreadStream","created_at","delta","toolCall","_message$tool_calls$t","updatedToolCall","assistantMessage","addMessage","addMessageReducer","filteredContent","filterChatMessage","existingMessageIndex","existingMessage","thread_id","additional_kwargs","tool_call_id","existingToolCallResultMessage","some","sortMessageHistory","sortedMessages","insertIndex","toolMessage","getToolOutputs","output","isEnabled","isRunning","isServiceAvailable","isChatAvailable","isAvailable","isAwaitingUserInput","getPendingToolCalls","getRunningToolCallIds","getAssistantMessage","getStream","getService","getModel","getTemperature","getFeature","getBaseUrl","getError","getMessages","getDocuments","lastMessage","function_name","toolCalls","getToolCalls","runningToolCalls","toolOutputs","toolOutput","getAdditionalMessages","getGraphConfig","isStoringConversation","setEnabled","setError","setGraphConfig","setStream","setService","setApiKey","setBaseUrl","setFeature","setSessionId","setTemperature","setModel","setStoreConversation","clearError","setToolResult","toolCallId","promise","ts","agentSay","clearMessages","messageType","addSystemMessage","userSay","image_urls","userSayRepeat","toolkits","contexts","callbacks","setCallbacks","setContext","context","existingContext","setTools","createNamespacedSelectors","namespacedSelectors","createNamespacedActions","namespacedActions","thunkArgs","metadata","createReduxStore","combineReducers","agentsReducer","registerToolkit","toolkit","existingToolkitIndex","chat","update","_action$delta$functio","contentDelta","messageIndex","_message","agentsActions","chatActions","agentsSelectors","getToolkits","getToolkit","getContexts","getCallbacks","getTools","chatSelectors","defaultAgents","defaultAgentsStore","Context","createContext","Consumer","Provider","storeInstances","optionsKey","useMemo","newStore","defaultValues","agentStore","useContext","useDispatch","activeAgent","useSelect","registerDefaultAgents","defaultChat","useChat","submitToolOutputs","loading","running","pendingToolCalls","additionalMessages","defaultToolkits","defaultToolkitsStore","deepMerge","useToolkits","toolkitsStore","useAgents","allToolkits","allContexts","allCallbacks","allTools","registerDefaultToolkits","tool","_toolkits$map","resolvedToolkits","foundToolkit","resolveAgentToolkits","_toolkit$callbacks","toolkitCallbacks","_toolkit$context","toolkitContext","toolkitTools","_toolkits$reduce","_toolkit$tools","toolkitToolsFunc","resolveToolkitTools","agentTools","resolvedTools","resolveAgentTools","invoke","invokeTools","hasToolkits","requestedToolkits","requestedToolkit","tryParse","toolName","nextToolCall","respond","toolResponse","onToolResult","withToolCall","ChildComponent","useNextToolCall","toOpenAITool","_tool$parameters","parameters","properties","required","additionalProperties","strict","description","useAgentExecutor","setInstructions","setAdditionalInstructions","prevToolOutputsLength","setPrevToolOutputsLength","promises","tool_uses","tool_use","recipient_name","toolResult","argsString","toolkitsLoaded","newInstructions","newAdditionalInstructions","onStart","openAITools","deepEqual","obj1","obj2","sortedObj1","sortedObj2","item","keys1","keys2","initialAgentId","templateSettings","argName","encoders","selfContained","strip","internalPrefix","encodersPrefix","delimiters","encoderType","false","true","currentSyntax","evaluate","interpolate","typeInterpolate","encode","use","useParams","define","defineParams","conditional","iterate","TYPES","resolveDefs","syn","block","def","_1","_2","param","Function","rw","unescape","__exp","compile","tmpl","sid","needEncoders","typ","enc","elseCase","vName","iName","defI","incI","try_","checkEncoders","addEncoders","Formatter","StringPromptTemplate","inputVariables","template","engine","validate","dummyInputs","formattedValues","DotPromptTemplate","compileDotTemplate","fromString","ASSISTANTS","ROUTER","SPEC","CONTENT","COLOR","PATTERN","FONT","PAGE","HELP","LAYOUT","IMAGE","assistantIds","languagePrompt","userLanguage","analysisPrompt","getSiteContextPrompt","fields","site","shouldIncludeField","getSelectedBlockContextPrompt","selectedBlock","clientId","getReturnToRouterPrompt","isForwardedByRouter","fromAssistantId","helpAssistantPrompt","helpActionPrompt","routerActionPrompt","invalidRequestPrompt","currentAssistantId","toAssistantId","enum","userRequest","changeAssistantTool","nameRe","nameReJsx","emptyOptions","empty","Schema","normal","space","merge","definitions","normalize","Info","attribute","boolean","booleanish","overloadedBoolean","commaSeparated","spaceSeparated","commaOrSpaceSeparated","mustUseProperty","defined","powers","increment","checks","DefinedInfo","mask","mark","check","own","attributes","xlink","xLinkActuate","xLinkArcRole","xLinkHref","xLinkRole","xLinkShow","xLinkTitle","xLinkType","xml","xmlLang","xmlBase","xmlSpace","caseSensitiveTransform","caseInsensitiveTransform","xmlnsxlink","xmlnsXLink","aria","ariaActiveDescendant","ariaAtomic","ariaAutoComplete","ariaBusy","ariaChecked","ariaColCount","ariaColIndex","ariaColSpan","ariaControls","ariaCurrent","ariaDescribedBy","ariaDetails","ariaDisabled","ariaDropEffect","ariaErrorMessage","ariaExpanded","ariaFlowTo","ariaGrabbed","ariaHasPopup","ariaHidden","ariaInvalid","ariaKeyShortcuts","ariaLabel","ariaLabelledBy","ariaLevel","ariaLive","ariaModal","ariaMultiLine","ariaMultiSelectable","ariaOrientation","ariaOwns","ariaPlaceholder","ariaPosInSet","ariaPressed","ariaReadOnly","ariaRelevant","ariaRequired","ariaRoleDescription","ariaRowCount","ariaRowIndex","ariaRowSpan","ariaSelected","ariaSetSize","ariaSort","ariaValueMax","ariaValueMin","ariaValueNow","ariaValueText","html","acceptcharset","classname","htmlfor","httpequiv","abbr","accept","acceptCharset","accessKey","allow","allowFullScreen","allowPaymentRequest","allowUserMedia","alt","as","autoCapitalize","autoComplete","autoFocus","autoPlay","blocking","charSet","checked","cite","cols","colSpan","contentEditable","controls","controlsList","coords","crossOrigin","dateTime","decoding","defer","dirName","disabled","download","draggable","encType","enterKeyHint","fetchPriority","form","formAction","formEncType","formMethod","formNoValidate","formTarget","hidden","high","hrefLang","htmlFor","httpEquiv","imageSizes","imageSrcSet","inert","inputMode","integrity","is","isMap","itemId","itemProp","itemRef","itemScope","itemType","kind","lang","language","list","low","manifest","maxLength","media","minLength","multiple","nonce","noModule","noValidate","onAfterPrint","onAuxClick","onBeforeMatch","onBeforePrint","onBeforeToggle","onBeforeUnload","onBlur","onCancel","onCanPlay","onCanPlayThrough","onChange","onClick","onClose","onContextLost","onContextMenu","onContextRestored","onCopy","onCueChange","onCut","onDblClick","onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop","onDurationChange","onEmptied","onEnded","onError","onFocus","onFormData","onHashChange","onInput","onInvalid","onKeyDown","onKeyPress","onKeyUp","onLanguageChange","onLoadedData","onLoadedMetadata","onLoadEnd","onLoadStart","onMessage","onMessageError","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onOffline","onOnline","onPageHide","onPageShow","onPaste","onPlaying","onPopState","onProgress","onRateChange","onRejectionHandled","onReset","onScroll","onScrollEnd","onSecurityPolicyViolation","onSeeked","onSeeking","onSelect","onSlotChange","onStalled","onStorage","onSubmit","onSuspend","onTimeUpdate","onToggle","onUnhandledRejection","onUnload","onVolumeChange","onWaiting","onWheel","optimum","pattern","ping","placeholder","popover","popoverTarget","popoverTargetAction","poster","preload","readOnly","referrerPolicy","rel","reversed","rows","rowSpan","sandbox","scope","scoped","seamless","selected","shadowRootClonable","shadowRootDelegatesFocus","shadowRootMode","shape","sizes","slot","span","spellCheck","srcDoc","srcLang","srcSet","tabIndex","title","typeMustMatch","useMap","wrap","writingSuggestions","aLink","archive","axis","background","bgColor","border","borderColor","bottomMargin","cellPadding","cellSpacing","char","charOff","classId","codeBase","codeType","compact","declare","face","frame","frameBorder","hSpace","leftMargin","longDesc","lowSrc","marginHeight","marginWidth","noResize","noHref","noShade","noWrap","profile","rev","rightMargin","scheme","scrolling","standby","summary","topMargin","valueType","vAlign","vLink","vSpace","allowTransparency","autoCorrect","autoSave","disablePictureInPicture","disableRemotePlayback","prefix","results","security","unselectable","svg","accentHeight","alignmentBaseline","arabicForm","baselineShift","capHeight","clipPath","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","dataType","dominantBaseline","enableBackground","fillOpacity","floodColor","floodOpacity","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","horizAdvX","horizOriginX","horizOriginY","imageRendering","letterSpacing","lightingColor","markerEnd","markerMid","markerStart","navDown","navDownLeft","navDownRight","navLeft","navNext","navPrev","navRight","navUp","navUpLeft","navUpRight","onActivate","onBegin","onEnd","onFocusIn","onFocusOut","onMouseWheel","onRepeat","onShow","onZoom","overlinePosition","overlineThickness","paintOrder","panose1","pointerEvents","renderingIntent","shapeRendering","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","strokeDashArray","strokeDashOffset","strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeOpacity","strokeWidth","textAnchor","textDecoration","textRendering","transformOrigin","typeOf","underlinePosition","underlineThickness","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","vHanging","vIdeographic","vMathematical","vectorEffect","vertAdvY","vertOriginX","vertOriginY","wordSpacing","writingMode","xHeight","playbackOrder","timelineBegin","about","accumulate","additive","alphabetic","amplitude","ascent","attributeName","attributeType","azimuth","bandwidth","baseFrequency","baseProfile","bbox","begin","bias","by","calcMode","clipPathUnits","contentScriptType","contentStyleType","cursor","cx","cy","defaultAction","descent","diffuseConstant","direction","display","dur","divisor","dx","dy","edgeMode","editable","elevation","exponent","externalResourcesRequired","filterRes","filterUnits","focusable","focusHighlight","fr","from","fx","fy","g1","g2","glyphRef","gradientTransform","gradientUnits","handler","hanging","hatchContentUnits","hatchUnits","ideographic","initialVisibility","in","in2","intercept","k1","k2","k3","k4","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","kerning","lengthAdjust","limitingConeAngle","local","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","mathematical","mediaCharacterEncoding","mediaContentEncodings","mediaSize","mediaTime","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","pathLength","patternContentUnits","patternTransform","patternUnits","phase","pitch","points","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","propagate","radius","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","requiredFonts","requiredFormats","resource","restart","rx","ry","scale","seed","side","slope","snapshotTime","specularConstant","specularExponent","spreadMethod","spacing","startOffset","stdDeviation","stemh","stemv","stitchTiles","string","surfaceScale","syncBehavior","syncBehaviorDefault","syncMaster","syncTolerance","syncToleranceDefault","systemLanguage","tableValues","targetX","targetY","textLength","transformBehavior","to","u1","u2","unicode","viewTarget","visibility","widths","x1","x2","xChannelSelector","y1","y2","yChannelSelector","zoomAndPan","valid","dash","kebab","$0","camelcase","toUpperCase","hastToReact","pointEnd","point","pointStart","stringifyPosition","VFileMessage","causeOrReason","optionsOrParentOrPlace","legacyCause","place","ancestors","cause","ruleId","fatal","actual","expected","note","emptyMap","dashSomething","tableElements","tableCellElement","docs","one","parentSchema","schema","tagName","findComponentFromName","alignValue","createProperty","tableCellAlignToStyle","stylePropertyNameCase","createElementProps","createChildren","child","thing","addNode","addChildren","estree","evaluater","expression","evaluateExpression","crashEstree","mdxExpression","objectExpression","argument","createJsxElementProps","mdxJsxElement","evaluateProgram","mdxEsm","passNode","countsByName","passKeys","Type","rest","dashes","settings","padRight","padLeft","toCamel","ignoreInvalidStyle","filePath","parseStyle","domCasing","cssCasing","transformStyleToCssCasing","transformStylesToCssCasing","elementAttributeNameCase","allowExpression","identifiers","computed","optional","components","toDash","urlAttributes","icon","includeImageAlt","includeHtml","items","chunkStart","SpliceBuffer","initial","RangeError","setCursor","POSITIVE_INFINITY","reverse","deleteCount","trunc","removed","chunkedPush","pushMany","unshiftMany","subtokenize","eventsArray","jumps","lineIndex","otherIndex","otherEvent","subevents","more","events","_tokenizer","_isInFirstContentOfListItem","contentType","subcontent","_container","eventIndex","token","startPosition","startPositions","tokenizer","childEvents","gaps","previous","adjust","breaks","sliceStream","defineSkip","_gfmTasklistFirstContentOfListItem","syntaxExtension","extension","hook","constructs","existing","asciiAlpha","regexCheck","asciiAlphanumeric","asciiAtext","asciiControl","asciiDigit","asciiHexDigit","asciiPunctuation","markdownLineEnding","markdownLineEndingOrSpace","markdownSpace","unicodePunctuation","unicodeWhitespace","regex","factorySpace","effects","limit","enter","consume","exit","tokenize","contentStart","attempt","contentInitial","lineStart","childFlow","childToken","lineStartOffset","continued","containerState","continuation","documentContinue","checkNewContainers","_closeFlow","closeFlow","indexBeforeExits","indexBeforeFlow","exitContainers","documentContinued","currentConstruct","concrete","flowStart","interrupt","_gfmTableDynamicInterruptHack","containerConstruct","thereIsANewContainer","thereIsNoNewContainer","lazy","containerContinue","flow","flowContinue","writeToChild","eof","seen","nok","null","blankLine","partial","chunkInside","contentEnd","continuationConstruct","contentContinue","prefixed","tail","sliceSerialize","flowInitial","afterConstruct","resolver","resolveAll","createResolver","initializeFactory","notText","atBreak","resolveAllLineSuffixes","extraResolver","chunks","tabs","bufferIndex","_index","_bufferIndex","called","createTokenizer","initialize","columnStart","resolveAllConstructs","consumed","accountForPotentialSkip","constructFactory","construct","addResult","onsuccessfulcheck","expandTabs","atTab","serializeChunks","chunkIndex","go","main","expectedCode","startIndex","startBufferIndex","endIndex","endBufferIndex","view","head","sliceChunks","onreturn","returnState","bogusState","listOfConstructs","constructIndex","handleListOfConstructs","handleConstruct","startPoint","startPrevious","startCurrentConstruct","startEventsIndex","startStack","resolveTo","thematicBreak","marker","sequence","initialSize","atMarker","inside","onBlank","listItemPrefixWhitespaceConstruct","endOfPrefix","otherPrefix","initialBlankLine","furtherBlankLines","notInCurrentItem","indentConstruct","blockQuote","contBefore","factoryDestination","literalType","literalMarkerType","rawType","stringType","balance","enclosedBefore","raw","enclosed","enclosedEscape","rawEscape","factoryLabel","markerType","labelInside","labelEscape","factoryTitle","escape","factoryWhitespace","normalizeIdentifier","identifier","labelAfter","markerAfter","destinationBefore","destinationAfter","titleBefore","afterWhitespace","beforeMarker","titleAfter","titleAfterOptionalWhitespace","codeIndented","afterPrefix","furtherStart","headingAtx","sequenceOpen","sequenceFurther","setextUnderline","paragraph","heading","htmlBlockNames","htmlRawNames","htmlFlow","closingTag","markerB","declarationOpen","tagCloseStart","continuationDeclarationInside","commentOpenInside","cdataOpenInside","slash","basicSelfClosing","completeClosingTagAfter","completeAttributeNameBefore","completeEnd","completeAttributeName","completeAttributeNameAfter","completeAttributeValueBefore","completeAttributeValueQuoted","completeAttributeValueUnquoted","completeAttributeValueQuotedAfter","completeAfter","continuationCommentInside","continuationRawTagOpen","continuationClose","continuationCdataInside","continuationStart","blankLineBefore","continuationAfter","nonLazyContinuationStart","continuationStartNonLazy","continuationBefore","continuationRawEndTag","nonLazyContinuation","codeFenced","closeStart","beforeSequenceClose","sequenceClose","sizeOpen","sequenceCloseAfter","initialPrefix","beforeSequenceOpen","infoBefore","atNonLazyBreak","metaBefore","meta","contentBefore","beforeContentChunk","contentChunk","decodeNamedCharacterReference","characterReference","textContent","numeric","characterEscape","lineEnding","labelEnd","labelStart","_balanced","_inactive","labelEndNok","resourceConstruct","labelEndOk","referenceFullConstruct","referenceNotFull","referenceCollapsedConstruct","group","insideSpan","resourceBefore","resourceOpen","resourceEnd","resourceDestinationAfter","resourceDestinationMissing","resourceBetween","resourceTitleAfter","referenceFullAfter","referenceFullMissing","referenceCollapsedOpen","labelStartImage","classifyCharacter","attention","attentionMarkers","_open","_close","openingSequence","closingSequence","nextEvents","movePoint","autolink","schemeOrEmailAtext","emailAtext","schemeInsideOrEmailAtext","urlInside","emailAtSignOrDot","emailLabel","emailValue","htmlText","instruction","tagOpen","commentEnd","commentClose","lineEndingBefore","cdata","cdataClose","cdataEnd","instructionClose","tagClose","tagCloseBetween","tagOpenBetween","tagOpenAttributeName","tagOpenAttributeNameAfter","tagOpenAttributeValueBefore","tagOpenAttributeValueQuoted","tagOpenAttributeValueUnquoted","tagOpenAttributeValueQuotedAfter","lineEndingAfter","lineEndingAfterPrefix","labelStartLink","hardBreakEscape","codeText","between","tailExitIndex","headEnterIndex","search","decodeNumericCharacterReference","base","fromCodePoint","characterEscapeOrReference","$2","hex","fromMarkdown","encoding","config","transforms","canContainEols","opener","autolinkProtocol","onenterdata","autolinkEmail","atxHeading","codeFlow","codeFencedFenceInfo","codeFencedFenceMeta","codeTextData","codeFlowValue","definitionDestinationString","definitionLabelString","definitionTitleString","emphasis","hardBreak","hardBreakTrailing","htmlFlowData","htmlTextData","listItem","spread","_spread","listItemValue","expectingFirstListItemValue","listOrdered","listUnordered","reference","referenceType","referenceString","resourceDestinationString","resourceTitleString","setextHeading","strong","closer","atxHeadingSequence","onexitdata","characterEscapeValue","characterReferenceMarkerHexadecimal","onexitcharacterreferencemarker","characterReferenceMarkerNumeric","characterReferenceValue","characterReferenceType","flowCodeInside","codeFencedFence","onexithardbreak","inReference","fragment","labelText","ancestor","decodeString","atHardBreak","setextHeadingSlurpLineEnding","setextHeadingLineSequence","codePointAt","setextHeadingText","configure","mdastExtensions","tree","tokenStack","listStack","prepareList","defaultOnError","firstBlankLineIndex","containerBalance","listSpread","tailIndex","tailEvent","and","errorHandler","onExitError","siblings","ordered","compiler","postprocess","extensions","combineExtensions","atCarriageReturn","endPosition","lastIndex","preprocess","combined","remarkParse","doc","deserialize","serialized","out","unpair","BigInt","deserializer","EMPTY","asString","shouldSkip","TYPE","serialize","lossy","pair","valueOf","toJSON","toISOString","serializer","structuredClone","any","normalizeUri","skip","encodeURIComponent","defaultFootnoteBackContent","rereferenceIndex","defaultFootnoteBackLabel","referenceIndex","convert","castFactory","tests","anyFactory","checkAsRecord","nodeAsRecord","propsFactory","testFunction","looksLikeANode","CONTINUE","EXIT","SKIP","visit","testOrVisitor","visitorOrReverse","maybeReverse","visitor","parents","subresult","grandparents","toResult","nodeAsParent","visitParents","revert","subtype","suffix","contents","listItemLoose","tab","trimLines","last","trimLine","blockquote","patch","applyData","break","footnoteReference","clobberPrefix","safeId","footnoteOrder","counter","reuseCounter","footnoteCounts","dataFootnoteRef","sup","allowDangerousHtml","imageReference","definitionById","inlineCode","linkReference","loose","listLoose","firstRow","tableContent","tableCell","tableRow","cellIndex","cells","cell","toml","ignore","yaml","footnoteDefinition","hName","hChildren","hProperties","defaultUnknownHandler","nodes","trimMarkdownSpaceStart","toHast","footnoteById","handlers","handle","passThrough","shallow","unknownHandler","createState","foot","footnoteBackContent","footnoteBackLabel","footnoteLabel","footnoteLabelTagName","footnoteLabelProperties","listItems","backReferences","counts","dataFootnoteBackref","tailTail","dataFootnotes","footer","remarkRehype","hastTree","bail","minpath","extname","assertPath","seenNonSlash","firstNonSlashEnd","extnameIndex","unmatchedSlash","startPart","startDot","preDotState","segments","joined","absolute","allowAboveRoot","lastSlashIndex","lastSegmentLength","lastSlash","dots","normalizeString","minproc","isUrl","fileUrlOrPath","protocol","auth","VFile","isUint8Array","cwd","stored","basename","assertNonEmpty","assertPart","dirname","stem","hostname","pathname","third","decodeURIComponent","getPathFromURLPosix","urlToPath","fail","part","CallableInstance","proto","Processor","Compiler","Parser","attachers","freezeIndex","frozen","transformers","fns","pipeline","middlewareIndex","fn","fnExpectsCallback","middelware","trough","attacher","assertUnfrozen","freeze","transformer","realFile","vfile","assertParser","assertCompiler","executor","parseTree","realDone","compileTree","compileResult","processSync","complete","assertDone","assertNode","outputTree","resultingTree","runSync","addPlugin","addList","addPreset","plugin","plugins","entryIndex","primary","currentPrimary","unified","asyncName","looksLikeAVFile","emptyPlugins","emptyRemarkRehypeOptions","safeProtocol","deprecations","Markdown","allowedElements","allowElement","disallowedElements","rehypePlugins","remarkPlugins","remarkRehypeOptions","skipHtml","unwrapDisallowed","urlTransform","defaultUrlTransform","processor","deprecation","mdastTree","development","jsxDEV","isStaticChildren","columnNumber","fileName","lineNumber","developmentCreate","createEvaluater","toJsxRuntime","colon","questionMark","numberSign","LEAF_KEY","arrayOf","isShallowEqual","fromIndex","selector","getDependants","rootCache","normalizedGetDependants","WeakMap","callSelector","cache","dependants","dependant","caches","isUniqueByDependants","createCache","getCache","lastDependants","isSimpleSite","_currentSiteType","_superProps","_user","_tkq","userId","username","superProps","setUser","setSuperProps","identifyUser","setGoogleAnalyticsEnabled","googleAnalyticsEnabled","googleAnalyticsKey","setMcAnalyticsEnabled","mcAnalyticsEnabled","ID","assignSuperProps","bumpStat","uriComponent","buildQuerystring","random","bumpStatWithPageView","buildQuerystringNoPrefix","pageView","record","urlPath","pageTitle","recordPageView","purchase","transactionId","itemName","revenue","price","qty","currency","recordPurchase","recordEvent","eventProperties","recordJetpackClick","setOptOut","isOptingOut","initialized","hitType","page","category","debugText","sku","quantity","setProperties","clearedIdentity","tracks_prefix","validNameRegex","validateName","getPhase","aiStore","getIsHandoff","getSiteMetadata","isOnboarded","getIsDevMode","aiState","getCurrentPageProperties","homePageId","coreStore","getEntityRecord","page_on_front","currentPostId","editorStore","getCurrentPostId","isHomePage","post_id","getEditedPostAttribute","is_home_page","recordTracksEvent","combinedProperties","sessionid","getState","is_test","validateProperties","analytics","logAction","message_role","message_id","parent_message_id","message_type","apiFetch","errorBreakLoop","addToPayload","separator","logger","_actionFromError","getSessionId","errorMessage","trace","Response","statusText","extra","attemptFailedNumber","JWT_TOKEN_ID","JWT_TOKEN_EXPIRATION_TIME","fetchJetpackToken","useCachedToken","newTokenData","requestJetpackToken","tokenData","expire","apiNonce","JP_CONNECTION_INITIAL_STATE","siteId","Jetpack_Editor_Initial_State","wpcomBlogId","blog_id","blogId","currentChatMessageModel","slug","patternsBySlug","nanoid","blockNameMap","PRIMARY_HEADING","getContentOfBlocks","blocks","patternCategory","innerBlocks","example","originalHTML","getContentRequestData","isConceptSection","blockLengths","blockCounts","contentForRequest","ln","clientIdMap","blockMap","findFirstAvailableInnerBlockByClassName","parentBlock","matchingBlock","matchingInnerBlock","findLastAvailableInnerBlockByClassName","getNextAvailableContentValue","contentValue","removeBlockFromHtml","blockName","systemPromptTemplate","getEventsContentSystemPrompt","dateFormatExample","do","toLocaleDateString","examplesDescription","examples","getServicesContentSystemPrompt","getTestimonialsContentSystemPrompt","getPrompts","conceptSection","dateBlock","system","user","replaceContent","rootBlock","eventsData","updateBlockAttributes","newEventsData","newStartIndex","validClassNames","matchingClassName","updatedEventsData","preprocessSection","siteLocationName","footerData","newFooterData","updatedFooterData","menuDataIndex","numOfSections","dont","menuData","sectionHeading","replaceHeading","newMenuData","sectionIndex","section","newType","getNextAvailableMenuSectionContentValue","servicesDataIndex","pricingData","newPricingData","tierIndex","serviceIndex","tiers","services","getNextAvailablePricingTierSectionContentValue","isCachedContentValid","cachedContent","servicesData","newServicesData","updatedServicesData","updateContent","updates","blockUpdates","testimonialsData","newTestimonialsData","updatedTestimonialsData","testimonialContent","wrapMapBlock","createBlock","dimensions","minHeight","mapHeight","innerBlock","contactData","newContactData","updatedContactData","parsedPattern","patternBlock","preprocessSectionTypes","pricing","contact","customSectionTypes","menu","testimonials","team","customSectionNames","preprocessSectionNames","sectionCachedContentIsValid","sectionCachedContent","OPENAI_PRICING","inputCost","outputCost","imageCost","ANTHROPIC_PRICING","currentUserMessage","pendingToolCallbacks","currentToolCall","hasRetriedChatRequest","assistant","advancedChatModel","basicChatModel","imageGenModel","openAIUsage","anthropicUsage","commands","stock_photos","selectedSectionContent","patternCategories","getPatternCategories","categories","remotePatterns","generatedPatterns","currentPageMetadata","newPageId","delaySettings","onboarding","afterBlockProcessed","afterScrollToBlock","isAssistantButtonVisible","isToolContainerVisible","toolComponent","showThread","chatComponents","dockView","onSelectedBlockAction","inputtedFiles","onInputtedFilesAction","showChatContinueButton","chatContinueButtonOnClick","showEditorWelcome","isEditorReady","isEditorIframeLoaded","isTemplatePartContentReady","lastSelectedBlock","lastCancelableAction","blockBeforeChanges","handoffStep","logSessions","chosenCategories","chosenColors","chosenCustomColors","generatedVariations","chosenFonts","isBuildingSite","currentHandoffArea","userStyleWithSettings","imageStyle","isTyping","siteMetadata","_window$bigSkyInitial","isMaximized","initializedCustomScheme","hideInput","customVariationTemplates","currentPaletteColors","generatedPatternChunksAsJSON","generatedPatternAsBlocks","generatedPatternAsString","generatedPatternDummySectionClientId","generatedRootPatternClientId","fallbackPhoto","jetpackToken","isLocalGraph","chatModel","logOpenAIUsage","usage","generateImage","image_format","imageGenerationUrl","remove_background","nextStockPhoto","numImages","resolveSelect","photos","getPhotosFromPexels","photo","debugLog","removeOldestMessage","setLastSelectedBlock","setIsAssistantButtonVisible","setIsToolContainerVisible","setToolComponent","setCurrentUserMessage","archiveMessages","archiveMessage","setLogSessions","setSessionLogged","isLogged","deleteMessage","setSelectedSectionContent","clearSelectedSectionContent","setIsEditorReady","setIsEditorIframeLoaded","addCachedContent","addCachedImage","addCommand","command","resetCachedContent","setRemotePatterns","locale","setGeneratedPatterns","setIsEditingPageLayout","isEditingPageLayout","setCurrentPageMetadata","setIsBuildingSite","setIsHandoff","isHandoff","setCurrentHandoffArea","setChatComponents","setShowThread","setCurrentToolCall","incrementPendingToolCallbacks","decrementPendingToolCallbacks","setDockView","setLastCancelableAction","setChosenCategories","setChosenColors","setChosenCustomColors","setChosenFonts","setBlockBeforeChanges","setOnSelectedBlockAction","setIsTemplatePartContentReady","setUserStyleWithSettings","setInputtedFiles","setOnInputtedFilesAction","setShowChatContinueButton","setChatContinueButtonOnClick","setCurrentColor","setInitializedCustomScheme","pushGeneratedVariations","setCurrentFont","setImageStyle","setIsTyping","setHasRetriedChatRequest","setSiteMetadata","setHandoffStep","resetStore","setIsMaximized","setHideInput","isHidden","setShowEditorWelcome","setAssistant","setGeneratedPatternAsString","setGeneratedPatternChunksAsJSON","setGeneratedPatternAsBlocks","setGeneratedPatternDummySectionClientId","setGeneratedRootPatternClientId","logAnthropicUsage","setCurrentPaletteColors","setNewPageId","getCurrentMessages","archived","getAdditionalContext","additionalContext","siteIntent","siteGoals","_state$inputtedFiles","_action$payload","cachedContentKey","newUsage","completionTokens","promptTokens","totalTokens","totalRequests","estimatedCost","completion_tokens","prompt_tokens","total_tokens","completion","getOpenAICost","anthropicModel","newAnthropicUsage","inputTokens","outputTokens","input_tokens","output_tokens","estimatedAnthropicCost","getAnthropicCost","sessionLogged","blockType","h2","append","nameKey","existingItemIndex","cachedItem","subKey","cachekey","lastUpdated","images","currentFile","nextFile","getCustomVariationTemplates","getAllMessages","getLastSelectedBlock","getIsAssistantButtonVisible","getToolComponent","getOpenAIChatUsage","getOpenAIChat35Usage","getOpenAIImageGenUsage","getAnthropicUsage","getAdvancedChatModel","getBasicChatModel","getImageGenModel","shouldLogSessions","isSessionLogged","getDelaySettings","getSelectedSectionContent","getIsEditorReady","getIsEditorIframeLoaded","getCachedContent","getCommands","getIsComingSoon","isComingSoon","getIsBlogPrivate","isBlogPrivate","getSiteLaunchStatus","launchStatus","getUserLocale","userLocale","getUserLanguage","getRemotePatterns","getGeneratedPatterns","getIsEditingPageLayout","getCurrentPageMetadata","getIsBuildingSite","getCurrentHandoffArea","getChatComponents","getShowThread","getCurrentToolCall","getPendingToolCallbacks","getDockView","getLastCancelableAction","getChosenCategories","getChosenColors","getChosenCustomColors","getInitializedCustomScheme","getGeneratedVariations","getChosenFonts","getBlockBeforeChanges","getOnSelectedBlockAction","getIsTemplatePartContentReady","getUserStyleWithSettings","getInputtedFiles","getOnInputtedFilesAction","getShowChatContinueButton","getChatContinueButtonOnClick","getCurrentColor","getCurrentFont","getImageStyle","getIsTyping","getHasRetriedChatRequest","getHandoffStep","getIsMaximized","getHideInput","getShowEditorWelcome","getAssistant","getGeneratedPatternChunksAsJSON","getGeneratedPatternAsBlocks","getGeneratedPatternAsString","getGeneratedPatternDummySectionClientId","getGeneratedRootPatternClientId","getCurrentPaletteColors","getNewPageId","resolvers","siteTypeFallbacks","foodAndBeverage","business","blog","portfolio","personal","fetchWithRetry","searchTerm","retries","pow","setDelay","firstResults","allPhotos","genericTopic","remainingCount","secondResults","categoriesToAllowAll","filteredPatterns","is_included_in_big_sky","patternCategoryNames","Notice","notice","removeTimeout","useHandleReset","useCreateToolCallback","handleReset","withPendingToolCallback","createToolCallback","closeChatWhenDone","validator","failValidatorAction","executeAction","_args","assistantsRegistry","assistantsList","getAssistantById","getAssistantToolkitName","assistantId","useChangeAssistantTool","changesHistory","logRoutingError","changeAssistant","isImmediateLoop","isPatternLoop","isLoopDetected","toolkitName","routerAssistant","routerAssistantPrompt","routerToolkit","toolkitHook","useRouterToolkit","getSelectedBlock","blockEditorStore","change_assistant","agentMessage","siteTypeIds","inputPlaceholder","actionName","logSession","deltaMetadata","useSiteMetadata","setSiteMetadataState","saveEditedEntityRecord","editEntityRecord","persist","confirmingSpecs","newSiteMetadata","newSiteMetadataJson","logSiteMetadata","big_sky_site_metadata","undoIgnore","getPagePatterns","pageId","setTopic","setSiteDescription","setSiteLocation","setSiteTitle","getCanvasIframeElements","_canvasiFrame$content","_canvasiFrameDocument","_canvasiFrame$content2","_canvasiFrameDocument2","canvasiFrame","querySelector","canvasiFrameDocument","contentDocument","canvasiFrameRoot","canvasiFrameWindow","contentWindow","canvasiFrameBody","useBlocks","getBlockHierarchyRootClientId","getBlock","getBlocksByName","getClientIdsOfDescendants","getBlockParentsByBlockName","getBlocks","selectBlock","replaceBlock","_settings$title","_settings","getTemplatePartClientID","templatePartClientIds","setMapLocationInBlocks","coordinates","lat","lng","mapCenter","placeTitle","caption","latitude","longitude","selectBlockInViewport","iframeElement","canvasContentWindow","blockClientId","scrollToBlock","selectBlockAfterScroll","getElementById","scrollIntoView","behavior","handleScroll","scrollHandlerFn","getFirstChildBlockByName","searchName","_block","getParentRootTemplatePartBlock","parentGroupClientIds","copyBlockWithInnerBlocks","newBlock","fixInvalidBlock","replacement","blockHasContent","getSurroundingContentOfBlock","rootParentBlockClientID","rootParentBlock","allChildBlocksClientIDs","surroundingContent","clientID","childBlock","getContentBlockClientID","setBlockIsProcessing","isProcessing","blockElement","getBlockElement","classList","scrollToFirstBlockByName","getParentRootPatternBlock","parentRootPatternBlock","groupClientId","groupBlock","isTemplatePart","rootTemplatePartBlock","getFirstChildBlockByClientIdDOMElement","domElement","getAttribute","findSiteLogoBlock","headerClientId","headerContentBlocks","footerClientId","footerContentBlocks","searchForSiteLogoBlock","found","grad","turn","rad","PI","parsed","rgba","isValid","brightness","isDark","isLight","toHex","toRgb","toRgbString","toHsl","toHslString","toHsv","saturate","desaturate","grayscale","isEqual","useVariations","getBlockVariations","blocksStore","__experimentalGetCurrentThemeGlobalStylesVariations","getColorVariations","variations","colorVariations","isColorVariation","getFontVariations","fontVariations","isFontVariation","getColorVariationByTitle","getHexColorFromThemeVar","colorTitle","themeVar","variation","varIndex","palette","theme","getSectionVariationBackgroundColor","sectionVariationName","styles","getSectionVariationTextColor","typography","getSocialLinkVariations","MAX_VARIATIONS_SHOWN","getFontVariationByTitle","fonts","getVariationKeywords","keywords","luminance","contrast","isReadable","level","BIG_SKY_CUSTOM_THEME_PREFIX","BIG_SKY_CUSTOM_COLOR_PREFIX","getContrastingThemeColor","themeColors","contrastingColor","colord","darkest","lightest","getLightestColor","createColorHash","addColorToTheme","existingColor","nextIndex","newColor","applyThemeAdjustments","currentVariationBackgroundVar","currentVariationTextVar","currentVariationBackgroundColor","isLightContrastingColor","textColor","updateThemePalette","adjustContrast","color1","targetContrast","referenceColor","refColor","isRefLight","attempts","adjustedColor","adjustment","newL","lightTheme","templateTheme","sortedColors","reorderedColors","color2","color3","color4","fromEntries","darkTheme","hslTheme","colorsArray","user_requested","newColors","adjustToNeutralBase","baseColor","newS","generateTonalVariation","adjustTonalVariation","cS","cL","adjustedS","adjustedL","generateHslPalette","getVariations","GlobalStylesContext","blockEditorPrivateApis","useGlobalSetting","useGlobalStyle","useGlobalStylesReset","resolveColor","normalized","useStyles","setCurrentColorState","setCurrentFontState","canReset","getBlockAttributes","setUserConfig","globalStylesId","getEditedEntityRecord","__experimentalGetCurrentGlobalStylesId","registry","useRegistry","ai","coreColors","customColors","paletteColors","userStyle","shouldDecodeEncode","customCss","setCustomCss","useCustomCss","css","currentTheme","getCurrentTheme","getVariationSectionValues","_variation$styles$blo","sectionColors","sectionColor","elements","updateRootBlocksStyles","rootBlocks","background_color","text_color","button_color","button_text_color","section_to_update","allUpdates","collectChildUpdates","updatedAttributes","buttonBackgroundColor","matches","getRootBlocks","postContentBlockId","setStyles","font","updateBlocks","selectedColorTitle","selectedFontTitle","colorVariation","colorPalette","batch","sectionValue","button","fontVariation","currentConfig","mergeOptions","destinationArray","sourceArray","newConfig","selectedColorVariation","selectedFontVariation","getVariationBackgroundColor","getVariationTextColor","getVariationSectionColors","_variation$styles$blo2","createCustomSchemeVariations","custom_colors","customColorVariations","customColorVariation","filteredVariations","currentThemeCopy","resetStyles","saveStylesEntityRecord","hexToRgb","getThemeColors","resetBlockTextColor","getCustomVariationTemplateCopy","getDummyPosts","tagId","createDummyPosts","posts","getDummyPostTag","createDummyPostTag","useCanvas","DUMMY_SECTION_CLASSNAMES","setZoomLevel","resetZoomLevel","__unstableSetEditorMode","replaceInnerBlocks","__unstableMarkNextChangeAsNotPersistent","useLocation","routerPrivateApis","query","addPatternSkeleton","rootPatternBlock","containerClientID","getContainerClientID","dummySectionClientIds","addBlocksToDummySection","addPatternToCanvas","isQuickOnboarding","supports","setIframeScale","windowWidth","selectedBlockScale","createDummySection","isEmpty","insertDummySections","replaceTemplateParts","dummySections","contentBlockClientID","headerTemplatePartClientID","footerTemplatePartClientID","currentHeaderBlocks","remotePatternId","currentFooterBlocks","currentContentBlocks","dummySectionClientId","setStyleProperties","blockDblclick","stopImmediatePropagation","canvasMode","addPatternsToCanvas","headerPattern","bodyPatterns","footerPattern","splitPatterns","scrollToTop","scrollTo","clearTemplateParts","checkAndClearTemplateParts","subscribe","clearBlocks","checkAndClearBlocks","zoomOut","getAnimations","finished","dispatchEvent","Event","zoomIn","isPostSaved","setIsPostSaved","isPostSavingInProgress","postType","postId","getCurrentPostType","isSavingPost","isSavingEntityRecord","num","arrayToHex","isIgnoredColor","ignoredColor","isIgnoredColorAsNumbers","isIgnoredRGBColor","isIgnoredRGBAColor","redIgnored","greenIgnored","blueIgnored","alphaIgnored","threshold","alphaData","alphaInRange","inRange","isIgnoredRGBAColorWithThreshold","colorComponent","ignoredColorComponent","dominantAlgorithm","colorHash","divider","dominantDivider","red","green","blue","redTotal","greenTotal","blueTotal","alphaTotal","defaultColor","simpleAlgorithm","sqrtAlgorithm","getDefaultColor","getOption","defaultValue","getSrc","isInstanceOfHTMLCanvasElement","hasOffscreenCanvas","OffscreenCanvas","isInstanceOfOffscreenCanvas","ImageBitmap","isInstanceOfImageBitmap","isInstanceOfHTMLImageElement","HTMLImageElement","isWebWorkers","outputError","FastAverageColor","getColorAsync","img","bindImageEvents","getColor","prepareResult","originalSize","factor","srcLeft","srcTop","srcWidth","srcHeight","destWidth","destHeight","prepareSizeAndPosition","naturalWidth","naturalHeight","HTMLVideoElement","isInstanceOfHTMLVideoElement","videoWidth","videoHeight","getOriginalSize","willReadFrequently","imageSmoothingEnabled","bitmapData","getImageData","getColorFromArray4","originalError","arrLength","algorithm","rgb","isDarkColor","hexa","unbindEvents","onabort","imgFromBlob","blob","getCanvasElement","setCustomLogoCss","siteLogoUrl","logoCSS","retrieveFastAverageColor","fastAverageColor","DEFAULT_BACKGROUND_COLOR","getMediaColor","imgCrossOrigin","applyFilters","ALLOWED_IMAGE_FILE_TYPES","useImages","updateImagesInBlocks","canGenerateImage","getStockImageURL","generateCoverImageWithAI","inputPrompt","generateImageWithAI","customPrompt","surroundingContentOfBlock","aspectRatio","widthRatio","heightRatio","selectedSize","portrait","landscape","endpointArgs","isError","uploadedImageUrl","uploadMedia","filesList","File","onFileChange","fileObj","attrToUpdate","buildAttrToUpdateImage","backgroundImage","imageUrl","dimRatio","setImagesInBlocks","blocksToUpdate","newPage","newImages","imageIndex","getNewImages","blocksArray","coverImageUrl","applyNewImages","resolvedImages","setImages","generateLogoWithAI","_description$descript","base64Image","b64_json","grayscalePngBlob","base64Data","binaryData","atob","byteArray","blobFromBase64","transparentPngBlob","contrastFactor","imageData","grayscaleRaw","grayscaleValue","grayscaleClamped","putImageData","toBlob","transparentFromGrayscale","croppedPngBlob","firstX","Infinity","lastX","firstY","lastY","cropTransparentBlob","additionalData","site_logo","sprintf","getNewStockImage","usePatternContent","_getCachedContent","updateSectionContent","sectionData","cacheIndexes","sectionCategory","cacheKey","cached","newContent","getPatternContent","updatePatternImages","usedImages","urls","cachedImages","selectedSectionImages","selectedPexelsIds","getPatternImages","useReplaceContent","getContent","templating","ignoreContent","contentBlock","getPatternTypeContent","patternType","pageDescription","reasonForSection","hasRetried","prompts","reasoning","pageReasoning","generateDummyPostContent","customDescription","requestedSubject","selectedConcept","noCache","inMemory","patternContent","selectedSection","contentCall","getReplacementContent","sectionInfo","customSubject","_pageTitle","_pageDescription","messageContent","contentSystemPrompt","parsedArgs","replace_content","cnt","remappedContent","inMemoryBlock","getLastAvailableContentByClassName","foundBlock","DEFAULT_NUM_CONCEPTS","getImageBlocksWithIds","usePatterns","insertBlock","removeBlocks","setBlockEditingMode","updateBlockListSettings","setBlockRemovalRules","getBlockIndex","getSelectedBlockClientId","getBlockListSettings","getBlockRemovalRules","theUserLocale","isAfterSave","useAfterSave","useIsHomePage","selectedStyleVariationSet","styleVariations","getRootBlocksOfPostContent","getPatternById","patternId","setDefaultEditMode","blockListSettings","templateLock","syncSiteMetadataPatterns","postIds","ids","blockArrays","newPatternsForPosts","currentHeaderPattern","currentFooterPattern","newPatterns","savedPatterns","patternsObject","existingPatterns","newPattern","existingPattern","insertPattern","rootClientId","updateSelection","buildTemplatePartId","templatePartName","stylesheet","editTemplatePart","templatePartId","replacePattern","insertPatterns","patternList","blockRemovalRules","clientIds","insertionBlockId","firstPattern","shouldReplace","blocksToReplace","patternIndex","patternRootBlock","filterByCategory","availablePatterns","isAskingForMap","pageSlug","patternsInCategory","_patterns","convertToBlocks","rawHandler","HTML","generateDummyPosts","tag","dummyPostContent","post","featured_image","image_search","exclude","processSection","pages","setImagesInSection","setCTAInSection","setSectionInternalAnchor","setMapsInSection","applyCoverBlockOverlayStyles","choosePattern","alreadyChosenPatternIDs","canRepeatPattern","patternsToChooseFrom","availablePatternsNotChosen","lastPatternId","disallow_after","coverBlock","mediaColor","customOverlayColor","isUserOverlayColor","overlayColor","initializePattern","styleVariation","margin","replaceAll","getPatternCategory","patternRootBlockClientId","attrs","getParentPatternCategory","_ref","_selectedConcept$patt","selectedBlockClientId","currentPattern","deferredUpdates","findButtonBlock","buttonBlock","firstButtonBlock","cat","anchor","processTemplatePart","templatePart","templatePartBlocks","getPattern","getComponent","startBlock","findBlock","getSections","getSection","getItems","composePatterns","numberOfConcepts","chosenPatterns","concepts","savedSiteLocation","chosenPatternIDs","styleVariationIndex","chosenPatternId","chosenPattern","patternStyleVariation","concept","composeTemplatePartPattern","selectedPattern","templatePartStyleVariation","setImagesInConcept","getOtherPatternsInCategory","createConceptFromCurrentCanvas","createConceptFromSelectedBlock","patternData","createConceptFromHTML","validatedPattern","getAvailablePatternCategories","replaceTemplatePart","useHistory","emptyArray","usePages","getEntityRecords","per_page","saveEntityRecord","deleteEntityRecord","deleteAllPagesExceptHome","allPages","deletePromises","force","isSitePublished","savePost","goToPage","navigate","isPagePublished","getPages","rendered","isCurrentPage","deletePage","goBackPage","back","createPage","loadInEditor","menuOrder","existingPageId","throwOnError","conceptPatternsAndResolvers","flat","pageContent","pageData","menu_order","saveAndGoToPage","goHome","useResetSite","resetSite","deleteDummyPosts","buildNewSite","cachedCoordinates","useGeocoder","getCoordinates","locationName","features","geometry","getSiteDesignSystemPrompt","siteMeta","colorsString","fontsString","userColorRequest","createGetBuildDesignsTool","createColorPaletteGeneratorTool","keyword","pageNames","pageDefinitions","pageName","sections","pagesBySlug","homepageSections","intro","newsletter","subPages","gallery","templates","getBaseTemplate","getModelPageData","siteTemplate","getSiteStructureSystemPrompt","baseTemplate","requiredSections","optionalSections","createGetSiteStructureTool","minItems","constructSiteStructure","modelSections","templateSection","modelSection","validateModelSections","modelPages","validatedPages","templatePage","modelPage","validateModelPages","useRouting","runUrlChangeHandling","userNavigating","setUserNavigating","showOnboardingDialog","setShowOnboardingDialog","currentStep","previousStep","setSteps","searchParams","setAiStep","newStep","forceToHistory","pushState","aiStep","handleAiStepChange","handleUrlChange","getAiStep","getPreviousAiStep","useBuildSiteTool","buildSite","getBuildDesigns","colorVariationData","fontVariationData","getSystemPrompt","colorVariationNames","fontVariationNames","buildSiteTools","useGetBuildDesigns","getSiteStructure","siteStructureTools","structureResponse","siteStructure","savedCategories","useGetSiteStructure","header","designElementsPromise","siteStructurePromise","designElements","addSubPages","firstConceptPatternsAndResolvers","homePageBlocks","createPageResponses","pageSection","themeCopy","useBuildSite","buildSiteTask","siteMetadataToUpdate","specAssistant","specAssistantPrompt","specContext","specToolkit","siteSpecToolkit","build_site","start_over","createToolShowFontPicker","createUpsertSocialLinkTool","availableContactFormFields","addItemToEventsContainerTool","timeFormatExample","date","contentToolkit","trimmedDescription","colorVariationCategories","createShowFontPickerTool","fontCategories","socialLinks","address","formats","addContainerToEventsSectionTool","itemCount","addContainerToMenuSectionTool","addItemToMenuContainerTool","addContainerToServicesSectionTool","addItemToTestimonialsSectionTool","review","addContainerToPricingSectionTool","contactForm","isOnPage","blockAttributes","newLabel","blockExists","isValidClientId","useValidation","updateButtonLink","originalUrl","validateButtonArgs","cancelUpdateButtonLink","upsertSocialLink","socialLinksBlocks","socialLinksBlock","socialLinkBlock","newSocialLinkBlock","validateSocialLinkArgs","updateAddressOnPage","newAddress","oldAddress","findAndUpdateAddress","normalizedContent","normalizeAddress","normalizedOldAddress","escapeRegExp","updateMapMarker","isUndo","newCoordinates","mapBlockClientId","_newCoordinates$","_newCoordinates$2","mapBlock","updatedPoints","updateAddress","validateAddressArgs","cancelUpdateAddress","ActionCarousel","animationVariants","sliderRef","startX","scrollLeft","isDown","isConfirmationActions","classnames","onPointerDown","pageX","offsetLeft","onPointerLeave","handlePointerLeave","onPointerUp","handlePointerUp","onPointerMove","walk","motion","animate","transition","action_type","action_key","imageFile","base64String","mime","bstr","u8arr","base64ToFile","handleFileChange","files","fileUrl","handleFileError","useLog","setSessionSessionLogged","messageRole","messageId","parentMessageId","maybeLogSession","realLogAction","doLogSession","logScreenshot","logScreenshotForSession","logMessage","parentId","realLogMessage","logError","logUserChoice","logUserMessage","logToolCall","logAssistantMessage","ChatActions","useBlockContext","onActionClick","propActions","setActions","contentCallbacks","handleActionClick","getEventsActions","eventsActions","add_item_to_events_container","add_container_to_events_section","getMenuActions","menuActions","add_item_to_menu_container","add_container_to_menu_section","getPricingActions","add_container_to_pricing_section","getServicesActions","add_container_to_services_section","getTestimonialsActions","add_item_to_testimonials_section","getTeamActions","teamActions","add_member_to_team_container","add_container_to_team_section","getBigSkyPatternActions","getBaseActions","bigSkyPatternActions","parentPatternCategory","siteActions","show_layout_picker","getImageActions","getLogoActions","getTextActions","getButtonActions","getActions","currentActionType","useIsThinking","isThinking","ChatSuggestions","actionsToUse","responseMessage","ease","duration","contentAssistant","routerExamples","contentAssistantPrompt","useContentToolkit","isContactFormOnPage","modifyContactForm","validateContactFormArgs","useContactFormToolFunctions","canRemoveBlock","removeBlock","getContactFormBlock","getContactFormFields","contactFormBlock","isAJetpackFormField","addContactFormFields","updateContactFormFields","updatedFields","notUpdatedFields","formFieldBlocks","matchingTypeBlocks","blockToUpdate","fieldLabelKey","deleteContactFormFields","deletedFields","notDeletedFields","blockToRemove","cancelModifyContactForm","originalInnerBlocks","mapActionsToCallbackFunctions","insert","replaceContentAgent","addSection","getItemsCount","validateAddContentSectionArgs","addItems","validateAddItemsArgs","getCurrentPricingContent","getBlockOrder","getBlockParents","shouldReplaceContent","getStartIndex","useCacheKey","itemsBlock","sectionBlock","getParentComponentByName","groupBlockParentIds","groupBlockParentId","groupBlockParent","headingBlock","itemBlock","blocksToInsert","blockToInsert","sectionsBlock","replaceContentArgs","itemsToAdd","itemsCount","cacheOffset","validateMenuSectionArgs","tier","useContentToolFunctions","useButtonToolFunctions","useAddressToolFunctions","formatContent","validateFormatContentArgs","getSelectionStart","getSelectionEnd","substringStart","selectionStart","selectionEnd","newRichText","applyFormat","toHTMLString","useFormatContentToolFunctions","startOver","startOverActions","userConfirmation","useStartOverToolFunctions","_getOnSelectedBlockAction","_getIsHandoff","modify_contact_form_fields","rewrite_content","update_button_link","upsert_social_link","update_address","make_text_bold_italic","availableCategories","blockVariations","imageStyles","defaultStyle","colorAssistantToolkit","isObject","ctor","prot","useGlobalStylesOutput","firstFrame","secondFrame","THROTTLE_OPTIONS","leading","trailing","StylesPreview","_ref2","_ref3","_ref4","_ref5","textTransform","h1FontFamily","headingFontFamily","headerFontFamily","h1FontWeight","headingFontWeight","headerFontWeight","h1FontStyle","headingFontStyle","headerFontStyle","h1TextTransform","headingTextTransform","headerTextTransform","h1Color","headingColor","headerColor","containerResizeListener","useResizeObserver","throttledWidth","setThrottledWidthState","ratioState","setRatioState","setThrottledWidth","useThrottle","activeBackgroundColor","backgroundVar","colorNumber","useLayoutEffect","newRatio","ratioDiff","ratio","editorStyles","isGlobalStyles","isReady","Iframe","EditorStyles","div","variants","HStack","justify","activeTextColor","textVar","whiteSpace","paddingLeft","lineHeight","borderRadius","boxSizing","flexGrow","VStack","textAlign","mergeBaseAndUserConfigs","Variation","isFocused","setIsFocused","_variation$styles","isPreview","merged","handleSelectVariation","isActive","keyCode","ENTER","sliceVariations","VariationPicker","currentVariation","maxToShow","numSuggestions","variationsToShow","setVariationsToShow","firstIndex","setFirstIndex","numOfOtherVariationsToShow","sortedVariations","prepareVariations","currentVariationTitle","preparedVariations","initialVariations","Grid","columns","Button","variant","arrowLeft","revealPrevious","nextFirstIndex","newVariations","arrowRight","revealNext","ColorVariationPicker","maxColorsToShow","currentVariationIsSuggested","white","bisque","cadetblue","chartreuse","chocolate","coral","antiquewhite","aqua","azure","whitesmoke","papayawhip","plum","blanchedalmond","black","gold","goldenrod","gainsboro","cornsilk","cornflowerblue","burlywood","aquamarine","beige","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkkhaki","darkgray","darkgreen","darkgrey","peachpuff","darkmagenta","darkred","darkorchid","darkorange","darkslateblue","gray","darkslategray","darkslategrey","deeppink","deepskyblue","wheat","firebrick","floralwhite","ghostwhite","darkviolet","magenta","dodgerblue","grey","honeydew","hotpink","blueviolet","forestgreen","lawngreen","indianred","indigo","fuchsia","brown","maroon","mediumblue","lightcoral","darkturquoise","lightcyan","ivory","lightyellow","lightsalmon","lightseagreen","linen","mediumaquamarine","lemonchiffon","lime","khaki","mediumseagreen","limegreen","mediumspringgreen","lightskyblue","lightblue","midnightblue","lightpink","mistyrose","moccasin","mintcream","lightslategray","lightslategrey","navajowhite","navy","mediumvioletred","powderblue","palegoldenrod","oldlace","paleturquoise","mediumturquoise","mediumorchid","rebeccapurple","lightsteelblue","mediumslateblue","thistle","tan","orchid","mediumpurple","purple","pink","skyblue","springgreen","palegreen","yellow","slateblue","lavenderblush","peru","palevioletred","violet","teal","slategray","slategrey","aliceblue","darkseagreen","darkolivegreen","greenyellow","seagreen","seashell","tomato","silver","sienna","lavender","lightgreen","orange","orangered","steelblue","royalblue","turquoise","yellowgreen","salmon","saddlebrown","sandybrown","rosybrown","darksalmon","lightgoldenrodyellow","snow","lightgrey","lightgray","dimgray","dimgrey","olivedrab","olive","toName","closest","toLab","cbrt","atan2","exp","cssKeywordToColorMapping","getColorSlug","useColorToolFunctions","currentColorMeta","collectBlockColorAttributes","colorAttributes","processBlock","reapplyBlockColors","validateGenerateColorPaletteArgs","generateColorPalette","requestedColors","suggestedVariations","backgroundColorSlugs","defaultBackground","variationBackgrounds","uniqueBackgroundColorSlugs","relevance","maxRelevance","requestedColor","hasRequestedColor","cssKeyword","colorName","hasRequestedKeyword","currentColorIsSuggested","suggestedVariationsSorted","colorVariationsSorted","customPalettes","styleChanges","originalVariationName","cancelGenerateColorPalette","doneGenerateColorPalette","validateUpdateComponentColorArgs","getBlockSupport","supportsTextColor","__experimentalDefaultControls","defaultControls","supportsBackgroundColor","updateComponentColor","updatedComponents","closingMessages","contextSuffix","colorAssistant","colorAssistantPrompt","useColorToolkit","colorToolkit","color_palette_generator","component","update_component_color","addPatternTool","userPrompt","generatePatternTool","replacePatternTool","patternToolkit","usePatternToolValidation","validateBlockArgs","validateClientIdArgs","validateMapRequestArgs","newSiteLocation","validateAddPatternArgs","onlyOneAllowedSections","doReplace","validateGeneratePatternArgs","validateRemoveBlockArgs","validateReplacePatternArgs","useScrollButtons","scrollableSelector","pixelsToScrollBy","canScrollLeft","setCanScrollLeft","canScrollRight","setCanScrollRight","ScrollButton","checkScrollButtons","grid","scrollWidth","initialCheckTimeout","scrollElement","amount","newScrollLeft","leftScrollButton","chevronLeft","rightScrollButton","chevronRight","ThinkingMessage","thinkingMessageClassnames","memo","PatternsPreview","additionalStyles","viewportWidthMax","onRendered","isResolved","setIsResolved","fullLayoutItemSelect","el","singleSectionItemSelect","replaceClientId","rootBlockIds","checkIsResolved","shownPatterns","isViewportMatch","viewportStore","viewportWidth","whileHover","boxShadow","querySelectorAll","BlockPreview","AI","AskAI","ArrowUp","ItemPicker","generateNewItem","initialRenderedItems","pickerRef","allItemsRendered","setAllItemsRendered","renderedItems","setRenderedItems","getAdditionalStyles","canvasiFrameStyle","getComputedStyle","styleProperty","getPropertyValue","allRendered","isPlaceholder","ItemPreview","handleItemRendered","generateNewItemClickHandler","PatternPickerMenu","blockEditor","useAddPatternTool","addPattern","zoomedOut","blockIndex","dummySection","scrolled","initialPatternOptions","initialResolvers","flatMap","morePatternOptions","moreResolvers","generatingPatterns","patternOptions","doneAddPattern","useReplacePatternTool","__unstableGetEditorMode","selectedConceptCanvas","currentSection","originalBlock","doneReplacePattern","useGeneratePatternTool","getUserPrompt","allowedBlocks","getBlockTypes","portraitUrls","cleanedUrl","landscapeUrls","useUserPrompt","extractPhase","parseSSEChunk","processPhase","setIsProcessing","clearSelectedBlock","renderInEditor","patternAsBlocks","patternAsString","patternWithoutContainerIds","fixedBlocks","convertToString","patternJSON","updatedPatternAsString","containers","containerRefPattern","refId","patternString","processPattern","phaseNumber","cleanedCode","trimmed","endsWith","containerRefs","usePatternRenderer","extraction","extractPhaseContent","startMarker","endMarker","success","blockValidation","validateBlockStructure","containerValidation","validateContainerStructure","phaseContent","fullContent","containerIds","matchAll","warnings","warning","useStreamParser","processPhases","streamBuffer","completedPhases","currentPhase","generatePattern","prepareCanvas","storedUserPrompt","_userPrompt","makePatternRequest","decoder","pendingChunk","totalInputTokens","totalOutputTokens","eventData","stop_reason","processPatternStream","cleanupCanvas","registerGeneratedPattern","patternAssistant","patternAssistantPrompt","usePatternToolkit","removeBlockFromEditor","getBlockRootClientId","__clientId","_clientId","useRemoveBlockTool","generate_pattern","add_pattern","remove_block","replace_pattern","fontToolkit","FontVariationPicker","maxFontsToShow","useFontToolFunctions","currentFontMeta","showFontPicker","fontVariationsToShow","matchingKeywords","currentFontVariation","calculateFontVariationsToShow","cancelShowFontPicker","variationName","doneShowFontPicker","validateArguments","fontAssistant","fontAssistantPrompt","useFontToolkit","validateShowFontPickerArgs","show_font_picker","layoutToolkit","LayoutPicker","propConcepts","onGenerateNewConcept","setConcepts","selectedItem","updatedConcepts","useShowLayoutPickerToolFunctions","composeNewConcept","categoriesFromPageMeta","showSiteLayouts","categoriesFromPageMetaFiltered","originalLayout","cancelShowLayoutPicker","doneShowLayoutPicker","layoutAssistant","layoutAssistantPrompt","useLayoutToolkit","generateImageTool","imageToolkit","useUploadSiteLogoTool","siteData","editedRecord","editedSiteData","useEntityRecord","uploadSiteLogo","siteLogoBlock","originalId","cancelUploadSiteLogo","imageAssistant","imageAssistantPrompt","useImageToolValidation","imageBlock","generatedImage","useGenerateImageTool","getStockImage","stockImage","useGetStockImageTool","generateSiteLogo","logo","useGenerateSiteLogoTool","_getInputtedFiles","generate_image","get_stock_image","generate_site_logo","upload_site_logo","doUploadSiteLogo","addPageTool","other","navigateToPageTool","homepage","currentPage","pageToolkit","pageAssistant","pagesList","pageAssistantPrompt","usePageToolkit","addPage","isLinkBlock","useAddPageTool","navigateToPage","add_page","categorySlugs","suggestions","navigate_to_page","answers","answer","getMDLink","answerSlugs","helpToolkit","question","lastOdieChat","helpAssistant","isForwardedByAssistant","handleNonQuestions","askWordPressExpert","ask_odie","odieUrl","source_user","chat_id","sources","useAskOdieToolFunctions","ans","useAskWordPressExpertTool","ask_wordpress_expert","assistants","AIBuildMode","ResetSiteMetadataButton","isResetting","setIsResetting","StoreConversationToggle","ToggleControl","GeneratePatternsToggle","isGeneratingPatterns","setIsGeneratingPatternsState","setIsGeneratingPatterns","QuickOnboardingButton","setShowDebug","staticSiteMetadata","setStaticSiteMetadata","SaveCurrentBuild","buildDesigns","ModifyBuildForm","setShowModifyBuildForm","formRef","SiteData","defaultChecked","handleSave","saveFormData","formData","selectedIndex","dataset","ModifyBuild","AssemblerDebug","showModifyBuildForm","chatUsage","chat35Usage","Popover","UsageRow","usageType","Tools","big_sky_last_site_design_payload","alert","Palette","_variation$settings$c","localeCompare","getLocationCoordinates","remotePattern","selectedPatternId","insertPatternId","setInsertPatternId","sortedPatternsById","handleInsertPattern","patternToInsert","AssemblerDebugWrapper","showDebug","handleKeyDown","ctrlKey","useJetpackToken","withJetpackTokenRequest","markdownComponents","ChatMessage","handleOnClick","cssClasses","layoutScroll","Icon","cloneElement","formatMessageContent","ChatInput","forwardRef","onSendMessage","animationProps","submitButtonEnabled","setSubmitButtonEnabled","errorTooLong","setErrorTooLong","hasRecordedLongMessage","setHasRecordedLongMessage","currentAssistant","typingTimeout","parentNode","focus","characterLimit","adjustTextAreaHeight","textarea","scrollHeight","scrollTop","sendMessage","removeProperty","handleSubmit","TextareaControl","resizable","__nextHasNoMarginBottom","is_onboarded","inputError","handleInputChange","hideLabelFromVision","shiftKey","ResizeButton","resizeCornerNE","ChatNavigation","onClickBackButton","currentSiteMetadata","hoveringOffState","isHovering","setIsHovering","hasSpecs","specActions","handleTableRowClick","specItem","spec_item","Tooltip","edit","termDescription","specContent","mapMarker","ChatThread","onlyShowLastRequest","messagesEndRef","scrollToBottom","timeoutId","doScroll","isUnauthorizedError","layoutRoot","lastUserIndex","politeness","onRemove","dismissError","createInterpolateElement","support","SiteSpecsList","ChatComponents","BigSkyIcon","instanceId","inactiveInput","typingInput","thinkingInput","stateMachineName","iconURL","blueIcon","whiteIcon","startStateMachine","pauseStateMachine","useBigSkyIcon","AnimatePresence","waiting","repeat","waitingEnter","waitingExit","AgentChat","showNavigation","navigationTitle","defaultPrompt","agentQuestion","fileUploadEnabled","useChatSettings","inputRef","addFiles","fileNamesAndUrls","newFiles","removeFile","FilePreview","DropZone","onFilesDrop","focusInput","ItemGroup","isBordered","isSeparated","Item","defaultDimensions","menus","pending","completed","handoff","maximizedDimensions","getDockWidth","getDockHeight","getPendingActionMessage","getContentReplacementMessage","getDefaultChatSettings","mustUndoBlockWithGutenberg","ToolContainer","toolComponentKey","ConfirmationDialog","isOpen","onConfirm","cancelText","confirmText","Modal","onRequestClose","CompletedAction","showDeletePageDialog","setShowDeletePageDialog","shouldShowCancel","doResetDockView","popUndoStack","undo","onToolbarUndoCallback","getUndoManager","coreDataStore","undoCommand","redo","redoCommand","onToolbarUndo","undoButton","useUndoRedo","useShowLayoutPickerTool","resetDockView","handleCancel","handleDone","handleUndo","pageIdToDelete","getConfirmButtonText","HandoffStep","primaryCta","tertiaryCta","isAi","onBackClick","isChatMode","onSkip","didLoad","setDidLoad","handoffComponent","setHandoffComponent","componentRef","useChatThread","initializeThread","Handoff","prevColorRef","prevFontRef","handoffStartRef","finishHandoff","setupEditorWelcome","changeStep","steps","Chat","PendingActionMessage","CoverImageDockMenuItem","onAssistantMenuClick","assistantMenuTitle","chevronDown","ButtonDockMenus","GroupDockMenus","assistantPrompt","currentPatternCategories","uppercaseCategory","suggestionArgs","onClickAddPattern","plus","iconPosition","ImageDockMenus","NavigationDockMenus","onClickAddPage","TextDockMenus","SectionColorVariationPickerMenu","getBlockStyles","currentColorVariationName","getCurrentVariation","styleClasses","resetInnerBlocksTextColor","setNextVariation","currentVariationName","menu_slug","currentVariationIndex","newClassNames","activeVariation","ColorPickerMenu","_getBlockAttributes","selectedColor","setSelectedColor","customColor","setCustomColor","getDefaultTextColor","blankStyle","defaultTextColor","getSelectedBlockTextColor","themeColor","selectedBlockTextColor","doSetCustomColor","colorWheelButton","doSetSelectedColor","menuBackgroundColor","Dropdown","contentClassName","popoverProps","placement","renderToggle","selected_block","renderContent","color_name","ColorPicker","ButtonBarMenus","setChatSettings","setUseBlockContext","getMenuProps","additionalChatSettings","dockMenuTitle","assistantMenuSlug","dockPrompt","isPatternSelected","NavigationItemDockMenus","getMenus","ButtonBar","openAssistant","metaKey","Dock","setCssClasses","previousSelectedBlockClientId","setPreviousSelectedBlockClientId","chatSettings","editorMode","dockContentRef","resetDockState","selectedBlockHasChanged","newView","getNewDockView","shouldHideMessageThread","handleOnClickBack","resize","offsetWidth","offsetHeight","mass","stiffness","damping","preloadImageAndLogError","getExternalImages","siteUrl","isUploading","useSaveExternalImages","isSavingPage","editorBlocks","getEditorBlocks","mediaUpload","getSite","uploadImages","isWpcomSimple","mediaUrl","siteFragment","externalImagesFromPexels","pexelsIdMatch","pexelsID","responsePromises","mediaData","guid","pexelsUploadViaEndpointPromise","_response$media","responseMedia","_responseMedia$i$erro","_responseMedia$i$URL","_responseMedia$i$ID","_responseMedia$i$URL2","errors","importExternalImagesNow","importExternalImagesOnSave","EditorSetup","awaitEditor","_useDispatch","awaitingEditor","setAwaitingEditor","awaitingTemplatePartContent","setAwaitingTemplatePartContent","getBlockCount","setRenderingMode","setDefaults","setPreferencesDefaults","preferencesStore","setShowWelcomeGuide","waitForEditorReady","getCanvasHtml","distractionFree","fixedToolbar","isComplementaryAreaVisible","showBlockBreadcrumbs","welcomeGuide","welcomeGuidePage","welcomeGuideStyles","welcomeGuideTemplate","checkIframeLoaded","canvasHtml","contains","svgRef","styleRef","getMedia","_getMedia","isResolving","isResolvingSiteData","svgAlready","createElementNS","styleAlready","_editedSiteData$site_","siteLogo","_getColorVariationByT","getMediaById","isBigSkyLogo","big_sky_generated_logo","sectionVariation","_sectionVariation$col","_variation$styles$col","replaceChildren","styleRules","ownerDocument","feFlood","feComposite","setSvgColors","source_url","removeCustomLogoCss","setSiteLogoColors","useColorizedLogo","MutationObserver","mutations","mutation","removedNode","removedNodes","subtree","childList","adjustCanvasOpacity","waitForTemplatePartContentReady","headerBlocks","footerBlocks","adjustCanvasMode","messageList","handleCanvasModeChange","useCanvasSetup","HookRunner","ToolkitsProvider","ALL_ACTIONS","OnboardingSiteSuggestions","onClickSuggestion","setIsLoading","getRandomActions","previousActions","previousActionStrings","onExitComplete","reusableBlock","OnboardingLandingView","defaultEasing","defaultTransition","defaultAnimationProps","transitionToChat","assistantButtonAnimationProps","buttonRect","landingView","landingViewStyle","paddingTop","chatInputAnimationProps","chatInputRect","windowHeight","paddingBottom","h1","OnboardingChatView","chatInputRef","resizeObserver","Onboarding","showChat","setShowChat","previousTopicRef","hasRecordedEvent","handleShowChatView","isPagePostType","setIsPagePostType","hasCanvasLoaded","setHasCanvasLoaded","previousSelectedBlockRef","lastLoggedMessageRef","lastLoggedErrorRef","lastToolCall","AgentsProvider","ErrorBoundary","Component","hasError","getDerivedStateFromError","componentDidCatch","errorInfo","render","CommandMenuLoaderWrapper","_hook","hookResult","RetrieveCommands","commandLoadersNonContextual","commandLoadersContextual","commandsStore","getCommandLoaders","nonAIActions","isUpdatingCoverImage","setIsUpdatingCoverImage","coverBlockUrls","setCoverBlockUrls","coverBlockIds","coverBlockUrlChanged","coverBlockId","coverBlockUrl","handleCoverBlockChange","prevUrls","existingBlockIndex","GlobalStylesProvider","registerPlugin","AssemblerPlugin","BigSky","EditorSubscriptions","__webpack_require__","chunkIds","priority","notFulfilled","getter","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","chunkLoadingGlobal","__webpack_exports__"],"sourceRoot":""}